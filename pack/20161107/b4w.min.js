var b4w="object"===typeof b4w?b4w:function(a){var p={};a.module=p;var t={};a.cleanup=function(a,b){var k=p[a];k&&(k._compiled=null);t[b||"__b4w_default"]=null};a.register=function(a,b){p[a]||(p[a]=b)};a.require=function(a,b){if(!p[a])throw Error('Module "'+a+'" not found');b=b||"__b4w_default";t[b]||(t[b]=function(a){return function(b){var c=p[b];if(!c)throw Error('Module "'+b+'" not found');c._compiled||(c._compiled={});c._compiled[a]||(c._compiled[a]={},c(c._compiled[a],t[a]));return c._compiled[a]}}(b));
return t[b](a)};a.module_check=function(a){return p[a]?!0:!1};a.get_namespace=function(a){for(var b in t)if(t[b]==a)return b;return""};a.worker_listeners=[];a.worker_namespaces=[];return a}({});"object"==typeof module&&module.exports&&(GLOBAL.b4w={module:{}});
b4w.module.__version=function(a,p){function t(){var a=c,b=a.getDate(),b=10>b?"0"+String(b):String(b),l=a.getMonth()+1,l=10>l?"0"+String(l):String(l),q=String(a.getFullYear()),r=a.getHours(),r=10>r?"0"+String(r):String(r),g=a.getMinutes(),g=10>g?"0"+String(g):String(g),a=a.getSeconds(),a=10>a?"0"+String(a):String(a);return b+"."+l+"."+q+" "+r+":"+g+":"+a}var c=new Date(2016,0,28,12,25,35),b=[16,1];a.version=function(){return b};a.version_str=function(){for(var a="",d=0;d<b.length;d++)a=1==d?a+(10>
b[d]?"0"+b[d]:b[d]):a+b[d],d!=b.length-1&&(a+=".");return a};a.type=function(){return"RELEASE"};a.date=function(){return c};a.date_str=t;a.timestamp=function(){var a=t(),a=a.split(" ").join("").split(":").join("").split(".").join("");return"?t="+a}};"object"==typeof module&&module.exports&&b4w.module.__version(exports);b4w.module.__config=function(a,p){function t(){return b4w.module_check(a.paths.built_in_data_module)}function c(){for(var d=a.paths,c=null,k=document.getElementsByTagName("script"),r=0;r<k.length;r++){for(var g=k[r].src,C=0;C<d.js_src_search_paths.length;C++)if(0<=g.indexOf(d.js_src_search_paths[C])){c=g;break}if(null!==c)break}c||(b.warn("Couldn't determine path to ancillary resources, fallback to the current page directory"),c=document.location.href);d=c.indexOf("?");0<=d&&(c=c.substring(0,d));
return c.substring(0,c.lastIndexOf("/")+1)}var b=p("__print"),k=p("__util");a.P_LOW=1;a.P_HIGH=2;a.P_ULTRA=3;a.P_CUSTOM=4;a.context={alpha:!0,antialias:!1,premultipliedAlpha:!0};a.context_save=k.clone_object_r(a.context);a.defaults={alpha_sort:!0,alpha_sort_threshold:.1,alpha_clip_filtering_hack:!1,min_format_version:[5,7],max_fps:1E4,console_verbose:!1,do_not_load_resources:!1,use_min50:!1,fps_measurement_interval:1.5,fps_callback_interval:10,background_color:[0,0,0,0],lod_transition_ratio:.01,canvas_resolution_factor:1,
texture_min_filter:3,allow_cors:!1,force_low_quality_nodes:!1,anisotropic_filtering:!0,show_hud_debug_info:!1,depth_textures:!0,shadows:!0,stereo:"NONE",use_browser_distortion_cor:!0,reflections:!0,refractions:!0,ssao:!0,dof:!0,god_rays:!0,bloom:!0,motion_blur:!0,compositing:!0,antialiasing:!0,smaa:!1,wireframe_debug:!1,water_wireframe_debug:!1,foam:!0,parallax:!0,dynamic_grass:!0,procedural_fog:!0,water_dynamic:!0,shore_smoothing:!0,shore_distance:!0,max_texture_size:1024,max_cube_map_size:512,use_dds:!0,
precision:"highp",quality:a.P_HIGH,allow_vertex_textures:!0,no_phy_interp_hack:!1,shader_constants_hack:!1,disable_blend_shadows_hack:!1,vert_anim_mix_normals_hack:!1,is_mobile_device:!1,disable_doppler_hack:!1,cors_chrome_hack:!1,init_wa_context_hack:!1,clear_procedural_sky_hack:!1,sky_update_hack:!1,seq_video_fallback:!1,allow_hidpi:!1,gyro_use:!1,firefox_shadows_slink_hack:!1,mobile_firefox_media_hack:!1,enable_selectable:!0,enable_outlining:!0,glow_materials:!0,max_vertex_uniform_vectors:128,
ie11_edge_touchscreen_hack:!1,ios_depth_hack:!1,macos_tex_reuse_hack:!1,loaded_data_version:[0,0],edge_min_tex_size_hack:!1,quality_aa_method:!0,amd_skinning_hack:!1,url_params:null,webgl2:!0,msaa_samples:4,safari_canvas_alpha_hack:!1,resize_cubemap_canvas_hack:!1,clear_depth_hack:!1,media_auto_activation:!0,max_cast_lamps:4,mac_os_shadow_hack:!1,allow_shaders_debug_ext:!1};a.defaults_save=k.clone_object_r(a.defaults);a.animation={framerate:-1,frames_blending_hack:!1,frame_steps:1};a.controls={mouse_wheel_notch_multiplier:1/
120};a.assets={dir:"ASSETS=../../assets/",max_requests:15,prevent_caching:!0,min50_available:!1,dds_available:!1};a.assets_save=k.clone_object_r(a.assets);a.paths={shaders_dir:"",shaders_include_dir:"include/",shaders_postp_dir:"postprocessing/",built_in_data_module:"built_in_data",js_src_search_paths:"b4w.min.js b4w.full.min.js b4w.simple.min.js b4w.whitespace.min.js src/b4w.js USER_DEFINED_MODULE".split(" "),resources_dir:"./",smaa_search_texture_path:"",smaa_area_texture_path:""};a.physics={enabled:!0,
max_fps:60,uranium_path:"",calc_fps:!1,ping:!1,use_workers:!0};a.physics_save=k.clone_object_r(a.physics);a.scenes={grass_tex_size:1024,cubemap_tex_size:384,cube_reflect_low:32,cube_reflect_medium:128,cube_reflect_high:256,plane_reflect_low:.25,plane_reflect_medium:.5,plane_reflect_high:1};a.scenes_save=k.clone_object_r(a.scenes);a.sfx={webaudio:!0,mix_mode:!1,audio_loading_hack:!1,clamp_playback_rate_hack:!1,disable_playback_rate_hack:!1};a.sfx_save=k.clone_object_r(a.sfx);a.outlining={outlining_overview_mode:!1,
outline_color:[1,.4,.05],outline_duration:.2,outline_period:3.8,outline_relapses:1};a.debug_subs={enabled:!1,subs_type:"DEPTH",subs_number:0,slink_type:"COLOR"};a.debug_subs_save=k.clone_object_r(a.debug_subs);a.apply_quality=function(){var b=a.defaults,c=a.physics,k=a.scenes;switch(b.quality){case a.P_ULTRA:b.shadows=!0;b.shore_smoothing=!0;b.ssao=!0;b.dof=!0;b.god_rays=!0;b.bloom=!0;b.reflections=!0;b.refractions=!0;b.foam=!0;b.parallax=!0;b.dynamic_grass=!0;b.procedural_fog=!0;k.grass_tex_size=
2048;b.texture_min_filter=3;b.anisotropic_filtering=!0;b.use_min50=!1;b.precision="highp";b.water_dynamic=!0;b.shore_distance=!0;b.antialiasing=!0;b.smaa=!1;b.compositing=!0;b.motion_blur=!0;b.allow_hidpi=!0;b.enable_outlining=!0;b.glow_materials=!0;b.msaa_samples=16;c.max_fps=120;break;case a.P_HIGH:b.shadows=!0;b.shore_smoothing=!0;b.ssao=!0;b.dof=!0;b.god_rays=!0;b.bloom=!0;b.reflections=!0;b.refractions=!0;b.foam=!0;b.parallax=!0;b.dynamic_grass=!0;b.procedural_fog=!0;k.grass_tex_size=1024;b.texture_min_filter=
3;b.anisotropic_filtering=!0;b.use_min50=!1;b.precision="highp";b.water_dynamic=!0;b.shore_distance=!0;b.antialiasing=!0;b.smaa=!1;b.compositing=!0;b.motion_blur=!0;b.allow_hidpi=!1;b.enable_outlining=!0;b.glow_materials=!0;b.msaa_samples=4;c.max_fps=60;break;case a.P_LOW:b.shadows=!1,b.shore_smoothing=!1,b.ssao=!1,b.dof=!1,b.god_rays=!1,b.bloom=!1,b.reflections=!1,b.refractions=!1,b.foam=!1,b.parallax=!1,b.dynamic_grass=!1,b.procedural_fog=!1,k.grass_tex_size=512,b.texture_min_filter=2,b.anisotropic_filtering=
!1,b.use_min50=!0,b.precision="mediump",b.water_dynamic=!1,b.shore_distance=!1,b.antialiasing=!1,b.smaa=!1,b.compositing=!1,b.motion_blur=!1,b.allow_hidpi=!1,b.enable_outlining=!1,b.glow_materials=!1,b.msaa_samples=1,c.max_fps=60}};a.set=function(d,c){switch(d){case "allow_cors":a.defaults.allow_cors=c;break;case "allow_hidpi":a.defaults.allow_hidpi=c;break;case "alpha":a.context.alpha=c;break;case "alpha_sort":a.defaults.alpha_sort=c;break;case "alpha_sort_threshold":a.defaults.alpha_sort_threshold=
c;break;case "anaglyph_use":b.error_deprecated_cfg("anaglyph_use","stereo");a.defaults.stereo=c?"ANAGLYPH":a.defaults.stereo;break;case "animation_framerate":a.animation.framerate=c;break;case "antialiasing":a.defaults.antialiasing=c;break;case "assets_dds_available":a.assets.dds_available=c;break;case "assets_min50_available":a.assets.min50_available=c;break;case "audio":a.sfx.webaudio=c;break;case "background_color":a.defaults.background_color=c;break;case "built_in_module_name":a.paths.built_in_data_module=
c;break;case "canvas_resolution_factor":a.defaults.canvas_resolution_factor=c;break;case "console_verbose":a.defaults.console_verbose=c;break;case "do_not_load_resources":a.defaults.do_not_load_resources=c;break;case "gyro_use":a.defaults.gyro_use=c;break;case "stereo":a.defaults.stereo=c;break;case "use_browser_distortion_cor":a.defaults.use_browser_distortion_cor=c;case "media_auto_activation":a.defaults.media_auto_activation=c;break;case "physics_enabled":a.physics.enabled=c;break;case "physics_uranium_path":a.physics.uranium_path=
c;break;case "physics_calc_fps":a.physics.calc_fps=c;break;case "physics_use_workers":a.physics.use_workers=c;break;case "precision":a.defaults.precision=c;break;case "quality":a.defaults.quality=c;break;case "sfx_mix_mode":a.sfx.mix_mode=c;break;case "shaders_dir":a.paths.shaders_dir=c;break;case "show_hud_debug_info":a.defaults.show_hud_debug_info=c;break;case "smaa":a.defaults.smaa=c;break;case "smaa_search_texture_path":a.paths.smaa_search_texture_path=c;break;case "smaa_area_texture_path":a.paths.smaa_area_texture_path=
c;break;case "wireframe_debug":a.defaults.wireframe_debug=c;break;case "enable_selectable":a.defaults.enable_selectable=c;break;case "enable_outlining":a.defaults.enable_outlining=c;break;case "outlining_overview_mode":a.outlining.outlining_overview_mode=c;break;case "glow_materials":a.defaults.glow_materials=c;break;case "url_params":a.defaults.url_params=c;break;default:b.error("Unknown config property: "+d)}};a.get=function(d){switch(d){case "allow_cors":return a.defaults.allow_cors;case "allow_hidpi":return a.defaults.allow_hidpi;
case "alpha":return a.context.alpha;case "alpha_sort":return a.defaults.alpha_sort;case "alpha_sort_threshold":return a.defaults.alpha_sort_threshold;case "anaglyph_use":return"ANAGLYPH"==a.defaults.stereo;case "animation_framerate":return a.animation.framerate;case "antialiasing":return a.defaults.antialiasing;case "assets_dds_available":return a.assets.dds_available;case "assets_min50_available":return a.assets.min50_available;case "audio":return a.sfx.webaudio;case "background_color":return a.defaults.background_color;
case "built_in_module_name":return a.paths.built_in_data_module;case "canvas_resolution_factor":return a.defaults.canvas_resolution_factor;case "console_verbose":return a.defaults.console_verbose;case "do_not_load_resources":return a.defaults.do_not_load_resources;case "gyro_use":return a.defaults.gyro_use;case "stereo":return a.defaults.stereo;case "use_browser_distortion_cor":return a.defaults.use_browser_distortion_cor;case "media_auto_activation":return a.defaults.media_auto_activation;case "physics_enabled":return a.physics.enabled;
case "physics_uranium_path":return a.physics.uranium_path;case "physics_calc_fps":return a.physics.calc_fps;case "physics_use_workers":return a.physics.use_workers;case "precision":return a.defaults.precision;case "quality":return a.defaults.quality;case "sfx_mix_mode":return a.sfx.mix_mode;case "shaders_dir":return a.paths.shaders_dir;case "show_hud_debug_info":return a.defaults.show_hud_debug_info;case "smaa":return a.defaults.smaa;case "smaa_search_texture_path":return a.paths.smaa_search_texture_path;
case "smaa_area_texture_path":return a.paths.smaa_area_texture_path;case "wireframe_debug":return a.defaults.wireframe_debug;case "enable_selectable":return a.defaults.enable_selectable;case "enable_outlining":return a.defaults.enable_outlining;case "outlining_overview_mode":return a.outlining.outlining_overview_mode;case "glow_materials":return a.defaults.glow_materials;case "url_params":return a.defaults.url_params;default:b.error("Unknown config property: "+d)}};a.reset=function(){a.context=k.clone_object_r(a.context_save);
a.defaults=k.clone_object_r(a.defaults_save);a.assets=k.clone_object_r(a.assets_save);a.physics=k.clone_object_r(a.physics_save);a.scenes=k.clone_object_r(a.scenes_save);a.sfx=k.clone_object_r(a.sfx_save);a.debug_subs=k.clone_object_r(a.debug_subs_save)};a.is_built_in_data=t;a.set_paths=function(){var b=a.paths,k=a.physics;t()||""!=b.shaders_dir||(b.shaders_dir=c()+"../shaders/");if(t())b.smaa_search_texture_path="smaa_search_texture.png",b.smaa_area_texture_path="smaa_area_texture.png";else if(""==
b.smaa_search_texture_path||""==b.smaa_area_texture_path){var q=c()+b.resources_dir;b.smaa_search_texture_path=b.smaa_search_texture_path||q+"smaa_search_texture.png";b.smaa_area_texture_path=b.smaa_area_texture_path||q+"smaa_area_texture.png"}k.enabled&&""==k.uranium_path&&(q=c()+b.resources_dir,k.uranium_path=q+"uranium.js")};a.get_std_assets_path=function(){return a.assets.dir.replace("ASSETS=","")}};b4w.module.__anchors=function(a,p){function t(a,h){var e=document.createElement("div"),n=e.style;n.position="absolute";n.backgroundColor="black";n.borderRadius="20px 20px 20px 0px";n.boxShadow="0px 0px 10px rgb(180, 180, 200)";n.opacity=1;n.padding="8px 12px";n.lineHeight="15px";n.visibility="hidden";n.fontSize="12px";var d=g.get_container();d.appendChild(e);var f=C.get_meta_tags(a);if(f)var v=f.title||a.name,l=f.description;else v=a.name,l="";var x=document.createElement("span"),H=x.style;x.innerHTML=
v;H.fontWeight="bold";H.fontSize="12px";H.lineHeight="15px";H.color="#fff";H.fontFamily="Arial";k(x);e.appendChild(x);if(l){var f=document.createElement("div"),P=f.style;P.position="absolute";P.bottom="0px";P.left="0px";P.backgroundColor="#000";P.borderRadius="20px 20px 20px 0px";P.boxShadow="0px 0px 10px rgb(180, 180, 200)";P.visibility="hidden";P.padding="8px 12px";P.overflow="hidden";P.lineHeight="15px";P.fontSize="12px";P.zIndex="2";e.appendChild(f);var v=document.createElement("span"),I=v.style;
v.innerHTML=l;I.fontSize="12px";I.fontFamily="Arial";I.fontWeight="bold";I.lineHeight="15px";I.color="#fff";I.visibility="hidden";f.appendChild(v);var aa=!1,z=!1;d.addEventListener("mousedown",function(a){if(!(aa||z||F))if(a.target!=x&&a.target!=e||"hidden"!=P.visibility||1!=n.opacity)"visible"==P.visibility&&(n.visibility="visible",H.visibility="visible",P.visibility="hidden",I.visibility="hidden");else{n.visibility="hidden";H.visibility="hidden";P.visibility="visible";aa=z=!0;a=e.offsetWidth-24;
var m=e.offsetHeight-16,d=Math.min(h,c(l,"12px")),f=b(l,"12px",d);f==m&&(P.height=f+"px");d!=a?A.animate(a,d,200,function(a){a==d&&("visible"==P.visibility&&(I.visibility="visible"),aa=!1);P.width=a+"px"}):aa=!1;f!=m?A.animate(m,f,200,function(a){a==f&&("visible"==P.visibility&&(I.visibility="visible"),z=!1);P.height=a+"px"}):z=!1;z||aa||(I.visibility="visible")}},!1)}return e}function c(a,b,h){h=document.createElement("div");var e=document.createElement("span"),n=h.style;e.innerHTML=a;e.style.fontSize=
b;e.style.fontFamily="Arial";e.style.fontWeight="bold";e.style.color="#fff";e.style.visibility="hidden";n.lineHeight="15px";h.appendChild(e);n.position="absolute";n.visibility="hidden";n.fontSize=b;n.display="inline-block";n.lineHeight="15px";document.body.appendChild(h);a=h.offsetWidth+1;document.body.removeChild(h);return a}function b(a,b,h){var e=document.createElement("div"),n=document.createElement("span"),d=e.style;n.innerHTML=a;n.style.fontSize=b;n.style.fontFamily="Arial";n.style.fontWeight=
"bold";n.style.color="#fff";n.style.visibility="hidden";d.lineHeight="15px";e.appendChild(n);d.position="absolute";d.visibility="hidden";d.fontSize=b;d.display="inline-block";d.width=h+"px";d.lineHeight="15px";document.body.appendChild(e);a=e.offsetHeight;document.body.removeChild(e);return a}function k(a){a.style["-webkit-touch-callout"]="none";a.style["-webkit-user-select"]="none";a.style["-khtml-user-select"]="none";a.style["-moz-user-select"]="none";a.style["-ms-user-select"]="none";a.style["user-select"]=
"none";a.style.cursor="default"}function d(){for(var a=0,b=0;b<D.length;b++)D[b].detect_visibility&&a++;e=new Float32Array(3*a)}function l(a,b){return b.depth-a.depth}var q=p("__batch"),r=p("__camera"),g=p("__container"),C=p("__objects"),f=p("__print"),h=p("__renderer"),n=p("__scenes"),A=p("__time"),B=p("__tsr");p("__util");p("__config");var F=!1,D=[],e=new Float32Array(0),z=new Uint8Array(16),y=new Float32Array(2),v=new Float32Array(3);a.append=function(a){var b;a:{for(b=0;b<D.length;b++)if(D[b].obj==
a){b=!0;break a}b=!1}if(!b){b=a.anchor.detect_visibility&&Boolean(n.get_subs(n.get_main(),"ANCHOR_VISIBILITY"));b={type:a.anchor.type,obj:a,x:0,y:0,depth:0,appearance:"out",detect_visibility:b,element:null,move_cb:null,annotation_max_width:a.anchor.max_width,annotation_height:0,annotation_width:0,element_id:a.anchor.element_id};switch(b.type){case "ANNOTATION":b.element=t(a,b.annotation_max_width);b.annotation_height=b.element.offsetHeight;b.annotation_width=b.element.offsetWidth;break;case "ELEMENT":b.element=
document.getElementById(a.anchor.element_id),b.element?(b.annotation_height=b.element.offsetHeight,b.annotation_width=b.element.offsetWidth):(f.warn("Anchor HTML element was not found, making it generic"),b.type="GENERIC")}D.push(b);d()}};a.remove=function(a){for(var b=0;b<D.length;b++){var h=D[b];if(h.obj==a){"ANNOTATION"==h.type&&(a=h,g.get_container().removeChild(a.element));D.splice(b,1);d();break}}};a.update=function(){for(var a=0,b=D.length;b--;){var h=D[b];if(h.detect_visibility){var d=B.get_trans_view(h.obj.render.world_tsr);
e.set(d,3*a++)}var c;c=h;var d=v,f=n.get_camera(n.get_main());c=B.get_trans_view(c.obj.render.world_tsr);c=d=r.project_point(f,c,d);d=c[0];f=c[1];c=c[2];if(d!=h.x||f!=h.y||c!=h.depth){switch(h.type){case "ANNOTATION":var g=h.element;g.style.left=Math.floor(d)+"px";g.style.top=Math.floor(f-h.annotation_height)+"px";break;case "ELEMENT":var g=h.element,k=g.getBoundingClientRect();g.style.cssText+="left:"+Math.floor(d-k.width/2)+"px;top:"+Math.floor(f-k.height/2)+"px;"}h.x=d;h.y=f;h.depth=c;h.move_cb&&
h.move_cb(d,f,h.appearance,h.obj,g)}}D.sort(l);for(b=0;b<D.length;b++)h=D[b],"GENERIC"!=h.type&&(h.element.style.zIndex=b);0<a&&(a=n.get_subs(n.get_main(),"ANCHOR_VISIBILITY").bundles[0].batch,q.update_anchor_visibility_batch(a,e))};a.update_visibility=function(){for(var a=g.get_container(),b=D.length;b--;){var e=D[b],d=e.obj,c=e.x,f=e.y,v=e.depth,v=0>c||0>f||0>v||1<v||n.is_hidden(d)||c>=a.clientWidth||f>=a.clientHeight?"out":"visible";if(e.detect_visibility&&"out"!=v){var v=e,k=n.get_subs(n.get_main(),
"ANCHOR_VISIBILITY").camera,x=g.canvas_to_viewport_coords(v.x,v.y,y,k);h.read_pixels(k.framebuffer,x[0],k.height-x[1],2,2,z);v=1020==z[0]+z[4]+z[8]+z[12]?"visible":"out"==v.appearance||0==z[0]+z[4]+z[8]+z[12]?"covered":v.appearance}if(v!=e.appearance){switch(e.type){case "ANNOTATION":case "ELEMENT":var H=e.element;if(!H)break;"out"==v?(H.style.visibility="hidden",H.children.length&&(H.children[0].style.visibility="hidden"),"ANNOTATION"==e.type&&1<H.children.length&&(k=H.children[1],k.style.visibility=
"hidden",k.children.length&&(k.children[0].style.visibility="hidden"))):"visible"==v?(H.style.visibility="visible",H.children.length&&(H.children[0].style.visibility="visible"),H.style.opacity=1):(H.style.visibility="visible",H.style.opacity=.1,H.children.length&&(H.children[0].style.visibility="visible"),"ANNOTATION"==e.type&&1<H.children.length&&(k=H.children[1],k.style.visibility="hidden",k.children.length&&(k.children[0].style.visibility="hidden")))}e.appearance=v;e.move_cb&&e.move_cb(c,f,e.appearance,
d,H)}}};a.attach_move_cb=function(a,b){for(var h=0;h<D.length;h++)D[h].obj==a&&(D[h].move_cb=b)};a.detach_move_cb=function(a){for(var b=0;b<D.length;b++)D[b].obj==a&&(D[b].move_cb=null)};a.cleanup=function(){for(var a=0;a<D.length;a++){var b=D[a];"ANNOTATION"==b.type&&g.get_container().removeChild(b.element)}D.length=0};a.is_anchor=function(a){for(var b=0;b<D.length;b++)if(D[b].obj==a)return!0;return!1};a.get_element_id=function(a){for(var b=0;b<D.length;b++)if(D[b].obj==a)return D[b].element_id;
return!1};a.pause=function(){F=!0};a.resume=function(){F=!1};a.pick_anchor=function(a,b){for(var h=-1,e=0;e<D.length;e++){var n=D[e],d;var c=D[e];d=a;var f=b,x=Math.round(c.annotation_width),H=Math.round(c.annotation_height),v=c.x,c=c.y;d=d>=v&&d<=v+x&&f<c&&f>=c-H?!0:!1;if(n.appearance=d)if(0>h)var I=D[e].depth,h=e;else D[e].depth<I&&(h=e,I=D[e].depth)}return 0>h?null:D[h].obj}};b4w.module.__armature=function(a,p){function t(a){a=a.render;for(var b=a.skinned_renders,h=a.mesh_to_arm_bone_maps,d=0;d<b.length;d++){for(var c=b[d],e=h[d],f=0;f<e.length;f+=2)for(var g=e[f],v=e[f+1],m=0;4>m;m++)c.quats_before[g+m]=a.quats_before[v+m],c.quats_after[g+m]=a.quats_after[v+m],c.trans_before[g+m]=a.trans_before[v+m],c.trans_after[g+m]=a.trans_after[v+m];c.frame_factor=a.frame_factor}}function c(a,b,h,d){var f=a.tsr_bone_pose,e=a.tsr_local_rest,l=a.tsr_local_pose,q=a.parent_bone_ptr;q?
(q=q.tsr_local_pose,b?k.multiply(q,f,l):(b=g,k.invert(q,b),k.multiply(b,l,f))):b?k.copy(f,l):k.copy(l,f);f=r;k.invert(e,f);k.multiply(l,f,f);e=a.bone_index;h[4*e]=f[0];h[4*e+1]=f[1];h[4*e+2]=f[2];h[4*e+3]=f[3];d[4*e]=f[4];d[4*e+1]=f[5];d[4*e+2]=f[6];d[4*e+3]=f[7];a=a.descend_bones_ptrs;for(e=0;e<a.length;e++)l=a[e],l.constraint||c(l,!0,h,d)}var b=p("__util"),k=p("__tsr"),d=p("__quat"),l=p("__mat4"),q=p("__vec3"),r=k.create(),g=k.create(),C=new Float32Array(4),f=new Float32Array(4),h=new Float32Array(4);
a.update_object=function(a,h){for(var d=a.data.bones,c=a.pose.bones,f={},e=0;e<c.length;e++){var g=c[e],y=g.bone,v=y.name,m=v,v={bone_index:0,vgroup_index:-1,parent_bone_ptr:null,descend_bones_ptrs:[],chain:[],constraint:null,tsr_bone_rest:k.create(),tsr_bone_pose:k.create(),tsr_local_rest:k.create(),tsr_local_pose:k.create(),tsr_basis:k.create(),tsr_channel_cache:k.create(),tsr_channel_cache_valid:!1,tail:new Float32Array(3)},m=f[m]=v,v=new Float32Array(y.matrix_local),u=new Float32Array(16);l.invert(v,
u);var g=new Float32Array(g.matrix_basis),K=m.tail;q.subtract(y.tail_local,y.head_local,K);b.vecdir_multiply_matrix(K,u,K);k.from_mat4(v,m.tsr_local_rest);k.from_mat4(g,m.tsr_basis);k.copy(m.tsr_local_rest,m.tsr_local_pose)}for(e=0;e<d.length;e++){v=d[e].name;g=b.keysearch("name",v,c);m=f[v];y=g.parent_recursive;m.chain.push(m);for(g=0;g<y.length;g++)u=y[g],u=u.name,u=f[u],m.chain.push(u);y.length?(u=y[0],u=u.name,u=f[u],m.parent_bone_ptr=u,k.invert(u.tsr_local_rest,r),k.multiply(r,m.tsr_local_rest,
m.tsr_bone_rest),u.descend_bones_ptrs.push(m)):k.copy(m.tsr_local_rest,m.tsr_bone_rest);m.bone_index=e;m.name=v;k.multiply(m.tsr_bone_rest,m.tsr_basis,m.tsr_bone_pose)}h.render.bone_pointers=f};a.get_bone_tsr=function(a,b,c,l,q){var e=a.render,z=e.frame_factor;b=e.bone_pointers[b];var y=b.bone_index;a=b.tsr_local_rest;var v=e.trans_before,m=e.trans_after,u=e.quats_before,e=e.quats_after,K=v[4*y+1],E=v[4*y+2],M=v[4*y+3],J=m[4*y+1],O=m[4*y+2],G=m[4*y+3];C[0]=(1-z)*v[4*y]+z*m[4*y];C[1]=(1-z)*K+z*J;C[2]=
(1-z)*E+z*O;C[3]=(1-z)*M+z*G;f[0]=u[4*y];f[1]=u[4*y+1];f[2]=u[4*y+2];f[3]=u[4*y+3];h[0]=e[4*y];h[1]=e[4*y+1];h[2]=e[4*y+2];h[3]=e[4*y+3];d.slerp(f,h,z,f);z=r;k.set_transcale(C,z);k.set_quat(f,z);c?(c=g,k.translate(a,b.tail,c),k.multiply(z,c,z)):k.multiply(z,a,z);if(l){if(l=b.parent_bone_ptr)c=g,k.invert(l.tsr_local_pose,c),k.multiply(c,z,z);l=g;k.invert(b.tsr_bone_rest,l);k.multiply(l,z,z)}k.copy(z,q)};a.set_bone_tsr=function(a,b,h,d){var f=a.render;b=f.bone_pointers[b];var e=f.trans_before,g=f.quats_before;
d?k.multiply(b.tsr_bone_rest,h,b.tsr_bone_pose):k.copy(h,b.tsr_local_pose);c(b,d,e,g);f.frame_factor=0;t(a)};a.update_skinned_renders=t;a.update_bone_tsr_r=c;a.check_bone=function(a,b){return b in a.render.bone_pointers}};b4w.module.__boundings=function(a,p){function t(a,b){for(var d=a[0],c=a[1],f=a[2],g=a[0],e=a[1],k=a[2],l=3;l<a.length;l+=3)var v=a[l],m=a[l+1],u=a[l+2],d=Math.max(d,v),c=Math.max(c,m),f=Math.max(f,u),g=Math.min(g,v),e=Math.min(e,m),k=Math.min(k,u);b.max_x=d;b.max_y=c;b.max_z=f;b.min_x=g;b.min_y=e;b.min_z=k;return b}function c(a,b){b||(b=new Float32Array(24));var d=a.max_x,c=a.max_y,f=a.max_z,g=a.min_x,e=a.min_y,k=a.min_z;b[0]=g;b[1]=e;b[2]=k;b[3]=d;b[4]=e;b[5]=k;b[6]=d;b[7]=c;b[8]=k;b[9]=g;b[10]=
c;b[11]=k;b[12]=g;b[13]=e;b[14]=f;b[15]=d;b[16]=e;b[17]=f;b[18]=d;b[19]=c;b[20]=f;b[21]=g;b[22]=c;b[23]=f;return b}function b(){return{axis_x:new Float32Array(3),axis_y:new Float32Array(3),axis_z:new Float32Array(3),center:new Float32Array([0,0,0])}}function k(a,b,d){q.add(b,d,a.center);q.scale(a.center,.5,a.center);a.radius=q.distance(a.center,b);return a}var d=p("__tsr"),l=p("__util"),q=p("__vec3"),r=new Float32Array(24),g=new Float32Array(3),C=new Float32Array(3),f=new Float32Array(3);a.copy_bb=
function(a,b){b.min_x=a.min_x;b.max_x=a.max_x;b.min_y=a.min_y;b.max_y=a.max_y;b.min_z=a.min_z;b.max_z=a.max_z};a.big_bounding_box=function(){return{max_x:1E12,min_x:-1E12,max_y:1E12,min_y:-1E12,max_z:1E12,min_z:-1E12}};a.zero_bounding_box=function(a){a||(a={});a.max_x=0;a.min_x=0;a.max_y=0;a.min_y=0;a.max_z=0;a.min_z=0;return a};a.expand_bounding_box=function(a,b){var d=a.max_y,c=a.max_z,f=a.min_x,g=a.min_y,e=a.min_z;a.max_x=Math.max(b.max_x,a.max_x);a.max_y=Math.max(b.max_y,d);a.max_z=Math.max(b.max_z,
c);a.min_x=Math.min(b.min_x,f);a.min_y=Math.min(b.min_y,g);a.min_z=Math.min(b.min_z,e);return a};a.bb_from_coords=t;a.bounding_box_transform=function(b,f,g){g||(g=a.zero_bounding_box());b=c(b,r);d.transform_vectors(b,f,b);return t(b,g)};a.extract_bb_corners=c;a.shrink_bounding_box=function(b,d,c){c||(c=a.zero_bounding_box());var f=d.min_x,g=d.max_x,k=d.min_y,e=d.max_y,l=d.min_z;d=d.max_z;if(f>=b.max_x||g<=b.min_x||k>=b.max_y||e<=b.min_y||l>=b.max_z||d<=b.min_z)return c.min_x=-.1,c.max_x=.1,c.min_y=
-.1,c.max_y=.1,c.min_z=-.2,c.max_z=-.1,c;c.min_x=Math.max(b.min_x,f);c.max_x=Math.min(b.max_x,g);c.min_y=Math.max(b.min_y,k);c.max_y=Math.min(b.max_y,e);c.min_z=Math.max(b.min_z,l);c.max_z=Math.min(b.max_z,d);return c};a.stretch_bounding_box=function(b,d,c){c||(c=a.zero_bounding_box());var f=b.max_x-b.min_x,g=b.max_y-b.min_y,k=b.max_z-b.min_z;c.min_x=b.min_x-.5*(d-1)*f;c.max_x=b.max_x+.5*(d-1)*f;c.min_y=b.min_y-.5*(d-1)*g;c.max_y=b.max_y+.5*(d-1)*g;c.min_z=b.min_z-.5*(d-1)*k;c.max_z=b.max_z+.5*(d-
1)*k;return c};a.bounding_sphere_transform=function(b,c,f){f||(f=a.zero_bounding_sphere());d.transform_vec3(b.center,c,f.center);f.radius=b.radius*d.get_scale(c);return f};a.bounding_ellipsoid_transform=function(a,c,f){f||(f=b());d.transform_vec3(a.center,c,f.center);q.copy(a.axis_x,f.axis_x);q.copy(a.axis_y,f.axis_y);q.copy(a.axis_z,f.axis_z);d.transform_dir_vec3(f.axis_x,c,f.axis_x);d.transform_dir_vec3(f.axis_y,c,f.axis_y);d.transform_dir_vec3(f.axis_z,c,f.axis_z);return f};a.create_bounding_sphere=
function(a,b){return{radius:a,center:new Float32Array(b)}};a.zero_bounding_sphere=function(){return{center:new Float32Array([0,0,0]),radius:0}};a.zero_bounding_ellipsoid=b;a.create_bounding_ellipsoid=function(a,b,d,c){return{axis_x:new Float32Array(a),axis_y:new Float32Array(b),axis_z:new Float32Array(d),center:new Float32Array([c[0],c[1],c[2]])}};a.big_bounding_sphere=function(){return{center:new Float32Array([0,0,0]),radius:1E12}};a.expand_bounding_sphere=function(a,b){var d=q.subtract(b.center,
a.center,q.create());0==q.length(d)&&q.set(1,0,0,d);var c=q.normalize(d,q.create()),d=q.scale(c,a.radius,q.create());q.add(d,a.center,d);var f=q.scale(c,-a.radius,q.create());q.add(f,a.center,f);var g=q.scale(c,b.radius,q.create());q.add(g,b.center,g);var e=q.scale(c,-b.radius,q.create());q.add(e,b.center,e);d=[d,f,g,e];c=q.normalize(c,q.create());f=d[0];g=d[0];for(e=1;e<d.length;e++){var k=q.dot(d[e],c);k<q.dot(f,c)&&(f=d[e]);k>q.dot(g,c)&&(g=d[e])}c=[f,g];d=c[0];c=c[1];a.center=q.scale(q.add(d,
c,q.create()),.5,q.create());a.radius=q.length(q.subtract(c,d,q.create()))/2};a.create_bounding_capsule=function(a,b){var d=b.max_y,c=b.min_y,f=Math.max(0,d-c-2*a);return{radius:a,height:f,center:new Float32Array([0,(d+c)/2,0])}};a.create_bounding_cylinder=function(a,b){var d=b.max_y,c=b.min_y,f=Math.max(0,d-c);return{radius:a,height:f,center:new Float32Array([0,(d+c)/2,0])}};a.create_bounding_cone=function(a,b){var d=b.max_y,c=b.min_y,f=Math.max(0,d-c);return{radius:a,height:f,center:new Float32Array([0,
(d+c)/2,0])}};a.check_bb_intersection=function(a,b){return a.min_x>b.max_x||a.max_x<b.min_x?!1:a.min_y>b.max_y||a.max_y<b.min_y?!1:a.min_z>b.max_z||a.max_z<b.min_z?!1:!0};a.recalculate_mesh_boundings=function(a){for(var b=0,d=0,c=0,f=0,g=0,e=0,k=0,l=0,v=0;v<a.submeshes.length;v++){var m=a.submeshes[v];if(m.position.length){b=f=m.position[0];d=g=m.position[1];c=e=m.position[2];break}}for(v=0;v<a.submeshes.length;v++)for(var m=a.submeshes[v],m=m.position,u=0;u<m.length/3;u++)var q=m[3*u],E=m[3*u+1],
r=m[3*u+2],b=Math.max(q,b),d=Math.max(E,d),c=Math.max(r,c),f=Math.min(q,f),g=Math.min(E,g),e=Math.min(r,e),k=Math.max(Math.sqrt(q*q+E*E+r*r),k),l=Math.max(Math.sqrt(q*q+r*r),l);a.b4w_bounding_box.max_x=b;a.b4w_bounding_box.min_x=f;a.b4w_bounding_box.max_y=d;a.b4w_bounding_box.min_y=g;a.b4w_bounding_box.max_z=c;a.b4w_bounding_box.min_z=e;a.b4w_bounding_box_source.max_x=b;a.b4w_bounding_box_source.min_x=f;a.b4w_bounding_box_source.max_y=d;a.b4w_bounding_box_source.min_y=g;a.b4w_bounding_box_source.max_z=
c;a.b4w_bounding_box_source.min_z=e;a.b4w_bounding_sphere_radius=k;a.b4w_bounding_cylinder_radius=l};a.get_frustum_mec=function(b){var d=b.subarray(0,3),c=b.subarray(6,9),r=b.subarray(12,15),p=b.subarray(18,21);b=q.subtract(c,d,g);q.normalize(b,b);var D=l.get_plane_normal(d,c,r,C),D=q.cross(D,b,D);q.normalize(D,D);var e=q.create(),z=q.create();q.subtract(c,d,f);z[0]=q.dot(f,b);z[1]=q.dot(f,D);c=q.create();q.subtract(r,d,f);c[0]=q.dot(f,b);c[1]=q.dot(f,D);r=q.create();q.subtract(p,d,f);r[0]=q.dot(f,
b);r[1]=q.dot(f,D);p=a.zero_bounding_sphere();r=[e,z,c,r];e=k(p,r[0],r[1]);for(p=2;p<r.length;p++)if(q.distance(e.center,r[p])>e.radius){for(var y=e,e=r,z=r[p],c=p-1,y=k(y,z,e[0]),v=1;v<=c;v++)if(q.distance(y.center,e[v])>y.radius){for(var m=y,y=e,u=z,K=e[v],E=v-1,m=k(m,u,K),M=0;M<=E;M++)if(q.distance(m.center,y[M])>m.radius){var J=u,O=K,G=y[M],x=q.subtract(O,G,f),x=q.squaredLength(x),H=q.subtract(J,G,f),P=q.squaredLength(H),H=q.subtract(J,O,f),I=q.squaredLength(H),H=x*(P+I-x),aa=P*(I+x-P),x=I*(x+
P-I),P=H+aa+x;q.copy(J,m.center);q.scale(m.center,H/P,m.center);q.scaleAndAdd(m.center,O,aa/P,m.center);q.scaleAndAdd(m.center,G,x/P,m.center);m.radius=q.distance(m.center,J)}y=m}e=y}p=e;b=q.scale(b,p.center[0],f);q.scaleAndAdd(b,D,p.center[1],b);q.add(b,d,p.center);return p}};b4w.module.__compat=function(a,p){function t(a){return-1<navigator.userAgent.indexOf(a)?!0:!1}function c(){return navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i)}function b(){return!window.ActiveXObject&&"ActiveXObject"in window}var k=p("__config"),d=p("__extensions"),l=p("__print");
p("__util");var q="R600;RV610;RV630;RV620;RV635;RV670;RS780;RS880;RV770;RV730;RV710;RV740;CEDAR;REDWOOD;JUNIPER;CYPRESS;PALM (Wrestler/Ontario);SUMO (Llano);SUMO2 (Llano);ARUBA (Trinity/Richland);BARTS;TURKS;CAICOS;CAYMAN".split(";"),r=k.animation,g=k.defaults,C=k.context,f=k.scenes,h=k.sfx,n=k.physics;a.detect_tegra_invalid_enum_issue=function(a){a.getError()==a.INVALID_ENUM&&l.warn("Possible Tegra invalid enum issue detected, ignoring")};a.set_hardware_defaults=function(a){g.max_vertex_uniform_vectors=
a.getParameter(a.MAX_VERTEX_UNIFORM_VECTORS);g.max_texture_size=a.getParameter(a.MAX_TEXTURE_SIZE);g.max_cube_map_size=a.getParameter(a.MAX_CUBE_MAP_TEXTURE_SIZE);g.msaa_samples=g.webgl2?Math.min(g.msaa_samples,a.getParameter(a.MAX_SAMPLES)):1;var k=Boolean(d.get_depth_texture());t("Firefox/28.0")&&(t("Linux")||t("Macintosh"))&&(l.warn("Firefox 28 detected, applying depth hack"),k=!1);t("Windows Phone")||(t("iPad")||t("iPhone")?(l.warn("iOS detected, applying alpha hack, applying vertex animation mix normals hack, applying ios depth hack and disable smaa. Disable ssao for performance. Disable video textures. Initialize WebAudio context with empty sound."),
C.alpha||(g.background_color[3]=1),g.vert_anim_mix_normals_hack=!0,g.smaa=!1,g.ssao=!1,g.precision="highp",g.init_wa_context_hack=!0,g.ios_depth_hack=!0,f.cubemap_tex_size=256):t("Mac OS X")&&t("Safari")&&!t("Chrome")&&(l.warn("OS X / Safari detected, force to wait complete loading. Applying playback rate hack for video textures. Applying canvas alpha hack."),g.safari_canvas_alpha_hack=!0,h.audio_loading_hack=!0,h.clamp_playback_rate_hack=!0));t("Windows")&&(t("Chrome/40")||t("Firefox/33")||t("Firefox/34")||
t("Firefox/35")||t("Firefox/36"))&&(l.warn("Windows/Chrome40 or Firefox33-36 detected. Applying clear procedural skydome hack."),g.clear_procedural_sky_hack=!0);t("Mac OS X")&&(g.mac_os_shadow_hack=!0,l.warn("OS X detected, applying shadows hack."));c()&&(l.warn("Mobile detected, applying various hacks for video textures."),g.is_mobile_device=!0,t("iPad")||t("iPhone")||t("Windows Phone")||(l.warn("Mobile (not iOS) detected, disable playback rate for video textures."),h.disable_playback_rate_hack=
!0));(t("Firefox/35.0")||t("Firefox/36.0"))&&t("Windows")&&(l.warn("Windows/Firefox 35/36 detected, applying shadows slink hack"),g.firefox_shadows_slink_hack=!0);if(t("iPhone")||b()||t("Edge"))l.warn("iPhone, IE11 or Edge detected. Enable sequential video fallback for video textures."),g.seq_video_fallback=!0;10>a.getParameter(a.MAX_VARYING_VECTORS)&&(l.warn("Not enough varyings, disable shadows on blend objects"),g.disable_blend_shadows_hack=!0);t("Windows Phone")&&(l.warn("Windows Phone detected. Disable wireframe mode, glow materials, ssao, smaa, shadows, reflections, refractions."),
g.wireframe_debug=!1,g.precision="highp",g.glow_materials=!1,g.ssao=!1,g.smaa=!1,g.shadows=!1,g.reflections=!1,g.refractions=!1,g.quality_aa_method=!1);t("Firefox")&&g.is_mobile_device&&(l.warn("Mobile Firefox detected, applying depth hack, disable workers."),k=n.use_workers=!1);t("Firefox")&&"HMD"==g.stereo&&(l.warn("Firefox detected, using custom distortion correction."),g.use_browser_distortion_cor=!1);var p=d.get_renderer_info();if(p){var D=a.getParameter(p.UNMASKED_VENDOR_WEBGL),p=a.getParameter(p.UNMASKED_RENDERER_WEBGL),
e=/\b4\d{2}\b/;t("Macintosh")&&-1<p.indexOf("Intel HD Graphics 3000")&&(l.warn("OS X / Intel HD 3000 detected, applying depth hack"),k=!1);-1<D.indexOf("ARM")&&e.test(p)&&(l.warn("ARM Mali-400 series detected, applying depth and frames blending hacks"),k=!1,r.frames_blending_hack=!0);-1<D.indexOf("ARM")&&-1<p.indexOf("Mali-T604")&&(l.warn('ARM Mali-T604 detected, set "highp" precision and disable shadows.'),g.precision="highp",g.shadows=!1);-1<D.indexOf("ARM")&&-1<p.indexOf("Mali-T760")&&(l.warn('ARM Mali-T760 detected, set "highp" precision and disable SSAO. Applying clear depth hack.'),
g.clear_depth_hack=!0,g.precision="highp",g.ssao=!1,g.amd_skinning_hack=!0);-1<D.indexOf("Qualcomm")&&-1<p.indexOf("Adreno")&&(l.warn("Qualcomm Adreno detected, applying shader constants hack."),g.shader_constants_hack=!0,-1<p.indexOf("305")&&(l.warn('Qualcomm Adreno305 detected, set "highp" precision.'),g.precision="highp"),-1<p.indexOf("330")&&(l.warn('Qualcomm Adreno330 detected, set "highp" precision.'),g.precision="highp"),-1<p.indexOf("420")&&(l.warn("Qualcomm Adreno420 detected, setting max cubemap size to 4096, setting max texture size to 4096."),
g.max_texture_size=4096,g.max_cube_map_size=4096));-1<D.indexOf("NVIDIA")&&-1<p.indexOf("Tegra 3")&&(l.warn("NVIDIA Tegra 3 detected, force low quality for B4W_LEVELS_OF_QUALITY nodes."),g.force_low_quality_nodes=!0);t("Windows")&&t("Chrome")&&!t("Edge")&&(p.match(/NVIDIA GeForce 8..0/)||p.match(/NVIDIA GeForce 9..0/)||p.match(/NVIDIA GeForce( (G|GT|GTS|GTX))? 2../))&&(l.warn("Chrome / Windows / NVIDIA GeForce 8/9/200 series detected, setting max cubemap size to 256, use canvas for resizing."),g.max_cube_map_size=
256,g.resize_cubemap_canvas_hack=!0);for(var e="",z=0;z<q.length;z++)if(-1<p.indexOf(q[z])){e=q[z];break}e&&(l.warn("Architecture "+e+" detected. Blending between frames and shadows on blend objects will be disabled. Applying clear depth hack."),g.clear_depth_hack=!0,g.amd_skinning_hack=!0,g.disable_blend_shadows_hack=!0);t("Linux")&&-1<D.indexOf("nouveau")&&(l.warn("Nouveau driver detected. Applying clear depth hack"),g.clear_depth_hack=!0);t("Windows")&&t("Chrome")&&(p.match(/GeForce (GT|GTX) 5.(0|5)/)||
p.match(/GeForce (GT|GTX) 6.(0|5)/))&&(l.warn("Windows / Chrome / NVIDIA GeForce 500/600 series detected, applying clear depth hack"),g.clear_depth_hack=!0)}0==a.getParameter(a.MAX_VERTEX_TEXTURE_IMAGE_UNITS)&&(l.warn("Vertex textures are not allowed. Disabling vertex textures"),g.allow_vertex_textures=!1);k||(g.foam=!1,g.parallax=!1,g.dynamic_grass=!1,g.water_dynamic=!1,g.shore_smoothing=!1,g.shore_distance=!1,g.smaa=!1);g.use_dds=Boolean(d.get_s3tc());g.depth_tex_available=k;k=a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,
a.HIGH_FLOAT);a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,a.MEDIUM_FLOAT);0===k.precision&&(g.precision="mediump");b()&&(l.warn("IE11 detected. Set sky cubemap texture size to 512 (power of two)."),f.cubemap_tex_size=512);if(b()&&t("Touch")||t("Edge"))l.warn("IE11 and touchscreen or Edge detected. Behaviour of the mouse move sensor will be changed."),g.ie11_edge_touchscreen_hack=!0;128>=a.getParameter(a.MAX_FRAGMENT_UNIFORM_VECTORS)&&(l.warn("Not enough fragment uniforms, force low quality for B4W_LEVELS_OF_QUALITY nodes."),
g.force_low_quality_nodes=!0);t("Chrome")&&!t("Edge")&&(l.log("Chrome detected. Some of deprecated functions related to the Doppler effect won't be called."),g.cors_chrome_hack=!0);if(t("Chrome")&&!t("Edge")||t("Firefox"))g.disable_doppler_hack=!0;if(b()||t("iPad"))l.warn("iPad or Internet Explorer detected. Applying alpha clip hack."),g.alpha_clip_filtering_hack=!0;c()&&t("Firefox")&&(l.log("Mobile firefox detected. Applying autoplay media hack."),g.mobile_firefox_media_hack=!0);t("Edge")&&(l.warn("Microsoft Edge detected, set up new minimal texture size."),
g.edge_min_tex_size_hack=!0)};a.check_user_agent=t;a.detect_mobile=c;a.apply_context_alpha_hack=function(){t("Firefox/35.0")&&t("Windows")&&(l.warn("Windows/Firefox 35 detected, forcing context's alpha"),k.context.alpha=!0)};a.is_ie11=b};b4w.module.__constraints=function(a,p){function t(a){var b={};b.type=a;return b}function c(a,m){a.constraint&&a.constraint.obj_parent&&b(a.constraint.obj_parent,a);if(m.obj_parent){var d=m.obj_parent;if(-1==d.cons_descends.indexOf(a))d.cons_descends.push(a);else throw"Descendant object override is forbidden";}a.constraint=m}function b(a,b){var m=a.cons_descends.indexOf(b);if(-1!=m)a.cons_descends.splice(m,1);else throw"No descendant object";}function k(a,b,d){switch(b.type){case 1:var x=n.get_quat_view(a.render.world_tsr),
c=b.obj_parent.render.world_tsr;d=n.get_quat_view(b.obj_parent.render.world_tsr);b.rotation_offset?(h.copy(b.rotation_offset,x),h.multiply(d,x,x)):h.copy(d,x);var f=n.transform_vec3(b.offset,c,e);n.set_trans(f,a.render.world_tsr);f=n.get_scale(b.obj_parent.render.world_tsr);n.set_scale(b.scale_offset*f,a.render.world_tsr);break;case 9:f=n.get_trans_view(a.render.world_tsr);x=n.get_quat_view(a.render.world_tsr);c=b.obj_parent.render.world_tsr;d=n.get_quat_view(b.obj_parent.render.world_tsr);h.multiply(h.invert(b.parent_prev_rotation,
b.parent_prev_rotation),x,x);h.multiply(d,x,x);n.transform_vec3(b.offset,c,f);h.copy(d,b.parent_prev_rotation);break;case 10:f=n.get_trans_view(a.render.world_tsr);x=n.get_quat_view(a.render.world_tsr);c=b.obj_parent.render.world_tsr;d=n.get_quat_view(b.obj_parent.render.world_tsr);h.multiply(h.invert(b.parent_prev_rotation,b.parent_prev_rotation),x,x);h.multiply(d,x,x);n.transform_vec3(b.offset,c,f);h.copy(d,b.parent_prev_rotation);f=n.get_quat_view(a.render.world_tsr);x=n.get_quat_view(b.obj_parent.render.world_tsr);
x=h.multiply(x,b.rotation_offset,m);x=g.get_camera_angles_from_quat(x,F);d=g.get_camera_angles_from_quat(f,D);f=A.calc_returning_angle(d[0],x[0]+b.clamp_right,x[0]+b.clamp_left);x=A.calc_returning_angle(d[1],x[1]+b.clamp_down,x[1]+b.clamp_up);g.rotate_eye_camera(a,f,x);break;case 13:var f=n.get_trans_view(a.render.world_tsr),x=n.get_quat_view(a.render.world_tsr),c=b.obj_parent.render.world_tsr,I=n.get_trans_view(c),v=b.softness,k=e,z=m;n.transform_vec3(b.offset,c,k);A.smooth_v(k,f,d,v,f);c=e;B.sub(I,
f,c);B.normalize(c,c);var w=x,f=u,I=f.subarray(0,3),k=f.subarray(3,6),y=f.subarray(6,9);B.copy(c,k);B.negate(k,k);B.normalize(k,k);Boolean(.999999<Math.abs(B.dot(c,A.AXIS_Y)))?(c=C.fromQuat(h.normalize(w,z),K),B.copy(c.subarray(0,3),I)):B.cross(A.AXIS_Y,k,I);B.normalize(I,I);B.cross(I,k,y);B.normalize(y,y);h.fromMat3(f,z);h.normalize(z,z);A.smooth_q(z,x,d,.16*v,x);break;case 2:x=n.get_quat_view(a.render.world_tsr);d=E;r.get_bone_tsr(b.obj_parent,b.bone_name,!0,!1,d);n.multiply(b.obj_parent.render.world_tsr,
d,d);x[0]=d[4];x[1]=d[5];x[2]=d[6];x[3]=d[7];b.rotation_offset&&(h.copy(b.rotation_offset,x),h.multiply(x,b.rotation_offset,x));n.set_scale(b.scale_offset*d[3],a.render.world_tsr);f=n.get_trans_view(a.render.world_tsr);n.transform_vec3(b.offset,d,f);break;case 3:f=n.get_trans_view(a.render.world_tsr);x=n.get_quat_view(a.render.world_tsr);d=n.get_trans_view(b.obj_parent.render.world_tsr);l(f,x,d);break;case 4:f=n.get_trans_view(a.render.world_tsr);x=n.get_quat_view(a.render.world_tsr);d=b.target;l(f,
x,d);break;case 5:f=n.get_trans_view(a.render.world_tsr);x=n.get_quat_view(a.render.world_tsr);d=n.get_trans_view(b.obj_parent.render.world_tsr);l(f,x,d);x=B.dist(f,d);if(x=x>b.dist_max?x-b.dist_max:x<b.dist_min?x-b.dist_min:0)B.sub(d,f,e),B.normalize(e,e),B.scale(e,x,e),B.add(f,e,f);break;case 6:f=n.get_trans_view(a.render.world_tsr);x=n.get_quat_view(a.render.world_tsr);d=b.target;l(f,x,d);x=B.dist(f,d);if(x=x>b.dist_max?x-b.dist_max:x<b.dist_min?x-b.dist_min:0)B.sub(d,f,e),B.normalize(e,e),B.scale(e,
x,e),B.add(f,e,f);break;case 7:c=b.obj_parent.render.world_tsr;f=n.get_trans_view(a.render.world_tsr);n.transform_vec3(b.offset,c,f);break;case 8:I=n.get_trans_view(b.obj_parent.render.world_tsr);f=n.get_trans_view(a.render.world_tsr);B.add(I,b.offset,f);break;case 14:x=n.get_quat_view(a.render.world_tsr);c=b.obj_parent.render.world_tsr;d=n.get_quat_view(b.obj_parent.render.world_tsr);b.rotation_offset?(h.copy(b.rotation_offset,x),h.multiply(d,x,x)):h.copy(d,x);f=n.get_trans_view(a.render.world_tsr);
n.transform_vec3(b.offset,c,f);break;case 11:n.multiply(b.obj_parent.render.world_tsr,b.tsr_offset,a.render.world_tsr);break;case 12:f=b.tsr_offset;d=E;r.get_bone_tsr(b.obj_parent,b.bone_name,!0,!1,d);n.multiply(b.obj_parent.render.world_tsr,d,d);n.multiply(d,f,a.render.world_tsr);break;case 15:x=b.obj_parent,d=g.get_first_cam(x),f=n.get_trans_view(a.render.world_tsr),c=g.get_edge(d,"LEFT"),I=g.get_edge(d,"RIGHT"),v=g.get_edge(d,"TOP"),z=g.get_edge(d,"BOTTOM"),k="heights"==b.hor_units?v-z:I-c,b.left_edge?
(c=g.get_edge(d,"LEFT"),f[0]=c+k*b.left_right_dist):(I=g.get_edge(d,"RIGHT"),f[0]=I-k*b.left_right_dist),c="heights"==b.vert_units?v-z:I-c,f[2]=b.top_edge?-(v-c*b.top_bottom_dist):-(z+c*b.top_bottom_dist),g.is_ortho(d)?f[1]=-b.distance:(f[1]=-1,B.normalize(f,f),d=b.distance/Math.abs(f[1]),B.scale(f,d,f)),n.transform_dir_vec3(f,x.render.world_tsr,f),d=n.get_trans_view(x.render.world_tsr),B.add(d,f,f),f=n.get_quat_view(a.render.world_tsr),x=n.get_quat_view(x.render.world_tsr),b.rotation_offset?(h.copy(b.rotation_offset,
f),h.multiply(x,f,f)):h.copy(x,f)}"CAMERA"==a.render.type&&(f=A.AXIS_Y,10==b.type&&(d=n.get_quat_view(b.obj_parent.render.world_tsr),f=B.transformQuat(f,d,M)),g.update_camera_upside_down(a),q(a,f))}function d(a,b){switch(b.type){case 1:var d=b.target.render.world_tsr,x=E;n.invert(a.render.world_tsr,x);n.multiply(x,d,x);r.set_bone_tsr(a,b.bone_name,x,!1)}a.need_update_transform=!0}function l(a,b,d){var x=e;A.quat_to_dir(b,A.AXIS_MY,x);B.normalize(x,x);var m=z;B.subtract(d,a,m);B.normalize(m,m);a=A.rotation_to_stable(x,
m,v);h.multiply(a,b,b);h.normalize(b,b)}function q(a,b,d){var x=a.render,c=n.get_quat_view(x.world_tsr),f=A.quat_to_dir(c,A.AXIS_Y,e);B.normalize(f,f);if(.999999<Math.abs(B.dot(b,f)))f=h.identity(m);else{var u=B.cross(b,f,z);B.normalize(u,u);x.move_style==g.MS_TARGET_CONTROLS?x.target_cam_upside_down&&B.negate(u,u):(x=A.quat_to_dir(c,A.AXIS_Z,y),0<B.dot(x,b)&&B.negate(u,u));x=A.quat_to_dir(c,A.AXIS_X,y);B.normalize(x,x);var v=A.clamp(B.dot(x,u),-1,1);-.999999>=v?(u=Math.acos(v),f=h.setAxisAngle(f,
u,m)):f=h.rotationTo(x,u,m);h.normalize(f,f)}h.multiply(f,c,c);d&&(d=A.quat_to_dir(c,A.AXIS_MZ,e),0>B.dot(b,d)&&h.rotateY(c,Math.PI,c));g.update_camera_upside_down(a)}var r=p("__armature"),g=p("__camera"),C=p("__mat3"),f=p("__print"),h=p("__quat"),n=p("__tsr"),A=p("__util"),B=p("__vec3");a.CONS_TYPE_STIFF_OBJ=1;a.CONS_TYPE_STIFF_BONE=2;a.CONS_TYPE_TRACK_OBJ=3;a.CONS_TYPE_TRACK_POINT=4;a.CONS_TYPE_FOLLOW_OBJ=5;a.CONS_TYPE_FOLLOW_POINT=6;a.CONS_TYPE_STIFF_TRANS_OBJ=7;a.CONS_TYPE_COPY_TRANS_OBJ=8;a.CONS_TYPE_SEMI_STIFF_OBJ=
9;a.CONS_TYPE_SEMI_STIFF_CAM_OBJ=10;a.CONS_TYPE_CHILD_OF=11;a.CONS_TYPE_CHILD_OF_BONE=12;a.CONS_TYPE_SEMI_SOFT_CAM_OBJ=13;a.CONS_TYPE_STIFF_TRANS_ROT_OBJ=14;a.CONS_TYPE_STIFF_VIEWPORT=15;a.BONE_CONS_TYPE_STIFF_OBJ=1;var F=new Float32Array(2),D=new Float32Array(2),e=new Float32Array(3),z=new Float32Array(3),y=new Float32Array(3),v=new Float32Array(4),m=new Float32Array(4),u=new Float32Array(9),K=new Float32Array(9),E=n.create(),M=new Float32Array(3);a.append_stiff_obj=function(a,b,d,x,m){var e=t(1);
e.obj_parent=b;e.offset=new Float32Array(d);e.rotation_offset=x?new Float32Array(x):null;e.scale_offset=m;c(a,e);k(a,e,0)};a.append_stiff_bone=function(a,b,d,x,m,e){var f=t(2);f.obj_parent=b;f.bone_name=d;f.offset=new Float32Array(x);f.rotation_offset=m?new Float32Array(m):null;f.scale_offset=e;c(a,f);k(a,f,0)};a.append_semi_stiff_obj=function(a,b,d,x){var m=t(9),e=n.get_quat_view(a.render.world_tsr),f=n.get_quat_view(b.render.world_tsr);m.obj_parent=b;m.offset=new Float32Array(d);m.parent_prev_rotation=
new Float32Array(f);x&&(h.copy(x,e),h.multiply(f,e,e));c(a,m);k(a,m,0)};a.append_semi_stiff_cam_obj=function(a,b,d,x,m,e,f,u){var g=t(10),v=n.get_quat_view(a.render.world_tsr),w=n.get_quat_view(b.render.world_tsr);g.obj_parent=b;g.offset=new Float32Array(d);g.parent_prev_rotation=new Float32Array(w);g.clamp_left=A.angle_wrap_0_2pi(m);g.clamp_right=A.angle_wrap_0_2pi(e);g.clamp_up=A.angle_wrap_periodic(f,-Math.PI,Math.PI);g.clamp_down=A.angle_wrap_periodic(u,-Math.PI,Math.PI);x?(g.rotation_offset=
new Float32Array(x),h.copy(x,v),h.multiply(w,v,v)):g.rotation_offset=h.create();c(a,g);k(a,g,0)};a.append_semi_soft_cam_obj=function(a,b,d,x){var m=t(13);m.obj_parent=b;m.offset=new Float32Array(d);m.softness=x;c(a,m);k(a,m,0)};a.append_stiff_trans_rot_obj=function(a,b,d,x,m){var e=t(14);e.obj_parent=b;e.offset=new Float32Array(d);e.scale_offset=m||1;e.rotation_offset=x?new Float32Array(x):null;c(a,e);k(a,e,0)};a.remove_parent_descendant=b;a.append_track_obj=function(a,b){var d=t(3);d.obj_parent=
b;c(a,d);k(a,d,0)};a.append_track_point=function(a,b){var d=t(4);d.target=new Float32Array(b);c(a,d);k(a,d,0)};a.append_follow_obj=function(a,b,d,x){var m=t(5);m.obj_parent=b;m.dist_min=d;m.dist_max=x;c(a,m);k(a,m,0)};a.append_follow_point=function(a,b,d,x){var m=t(6);m.target=new Float32Array(b);m.dist_min=d;m.dist_max=x;c(a,m);k(a,m,0)};a.append_stiff_trans_obj=function(a,b,d){var m=t(7);m.obj_parent=b;m.offset=new Float32Array(d);c(a,m);k(a,m,0)};a.append_copy_trans_obj=function(a,b,d){var m=t(8);
m.obj_parent=b;m.offset=new Float32Array(d);c(a,m);k(a,m,0)};a.append_child_of=function(a,b,d){var m=t(11);m.obj_parent=b;m.tsr_offset=new Float32Array(d);c(a,m);k(a,m,0)};a.append_child_of_bone=function(a,b,d,m){var e=t(12);e.obj_parent=b;e.bone_name=d;e.tsr_offset=new Float32Array(m);c(a,e);k(a,e,0)};a.append_stiff_viewport=function(a,b,d){var m=t(15);m.obj_parent=b;if(A.isdef(d.left))m.left_edge=!0,m.left_right_dist=d.left;else if(A.isdef(d.right))m.left_edge=!1,m.left_right_dist=d.right;else{f.error("append_stiff_viewport: Wrong positioning params");
return}if(A.isdef(d.top))m.top_edge=!0,m.top_bottom_dist=d.top;else if(A.isdef(d.bottom))m.top_edge=!1,m.top_bottom_dist=d.bottom;else{f.error("append_stiff_viewport: Wrong positioning params");return}A.isdef(d.distance)?(m.distance=d.distance,A.isdef(d.rotation)?m.rotation_offset=new Float32Array(d.rotation):m.rotation_offset=null,A.isdef(d.hor_units)?m.hor_units=d.hor_units:m.hor_units="widths",A.isdef(d.vert_units)?m.vert_units=d.vert_units:m.vert_units="heights",c(a,m),k(a,m,0)):f.error("append_stiff_viewport: Wrong positioning params")};
a.update_constraint=function(a,b){a.constraint&&k(a,a.constraint,b)};a.append_stiff_bone_to_obj=function(a,b,m,x,e,c){var f=t(1);f.bone_name=m;f.target=b;f.offset=new Float32Array(x);f.rotation_offset=e?new Float32Array(e):null;f.scale_offset=c;b=f.target;m=f.bone_name;x=a.render.bone_pointers[m];e=b.cons_armat_bone_descends;for(c=0;c<e;c++){var h=e[c];if(h[0]==a&&h[1]==m){e.splice(c,1);break}}b.cons_armat_bone_descends.push([a,m]);x.constraint=f;d(a,f)};a.update_bone_constraint=function(a,b){var m=
a.render.bone_pointers[b];m.constraint&&d(a,m.constraint)};a.rotate_to=l;a.correct_up=q;a.check_constraint=function(a){return a.constraint?!0:!1};a.remove=function(a){a.constraint.obj_parent&&b(a.constraint.obj_parent,a);a.constraint=null};a.get_type=function(a){return a.constraint?a.constraint.type:null};a.has_child_of=function(a){a=a.constraint;return!a||11!=a.type&&12!=a.type?!1:!0};a.get_child_of_parent_tsr=function(a){if((a=a.constraint)&&11==a.type)return a.obj_parent.render.world_tsr;if(a&&
12==a.type){var b=E;r.get_bone_tsr(a.obj_parent,a.bone_name,!0,!1,b);n.multiply(a.obj_parent.render.world_tsr,b,b);return b}return null};a.get_child_of_offset=function(a){a=a.constraint;return!a||11!=a.type&&12!=a.type?null:a.tsr_offset}};b4w.module.__container=function(a,p){var t,c,b,k,d;function l(a,b){t=a;c=b}function q(){var a=z.getBoundingClientRect();l(a.left,a.top)}function r(){return e.allow_hidpi&&2<=window.devicePixelRatio?!0:!1}var g=p("__anchors"),C=p("__config"),f=p("__data"),h=p("__hud");p("__objects");var n=p("__print"),A=p("__scenes"),B=p("__time"),F=p("__transform"),D=p("__util"),e=C.defaults,z=null,y=null,v=null,m=!1;k=b=0;d=1;t=c=0;var u=null;a.DEFAULT_CANVAS_W=320;a.DEFAULT_CANVAS_H=240;a.setup_context=function(a){u=
a};a.get_canvas=function(){return z};a.get_canvas_hud=function(){return y};a.get_container=function(){return v};a.init=function(a,b){a&&a.parentNode?(z=a,y=b,v=a.parentNode):D.panic("canvas container is not available")};a.insert_to_container=function(a,b){b=b||"LAST";switch(b){case "FIRST":v.insertBefore(a,v.firstElementChild);break;case "JUST_BEFORE_CANVAS":v.insertBefore(a,z);break;case "JUST_AFTER_CANVAS":z.nextElementSibling?v.insertBefore(a,z.nextElementSibling):v.appendChild(a,z);break;case "LAST":v.appendChild(a,
z);break;default:n.error(b+" invalid stack order")}};a.get_viewport_width=function(){return b};a.get_viewport_height=function(){return k};a.set_canvas_offsets=l;a.update_canvas_offsets=q;a.setup_viewport_dim=function(a,m,e){b=a;k=m;d=e;q()};a.force_offsets_updating=function(){m=!0};a.client_to_canvas_coords=function(a,b,d){d||(d=new Float32Array(2));var e=d;m&&(q(),m=!1);e[0]=a-t;a=d;m&&(q(),m=!1);a[1]=b-c;return d};a.canvas_to_viewport_coords=function(a,m,e,c){e||(e=new Float32Array(2));e[0]=a*d;
e[1]=m*d;c&&(a=c.width/b,e[0]*=a,e[1]*=a);return e};a.viewport_to_canvas_coords=function(a,m,e,c){e||(e=new Float32Array(2));e[0]=a/d;e[1]=m/d;c&&(a=c.width/b,e[0]/=a,e[1]/=a);return e};a.is_child=function(b){return b&&b.parentNode?b.parentNode==v?!0:a.is_child(b.parentNode):!1};a.is_hidpi=r;a.find_script=function(a){var b=document.getElementsByTagName("script");a=D.normpath_preserve_protocol(a);for(var d=0;d<b.length;d++)if(b[d].src==a)return b[d];return null};a.resize=function(b,d,m){if(!b||!d){b=
a.DEFAULT_CANVAS_W;d=a.DEFAULT_CANVAS_H;var c=v;c.style.width=a.DEFAULT_CANVAS_W+"px";c.style.height=a.DEFAULT_CANVAS_H+"px"}var c=z,k=y;!1!==m&&(c.style.width=b+"px",c.style.height=d+"px",k&&(k.style.width=b+"px",k.style.height=d+"px"));k&&(k.width=b,k.height=d,h.update_dim());if(navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i))e.canvas_resolution_factor=1;m=Math.floor(b*e.canvas_resolution_factor);d=Math.floor(d*e.canvas_resolution_factor);
r()&&(m*=window.devicePixelRatio,d*=window.devicePixelRatio);f.is_primary_loaded()&&(k=A.get_active()._render,m=Math.floor(m*k.resolution_factor),d=Math.floor(d*k.resolution_factor));c.width=m;c.height=d;if(m>u.drawingBufferWidth||d>u.drawingBufferHeight)n.warn("Canvas size exceeds platform limits, downscaling"),k=Math.min(u.drawingBufferWidth/m,u.drawingBufferHeight/d),m*=k,d*=k,c.width=m,c.height=d;A.setup_dim(m,d,m/b);A.check_active()&&F.update_transform(A.get_active()._camera);f.update_media_controls(c.width,
c.height);f.is_primary_loaded()&&(g.update(),A.update(B.get_timeline(),0),g.update_visibility())}};b4w.module.__controls=function(a,p){function t(a){return{type:a,value:0,payload:null,do_activation:!1,key:0,collision_id:"",calc_pos_norm:!1,collision_obj:null,collision_cb:function(){},col_imp_obj:null,col_imp_cb:function(){},source_object:null,from:new Float32Array(3),to:new Float32Array(3),is_binary_value:!1,ign_src_rot:!1,ray_test_id:0,ray_test_cb:function(){},axis:"",time_last:0,trans_last:new Float32Array(3),quat_last:new Float32Array(4),threshold:0,quat_temp:new Float32Array(4),avg_linear_vel:0,
avg_angular_vel:0,rotation_threshold:0,avg_vertical_vel:0,period:0,repeat:!1,auto_release:!1,gyro_gamma_new:0,gyro_beta_new:0,gyro_alpha_new:0,gyro_gamma_last:0,gyro_beta_last:0,gyro_alpha_last:0,callback:function(){}}}function c(a,b){a.value=Number(b)}function b(a){for(var b=a.sensors,d=a.sensor_values,m=0;m<b.length;m++)d[m]=b[m].value;return a.logic_fun(d)}function k(a,b){a=a||P;var e=a.sensor_manifolds;if(e){var x=a.sensor_manifolds_arr;if(b){var c=e[b];if(c){for(var f=c.sensors,h=0;h<f.length;h++){var u=
f[h],g;g=aa;var v=I.indexOf(u);g=-1<v?g[v]:[];1==g.length?(d(u),u=I.indexOf(u),-1<u?(I.splice(u,1),aa.splice(u,1)):J.panic("Sensors cache is corrupted")):1<g.length&&g.splice(g.indexOf(c,1))}delete e[b];h=x.indexOf(c);-1<h?x.splice(h,1):J.panic("Incorrect manifolds array");Object.getOwnPropertyNames(e).length||(e=H.indexOf(a),-1<e?H.splice(e,1):m.error("Wrong object"))}}else{x=[];for(b in e)x.push(b);for(h=0;h<x.length;h++)k(a,x[h])}ba=!0}}function d(a){switch(a.type){case 80:u.remove_collision_test(a.collision_obj,
a.collision_id,a.collision_cb);a.do_activation=!0;break;case 90:u.clear_collision_impulse_test(a.col_imp_obj);a.do_activation=!0;break;case 100:u.remove_ray_test(a.ray_test_id);a.do_activation=!0;break;case 130:a.do_activation=!0}}function l(a){for(var b=0;b<I.length;b++){var d=I[b];20==d.type&&a.keyCode==d.key&&c(d,1)}sa&&a.preventDefault();ra&&ra(a)}function q(a){for(var b=0;b<I.length;b++){var d=I[b];20==d.type&&0==a.keyCode&&16==d.key&&c(d,0);20==d.type&&a.keyCode==d.key&&c(d,0)}sa&&a.preventDefault();
ra&&ra(a)}function r(a){var b=!1,d=null;ea=!0;fa=a.clientX;da=a.clientY;T=a.clientX;w=a.clientY;for(var m=0;m<I.length;m++){var e=I[m];50==e.type&&(c(e,1),e.payload=a.which);160==e.type&&(b||(b=y.client_to_canvas_coords(a.clientX,a.clientY,ga),d=v.pick_object(b[0],b[1]),b=!0),e.value=d==e.source_object?1:0)}ca&&a.preventDefault();qa&&qa(a)}function g(a){for(var b=0;b<I.length;b++){var d=I[b];50==d.type&&c(d,0);160==d.type&&d.auto_release&&(d.value=0)}ea=!1;ca&&!xa&&a.preventDefault();qa&&qa(a)}function C(a){var b=
a.clientX,d=a.clientY;T=b;w=d;if(!x.ie11_edge_touchscreen_hack||ea)for(var m=b-fa,e=d-da,f=Math.sqrt(m*m+e*e),h=0;h<I.length;h++){var u=I[h];if(40===u.type)switch(u.axis){case "X":c(u,m);u.payload=b;break;case "Y":c(u,e);u.payload=d;break;case "XY":c(u,f),u.payload[0]=b,u.payload[1]=d}}ca&&!xa&&a.preventDefault();qa&&qa(a)}function f(a){y.is_child(a.relatedTarget)||g(a)}function h(a){var b=a.wheelDelta||-40*a.detail,b=b*G.mouse_wheel_notch_multiplier;U+=b;for(b=0;b<I.length;b++){var d=I[b];30===d.type&&
c(d,U)}Ga&&a.preventDefault();ha&&ha(a)}function n(a){var b=a.targetTouches;if(1==b.length){for(var d=b[0],b=d.clientX,d=d.clientY,m=!1,x=null,c=0;c<I.length;c++){var f=I[c];160==f.type&&(m||(m=y.client_to_canvas_coords(b,d,ga),x=v.pick_object(m[0],m[1]),m=!0),f.value=x==f.source_object)}X[0]=b;X[1]=-1;la[0]=d;la[1]=-1}else 1<b.length&&(na=N=D(b),X[0]=b[0].clientX,X[1]=b[1].clientX,la[0]=b[0].clientY,la[1]=b[1].clientY,Z=e(b));V.set(X);S.set(la);ma&&ma(a)}function A(b){var d=b.targetTouches;if(0!==
d.length){if(1===d.length){V[0]=d[0].clientX;V[1]=-1;S[0]=d[0].clientY;S[1]=-1;var d=V[0]-X[0],m=S[0]-la[0],x=Math.sqrt(d*d+m*m);if(-1!=X[1]&&-1!=la[1]){var f=V[0]-X[1],h=S[0]-la[1],u=Math.sqrt(f*f+h*h);u<x&&(d=f,m=h,x=u)}for(u=0;u<I.length;u++){var g=I[u];if(60===g.type)switch(g.payload=a.PL_SINGLE_TOUCH_MOVE,g.axis){case "X":c(g,d);break;case "Y":c(g,m);break;case "XY":c(g,x)}}}else if(1<d.length){V[0]=d[0].clientX;V[1]=d[1].clientX;S[0]=d[0].clientY;S[1]=d[1].clientY;na=D(d);x=na-N;f=ga;f[0]=(V[0]+
V[1])/2;f[1]=(S[0]+S[1])/2;h=oa;h[0]=(X[0]+X[1])/2;h[1]=(la[0]+la[1])/2;var v,m=f[0]-h[0],u=f[1]-h[1];v=Math.sqrt(m*m+u*u);for(var w=e(d),u=0;u<I.length;u++)switch(g=I[u],g.type){case 70:g.payload=a.PL_MULTITOUCH_MOVE_ZOOM;c(g,x);break;case 60:g.payload=a.PL_MULTITOUCH_MOVE_PAN;switch(g.axis){case "X":d=f[0]-h[0];c(g,d);break;case "Y":m=f[1]-h[1];c(g,m);break;case "XY":c(g,v)}break;case 75:g.payload=a.PL_MULTITOUCH_MOVE_ROTATE,c(g,w-Z)}}ka&&b.preventDefault();ma&&ma(b)}}function B(a){if(0==a.targetTouches.length)for(var b=
0;b<I.length;b++){var d=I[b];160==d.type&&d.auto_release&&c(d,0)}ma&&ma(a)}function F(a){for(var b=0;b<I.length;b++){var d=I[b];if(170==d.type||180==d.type)d.gyro_beta_new=a.beta,d.gyro_gamma_new=a.gamma,d.gyro_alpha_new=a.alpha,d.value||(d.gyro_gamma_last=a.gamma,d.gyro_beta_last=a.beta,d.gyro_alpha_last=a.alpha,c(d,1))}}function D(a){var b=a[0],d=a[1];a=b.clientX-d.clientX;b=b.clientY-d.clientY;return Math.sqrt(a*a+b*b)}function e(a){var b=a[0];a=a[1];return Math.atan2(b.clientY-a.clientY,b.clientX-
a.clientX)}var z=p("__config"),y=p("__container"),v=p("__objects"),m=p("__print"),u=p("__physics"),K=p("__quat"),E=p("__time"),M=p("__tsr"),J=p("__util"),O=p("__vec3"),G=z.controls,x=z.defaults,H=[],P={},I=[],aa=[],U=0,T=0,w=0,fa=0,da=0,ea=!1,V=new Float32Array(2),S=new Float32Array(2),X=new Float32Array(2),la=new Float32Array(2),ga=new Float32Array(2),oa=new Float32Array(2),na=0,N=0,Z=0,ba=!1,Q=0,sa=!1,ca=!1,Ga=!1,ka=!1,xa=!1,ra=null,qa=null,ha=null,ma=null;a.CT_POSITIVE=10;a.CT_CONTINUOUS=20;a.CT_TRIGGER=
30;a.CT_SHOT=40;a.CT_LEVEL=50;a.CT_CHANGE=60;a.PL_SINGLE_TOUCH_MOVE=0;a.PL_MULTITOUCH_MOVE_ZOOM=1;a.PL_MULTITOUCH_MOVE_PAN=2;a.PL_MULTITOUCH_MOVE_ROTATE=3;a.update=function(d,m){for(var e=0;e<I.length;e++){var x=I[e],f=d,h=m;if(h)switch(x.type){case 110:var u=x.source_object,g=M.get_trans_view(u.render.world_tsr),u=M.get_quat_view(u.render.world_tsr),v=O.dist(x.trans_last,g),n=x.quat_temp;K.invert(x.quat_last,n);K.multiply(u,n,n);K.normalize(n,n);n=Math.abs(2*Math.acos(n[3]));v/=h;x.avg_linear_vel=
J.smooth(v,x.avg_linear_vel,h,.3);x.payload[0]=v;v=n/h;x.avg_angular_vel=J.smooth(v,x.avg_angular_vel,h,.3);x.payload[1]=v;x.avg_linear_vel>=x.threshold||x.avg_angular_vel>=x.rotation_threshold?c(x,1):c(x,0);O.copy(g,x.trans_last);K.copy(u,x.quat_last);x.time_last=f;break;case 120:u=x.source_object;g=M.get_trans_view(u.render.world_tsr);u=Math.abs(g[1]-x.trans_last[1])/h;x.avg_vertical_vel=J.smooth(u,x.avg_vertical_vel,h,.3);x.payload=u;x.avg_vertical_vel>=x.threshold?c(x,1):c(x,0);O.copy(g,x.trans_last);
x.time_last=f;break;case 130:!x.do_activation&&0<=x.period&&f-x.time_last>=x.period&&(c(x,1),x.repeat?x.time_last=f:x.period=-x.period);break;case 140:x.time_last||(x.time_last=f);c(x,f-x.time_last);x.time_last=f;break;case 150:c(x,f);break;case 170:x.payload[0]=Math.PI*(x.gyro_gamma_new-x.gyro_gamma_last)/180;x.payload[1]=Math.PI*(x.gyro_beta_new-x.gyro_beta_last)/180;x.payload[2]=Math.PI*(x.gyro_alpha_new-x.gyro_alpha_last)/180;x.gyro_gamma_last=x.gyro_gamma_new;x.gyro_beta_last=x.gyro_beta_new;
x.gyro_alpha_last=x.gyro_alpha_new;break;case 180:x.payload[0]=Math.PI*x.gyro_gamma_new/180;x.payload[1]=Math.PI*x.gyro_beta_new/180;x.payload[2]=Math.PI*x.gyro_alpha_new/180;break;case 190:c(x,x.callback())}}for(e=0;e<H.length;e++)for(h=H[e],x=h.sensor_manifolds_arr,f=0;f<x.length;f++)if(g=x[f],g.update_counter!=Q){g.update_counter=Q;n=g;u=0;switch(n.type){case a.CT_POSITIVE:u=(v=b(n))?1:0;break;case a.CT_CONTINUOUS:u=n.last_pulse;(v=b(n))?(u=1,n.last_pulse=1):1==u?(u=-1,n.last_pulse=-1):u=0;break;
case a.CT_TRIGGER:u=n.last_pulse;(v=b(n))&&-1==u?(u=1,n.last_pulse=1):v||1!=u?u=0:(u=-1,n.last_pulse=-1);break;case a.CT_SHOT:u=n.last_pulse;(v=b(n))&&-1==u?(u=1,n.last_pulse=1):v||1!=u?u=0:(u=0,n.last_pulse=-1);break;case a.CT_LEVEL:v=b(n);n.last_logic_result!=v?(u=1,n.last_logic_result=v):u=0;break;case a.CT_CHANGE:for(var v=n.sensors,n=n.last_sensor_values,k=0;k<v.length;k++){var l=v[k].value;u||l==n[k]||(u=1);n[k]=l}break;default:J.panic("Wrong sensor manifold type: "+n.type)}if(u&&(v=h==P?null:
h,ba=!1,g.callback(v,g.id,u,g.callback_param),ba)){e=-1;break}}for(e=0;e<H.length;e++)for(h=H[e],x=h.sensor_manifolds_arr,f=0;f<x.length;f++)for(g=x[f],h=g.sensors,g=0;g<h.length;g++)switch(u=h[g],u.type){case 30:c(u,0);break;case 40:c(u,0);break;case 60:c(u,0);break;case 70:c(u,0);break;case 75:c(u,0);break;case 130:c(u,0)}U=0;fa=T;da=w;X.set(V);la.set(S);N=na;Q++};a.create_custom_sensor=function(a){var b=t(10);c(b,a);return b};a.create_keyboard_sensor=function(a){var b=t(20);b.key=a;return b};a.create_collision_sensor=
function(a,b,d){if(!a||!u.obj_has_physics(a))return m.error("Wrong collision object"),null;var x=t(80);x.collision_obj=a;x.collision_id=b;x.calc_pos_norm=d;x.payload={coll_obj:null,coll_pos:d?new Float32Array(3):null,coll_norm:d?new Float32Array(3):null,coll_dist:0};x.collision_cb=function(a,b,d,m,e){c(x,a);a=x.payload;a.coll_obj=b;x.calc_pos_norm&&(a.coll_pos.set(d),a.coll_norm.set(m),a.coll_dist=e)};x.do_activation=!0;return x};a.create_collision_impulse_sensor=function(a){if(!a||!a.physics)return m.error("Wrong collision impulse object"),
null;var b=t(90);b.col_imp_obj=a;b.col_imp_cb=function(a){c(b,a)};b.do_activation=!0;return b};a.create_ray_sensor=function(a,b,d,m,x,e,f){var u=t(100);u.source_object=a;u.from=b;u.to=d;u.collision_id=m;u.is_binary_value=x;u.calc_pos_norm=e;u.ign_src_rot=f;u.payload={hit_fract:0,obj_hit:null,hit_time:0,hit_pos:new Float32Array(3),hit_norm:new Float32Array(3)};u.ray_test_cb=function(a,b,d,m,x,e){u.is_binary_value?c(u,-1==b?0:1):c(u,b);u.payload.hit_fract=b;u.payload.obj_hit=d;u.payload.hit_time=m;
u.calc_pos_norm&&(u.payload.hit_pos.set(x),u.payload.hit_norm.set(e))};u.do_activation=!0;return u};a.create_mouse_click_sensor=function(){return t(50)};a.create_mouse_wheel_sensor=function(){return t(30)};a.create_mouse_move_sensor=function(a){var b=t(40);b.axis=a||"XY";b.payload="XY"==b.axis?new Float32Array(2):0;return b};a.create_touch_move_sensor=function(a){var b=t(60);b.axis=a||"XY";b.payload=0;return b};a.create_touch_zoom_sensor=function(){var a=t(70);a.payload=0;return a};a.create_touch_rotate_sensor=
function(a){a=t(75);a.payload=0;return a};a.create_motion_sensor=function(a,b,d){if(!a)return m.error("Wrong collision object"),null;var x=t(110);x.source_object=a;var e=M.get_trans_view(a.render.world_tsr);a=M.get_quat_view(a.render.world_tsr);x.quat_temp=new Float32Array(4);x.trans_last=new Float32Array(e);x.quat_last=new Float32Array(a);x.avg_linear_vel=0;x.avg_angular_vel=0;x.threshold=b||.1;x.rotation_threshold=d||.1;x.time_last=0;x.payload=new Float32Array([0,0]);return x};a.create_vertical_velocity_sensor=
function(a,b){if(!a)return m.error("Wrong collision object"),null;var d=t(120);d.source_object=a;var x=M.get_trans_view(a.render.world_tsr),e=M.get_quat_view(a.render.world_tsr);d.trans_last=new Float32Array(x);d.quat_last=new Float32Array(e);d.avg_vertical_vel=0;d.threshold=b||1;d.time_last=0;d.payload=0;return d};a.create_timer_sensor=function(a,b){var d=t(130);d.period=a;d.repeat=b;d.do_activation=!0;return d};a.reset_timer_sensor=function(a,b,d,x){a=a||P;a=a.sensor_manifolds;if(!a||!a[b])return m.error("reset_timer_sensor(): wrong object"),
null;b=a[b].sensors[d];if(!b)return m.error("reset_timer_sensor(): sensor not found"),null;b.time_last=E.get_timeline();b.period=x};a.create_elapsed_sensor=function(){var a=t(140);a.time_last=0;return a};a.create_gyro_delta_sensor=function(){var a=t(170);a.payload=new Float32Array(3);return a};a.create_gyro_angles_sensor=function(){var a=t(180);a.payload=new Float32Array(3);return a};a.create_timeline_sensor=function(){return t(150)};a.create_selection_sensor=function(a,b){var d=t(160);d.source_object=
a;d.auto_release=b;return d};a.create_callback_sensor=function(a,b){var d=t(190);d.callback=a;c(d,b);return d};a.sensor_set_value=c;a.get_sensor_value=function(a,b,d){a=a||P;a=a.sensor_manifolds;if(!a||!a[b])return m.error("get_sensor_value(): wrong object"),null;b=a[b].sensors[d];return b?b.value:(m.error("get_sensor_value(): sensor not found"),null)};a.get_sensor_payload=function(a,b,d){a=a||P;a=a.sensor_manifolds;if(!a||!a[b])return m.error("get_sensor_payload(): wrong object"),null;b=a[b].sensors[d];
return b?b.payload:(m.error("get_sensor_payload(): sensor not found"),null)};a.cleanup=function(){H=[];P={};I.length=0;aa.length=0};a.check_sensor_manifold=function(a,b){a=a||P;if(!a.sensor_manifolds)return!1;if(b&&a.sensor_manifolds[b])return!0;if(!b)for(var d in a.sensor_manifolds)return!0;return!1};a.create_sensor_manifold=function(a,b,d,m,x,e,c){a=a||P;a.sensor_manifolds_arr=a.sensor_manifolds_arr||[];a.sensor_manifolds=a.sensor_manifolds||{};var f=a.sensor_manifolds,h=a.sensor_manifolds_arr;
f[b]&&k(a,b);d={id:b,type:d,sensors:m.slice(0),logic_fun:x,sensor_values:Array(m.length),callback:e,callback_param:c,last_pulse:-1,last_logic_result:0,last_sensor_values:Array(m.length),update_counter:-1};f[b]=d;h.push(d);-1==H.indexOf(a)&&H.push(a);m=d.sensors;for(a=0;a<m.length;a++){f=b=m[a];if(f.do_activation){switch(f.type){case 80:u.append_collision_test(f.collision_obj,f.collision_id,f.collision_cb,f.calc_pos_norm);break;case 90:u.apply_collision_impulse_test(f.col_imp_obj,f.col_imp_cb);break;
case 100:f.ray_test_id=u.append_ray_test(f.source_object,f.from,f.to,f.collision_id,f.ray_test_cb,!1,!1,f.calc_pos_norm,f.ign_src_rot);break;case 130:f.time_last=E.get_timeline(),0>f.period&&(f.period=-f.period)}f.do_activation=!1}f=I.indexOf(b);-1==f?(I.push(b),aa.push([d])):aa[f].push(d)}ba=!0};a.default_AND_logic_fun=function(a){for(var b=0;b<a.length;b++)if(!a[b])return a[b];return a[a.length-1]};a.default_OR_logic_fun=function(a){for(var b=0;b<a.length;b++)if(a[b])return a[b];return a[a.length-
1]};a.remove_sensor_manifold=k;a.reset=function(){for(var a=0;a<H.length;a++){var b=H[a],m=b.sensor_manifolds,b=b.sensor_manifolds_arr,x;for(x in m)delete m[x];b.length=0}for(a=0;a<I.length;a++)d(I[a]);H.length=0;I.length=0;aa.length=0};a.debug=function(){m.log(String(H.length)+" objects with manifolds",H);m.log(String(I.length)+" sensors",I);for(var a=[],b=[],d=0;d<I.length;d++){var x=I[d];80==x.type&&a.push(x);100==x.type&&b.push(x)}m.log(String(a.length)+" collision sensors",a);m.log(String(b.length)+
" ray sensors",b)};a.register_keyboard_events=function(a,b){a.addEventListener("keydown",l,!1);a.addEventListener("keyup",q,!1);sa=b};a.register_mouse_events=function(a,b,d){if(d)var m=window;else m=a,m.addEventListener("mouseout",f,!1);a.addEventListener("mousedown",r,!1);m.addEventListener("mousemove",C,!1);m.addEventListener("mouseup",g,!1);ca=b;xa=d};a.register_wheel_events=function(a,b){a.addEventListener("mousewheel",h,!1);a.addEventListener("DOMMouseScroll",h,!1);Ga=b};a.register_touch_events=
function(a,b){a.addEventListener("touchstart",n,!1);a.addEventListener("touchend",B,!1);a.addEventListener("touchmove",A,!1);document.addEventListener("touchstart",function(){});ka=b};a.register_device_orientation=function(){window.DeviceOrientationEvent&&x.gyro_use&&window.addEventListener("deviceorientation",F,!1)};a.unregister_keyboard_events=function(a){a.removeEventListener("keydown",l,!1);a.removeEventListener("keyup",q,!1)};a.unregister_mouse_events=function(a){a.removeEventListener("mousedown",
r,!1);a.removeEventListener("mousemove",C,!1);a.removeEventListener("mouseout",f,!1);a.removeEventListener("mouseup",g,!1)};a.unregister_wheel_events=function(a){a.removeEventListener("mousewheel",h,!1);a.removeEventListener("DOMMouseScroll",h,!1)};a.unregister_touch_events=function(a){a.removeEventListener("touchstart",n,!1);a.removeEventListener("touchmove",A,!1);document.removeEventListener("touchstart",function(){})};a.unregister_device_orientation=function(){window.DeviceOrientationEvent&&x.gyro_use&&
window.removeEventListener("deviceorientation",F,!1)};a.assign_keyboard_callback=function(a){ra=a};a.assign_mouse_callback=function(a){qa=a};a.assign_wheel_callback=function(a){ha=a};a.assign_touch_callback=function(a){ma=a}};b4w.module.__curve=function(a,p){function t(a,b,c,k,g){var C=k.length;g||(g=new Float32Array(C));for(var f=C+a,h=new Float32Array(f),n=1;n<=f-1;n++)h[n-1]=b>=c[n-1]&&b<c[n+1-1]?1:0;for(var A=2;A<=a;A++)for(n=1;n<=f-A;n++)h[n-1]=(0!=h[n-1]?(b-c[n-1])*h[n-1]/(c[n+A-1-1]-c[n-1]):0)+(0!=h[n+1-1]?(c[n+A-1]-b)*h[n+1-1]/(c[n+A-1]-c[n+1-1]):0);b==c[f-1]&&(h[C-1]=1);a=0;for(n=1;n<=C;n++)a+=h[n-1]*k[n-1];for(n=1;n<=C;n++)g[n-1]=0!=a?h[n-1]*k[n-1]/a:0;return g}function c(a){a=a.knot;return a[a.length-1]}function b(a){a=
a.cumulative_length;return a[a.length-1]}p("__print");var k=p("__util");a.create_spline=function(a){var b={},c=a.data;a=c.splines[0];if(!a||"NURBS"!=a.type||!a.use_endpoint_u)return null;var k=a.order_u;b.order=k;a=a.points;var g=a.length/5,C=[],f=g+k,g=g+2;C[0]=0;for(var h=2;h<=f;h++)C[h-1]=h>k&&h<g?C[h-2]+1:C[h-2];b.knot=C;if("2D"==c.dimensions)b.is_3d=!1;else if("3D"==c.dimensions)b.is_3d=!0;else throw"Wrong curve dimensions";k=[];C=[];for(c=0;c<a.length;c+=5)k.push(a[c]),k.push(a[c+1]),k.push(a[c+
2]),b.is_3d&&k.push(a[c+3]),C.push(a[c+4]);b.cpoints=k;b.weights=C;a=[];for(var c=b.cpoints,k=b.is_3d?4:3,C=b.weights,f=b.knot,g=b.order,h=c.length/k,n=h+g,A=0,p=f[n-1]/999,F=0;1E3>F;F++){5E-6>f[n-1]-A&&(A=f[n-1]);for(var D=t(g,A,f,C),e=0;e<k;e++)for(var z=a[k*F+e]=0;z<h;z++)a[k*F+e]+=D[z]*c[k*z+e];A+=p}k=b.is_3d?4:3;C=new Float32Array(1E3);C[0]=0;for(c=1;1E3>c;c+=1)f=a[(c-1)*k],g=a[(c-1)*k+1],h=a[(c-1)*k+2],n=a[c*k],A=a[c*k+1],p=a[c*k+2],f=Math.sqrt((n-f)*(n-f)+(A-g)*(A-g)+(p-h)*(p-h)),C[c]=C[c-
1]+f;b.cumulative_length=C;return b};a.spline_point=function(a,b,k){k||(k=[]);var r=b,g=Math.max(r,0),g=c(a);b=g=Math.min(r,g);var r=a.cpoints,g=a.is_3d?4:3,C=a.weights,f=a.knot,h=a.order;a=r.length/g;var n=a+h;5E-6>f[n-1]-b&&(b=f[n-1]);n=new Float32Array(a);t(h,b,f,C,n);for(b=0;b<g;b++)for(C=k[b]=0;C<a;C++)k[b]+=n[C]*r[g*C+b];return k};a.spline_derivative=function(a,b,c){c||(c=[]);var k=a.cpoints,g=a.is_3d?4:3,C=a.weights,f=a.knot,h=a.order;a=k.length/g;var n=a+h;5E-6>f[n-1]-b&&(b=f[n-1]);var n=
new Float32Array(a),A=b;b=n;var p=C.length;b||(b=new Float32Array(p));var t=new Float32Array(p),D=new Float32Array(p),e=t,z=D;e||(e=new Float32Array(p));z||(z=new Float32Array(p));for(var y=p+h,v=new Float32Array(y),m=new Float32Array(y),u=1;u<=y-1;u++)v[u-1]=A>=f[u-1]&&A<f[u+1-1]?1:0;A==f[y-1]&&(v[p-1]=1);for(var K=2;K<=h;K++)for(u=1;u<=y-K;u++){var E=0!=v[u-1]?v[u-1]/(f[u+K-1-1]-f[u-1]):0,M=0!=v[u+1-1]?-v[u+1-1]/(f[u+K-1]-f[u+1-1]):0,J=0!=m[u-1]?(A-f[u-1])*m[u-1]/(f[u+K-1-1]-f[u-1]):0,O=0!=m[u+
1-1]?(f[u+K-1]-A)*m[u+1-1]/(f[u+K-1]-f[u+1-1]):0;v[u-1]=(0!=v[u-1]?(A-f[u-1])*v[u-1]/(f[u+K-1-1]-f[u-1]):0)+(0!=v[u+1-1]?(f[u+K-1]-A)*v[u+1-1]/(f[u+K-1]-f[u+1-1]):0);m[u-1]=E+M+J+O}for(u=1;u<=p;u++)e[u-1]=v[u-1],z[u-1]=m[u-1];f=0;for(h=1;h<=p;h++)f+=t[h-1]*C[h-1];A=0;for(h=1;h<=p;h++)A+=D[h-1]*C[h-1];for(h=1;h<=p;h++)b[h-1]=0!=f?D[h-1]*C[h-1]/f+t[h-1]*C[h-1]*A/(f*f):0;for(C=0;C<g;C++)for(f=c[C]=0;f<a;f++)c[C]+=n[f]*k[g*f+C];return c};a.spline_max_t=c;a.spline_length=b;a.spline_len_to_t=function(a,
l){if(0>=l)return 0;var q=c(a);if(l>=b(a))return q;var r=a.cumulative_length,g=k.binary_search_max(r,l,0,r.length-1);return q*(g+(l-r[g])/(r[g+1]-r[g]))/1E3}};b4w.module.__dds=function(a,p){function t(a,b,d,c){var g=new Uint16Array(4),k=new Uint16Array(d*c),l=0,q=0,e=0,z=q=l=0,r=0,v=0,m=0,u=d/4;c/=4;for(var K=0;K<c;K++)for(var E=0;E<u;E++)e=b+4*(K*u+E),g[0]=a[e],g[1]=a[e+1],l=g[0]&31,q=g[0]&2016,z=g[0]&63488,r=g[1]&31,v=g[1]&2016,m=g[1]&63488,g[2]=5*l+3*r>>3|5*q+3*v>>3&2016|5*z+3*m>>3&63488,g[3]=5*r+3*l>>3|5*v+3*q>>3&2016|5*m+3*z>>3&63488,l=a[e+2],q=4*K*d+4*E,k[q]=g[l&3],k[q+1]=g[l>>2&3],k[q+2]=g[l>>4&3],k[q+3]=g[l>>6&3],q+=d,k[q]=g[l>>8&3],k[q+1]=g[l>>
10&3],k[q+2]=g[l>>12&3],k[q+3]=g[l>>14],l=a[e+3],q+=d,k[q]=g[l&3],k[q+1]=g[l>>2&3],k[q+2]=g[l>>4&3],k[q+3]=g[l>>6&3],q+=d,k[q]=g[l>>8&3],k[q+1]=g[l>>10&3],k[q+2]=g[l>>12&3],k[q+3]=g[l>>14];return k}function c(a,b,c,n){var k=new Int32Array(c,0,31),p,F,D,e,z,y;if(542327876!=k[0])return l.error("Invalid magic number in DDS header"),0;if(!k[20]&4)return l.error("Unsupported format, must contain a FourCC code"),0;p=k[21];switch(p){case q:F=8;D=b?b.COMPRESSED_RGB_S3TC_DXT1_EXT:null;break;case r:F=16;D=
b?b.COMPRESSED_RGBA_S3TC_DXT3_EXT:null;break;case g:F=16;D=b?b.COMPRESSED_RGBA_S3TC_DXT5_EXT:null;break;default:return l.error("Unsupported FourCC code:",d(p)),null}y=1;k[2]&131072&&!1!==n&&(y=Math.max(1,k[7]));e=k[4];z=k[3];k=k[1]+4;if(b)for(p=0;p<y;++p)n=Math.max(4,e)/4*Math.max(4,z)/4*F,b=new Uint8Array(c,k,n),a.compressedTexImage2D(a.TEXTURE_2D,p,D,e,z,0,b),k+=n,e=Math.max(.5*e,1),z=Math.max(.5*z,1);else if(p==q)Math.max(4,e),Math.max(4,z),b=new Uint16Array(c),c=t(b,k/2,e,z),a.texImage2D(a.TEXTURE_2D,
0,a.RGB,e,z,0,a.RGB,a.UNSIGNED_SHORT_5_6_5,c),n&&a.generateMipmap(a.TEXTURE_2D);else return l.error("No manual decoder for",d(p),"and no native support"),0;return y}function b(a,b,d,g,k,l){var q=new XMLHttpRequest;q.open("GET",d,!0);q.responseType="arraybuffer";q.onload=function(){if(200==q.status){a.bindTexture(a.TEXTURE_2D,g);var d=c(a,b,q.response,k);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,1<d?a.LINEAR_MIPMAP_LINEAR:a.LINEAR)}l&&
l(g)};q.send(null);return g}function k(a){return a.charCodeAt(0)+(a.charCodeAt(1)<<8)+(a.charCodeAt(2)<<16)+(a.charCodeAt(3)<<24)}function d(a){return String.fromCharCode(a&255,a>>8&255,a>>16&255,a>>24&255)}var l=p("__print"),q=k("DXT1"),r=k("DXT3"),g=k("DXT5");a.dxt_to_rgb_565=t;a.upload_dds_levels=c;a.get_width_height=function(a){a=new Int32Array(a,0,31);return{width:a[4],height:a[3]}};a.get_compress_ratio=function(a){var b=1;a=(new Int32Array(a,0,31))[21];switch(a){case q:b=6;break;case r:case g:b=
4;break;default:l.error("Unsupported FourCC code:",d(a))}return b};a.load_dds_texture_ex=b;a.load_dds_texture=function(a,d,c,g){var k=a.createTexture();b(a,d,c,k,!0,g);return k}};b4w.module.__debug=function(a,p){function t(a){a=a.split("\n");for(var b=0;b<a.length;b++)a[b]=b+1+" "+a[b];return a=a.join("\n")}function c(a){for(var b=d.get_disjoint_timer_query(),c=a.debug_render_time_queries,e=0;e<c.length;e++){var f=c[e],h=b.getQueryObjectEXT(f,b.QUERY_RESULT_AVAILABLE_EXT),k=n.getParameter(b.GPU_DISJOINT_EXT);h&&!k&&(f=b.getQueryObjectEXT(f,b.QUERY_RESULT_EXT)/1E6,a.debug_render_time=a.debug_render_time?g.smooth(f,a.debug_render_time,1,10):f,c.splice(e,1),e--)}}function b(a,
b){typeof a!=typeof b&&g.panic("Structure assertion failed: incompatible types");if(null!==a&&null!==b&&"object"==typeof a){for(var d in a)d in b||g.panic("Structure assertion failed: missing key in the first object: "+d);for(d in b)d in a||g.panic("Structure assertion failed: missing key in the second object: "+d),typeof a[d]!=typeof b[d]&&g.panic("Structure assertion failed: incompatible types for key "+d)}}var k=p("__config"),d=p("__extensions"),l=p("__print"),q=p("__textures"),r=p("__time"),g=
p("__util"),C=p("__graph"),f=k.defaults,h={},n=null,A=!1,B={},F=[],D=-1,e=null,z=!1;a.WM_NONE=0;a.WM_OPAQUE_WIREFRAME=1;a.WM_TRANSPARENT_WIREFRAME=2;a.WM_FRONT_BACK_VIEW=3;a.WM_DEBUG_SPHERES=4;a.setup_context=function(a){var b="INVALID_ENUM INVALID_VALUE INVALID_OPERATION OUT_OF_MEMORY INVALID_FRAMEBUFFER_OPERATION CONTEXT_LOST_WEBGL".split(" "),d;for(d in b){var c=b[d];c in a&&(h[a[c]]=c)}n=a};a.check_gl=function(a){if(A){var b=n.getError();b!=n.NO_ERROR&&(b in h?g.panic("GL Error: "+b+", gl."+h[b]+
" ("+a+")"):g.panic("Unknown GL error: "+b+" ("+a+")"))}};a.check_bound_fb=function(){if(!A)return!0;switch(n.checkFramebufferStatus(n.FRAMEBUFFER)){case n.FRAMEBUFFER_COMPLETE:return!0;case n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return l.error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_ATTACHMENT"),!1;case n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return l.error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT"),!1;case n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return l.error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_DIMENSIONS"),
!1;case n.FRAMEBUFFER_UNSUPPORTED:return l.error("Incomplete framebuffer: FRAMEBUFFER_UNSUPPORTED"),!1;default:return l.error("FRAMEBUFFER CHECK FAILED"),!1}};a.check_depth_only_issue=function(){if(-1!=D)return D;var a=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,a);a=q.create_texture("DEBUG",q.TT_DEPTH);q.resize(a,1,1);n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,a.w_target,a.w_texture,0);n.checkFramebufferStatus(n.FRAMEBUFFER)!=n.FRAMEBUFFER_COMPLETE?(D=!0,l.warn("depth-only issue was found")):
D=!1;n.bindFramebuffer(n.FRAMEBUFFER,null);return D};a.check_shader_compiling=function(a,b,c){if(A&&!n.getShaderParameter(a,n.COMPILE_STATUS)){var e=f.allow_shaders_debug_ext&&d.get_debug_shaders();e&&(c=e.getTranslatedShaderSource(a));c=t(c);l.error("shader compilation failed:\n"+c+"\n"+n.getShaderInfoLog(a)+" ("+b+")");throw"Engine failed: see above for error messages";}};a.check_shader_linking=function(a,b,c,e,h,g){if(A&&!n.getProgramParameter(a,n.LINK_STATUS)){var k=f.allow_shaders_debug_ext&&
d.get_debug_shaders();k&&(h=k.getTranslatedShaderSource(c),g=k.getTranslatedShaderSource(e));h=t(h);g=t(g);l.error("shader linking failed:\n"+h+"\n\n\n"+g+"\n"+n.getProgramInfoLog(a)+" ("+b+")");throw"Engine failed: see above for error messages";}};a.set_check_gl_errors=function(a){A=a};a.render_time_start=function(a){if(f.show_hud_debug_info||"PERFORMANCE"==a.type){var b=d.get_disjoint_timer_query();if(b){var c=b.createQueryEXT();a.debug_render_time_queries.push(c);b.beginQueryEXT(b.TIME_ELAPSED_EXT,
c)}else a.debug_render_time_queries.push(performance.now())}};a.render_time_stop=function(a){if(f.show_hud_debug_info||"PERFORMANCE"==a.type){var b=d.get_disjoint_timer_query();b?(b.endQueryEXT(b.TIME_ELAPSED_EXT),c(a)):(b=a.debug_render_time_queries,b=performance.now()-b.pop(),a.debug_render_time=a.debug_render_time?g.smooth(b,a.debug_render_time,1,10):b)}};a.process_timer_queries=c;a.exec_count=function(a){B[a]=a in B?B[a]+1:1};a.update=function(){for(var a in B)l.log(a,B[a]),B[a]=0};a.fbmsg=function(){for(var a=
[performance.now()],b=0;b<arguments.length;b++){var d=arguments[b];if(g.is_vector(d))for(var c=0;c<d.length;c++)a.push(d[c]);else a.push(arguments[b])}F.push(a)};a.msg=function(){for(var a=1,b=0;b<F.length;b++){var d=F[b];d[1]==arguments[0]&&a++}d=[a];for(b=0;b<arguments.length;b++)if(a=arguments[b],g.is_vector(a))for(var c=0;c<a.length;c++)d.push(a[c]);else d.push(arguments[b]);F.push(d)};var y=["color: #3366FF","color: #CC33FF","color: #FF3366","color: #33FF66","color: #FFCC33"];a.print_telemetry=
function(a){a||(a=1);for(var b=0,d={},c=Math.max(0,performance.now()-1E3*a),e=0;e<F.length;e++){var f=F[e];a=f[0];if(!(a<c)){var h=String(f[1]);d[h]||(d[h]=y[b++%y.length]);var g=d[h];a=["%c"+(a/1E3).toFixed(6),g,h];for(h=2;h<f.length;h++)a.push(f[h]);l.log.apply(this,a)}}F.splice(0)};a.plot_telemetry=function(a){a||(a=1);for(var b={},d=Math.max(0,performance.now()-1E3*a),c=0;c<F.length;c++){var e=F[c];a=e[0];if(!(a<d))for(var f=2;f<e.length;f++){var h=String(e[1]);3<e.length&&(h+="_"+String(f-2));
b[h]||(b[h]=h+"\n");b[h]+=String(a)+" "+e[f]+"\n"}}a="";for(h in b)a+=b[h]+"\n\n";l.log(a);F.splice(0)};a.check_browser=function(a){var b=navigator.userAgent.toLowerCase(),d=function(a){return-1<b.indexOf(a)?!0:!1};switch(a.toLowerCase()){case "chrome":return d("mozilla")&&d("applewebkit")&&d("chrome");case "firefox":return d("mozilla")&&d("gecko")&&d("firefox");case "msie":return d("mozilla")&&d("trident")&&d("msie");case "opera":return d("opera")&&d("presto");case "safari":return d("mozilla")&&
d("applewebkit")&&d("safari")&&!d("chrome");default:return!1}};a.check_finite=function(a){if(g.is_vector(a)){for(var b=0;b<a.length;b++)if(!isFinite(a[b]))return!1;return Boolean(a.length)}return isFinite(a)?!0:!1};a.assert_cons=function(a,b){a.constructor!=b&&g.panic("Type assertion failed: value <"+a+"> has type <"+a.constructor+">, required <"+b+">")};a.assert_structure=b;a.assert_structure_seq=function(a){z?b(a,e):z=!0;e=a};a.fake_load=function(a,b,d,c,e){(a=a||null)||g.panic("Stage load callback is undefined");
b=b||5E3;d=d||0;c=c||100;100<c&&g.panic("Max percentage must be less than 100");0>d&&g.panic("Min percentage must be greater than 0");d>c&&g.panic("Max percentage must be greater than min percentage");var f=r.animate(d,c,b,function(b){b=b.toFixed();a(b);100==b&&(r.clear_animation(f),e&&e())})};a.nodegraph_to_dot=function(a){return C.debug_dot(a,function(a,b){return b.type},function(b,d,c){b=C.get_node_attr(a,b);d=C.get_node_attr(a,d);return b.outputs[c[0]].identifier+"\n==>\n"+d.inputs[c[1]].identifier})}};b4w.module.__extensions=function(a,p){function t(a){if(a in l)return l[a];var c=d.getExtension(a)||null;l[a]=c;b.log("%cGET EXTENSION","color: #"+(c?"0a0":"a00"),a);return c}var c=p("__config"),b=p("__print"),k=c.defaults,d=null,l={};a.setup_context=function(a){d=a};a.get_s3tc=function(){return t("WEBGL_compressed_texture_s3tc")||t("WEBKIT_WEBGL_compressed_texture_s3tc")||t("MOZ_WEBGL_compressed_texture_s3tc")};a.get_depth_texture=function(){return k.webgl2?{}:t("WEBGL_depth_texture")||t("WEBKIT_WEBGL_depth_texture")||
t("MOZ_WEBGL_depth_texture")};a.get_aniso=function(){return t("EXT_texture_filter_anisotropic")||t("WEBKIT_EXT_texture_filter_anisotropic")||t("MOZ_EXT_texture_filter_anisotropic")};a.get_debug_shaders=function(){return t("WEBGL_debug_shaders")};a.get_renderer_info=function(){return t("WEBGL_debug_renderer_info")};a.get_elem_index_uint=function(){return k.webgl2?{}:t("OES_element_index_uint")};a.get_standard_derivatives=function(){return k.webgl2?null:t("OES_standard_derivatives")};a.get_disjoint_timer_query=
function(){return t("EXT_disjoint_timer_query")};a.cleanup=function(){l={}}};b4w.module.__graph=function(a,p){function t(a,b,d){d||(d=null);if(c(a,b))throw"Graph already has node with given ID";a.nodes.push(b,d)}function c(a,b){for(var d=a.nodes,c=0;c<d.length;c+=2)if(d[c]==b)return!0;return!1}function b(a,b,d,e){e||(e=null);if(c(a,b)&&c(a,d))a.edges.push(b,d,e);else throw"Wrong node IDs";}function k(a,b){if(!c(a,b))throw"Node not found";for(var d=a.nodes,e=0;e<d.length;e+=2)d[e]==b&&(d.splice(e,2),e-=2)}function d(a,b,d,c){if(!K(a,b,d))throw"Edge not found";a=a.edges;for(var e=
0,m=0;m<a.length;m+=3)if(a[m]==b&&a[m+1]==d){if(-1==c)a.splice(m,3);else{if(c==e){a.splice(m,3);break}e++}m-=3}}function l(a){a=a.nodes;for(var b=-1,d=0;d<a.length;d+=2)b=Math.max(b,a[d]);return++b}function q(a,b){for(var d=a.nodes,c=0;c<d.length;c+=2)if(d[c+1]==b)return d[c];return-1}function r(a){var b=[],d={};g(a,d);for(var c=a.nodes,e=0;e<c.length;e+=2)0==v(a,c[e])&&C(a,c[e],d,b);return{nodes:b,edges:a.edges.slice(0)}}function g(a,b){for(var d=a.nodes,c=0;c<d.length;c+=2)b[d[c]]=!1}function C(a,
b,d,c){if(!d[b]){d[b]=!0;for(var e=0;e<y(a,b);e++){var f=m(a,b,e);C(a,f,d,c)}c.unshift(b,z(a,b))}}function f(a,b,d,c){if(!d[b]){d[b]=!0;if(10==c||30==c)for(var e=0;e<y(a,b);e++){var h=m(a,b,e);f(a,h,d,c)}if(20==c||30==c)for(e=0;e<v(a,b);e++)h=u(a,b,e),f(a,h,d,c)}}function h(a){for(var b=a.edges,d=0;d<b.length;d+=3){var e=b[d+1];c(a,b[d])&&c(a,e)||(b.splice(d,3),d-=3)}}function n(a){for(var b=[],d=a.nodes,c=0;c<d.length;c+=2){var e=d[c];y(a,e)||b.push(e)}return b}function A(a){var b=a.nodes;a=a.edges;
for(var d=[],c=[],e=[],m=0;m<b.length;m++)e[b[2*m]]=m,d.push(m,b[2*m+1]);for(m=0;m<a.length;m+=3)c.push(e[a[m]],e[a[m+1]],a[m+2]);return{nodes:d,edges:c}}function B(a,b,d){if(d.core_len==d.n1){for(var c=0,f=0;c<d.n1;c++)-1!=d.core_1[c]&&(a[f]=c,b[f]=d.core_1[c],f++);return!0}if(d.n1>d.n2||d.t1both_len>d.t2both_len||d.t1out_len>d.t2out_len||d.t1in_len>d.t2in_len)return!1;for(var f=c=-1,h=!1;!h&&F(d,G,c,f);)if(c=G[0],f=G[1],D(d,c,f)){var g;g=d;h={};h.g1=g.g1;h.g2=g.g2;h.node_comp=g.node_comp;h.edge_comp=
g.edge_comp;h.n1=g.n1;h.n2=g.n2;h.order=g.order;h.core_len=h.orig_core_len=g.core_len;h.t1in_len=g.t1in_len;h.t1out_len=g.t1out_len;h.t1both_len=g.t1both_len;h.t2in_len=g.t2in_len;h.t2out_len=g.t2out_len;h.t2both_len=g.t2both_len;h.added_node1=-1;h.core_1=g.core_1;h.core_2=g.core_2;h.in_1=g.in_1;h.in_2=g.in_2;h.out_1=g.out_1;h.out_2=g.out_2;h.share_count=g.share_count;g.share_count[0]+=1;var h=g=h,k=c,n=f,l=h.g1,q=h.g2,z=h.n1,r=h.n2,E=h.core_1,A=h.core_2,M=h.in_1,J=h.in_2,K=h.out_1,N=h.out_2;e(k<
z);e(n<r);e(h.core_len<z);e(h.core_len<r);z=++h.core_len;h.added_node1=k;M[k]||(M[k]=z,h.t1in_len++,K[k]&&h.t1both_len++);K[k]||(K[k]=z,h.t1out_len++,M[k]&&h.t1both_len++);J[n]||(J[n]=z,h.t2in_len++,N[n]&&h.t2both_len++);N[n]||(N[n]=z,h.t2out_len++,J[n]&&h.t2both_len++);E[k]=n;A[n]=k;for(E=0;E<v(l,k);E++)A=u(l,k,E),M[A]||(M[A]=z,h.t1in_len++,K[A]&&h.t1both_len++);for(E=0;E<y(l,k);E++)A=m(l,k,E),K[A]||(K[A]=z,h.t1out_len++,M[A]&&h.t1both_len++);for(E=0;E<v(q,n);E++)A=u(q,n,E),J[A]||(J[A]=z,h.t2in_len++,
N[A]&&h.t2both_len++);for(E=0;E<y(q,n);E++)A=m(q,n,E),N[A]||(N[A]=z,h.t2out_len++,J[A]&&h.t2both_len++);h=B(a,b,g);e(1>=g.core_len-g.orig_core_len);e(-1!=g.added_node1);A=g.g1;k=g.g2;n=g.core_len;l=g.added_node1;q=g.core_1;M=g.core_2;z=g.in_1;J=g.in_2;r=g.out_1;K=g.out_2;if(g.orig_core_len<n){z[l]==n&&(z[l]=0);for(N=0;N<v(A,l);N++)E=u(A,l,N),z[E]==n&&(z[E]=0);r[l]==n&&(r[l]=0);for(N=0;N<y(A,l);N++)E=m(A,l,N),r[E]==n&&(r[E]=0);A=q[l];J[A]==n&&(J[A]=0);for(N=0;N<v(k,A);N++)E=u(k,A,N),J[E]==n&&(J[E]=
0);K[A]==n&&(K[A]=0);for(N=0;N<y(k,A);N++)E=m(k,A,N),K[E]==n&&(K[E]=0);q[l]=-1;M[A]=-1;g.core_len=g.orig_core_len;g.added_node1=-1}}return h}function F(a,b,d,c){-1==d&&(d=0);-1==c?c=0:c++;var e=a.t1both_len,m=a.t2both_len,h=a.t1out_len,f=a.t2out_len,u=a.t1in_len,g=a.t2in_len,k=a.core_len,n=a.n1,v=a.n2,l=a.core_1,q=a.core_2,z=a.in_1,E=a.in_2,r=a.out_1,N=a.out_2;if(e>k&&m>k)for(;d<n&&(-1!=l[d]||0==r[d]||0==z[d]);)d++,c=0;else if(h>k&&f>k)for(;d<n&&(-1!=l[d]||0==r[d]);)d++,c=0;else if(u>k&&g>k)for(;d<
n&&(-1!=l[d]||0==z[d]);)d++,c=0;else if(0==d&&0!=a.order){for(z=0;z<n&&-1!=l[d=a.order[z]];)z++;z==n&&(d=n)}else for(;d<n&&-1!=l[d];)d++,c=0;if(e>k&&m>k)for(;c<v&&(-1!=q[c]||0==N[c]||0==E[c]);)c++;else if(h>k&&f>k)for(;c<v&&(-1!=q[c]||0==N[c]);)c++;else if(u>k&&g>k)for(;c<v&&(-1!=q[c]||0==E[c]);)c++;else for(;c<v&&-1!=q[c];)c++;return d<n&&c<v?(b[0]=d,b[1]=c,!0):!1}function D(a,b,d){var c=a.g1,h=a.g2,f=a.n2,g=a.core_1,k=a.core_2,n=a.in_1,l=a.in_2,q=a.out_1,r=a.out_2;e(b<a.n1);e(d<f);e(-1==g[b]);e(-1==
k[d]);f=(0,a.node_comp)(z(c,b),z(h,d))?!0:!1;if(!f)return!1;for(var A=f=0,M=0,J=0,G=0,C=0,p=0;p<y(c,b);p++){var N=m(c,b,p);if(-1!=g[N]){var Z=g[N];if(!K(h,d,Z)||!E(a.edge_comp,c,b,N,h,d,Z))return!1}else n[N]&&M++,q[N]&&f++,n[N]||q[N]||G++}for(p=0;p<v(c,b);p++)if(N=u(c,b,p),-1!=g[N]){if(Z=g[N],!K(h,Z,d)||!E(a.edge_comp,c,N,b,h,Z,d))return!1}else n[N]&&M++,q[N]&&f++,n[N]||q[N]||G++;for(p=0;p<y(h,d);p++)if(Z=m(h,d,p),-1!=k[Z]){if(N=k[Z],!K(c,b,N))return!1}else l[Z]&&J++,r[Z]&&A++,l[Z]||r[Z]||C++;for(p=
0;p<v(h,d);p++)if(Z=u(h,d,p),-1!=k[Z]){if(N=k[Z],!K(c,N,b))return!1}else l[Z]&&J++,r[Z]&&A++,l[Z]||r[Z]||C++;return M<=J&&f<=A&&G<=C}function e(a){if(!a)throw"Assertion failed";}function z(a,b){for(var d=a.nodes,c=0;c<d.length;c+=2)if(d[c]==b)return d[c+1];return null}function y(a,b){for(var d=a.edges,c=0,e=0;e<d.length;e+=3)d[e]==b&&c++;return c}function v(a,b){for(var d=a.edges,c=0,e=0;e<d.length;e+=3)d[e+1]==b&&c++;return c}function m(a,b,d){a=a.edges;for(var c=0,e=0;e<a.length;e+=3)if(a[e]==b){if(c==
d)return a[e+1];c++}return-1}function u(a,b,d){a=a.edges;for(var c=0,e=0;e<a.length;e+=3)if(a[e+1]==b){if(c==d)return a[e];c++}return-1}function K(a,b,d){a=a.edges;for(var c=0;c<a.length;c+=3)if(a[c]==b&&a[c+1]==d)return!0;return!1}function E(a,b,d,c,e,m,h){for(var f=M(b,d,c),u=M(e,m,h),g=0;g<f;g++){for(var k=!1,n=0;n<u;n++)if(a(J(b,d,c,g),J(e,m,h,n))){k=!0;break}if(!k)return!1}return!0}function M(a,b,d){var c=0;a=a.edges;for(var e=0;e<a.length;e+=3)a[e]==b&&a[e+1]==d&&c++;return c}function J(a,b,
d,c){a=a.edges;for(var e=0,m=0;m<a.length;m+=3)if(a[m]==b&&a[m+1]==d){if(e==c)return a[m+2];e++}return null}p("__print");var O=p("__util"),G=[-1,-1];a.NULL_NODE=-1;a.FORWARD_DIR=10;a.BACKWARD_DIR=20;a.TWO_WAY=30;a.create=function(){for(var a=arguments,b=[],d=[],c=0;c<a.length;c++){var e=a[c];switch(e.length){case 2:b.push(e[0],e[1]);break;case 3:d.push(e[0],e[1],e[2]);break;default:throw"Wrong graph constructor params";}}return{nodes:b,edges:d}};a.clone=function(a,b,d){if(b)for(var c=Array(a.nodes.length),
e=0;e<a.nodes.length;e+=2)c[e]=a.nodes[e],c[e+1]=b(a.nodes[e+1]);else c=O.clone_object_r(a.nodes);if(d)for(b=Array(a.edges.length),e=0;e<a.edges.length;e+=3)b[e]=a.edges[e],b[e+1]=a.edges[e+1],b[e+2]=d(a.edges[e+2]);else b=O.clone_object_r(a.edges);return a={nodes:c,edges:b}};a.create_node_edge_arr=function(a,b){for(var d=[],c=[],e=0;e<a.length;e++)d.push(a[e][0],a[e][1]);for(e=0;e<b.length;e++)c.push(b[e][0],b[e][1],b[e][2]);return{nodes:d,edges:c}};a.append_node=t;a.has_node=c;a.append_edge=b;a.remove_node=
k;a.remove_edge=d;a.remove_edge_by_attr=function(a,b,d,c){if(!K(a,b,d))throw"Edge not found";a=a.edges;for(var e=0;e<a.length;e+=3)if(a[e]==b&&a[e+1]==d&&a[e+2][0]==c[0]&&a[e+2][1]==c[1]){a.splice(e,3);break}};a.append_node_attr=function(a,b){if(-1==q(a,b)){var d=l(a);t(a,d,b);return d}throw"Non-unique attribute";};a.replace_edge_attr=function(a,b,d,c,e){a=a.edges;for(var m=0;m<a.length;m+=3)a[m]==b&&a[m+1]==d&&a[m+2]==c&&(a[m+2]=e)};a.append_subgraph=function(a,d,c,e){c=c||[];e=e||[];for(var m={},
h=0;h<a.nodes.length;h+=2){var f=a.nodes[h],u=a.nodes[h+1],g=l(d);t(d,g,u);m[f]=g}for(h=0;h<a.edges.length;h+=3)u=m[a.edges[h]],g=m[a.edges[h+1]],f=a.edges[h+2],b(d,u,g,f);for(h=0;h<c.length;h+=3)u=m[c[h]],a=c[h+1],f=c[h+2],b(d,u,a,f);for(h=0;h<e.length;h+=3)c=e[h],g=m[e[h+1]],f=e[h+2],b(d,c,g,f)};a.gen_node_id=l;a.node_by_attr=q;a.append_edge_attr=function(a,d,c,e){d=q(a,d);c=q(a,c);if(-1!=d&&-1!=c)b(a,d,c,e);else throw"Attributes not found";};a.traverse=function(a,b){for(var d=a.nodes,c=0;c<d.length&&
!b(d[c],d[c+1]);c+=2);};a.traverse_edges=function(a,b){for(var d=a.edges,c=0;c<d.length&&!b(d[c],d[c+1],d[c+2]);c+=3);};a.traverse_inputs=function(a,b,d){for(var c=a.edges,e=0;e<c.length;e+=3)if(c[e+1]==b){var m=c[e];if(d(m,z(a,m),c[e+2]))break}};a.traverse_outputs=function(a,b,d){for(var c=a.edges,e=0;e<c.length;e+=3)if(c[e]==b){var m=c[e+1];if(d(m,z(a,m),c[e+2]))break}};a.topsort=r;a.topsort_attr=function(a){a=r(a).nodes;for(var b=[],d=0;d<a.length;d+=2)b.push(a[d+1]);return b};a.is_connected=function(a){};
a.subgraph_node_conn=function(a,b,d){if(!c(a,b))throw"No such node";var e={};g(a,e);f(a,b,e,d);b=[];for(var m in e)e[m]&&(m=Number(m),b.push(m,z(a,m)));a={nodes:b,edges:a.edges.slice(0)};h(a);return a};a.cleanup_loose_edges=h;a.get_source_nodes=function(a){for(var b=[],d=a.nodes,c=0;c<d.length;c+=2){var e=d[c];v(a,e)||b.push(e)}return b};a.get_sink_nodes=n;a.match=function(a,b,d,c){var e={};e.g1=A(a);e.g2=A(b);e.node_comp=d||function(a,b){return a==b};e.edge_comp=c||function(a,b){return a==b};c=a.nodes.length/
2;var m=b.nodes.length/2;e.n1=c;e.n2=m;e.order=0;e.core_len=e.orig_core_len=0;e.t1both_len=e.t1in_len=e.t1out_len=0;e.t2both_len=e.t2in_len=e.t2out_len=0;e.added_node1=-1;e.core_1=Array(c);e.core_2=Array(m);e.in_1=Array(c);e.in_2=Array(m);e.out_1=Array(c);e.out_2=Array(m);e.share_count=[1];for(d=0;d<c;d++)e.core_1[d]=-1,e.in_1[d]=0,e.out_1[d]=0;for(d=0;d<m;d++)e.core_2[d]=-1,e.in_2[d]=0,e.out_2[d]=0;m=Array(c);c=Array(c);if(B(m,c,e)){for(d=0;d<m.length;d++)m[d]=a.nodes[2*m[d]],c[d]=b.nodes[2*c[d]];
return[m,c]}return null};a.get_node_attr=z;a.out_edge_count=y;a.in_edge_count=v;a.get_out_edge=m;a.get_in_edge=u;a.get_edge_count=M;a.get_edge_attr=J;a.replace=function(a,b,d){for(var c=a.edges,e=l(a),m=0;m<b.length;m++){var h=b[m];k(a,h);for(var f=0;f<c.length;f+=3)c[f]==h&&(c[f]=e),c[f+1]==h&&(c[f+1]=e),c[f]==c[f+1]&&(c.splice(f,3),f-=3)}t(a,e,d)};a.reconnect_edges=function(a,b,d,c,e){if(!K(a,b,d))throw"Edge not found";a=a.edges;for(var m=0;m<a.length;m+=3)a[m]==b&&a[m+1]==d&&(a[m]=c,a[m+1]=e)};
a.enforce_acyclic=function(a,b){function c(a,b){if(-1!=u.indexOf(a)){var d=u.slice(u.indexOf(a));if(-1!=m[d[d.length-1]].indexOf(d[0])){g.push([a,d[d.length-1]]);return}}u.push(a);for(d=0;d<b.length;d++)b[d]in m&&c(b[d],m[b[d]])}b||(b=n(a)[0]);var e=a.edges;if(!e.length)return a;for(var m={},h=0,f=0;f<e.length;f+=3)e[f+1]in m?m[e[f+1]].push(e[f]):m[e[f+1]]=[e[f]],h++;var u=[],g=[];c(b,m[b]);for(f=0;f<g.length;f++)for(var k=h=0;k<e.length;k+=3)g[f][1]==e[k+1]&&g[f][0]==e[k]&&d(a,e[k],e[k+1],h),h++;
return a};a.debug_dot=function(a,b,d){var c=a.nodes;a=a.edges;var e;e="digraph debug {\n    node [shape=box];\n";for(var m=0;m<c.length;m+=2){var h=c[m],f=c[m+1],f=b?b(h,f):String(h);e+="    ";e+=String(h)+' [label="'+f.replace(/\"/g,'\\"')+'"];\n'}for(m=0;m<a.length;m+=3)b=a[m],c=a[m+1],f=a[m+2],e+="    ",e+=String(b)+" -> "+String(c),d&&(e+=' [label="'+d(b,c,f)+'"]'),e+=";\n";return e+="}"}};b4w.module.__ipc=function(a,p){function t(a,b,d){for(var c=0;c<h.length;c+=2)h[c+1]==a&&(f[c+Number(!b)]=d)}function c(a){for(var b=0;b<a.length;b++){var d=a[b],c=0,e;for(e in d){var h=d[e];switch(h.constructor){case Float32Array:c+=h.length;break;case Number:c+=1}}--c;d.len=c}}var b=!0;a.IN_LOADED=0;var k=a.IN_COLLISION=1,d=a.IN_COLLISION_POS_NORM=2;a.IN_COLLISION_IMPULSE=3;a.IN_ERROR=4;a.IN_FBMSG=5;a.IN_FLOATER_BOB_TRANSFORM=6;a.IN_LOG=7;var l=a.IN_PROP_OFFSET=8,q=a.IN_RAY_HIT=9,r=a.IN_RAY_HIT_POS_NORM=
10;a.IN_REMOVE_RAY_TEST=11;var g=a.IN_TRANSFORM=12;a.IN_VEHICLE_SPEED=13;a.IN_PING=14;a.IN_FPS=15;a.IN_DEBUG_STATS=16;a.OUT_INIT=100;a.OUT_ACTIVATE=101;a.OUT_ADD_BOAT_BOB=102;a.OUT_ADD_CAR_WHEEL=103;a.OUT_ADD_FLOATER_BOB=104;a.OUT_APPEND_BOUNDING_BODY=105;a.OUT_APPEND_BOAT=106;a.OUT_APPEND_CAR=107;a.OUT_APPEND_CHARACTER=108;a.OUT_APPEND_COLLISION_TEST=109;a.OUT_APPEND_CONSTRAINT=110;a.OUT_APPEND_FLOATER=111;a.OUT_APPEND_GHOST_MESH_BODY=112;a.OUT_APPEND_STATIC_MESH_BODY=113;a.OUT_APPEND_WATER=114;
a.OUT_REMOVE_BODY=115;a.OUT_APPLY_CENTRAL_FORCE=116;a.OUT_APPLY_COLLISION_IMPULSE_TEST=117;a.OUT_APPLY_TORQUE=118;a.OUT_CHARACTER_JUMP=119;a.OUT_CHARACTER_ROTATION_INCREMENT=120;a.OUT_CLEAR_COLLISION_IMPULSE_TEST=121;a.OUT_DISABLE_SIMULATION=122;a.OUT_ENABLE_SIMULATION=123;a.OUT_PAUSE=124;a.OUT_APPEND_RAY_TEST=125;a.OUT_REMOVE_RAY_TEST=126;a.OUT_CHANGE_RAY_TEST_FROM_TO=127;a.OUT_REMOVE_COLLISION_TEST=128;a.OUT_REMOVE_CONSTRAINT=129;a.OUT_RESUME=130;a.OUT_SET_CHARACTER_FLY_VELOCITY=131;a.OUT_SET_CHARACTER_HOR_ROTATION=
132;a.OUT_SET_CHARACTER_MOVE_DIR=133;a.OUT_SET_CHARACTER_MOVE_TYPE=134;a.OUT_SET_CHARACTER_ROTATION=135;a.OUT_SET_CHARACTER_RUN_VELOCITY=136;a.OUT_SET_CHARACTER_VERT_ROTATION=137;a.OUT_SET_CHARACTER_WALK_VELOCITY=138;a.OUT_SET_GRAVITY=139;a.OUT_SET_LINEAR_VELOCITY=140;var C=a.OUT_SET_TRANSFORM=141;a.OUT_SET_WATER_TIME=142;a.OUT_ADD_WATER_WRAPPER=143;a.OUT_UPDATE_BOAT_CONTROLS=144;a.OUT_UPDATE_CAR_CONTROLS=145;a.OUT_PING=146;a.OUT_DEBUG=147;a.OUT_UPDATE_WORLD=148;var f=b4w.worker_listeners,h=b4w.worker_namespaces,
n={msg_id:g,body_id:0,time:0,trans:new Float32Array(3),quat:new Float32Array(4),linvel:new Float32Array(3),angvel:new Float32Array(3),len:0},A={msg_id:l,chassis_hull_body_id:0,prop_ind:0,trans:new Float32Array(3),quat:new Float32Array(4),len:0},B={msg_id:q,id:0,body_id_hit:0,hit_fract:0,hit_time:0,len:0},F={msg_id:r,id:0,body_id_hit:0,hit_fract:0,hit_time:0,hit_pos:new Float32Array(3),hit_norm:new Float32Array(3),len:0},D={msg_id:k,body_id_a:0,body_id_b:0,result:0,len:0},e={msg_id:d,body_id_a:0,body_id_b:0,
result:0,coll_point:new Float32Array(3),coll_norm:new Float32Array(3),coll_dist:0,len:0},z={msg_id:C,body_id:0,trans:new Float32Array(3),quat:new Float32Array(4),len:0},y=[n,A,B,F,D,e,z];a.create_worker=function(a,d){var c={is_main:a?!0:!1,web_worker:null,buf_arr:[],fb_worker_ns:""};if(d)if(c.web_worker={addEventListener:function(a,b,d){"message"!=a&&panic("Wrong web worker event");t(c.fb_worker_ns,c.is_main,b)},removeEventListener:function(a,b,d){"message"!=a&&panic("Wrong web worker event");t(c.fb_worker_ns,
c.is_main,null)},postMessage:function(a,b){var d;a:{for(d=0;d<h.length;d+=2)if(h[d+1]==c.fb_worker_ns){d=f[d+Number(!!c.is_main)];break a}d=null}d({data:a})},terminate:function(){for(var a=0;a<h.length;a+=2)if(h[a+1]==c.fb_worker_ns){f.splice(a,2);h.splice(a,2);break}}},c.is_main){var e=p("__util"),g=p("__container"),k=b4w.get_namespace(p),e=e.unique_name(k+"_worker");h.push(k);h.push(e);f.push(null);f.push(null);c.fb_worker_ns=e;(g=g.find_script(a))?b?g.addEventListener("load",function(){b4w.require("__bindings",
c.fb_worker_ns)},!1):(b4w.cleanup("__bindings",c.fb_worker_ns),b4w.cleanup("__ipc",c.fb_worker_ns),b4w.require("__bindings",c.fb_worker_ns)):(g=document.createElement("script"),g.src=a,g.defer="defer",g.async="async",g.addEventListener("load",function(){b=!1;b4w.require("__bindings",c.fb_worker_ns)},!1),document.head.appendChild(g))}else c.fb_worker_ns=b4w.get_namespace(p);else c.web_worker=a?new Worker(a):self;return c};a.attach_handler=function(a,b){c(y);var h=function(c){if(c.constructor==ArrayBuffer)c=
new Float32Array(c);else if(c[0].constructor==ArrayBuffer){for(var f=0;f<c.length;f++)h(c[f]);return}f=c[0]|0;switch(f){case g:var y=n;y.body_id=c[1]|0;y.time=c[2];y.trans[0]=c[3];y.trans[1]=c[4];y.trans[2]=c[5];y.quat[0]=c[6];y.quat[1]=c[7];y.quat[2]=c[8];y.quat[3]=c[9];y.linvel[0]=c[10];y.linvel[1]=c[11];y.linvel[2]=c[12];y.angvel[0]=c[13];y.angvel[1]=c[14];y.angvel[2]=c[15];break;case l:y=A;y.chassis_hull_body_id=c[1]|0;y.prop_ind=c[2]|0;y.trans[0]=c[3];y.trans[1]=c[4];y.trans[2]=c[5];y.quat[0]=
c[6];y.quat[1]=c[7];y.quat[2]=c[8];y.quat[3]=c[9];break;case q:y=B;y.id=c[1]|0;y.body_id_hit=c[2]|0;y.hit_fract=c[3];y.hit_time=c[4];break;case r:y=F;y.id=c[1]|0;y.body_id_hit=c[2]|0;y.hit_fract=c[3];y.hit_time=c[4];y.hit_pos[0]=c[5];y.hit_pos[1]=c[6];y.hit_pos[2]=c[7];y.hit_norm[0]=c[8];y.hit_norm[1]=c[9];y.hit_norm[2]=c[10];break;case k:y=D;y.body_id_a=c[1]|0;y.body_id_b=c[2]|0;y.result=!!c[3];break;case d:y=e;y.body_id_a=c[1]|0;y.body_id_b=c[2]|0;y.result=!!c[3];y.coll_point[0]=c[4];y.coll_point[1]=
c[5];y.coll_point[2]=c[6];y.coll_norm[0]=c[7];y.coll_norm[1]=c[8];y.coll_norm[2]=c[9];y.coll_dist=c[10];break;case C:y=z;y.body_id=c[1]|0;y.trans[0]=c[2];y.trans[1]=c[3];y.trans[2]=c[4];y.quat[0]=c[5];y.quat[1]=c[6];y.quat[2]=c[7];y.quat[3]=c[8];break;default:y=c}b(a,f,y)};a.web_worker.addEventListener("message",function(a){h(a.data)},!1)};a.cleanup=function(){};a.post_msg=function(a,b){if(a)switch(b){case g:var c=n,h=new Float32Array(c.len);h[0]=c.msg_id;h[1]=c.body_id;h[2]=c.time;h[3]=c.trans[0];
h[4]=c.trans[1];h[5]=c.trans[2];h[6]=c.quat[0];h[7]=c.quat[1];h[8]=c.quat[2];h[9]=c.quat[3];h[10]=c.linvel[0];h[11]=c.linvel[1];h[12]=c.linvel[2];h[13]=c.angvel[0];h[14]=c.angvel[1];h[15]=c.angvel[2];a.buf_arr.push(h.buffer);break;case l:c=A;h=new Float32Array(c.len);h[0]=c.msg_id;h[1]=c.chassis_hull_body_id;h[2]=c.prop_ind;h[3]=c.trans[0];h[4]=c.trans[1];h[5]=c.trans[2];h[6]=c.quat[0];h[7]=c.quat[1];h[8]=c.quat[2];h[9]=c.quat[3];a.buf_arr.push(h.buffer);break;case q:c=B;h=new Float32Array(c.len);
h[0]=c.msg_id;h[1]=c.id;h[2]=c.body_id_hit;h[3]=c.hit_fract;h[4]=c.hit_time;a.buf_arr.push(h.buffer);break;case r:c=F;h=new Float32Array(c.len);h[0]=c.msg_id;h[1]=c.id;h[2]=c.body_id_hit;h[3]=c.hit_fract;h[4]=c.hit_time;h[5]=c.hit_pos[0];h[6]=c.hit_pos[1];h[7]=c.hit_pos[2];h[8]=c.hit_norm[0];h[9]=c.hit_norm[1];h[10]=c.hit_norm[2];a.buf_arr.push(h.buffer);break;case k:c=D;h=new Float32Array(c.len);h[0]=c.msg_id;h[1]=c.body_id_a;h[2]=c.body_id_b;h[3]=c.result;a.buf_arr.push(h.buffer);break;case d:c=
e;h=new Float32Array(c.len);h[0]=c.msg_id;h[1]=c.body_id_a;h[2]=c.body_id_b;h[3]=c.result;h[4]=c.coll_point[0];h[5]=c.coll_point[1];h[6]=c.coll_point[2];h[7]=c.coll_norm[0];h[8]=c.coll_norm[1];h[9]=c.coll_norm[2];h[10]=c.coll_dist;a.buf_arr.push(h.buffer);break;case C:c=z;h=new Float32Array(c.len);h[0]=c.msg_id;h[1]=c.body_id;h[2]=c.trans[0];h[3]=c.trans[1];h[4]=c.trans[2];h[5]=c.quat[0];h[6]=c.quat[1];h[7]=c.quat[2];h[8]=c.quat[3];a.buf_arr.push(h.buffer);break;default:h=[];for(c=1;c<arguments.length;c++)h.push(arguments[c]);
a.web_worker.postMessage(h)}};a.post_msg_arr=function(a){a&&a.buf_arr.length&&(a.web_worker.postMessage(a.buf_arr),a.buf_arr.length=0)};a.get_msg_cache=function(a){switch(a){case g:return n;case l:return A;case q:return B;case r:return F;case k:return D;case d:return e;case C:return z;default:return null}};a.terminate=function(a){a.web_worker.terminate();a.web_worker=null};a.is_active=function(a){return!!a.web_worker};a.is_fallback=function(a){return!!a.fb_worker_ns}};b4w.module.__hud=function(a,p){function t(a){a.font="bold 15px Courier";a.textBaseline="middle";a.shadowBlur=0;a.shadowColor=null}function c(a){b(' SCENE "'+a.name+'"');if(a._render){var c=0,d=0,f=0;r.traverse(a._render.graph,function(a,h){if("SINK"==h.type)b(" (F)",h.type);else{var e=h.type,g=Math.round(h.camera.width)+"x"+Math.round(h.camera.height),k=h.bundles.length,v=h.debug_render_calls;"MAIN_CUBE_REFLECT"==h.type&&(k*=6);var m=h.enqueue&&h.do_render,u=m?h.debug_render_time:0;b(m?" (A)":" (P)",
e,h.num_lights,g,v,"of",k,"  ",u.toFixed(3));h.debug_render_calls=0;m&&(c+=k,d+=v,f+=u)}});return[c,d,f]}b("No INFO")}function b(){for(var a=80+20*f[0],b=arguments[0],c=1;c<arguments.length;c++){for(var d=g[c]-String(arguments[c]).length,k="",l=0;l<d;l++)k+=" ";b+=k+arguments[c]}f[0]++;C.fillText(b,30,a)}function k(a,b,c,d,f){f.x=a;f.y=b;f.w=c;f.h=d;return f}function d(a,b,c){b*=a.w;c.x=a.x+b;c.y=a.y;c.w=a.w-2*b;c.h=a.h;return c}function l(a){return a.x+a.w/2}function q(a){var b=C,c={x:0,y:0,w:0,
h:0};k(0,0,b.canvas.width,b.canvas.height,c);d(c,.01,c);b=.02*c.h;c.x=c.x;c.y+=b;c.w=c.w;c.h-=2*b;b=c.w/8;c.x+=b*a;c.y=c.y;c.w=b;c.h=c.h;d(c,.02,c);return c}var r=p("__graph");p("__print");var g=[5,19,3,10,4,3,5],C=null,f=[0,0];a.init=function(a){a=a.getContext("2d");t(a);return C=a};a.update_dim=function(){C&&t(C)};a.reset=function(){var a=C;a&&(a.clearRect(0,0,a.canvas.width,a.canvas.height),a.fillStyle="rgba(0,0,0,0.5)",a.fillRect(0,0,a.canvas.width,a.canvas.height),f[0]=0,f[1]=0)};a.show_debug_info=
function(a,d){var g=C;if(g){g.textAlign="left";g.fillStyle="rgba(0,255,0,255)";b(" FPS",(1/d).toFixed(2));f[0]++;for(var k=g=0,l=0,q=0;q<a.length;q++){var e=c(a[q]),g=g+e[0],k=k+e[1],l=l+e[2];f[0]++}b(" -----------------------------------------------");b("    ","TOTAL ACTIVE","","",k,"of",g,"  ",l.toFixed(3))}};a.print=function(){var a=C;a&&(a.textAlign="left",a.fillStyle="rgba(0,255,0,255)",b.apply(Math,arguments))};a.plot_array=function(a,b,c,d,f,g,e){var k=C;if(k){b=q(b);var r=b.h/5;b.x=b.x;b.y+=
4*r;b.w=b.w;b.h=r;k.textAlign="center";k.fillStyle="#00FF00";C.fillText(a,l(b),b.y-10);k.strokeStyle="#00FF00";k.lineWidth=.5;k.beginPath();k.moveTo(b.x,b.y);k.lineTo(b.x+b.w,b.y);k.lineTo(b.x+b.w,b.y+b.h);k.lineTo(b.x,b.y+b.h);k.closePath();k.stroke();if(!g&&!e)for(g=1E6,e=-1E6,a=0;a<c.length;a++)g=Math.min(g,c[a]),e=Math.max(e,c[a]);k.textAlign="right";C.fillText(String(g),b.x-10,b.y+b.h);C.fillText(String(e),b.x-10,b.y);k.textAlign="center";C.fillText(String(d),b.x,b.y+b.h+15);C.fillText(String(f),
b.x+b.w,b.y+b.h+15);k.strokeStyle="#FF0000";k.lineWidth=1.5;k.beginPath();d=b.w/(c.length-1);e=b.h/(e-g);for(a=0;a<c.length;a++)f=b.x+d*a,r=b.y+b.h-(c[a]-g)*e,0==a?k.moveTo(f,r):k.lineTo(f,r);k.stroke()}};a.draw_mixer_strip=function(a,b,c,d,f,g,e){var z=C;if(z)for(z.textAlign="center",z.fillStyle="#00FF00",z.font="bold 12px Courier",c=q(c),C.fillText(b?"["+a+"]":a,l(c),c.y),0<=g&&C.fillText(g?"[M]":"[ ]",l(c)-15,c.y+30),0<=e&&C.fillText(e?"[S]":"[ ]",l(c)+15,c.y+30),a={x:0,y:0,w:0,h:0},b=0;b<d.length;b++){var r=
d[b];(e="VOLUME"==r[0])?k(c.x,c.y+350,c.w,250,a):k(c.x,c.y+10+50*b,c.w,c.h,a);g=z;var v=a,m=b==f,u=r[0],p=r[1],E=r[2],M=r[3],J=r[5],r=(M-E)/r[4],r=1>r?Math.floor(1/r-1E-5).toFixed(0).length:0,J=J?Math.log(p/E)/Math.log(M/E):(p-E)/(M-E);g.textAlign="center";m?g.fillText("["+u+"]",l(v),v.y):g.fillText(u,l(v),v.y);g.strokeStyle="#00FF00";g.lineWidth=e?3:1;e?(g.textAlign="right",g.fillText(M.toFixed(r),l(v)-10,v.y+15),g.textAlign="right",g.fillText(E.toFixed(r),l(v)-10,v.y+v.h-15)):(g.textAlign="right",
g.fillText(E.toFixed(r),v.x+28,v.y+15),g.textAlign="left",g.fillText(M.toFixed(r),v.x+v.w-28,v.y+15));g.beginPath();if(e){var O=v.y+15+(v.h-30)*(1-J);g.moveTo(l(v),v.y+15);g.lineTo(l(v),v.y+v.h-15);g.moveTo(l(v)-5,v.y+15);g.lineTo(l(v)+5,v.y+15);g.moveTo(l(v)-5,v.y+v.h-15);g.lineTo(l(v)+5,v.y+v.h-15);g.moveTo(l(v)-5,O);g.lineTo(l(v)+5,O)}else{var G=v.x+30+(v.w-60)*J;g.moveTo(v.x+30,v.y+15);g.lineTo(v.x+v.w-30,v.y+15);g.moveTo(v.x+30,v.y+15-5);g.lineTo(v.x+30,v.y+15+5);g.moveTo(v.x+v.w-30,v.y+15-5);
g.lineTo(v.x+v.w-30,v.y+15+5);g.moveTo(G,v.y+15-5);g.lineTo(G,v.y+15+5)}g.stroke();"EQ_Q"==u?(m=p,m=1+1/(2*m*m)+Math.sqrt((2+1/(m*m))*(2+1/(m*m))/4-1),m=Math.log(m)/Math.log(2),e?(g.textAlign="left",g.fillText(p.toFixed(r),l(v)+10,O),g.textAlign="left",g.fillText("("+m.toFixed(r+1)+")",l(v)+10,O+10)):(g.textAlign="right",g.fillText(p.toFixed(r),G,v.y+30),g.textAlign="left",g.fillText("("+m.toFixed(r+1)+")",G,v.y+30))):e?(g.textAlign="left",g.fillText(p.toFixed(r),l(v)+10,O)):(g.textAlign="center",
g.fillText(p.toFixed(r),G,v.y+30))}}};b4w.module.__renderer=function(a,p){function t(a){for(var c=a.camera,d=a.bundles,h=0;h<d.length;h++){var f=d[h];if(f.do_render){var g=a,n=c,l=f.obj_render,x=f.batch,q=x.shader;e.useProgram(q.program);for(var f=x.bufs_data,z=x.attribute_setters,I=q.transient_uniform_setters,r=I.length;r--;){var A=I[r];A.fun(e,A.loc,g,l,x,n)}n=x.color_mask;e.colorMask(n,n,n,n);e.depthMask(x.depth_mask);x.use_backface_culling?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE);n=x.textures;for(x=0;x<n.length;x++)I=n[x],e.activeTexture(e.TEXTURE0+
x),e.bindTexture(I.w_target,I.w_texture);if("SKY"==g.type){n=g;q=q.uniforms;x=n.camera.color_attachment.w_texture;I=n.cube_view_matrices;for(r=0;6>r;r++)if(A=k(r),v.clear_procedural_sky_hack?(e.bindTexture(e.TEXTURE_CUBE_MAP,x),e.texImage2D(A,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,D)):(e.uniformMatrix4fv(q.u_cube_view_matrix,!1,I[r]),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,A,x,0),b(f,z,l.va_frame)),n.need_fog_update&&3!=r){var A=n,p=r,w=y;v.clear_procedural_sky_hack?w.set(D):(e.readPixels(191,
191,1,1,e.RGBA,e.UNSIGNED_BYTE,w),255!=w[0]&&255!=w[1]&&255!=w[2]||e.readPixels(191,220,1,1,e.RGBA,e.UNSIGNED_BYTE,w));var C=w[0],da=w[1],w=w[2],C=C/255,da=da/255,w=w/255;2===p?(A.cube_fog[3]=C,A.cube_fog[7]=da,A.cube_fog[11]=w):2>p?(A.cube_fog[4*p]=C,A.cube_fog[4*p+1]=da,A.cube_fog[4*p+2]=w):(A.cube_fog[4*(p-2)]=C,A.cube_fog[4*(p-2)+1]=da,A.cube_fog[4*(p-2)+2]=w)}g.debug_render_calls+=6}else b(f,z,l.va_frame),g.debug_render_calls++}}}function c(a){if(a){var b=(a.clear_color?e.COLOR_BUFFER_BIT:0)|
(a.clear_depth?e.DEPTH_BUFFER_BIT:0);if(!b)return;switch(a.type){case "MAIN_GLOW":a=F;break;case "SHADOW_CAST":a=n;break;case "DEPTH":a=A;break;case "COLOR_PICKING":case "COLOR_PICKING_XRAY":case "ANCHOR_VISIBILITY":a=B;break;case "OUTLINE_MASK":case "SMAA_BLENDING_WEIGHT_CALCULATION":case "SMAA_EDGE_DETECTION":a=F;break;default:a=v.background_color}}else b=e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT,a=v.background_color;e.colorMask(!0,!0,!0,!0);e.depthMask(!0);e.clearColor(a[0],a[1],a[2],a[3]);e.clear(b)}
function b(a,b,c){e.bindBuffer(e.ARRAY_BUFFER,a.vbo);for(var d=0;d<b.length;d++){var h=b[d];e.enableVertexAttribArray(h.loc);e.vertexAttribPointer(h.loc,h.num_comp,e.FLOAT,!1,0,h.base_offset+h.frame_length*c)}a.ibo?(e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,a.ibo),e.drawElements(a.mode,a.count,a.ibo_type,0)):e.drawArrays(a.mode,0,a.count);for(d=0;d<b.length;d++)h=b[d],e.disableVertexAttribArray(h.loc)}function k(a){switch(a){case 0:return e.TEXTURE_CUBE_MAP_POSITIVE_X;case 1:return e.TEXTURE_CUBE_MAP_NEGATIVE_X;
case 2:return e.TEXTURE_CUBE_MAP_POSITIVE_Y;case 3:return e.TEXTURE_CUBE_MAP_NEGATIVE_Y;case 4:return e.TEXTURE_CUBE_MAP_POSITIVE_Z;case 5:return e.TEXTURE_CUBE_MAP_NEGATIVE_Z}}function d(a){var b=a.uniforms,c=[],d=[],e={},h;for(h in b){var g=!1;switch(h){case "u_proj_matrix":var k=function(a,b,c,d,e,h){a.uniformMatrix4fv(b,!1,h.proj_matrix)},g=!0;break;case "u_view_matrix":k=function(a,b,c,d,e,h){a.uniformMatrix4fv(b,!1,h.view_matrix)};g=!0;break;case "u_view_tsr":case "u_view_tsr_frag":k=function(a,
b,c,d,e,h){a.uniformMatrix3fv(b,!1,h.view_tsr)};g=!0;break;case "u_shadow_cast_billboard_view_tsr":k=function(a,b,c,d,e,h){a.uniformMatrix3fv(b,!1,h.shadow_cast_billboard_view_tsr)};g=!0;break;case "u_view_proj_prev":k=function(a,b,c,d,e,h){a.uniformMatrix4fv(b,!1,h.prev_view_proj_matrix)};g=!0;break;case "u_view_proj_matrix":k=function(a,b,c,d,e,h){a.uniformMatrix4fv(b,!1,h.view_proj_matrix)};g=!0;break;case "u_view_proj_inverse":k=function(a,b,c,d,e,h){a.uniformMatrix4fv(b,!1,h.view_proj_inv_matrix)};
g=!0;break;case "u_sky_vp_inverse":k=function(a,b,c,d,e,h){a.uniformMatrix4fv(b,!1,h.sky_vp_inv_matrix)};g=!0;break;case "u_camera_eye":case "u_camera_eye_frag":k=function(a,b,c,d,e,h){a.uniform3fv(b,f.get_trans_value(h.world_tsr,z))};g=!0;break;case "u_camera_quat":k=function(a,b,c,d,e,h){a.uniform4fv(b,f.get_quat_view(h.world_tsr))};g=!0;break;case "u_view_max_depth":k=function(a,b,c,d,e,h){a.uniform1f(b,h.far)};g=!0;break;case "u_camera_range":k=function(a,b,c,d,e,h){a.uniform2f(b,h.near,h.far)};
break;case "u_csm_center_dists":k=function(a,b,c,d,e,h){a.uniform4fv(b,h.csm_center_dists)};break;case "u_cam_water_depth":k=function(a,b,c,d,e,h){a.uniform1f(b,c.cam_water_depth)};g=!0;break;case "u_waves_height":k=function(a,b,c,d,e,h){a.uniform1f(b,c.water_waves_height)};break;case "u_waves_length":k=function(a,b,c,d,e,h){a.uniform1f(b,c.water_waves_length)};break;case "u_fog_color_density":k=function(a,b,c,d,e,h){a.uniform4fv(b,c.fog_color_density)};break;case "u_fog_params":k=function(a,b,c,
d,e,h){a.uniform4fv(b,c.fog_params)};break;case "u_underwater_fog_color_density":k=function(a,b,c,d,e,h){a.uniform4fv(b,c.water_fog_color_density)};break;case "u_bloom_key":k=function(a,b,c,d,e,h){a.uniform1f(b,c.bloom_key)};break;case "u_bloom_edge_lum":k=function(a,b,c,d,e,h){a.uniform1f(b,c.bloom_edge_lum)};break;case "u_time":k=function(a,b,c,d,e,h){a.uniform1f(b,c.time)};g=!0;break;case "u_wind":k=function(a,b,c,d,e,h){a.uniform3fv(b,c.wind)};g=!0;break;case "u_sky_tex_dvar":k=function(a,b,c,
d,e,h){a.uniform1f(b,c.sky_tex_default_value)};break;case "u_sky_tex_fac":k=function(a,b,c,d,e,h){a.uniform4fv(b,c.sky_tex_fac)};break;case "u_sky_tex_color":k=function(a,b,c,d,e,h){a.uniform3fv(b,c.sky_tex_color)};break;case "u_horizon_color":k=function(a,b,c,d,e,h){a.uniform3fv(b,c.horizon_color)};break;case "u_zenith_color":k=function(a,b,c,d,e,h){a.uniform3fv(b,c.zenith_color)};break;case "u_environment_energy":k=function(a,b,c,d,e,h){a.uniform1f(b,c.environment_energy)};break;case "u_sky_color":k=
function(a,b,c,d,e,h){a.uniform3fv(b,c.sky_color)};break;case "u_rayleigh_brightness":k=function(a,b,c,d,e,h){a.uniform1f(b,c.rayleigh_brightness)};break;case "u_mie_brightness":k=function(a,b,c,d,e,h){a.uniform1f(b,c.mie_brightness)};break;case "u_spot_brightness":k=function(a,b,c,d,e,h){a.uniform1f(b,c.spot_brightness)};break;case "u_scatter_strength":k=function(a,b,c,d,e,h){a.uniform1f(b,c.scatter_strength)};break;case "u_rayleigh_strength":k=function(a,b,c,d,e,h){a.uniform1f(b,c.rayleigh_strength)};
break;case "u_mie_strength":k=function(a,b,c,d,e,h){a.uniform1f(b,c.mie_strength)};break;case "u_rayleigh_collection_power":k=function(a,b,c,d,e,h){a.uniform1f(b,c.rayleigh_collection_power)};break;case "u_mie_collection_power":k=function(a,b,c,d,e,h){a.uniform1f(b,c.mie_collection_power)};break;case "u_mie_distribution":k=function(a,b,c,d,e,h){a.uniform1f(b,c.mie_distribution)};break;case "u_light_positions":k=function(a,b,c,d,e,h){a.uniform3fv(b,c.light_positions)};break;case "u_light_directions":k=
function(a,b,c,d,e,h){a.uniform3fv(b,c.light_directions)};break;case "u_light_color_intensities":k=function(a,b,c,d,e,h){a.uniform3fv(b,c.light_color_intensities)};break;case "u_light_factors":k=function(a,b,c,d,e,h){a.uniform4fv(b,c.light_factors)};break;case "u_sun_quaternion":k=function(a,b,c,d,e,h){a.uniform4fv(b,c.sun_quaternion)};break;case "u_sun_intensity":k=function(a,b,c,d,e,h){a.uniform3fv(b,c.sun_intensity)};break;case "u_sun_direction":k=function(a,b,c,d,e,h){a.uniform3fv(b,c.sun_direction)};
break;case "u_height":k=function(a,b,c,d,e,h){a.uniform1f(b,h.height)};g=!0;break;case "u_model_tsr":k=function(a,b,c,d,e,h){a.uniformMatrix3fv(b,!1,d.world_tsr)};g=!0;break;case "u_transb":k=function(a,b,c,d,e,h){a.uniform4fv(b,d.trans_before)};g=!0;break;case "u_transa":k=function(a,b,c,d,e,h){a.uniform4fv(b,d.trans_after)};g=!0;break;case "u_arm_rel_trans":k=function(a,b,c,d,e,h){a.uniform4fv(b,d.arm_rel_trans)};g=!0;break;case "u_arm_rel_quat":k=function(a,b,c,d,e,h){a.uniform4fv(b,d.arm_rel_quat)};
g=!0;break;case "u_quat":k=function(a,b,c,d,e,h){c=f.get_quat_view(d.world_tsr);a.uniform4fv(b,c)};g=!0;break;case "u_quatsb":k=function(a,b,c,d,e,h){a.uniform4fv(b,d.quats_before)};g=!0;break;case "u_quatsa":k=function(a,b,c,d,e,h){a.uniform4fv(b,d.quats_after)};g=!0;break;case "u_frame_factor":k=function(a,b,c,d,e,h){a.uniform1f(b,d.frame_factor)};g=!0;break;case "au_center_pos":k=function(a,b,c,d,e,h){};g=!0;break;case "au_wind_bending_amp":k=function(a,b,c,d,e,h){a.uniform1f(b,d.wind_bending_amp)};
g=!0;break;case "au_wind_bending_freq":k=function(a,b,c,d,e,h){a.uniform1f(b,d.wind_bending_freq)};g=!0;break;case "au_detail_bending_freq":k=function(a,b,c,d,e,h){a.uniform1f(b,d.detail_bending_freq)};g=!0;break;case "au_detail_bending_amp":k=function(a,b,c,d,e,h){a.uniform1f(b,d.detail_bending_amp)};g=!0;break;case "au_branch_bending_amp":k=function(a,b,c,d,e,h){a.uniform1f(b,d.branch_bending_amp)};g=!0;break;case "u_node_values":k=function(a,b,c,d,e,h){a.uniform1fv(b,d.mats_values)};g=!0;break;
case "u_node_rgbs":k=function(a,b,c,d,e,h){a.uniform3fv(b,d.mats_rgbs)};g=!0;break;case "u_diffuse_color":k=function(a,b,c,d,e,h){a.uniform4fv(b,e.diffuse_color)};g=!0;break;case "u_diffuse_intensity":k=function(a,b,c,d,e,h){a.uniform1f(b,e.diffuse_intensity)};g=!0;break;case "u_diffuse_params":k=function(a,b,c,d,e,h){a.uniform2fv(b,e.diffuse_params)};g=!0;break;case "u_emit":k=function(a,b,c,d,e,h){a.uniform1f(b,e.emit)};g=!0;break;case "u_ambient":k=function(a,b,c,d,e,h){a.uniform1f(b,e.ambient)};
g=!0;break;case "u_specular_color":k=function(a,b,c,d,e,h){a.uniform3fv(b,e.specular_color)};g=!0;break;case "u_specular_alpha":k=function(a,b,c,d,e,h){a.uniform1f(b,e.specular_alpha)};g=!0;break;case "u_specular_params":k=function(a,b,c,d,e,h){a.uniform3fv(b,e.specular_params)};g=!0;break;case "u_reflect_factor":k=function(a,b,c,d,e,h){a.uniform1f(b,e.reflect_factor)};g=!0;break;case "u_mirror_factor":k=function(a,b,c,d,e,h){a.uniform1f(b,e.mirror_factor)};g=!0;break;case "u_grass_map_dim":k=function(a,
b,c,d,e,h){a.uniform3fv(b,e.grass_map_dim)};g=!0;break;case "u_grass_size":k=function(a,b,c,d,e,h){a.uniform1f(b,e.grass_size)};g=!0;break;case "u_scale_threshold":k=function(a,b,c,d,e,h){a.uniform1f(b,e.grass_scale_threshold)};g=!0;break;case "u_cube_fog":k=function(a,b,c,d,e,h){a.uniformMatrix4fv(b,!1,e.cube_fog)};break;case "u_jitter_amp":k=function(a,b,c,d,e,h){a.uniform1f(b,e.jitter_amp)};g=!0;break;case "u_jitter_freq":k=function(a,b,c,d,e,h){a.uniform1f(b,e.jitter_freq)};g=!0;break;case "u_wireframe_mode":k=
function(a,b,c,d,e,h){a.uniform1i(b,e.wireframe_mode)};break;case "u_wireframe_edge_color":k=function(a,b,c,d,e,h){a.uniform3fv(b,e.wireframe_edge_color)};break;case "u_subpixel_jitter":k=function(a,b,c,d,e,h){a.uniform2fv(b,c.jitter_projection_space)};g=!0;break;case "u_subsample_indices":k=function(a,b,c,d,e,h){a.uniform4fv(b,c.jitter_subsample_ind)};g=!0;break;case "u_refr_bump":k=function(a,b,c,d,e,h){a.uniform1f(b,e.refr_bump)};g=!0;break;case "u_line_width":k=function(a,b,c,d,e,h){a.uniform1f(b,
e.line_width)};g=!0;break;case "u_lamp_light_positions":k=function(a,b,c,d,e,h){a.uniform3fv(b,e.lamp_light_positions)};break;case "u_lamp_light_directions":k=function(a,b,c,d,e,h){a.uniform3fv(b,e.lamp_light_directions)};break;case "u_lamp_light_color_intensities":k=function(a,b,c,d,e,h){a.uniform3fv(b,e.lamp_light_color_intensities)};break;case "u_lamp_light_factors":k=function(a,b,c,d,e,h){a.uniform4fv(b,e.lamp_light_factors)};break;case "u_halo_size":k=function(a,b,c,d,e,h){a.uniform1f(b,e.halo_size)};
g=!0;break;case "u_halo_hardness":k=function(a,b,c,d,e,h){a.uniform1f(b,e.halo_hardness)};g=!0;break;case "u_halo_rings_color":k=function(a,b,c,d,e,h){a.uniform3fv(b,e.halo_rings_color)};g=!0;break;case "u_halo_lines_color":k=function(a,b,c,d,e,h){a.uniform3fv(b,e.halo_lines_color)};g=!0;break;case "u_halo_stars_blend":k=function(a,b,c,d,e,h){a.uniform1f(b,e.halo_stars_blend)};g=!0;break;case "u_halo_stars_height":k=function(a,b,c,d,e,h){a.uniform1f(b,e.halo_stars_height)};g=!0;break;case "u_fresnel_params":k=
function(a,b,c,d,e,h){a.uniform4fv(b,e.fresnel_params)};g=!0;break;case "u_texture_scale":k=function(a,b,c,d,e,h){a.uniform3fv(b,e.texture_scale)};g=!0;break;case "u_parallax_scale":k=function(a,b,c,d,e,h){a.uniform1f(b,e.parallax_scale)};g=!0;break;case "u_color_id":k=function(a,b,c,d,e,h){a.uniform3fv(b,d.color_id)};g=!0;break;case "u_line_points":k=function(a,b,c,d,e,h){a.uniform3fv(b,e.line_points)};g=!0;break;case "u_diffuse_color_factor":k=function(a,b,c,d,e,h){a.uniform1f(b,e.diffuse_color_factor)};
g=!0;break;case "u_alpha_factor":k=function(a,b,c,d,e,h){a.uniform1f(b,e.alpha_factor)};g=!0;break;case "u_specular_color_factor":k=function(a,b,c,d,e,h){a.uniform1f(b,e.specular_color_factor)};g=!0;break;case "u_normal_factor":k=function(a,b,c,d,e,h){a.uniform1f(b,e.normal_factor)};g=!0;break;case "u_normalmap0_scale":k=function(a,b,c,d,e,h){a.uniform2fv(b,e.normalmap_scales[0])};g=!0;break;case "u_normalmap1_scale":k=function(a,b,c,d,e,h){a.uniform2fv(b,e.normalmap_scales[1])};g=!0;break;case "u_normalmap2_scale":k=
function(a,b,c,d,e,h){a.uniform2fv(b,e.normalmap_scales[2])};g=!0;break;case "u_normalmap3_scale":k=function(a,b,c,d,e,h){a.uniform2fv(b,e.normalmap_scales[3])};g=!0;break;case "u_foam_factor":k=function(a,b,c,d,e,h){a.uniform1f(b,e.foam_factor)};g=!0;break;case "u_foam_uv_freq":k=function(a,b,c,d,e,h){a.uniform2fv(b,e.foam_uv_freq)};g=!0;break;case "u_foam_mag":k=function(a,b,c,d,e,h){a.uniform2fv(b,e.foam_mag)};g=!0;break;case "u_foam_scale":k=function(a,b,c,d,e,h){a.uniform2fv(b,e.foam_scale)};
g=!0;break;case "u_water_norm_uv_velocity":k=function(a,b,c,d,e,h){a.uniform1f(b,e.water_norm_uv_velocity)};g=!0;break;case "u_shallow_water_col":k=function(a,b,c,d,e,h){a.uniform3fv(b,e.shallow_water_col)};g=!0;break;case "u_shore_water_col":k=function(a,b,c,d,e,h){a.uniform3fv(b,e.shore_water_col)};g=!0;break;case "u_water_shallow_col_fac":k=function(a,b,c,d,e,h){a.uniform1f(b,e.shallow_water_col_fac)};g=!0;break;case "u_water_shore_col_fac":k=function(a,b,c,d,e,h){a.uniform1f(b,e.shore_water_col_fac)};
g=!0;break;case "u_p_length":k=function(a,b,c,d,e,h){a.uniform1f(b,e.particles_data.time_length)};g=!0;break;case "u_p_cyclic":k=function(a,b,c,d,e,h){a.uniform1i(b,e.particles_data.cyclic)};g=!0;break;case "u_p_max_lifetime":k=function(a,b,c,d,e,h){a.uniform1f(b,e.particles_data.lifetime)};g=!0;break;case "u_p_fade_in":k=function(a,b,c,d,e,h){a.uniform1f(b,e.particles_data.fade_in)};g=!0;break;case "u_p_fade_out":k=function(a,b,c,d,e,h){a.uniform1f(b,e.particles_data.fade_out)};g=!0;break;case "u_p_size":k=
function(a,b,c,d,e,h){a.uniform1f(b,e.particles_data.size)};g=!0;break;case "u_p_alpha_start":k=function(a,b,c,d,e,h){a.uniform1f(b,e.particles_data.alpha_start)};g=!0;break;case "u_p_alpha_end":k=function(a,b,c,d,e,h){a.uniform1f(b,e.particles_data.alpha_end)};g=!0;break;case "u_p_nfactor":k=function(a,b,c,d,e,h){a.uniform1f(b,e.particles_data.nfactor)};g=!0;break;case "u_p_gravity":k=function(a,b,c,d,e,h){a.uniform1f(b,e.particles_data.gravity)};g=!0;break;case "u_p_mass":k=function(a,b,c,d,e,h){a.uniform1f(b,
e.particles_data.mass)};g=!0;break;case "u_p_size_ramp":k=function(a,b,c,d,e,h){a.uniform2fv(b,e.particles_data.size_ramp)};g=!0;break;case "u_p_color_ramp":k=function(a,b,c,d,e,h){a.uniform4fv(b,e.particles_data.color_ramp)};g=!0;break;case "u_p_wind_fac":k=function(a,b,c,d,e,h){a.uniform1f(b,e.particles_data.wind_factor)};g=!0;break;case "u_texel_size":k=function(a,b,c,d,e,h){a.uniform2fv(b,c.texel_size)};g=!0;break;case "u_p_time":k=function(a,b,c,d,e,h){a.uniform1f(b,e.particles_data.time)};g=
!0;break;case "u_position":k=function(a,b,c,d,e,h){a.uniform3fv(b,e.positions)};g=!0;break;case "u_va_frame_factor":k=function(a,b,c,d,e,h){a.uniform1f(b,d.va_frame_factor)};g=!0;break;case "u_normal_offset":k=function(a,b,c,d,e,h){a.uniform1f(b,c.self_shadow_normal_offset)};break;case "u_pcf_blur_radii":k=function(a,b,c,d,e,h){a.uniform4fv(b,h.pcf_blur_radii)};break;case "u_v_light_ts":k=function(a,b,c,d,e,h){a.uniform4fv(b,c.v_light_ts)};g=!0;break;case "u_v_light_r":k=function(a,b,c,d,e,h){a.uniform4fv(b,
c.v_light_r)};g=!0;break;case "u_v_light_tsr":k=function(a,b,c,d,e,h){a.uniformMatrix3fv(b,!1,c.v_light_tsr)};g=!0;break;case "u_p_light_matrix0":k=function(a,b,c,d,e,h){a.uniformMatrix4fv(b,!1,c.p_light_matrix[0])};g=!0;break;case "u_p_light_matrix1":k=function(a,b,c,d,e,h){a.uniformMatrix4fv(b,!1,c.p_light_matrix[1])};g=!0;break;case "u_p_light_matrix2":k=function(a,b,c,d,e,h){a.uniformMatrix4fv(b,!1,c.p_light_matrix[2])};g=!0;break;case "u_p_light_matrix3":k=function(a,b,c,d,e,h){a.uniformMatrix4fv(b,
!1,c.p_light_matrix[3])};g=!0;break;case "u_motion_blur_exp":k=function(a,b,c,d,e,h){a.uniform1f(b,c.motion_blur_exp)};g=!0;break;case "u_motion_blur_decay_threshold":k=function(a,b,c,d,e,h){a.uniform1f(b,c.mb_decay_threshold)};g=!0;break;case "u_refl_plane":k=function(a,b,c,d,e,h){a.uniform4fv(b,d.reflection_plane)};g=!0;break;case "u_radial_blur_step":k=function(a,b,c,d,e,h){a.uniform1f(b,c.radial_blur_step)};break;case "u_god_rays_intensity":k=function(a,b,c,d,e,h){a.uniform1f(b,c.god_rays_intensity)};
break;case "u_ssao_radius_increase":k=function(a,b,c,d,e,h){a.uniform1f(b,c.ssao_radius_increase)};break;case "u_ssao_blur_discard_value":k=function(a,b,c,d,e,h){a.uniform1f(b,c.ssao_blur_discard_value)};g=!0;break;case "u_ssao_influence":k=function(a,b,c,d,e,h){a.uniform1f(b,c.ssao_influence)};break;case "u_ssao_dist_factor":k=function(a,b,c,d,e,h){a.uniform1f(b,c.ssao_dist_factor)};break;case "u_dof_dist":k=function(a,b,c,d,e,h){h.dof_on?a.uniform1f(b,h.dof_distance):a.uniform1f(b,0)};g=!0;break;
case "u_dof_front":k=function(a,b,c,d,e,h){a.uniform1f(b,h.dof_front)};g=!0;break;case "u_dof_rear":k=function(a,b,c,d,e,h){a.uniform1f(b,h.dof_rear)};g=!0;break;case "u_outline_intensity":k=function(a,b,c,d,e,h){a.uniform1f(b,d.outline_intensity)};g=!0;break;case "u_outline_color":k=function(a,b,c,d,e,h){a.uniform3fv(b,c.outline_color)};break;case "u_draw_outline":k=function(a,b,c,d,e,h){a.uniform1f(b,c.draw_outline_flag)};g=!0;break;case "u_glow_mask_small_coeff":k=function(a,b,c,d,e,h){a.uniform1f(b,
c.small_glow_mask_coeff)};g=!0;break;case "u_glow_mask_large_coeff":k=function(a,b,c,d,e,h){a.uniform1f(b,c.large_glow_mask_coeff)};g=!0;break;case "u_brightness":k=function(a,b,c,d,e,h){a.uniform1f(b,c.brightness)};break;case "u_contrast":k=function(a,b,c,d,e,h){a.uniform1f(b,c.contrast)};break;case "u_exposure":k=function(a,b,c,d,e,h){a.uniform1f(b,c.exposure)};break;case "u_saturation":k=function(a,b,c,d,e,h){a.uniform1f(b,c.saturation)};break;case "u_enable_hmd_stereo":k=function(a,b,c,d,e,h){a.uniform1i(b,
c.enable_hmd_stereo)};break;case "u_distortion_params":k=function(a,b,c,d,e,h){a.uniform4fv(b,c.distortion_params)};break;case "u_chromatic_aberration_coefs":k=function(a,b,c,d,e,h){a.uniform4fv(b,c.chromatic_aberration_coefs)};break;default:k=null}k&&(k={name:h,fun:k,loc:b[h]},g?c.push(k):(d.push(k),e[h]=k))}a.transient_uniform_setters=c;a.permanent_uniform_setters=d;a.permanent_uniform_setters_table=e}var l=p("__batch"),q=p("__camera"),r=p("__config"),g=p("__debug"),C=p("__textures"),f=p("__tsr"),
h=p("__util"),n=[1,1,1,1],A=[1,1,1,1],B=[0,0,0,1],F=[0,0,0,0],D=new Uint8Array([91.8,142.8,.96*255,255]);new Float32Array([.25,-.25]);new Float32Array([-.25,.25]);new Float32Array([1,1,1,0]);new Float32Array([2,2,2,0]);var e=null,z=new Float32Array(3),y=new Uint8Array(4);new Float32Array(9);new Float32Array(8);var v=r.defaults;a.setup_context=function(a){var b=v.background_color;a.clearColor(b[0],b[1],b[2],b[3]);a.clearDepth(1);a.enable(a.DEPTH_TEST);a.depthFunc(a.LEQUAL);a.enable(a.CULL_FACE);a.frontFace(a.CCW);
a.cullFace(a.BACK);a.enable(a.BLEND);a.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA);e=a};a.draw=function(a){if(a.do_render)if("RESOLVE"==a.type){g.render_time_start(a);var b=a.camera;e.bindFramebuffer(e.READ_FRAMEBUFFER,b.framebuffer_prev);e.bindFramebuffer(e.DRAW_FRAMEBUFFER,b.framebuffer);e.blitFramebuffer(0,0,b.width,b.height,0,0,b.width,b.height,e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT,e.NEAREST);g.render_time_stop(a);g.check_gl("draw resolve")}else if("COPY"==a.type)g.render_time_start(a),b=a.camera,
e.bindFramebuffer(e.FRAMEBUFFER,b.framebuffer_prev),e.bindTexture(e.TEXTURE_2D,b.color_attachment.w_texture),e.copyTexSubImage2D(e.TEXTURE_2D,0,0,0,0,0,b.width,b.height,0),g.render_time_stop(a),g.check_gl("draw copy");else{g.render_time_start(a);b=a.camera;e.bindFramebuffer(e.FRAMEBUFFER,b.framebuffer);if(a.assign_texture){var h=b.color_attachment;e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,h.w_target,h.w_texture,0)}e.viewport(0,0,b.width,b.height);"MAIN_CUBE_REFLECT"!=a.type&&c(a);a.blend?
e.enable(e.BLEND):e.disable(e.BLEND);a.depth_test?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST);if(a.need_perm_uniforms_update){for(var b=a.camera,h=a.bundles,n=0;n<h.length;n++){var l=h[n],z=l.batch,r=z.shader;e.useProgram(r.program);l=l.obj_render;r.permanent_uniform_setters.length||d(r);for(var r=r.permanent_uniform_setters,y=r.length;y--;){var x=r[y];x.fun(e,x.loc,a,l,z,b)}}a.need_perm_uniforms_update=!1}switch(a.type){case "DEPTH":v.ios_depth_hack?(e.enable(e.POLYGON_OFFSET_FILL),e.polygonOffset(5,
5)):e.disable(e.POLYGON_OFFSET_FILL);e.cullFace(e.BACK);break;case "SHADOW_CAST":e.enable(e.POLYGON_OFFSET_FILL);e.polygonOffset(a.self_shadow_polygon_offset,a.self_shadow_polygon_offset);e.cullFace(e.BACK);break;case "MAIN_PLANE_REFLECT":e.disable(e.POLYGON_OFFSET_FILL);e.cullFace(e.FRONT);break;case "MAIN_GLOW":if(1<v.msaa_samples){e.enable(e.POLYGON_OFFSET_FILL);e.polygonOffset(-2,-2);break}default:e.disable(e.POLYGON_OFFSET_FILL),e.cullFace(e.BACK)}if("MAIN_CUBE_REFLECT"==a.type)for(b=a.camera,
h=b.color_attachment.w_texture,n=0;6>n;n++){z=k(n);b.view_matrix=a.cube_view_matrices[n];f.from_mat4(b.view_matrix,b.view_tsr);q.calc_sky_vp_inverse(b);e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,z,h,0);c(a);z=a.bundles;for(l=0;l<z.length;l++)z[l].do_render=z[l].do_render_cube[n];t(a)}else t(a);g.render_time_stop(a);g.check_gl("draw subscene: "+a.type);e.bindFramebuffer(e.FRAMEBUFFER,null)}};a.clear=function(a){e.bindFramebuffer(e.FRAMEBUFFER,a.camera.framebuffer);c(a)};a.assign_attribute_setters=
function(a){var b=a.attribute_setters;b.length=0;var c=a.bufs_data;a=a.shader;c&&a||h.panic("Incomplete batch");c=c.pointers;a=a.attributes;for(var d in a){var e=c[d];b.push({loc:a[d],base_offset:4*e.offset,frame_length:1<e.frames?4*e.length:0,num_comp:e.num_comp})}};a.assign_uniform_setters=d;a.assign_texture_uniforms=function(a){var b=a.shader,c=a.textures;a=a.texture_names;e.useProgram(b.program);for(var d=0;d<c.length;d++)e.uniform1i(b.uniforms[a[d]],d)};a.read_pixels=function(a,b,c,d,g,f){d||
(d=1);g||(g=1);f||(f=new Uint8Array(4*d*g));f.length!=4*d*g&&h.panic("read_pixels(): Wrong storage");e.bindFramebuffer(e.FRAMEBUFFER,a);e.readPixels(b,c,d,g,e.RGBA,e.UNSIGNED_BYTE,f);e.bindFramebuffer(e.FRAMEBUFFER,null);return f};a.update_batch_permanent_uniform=function(a,b){var c=a.shader;e.useProgram(c.program);c.permanent_uniform_setters.length||d(c);c=c.permanent_uniform_setters_table[b];c.fun(e,c.loc,null,null,a,null)};a.render_target_create=function(a,b){var c=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,
c);if(C.is_renderbuffer(a)){var d=a.w_renderbuffer;e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,d)}else if(C.is_texture(a)){var h=a,d=h.w_texture,h=h.w_target==e.TEXTURE_CUBE_MAP?e.TEXTURE_CUBE_MAP_NEGATIVE_Z:h.w_target;e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,h,d,0)}C.is_renderbuffer(b)?(d=b.w_renderbuffer,e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,d)):C.is_texture(b)&&(h=b,d=h.w_texture,h=h.w_target,e.framebufferTexture2D(e.FRAMEBUFFER,
e.DEPTH_ATTACHMENT,h,d,0));g.check_bound_fb();e.bindFramebuffer(e.FRAMEBUFFER,null);return c};a.render_target_cleanup=function(a,b,c,d,h){null==a?(e.bindFramebuffer(e.FRAMEBUFFER,a),e.viewport(0,0,d,h),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT)):(C.is_renderbuffer(b)?e.deleteRenderbuffer(b.w_renderbuffer):C.is_texture(b)&&e.deleteTexture(b.w_texture),C.is_renderbuffer(c)?e.deleteRenderbuffer(c.w_renderbuffer):C.is_texture(c)&&e.deleteTexture(c.w_texture),e.deleteFramebuffer(a))};a.increment_subpixel_index=
function(){};a.draw_resized_cubemap_texture=function(a,c,d,h,g,f){a=a.w_texture;e.viewport(0,0,d,d);e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,c,a,0);c=l.create_postprocessing_batch("FLIP_CUBEMAP_COORDS");a=c.shader;e.activeTexture(e.TEXTURE0);e.bindTexture(e.TEXTURE_2D,g);var k=g=0;d!=h&&(g=1/(6*h),k=1/(4*h));e.uniform1i(a.uniforms.u_tex_number,f);e.uniform2fv(a.uniforms.u_delta,[g,k]);e.useProgram(a.program);b(c.bufs_data,c.attribute_setters,0);e.bindTexture(e.TEXTURE_2D,null)};a.draw_resized_texture=
function(a,c,d,h,g,f){e.bindFramebuffer(e.FRAMEBUFFER,h);h=a.w_texture;a=a.w_target;e.bindTexture(a,h);e.viewport(0,0,c,d);e.texImage2D(a,0,e.RGBA,c,d,0,e.RGBA,e.UNSIGNED_BYTE,null);e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,a,h,0);c=l.create_postprocessing_batch(f);d=c.shader;e.bindTexture(a,null);e.activeTexture(e.TEXTURE0);e.bindTexture(a,g);e.useProgram(d.program);b(c.bufs_data,c.attribute_setters,0);e.bindFramebuffer(e.FRAMEBUFFER,null);e.bindTexture(a,null)};a.cleanup=function(){}};b4w.module.__shaders=function(a,p){function t(a,b,d){var e=a.directives;"string"==typeof d&&(a=c(a,d))&&(d=a[1]);for(a=0;a<e.length;a++)if(e[a][0]==b){e[a][1]=d;return}e.push([b,d])}function c(a,b){for(var c=a.directives,d=0;d<c.length;d++)if(c[d][0]==b)return c[d];return!1}function b(a,b){var c=a+b;if(D[c])return D[c];if(e){var d=e[b];if(!d)return null;d=p("__gpp_parser").parser.parse(d)}else if(d=p("shader_texts")[b],!d)return null;return D[c]=d}function k(a,c,e){function h(c){c=c.parts;for(var e=
0;e<c.length;e++){var v=c[e];switch(v.type){case "condition":a:for(var v=v.parts,y=0;y<v.length;y++){var E=v[y];switch(E.type){case "if":case "elif":if(g(E.expression)){h(E.group);break a}break;case "else":h(E.group);break a;case "ifdef":E.name in l&&h(E.group);break;case "ifndef":E.name in l||h(E.group)}}break;case "include":v=b(B.shaders_dir,B.shaders_include_dir+v.file);h(v);break;case "var":case "export":case "import":break;case "define":y=v.name;l[y]=v.tokens;v.params&&(q[y]=v.params);break;
case "error":throw"Shader error: #error "+v.tokens.join(" ");case "line":break;case "pragma":m.push("#pragma "+v.name+" "+v.tokens.join(" "));break;case "undef":v=v.name;delete l[v];delete q[v];break;case "warning":n.warn("Shader warning: #warning "+v.tokens.join(" "));break;case "extension":v=d(v.tokens,l,q,!1);m.push("#extension "+v.join(" "));break;case "#":break;case "node":z[v.name]=v;break;case "nodes_global":v=k;for(y=0;y<v.length;y++){var E=v[y],A=z[E.id];if(A)for(var t=0,D=0;D<A.declarations.length;D++){var N=
A.declarations[D];"node_param"==N.type&&(N=N.qualifier.join(" ")+" ","vert"==a?N+=E.vparams[t]:"frag"==a&&(N+=E.params[t],null!==E.param_values[t]&&(N+=" = "+E.param_values[t])),N+=";",m.push(N),t++)}}break;case "nodes_main":v=k;for(y=0;y<v.length;y++)if(E=v[y],A=z[E.id]){t={};D={};for(N=0;N<E.dirs.length;N++)D[E.dirs[N][0]]=[E.dirs[N][1]];C=p=w=0;for(var N=E,Z=A.declarations,ba=t,Q=D,K=0;K<Z.length;K++){var P=Z[K];switch(P.type){case "node_in":var F=N.inputs[w];if(null!==N.input_values[w]){if(("MATERIAL_BEGIN"==
N.id&&3===w||!Q.MATERIAL_EXT&&("MATERIAL_BEGIN"==N.id&&4===w||"MATERIAL_END"==N.id&&3===w||"MATERIAL_END"==N.id&&4===w||"MATERIAL_END"==N.id&&5===w)||"TEXTURE_COLOR"==N.id||"TEXTURE_NORMAL"==N.id)&&P.is_optional){ba[P.name]=N.input_values[w];w++;continue}var ka=P.qualifier.join(" ")+" ",ka=ka+F,ka=ka+(" = "+N.input_values[w]),ka=ka+";";m.push(ka)}ba[P.name]=F;w++;break;case "node_out":F=N.outputs[p];if(!P.is_optional||-1<r.indexOf(F))ka=P.qualifier.join(" ")+" ",ka+=F,ka+=";",m.push(ka),ba[P.name]=
F;-1<r.indexOf(F)&&(Q["USE_OUT_"+P.name]=[1]);p++;break;case "node_param":"vert"==a?F=N.vparams[C]:"frag"==a&&(F=N.params[C]),ba[P.name]=F,C++}}m.push("{");f(E,A.statements,t,D);m.push("}")}break;case "textline":v=d(v.tokens,l,q,!1);m.push(v.join(" "));break;default:throw"Unknown element type: "+v.type;}}}function g(a,b){var c;c=d(a,l,q,!0,b);for(var e=[],h=0;h<c.length;h++)if(c[h]instanceof Object)switch(c[h].type){case "conditional_expr":var f=e.pop(),m=e.pop();e.pop()?e.push(m):e.push(f);break;
case "logical_or_expr":f=e.pop();for(m=0;m<c[h].places-1;m++)k=e.pop(),f=f||k;e.push(f);break;case "logical_and_expr":f=e.pop();for(m=0;m<c[h].places-1;m++)k=e.pop(),f=f&&k;e.push(f);break;case "logical_bitor_expr":f=e.pop();for(m=0;m<c[h].places-1;m++)f|=e.pop();e.push(f);break;case "logical_bitxor_expr":f=e.pop();for(m=0;m<c[h].places-1;m++)f^=e.pop();e.push(f);break;case "logical_bitand_expr":f=e.pop();for(m=0;m<c[h].places-1;m++)f&=e.pop();e.push(f);break;case "equal_expr":f=e.pop();m=e.pop();
e.push(m==f);break;case "non_equal_expr":f=e.pop();m=e.pop();e.push(m!=f);break;case "le_expr":f=e.pop();m=e.pop();e.push(m<=f);break;case "ge_expr":f=e.pop();m=e.pop();e.push(m>=f);break;case "l_expr":f=e.pop();m=e.pop();e.push(m<f);break;case "g_expr":f=e.pop();m=e.pop();e.push(m>f);break;case "left_shift_expr":m=e.pop();f=e.pop();e.push(m<<f);break;case "right_shift_expr":m=e.pop();f=e.pop();e.push(m>>f);break;case "add_expr":m=e.pop();f=e.pop();e.push(m+f);break;case "sub_expr":m=e.pop();f=e.pop();
e.push(m-f);break;case "mul_expr":m=e.pop();f=e.pop();e.push(m*f);break;case "div_expr":m=e.pop();f=e.pop();e.push(m/f);break;case "mod_expr":m=e.pop();f=e.pop();e.push(m%f);break;case "pre_inc_expr":case "post_inc_expr":k=e.pop();e.push(++k);break;case "pre_dec_expr":case "post_dec_expr":k=e.pop();e.push(--k);break;case "positive_expr":k=e.pop();e.push(+k);break;case "negative_expr":k=e.pop();e.push(-k);break;case "one_compl_expr":k=e.pop();e.push(~k);break;case "logic_negative_expr":k=e.pop();e.push(!k);
break;default:A.panic("Unknown operation type: "+c[h].type)}else{var k=c[h];/^[a-zA-Z_$][a-zA-Z_$0-9]*$/.test(k)?e.push(0):e.push(parseFloat(c[h]))}1==e.length?c=e[0]:(A.panic("Incorrect expression: "+c.join(" ")),c=void 0);return c}function f(a,b,c,e){for(var h=0;h<b.length;h++){var k=b[h];switch(k.type){case "node_condition":a:for(var n=a,k=k.parts,u=c,w=e,v=0;v<k.length;v++){var z=k[v];switch(z.type){case "node_if":case "node_elif":if(g(z.expression,w)){f(n,z.statements,u,w);break a}break;case "node_else":f(n,
z.statements,u,w);break a;case "node_ifdef":(z.name in l||z.name in w)&&f(n,z.statements,u,w);break;case "node_ifndef":z.name in l||z.name in w||f(n,z.statements,u,w)}}break;case "textline":n=[];for(u=0;u<k.tokens.length;u++)w=k.tokens[u],w in c?n.push(c[w]):n.push(w);n=d(n,l,q,!0,e);m.push(n.join(" "))}}}var k=e.node_elements;e=e.directives||[];for(var m=[],l={},v=0;v<e.length;v++)l[e[v][0]]=[e[v][1]];for(v=0;v<k.length;v++)l["USE_NODE_"+k[v].id]=[1];var q={},z={},r=[];for(v in k)for(var y in k[v].inputs)r.push(k[v].inputs[y]);
h(c);var w=0,p=0,C=0;return m.join("\n")}function d(a,b,c,d,e){var h=[];l(a,b,c,d,h,e);return h}function l(a,b,c,d,e,h){for(var f=0;f<a.length;f++){var g=a[f];g in b||h&&g in h?(g=h&&h[g]||b[g],0==g.length&&d?e.push(0):l(g,b,c,d,e,h)):e.push(g)}}function q(a,b,c,d,e){d=a.createShader(d);a.shaderSource(d,c);a.compileShader(d);h.check_shader_compiling(d,b,c);return d}function r(a,b){!b&&a.length?b=a.length:b||(b=1);switch(b){case 1:return g(a);case 2:return"vec2("+g(a[0])+","+g(a[1])+")";case 3:return"vec3("+
g(a[0])+","+g(a[1])+","+g(a[2])+")";case 4:return"vec4("+g(a[0])+","+g(a[1])+","+g(a[2])+","+g(a[3])+")";case 9:return"mat3("+g(a[0])+","+g(a[1])+","+g(a[2])+","+g(a[3])+","+g(a[4])+","+g(a[5])+","+g(a[6])+","+g(a[7])+","+g(a[8])+")";case 16:return"mat4("+g(a[0])+","+g(a[1])+","+g(a[2])+","+g(a[3])+","+g(a[4])+","+g(a[5])+","+g(a[6])+","+g(a[7])+","+g(a[8])+","+g(a[9])+","+g(a[10])+","+g(a[11])+","+g(a[12])+","+g(a[13])+","+g(a[14])+","+g(a[15])+")";default:throw"Wrong glsl value dimension";}}function g(a){return a%
1?String(a):String(a)+".0"}var C=p("__assets"),f=p("__config"),h=p("__debug"),n=p("__print"),A=p("__util"),B=f.paths,F={},D={},e=null,z="anchors.glslf anchors.glslv color_id.glslf color_id.glslv depth.glslf depth.glslv grass_map.glslf grass_map.glslv halo.glslf halo.glslv line.glslf line.glslv main.glslf main.glslv main_stack.glslf particles_color.glslf particles_color.glslv particles_texture.glslf particles_texture.glslv procedural_skydome.glslf procedural_skydome.glslv special_lens_flares.glslf special_lens_flares.glslv special_skydome.glslf special_skydome.glslv special_water.glslf special_water.glslv wireframe.glslf wireframe.glslv postprocessing/antialiasing.glslf postprocessing/bloom_combine.glslf postprocessing/compositing.glslf postprocessing/depth_pack.glslf postprocessing/dof.glslf postprocessing/glow.glslf postprocessing/bloom_blur.glslf postprocessing/god_rays.glslf postprocessing/god_rays.glslv postprocessing/god_rays_combine.glslf postprocessing/luminance.glslf postprocessing/luminance_av.glslf postprocessing/luminance_trunced.glslf postprocessing/luminance_trunced.glslv postprocessing/motion_blur.glslf postprocessing/outline.glslf postprocessing/performance.glslf postprocessing/postprocessing.glslf postprocessing/postprocessing.glslv postprocessing/smaa.glslf postprocessing/smaa.glslv postprocessing/ssao.glslf postprocessing/ssao_blur.glslf postprocessing/stereo.glslf include/blending.glslf include/caustics.glslf include/color_util.glslf include/depth_fetch.glslf include/dynamic_grass.glslv include/environment.glslf include/fog.glslf include/fxaa.glslf include/lighting_nodes.glslf include/math.glslv include/mirror.glslf include/nodes.glslf include/nodes.glslv include/pack.glslf include/particles.glslv include/precision_statement.glslf include/procedural.glslf include/refraction.glslf include/scale_texcoord.glslv include/shadow.glslf include/shadow.glslv include/skin.glslv include/std_enums.glsl include/to_world.glslv include/wind_bending.glslv".split(" "),
y=[],v=null,m=!1;a.setup_context=function(a){v=a};a.set_directive=t;a.get_directive=c;a.is_enabled=function(a,b){for(var c=a.directives,d=0;d<c.length;d++)if(c[d][0]==b&&1==c[d][1])return!0;return!1};a.set_default_directives=function(a){a.directives=[];for(var b="ALPHA ALPHA_CLIP ANAGLYPH BEND_CENTER_ONLY BILLBOARD_PRES_GLOB_ORIENTATION CAUSTICS CSM_BLEND_BETWEEEN_CASCADES CSM_FADE_LAST_CASCADE CSM_SECTION0 CSM_SECTION1 CSM_SECTION2 CSM_SECTION3 DEBUG_SPHERE DEBUG_SPHERE_DYNAMIC DEPTH_RGBA DISABLE_DISTORTION_CORRECTION DISABLE_FOG DOUBLE_SIDED_LIGHTING DYNAMIC DYNAMIC_GRASS DYNAMIC_GRASS_COLOR DYNAMIC_GRASS_SIZE FOAM FRAMES_BLENDING BILLBOARD_JITTERED BILLBOARD_SPHERICAL HAIR_BILLBOARD SHADOW_TEX_RES MAIN_BEND_COL MAX_BONES NODES_GLOW NUM_NORMALMAPS PARALLAX PARALLAX_STEPS PROCEDURAL_FOG PROCEDURAL_SKYDOME REFLECTION REFLECTION_PASS REFLECTION_TYPE REFRACTIVE USE_REFRACTION USE_REFRACTION_CORRECTION SHORE_SMOOTHING SKINNED SKY_COLOR SKY_TEXTURE SSAO_HEMISPHERE SSAO_BLUR_DEPTH SSAO_ONLY SSAO_WHITE STATIC_BATCH TEXTURE_COLOR TEXTURE_NORM TEXTURE_SPEC TEXTURE_STENCIL_ALPHA_MASK VERTEX_ANIM VERTEX_ANIM_MIX_NORMALS_FACTOR VERTEX_COLOR WATER_EFFECTS WIND_BEND DETAIL_BEND SHORE_PARAMS ALPHA_AS_SPEC DEPTH_RGBA MTEX_NEGATIVE MTEX_RGBTOINT NUM_LIGHTS NUM_LFACTORS NUM_LAMP_LIGHTS MAX_STEPS BILLBOARD_ALIGN SHADOW_USAGE POST_EFFECT SSAO_QUALITY TEXTURE_BLEND_TYPE TEXTURE_COORDS AA_METHOD AU_QUALIFIER BILLBOARD BILLBOARD_RANDOM PRECISION EPSILON USE_ENVIRONMENT_LIGHT USE_FOG WEBGL2 WO_SKYBLEND WO_SKYPAPER WO_SKYREAL WO_SKYTEX WOMAP_BLEND WOMAP_HORIZ WOMAP_ZENUP WOMAP_ZENDOWN WIREFRAME_QUALITY SIZE_RAMP_LENGTH COLOR_RAMP_LENGTH PARTICLES_SHADELESS NUM_CAST_LAMPS SUN_NUM MAC_OS_SHADOW_HACK".split(" "),
c=0;c<b.length;c++){var d=b[c],e;switch(d){case "ALPHA":case "ALPHA_CLIP":case "ANAGLYPH":case "BILLBOARD_PRES_GLOB_ORIENTATION":case "CAUSTICS":case "CSM_SECTION0":case "CSM_SECTION1":case "CSM_SECTION2":case "CSM_SECTION3":case "DEBUG_SPHERE":case "DEBUG_SPHERE_DYNAMIC":case "DEPTH_RGBA":case "DISABLE_DISTORTION_CORRECTION":case "DISABLE_FOG":case "DOUBLE_SIDED_LIGHTING":case "DYNAMIC":case "DYNAMIC_GRASS":case "DYNAMIC_GRASS_COLOR":case "DYNAMIC_GRASS_SIZE":case "FOAM":case "FRAMES_BLENDING":case "BILLBOARD_JITTERED":case "MAIN_BEND_COL":case "MAX_BONES":case "MTEX_NEGATIVE":case "MTEX_RGBTOINT":case "NODES_GLOW":case "NUM_LIGHTS":case "NUM_LFACTORS":case "NUM_NORMALMAPS":case "PARALLAX":case "PARALLAX_STEPS":case "PROCEDURAL_FOG":case "PROCEDURAL_SKYDOME":case "REFLECTION":case "REFLECTION_PASS":case "REFLECTION_TYPE":case "REFRACTIVE":case "USE_REFRACTION":case "USE_REFRACTION_CORRECTION":case "SHORE_SMOOTHING":case "SKINNED":case "SKY_COLOR":case "SKY_TEXTURE":case "SSAO_HEMISPHERE":case "SSAO_BLUR_DEPTH":case "SSAO_ONLY":case "SSAO_WHITE":case "STATIC_BATCH":case "TEXTURE_COLOR":case "TEXTURE_NORM":case "TEXTURE_SPEC":case "TEXTURE_STENCIL_ALPHA_MASK":case "VERTEX_ANIM":case "VERTEX_COLOR":case "WATER_EFFECTS":case "WIND_BEND":case "DETAIL_BEND":case "SHORE_PARAMS":case "BILLBOARD":case "BILLBOARD_RANDOM":case "HAIR_BILLBOARD":case "USE_ENVIRONMENT_LIGHT":case "USE_FOG":case "WO_SKYBLEND":case "WO_SKYPAPER":case "WO_SKYREAL":case "WO_SKYTEX":case "WOMAP_BLEND":case "WOMAP_HORIZ":case "WOMAP_ZENUP":case "WOMAP_ZENDOWN":case "WIREFRAME_QUALITY":case "SIZE_RAMP_LENGTH":case "COLOR_RAMP_LENGTH":case "PARTICLES_SHADELESS":case "SMAA_JITTER":case "NUM_CAST_LAMPS":case "SUN_NUM":case "MAC_OS_SHADOW_HACK":e=
0;break;case "ALPHA_AS_SPEC":case "BEND_CENTER_ONLY":case "CSM_BLEND_BETWEEEN_CASCADES":case "CSM_FADE_LAST_CASCADE":case "DEPTH_RGBA":case "BILLBOARD_SPHERICAL":case "NUM_LAMP_LIGHTS":case "MAX_STEPS":e=1;break;case "WEBGL2":e=f.defaults.webgl2|0;break;case "EPSILON":e="highp"==f.defaults.precision?1E-6:1E-4;break;case "SHADOW_TEX_RES":e=r(2048);break;case "AA_METHOD":e="AA_METHOD_FXAA_QUALITY";break;case "AU_QUALIFIER":e="NOT_ASSIGNED";break;case "BILLBOARD_ALIGN":e="BILLBOARD_ALIGN_VIEW";break;
case "POST_EFFECT":e="POST_EFFECT_NONE";break;case "SHADOW_USAGE":e="NO_SHADOWS";break;case "SSAO_QUALITY":e="SSAO_QUALITY_32";break;case "TEXTURE_BLEND_TYPE":e="TEXTURE_BLEND_TYPE_MIX";break;case "TEXTURE_COORDS":e="TEXTURE_COORDS_UV_ORCO";break;case "PRECISION":e=f.defaults.precision;break;case "VERTEX_ANIM_MIX_NORMALS_FACTOR":e="u_va_frame_factor";break;default:n.error("Unknown directive ("+a.vert+", "+a.frag+"): "+d)}t(a,d,e)}};a.get_vname=function(a){return a.vert};a.get_fname=function(a){return a.frag};
a.inherit_directives=function(a,b){for(var d=b.directives,e=0;e<d.length;e++){var h=d[e][0],f=d[e][1];c(a,h)&&t(a,h,f)}};a.get_compiled_shader=function(a){var c=JSON.stringify(a),d=F[c];if(d)return d;var e=a.frag,d=b(B.shaders_dir,a.vert),e=b(B.shaders_dir,e);if(!d||!e)return null;var f=k("vert",d,a),g=k("frag",e,a),d=v,m=q(d,c,f,d.VERTEX_SHADER,a),l=q(d,c,g,d.FRAGMENT_SHADER,a),e=d.createProgram();d.attachShader(e,m);d.attachShader(e,l);d.linkProgram(e);d.validateProgram(e);d.getProgramParameter(e,
d.VALIDATE_STATUS)==d.FALSE&&n.error("shader program is not valid",c);h.check_shader_linking(e,c,m,l,f,g);a={vshader:m,fshader:l,program:e,attributes:{},uniforms:{},permanent_uniform_setters:[],permanent_uniform_setters_table:{},transient_uniform_setters:[],shaders_info:a};g=d.getProgramParameter(e,d.ACTIVE_ATTRIBUTES);for(f=0;f<g;f++)m=d.getActiveAttrib(e,f).name,l=d.getAttribLocation(e,m),a.attributes[m]=l;g=d.getProgramParameter(e,d.ACTIVE_UNIFORMS);for(f=0;f<g;f++)m=d.getActiveUniform(e,f).name.split("[0]").join(""),
l=d.getUniformLocation(e,m),a.uniforms[m]=l;return F[c]=d=a};a.load_shaders=function(){m=!1;if(b4w.module_check("shader_texts"))m=!0;else{for(var a=[],b=C.AT_TEXT,c=0;c<z.length;c++){var d=A.normpath_preserve_protocol(B.shaders_dir+z[c]);a.push({id:z[c],type:b,url:d})}b=function(a,b,c,d){e||(e={});e[b]=a};a.length?C.enqueue(a,b,function(){m=!0}):n.error("Shaders have not been found.")}};a.check_shaders_loaded=function(){return m};a.debug_get_compilation_stats=function(){return y};a.get_compiled_shaders=
function(){return F};a.cleanup=function(){for(var a in F){var b=F[a];v.deleteProgram(b.program);v.deleteShader(b.vshader);v.deleteShader(b.fshader);delete F[a]}for(var c in D)delete D[c];for(var d in y)delete y[d]};a.debug_shaders_info=function(a){var b=a.directives;n.log("Shader: "+a.vert+" "+a.frag+", "+String(b.length)+" directives: ");for(a=0;a<b.length;a++)n.log("  "+b[a][0],b[a][1])};a.glsl_value=r;a.check_uniform=function(a,b){return b in a.uniforms?!0:!1};a.get_varyings_count=function(a){return(v.getShaderSource(a).match(/(?:^|\s)varying(?=\s)/g)||
[]).length}};b4w.module.__geometry=function(a,p){function t(a,b){for(var c=1;c<a.shape_keys.length;c++){for(var d=a.shape_keys[c].geometry,e=d.a_position,h=d.a_normal,f=b.a_position,g=b.a_normal,m=e.length,k=a.shape_keys[c].init_value,n=0;n<m;n++)f[n]+=k*e[n],g[n]+=k*h[n];d=d.a_tangent;e=b.a_tangent;h=d.length;for(n=0;n<h;n++)e[n]+=k*d[n]}}function c(a){return 65536<a.base_length?v.get_elem_index_uint()?!1:!0:!1}function b(a){return 0<a.indices.length?!0:!1}function k(a,c,e){if(!b(a))return a;e||m.log('%cDEBUG max vertices exceeded for indexed submesh "'+
a.name+'": '+a.base_length*(c||1)+", will use drawArrays","color: #aa0");c=a.indices;e=a.base_length;var h=a.va_common,f=a.va_frames,g;for(g in h){var k=h[g],n=A(k,e);h[g]=d(c,k,n)}for(h=0;h<f.length;h++){var v=f[h];for(g in v)k=v[g],n=A(k,e),v[g]=d(c,k,n)}for(h=0;h<a.shape_keys.length;h++){g=a.shape_keys[h].geometry;for(var l in g)k=g[l],n=A(k,e),g[l]=d(c,k,n)}a.base_length=c.length;a.indices=new Uint16Array(0);return a}function d(a,b,c){if(0==b.length)return new Float32Array(0);for(var d=new Float32Array(a.length*
c),e=0;e<a.length;e++)for(var h=a[e],f=0;f<c;f++)d[c*e+f]=b[c*h+f];return d}function l(a,b){var c=a.vbo_array,d=a.pointers[b];if(d)return c.subarray(d.offset,d.offset+d.length);throw"extract_array() failed; invalid name: "+b;}function q(b,c){var d,e;switch(c){case a.DM_DEFAULT:case a.DM_TRIANGLES:d=G.TRIANGLES;e=G.STATIC_DRAW;break;case a.DM_POINTS:d=G.POINTS;e=G.STATIC_DRAW;break;case a.DM_DYNAMIC_TRIANGLES:d=G.TRIANGLES;e=G.DYNAMIC_DRAW;break;case a.DM_DYNAMIC_POINTS:d=G.POINTS;e=G.DYNAMIC_DRAW;
break;case a.DM_LINES:d=G.LINES;e=G.STATIC_DRAW;break;default:throw"Wrong draw_mode";}b.mode=d;b.usage=e}function r(a){a.ibo_array?(a.ibo||(a.ibo=G.createBuffer()),G.bindBuffer(G.ELEMENT_ARRAY_BUFFER,a.ibo),G.bufferData(G.ELEMENT_ARRAY_BUFFER,a.ibo_array,a.usage),a.debug_ibo_bytes=a.ibo_array.byteLength):a.debug_ibo_bytes=0;a.vbo||(a.vbo=G.createBuffer());G.bindBuffer(G.ARRAY_BUFFER,a.vbo);G.bufferData(G.ARRAY_BUFFER,a.vbo_array,a.usage);a.debug_vbo_bytes=a.vbo_array.byteLength}function g(a){for(var b=
K.create_empty_submesh("JOIN_"+a.length+"_SUBMESHES"),c=0,d=0;d<a.length;d++)c+=a[d].indices.length;b.indices=new Uint32Array(c);var e=c=0,h=0;if(0<a[0].shape_keys.length)for(var f=0;f<a[0].shape_keys.length;f++){for(d=0;d<a.length;d++)c+=a[d].shape_keys[f].geometry.a_position.length,e+=a[d].shape_keys[f].geometry.a_normal.length,h+=a[d].shape_keys[f].geometry.a_tangent.length;d={a_position:new Float32Array(c),a_normal:new Float32Array(e),a_tangent:new Float32Array(h)};b.shape_keys.push({init_value:a[0].shape_keys[f].init_value,
geometry:d})}for(d=c=0;d<a.length;d++)c+=a[d].base_length;b.base_length=c;var e=a[0],g;for(g in e.va_common){for(d=c=0;d<a.length;d++)c+=a[d].va_common[g].length;b.va_common[g]=new Float32Array(c)}for(g in e.va_frames[0]){for(d=c=0;d<a.length;d++)c+=a[d].va_frames[0][g].length;for(d=0;d<e.va_frames.length;d++)b.va_frames[d]=b.va_frames[d]||{},b.va_frames[d][g]=new Float32Array(c)}for(g=e=c=0;g<a.length;g++){for(var h=a[g],m=h.indices,f=h.base_length,k=h.va_common,d=0;d<m.length;d++)b.indices[c+d]=
m[d]+e;var c=c+m.length,n;for(n in k){var m=k[n],v=e*A(m,f);b.va_common[n].set(m,v)}for(d=0;d<h.va_frames.length;d++){var k=h.va_frames[d],l=b.va_frames[d];for(n in k)m=k[n],v=e*A(m,f),l[n].set(m,v)}e+=f}if(0<b.shape_keys.length)for(g=0;g<b.shape_keys.length;g++)for(n=b.shape_keys[g].geometry,d=h=e=c=0;d<a.length;d++)f=a[d].shape_keys[g].geometry,n.a_position.set(f.a_position,c),n.a_normal.set(f.a_normal,e),n.a_tangent.set(f.a_tangent,h),c+=f.a_position.length,e+=f.a_normal.length,h+=f.a_tangent.length;
return b}function C(a,b,c,d,g,v){var l=K.create_empty_submesh("SUBMESH_"+a.name+"_"+b),w=a.submeshes[b],u=w.base_length,q=a.materials[b];l.base_length=u;var z=!1;if(h(c,"a_texcoord")){var r=null,y=a.materials[b];b=a.submeshes[b];if(y.texture_slots.length)switch(y=y.texture_slots[0],y.texture_coords){case "UV":y=a.uv_textures.indexOf(y.uv_layer);0==y?r=new Float32Array(b.texcoord):1==y&&(r=new Float32Array(b.texcoord2));break;case "ORCO":for(var E=a.b4w_bounding_box_source,r=new Float32Array(2*b.base_length),
y=(E.max_x+E.min_x)/2,A=(E.max_z+E.min_z)/2,p=E.max_x-E.min_x,E=E.max_z-E.min_z,C=0,J=0;J<b.position.length;J+=3)r[C++]=(b.position[J]-y)/p+.5,r[C++]=(A-b.position[J+2])/E+.5}null===r&&(r=new Float32Array(2*b.base_length));b=r}else b=new Float32Array(0);if(h(c,"a_orco_tex_coord")){r=a.b4w_bounding_box_source;y=new Float32Array(3*w.base_length);A=r.max_x-r.min_x;p=r.max_y-r.min_y;E=r.max_z-r.min_z;for(J=C=0;J<w.position.length;J+=3)0==A?y[C++]=.5:y[C++]=K.clamp(parseFloat(((w.position[J]-r.min_x)/
A).toFixed(5)),0,1),0==E?y[C++]=.5:y[C++]=K.clamp(parseFloat(((r.max_z-w.position[J+2])/E).toFixed(5)),0,1),0==p?y[C++]=.5:y[C++]=K.clamp(parseFloat(((w.position[J+1]-r.min_y)/p).toFixed(5)),0,1);r=y}else r=new Float32Array(0);var N,y=w.group;if(h(c,"a_influence")&&d){A=new Float32Array(4*u);p=y.length/u;E=new Float32Array(p);for(C=0;C<p;C++)for(N in E[C]=-1,d)if(J=d[N],J.vgroup_index===C){E[C]=J.deform_bone_index;break}var Z=3<p?p:4;d=new Float32Array(Z);N=new Uint32Array(Z);for(var C=new Float32Array(4),
J=new Float32Array(Z),Z=new Uint32Array(Z),ba=new Float32Array(4),Q=0;Q<u;Q++)d.set(J),N.set(Z),C.set(ba),A.set(n(y,p,Q,u,E,d,N,C),4*Q)}else A=new Float32Array(0);N=A;d=g?K.clone_object_r(g):{};d.a_color={generate_buffer:!0};h(c,"a_color")&&a.active_vcol_name?d.a_color.src=[{name:a.active_vcol_name,mask:7}]:d.a_color.src=[];g={a_texcoord:b,a_influence:N,a_orco_tex_coord:r};N=w.vertex_colors;b=w.color;r=a.name;y=[];for(A=0;A<N.length;A++)y.push(N[A].name);for(var M in d)if(A=d[M].src,A.length){for(E=
p=0;E<A.length;E++)p+=K.rgb_mask_get_channels_count(A[E].mask);g[M]=new Float32Array(p*u);for(E=C=0;E<A.length;E++){var t=A[E].name,J=A[E].mask,Z=K.rgb_mask_get_channels_presence(J),D=y.indexOf(t);-1==D&&K.panic('vertex color "'+t+'" for mesh "'+r+'" not found.');ba=N[D].mask;Q=K.rgb_mask_get_channels_count(ba);(J&ba)!==J&&m.error("Wrong color extraction from "+t+" to "+M+".");for(var t=N,G=u,B=0,ra=0;ra<D;ra++)B+=K.rgb_mask_get_channels_count(t[ra].mask);t=B*G;for(D=0;D<u;D++)for(G=0;3>G;G++)Z[G]&&
(B=C+K.rgb_mask_get_channel_presence_index(J,G),ra=K.rgb_mask_get_channel_presence_index(ba,G),g[M][D*p+B]=b[t+D*Q+ra]);C+=Q}}else g[M]=new Float32Array(0);M=a.uv_textures;d=w.texcoord;N=w.texcoord2;if(v)for(var O in v){b=M.indexOf(O);if(0==b)var F=new Float32Array(d);else 1==b&&(F=new Float32Array(N));g[v[O]]=F}l.va_common=g;l.indices=new Uint32Array(w.indices);v=w.position.length/u/3;F=(O=h(c,"a_normal")&&w.normal.length?!0:!1)&&h(c,"a_tangent")&&w.tangent.length?!0:!1;M=q.texture_slots[0];M=O&&
q.texture_slots.length&&h(c,"a_tangent")&&"ORCO"==M.texture_coords&&M.use_map_normal?!0:!1;0<a.b4w_shape_keys.length&&(z=!0);for(g=0;g<v;g++){q=f(l,w,c,u,O,F,M,g,a.name);if(z)if(d={},d.name=a.b4w_shape_keys[g].name,l.shape_keys.push(d),0!=g){d.geometry=q;d.init_value=a.b4w_shape_keys[g].value;continue}else d.geometry=f(l,w,c,u,O,F,M,g,a.name),d.init_value=1;l.va_frames.push(q)}if(1<v&&!z){a=l.va_frames[0];var q={},ma;for(ma in a)q[ma]=new Float32Array(a[ma]);l.va_frames.push(q)}h(c,"a_polyindex")&&
(k(l,1,!0),l.va_common.a_polyindex=e(l));return l}function f(a,b,c,d,e,f,g,k,n){a={};var v=new Float32Array(3*d),l=new Float32Array(e?3*d:0),u=new Float32Array(f||g?4*d:0),q=k*d*3;v.set(b.position.subarray(q,q+3*d),0);e&&(q=k*d*3,l.set(b.normal.subarray(q,q+3*d),0));if(f)q=k*d*4,u.set(b.tangent.subarray(q,q+4*d),0);else if(g)for(b=u,m.warn('Not precise tangents calculation for normalmap using GENERATED texture coordinates in mesh: "'+n+'". Please add a UV-map.'),n=0;n<d;n++)c=M,e=J,c[0]=l[3*n],c[1]=
l[3*n+1],c[2]=l[3*n+2],E.cross(c,K.AXIS_Z,e),0==E.length(e)&&E.cross(c,K.AXIS_X,e),E.normalize(e,e),b[4*n]=e[0],b[4*n+1]=e[1],b[4*n+2]=e[2],b[4*n+3]=1;else if(e&&h(c,"a_tangent"))for(u=new Float32Array(4*d),d=0;d<u.length;d++)u[d]=1;a.a_position=v;a.a_normal=l;a.a_tangent=u;return a}function h(a,b){return-1<a.indexOf(b)?!0:!1}function n(b,c,d,e,h,f,g,m){for(var k=!0,n=0;n<c;n++){var v=b[n*e+d];if(-1!==v){var l=h[n];-1!==l&&(f[n]=v,g[n]=l,k=!1)}}if(k)return m;B(f,g,a.SORT_NUMERIC,!1);for(n=b=0;4>n;n++)b+=
f[n];if(.01>b)return m;for(n=0;4>n;n++)f[n]/=b;if(.01>Math.abs(f[0]-1))m[0]=g[0]+1;else for(n=0;4>n;n++)m[n]=g[n]+f[n];return m}function A(a,b){if(0==b)return 0;var c=a.length,d=c/b;if(d!=Math.floor(d))throw"Array size mismatch during geometry calculation: array length="+c+", base length="+b;return d}function B(b,c,d,e){for(var h=b.length,f=h,g=!1,m=e?-1:1;1<f||g;){1<f&&(f=Math.floor(f/1.247330950103979));for(var g=!1,k=0;f+k<h;k++)if(d==a.SORT_NUMERIC?0>m*(b[k]-b[k+f]):b[k]<b[k+f]&&e)g=b[k],b[k]=
b[k+f],b[k+f]=g,g=c[k],c[k]=c[k+f],c[k+f]=g,g=!0}}function F(a,b,c){var d=[],e=[];E.subtract(b,a,d);E.subtract(c,a,e);E.normalize(d,d);E.normalize(e,e);return Math.acos(E.dot(d,e))}function D(a,c,d){c||(c=[]);d=d?a.va_frames[0].a_normal:a.va_frames[0].a_position;if(b(a)){a=a.indices;for(var e=a.length/3,h=0;h<e;h++){var f=new Float32Array(9),g=a[3*h];f[0]=d[3*g];f[1]=d[3*g+1];f[2]=d[3*g+2];g=a[3*h+1];f[3]=d[3*g];f[4]=d[3*g+1];f[5]=d[3*g+2];g=a[3*h+2];f[6]=d[3*g];f[7]=d[3*g+1];f[8]=d[3*g+2];c[h]=f}}else for(h=
0;h<d.length;h++)f=new Float32Array(9),f[0]=d[9*h],f[1]=d[9*h+1],f[2]=d[9*h+2],f[3]=d[9*h+3],f[4]=d[9*h+4],f[5]=d[9*h+5],f[6]=d[9*h+6],f[7]=d[9*h+7],f[8]=d[9*h+8],c[h]=f;return c}function e(a){for(var b=new Float32Array(a.base_length),c=0;c<a.base_length;c++)b[c]=c%3;return b}function z(a,b,c){var d=E.dist(a,b);a=E.dist(a,c);b=E.dist(b,c);c=(d+a+b)/2;return c*(c-d)*(c-a)*(c-b)}function y(a,b,c,d,e){c-=b;for(var h=0;h<c;h+=d)h%d==e&&vec3.normalize(a.subarray(h+b-e,h+b+1),a.subarray(h+b-e,h+b+1))}var v=
p("__extensions"),m=p("__print"),u=p("__tsr"),K=p("__util"),E=p("__vec3"),M=new Float32Array(3),J=new Float32Array(3),O=new Float32Array(3);a.ZSORT_DISABLED=10;a.ZSORT_BACK_TO_FRONT=20;a.ZSORT_FRONT_TO_BACK=30;a.DM_TRIANGLES=10;a.DM_POINTS=20;a.DM_DYNAMIC_TRIANGLES=30;a.DM_DYNAMIC_POINTS=40;a.DM_LINES=50;a.SORT_NUMERIC=0;a.SORT_STRING=1;a.DM_DEFAULT=a.DM_TRIANGLES;var G=null;a.setup_context=function(a){G=a};a.delete_buffers=function(a){var b=_buffers[a];G.deleteBuffer(b.ibo);G.deleteBuffer(b.vbo);
delete _buffers[a]};a.submesh_to_bufs_data=function(d,e,h,f){c(d)&&k(d);var g=d.indices,m=d.base_length,n=d.va_frames,v={},l;for(l in d.va_common)l in f&&!f[l].generate_buffer||(v[l]=d.va_common[l]);f={ibo_array:null,vbo_array:null,ibo_type:0,count:0,pointers:{},mode:0,usage:0,debug_ibo_bytes:0,debug_vbo_bytes:0,vbo:null,ibo:null,info_for_z_sort_updates:null,shape_keys:null};0<d.shape_keys.length&&t(d,n[0]);if(g.length)if(l=g.length,65536>=m)var u=new Uint16Array(g),z=G.UNSIGNED_SHORT;else u=new Uint32Array(g),
z=G.UNSIGNED_INT;else l=m,u=null;var y=0,E=n.length,p;for(p in n[0])var C=n[0][p],y=y+C.length*E;for(p in v)C=v[p],y+=C.length;p=new Float32Array(y);var y=0,E={},J;for(J in v){var M=v[J];if(C=M.length)p.set(M,y),E[J]={attribute_name:J,num_comp:A(M,m),offset:y,frames:1,length:C},y+=C}v=n.length;for(J in n[0])if(M=n[0][J],C=M.length,M=A(M,m),C){E[J]={num_comp:M,offset:y,frames:v,length:C};1<v&&(E[J+"_next"]={num_comp:M,offset:y+C,frames:v,length:C});for(var D=0;D<v;D++)M=n[D][J],p.set(M,y),y+=C}f.count=
l;f.ibo_array=u;f.vbo_array=p;f.ibo_type=z;f.pointers=E;q(f,h);r(f);e!=a.ZSORT_DISABLED&&b(d)&&(f.info_for_z_sort_updates={median_cache:new Float32Array(g.length),median_world_cache:new Float32Array(g.length),dist_cache:new Float32Array(g.length/3),type:e});f.shape_keys=d.shape_keys;return f};a.submesh_init_shape_keys=t;a.is_long_submesh=c;a.is_indexed=b;a.submesh_drop_indices=k;a.update_bufs_data_index_array=function(a,b,c){q(a,b);a.count=c.length;a.ibo_array=c;a.ibo_type=c instanceof Uint16Array?
G.UNSIGNED_SHORT:G.UNSIGNED_INT;return a};a.update_bufs_data_array=function(a,b,c,d){var e=a.vbo_array,h=a.pointers,f=h[b];f?(c&&f.num_comp!=c&&K.panic('invalid num_comp for "'+b+'"'),e.set(d,f.offset)):(e=e.length,f=new Float32Array(e+d.length),f.set(a.vbo_array),f.set(d,e),a.vbo_array=f,h[b]={num_comp:c,offset:e});r(a);return a};a.extract_array=l;a.make_static=function(a){a.usage=G.STATIC_DRAW};a.make_dynamic=function(a){a.usage=G.DYNAMIC_DRAW};a.update_gl_buffers=r;a.cleanup_bufs_data=function(a){a.ibo&&
G.deleteBuffer(a.ibo);a.vbo&&G.deleteBuffer(a.vbo)};a.has_empty_submesh=function(a,b){return a.submeshes[b].base_length?!1:!0};a.submesh_apply_transform=function(a,b){for(var c=0;c<a.va_frames.length;c++){var d=a.va_frames[c].a_position;u.transform_vectors(d,b,d,0);d=a.va_frames[c].a_normal;0<d.length&&u.transform_dir_vectors(d,b,d,0);d=a.va_frames[c].a_tangent;0<d.length&&u.transform_tangents(d,b,d,0)}(c=a.va_common.au_center_pos)&&c.length&&u.transform_vectors(c,b,c,0);return a};a.submesh_apply_particle_transform=
function(a,b){var c=a.va_common.au_center_pos;if(c&&c.length){var d=new Float32Array(c);u.transform_vectors(d,b,d,0);for(var e=0;e<a.va_frames.length;e++)for(var h=0;h<d.length;h++)a.va_frames[e].a_position[h]+=d[h]-c[h];c.set(d)}else throw'Attribute "au_center_pos" is missing in particle submesh';return a};a.submesh_apply_params=function(a,b){var c=a.base_length,d;for(d in b){var e=b[d].length;a.va_common[d]=new Float32Array(e*c);for(var h=0;h<c;h++)for(var f=0;f<e;f++)a.va_common[d][h*e+f]=b[d][f]}return a};
a.submesh_list_join=g;a.make_clone_submesh=function(a,b,c){if(!a.base_length)return K.create_empty_submesh("EMPTY");var d=c.length;65536<a.base_length*d&&!v.get_elem_index_uint()&&k(a,d);var e=a.indices,h=a.base_length,f=a.va_common;a=a.va_frames;for(var g in b){var m=b[g].length,n=m*h;f[g]=new Float32Array(n);for(var l=0;l<h;l++)for(n=0;n<m;n++)f[g][l*m+n]=b[g][n]}b=K.create_empty_submesh("CLONE_"+d+"_SUBMESHES");b.base_length=h*d;b.indices=new Uint32Array(e.length*d);for(l=0;l<d;l++)for(m=e.length*
l,g=h*l,n=0;n<e.length;n++)b.indices[m+n]=e[n]+g;for(var q in f)for(e=f[q],n=e.length*d,m=A(e,h),b.va_common[q]=new Float32Array(n),l=0;l<d;l++)g=h*m*l,b.va_common[q].set(e,g);for(q in a[0])for(l=0;l<a.length;l++)for(e=a[l][q],n=e.length*d,m=A(e,h),b.va_frames[l]=b.va_frames[l]||{},b.va_frames[l][q]=new Float32Array(n),n=0;n<d;n++)switch(f=c[n],g=h*m*n,q){case "a_position":u.transform_vectors(e,f,b.va_frames[l][q],g);break;case "a_normal":u.transform_dir_vectors(e,f,b.va_frames[l][q],g);break;case "a_tangent":u.transform_tangents(e,
f,b.va_frames[l][q],g);break;default:throw"Wrong attribute name: "+q;}return b};a.extract_submesh=C;a.extract_halo_submesh=function(a){var b=a.base_length,c=a.va_frames[0].a_position,d=new Float32Array(12*b),e=new Float32Array(8*b);a=new Uint32Array(4*a.indices.length);for(var h=0;h<b;h++)d[12*h]=c[3*h],d[12*h+1]=c[3*h+1],d[12*h+2]=c[3*h+2],d[12*h+3]=c[3*h],d[12*h+4]=c[3*h+1],d[12*h+5]=c[3*h+2],d[12*h+6]=c[3*h],d[12*h+7]=c[3*h+1],d[12*h+8]=c[3*h+2],d[12*h+9]=c[3*h],d[12*h+10]=c[3*h+1],d[12*h+11]=
c[3*h+2],e[8*h]=-.5,e[8*h+1]=-.5,e[8*h+2]=-.5,e[8*h+3]=.5,e[8*h+4]=.5,e[8*h+5]=.5,e[8*h+6]=.5,e[8*h+7]=-.5,a[6*h]=4*h+2,a[6*h+1]=4*h+1,a[6*h+2]=4*h,a[6*h+3]=4*h+2,a[6*h+4]=4*h,a[6*h+5]=4*h+3;c=K.create_empty_submesh("HALO");c.va_frames=[];c.va_frames[0]={};c.base_length=4*b;c.va_frames[0].a_position=d;c.va_common.a_halo_bb_vertex=e;c.indices=a;return c};a.has_attr=h;a.extract_submesh_all_mats=function(a,b,c){for(var d=[],e=0;e<a.submeshes.length;e++){var h=C(a,e,b,null,c,null);h.base_length&&d.push(h)}return 0==
d.length?K.create_empty_submesh("EMPTY"):1==d.length?d[0]:g(d)};a.update_buffers_movable=function(a,b,c){for(var d=a.ibo_array,e=l(a,"a_position"),h=a.info_for_z_sort_updates,f=h.median_cache,g=h.median_world_cache,h=h.dist_cache,m=d,k=m.length/3,n=0;n<k;n++){var v=m[3*n],q=m[3*n+1],r=m[3*n+2],z=e[3*v+1],y=e[3*v+2],E=e[3*q+1],A=e[3*q+2],N=e[3*r+1],Z=e[3*r+2];f[3*n]=(e[3*v]+e[3*q]+e[3*r])/3;f[3*n+1]=(z+E+N)/3;f[3*n+2]=(y+A+Z)/3}u.transform_vectors(f,b,g);b=g.length/3;for(e=0;e<b;e++)f=g[3*e]-c[0],
m=g[3*e+1]-c[1],k=g[3*e+2]-c[2],h[e]=f*f+m*m+k*k;c=d;d=h.length;if(!(2>d))for(g=d,e=!1;1<g||e;)for(1<g&&(g=Math.floor(g/1.247330950103979)),e=!1,b=0;g+b<d;b++)0>h[b]-h[b+g]&&(e=h[b],h[b]=h[b+g],h[b+g]=e,e=c,f=b,m=b+g,k=e[3*f],n=e[3*f+1],v=e[3*f+2],e[3*f]=e[3*m],e[3*f+1]=e[3*m+1],e[3*f+2]=e[3*m+2],e[3*m]=k,e[3*m+1]=n,e[3*m+2]=v,e=!0);d=c;G.bindBuffer(G.ELEMENT_ARRAY_BUFFER,a.ibo);G.bufferData(G.ELEMENT_ARRAY_BUFFER,d,G.DYNAMIC_DRAW)};a.sort_two_arrays=B;a.calc_normals=function(a,b,c){for(var d=b.length/
3,e=a.length/3,h=[],f=Array(3),g=Array(3),m=Array(3),k=0;k<e;k++){for(var n=a[3*k],l=a[3*k+1],v=a[3*k+2],u=0;3>u;u++)f[u]=b[3*n+u],g[u]=b[3*l+u],m[u]=b[3*v+u];if(c)var u=F(f,g,m),q=F(g,m,f),r=Math.PI-u-q;else r=q=u=1;var z=h,y;y=f;var N=m,A=[],ba=[],Q=[];E.subtract(g,y,A);E.subtract(N,y,ba);E.cross(A,ba,Q);E.normalize(Q,Q);y=Q;for(N=0;3>N;N++)A=3*l+N,ba=3*v+N,z[3*n+N]=u*y[N],z[A]=q*y[N],z[ba]=r*y[N]}if(c)for(var p in c)for(k=c[p],a=0;3>a;a++){b=3*k[0]+a;for(e=1;e<k.length;e++)f=3*k[e]+a,h[b]+=h[f];
for(e=1;e<k.length;e++)f=3*k[e]+a,h[f]=h[b]}for(k=0;k<d;k++){c=k;p=h;a=new Float32Array(3);for(b=0;3>b;b++)e=3*c+b,a[b]=p[e];E.normalize(a,a);for(b=0;3>b;b++)e=3*c+b,p[e]=a[b]}return h};a.calc_shared_indices=function(a,b,c){for(var d={},e=b.length/3,h=0;h<e;h++){var f=String(b[3*h])+String(b[3*h+1])+String(b[3*h+2]);d[f]=[]}e=a.length;for(h=0;h<e;h++)b=a[h],f=String(c[3*b])+String(c[3*b+1])+String(c[3*b+2]),f in d&&d[f].push(b);return d};a.geometry_random_points=function(a,b,c,d){var e=D(a,null,!1);
if(c)var h=D(a,null,!0);var f=e.length,g=new Float32Array(f),m=M,k=J;for(a=0;a<f;a++){var n=e[a];m.set(n.subarray(0,3));k.set(n.subarray(3,6));O.set(n.subarray(6));g[a]=Math.sqrt(z(m,k,O))}m=new Float32Array(f);m[0]=g[0];for(a=1;a<f;a++)m[a]=m[a-1]+g[a];f=m[g.length-1];g=[];for(a=0;a<b;a++){var k=f*K.rand_r(d),k=K.binary_search_max(m,k,0,m.length-1),n=c?h[k]:e[k],k=a,l=n,v=d,n=void 0,n=new Float32Array(3),u=l[0],q=l[1],r=l[2],y=l[3],E=l[4],N=l[5],A=l[6],ba=l[7],Q=l[8],l=K.rand_r(v),v=K.rand_r(v);
1<l+v&&(l=1-l,v=1-v);var p=1-l-v,q=p*q+l*E+v*ba,r=p*r+l*N+v*Q;n[0]=p*u+l*y+v*A;n[1]=q;n[2]=r;g[k]=n}return g};a.extract_triangles=D;a.extract_polyindices=e;a.triangle_area_squared=z;a.scale_submesh_xyz=function(a,b,c){a=a.va_frames[0].a_position;for(var d=0;d<a.length;d+=3)a[d]=(a[d]-c[0])*b[0]+c[0],a[d+1]=(a[d+1]-c[1])*b[1]+c[1],a[d+2]=(a[d+2]-c[2])*b[2]+c[2]};a.apply_shape_key=function(a,b,c){var d=a.scenes_data[0].batches;a=a.render.shape_keys_values;for(var e=1;e<a.length;e++)a[e].name==b&&(a[e].value=
c);for(e=0;e<d.length;e++)if(!d[e].forked_batch&&d[e].use_shape_keys&&!d[e].debug_sphere){c=d[e].bufs_data.pointers;b=d[e].bufs_data.vbo_array;G.bindBuffer(G.ARRAY_BUFFER,d[e].bufs_data.vbo);var h=c.a_position,f=d[e],g=b,m=a;if(h){for(var k=h.offset,h=h.length+k,n=f.bufs_data.shape_keys[0].geometry.a_position,l=k;l<h;l++)g[l]=n[l-k];for(l=1;l<f.bufs_data.shape_keys.length;l++){var n=f.bufs_data.shape_keys[l].geometry.a_position,v=m[l].value;if(v)for(var u=k;u<h;u++)g[u]+=v*n[u-k]}G.bufferSubData(G.ARRAY_BUFFER,
4*k,g.subarray(k))}h=c.a_normal;f=d[e];g=b;m=a;if(h){k=h.offset;h=h.length+k;n=f.bufs_data.shape_keys[0].geometry.a_normal;for(l=k;l<h;l++)g[l]=n[l-k];for(l=1;l<f.bufs_data.shape_keys.length;l++)if(n=f.bufs_data.shape_keys[l].geometry.a_normal,v=m[l].value)for(u=k;u<h;u++)g[u]+=v*n[u-k];y(g,k,h,3,2);G.bufferSubData(G.ARRAY_BUFFER,4*k,g.subarray(k))}m=c.a_tangent;c=d[e];f=a;if(m){g=m.offset;m=m.length+g;h=c.bufs_data.shape_keys[0].geometry.a_tangent;for(k=g;k<m;k++)b[k]=h[k-g];for(k=1;k<c.bufs_data.shape_keys.length;k++)if(h=
c.bufs_data.shape_keys[k].geometry.a_tangent,l=f[k].value)for(n=g;n<m;n++)b[n]+=l*h[n-g];y(b,g,m,4,3);G.bufferSubData(G.ARRAY_BUFFER,4*g,b.subarray(g))}}};a.check_shape_keys=function(a){return a.render.use_shape_keys};a.get_shape_keys_names=function(a){var b=[];if(a.render)for(var c=1;c<a.render.shape_keys_values.length;c++)b.push(a.render.shape_keys_values[c].name);return b};a.get_shape_key_value=function(a,b){if(a.render)for(var c=1;c<a.render.shape_keys_values.length;c++)if(b==a.render.shape_keys_values[c].name)return a.render.shape_keys_values[c].value;
return 0};a.has_shape_key=function(a,b){var c=a.render.shape_keys_values;if(c)for(var d=1;d<c.length;d++)if(c[d].name==b)return!0;return!1};a.has_dyn_geom=function(a){return a&&a.render&&a.render.dynamic_geometry?!0:!1};a.draw_line=function(b,c,d){var e=b.bufs_data;if(e){for(var h=d?c.length/3/2:c.length/3-1,f=new Float32Array(12*h),g=new Float32Array(12*h),m=new Uint16Array(6*h),k=0;k<h;k++){if(d)var n=6*k,l=6*k+3;else n=3*k,l=3*(k+1);var v=c[n],u=c[n+1],n=c[n+2],q=c[l],z=c[l+1],l=c[l+2],y=q-v,E=
z-u,A=l-n;f[12*k]=v;f[12*k+1]=u;f[12*k+2]=n;g[12*k]=y;g[12*k+1]=E;g[12*k+2]=A;f[12*k+3]=q;f[12*k+4]=z;f[12*k+5]=l;g[12*k+3]=-y;g[12*k+4]=-E;g[12*k+5]=-A;f[12*k+6]=v;f[12*k+7]=u;f[12*k+8]=n;g[12*k+6]=-y;g[12*k+7]=-E;g[12*k+8]=-A;f[12*k+9]=q;f[12*k+10]=z;f[12*k+11]=l;g[12*k+9]=y;g[12*k+10]=E;g[12*k+11]=A;m[6*k]=4*k;m[6*k+1]=4*k+1;m[6*k+2]=4*k+2;m[6*k+3]=4*k;m[6*k+4]=4*k+3;m[6*k+5]=4*k+1}d=0;for(var N in e.pointers)c=e.pointers[N],d+=f.length/3*c.num_comp;e.vbo_array=new Float32Array(d);d=e.vbo_array;
a.update_bufs_data_index_array(e,b.draw_mode,m);b=0;for(N in e.pointers)switch(c=e.pointers[N],N){case "a_position":d.set(f,b);c.offset=b;c.length=f.length;b+=c.length;break;case "a_direction":d.set(g,b);c.offset=b;c.length=g.length;b+=c.length;break;default:c.offset=b,c.length=f.length/3*c.num_comp,m=new Float32Array(c.length),d.set(m,b),b+=c.length}r(e)}}};b4w.module.__objects=function(a,p){function t(a){a.render.outline_intensity=0;a=ga.indexOf(a);-1!=a&&ga.splice(a,1)}function c(a){if(a.field)for(var b=a.scenes_data,c=0;c<b.length;c++)x.update_force_scene(b[c].scene,a)}function b(a,b){for(var c=a.scenes_data,d=b.scenes_data,e=0;e<c.length;e++){for(var h=!1,f=0;f<d.length;f++)if(c[e].scene==d[f].scene){h=!0;break}h||k(b,c[e].scene)&&K.append_scene_data(b,c[e].scene)}}function k(a,b){return!b._is_main&&"SPEAKER"==a.type||!b._is_primary_thread&&("LAMP"==
a.type||"CAMERA"==a.type)?!1:!0}function d(a,b){if(a.dg_parent&&a.dg_parent._is_dynamic||a.parent&&a.parent._is_dynamic)return!0;switch(a.type){case "MESH":var c=B.bpy_obj_is_animatable(a,b),d=a.b4w_do_not_batch,e=a.b4w_collision,h=a.b4w_vehicle,f=a.b4w_floating,g=a.b4w_character,k=E.has_dynamic_grass_particles(a),m=u.bpy_obj_has_nla(a),n=0<a.data.b4w_shape_keys.length,l=a.b4w_dynamic_geometry;if(!(c=c||d||e||h||n||f))a:{c=a.data;for(d=0;d<c.materials.length;d++)if("LENS_FLARES"===c.materials[d].name){c=
!0;break a}c=!1}return c||k||g||m||l;case "EMPTY":return g=B.bpy_obj_is_animatable(a,b),k=u.bpy_obj_has_nla(a),m=a.b4w_do_not_batch,l=Boolean(a.b4w_anchor),g||k||m||l;default:return!0}}function l(a,b,c,d,e,h,f,g,k){for(var m=0;m<a.nodes.length;m++){var n=a.nodes[m];if("VALUE"==n.type){var v=r(b,n.name);d.push(n.outputs[0].default_value);e.push(v,e.length/2)}else if("RGB"==n.type)v=r(b,n.name),n=n.outputs[0].default_value.slice(0,3),f.push(n[0],n[1],n[2]),g.push(v,g.length/2);else if("GROUP"==n.type){var v=
n.node_group.node_tree,u=v.animation_data,n=r(b,n.name);l(v,n,u,d,e,h,f,g,k)}}if(c)for((a=c.action)&&a._render.type==B.AT_MATERIAL&&q(a,b,h,e,k,g),c=c.nla_tracks,d=0;d<c.length;d++)for(f=c[d].strips,m=0;m<c[d].strips.length;m++)(a=f[m].action)&&a._render.type==B.AT_MATERIAL&&q(a,b,h,e,k,g)}function q(a,b,c,d,e,h){var f=a._render.params,k;for(k in f){var m=r(b,k.match(/"(.*?)"/)[1]),f=g(d,m);null!=f?(m=r(a.name,k),c.push(m,f)):(f=g(h,m),null!=f&&(m=r(a.name,k),e.push(m,f)))}}function r(a,b){return a+
"%join%"+b}function g(a,b){for(var c=0;c<a.length;c+=2)if(a[c]==b)return a[c+1];return null}function C(a,b){for(var c=a.render.mats_value_inds,d=0;d<c.length;d+=2)if(c[d]==b)return c[d+1];return null}function f(a,b){for(var c=a.render.mats_rgb_inds,d=0;d<c.length;d+=2)if(c[d]==b)return c[d+1];return null}function h(a,b,c){b=V[b]||[];for(var d=[],e=0;e<b.length;e++){var h=b[e];if(h.render.data_id==c||-1==c)for(var f=h.scenes_data,g=0;g<f.length;g++)f[g].scene==a&&d.push(h)}return d}function n(a,b,
c,d){for(var e=null,h=0;h<b.length;h++){var f=b[h];if((c?f.origin_name:f.name)==a&&(f.render.data_id==d||-1==d)&&(e=f,!K.get_dg_parent(e)))break}return e}function A(a){V.ALL.push(a);V[a.type]||(V[a.type]=[]);V[a.type].push(a);var b=a.render.plane_reflection_id;if(null!=b)for(var c=0;c<la.length;c++){var d=la[c];d.render.plane_reflection_id==b&&d.reflective_objs.push(a)}}var B=p("__animation"),F=p("__batch"),D=p("__boundings"),e=p("__camera"),z=p("__config"),y=p("__constraints"),v=p("__geometry"),
m=p("__lights"),u=p("__nla"),K=p("__obj_util"),E=p("__particles"),M=p("__physics"),J=p("__print"),O=p("__primitives"),G=p("__quat"),x=p("__scenes"),H=p("__sfx"),P=p("__transform"),I=p("__textures"),aa=p("__tsr"),U=p("__util"),T=p("__vec3"),w=p("__armature"),fa=p("__anchors"),da=z.defaults,ea=z.outlining,V={ALL:[]},S=0,X=0,la=[],ga=[],oa=new Float32Array(3),na=new Float32Array(4);a.GET_OBJECT_BY_NAME=0;a.GET_OBJECT_BY_DUPLI_NAME=1;a.GET_OBJECT_BY_DUPLI_NAME_LIST=2;a.DATA_ID_ALL=-1;a.update=function(a,
b){for(var c=V.ALL,d=V.ARMATURE,e=0;e<c.length;e++)for(var h=c[e],f=h.scenes_data,g=0;g<f.length;g++){var k=f[g],m=k.scene,k=k.batches;if(m._render.outline){if(-1!=ga.indexOf(h)){var n=h,l=a,v=0,u=n.outline_animation;0==u.time_start&&(u.time_start=l);l-=u.time_start;if(u.relapses&&l/u.period>=u.relapses)t(n);else{l%=u.period;if(l<u.outline_time)switch(u=l/(u.outline_time/5),l=Math.floor(u),l){case 0:v=(u-l)/2;break;case 1:v=(u-l)/2+.5;break;case 2:v=1;break;case 3:v=1-(u-l)/2;break;case 4:v=.5-(u-
l)/2}n.render.outline_intensity=v}}h.render.outline_intensity&&x.request_outline(m)}E.update_emitter_transform(h,k)}if(d)for(e=0;e<d.length;e++)c=d[e],c.need_update_transform&&(P.update_transform(c),c.need_update_transform=!1)};a.apply_outline_anim=function(a,b,c,d){var e=a.outline_animation;e.time_start=0;e.outline_time=b;e.period=c;e.relapses=d;-1==ga.indexOf(a)&&ga.push(a)};a.clear_outline_anim=t;a.update_object=function(a,b){b.uuid=a.uuid;b.bpy_origin=!0;var c=a.animation_data,h=a.data.animation_data;
c&&c.action&&(c=c.action,(c._render.type==B.AT_OBJECT||c._render.type==B.AT_ARMATURE&&"ARMATURE"==b.type||c._render.type==B.AT_LIGHT&&"LAMP"==b.type)&&b.actions.push(c));h&&h.action&&("SPEAKER"==b.type||"LAMP"==b.type)&&b.actions.push(h.action);"MESH"==b.type&&b.actions.push.apply(b.actions,B.get_bpy_material_actions(a));a._is_dynamic=b.is_dynamic=d(a,b);a._is_updated=!0;b.is_vehicle=a.b4w_vehicle;b.is_character=a.b4w_character;b.is_floating=a.b4w_floating;b.use_obj_physics=a.b4w_collision;b.collision_id=
a.b4w_collision_id;b.correct_bounding_offset=a.b4w_correct_bounding_offset;h=a.game;b.physics_settings={physics_type:h.physics_type,use_ghost:h.use_ghost,use_sleep:h.use_sleep,mass:h.mass,velocity_min:h.velocity_min,velocity_max:h.velocity_max,damping:h.damping,rotation_damping:h.rotation_damping,lock_location_x:h.lock_location_x,lock_location_y:h.lock_location_y,lock_location_z:h.lock_location_z,lock_rotation_x:h.lock_rotation_x,lock_rotation_y:h.lock_rotation_y,lock_rotation_z:h.lock_rotation_z,
collision_margin:h.collision_margin,collision_group:h.collision_group,collision_mask:h.collision_mask,use_collision_bounds:h.use_collision_bounds,collision_bounds_type:h.collision_bounds_type,use_collision_compound:h.use_collision_compound};if(h=a.b4w_vehicle_settings)b.vehicle_settings={name:h.name,part:h.part,suspension_rest_length:h.suspension_rest_length,suspension_compression:h.suspension_compression,suspension_stiffness:h.suspension_stiffness,suspension_damping:h.suspension_damping,wheel_friction:h.wheel_friction,
roll_influence:h.roll_influence,max_suspension_travel_cm:h.max_suspension_travel_cm,force_max:h.force_max,brake_max:h.brake_max,steering_max:h.steering_max,max_speed_angle:h.max_speed_angle,delta_tach_angle:h.delta_tach_angle,speed_ratio:h.speed_ratio,steering_ratio:h.steering_ratio,inverse_control:h.inverse_control,floating_factor:h.floating_factor,water_lin_damp:h.water_lin_damp,water_rot_damp:h.water_rot_damp,synchronize_position:h.synchronize_position};if(h=a.b4w_floating_settings)b.floating_settings=
{name:h.name,part:h.part,floating_factor:h.floating_factor,water_lin_damp:h.water_lin_damp,water_rot_damp:h.water_rot_damp,synchronize_position:h.synchronize_position};if(h=a.b4w_character_settings)b.character_settings={walk_speed:h.walk_speed,run_speed:h.run_speed,step_height:h.step_height,jump_strength:h.jump_strength,waterline:h.waterline};for(h=0;h<a.constraints.length;h++)c=a.constraints[h],"RIGID_BODY_JOINT"==c.type&&b.physics_constraints.push({target:c.target._object,pivot_type:c.pivot_type,
pivot_x:c.pivot_x,pivot_y:c.pivot_y,pivot_z:c.pivot_z,axis_x:c.axis_x,axis_y:c.axis_y,axis_z:c.axis_z,use_limit_x:c.use_limit_x,use_limit_y:c.use_limit_y,use_limit_z:c.use_limit_z,use_angular_limit_x:c.use_angular_limit_x,use_angular_limit_y:c.use_angular_limit_y,use_angular_limit_z:c.use_angular_limit_z,limit_max_x:c.limit_max_x,limit_max_y:c.limit_max_y,limit_max_z:c.limit_max_z,limit_min_x:c.limit_min_x,limit_min_y:c.limit_min_y,limit_min_z:c.limit_min_z,limit_angle_max_x:c.limit_angle_max_x,limit_angle_max_y:c.limit_angle_max_y,
limit_angle_max_z:c.limit_angle_max_z,limit_angle_min_x:c.limit_angle_min_x,limit_angle_min_y:c.limit_angle_min_y,limit_angle_min_z:c.limit_angle_min_z});h=b.render=K.create_render("MESH"===b.type?b.is_dynamic?"DYNAMIC":"STATIC":b.type);a.parent?(b.parent=a.parent._object,"BONE"==a.parent_type&&"ARMATURE"==a.parent.type&&(b.parent_bone=a.parent_bone),a.pinverse_tsr?(b.pinverse_tsr=aa.create(),aa.copy(a.pinverse_tsr,b.pinverse_tsr)):b.pinverse_tsr=void 0):a.dg_parent&&(b.parent=a.dg_parent._object,
b.parent_is_dupli=!0);var c=a.location,f=a.scale[0];U.quat_bpy_b4w(a.rotation_quaternion,na);P.set_translation(b,c);P.set_rotation(b,na);P.set_scale(b,f);b.use_default_animation=a.b4w_use_default_animation;b.anim_behavior_def=B.anim_behavior_bpy_b4w(a.b4w_anim_behavior);a.b4w_object_tags&&(b.metatags={title:a.b4w_object_tags.title,description:a.b4w_object_tags.description,category:a.b4w_object_tags.category});a.b4w_viewport_alignment&&(b.viewport_alignment={alignment:a.b4w_viewport_alignment.alignment,
distance:a.b4w_viewport_alignment.distance});switch(a.type){case "ARMATURE":w.update_object(a,b);c=h.bone_pointers;f=B.calc_pose_data(c);a.b4w_animation_mixing?(h.quats_before=new Float32Array(f.quats),h.quats_after=new Float32Array(f.quats),h.trans_before=new Float32Array(f.trans),h.trans_after=new Float32Array(f.trans)):(h.quats_before=f.quats,h.quats_after=f.quats,h.trans_before=f.trans,h.trans_after=f.trans);for(var g in c){var k=c[g];1==k.chain.length&&w.update_bone_tsr_r(k,!0,f.trans,f.quats)}h.pose_data=
f;h.frame_factor=0;h.anim_mixing=a.b4w_animation_mixing;break;case "MESH":h.do_not_render=a.b4w_do_not_render;h.bb_original=F.bb_bpy_to_b4w(a.data.b4w_bounding_box);h.selectable=ea.outlining_overview_mode||a.b4w_selectable;h.origin_selectable=a.b4w_selectable;h.outlining=ea.outlining_overview_mode||a.b4w_outlining;h.origin_outlining=a.b4w_outlining;h.outline_on_select=ea.outlining_overview_mode||a.b4w_outline_on_select;h.billboard=a.b4w_billboard;h.billboard_pres_glob_orientation=a.b4w_pres_glob_orientation;
h.billboard_type="BASIC";h.billboard_spherical="SPHERICAL"==a.b4w_billboard_geometry;g=h.outline_anim_settings_default;g.outline_duration=a.b4w_outline_settings.outline_duration;g.outline_period=a.b4w_outline_settings.outline_period;g.outline_relapses=a.b4w_outline_settings.outline_relapses;h.selectable&&(h.color_id=U.gen_color_id(S),S++);for(g=0;g<a.data.b4w_vertex_anim.length;g++)c=a.data.b4w_vertex_anim[g],b.vertex_anim.push({name:c.name,frame_start:c.frame_start,frame_end:c.frame_end,averaging:c.averaging,
averaging_interval:c.averaging_interval,allow_nla:c.allow_nla});b.render.vertex_anim=b.vertex_anim.length?!0:!1;if("MESH"!=a.type)throw"Wrong object type: "+a.name;g=b.render;if(a.data.b4w_shape_keys.length)for(g.use_shape_keys=!0,c=0;c<a.data.b4w_shape_keys.length;c++)f={},f.value=a.data.b4w_shape_keys[c].value,f.name=a.data.b4w_shape_keys[c].name,g.shape_keys_values.push(f);else g.use_shape_keys=!1;g=b.render;for(var c=a.data.materials,f=[],k=[],n=[],v=[],u=[],q=[],r=0;r<c.length;r++){var z=c[r],
R=z.node_tree;R&&l(R,z.name,R.animation_data,f,k,n,v,u,q)}g.mats_values=f;g.mats_value_inds=k;g.mats_anim_inds=n;g.mats_rgbs=v;g.mats_rgb_inds=u;g.mats_rgb_anim_inds=q;h.shadow_cast=a.b4w_shadow_cast;h.shadow_receive=a.b4w_shadow_receive;h.shadow_cast_only=a.b4w_shadow_cast_only&&h.shadow_cast;h.reflexible=a.b4w_reflexible;h.reflexible_only=a.b4w_reflexible_only&&h.reflexible;h.reflective=a.b4w_reflective;h.reflection_type=a.b4w_reflection_type;h.caustics=a.b4w_caustics;h.wind_bending=a.b4w_wind_bending;
h.wind_bending_angle=a.b4w_wind_bending_angle;g=F.wb_angle_to_amp(a.b4w_wind_bending_angle,h.bb_original,a.scale[0]);h.wind_bending_amp=g;h.wind_bending_freq=a.b4w_wind_bending_freq;h.detail_bending_freq=a.b4w_detail_bending_freq;h.detail_bending_amp=a.b4w_detail_bending_amp;h.branch_bending_amp=a.b4w_branch_bending_amp;h.hide=!1;h.main_bend_col=a.b4w_main_bend_stiffness_col;g=a.b4w_detail_bend_colors;h.detail_bend_col={};h.detail_bend_col.leaves_stiffness=g.leaves_stiffness_col;h.detail_bend_col.leaves_phase=
g.leaves_phase_col;h.detail_bend_col.overall_stiffness=g.overall_stiffness_col;h.do_not_cull=a.b4w_do_not_cull;h.disable_fogging=a.b4w_disable_fogging;h.dynamic_geometry=a.b4w_dynamic_geometry;if("MESH"!==a.type)throw"Wrong object";g=a.data.materials[0];h.friction=g.physics.friction;h.elasticity=g.physics.elasticity;h.lod_dist_min=0;h.lod_dist_max=1E6;h.lod_transition_ratio=a.b4w_lod_transition;h.last_lod=!0;break;case "LINE":h.do_not_cull=!0;h.bb_local=D.zero_bounding_box();h.bs_local=D.zero_bounding_sphere();
h.be_local=D.zero_bounding_ellipsoid();h.bb_world=D.zero_bounding_box();h.bs_world=D.zero_bounding_sphere();h.be_world=D.zero_bounding_ellipsoid();break;case "CAMERA":e.camera_object_to_camera(a,b);e.assign_boundings(b);break;case "LAMP":m.lamp_to_light(a,b);break;case "SPEAKER":b.sfx=H.create_sfx();h=!1;for(g=0;g<b.scenes_data.length;g++)if(b.scenes_data[g].scene.b4w_enable_audio){h=!0;break}h&&H.update_object(a,b);break;case "EMPTY":g=D.zero_bounding_box(),h.bb_local=g,g=D.zero_bounding_sphere(),
h.bs_local=g,a.field&&(b.field={type:a.field.type,strength:a.field.strength}),a.b4w_anchor&&(b.anchor={type:a.b4w_anchor.type,detect_visibility:a.b4w_anchor.detect_visibility,element_id:a.b4w_anchor.element_id,max_width:a.b4w_anchor.max_width})}A(b)};a.update_object_relations=function(a,c){var d=c.render;if(c.parent){!c.parent_is_dupli&&c.physics_settings.use_collision_compound&&c.parent.physics_settings.use_collision_compound&&(c.use_obj_physics=!1);var e=c.physics_settings;if(c.is_vehicle||c.is_floating||
M.is_character(c)||c.use_obj_physics&&!e.use_ghost&&0<e.mass&&("DYNAMIC"==e.physics_type||"RIGID_BODY"==e.physics_type))e=c.parent_is_dupli?aa.copy(d.world_tsr,aa.create()):d.world_tsr,aa.multiply(c.parent.render.world_tsr,e,d.world_tsr),P.set_translation(c,aa.get_trans_view(d.world_tsr)),P.set_scale(c,aa.get_scale(d.world_tsr)),P.set_rotation(c,aa.get_quat_view(d.world_tsr));else if(c.parent_is_dupli||!c.parent_bone)if(e=aa.copy(d.world_tsr,aa.create()),c.viewport_alignment&&"CAMERA"==c.parent.type){e=
{distance:c.viewport_alignment.distance,rotation:aa.get_quat_view(e)};switch(c.viewport_alignment.alignment){case "TOP_LEFT":e.top=0;e.left=0;break;case "TOP":e.top=0;e.left=.5;break;case "TOP_RIGHT":e.top=0;e.right=0;break;case "LEFT":e.top=.5;e.left=0;break;case "CENTER":e.top=.5;e.left=.5;break;case "RIGHT":e.top=.5;e.right=0;break;case "BOTTOM_LEFT":e.bottom=0;e.left=0;break;case "BOTTOM":e.bottom=0;e.left=.5;break;case "BOTTOM_RIGHT":e.bottom=0,e.right=0}y.append_stiff_viewport(c,c.parent,e)}else y.append_child_of(c,
c.parent,e);else e=aa.copy(d.world_tsr,aa.create()),y.append_child_of_bone(c,c.parent,c.parent_bone,e)}if("ARMATURE"==c.type)for(var e=a.pose.bones,h=0;h<e.length;h++){var f=e[h],g=f.constraints;if(g)for(var k=0;k<g.length;k++){var m=g[k];"COPY_TRANSFORMS"!=m.type||m.subtarget||m.mute||y.append_stiff_bone_to_obj(c,m.target._object,f.name,U.VEC3_IDENT,U.QUAT4_IDENT,1)}}if("MESH"==c.type)var n=B.get_bpy_armobj(a);if(n){g=n._object;e=g.render.pose_data;h=c.render;f=a.data;c.armobj=g;f=f.vertex_groups;
if(f.length){var g=g.render.bone_pointers,k=0,m={},l;for(l in g){var v=U.keysearch("name",l,f);v&&(m[l]={vgroup_index:v.index,bone_index:g[l].bone_index,deform_bone_index:k++})}h.bone_skinning_info=m;l=k;f=B.get_max_bones();h.max_bones=l;l>2*f?(h.is_skinning=!1,J.error('too many bones for "'+a.name+'" / '+h.max_bones+" bones (max "+f+" with blending, "+2*f+" without blending). Skinning will be disabled.")):h.is_skinning=!0}l=B.extract_skinned_pose_data(e.trans,e.quats,d.bone_skinning_info);n.b4w_animation_mixing?
(d.quats_before=new Float32Array(l.quats),d.quats_after=new Float32Array(l.quats),d.trans_before=new Float32Array(l.trans),d.trans_after=new Float32Array(l.trans)):(d.quats_before=l.quats,d.quats_after=l.quats,d.trans_before=l.trans,d.trans_after=l.trans);d.arm_rel_trans=new Float32Array(4);d.arm_rel_quat=G.create();d.pose_data=l;d.frame_factor=0}if(d.reflective)if(d=c.render,"CUBE"==d.reflection_type)d.cube_reflection_id=X++;else if("PLANE"==d.reflection_type){a:{n=a.constraints;for(l=0;l<n.length;l++)if(e=
n[l],"LOCKED_TRACK"==e.type&&"REFLECTION PLANE"==e.name){if(e.target._object){n=e.target._object;break a}J.warn('Reflection plane target "'+e.target.name+'" for object: "'+c.name+"\" is not present on the scene. Using object's Z-axis.")}n=null}n||(n=U.unique_name("%reflection%"),n=K.create_object(n,"EMPTY"),l=K.create_render("EMPTY"),n.render=l,b(c,n),y.append_stiff_obj(n,c,[0,0,0],null,1),A(n));l=null;for(e=0;e<la.length;e++)if(la[e]==n){l=e;break}null==l&&(l=la.length,la.push(n));n.render.plane_reflection_id=
l;d.plane_reflection_id=l;n.reflective_objs.push(c)}};a.update_force=c;a.copy_scene_data=b;a.check_bpy_obj_scene_compatibility=k;a.update_objects_dynamics=function(a){for(var b=0;b<a.length;b++){var c=a[b];!c.render||"DYNAMIC"!=c.render.type&&"CAMERA"!=c.render.type||P.update_transform(c);c.use_default_animation&&B.obj_is_animatable(c)&&(B.apply_def(c),c.anim_slots.length&&B.play(c,null,B.SLOT_ALL))}};a.get_meta_tags=function(a){return U.clone_object_r(a.metatags)};a.cleanup=function(){X=S=0;la=[];
ga.length=0;V={ALL:[]}};a.copy=function(a,c,d){var e=c,h=K.get_dg_parent(a);c=h?K.gen_dupli_name(h.name,c):c;if(n(c,V.ALL,!1,-1)){for(var h=1,f;;){f="."+(3>String(h).length?("000"+String(h)).slice(-3):String(h));if(!n(c+f,V.ALL,!1,-1))break;h++}J.error('Object "'+c+'" already exists. Name was replaced by "'+c+f+'".');e+=f;c+=f}e=K.create_object(c,a.type,e);e.bpy_origin=a.bpy_origin;e.is_dynamic=a.is_dynamic;e.is_hair_dupli=a.is_hair_dupli;e.use_default_animation=a.use_default_animation;e.render=K.copy_object_props_by_value(a.render);
e.metatags=K.copy_object_props_by_value(a.metatags);b(a,e);e.action_anim_cache=K.copy_bpy_object_props_by_link(a.action_anim_cache);e.parent=K.copy_bpy_object_props_by_link(a.parent);e.parent_is_dupli=a.parent_is_dupli;e.parent_bone=a.parent_bone;!a.physics||a.is_vehicle||a.is_character||a.is_floating||(e.use_obj_physics=a.use_obj_physics,e.physics=null);e.collision_id=a.collision_id;e.correct_bounding_offset=a.correct_bounding_offset;e.physics_settings=K.copy_object_props_by_value(a.physics_settings);
c=[];for(h=0;h<a.scenes_data.length;h++){var g=e.scenes_data[h];f=a.scenes_data[h].batches;if(d){for(var g=g.batches,k=0;k<f.length;k++)if(!f[k].forked_batch){var m=K.copy_object_props_by_value(f[k]);g.push(m);c.push(f[k].bufs_data)}for(k=0;k<f.length;k++)if(f[k].forked_batch){m=K.copy_object_props_by_value(f[k]);g.push(m);for(var l=0;l<c.length;l++)c[l]==f[k].bufs_data&&(m.bufs_data=g[l].bufs_data)}for(k=0;k<g.length;k++)g[k].bufs_data&&v.update_gl_buffers(g[k].bufs_data),g[k].odd_id_prop=e.uuid,
F.update_batch_id(g[k],F.calculate_render_id(e.render));I.share_batch_canvas_textures(g)}else g.batches=K.copy_bpy_object_props_by_link(f)}K.scene_data_set_active(e,!1);A(e);e.render.is_copied=!0;e.render.color_id=U.gen_color_id(S);S++;return e};a.get_value_node_ind_by_id=C;a.get_rgb_node_ind_by_id=f;a.update_boundings=function(a){for(var b=a.render,c=a.scenes_data[0].batches,d,e,h,f,g,k,m=0;m<c.length;m++)if("MAIN"==c[m].type){var n=c[m].bufs_data.vbo_array,l=c[m].bufs_data.pointers.a_position.offset;
d=f=n[l];e=g=n[l+1];h=k=n[l+2];break}for(m=0;m<c.length;m++)if(n=c[m],"MAIN"==n.type)for(var n=n.bufs_data.vbo_array,u=c[m].bufs_data.pointers,l=u.a_position.offset,u=u.a_position.length+l,R=l;R<u;R+=3){var l=n[R],q=n[R+1],r=n[R+2];d=Math.max(l,d);e=Math.max(q,e);h=Math.max(r,h);f=Math.min(l,f);g=Math.min(q,g);k=Math.min(r,k)}var z={max_x:parseFloat(d.toFixed(3)),max_y:parseFloat(e.toFixed(3)),max_z:parseFloat(h.toFixed(3)),min_x:parseFloat(f.toFixed(3)),min_y:parseFloat(g.toFixed(3)),min_z:parseFloat(k.toFixed(3))},
w=d-f,y=e-g,E=h-k;f=.5*(d+f);var A=.5*(e+g),p=.5*(h+k),pa=f,Ca=p;g=Math.max(w,Math.max(y,E))/2;k=Math.max(w,E)/2;var C=[f/(w?w:1),A/(y?y:1),p/(E?E:1)],J=.5;if(b.billboard)l=Math.max(Math.abs(z.max_x),Math.abs(z.min_x)),q=Math.max(Math.abs(z.max_y),Math.abs(z.min_y)),r=Math.max(Math.abs(z.max_z),Math.abs(z.min_z)),g=Math.sqrt(l*l+q*q+r*r),k=Math.sqrt(l*l+q*q),z.max_x=z.max_y=z.max_z=g,z.min_x=z.min_y=z.min_z=-g,f=new Float32Array([0,0,0]),E=new Float32Array([g,g,g]),y=new Float32Array([0,0,0]);else{for(m=
0;m<c.length;m++)if(n=c[m],"MAIN"==n.type)for(n=n.bufs_data.vbo_array,u=c[m].bufs_data.pointers,l=u.a_position.offset,u=u.a_position.length+l,R=l;R<u;R+=3){var l=n[R],q=n[R+1],r=n[R+2],x=Math.sqrt((f-l)*(f-l)+(A-q)*(A-q)+(p-r)*(p-r));if(x>g){var M=f-g*(l-f)/x,t=A-g*(q-A)/x,x=p-g*(r-p)/x;f=(M+l)/2;A=(t+q)/2;p=(x+r)/2;g=Math.sqrt((f-l)*(f-l)+(A-q)*(A-q)+(p-r)*(p-r))}t=Math.sqrt((pa-l)*(pa-l)+(Ca-r)*(Ca-r));t>k&&(M=pa-k*(l-pa)/t,x=Ca-k*(r-Ca)/t,pa=(M+l)/2,Ca=(x+r)/2,k=Math.sqrt((pa-l)*(pa-l)+(Ca-r)*
(Ca-r)));l/=w?w:1;q/=y?y:1;r/=E?E:1;x=Math.sqrt((C[0]-l)*(C[0]-l)+(C[1]-q)*(C[1]-q)+(C[2]-r)*(C[2]-r));x>J&&(M=C[0]-J*(l-C[0])/x,t=C[1]-J*(q-C[1])/x,x=C[2]-J*(r-C[2])/x,C[0]=(M+l)/2,C[1]=(t+q)/2,C[2]=(x+r)/2,J=Math.sqrt((C[0]-l)*(C[0]-l)+(C[1]-q)*(C[1]-q)+(C[2]-r)*(C[2]-r)))}m=w?w*C[0]:d;e=y?y*C[1]:e;h=E?E*C[2]:h;w*=J;y*=J;E*=J;f=new Float32Array([f,A,p]);E=new Float32Array([w,y,E]);y=new Float32Array([m,e,h]);k=parseFloat(k.toFixed(3))}b.bb_local=z;F.set_local_cylinder_capsule(b,k,k,z);z=D.create_bounding_sphere(g,
f);b.bs_local=z;z=D.create_bounding_ellipsoid([E[0],0,0],[0,E[1],0],[0,0,E[2]],y);b.be_local=z;P.update_transform(a);if(da.wireframe_debug)for(m=0;m<c.length;m++)if("WIREFRAME"===c[m].type&&c[m].debug_sphere){a=O.generate_uv_sphere(16,8,1,z.center,!1,!1);v.scale_submesh_xyz(a,[z.axis_x[0],z.axis_y[1],z.axis_z[2]],z.center);v.submesh_drop_indices(a,1,!0);a.va_common.a_polyindex=v.extract_polyindices(a);F.update_batch_geometry(c[m],a);break}};a.get_scene_objs=h;a.get_scene_objs_derived=function(a,b,
c){b=V[b]||[];for(var d=[],e=0;e<b.length;e++){var h=b[e];if((h.render.data_id==c||-1==c)&&h.bpy_origin)for(var f=h.scenes_data,g=0;g<f.length;g++)f[g].scene==a&&d.push(h)}return d};a.get_all_objects=function(a){var b=V.ALL;if(-1==a)return b;for(var c=[],d=0;d<b.length;d++){var e=b[d];e.render.data_id==a&&c.push(e)}return c};a.sort_lamps=function(a){var b=h(a,"LAMP",-1);if(b.length==a._render.num_lamps_added){for(var c=[],d=0;d<b.length;d++){var e=b[d],e=K.get_scene_data(e,a);c[e.light_index]=d}for(d=
0;d<c.length-1;d++)for(e=d+1;e<c.length;e++){var f;f=b[c[d]].light;var g=b[c[e]].light;f=!g.use_diffuse||!g.use_specular||f.use_diffuse&&f.use_specular?!f.use_diffuse&&(g.use_diffuse||!f.use_specular&&g.use_specular)?!0:!1:!0;f&&(f=c[d],c[d]=c[e],c[e]=f)}for(d=0;d<c.length;d++)e=b[c[d]],K.get_scene_data(e,a).light_index=d,x.update_lamp_scene(b[c[d]],a)}};a.update_all_mesh_shaders=function(a){for(var b=h(a,"LAMP",-1),c=h(a,"MESH",-1),d=0;d<c.length;d++)for(var e=K.get_scene_data(c[d],a).batches,f=
0;f<e.length;f++){var g=e[f];"MAIN"==g.type&&(F.update_batch_lights(g,b,a),F.update_shader(g))}};a.get_selectable_objects=function(){for(var a=[],b=V.MESH,c=0;c<b.length;c++){var d=b[c];d.render.selectable&&d.bpy_origin&&a.push(d)}return a};a.get_outlining_objects=function(){for(var a=[],b=V.MESH,c=0;c<b.length;c++){var d=b[c];d.render.outlining&&d.bpy_origin&&a.push(d)}return a};a.get_object=function(b,c,d,e){var h=null,f=V.ALL;switch(b){case a.GET_OBJECT_BY_NAME:h=n(c,f,!0,d);break;case a.GET_OBJECT_BY_DUPLI_NAME:a:{for(b=
0;b<f.length;b++)if(h=f[b],h.origin_name==d&&(h.render.data_id==e||-1==e)){var g=K.get_dg_parent(h);if(g&&g.origin_name==c)break a}h=null}break;case a.GET_OBJECT_BY_DUPLI_NAME_LIST:a:{for(e=0;e<f.length;e++){b=f[e];for(var h=c.length-1,g=b,k=!0;0<=h&&k;)k=g&&g.origin_name==c[h]&&(g.render.data_id==d||-1==d),g&&(g=K.get_dg_parent(g)),h--;if(k&&!g){h=b;break a}}h=null}}return h};a.pick_object=function(b,c){var d=x.get_main();if(!d)return J.error("No active scene"),null;var e=fa.pick_anchor(b,c);if(e)return e;
e=x.pick_color(d,b,c);if(!e)return null;for(var d=h(d,"MESH",-1),f=0;f<d.length;f++){var g=d[f].render,k=g.color_id;if(k&&3>Math.abs(255*k[0]-e[0])&&3>Math.abs(255*k[1]-e[1])&&3>Math.abs(255*k[2]-e[2]))return g.outlining&&g.outline_on_select&&(ea.outlining_overview_mode?a.apply_outline_anim(d[f],ea.outline_duration,ea.outline_period,ea.outline_relapses):(e=g.outline_anim_settings_default,a.apply_outline_anim(d[f],e.outline_duration,e.outline_period,e.outline_relapses))),d[f]}return null};a.set_wind_params=
function(a,b){for(var d=h(a,"EMPTY",-1),e=0;e<d.length;e++){var f=d[e];if(f.field&&"WIND"===f.field.type)var g=f}if(!g)return J.error("There is no wind on the scene"),0;"number"==typeof b.wind_dir&&(T.set(-Math.PI/2,b.wind_dir/180*Math.PI,0,oa),U.euler_to_quat(oa,na),P.set_rotation(g,na),c(g));"number"==typeof b.wind_strength&&(g.field.strength=b.wind_strength,c(g));x.update_scene_permanent_uniforms(a)};a.remove_object=function(a){y.check_constraint(a)&&y.remove(a);var b=V.ALL,c=V[a.type],d=b.indexOf(a);
a=c.indexOf(a);-1!=d&&b.splice(d,1);-1!=a&&c.splice(a,1)};a.objects_storage_add=A;a.objects_storage_check=function(a){return V[a.type]&&-1<V[a.type].indexOf(a)};a.set_nodemat_rgb=function(a,b,c,d,e){b=b.join("%join%");var h=f(a,b);null!=h?(a.render.mats_rgbs[3*h]=c,a.render.mats_rgbs[3*h+1]=d,a.render.mats_rgbs[3*h+2]=e):J.error('The RGB node "'+b+'" was not found in the object "'+a.name+'".')};a.set_nodemat_value=function(a,b,c){b=b.join("%join%");var d=C(a,b);null!=d?a.render.mats_values[d]=c:J.error('The Value node "'+
b+'" was not found in the object "'+a.name+'".')}};b4w.module.__obj_util=function(a,p){function t(a){if(!(a instanceof Object))return a;var b=null,c=null,d=null;a.textures&&(b=a.textures,a.textures=null);a.texture_names&&(c=a.texture_names,a.texture_names=null);a.shape_keys&&(d=a.shape_keys,a.shape_keys=null);var k;k=a.constructor;switch(k){case Float32Array:case Uint32Array:case Uint16Array:k=new k(a);break;case Array:k=new k(a.length);for(var l=0;l<a.length;l++)k[l]=t(a[l]);break;case WebGLUniformLocation:case WebGLProgram:case WebGLShader:k=a;
break;case WebGLFramebuffer:case WebGLTexture:case WebGLBuffer:k=null;break;case Function:k=a;break;default:for(l in k=new k,a)k[l]=t(a[l])}b&&(k.textures=b,a.textures=b);c&&(k.texture_names=c,a.texture_names=c);d&&(k.shape_keys=d,a.shape_keys=d);return k}function c(a,b){for(var c=a.scenes_data,d=0;d<c.length;d++){var k=c[d];if(k.scene==b)return k}return null}function b(a){return a.parent_is_dupli?a.parent:a.parent?b(a.parent):null}var k=p("__tsr"),d=p("__util"),l=p("__vec3"),q=p("__vec4"),r=p("__config").defaults;
new Float32Array(4);new Float32Array(4);new Float32Array(4);k.create();k.create();a.create_render=function(a){a={id:0,type:a,data_id:0,grid_id:[0,0],world_tsr:k.create_ext(),pivot:new Float32Array(3),hover_pivot:new Float32Array(3),init_dist:0,init_top:0,is_copied:!1,color_id:null,outline_intensity:0,target_cam_upside_down:!1,vertical_axis:l.create(),use_panning:!1,move_style:0,velocity_trans:1,velocity_rot:1,velocity_zoom:1,dof_distance:0,dof_front:0,dof_rear:0,dof_power:0,dof_object:null,underwater:!1,
horizontal_limits:null,vertical_limits:null,distance_limits:null,hover_vert_trans_limits:null,hover_horiz_trans_limits:null,enable_hover_hor_rotation:!0,hover_zero_level:0,cameras:null,shadow_cameras:null,outline_anim_settings_default:{outline_duration:1,outline_period:1,outline_relapses:0},cube_reflection_id:null,plane_reflection_id:null,reflection_plane:new Float32Array(4),friction:0,elasticity:0,lod_dist_min:0,lod_transition_ratio:0,do_not_render:!1,shadow_cast:!1,shadow_receive:!1,shadow_cast_only:!1,
reflexible:!1,reflexible_only:!1,reflective:!1,reflection_type:"",caustics:!1,wind_bending:!1,disable_fogging:!1,dynamic_geometry:!1,dynamic_grass:!1,do_not_cull:!1,hide:!1,last_lod:!1,selectable:!1,origin_selectable:!1,outlining:!1,origin_outlining:!1,outline_on_select:!1,is_hair_particles:!1,is_visible:!1,force_zsort:!1,wind_bending_angle:0,wind_bending_amp:0,wind_bending_freq:0,detail_bending_freq:0,detail_bending_amp:0,branch_bending_amp:0,main_bend_col:"",detail_bend_col:null,bend_center_only:!1,
billboard:!1,billboard_pres_glob_orientation:!1,billboard_type:"",billboard_spherical:!1,frame_factor:0,time:0,va_frame:0,va_frame_factor:0,max_bones:0,frames_blending:!1,vertex_anim:!1,use_shape_keys:!1,shape_keys_values:[],is_skinning:!1,anim_mixing:!1,anim_mix_factor:1,anim_mix_factor_change_speed:0,anim_destination_mix_factor:1,two_last_skeletal_slots:new Int8Array([-1,-1]),skinned_renders:[],mesh_to_arm_bone_maps:[],skinning_data_cache:[],quats_before:null,quats_after:null,trans_before:null,
trans_after:null,bone_pointers:null,bone_skinning_info:null,pose_data:null,arm_rel_trans:null,arm_rel_quat:null,mats_values:null,mats_value_inds:null,mats_anim_inds:null,mats_rgbs:null,mats_rgb_inds:null,mats_rgb_anim_inds:null,bb_original:null,bb_local:null,bcyl_local:null,bcap_local:null,bcon_local:null,bb_world:null,bs_local:null,bs_world:null,be_local:null,be_world:null,lod_dist_max:1E4};l.copy(d.AXIS_Y,a.vertical_axis);return a};a.create_object=function(a,b,c){c||(c=a);return{name:a,uuid:d.gen_uuid(),
origin_name:c,type:b,bpy_origin:!1,is_dynamic:!1,is_hair_dupli:!1,use_default_animation:!1,render:null,constraint:null,sfx:null,light:null,armobj:null,anchor:null,field:null,metatags:null,scenes_data:[],vertex_anim:[],cons_descends:[],cons_armat_bone_descends:[],anim_slots:[],reflective_objs:[],nla_events:[],action_anim_cache:[],sensor_manifolds:null,sensor_manifolds_arr:[],parent:null,parent_is_dupli:!1,parent_bone:"",viewport_alignment:null,use_obj_physics:!1,collision_id:"",correct_bounding_offset:"AUTO",
is_vehicle:!1,is_character:!1,is_floating:!1,physics:null,vehicle:null,floater:null,vehicle_settings:null,floating_settings:null,character_settings:null,physics_constraints:[],physics_settings:{physics_type:"NO_COLLISION",use_ghost:!1,use_sleep:!1,mass:0,velocity_min:0,velocity_max:0,damping:0,rotation_damping:0,lock_location_x:!1,lock_location_y:!1,lock_location_z:!1,lock_rotation_x:!1,lock_rotation_y:!1,lock_rotation_z:!1,collision_margin:0,collision_group:0,collision_mask:0,use_collision_bounds:!1,
collision_bounds_type:"BOX",use_collision_compound:!1},outline_animation:{time_start:0,outline_time:0,period:0,relapses:0},anim_behavior_def:0,actions:[],need_update_transform:!1,meta_objects:[]}};a.copy_bpy_object_props_by_link=function(a){return a instanceof Array?a.slice():a};a.copy_object_props_by_value=t;a.is_dynamic=function(a){return a.is_dynamic};a.is_dynamic_mesh=function(a){return"MESH"==a.type&&a.is_dynamic};a.append_scene_data=function(a,b){a.scenes_data.push({scene:b,is_active:!1,batches:[],
plane_refl_subs:[],cube_refl_subs:null,shadow_subscenes:[],light_index:0,obj_has_nla_on_scene:!1})};a.append_batch=function(a,b,d){c(a,b).batches.push(d)};a.remove_scene_data=function(a,b){for(var c=a.scenes_data,d=0;d<c.length;d++)if(c[d].scene==b){c.splice(d,1);break}};a.get_scene_data=c;a.update_refl_objects=function(a,b){for(var c=0;c<a.length;c++)q.copy(b,a[c].render.reflection_plane)};a.scene_data_set_active=function(a,b,c){for(var d=0;d<a.scenes_data.length;d++){var k=a.scenes_data[d];c&&k.scene!=
c||(k.is_active=b)}};a.get_shadow_lamps=function(a,b){for(var c=[],d=b?r.max_cast_lamps-1:r.max_cast_lamps,k=0;k<a.length;k++){var l=a[k];l.light.generate_shadows&&c.length<d&&c.push(l)}return c.length?c:a[0]?[a[0]]:[]};a.check_obj_soft_particles_accessibility=function(a,b){if(b.b4w_enable_soft_particles&&0<b.b4w_particles_softness){var c=b.material-1,d=a.data.materials;if(0<=c&&c<d.length&&("ADD"==d[c].game_settings.alpha_blend||"ALPHA"==d[c].game_settings.alpha_blend||"ALPHA_SORT"==d[c].game_settings.alpha_blend))return!0}return!1};
a.gen_dupli_name=function(a,b){return a+"*"+b};a.get_parent=function(a){return a.parent_is_dupli?null:a.parent};a.get_dg_parent=b;a.get_dg_objects=function(a,c){for(var d=[],h=0;h<c.length;h++){var k=c[h];b(k)==a&&d.push(k)}return d};a.is_mesh=function(a){return"MESH"===a.type};a.is_armature=function(a){return"ARMATURE"===a.type};a.is_speaker=function(a){return"SPEAKER"===a.type};a.is_camera=function(a){return"CAMERA"===a.type};a.is_lamp=function(a){return"LAMP"===a.type};a.is_empty=function(a){return"EMPTY"===
a.type};a.is_line=function(a){return"LINE"===a.type}};b4w.module.__particles=function(a,p){function t(a,b,c,k,l,q,p){var e=a.delay_attrs,z=a.emitter_tsr_snapshots,y=a.time;a=a.prev_time;for(var v=b?4:1,m=0;m<e.length;m+=v){var u=e[m];if(y>a&&y>=u&&u>a||y<a&&(u>a||y>=u))for(u=0;8>u;u++)z[8*m+u]=l[u],r[u]=l[u];else for(u=0;8>u;u++)r[u]=z[8*m+u];u=g;u[0]=c[3*m];u[1]=c[3*m+1];u[2]=c[3*m+2];d.transform_vec3(u,r,u);q[3*m]=u[0];q[3*m+1]=u[1];q[3*m+2]=u[2];var C=g;C[0]=k[3*m];C[1]=k[3*m+1];C[2]=k[3*m+2];d.transform_dir_vec3(C,r,C);p[3*m]=C[0];p[3*m+1]=C[1];
p[3*m+2]=C[2];if(b)for(u=1;4>u;u++)q[3*(m+u)]=q[3*m],q[3*(m+u)+1]=q[3*m+1],q[3*(m+u)+2]=q[3*m+2],p[3*(m+u)]=C[0],p[3*(m+u)+1]=C[1],p[3*(m+u)+2]=C[2]}}function c(a){a?(l.srand(a),C=function(){return l.rand()}):C=function(){return Math.random()}}p("__config");var b=p("__geometry");p("__scenes");var k=p("__time"),d=p("__tsr"),l=p("__util"),q=p("__vec3"),r=new Float32Array(8),g=new Float32Array(3),C=function(){throw"_rand() undefined";};a.obj_has_particles=function(a){a=a.scenes_data;for(var b=0;b<a.length;b++)for(var c=
a[b].batches,d=0;d<c.length;d++)if(c[d].particles_data)return!0;return!1};a.obj_has_anim_particles=function(a){a=a.scenes_data;for(var b=0;b<a.length;b++)for(var c=a[b].batches,d=0;d<c.length;d++){var g=c[d].particles_data;if(g&&"EMITTER"==g.p_type)return!0}return!1};a.bpy_obj_has_particles=function(a){return 0<a.particle_systems.length};a.bpy_obj_has_anim_particles=function(a){for(var b=0;b<a.particle_systems.length;b++)if("EMITTER"==a.particle_systems[b].settings.type)return!0;return!1};a.has_dynamic_grass_particles=
function(a){for(var b=0;b<a.particle_systems.length;b++){var c=a.particle_systems[b].settings;if("HAIR"==c.type&&c.b4w_dynamic_grass)return!0}return!1};a.init_particles_data=function(a,b,c){var d={name:b.name,p_type:b.settings.type,time:0,prev_time:-1,use_world_space:!1,frame_start:0,frame_end:0,time_length:0,lifetime_frames:0,lifetime:0,cyclic:!1,mass:0,nfactor:0,gravity:0,fade_in:0,fade_out:0,wind_factor:0,size:0,alpha_start:0,alpha_end:0,size_ramp_length:0,color_ramp_length:0,size_ramp:new Float32Array(8),
color_ramp:new Float32Array(16),positions:null,positions_cache:null,normals:null,normals_cache:null,delay_attrs:null,delay_attrs_masked:null,emitter_tsr_snapshots:null},d=a.particles_data=d;d.frame_start=b.settings.frame_start;d.frame_end=b.settings.frame_end;d.time_length=(d.frame_end-d.frame_start)/k.get_framerate();d.lifetime_frames=b.settings.lifetime;d.lifetime=d.lifetime_frames/k.get_framerate();d.cyclic=b.settings.b4w_cyclic?1:0;d.mass=b.settings.mass;d.nfactor=b.settings.normal_factor;d.gravity=
9.81*b.settings.effector_weights.gravity;d.fade_in=b.settings.b4w_fade_in/k.get_framerate();d.fade_out=b.settings.b4w_fade_out/k.get_framerate();d.wind_factor=b.settings.effector_weights.wind;d.use_world_space="WORLD"==b.settings.b4w_coordinate_system?!0:!1;var g,l;a.halo_particles?(a=c.halo.size,g=c.halo.hardness,30>g?(g=.5,l=.9):40>g?(g=.1,l=1):50>g?(g=0,l=.8):(g=0,l=.5)):(a=b.settings.particle_size,l=g=1);d.size=a;d.alpha_start=g;d.alpha_end=l;a=b.settings.texture_slots;b=[-1,0,-1,0,-1,0,-1,0];
if(a[0]&&a[0].use_map_size&&a[0].texture&&"BLEND"==a[0].texture.type&&a[0].texture.use_color_ramp){a=a[0].texture.color_ramp.elements;g=Math.min(2*a.length,b.length);for(l=0;l<g;l+=2){var q=a[l/2];b[l]=q.position;b[l+1]=(q.color[0]+q.color[1]+q.color[2])/3}d.size_ramp_length=a.length}d.size_ramp.set(b);b=c.texture_slots;c=[-1,0,0,0,-1,0,0,0,-1,0,0,0,-1,0,0,0];if(b[0]&&"STRAND"==b[0].texture_coords&&b[0].texture&&"BLEND"==b[0].texture.type&&b[0].texture.use_color_ramp){a=b[0].texture.color_ramp.elements;
g=Math.min(4*a.length,c.length);for(l=0;l<g;l+=4)q=a[l/4],c[l]=q.position,c[l+1]=q.color[0],c[l+2]=q.color[1],c[l+3]=q.color[2];d.color_ramp_length=a.length}d.color_ramp.set(c)};a.generate_emitter_particles_submesh=function(a,d,g,r){var p=a.particles_data,F=g.settings.count,D=g.settings.frame_start/k.get_framerate(),e=g.settings.frame_end/k.get_framerate(),z=g.settings.lifetime/k.get_framerate(),y=g.settings.lifetime_random,v=g.settings.emit_from,m=g.settings.factor_random,u=g.settings.angular_velocity_mode,
K=g.settings.angular_velocity_factor,E=g.settings.b4w_randomize_emission,M=g.settings.b4w_cyclic,J=!a.halo_particles;c(g.seed);d=b.extract_submesh_all_mats(d,["a_position","a_normal"],null);switch(v){case "VERT":g=d.va_frames[0].a_position;d=d.va_frames[0].a_normal;for(var O=g.length/3,v=[],G=0;G<F;G++){var x=Math.round((O-1)*C());v.push(x);J&&(v.push(x),v.push(x),v.push(x))}O=[];for(G=0;G<v.length;G++)O.push(g[3*v[G]]),O.push(g[3*v[G]+1]),O.push(g[3*v[G]+2]);g=new Float32Array(O);O=[];for(G=0;G<
v.length;G++)O.push(d[3*v[G]]),O.push(d[3*v[G]+1]),O.push(d[3*v[G]+2]);v=new Float32Array(O);break;case "FACE":g=[];v=[];G=[];l.init_rand_r_seed(0,G);O=b.geometry_random_points(d,F,!1,G);l.init_rand_r_seed(0,G);d=b.geometry_random_points(d,F,!0,G);for(G=0;G<O.length;G++)g.push(O[G][0],O[G][1],O[G][2]),J&&(g.push(O[G][0],O[G][1],O[G][2]),g.push(O[G][0],O[G][1],O[G][2]),g.push(O[G][0],O[G][1],O[G][2])),v.push(d[G][0],d[G][1],d[G][2]),J&&(v.push(d[G][0],d[G][1],d[G][2]),v.push(d[G][0],d[G][1],d[G][2]),
v.push(d[G][0],d[G][1],d[G][2]));g=new Float32Array(g);v=new Float32Array(v);break;case "VOLUME":throw"Particle emission from volume is not supported";default:throw"Wrong emit from option";}v=[g,v];d=v[0];v=v[1];p.positions=new Float32Array(d);p.normals=new Float32Array(v);p.positions_cache=new Float32Array(d.length);p.normals_cache=new Float32Array(v.length);g=[];e=(e-D)/F;for(O=0;O<F;O++)G=E?e*O+10*e*(.5-C()):e*O,M||(G+=D),g.push(G),J&&(g.push(G),g.push(G),g.push(G));D=new Float32Array(g);p.delay_attrs=
new Float32Array(D);p.delay_attrs_masked=new Float32Array(D);if(p.use_world_space){p.emitter_tsr_snapshots=new Float32Array(8*D.length);for(E=0;E<8*D.length;E++)for(M=0;8>M;M++)p.emitter_tsr_snapshots[8*E+M]=r[M];t(p,J,d,v,r,d,v)}r=l.create_empty_submesh("EMITTER_PARTICLES");p=l.create_empty_va_frame();p.a_position=d;p.a_normal=v;r.va_frames[0]=p;if(J){a.draw_mode=b.DM_DYNAMIC_TRIANGLES;a=[];for(p=0;p<F;p++)a.push(4*p,4*p+2,4*p+1,4*p,4*p+3,4*p+2);a=new Uint16Array(a);r.indices=a;a=r.va_common;p=[];
for(E=0;E<F;E++)p.push(-.5,-.5,-.5,.5,.5,.5,.5,-.5);p=new Float32Array(p);a.a_p_bb_vertex=p}else a.draw_mode=b.DM_DYNAMIC_POINTS,r.indices=new Uint16Array(0);r.base_length=d.length/3;r.va_common.a_p_delay=D;a=r.va_common;p=[];y*=z;for(D=0;D<F;D++)E=y*C(),p.push(z-E),J&&(p.push(z-E),p.push(z-E),p.push(z-E));z=new Float32Array(p);a.a_p_lifetime=z;z=r.va_common;y=[];for(a=0;a<F;a++){p=[C()-.5,C()-.5,C()-.5];q.normalize(p,p);y.push(m*p[0]);y.push(m*p[1]);y.push(m*p[2]);switch(u){case "NONE":y.push(0);
break;case "SPIN":case "VELOCITY":y.push(K);break;case "RAND":y.push(2*K*(C()-.5));break;default:throw"Undefined velocity factor";}if(J)for(p=y.slice(-4),D=0;12>D;D++)y.push(p[D%4])}F=new Float32Array(y);z.a_p_vels=F;return r};a.update_emitter_transform=function(a,c){for(var d=0;d<c.length;d++){var g=c[d],k=g.particles_data;if(k&&k.use_world_space){var l=g.bufs_data,q=k.positions_cache,e=k.normals_cache;t(k,!g.halo_particles,k.positions,k.normals,a.render.world_tsr,q,e);b.make_dynamic(l);b.update_bufs_data_array(l,
"a_position",3,q);b.update_bufs_data_array(l,"a_normal",3,e)}}};a.set_time=function(a,b,c){a=a.scenes_data;for(var d=0;d<a.length;d++)for(var g=a[d].batches,k=0;k<g.length;k++){var l=g[k].particles_data;l&&l.name==b&&(l.prev_time=l.time,l.time=c)}};a.prepare_lens_flares=function(a){for(var b=a.base_length,c=a.va_frames[0].a_position,d=a.va_common.a_texcoord,g=[],k=[],l=0;l<b;l++)k.push(c[3*l]),k.push(c[3*l+1]),g.push(c[3*l+2]);g=new Float32Array(g);k=new Float32Array(k);a.va_common.a_lf_dist=g;a.va_common.a_lf_bb_vertex=
k;a.va_common.a_texcoord=d;return a};a.set_size=function(a,b,c){a=a.scenes_data;for(var d=0;d<a.length;d++)for(var g=a[d].batches,k=0;k<g.length;k++){var l=g[k].particles_data;l&&l.name==b&&(l.size=c)}};a.set_normal_factor=function(a,b,c){a=a.scenes_data;for(var d=0;d<a.length;d++)for(var g=a[d].batches,k=0;k<g.length;k++){var l=g[k].particles_data;l&&l.name==b&&(l.nfactor=c)}};a.set_factor=function(a,c,d){a=a.scenes_data;for(var g=0;g<a.length;g++)for(var k=a[g].batches,l=0;l<k.length;l++){var q=
k[l],e=q.particles_data;if(e&&e.name==c){var r=e.delay_attrs;if(1==d)e=r;else if(0==d)for(var y=!q.halo_particles,v=y?4:1,e=e.delay_attrs_masked,m=0;m<e.length;m+=v)e[m]=1E4,y&&(e[m+1]=e[m],e[m+2]=e[m],e[m+3]=e[m]);else for(var u=1/d,e=e.delay_attrs_masked,v=(y=!q.halo_particles)?4:1,p=0,m=0;m<e.length;m+=v)m>=p?(e[m]=r[m],p+=u):e[m]=1E4,y&&(e[m+1]=e[m],e[m+2]=e[m],e[m+3]=e[m]);b.update_bufs_data_array(q.bufs_data,"a_p_delay",1,e)}}};a.update_start_pos=function(a,b,c){a=a.scenes_data;for(var d=0;d<
a.length;d++)for(var g=a[d].batches,k=0;k<g.length;k++){var l=g[k].particles_data;if(l&&l.use_world_space)for(var e=0;e<8*l.delay_attrs.length;e++)l.emitter_tsr_snapshots[8*e]=b[0],l.emitter_tsr_snapshots[8*e+1]=b[1],l.emitter_tsr_snapshots[8*e+2]=b[2],l.emitter_tsr_snapshots[8*e+3]=b[3],l.emitter_tsr_snapshots[8*e+4]=c[0],l.emitter_tsr_snapshots[8*e+5]=c[1],l.emitter_tsr_snapshots[8*e+6]=c[2],l.emitter_tsr_snapshots[8*e+7]=c[3]}}};b4w.module.__primitives=function(a,p){function t(a,b,c,d){for(var k=[],l=[],r=[],p=[],t=2*c/(a-1),e=2*d/(b-1),z=0;z<a;z++)for(var y=-c+z*t,v=0;v<b;v++)if(l.push(y,0,-d+v*e),r.push(0,1,0),p.push(z/(a-1),v/(b-1)),z&&v){var m=z*b+v,u=m-1,K=(z-1)*b+v,E=K-1;k.push(m,u,K);k.push(u,E,K)}a=q.create_empty_va_frame();a.a_position=new Float32Array(l);a.a_normal=new Float32Array(r);r=q.create_empty_submesh("GRID_PLANE");r.va_frames[0]=a;r.va_common.a_texcoord=new Float32Array(p);r.indices=new Uint32Array(k);
r.base_length=l.length/3;return r}function c(a){var b=a.length;if(b%4)throw"Wrong array";for(var c=[],d=[],l=0;l<b;l+=4){var r=a[l+1],p=a[l+2],t=a[l+3];k(a[l],d);k(r,d);k(p,d);k(t,d);c.push(l,l+1,l+2);c.push(l,l+2,l+3)}a=q.create_empty_va_frame();a.a_position=new Float32Array(d);b=q.create_empty_submesh("FROM_QUADS");b.va_frames[0]=a;b.indices=new Uint32Array(c);b.base_length=d.length/3;return b}function b(a,b){var c=3*b;return[a[c],a[c+1],a[c+2]]}function k(a,b){b.push(a[0],a[1],a[2])}var d=p("__config"),
l=p("__geometry");p("__print");var q=p("__util"),r=d.defaults;a.generate_line=function(){var a=q.create_empty_submesh("LINE"),b=q.create_empty_va_frame();b.a_position=new Float32Array(3);b.a_direction=new Float32Array(3);a.va_frames[0]=b;a.indices=new Uint32Array(1);a.base_length=1;return a};a.generate_plane=function(a,b){var c=t(2,2,a,b);c.name="PLANE";return c};a.generate_grid=t;a.generate_multigrid=function(a,b,c){function d(a,b){return 1==a%2&&(0==b||b==F-1)||1==b%2&&(0==a||a==t-1)?!0:!1}var k=
c/=Math.pow(2,a-1),p=c,t=b+1,F=b+1;b=[];c=[];for(var D=0,e=0,z=-1,y=[],v=0;v<a;v++){for(var m=2*k/(t-1),u=2*p/(F-1),K=[],E=[],M=0,J=0;J<t;J++){for(var O=-k+J*m,G=[],x=0;x<F;x++){var H=-p+x*u;if(O>-D&&O<D&&H>-e&&H<e)G.push(-1),M++;else{for(var P=null,I=0;I<y.length;I+=3)if(O==y[I]&&H==y[I+1]){P=y[I+2];break}I=null!==P?P:z+1;d(J,x)?(G.push(-2),M++):(null==P&&(0==x||x==F-1||0==J||J==t-1?(P=v==a-1?m:2*m,K.push(O,H,I)):P=m,c.push(O,P,H),z++),G.push(I));if(J&&x)if(1==J)if(d(J-1,x)){if(1<x){var H=I-1,P=
E[J-1][x+1],aa=P-1;b.push(I,H,aa)}else P=E[J-1][x+1],aa=P-1;b.push(I,aa,P)}else d(J,x)||(H=I-1,P=E[J-1][x],b.push(I,H,P));else if(J==t-1){if(!d(J,x))if(x==F-1)H=I-1,P=E[J-1][x-1],aa=E[J-2][x],b.push(I,H,P),b.push(I,P,aa);else{var H=I-1,P=E[J-1][x],aa=P-1,U=P+1;b.push(I,H,aa);b.push(I,aa,P);b.push(I,P,U);2==x&&(U=E[J-2][x-2],b.push(H,U,aa))}}else 1==x?d(J,x-1)?(H=E[J-1][x],P=E[J-1][x-1],b.push(I,P,H)):(H=G[x-1],P=E[J-1][x],aa=E[J-2][x-1],b.push(I,H,P),b.push(H,aa,P)):x==F-1?d(J,x)||(H=G[x-1],P=E[J-
1][x-1],aa=E[J-2][x],b.push(I,H,P),b.push(I,P,aa)):-1!=E[J-1][x]&&-1!=E[J-1][x-1]&&-1!=G[x-1]?(H=G[x-1],P=E[J-1][x],aa=E[J-1][x-1],b.push(I,H,P),b.push(H,aa,P),x==F-2&&d(J,x+1)&&(U=E[J-1][x+1],b.push(I,P,U))):x==F-2&&d(J,x+1)&&(P=E[J-1][x],U=E[J-1][x+1],b.push(I,P,U))}}E.push(G)}y=K;D=k;e=p;k*=2;p*=2}2E4>D&&(a=-(2*D)/(t-1),c.push(-2E4,a,-2E4),c.push(-2E4,a,2E4),c.push(-D,a,-e),c.push(-D,a,e),c.push(2E4,a,-2E4),c.push(2E4,a,2E4),c.push(D,a,-e),c.push(D,a,e),I=z+1,b.push(I+3,I+2,I+1,I+2,I+0,I+1,I+6,
I+4,I+2,I+4,I+0,I+2,I+5,I+7,I+1,I+7,I+3,I+1,I+5,I+4,I+7,I+7,I+4,I+6));a=q.create_empty_va_frame();a.a_position=new Float32Array(c);k=q.create_empty_submesh("multigrid_plane");k.va_frames[0]=a;k.indices=new Uint32Array(b);k.base_length=c.length/3;r.water_wireframe_debug&&(l.submesh_drop_indices(k,1,!0),a.a_polyindex=l.extract_polyindices(k));return k};a.generate_from_triangles=function(a){var b=a.length;if(b%3)throw"Wrong array";for(var c=[],d=[],l=0;l<b;l+=3){var r=a[l+1],p=a[l+2];k(a[l],d);k(r,d);
k(p,d);c.push(l,l+1,l+2)}a=q.create_empty_va_frame();a.a_position=new Float32Array(d);b=q.create_empty_submesh("FROM_TRIANGLES");b.va_frames[0]=a;b.indices=new Uint32Array(c);b.base_length=d.length/3;return b};a.generate_from_quads=c;a.generate_frustum=function(a){a=q.vectorize(a,[]);var b=[];b.push(a[0],a[1],a[2],a[3]);b.push(a[0],a[3],a[5],a[4]);b.push(a[3],a[2],a[6],a[5]);b.push(a[1],a[7],a[6],a[2]);b.push(a[0],a[4],a[7],a[1]);b.push(a[4],a[5],a[6],a[7]);a=c(b);a.name="FRUSTUM";return a};a.generate_fullscreen_tri=
function(){var a=q.create_empty_submesh("FULLSCREEN_TRI"),b=q.create_empty_va_frame();b.a_position=new Float32Array([0,0,1,0,0,1]);a.va_frames[0]=b;a.indices=new Uint32Array([0,1,2]);a.base_length=3;return a};a.generate_fullscreen_quad=function(){var a=q.create_empty_submesh("FULLSCREEN_QUAD"),b=q.create_empty_va_frame();b.a_position=new Float32Array([-1,1,1,1,-1,-1,1,-1]);a.va_frames[0]=b;a.indices=new Uint32Array([0,2,1,1,2,3]);a.base_length=4;return a};a.generate_billboard=function(){var a=q.create_empty_submesh("BILLBOARD"),
b=q.create_empty_va_frame();b.a_bb_vertex=new Float32Array([-.5,-.5,-.5,.5,.5,.5,.5,-.5]);a.va_frames[0]=b;a.indices=new Uint32Array([0,2,1,0,3,2]);a.base_length=4;return a};a.generate_cube=function(){var a=q.create_empty_submesh("CUBEMAP_BOARD"),b=q.create_empty_va_frame();b.a_position=new Float32Array([-1,-1,-1,1,1,1,1,-1]);a.va_frames[0]=b;a.indices=new Uint32Array([0,2,1,0,3,2]);a.base_length=4;return a};a.generate_uv_sphere=function(a,c,d,h,n,r){var p=q.create_empty_submesh("UV_SPHERE"),t,D,
e=[],z=[],y=[];for(D=0;D<=c;D++)for(t=0;t<=a;t++){var v=t/a,m=D/c,u=-d*Math.cos(2*v*Math.PI)*Math.sin(m*Math.PI),K=d*Math.cos(m*Math.PI),v=d*Math.sin(2*v*Math.PI)*Math.sin(m*Math.PI);n&&(u=1E-5>Math.abs(u)?0:u,K=1E-5>Math.abs(K)?0:K,v=1E-5>Math.abs(v)?0:v);z.push(u+h[0],K+h[1],v+h[2])}for(D=n=0;D<c;D++)for(t=0;t<a;t++)u=b(z,(a+1)*D+t+1),K=b(z,(a+1)*D+t),v=b(z,(a+1)*(D+1)+t),m=b(z,(a+1)*(D+1)+t+1),Math.abs(u[1])==d+h[1]?(k(u,e),k(v,e),k(m,e),r?y.push(n,n+1,n+1,n+2,n+2,n):y.push(n,n+1,n+2),n+=3):Math.abs(v[1])==
d+h[1]?(k(u,e),k(K,e),k(v,e),r?y.push(n,n+1,n+1,n+2,n+2,n):y.push(n,n+1,n+2),n+=3):(k(u,e),k(K,e),k(v,e),k(m,e),r?(y.push(n,n+1),y.push(n+1,n+2),y.push(n+2,n+3),y.push(n+3,n)):(y.push(n,n+1,n+2),y.push(n,n+2,n+3)),n+=4);a={};a.a_position=e;r?a.a_normal=[]:(r=l.calc_shared_indices(y,z,e),a.a_normal=l.calc_normals(y,e,r));a.a_tangent=[];p.va_common.a_influence=[];p.va_common.a_color=[];p.va_common.a_texcoord=[];p.va_frames[0]=a;p.indices=y;p.base_length=e.length/3;return p};a.generate_index=function(a){var b=
q.create_empty_submesh("INDEX"),c=q.create_empty_va_frame();c.a_index=new Float32Array(a);for(var d=0;d<a;d++)c.a_index[d]=d;b.va_frames[0]=c;b.indices=new Uint16Array(0);b.base_length=a;return b}};b4w.module.__prerender=function(a,p){function t(a,c){var d=a.obj_render;d.is_visible=!1;var k=c.camera,g="SHADOW_CAST"==c.type?k.lod_eye:l.get_trans_value(k.world_tsr,f);if(!d||d.hide)return!1;var r=d.bs_world.center,e=d.lod_dist_min,z=d.lod_dist_max,g=Math.sqrt((r[0]-g[0])*(r[0]-g[0])+(r[1]-g[1])*(r[1]-g[1])+(r[2]-g[2])*(r[2]-g[2])),r=d.lod_transition_ratio*d.bs_world.radius;if(!(g>=e&&g<z+r))return!1;d.is_visible=!0;if("OUTLINE_MASK"==c.type&&!Boolean(d.outline_intensity))return!1;k=k.frustum_planes;
d.do_not_cull?d=!1:"STATIC"===d.type?(e=d.bs_world,d=e.center,d=q.sphere_is_out_of_frustum(d,k,e.radius)):(e=d.be_world,d=e.center,d=q.ellipsoid_is_out_of_frustum(d,k,e.axis_x,e.axis_y,e.axis_z));return d?!1:"WIREFRAME"==c.type?a.batch.wireframe_mode==b.WM_DEBUG_SPHERES?a.batch.debug_sphere:!a.batch.debug_sphere:!0}var c=p("__config"),b=p("__debug"),k=p("__geometry"),d=p("__renderer"),l=p("__tsr"),q=p("__util"),r=p("__vec3"),g=c.defaults,C="MAIN_OPAQUE MAIN_BLEND MAIN_PLANE_REFLECT MAIN_CUBE_REFLECT MAIN_GLOW SHADOW_CAST DEPTH OUTLINE_MASK WIREFRAME COLOR_PICKING MAIN_XRAY COLOR_PICKING_XRAY".split(" "),
f=new Float32Array(3);a.prerender_subs=function(a){if(-1<C.indexOf(a.type)){for(var b=!1,c=a.bundles,q=0;q<c.length;q++){var p=c[q];if("MAIN_CUBE_REFLECT"==a.type)for(var D=0;6>D;D++)a.camera.frustum_planes=a.cube_cam_frustums[D],p.do_render_cube[D]=t(p,a),p.do_render_cube[D]&&(b=!0);else p.do_render=t(p,a),p.do_render&&(b=!0)}switch(a.type){case "WIREFRAME":break;default:"MAIN_OPAQUE"===a.type||"DEPTH"===a.type||"MAIN_GLOW"===a.type||b?a.do_render=!0:(a.do_render&&d.clear(a),a.do_render=!1)}}if("MAIN_BLEND"==
a.type&&g.alpha_sort&&a.bundles){b=l.get_trans_value(a.camera.world_tsr,f);c=r.dist(b,a.zsort_eye_last)>g.alpha_sort_threshold;for(q=0;q<a.bundles.length;q++)if(D=a.bundles[q],p=D.obj_render,p.force_zsort||c){var e=D.batch;if(e&&e.blend&&e.zsort_type!=k.ZSORT_DISABLED){e=e.bufs_data;if(!e||!D.do_render)continue;(D=e.info_for_z_sort_updates)&&D.type==k.ZSORT_BACK_TO_FRONT&&k.update_buffers_movable(e,p.world_tsr,b)}p.force_zsort=!1}c&&r.copy(b,a.zsort_eye_last)}}};b4w.module.__print=function(a,p){function t(a,b){var c=[];-1<a[0].indexOf("%c")?c.push(a[0].replace("%c","%c"+b+": ")):c.push(b+": "+a[0]);for(var d=1;d<a.length;d++)c.push(a[d]);return c}function c(){l++;var a=t(arguments,"B4W ERROR");console.error.apply(console,a)}function b(a){a in r||(r[a]=a,c([a]))}function k(a,c){b(a+"() is deprecated, use "+c+"() instead.")}var d=!1,l=0,q=0,r={};a.set_verbose=function(a){d=a};a.log_raw=function(){console.log.apply(console,arguments)};a.log=function(){if(d){var a=
t(arguments,"B4W LOG");console.log.apply(console,a)}};a.error=c;a.error_once=b;a.error_deprecated=k;a.error_deprecated_arr=function(a,c){switch(1<c.length){case !0:b(a+"() is deprecated, use "+c.slice(0,-1).join("(), ")+"() or "+c[c.length-1]+"() instead.");break;case !1:k(a,c[0])}};a.error_deprecated_cfg=function(a,c){b('Config option "'+a+'" is deprecated, use "'+c+'" instead.')};a.warn=function(){q++;var a=t(arguments,"B4W WARN");console.warn.apply(console,a)};a.info=function(){var a=t(arguments,
"B4W INFO");console.info.apply(console,a)};a.export_error=function(){l++;var a=t(arguments,"B4W EXPORT ERROR");console.error.apply(console,a)};a.export_warn=function(){q++;var a=t(arguments,"B4W EXPORT WARNING");console.warn.apply(console,a)};a.time=function(){d&&console.time.apply(console,arguments)};a.timeEnd=function(){d&&console.timeEnd.apply(console,arguments)};a.group=function(){d&&console.group.apply(console,arguments)};a.groupCollapsed=function(){d&&console.groupCollapsed.apply(console,arguments)};
a.groupEnd=function(){d&&console.groupEnd.apply(console,arguments)};a.clear=function(){"function"==typeof console.clear&&console.clear.apply(console,arguments)};a.get_warning_count=function(){return q};a.get_error_count=function(){return l};a.clear_errors_warnings=function(){l=q=0}};b4w.module.print=b4w.module.__print;b4w.module.__reformer=function(a,p){function t(a){switch(a.type){case "MAPPING":a.vector_type||(a.vector_type="POINT",b("node Mapping",a,"vector_type"));break;case "MATERIAL":case "MATERIAL_EXT":"alpha"in a||(a.alpha=1,b("node material",a,"alpha"));"darkness"in a||(a.darkness=1,b("node material",a,"darkness"));"diffuse_toon_size"in a||(a.diffuse_toon_size=.5,b("node material",a,"diffuse_toon_size"));"diffuse_toon_smooth"in a||(a.diffuse_toon_smooth=.1,b("node material",a,"diffuse_toon_smooth"));"diffuse_intensity"in
a||(a.diffuse_intensity=1,b("node material",a,"diffuse_intensity"));"specular_shader"in a||(a.specular_shader="COOKTORR",b("node material",a,"specular_shader"));"specular_ior"in a||(a.specular_ior=4,b("node material",a,"specular_ior"));"specular_hardness"in a||(a.specular_hardness=50,b("node material",a,"specular_hardness"));"specular_slope"in a||(a.specular_slope=.1,b("node material",a,"specular_slope"));"specular_toon_size"in a||(a.specular_toon_size=.5,b("node material",a,"specular_toon_size"));
"specular_toon_smooth"in a||(a.specular_toon_smooth=.1,b("node material",a,"specular_toon_smooth"));"specular_intensity"in a||(a.specular_intensity=.5,b("node material",a,"specular_intensity"));"diffuse_shader"in a||(a.diffuse_shader="LAMBERT",b("node material",a,"diffuse_shader"));"roughness"in a||(a.roughness=.5,b("node material",a,"roughness"));"diffuse_fresnel"in a||(a.diffuse_fresnel=.1,b("node material",a,"diffuse_fresnel"));"diffuse_fresnel_factor"in a||(a.diffuse_fresnel_factor=.5,b("node material",
a,"diffuse_fresnel_factor"));break;case "MATH":case "MIX_RGB":"use_clamp"in a||(a.use_clamp=!1,b("node "+a.type,a,"use_clamp"));break;case "GROUP":switch(a.node_tree_name=a.node_tree_name.replace(/\.[0-9]{3,}$/g,""),a.node_tree_name){case "CLAMP":case "LEVELS_OF_QUALITY":case "LINEAR_TO_SRGB":case "NORMAL_VIEW":case "PARALLAX":case "REFLECT":case "REFRACTION":case "REPLACE":case "SMOOTHSTEP":case "SRGB_TO_LINEAR":case "TIME":case "TRANSLUCENCY":case "VECTOR_VIEW":a.node_tree_name="B4W_"+a.node_tree_name}}}
function c(a){if(a=a.nla_tracks)for(var c=0;c<a.length;c++)for(var d=a[c],h=0;h<d.strips.length;h++){var k=d.strips[h];"action"in k||(k.action=null,b("strip",k,"action"));"action_frame_start"in k||(k.action_frame_start=0,b("strip",k,"action_frame_start"));"action_frame_end"in k||(k.action_frame_end=k.frame_end-k.frame_start,b("strip",k,"action_frame_end"));"repeat"in k||(k.repeat=1,b("strip",k,"repeat"));"use_reverse"in k||(k.use_reverse=!1,b("strip",k,"use_reverse"));"scale"in k||(k.scale=1,b("strip",
k,"scale"))}}function b(a,b,c){c=c+">>"+a;c in F||(F[c]={storage:[],report_type:"undefined",type:a});F[c].storage.push(b.name)}function k(a,b,c){c=c+">>"+a;c in F||(F[c]={storage:[],report_type:"deprecated",type:a});F[c].storage.push(b.name)}function d(a){C.warn(a)}function l(a,b){b||(b=a.name+"_COPY");var c=a.materials,d=a.submeshes;a.materials=null;a.submeshes=null;var k=h.clone_object_json(a);a.materials=c;a.submeshes=d;k.name=b;k.materials=a.materials.slice(0);k.submeshes=[];for(c=0;c<d.length;c++){var f=
h.clone_object_nr(d[c]);k.submeshes.push(f)}return k}var q=p("__boundings"),r=p("__curve"),g=p("__mat4"),C=p("__print"),f=p("__quat"),h=p("__util"),n=p("__vec3"),A=p("__vec4"),B=[5,4],F={};a.check_particles_bin_format=function(a){return-1!=h.version_cmp(a,B)};a.check_bpy_data=function(a){F={};var e=a.worlds;if(0==e.length){C.warn('WARNING Datablock world is missing, reexport "'+a.b4w_filepath_blend+'" scene');var f={name:"DEFAULT",horizon_color:new Float32Array([0,0,0]),zenith_color:new Float32Array([0,
0,0]),light_settings:{use_environment_light:!1,environment_energy:1,environment_color:"PLAIN"},fog_settings:{use_fog:!1,intensity:0,depth:25,start:5,height:0,falloff:"INVERSE_QUADRATIC",use_custom_color:!0,color:[.5,.5,.5]},use_sky_paper:!1,use_sky_blend:!1,use_sky_real:!1,texture_slots:[]};e.push(f)}for(var e=a.worlds,g=0;g<e.length;g++){f=e[g];"use_sky_blend"in f||(b("world",f,"use_sky_blend"),f.use_sky_blend=!1);"use_sky_paper"in f||(b("world",f,"use_sky_paper"),f.use_sky_paper=!1);"use_sky_real"in
f||(b("world",f,"use_sky_real"),f.use_sky_real=!1);"b4w_sky_settings"in f&&"rayleigh_brightness"in f.b4w_sky_settings||(b("world",f,"rayleigh_brightness"),f.b4w_sky_settings={render_sky:!1,procedural_skydome:!1,use_as_enviroment_map:!1,color:[.24,.43,.75],rayleigh_brightness:3.3,mie_brightness:.1,spot_brightness:10,scatter_strength:.2,rayleigh_strength:.2,mie_strength:.006,rayleigh_collection_power:.5,mie_collection_power:.5,mie_distribution:.4});"fog_settings"in f||(b("world",f,"fog_settings"),f.fog_settings=
{use_fog:!1,intensity:0,depth:25,start:0,height:0,falloff:"QUADRATIC",use_custom_color:!0,color:[.5,.5,.5]},"b4w_fog_color"in f&&(f.fog_settings.use_custom_color=!0,f.fog_settings.color=f.b4w_fog_color),"b4w_fog_density"in f&&0<f.b4w_fog_density&&(f.fog_settings.depth=1/f.b4w_fog_density));"render_sky"in f.b4w_sky_settings||(b("world",f,"render_sky"),f.b4w_sky_settings.render_sky=!1);for(var l=f.texture_slots,f=0;f<l.length;f++){var m=l[f];"blend_type"in m||(m.blend_type="MIX",b("world_texture_slot",
m,"blend_type"));"use_map_blend"in m||(m.use_map_blend=!1,b("world_texture_slot",m,"use_map_blend"));"use_map_horizon"in m||(m.use_map_horizon=!0,b("world_texture_slot",m,"use_map_horizon"));"use_map_zenith_up"in m||(m.use_map_zenith_up=!1,b("world_texture_slot",m,"use_map_zenith_up"));"use_rgb_to_intensity"in m||(m.use_rgb_to_intensity=!1,b("world_texture_slot",m,"use_rgb_to_intensity"));"invert"in m||(m.invert=!1,b("world_texture_slot",m,"invert"));"color"in m||(m.color=[1,0,1],b("world_texture_slot",
m,"color"));"blend_factor"in m||(m.blend_factor=0,b("world_texture_slot",m,"blend_factor"));"horizon_factor"in m||(m.horizon_factor=1,b("world_texture_slot",m,"horizon_factor"));"zenith_up_factor"in m||(m.zenith_up_factor=0,b("world_texture_slot",m,"zenith_up_factor"));"zenith_down_factor"in m||(m.zenith_down_factor=0,b("world_texture_slot",m,"zenith_down_factor"));"default_value"in m||(m.default_value=1,b("world_texture_slot",m,"default_value"))}}f=a.scenes;for(g=0;g<f.length;g++)l=f[g],m=l.world,
"timeline_markers"in l||(l.timeline_markers=null,b("scene",l,"timeline_markers")),"b4w_reflection_quality"in l||(l.b4w_reflection_quality="MEDIUM",b("scene",l,"b4w_reflection_quality")),"b4w_use_nla"in l||(l.b4w_use_nla=!1,b("scene",l,"b4w_use_nla")),"fps"in l||(l.fps=24,b("scene",l,"fps")),"b4w_nla_cyclic"in l||(l.b4w_nla_cyclic=!1,b("scene",l,"b4w_nla_cyclic")),"b4w_logic_nodes"in l||(l.b4w_logic_nodes=[],b("scene",l,"b4w_logic_nodes")),"b4w_detect_collisions"in l&&(k("scene",l,"b4w_detect_collisions"),
delete l.b4w_detect_collisions),"audio_doppler_speed"in l||(l.audio_doppler_speed=343.3),"audio_doppler_factor"in l||(l.audio_doppler_factor=1),"b4w_dynamic_compressor_settings"in l||(l.b4w_dynamic_compressor_settings={threshold:-24,knee:30,ratio:12,attack:.003,release:.25},b("scene",l,"b4w_dynamic_compressor_settings")),"b4w_enable_convolution_engine"in l||(l.b4w_enable_convolution_engine=!1),"b4w_enable_bloom"in l||(l.b4w_enable_bloom=!1,b("scene",l,"b4w_enable_bloom")),"b4w_enable_motion_blur"in
l||(l.b4w_enable_motion_blur=!1,b("scene",l,"b4w_enable_motion_blur")),"b4w_enable_color_correction"in l||(l.b4w_enable_color_correction=!1,b("scene",l,"b4w_enable_color_correction")),"b4w_antialiasing_quality"in l||(l.b4w_antialiasing_quality="MEDIUM",b("scene",l,"b4w_antialiasing_quality")),"b4w_tags"in l||(l.b4w_tags={title:"",description:""},b("scene",l,"b4w_tags")),"b4w_enable_object_selection"in l||(l.b4w_enable_object_selection="AUTO",b("scene",l,"b4w_enable_object_selection")),"b4w_enable_outlining"in
l||(l.b4w_enable_outlining="AUTO",b("scene",l,"b4w_enable_outlining")),"b4w_enable_glow_materials"in l||(l.b4w_enable_glow_materials="AUTO",b("scene",l,"b4w_enable_glow_materials")),"b4w_enable_anchors_visibility"in l||(l.b4w_enable_anchors_visibility="AUTO",b("scene",l,"b4w_enable_anchors_visibility")),"b4w_outline_color"in l||(l.b4w_outline_color=[1,1,1],b("scene",l,"b4w_outline_color")),"b4w_outline_factor"in l||(l.b4w_outline_factor="b4w_glow_factor"in l?l.b4w_glow_factor:1,b("scene",l,"b4w_outline_factor")),
"b4w_shadow_settings"in l||(b("scene",l,"b4w_shadow_settings"),e=m.b4w_shadow_settings,l.b4w_shadow_settings=e?e:{csm_resolution:2048,self_shadow_polygon_offset:1,b4w_enable_csm:!1,csm_num:1,csm_first_cascade_border:10,first_cascade_blur_radius:3,csm_last_cascade_border:100,last_cascade_blur_radius:1.5,fade_last_cascade:!0,blend_between_cascades:!0}),e=l.b4w_shadow_settings,"csm_resolution"in e||(b("scene",l,"b4w_shadow_settings.csm_resolution"),e.csm_resolution=2048),"self_shadow_polygon_offset"in
e||(b("scene",l,"b4w_shadow_settings.self_shadow_polygon_offset"),e.self_shadow_polygon_offset=1),"self_shadow_normal_offset"in e||(b("scene",l,"b4w_shadow_settings.self_shadow_normal_offset"),e.self_shadow_normal_offset=.01),"b4w_enable_csm"in e||(b("scene",l,"b4w_shadow_settings.b4w_enable_csm"),e.b4w_enable_csm=!1),"csm_num"in e||(b("scene",l,"b4w_shadow_settings.csm_num"),e.csm_num=1),"csm_first_cascade_border"in e||(b("scene",l,"b4w_shadow_settings.csm_first_cascade_border"),e.csm_first_cascade_border=
10),"first_cascade_blur_radius"in e||(b("scene",l,"b4w_shadow_settings.first_cascade_blur_radius"),e.first_cascade_blur_radius=3),"csm_last_cascade_border"in e||(b("scene",l,"b4w_shadow_settings.csm_last_cascade_border"),e.csm_last_cascade_border=100),"last_cascade_blur_radius"in e||(b("scene",l,"b4w_shadow_settings.last_cascade_blur_radius"),e.last_cascade_blur_radius=1.5),"fade_last_cascade"in e||(b("scene",l,"b4w_shadow_settings.fade_last_cascade"),e.fade_last_cascade=!0),"blend_between_cascades"in
e||(b("scene",l,"b4w_shadow_settings.blend_between_cascades"),e.blend_between_cascades=!0),"b4w_ssao_settings"in l||(b("scene",l,"b4w_ssao_settings"),e=m.b4w_ssao_settings,l.b4w_ssao_settings=e?e:{dist_factor:0,samples:16,hemisphere:!1,blur_depth:!1,blur_discard_value:1}),e=l.b4w_ssao_settings,"dist_factor"in e||(b("scene",l,"b4w_ssao_settings.dist_factor"),e.dist_factor=0),"samples"in e||(b("scene",l,"b4w_ssao_settings.samples"),e.samples=16),"hemisphere"in e||(b("scene",l,"b4w_ssao_settings.hemisphere"),
e.hemisphere=!1),"blur_depth"in e||(b("scene",l,"b4w_ssao_settings.blur_depth"),e.blur_depth=!1),"blur_discard_value"in e||(b("scene",l,"b4w_ssao_settings.blur_discard_value"),e.blur_discard_value=1),"b4w_bloom_settings"in l||(b("scene",l,"b4w_bloom_settings"),e=m.b4w_bloom_settings,l.b4w_bloom_settings=e?e:{key:.2,blur:4,edge_lum:1}),"key"in l.b4w_bloom_settings||(b("scene",l,"b4w_bloom_settings.key"),l.b4w_bloom_settings.key=.2),"blur"in l.b4w_bloom_settings||(b("scene",l,"b4w_bloom_settings.blur"),
l.b4w_bloom_settings.blur=4),"edge_lum"in l.b4w_bloom_settings||(b("scene",l,"b4w_bloom_settings.edge_lum"),l.b4w_bloom_settings.edge_lum=1),"b4w_motion_blur_settings"in l||(b("scene",l,"b4w_motion_blur_settings"),e=m.b4w_motion_blur_settings,l.b4w_motion_blur_settings=e?e:{motion_blur_factor:.01,motion_blur_decay_threshold:.01}),"motion_blur_factor"in l.b4w_motion_blur_settings||(b("scene",l,"b4w_motion_blur_settings.motion_blur_factor"),l.b4w_motion_blur_settings.motion_blur_factor=.01),"motion_blur_decay_threshold"in
l.b4w_motion_blur_settings||(b("scene",l,"b4w_motion_blur_settings.motion_blur_decay_threshold"),l.b4w_motion_blur_settings.motion_blur_decay_threshold=.01),"b4w_color_correction_settings"in l||(b("scene",l,"b4w_color_correction_settings"),e=m.b4w_color_correction_settings,l.b4w_color_correction_settings=e?e:{brightness:0,contrast:0,exposure:1,saturation:1}),"b4w_god_rays_settings"in l||(b("scene",l,"b4w_god_rays_settings"),e=m.b4w_god_rays_settings,l.b4w_god_rays_settings=e?e:{intensity:.7,max_ray_length:1,
steps_per_pass:10}),"steps_per_pass"in l.b4w_god_rays_settings||(b("scene",l,"b4w_god_rays_settings.steps_per_pass"),l.b4w_god_rays_settings.steps_per_pass=10),"b4w_glow_settings"in l||(b("scene",l,"b4w_glow_settings"),l.b4w_glow_settings={render_glow_over_blend:!1,small_glow_mask_coeff:2,large_glow_mask_coeff:2,small_glow_mask_width:2,large_glow_mask_width:6},e=l.b4w_glow_settings,"b4w_render_glow_over_blend"in m&&(e.render_glow_over_blend=m.b4w_render_glow_over_blend),"b4w_small_glow_mask_coeff"in
m&&(e.small_glow_mask_coeff=m.b4w_small_glow_mask_coeff),"b4w_large_glow_mask_coeff"in m&&(e.large_glow_mask_coeff=m.b4w_large_glow_mask_coeff),"b4w_small_glow_mask_width"in m&&(e.small_glow_mask_width=m.b4w_small_glow_mask_width),"b4w_large_glow_mask_width"in m&&(e.large_glow_mask_width=m.b4w_large_glow_mask_width)),m=l.b4w_render_shadows,"AUTO"!=m&&"OFF"!=m&&"ON"!=m&&(l.b4w_render_shadows=m?"ON":"OFF"),m=l.b4w_render_reflections,"OFF"!=m&&"ON"!=m&&(l.b4w_render_reflections=m?"ON":"OFF"),m=l.b4w_render_refractions,
"AUTO"!=m&&"OFF"!=m&&"ON"!=m&&(l.b4w_render_refractions=m?"ON":"OFF"),l.b4w_nla_script&&k("scene",l,"b4w_nla_script");l=a.meshes;for(g=0;g<l.length;g++){m=l[g];m.b4w_bounding_box||(b("mesh",m,"b4w_bounding_box"),m.b4w_bounding_box={max_x:0,max_y:0,max_z:0,min_x:0,min_y:0,min_z:0});m.b4w_bounding_box_source||(b("mesh",m,"b4w_bounding_box_source"),m.b4w_bounding_box_source=m.b4w_bounding_box);m.uv_textures||(b("mesh",m,"uv_textures"),m.uv_textures=[]);m.b4w_bounding_sphere_center||(m.b4w_bounding_sphere_center=
[0,0,0]);m.b4w_bounding_cylinder_center||(m.b4w_bounding_cylinder_center=[0,0,0]);m.b4w_bounding_ellipsoid_center||(m.b4w_bounding_ellipsoid_center=[0,0,0]);m.b4w_bounding_ellipsoid_axes||(f=m.b4w_bounding_box,m.b4w_bounding_ellipsoid_axes=[(f.max_x-f.min_x)/2,(f.max_y-f.min_y)/2,(f.max_z-f.min_z)/2]);"b4w_shape_keys"in m||(m.b4w_shape_keys=[],b("mesh",m,"b4w_shape_keys"));for(var f=m,e=["b4w_apply_scale","b4w_apply_modifiers","b4w_export_edited_normals","b4w_loc_export_vertex_anim","b4w_shape_keys"],
n=null,q=0;q<e.length;q++)f[e[q]]&&(n?(f[e[q]]=!1,C.warn('WARNING property "'+e[q]+'" of object "'+f.name+'" has been set to "false". Foreground property "'+n+'" already exists.')):n=e[q]);for(f=0;f<m.b4w_vertex_anim.length;f++)e=m.b4w_vertex_anim[f],"allow_nla"in e||(b('mesh["b4w_vertex_anim"]',m,"allow_nla"),e.allow_nla=!0)}f=a.cameras;for(g=0;g<f.length;g++)l=f[g],l.type||(l.type="PERSP",b("camera",l,"type")),"b4w_eye_target_dist"in l&&(delete l.b4w_eye_target_dist,k("camera",l,"b4w_eye_target_dist")),
"b4w_hover_zero_level"in l||(l.b4w_hover_zero_level=0,b("camera",l,"b4w_hover_zero_level")),"b4w_trans_velocity"in l||(l.b4w_trans_velocity=1,b("camera",l,"b4w_trans_velocity")),"b4w_rot_velocity"in l||(l.b4w_rot_velocity=1,b("camera",l,"b4w_rot_velocity")),"b4w_zoom_velocity"in l||(l.b4w_zoom_velocity=.1,b("camera",l,"b4w_zoom_velocity")),"b4w_use_target_distance_limits"in l||(l.b4w_use_target_distance_limits=l.b4w_use_distance_limits||!1,b("camera",l,"b4w_use_target_distance_limits")),"b4w_use_zooming"in
l||(l.b4w_use_zooming=l.b4w_use_distance_limits||!1,b("camera",l,"b4w_use_zooming")),"b4w_distance_min"in l||(l.b4w_distance_min=1,b("camera",l,"b4w_distance_min")),"b4w_distance_max"in l||(l.b4w_distance_max=100,b("camera",l,"b4w_distance_max")),"b4w_horizontal_translation_min"in l||(l.b4w_horizontal_translation_min=-100,b("camera",l,"b4w_horizontal_translation_min")),"b4w_horizontal_translation_max"in l||(l.b4w_horizontal_translation_max=100,b("camera",l,"b4w_horizontal_translation_max")),"b4w_vertical_translation_min"in
l||(l.b4w_vertical_translation_min=-100,b("camera",l,"b4w_vertical_translation_min")),"b4w_vertical_translation_max"in l||(l.b4w_vertical_translation_max=100,b("camera",l,"b4w_vertical_translation_max")),"b4w_use_horizontal_clamping"in l||(l.b4w_use_horizontal_clamping=!1,b("camera",l,"b4w_use_horizontal_clamping")),"b4w_rotation_left_limit"in l||(l.b4w_rotation_left_limit=-Math.PI,b("camera",l,"b4w_rotation_left_limit")),"b4w_rotation_right_limit"in l||(l.b4w_rotation_right_limit=Math.PI,b("camera",
l,"b4w_rotation_right_limit")),"b4w_horizontal_clamping_type"in l||(l.b4w_horizontal_clamping_type="LOCAL",b("camera",l,"b4w_horizontal_clamping_type")),"b4w_use_vertical_clamping"in l||(l.b4w_use_vertical_clamping=!1,b("camera",l,"b4w_use_vertical_clamping")),"b4w_rotation_down_limit"in l||(l.b4w_rotation_down_limit=-Math.PI/2,b("camera",l,"b4w_rotation_down_limit")),"b4w_rotation_up_limit"in l||(l.b4w_rotation_up_limit=Math.PI/2,b("camera",l,"b4w_rotation_up_limit")),"b4w_vertical_clamping_type"in
l||(l.b4w_vertical_clamping_type="LOCAL",b("camera",l,"b4w_vertical_clamping_type")),"b4w_hover_angle_min"in l||(l.b4w_hover_angle_min=Math.PI/6,b("camera",l,"b4w_hover_angle_min")),"b4w_hover_angle_max"in l||(l.b4w_hover_angle_max=Math.PI/6,b("camera",l,"b4w_hover_angle_max")),"b4w_enable_hover_hor_rotation"in l||(l.b4w_enable_hover_hor_rotation=!0,b("camera",l,"b4w_enable_hover_hor_rotation")),"b4w_use_panning"in l||(l.b4w_use_panning=!0,b("camera",l,"b4w_use_panning"));f=a.lamps;for(g=0;g<f.length;g++)l=
f[g],"b4w_generate_shadows"in l||(l.b4w_generate_shadows=!1,b("lamp",l,"b4w_generate_shadows")),"b4w_dynamic_intensity"in l||(l.b4w_dynamic_intensity=!1,b("lamp",l,"b4w_dynamic_intensity")),"use_diffuse"in l||(l.use_diffuse=!0,b("lamp",l,"use_diffuse")),"use_specular"in l||(l.use_specular=!0,b("lamp",l,"use_specular"));f=a.speakers;for(g=0;g<f.length;g++)l=f[g],"b4w_behavior"in l||(l.b4w_behavior=l.b4w_background_music?"BACKGROUND_SOUND":"POSITIONAL"),"b4w_disable_doppler"in l||(l.b4w_disable_doppler=
!1),"b4w_delay"in l||(l.b4w_delay=0),"b4w_delay_random"in l||(l.b4w_delay_random=0),"b4w_volume_random"in l||(l.b4w_volume_random=0),"b4w_pitch_random"in l||(l.b4w_pitch_random=0),"b4w_fade_in"in l||(l.b4w_fade_in=0),"b4w_fade_out"in l||(l.b4w_fade_out=0),"b4w_loop"in l||(l.b4w_loop=!1),"b4w_loop_count"in l||(l.b4w_loop_count=0),"b4w_loop_count_random"in l||(l.b4w_loop_count_random=0),"b4w_playlist_id"in l||(l.b4w_playlist_id=""),l.animation_data&&c(l.animation_data);f=a.textures;for(g=0;g<f.length;g++)l=
f[g],"b4w_anisotropic_filtering"in l||(l.b4w_anisotropic_filtering="OFF",b("texture",l,"b4w_anisotropic_filtering")),"b4w_water_foam"in l||(l.b4w_water_foam=!1,b("texture",l,"b4w_water_foam")),"b4w_foam_uv_freq"in l||(l.b4w_foam_uv_freq=[1,1],b("texture",l,"b4w_foam_uv_freq")),"b4w_foam_uv_magnitude"in l||(l.b4w_foam_uv_magnitude=[1,1],b("texture",l,"b4w_foam_uv_magnitude")),"b4w_parallax_steps"in l||(l.b4w_parallax_steps=5,b("material",l,"b4w_parallax_steps")),"b4w_parallax_lod_dist"in l||(l.b4w_parallax_lod_dist=
10,b("material",l,"b4w_parallax_lod_dist")),"b4w_shore_dist_map"in l||(l.b4w_shore_dist_map=!1,b("texture",l,"b4w_shore_dist_map")),"b4w_shore_boundings"in l||(l.b4w_shore_boundings=new Float32Array(4),l.b4w_shore_boundings=[1E3,-1E3,1E3,-1E3],b("texture",l,"b4w_shore_boundings")),"b4w_max_shore_dist"in l||(l.b4w_max_shore_dist=100,b("texture",l,"b4w_max_shore_dist")),"b4w_disable_compression"in l||(l.b4w_disable_compression=!1,b("texture",l,"b4w_disable_compression")),"b4w_source_type"in l||(l.b4w_source_type=
"",b("texture",l,"b4w_source_type")),"b4w_source_id"in l||(l.b4w_source_id="",b("texture",l,"b4w_source_id")),"b4w_source_size"in l||(l.b4w_source_size=1024,b("texture",l,"b4w_source_size")),"b4w_enable_canvas_mipmapping"in l||(l.b4w_enable_canvas_mipmapping=!0,b("texture",l,"b4w_enable_canvas_mipmapping")),"b4w_nla_video"in l||(l.b4w_nla_video=!1,b("texture",l,"b4w_nla_video"));e=a.materials;for(g=0;g<e.length;g++){n=e[g];"ALPHA_ANTIALIASING"==n.game_settings.alpha_blend&&(n.game_settings.alpha_blend=
"CLIP");"b4w_node_mat_type"in n&&k("material",n,"b4w_node_mat_type");"b4w_skydome"in n&&k("material",n,"b4w_skydome");"b4w_procedural_skydome"in n&&k("material",n,"b4w_procedural_skydome");n.b4w_water&&("b4w_water_shore_smoothing"in n||(n.b4w_water_shore_smoothing=!1,b("material",n,"b4w_water_shore_smoothing")),"b4w_water_dynamic"in n||(n.b4w_water_dynamic=!1,b("material",n,"b4w_water_dynamic")),"b4w_waves_height"in n||(n.b4w_waves_height=1,b("material",n,"b4w_waves_height")),"b4w_waves_length"in
n||(n.b4w_waves_length=1,b("material",n,"b4w_waves_length")),"b4w_water_dst_noise_scale0"in n||(n.b4w_water_dst_noise_scale0=.05,b("material",n,"b4w_water_dst_noise_scale0")),"b4w_water_dst_noise_scale1"in n||(n.b4w_water_dst_noise_scale1=.03,b("material",n,"b4w_water_dst_noise_scale1")),"b4w_water_dst_noise_freq0"in n||(n.b4w_water_dst_noise_freq0=1.3,b("material",n,"b4w_water_dst_noise_freq0")),"b4w_water_dst_noise_freq1"in n||(n.b4w_water_dst_noise_freq1=1,b("material",n,"b4w_water_dst_noise_freq1")),
"b4w_water_dir_min_shore_fac"in n||(n.b4w_water_dir_min_shore_fac=.4,b("material",n,"b4w_water_dir_min_shore_fac")),"b4w_water_dir_freq"in n||(n.b4w_water_dir_freq=.5,b("material",n,"b4w_water_dir_freq")),"b4w_water_dir_noise_scale"in n||(n.b4w_water_dir_noise_scale=.05,b("material",n,"b4w_water_dir_noise_scale")),"b4w_water_dir_noise_freq"in n||(n.b4w_water_dir_noise_freq=.07,b("material",n,"b4w_water_dir_noise_freq")),"b4w_water_dir_min_noise_fac"in n||(n.b4w_water_dir_min_noise_fac=.5,b("material",
n,"b4w_water_dir_min_noise_fac")),"b4w_water_dst_min_fac"in n||(n.b4w_water_dst_min_fac=.2,b("material",n,"b4w_water_dst_min_fac")),"b4w_water_waves_hor_fac"in n||(n.b4w_water_waves_hor_fac=5,b("material",n,"b4w_water_waves_hor_fac")),"b4w_water_absorb_factor"in n||(n.b4w_water_absorb_factor=6,b("material",n,"b4w_water_absorb_factor")),"b4w_water_fog_color"in n||(n.b4w_water_fog_color=new Float32Array(3),n.b4w_water_fog_color=[.5,.7,.7],b("material",n,"b4w_water_fog_color")),"b4w_foam_factor"in n||
(n.b4w_foam_factor=5,b("material",n,"b4w_foam_factor")),"b4w_generated_mesh"in n||(n.b4w_generated_mesh=!1,b("material",n,"b4w_generated_mesh")),"b4w_water_num_cascads"in n||(n.b4w_water_num_cascads=5,b("material",n,"b4w_water_num_cascads")),"b4w_water_subdivs"in n||(n.b4w_water_subdivs=64,b("material",n,"b4w_water_subdivs")),"b4w_water_detailed_dist"in n||(n.b4w_water_detailed_dist=1E3,b("material",n,"b4w_water_detailed_dist")),"b4w_water_enable_caust"in n||(n.b4w_water_enable_caust=!1,b("material",
n,"b4w_water_enable_caust")),"b4w_water_caust_scale"in n||(n.b4w_water_caust_scale=.25,b("material",n,"b4w_water_caust_scale")),"b4w_water_caust_brightness"in n||(n.b4w_water_caust_brightness=.5,b("material",n,"b4w_water_caust_brightness")));"b4w_dynamic_grass_size"in n||(n.b4w_dynamic_grass_size="");"b4w_dynamic_grass_color"in n||(n.b4w_dynamic_grass_color="");"diffuse_intensity"in n||(n.diffuse_intensity=1,b("material",n,"diffuse_intensity"));"b4w_use_ghost"in n||(n.b4w_use_ghost=!1);"b4w_collision_margin"in
n||(n.b4w_collision_margin=.04,b("material",n,"b4w_collision_margin"));"b4w_collision_group"in n||(n.b4w_collision_group=128,b("material",n,"b4w_collision_group"));"b4w_collision_mask"in n||(n.b4w_collision_mask=127,b("material",n,"b4w_collision_mask"));"b4w_do_not_render"in n||(n.b4w_do_not_render=!1,b("material",n,"b4w_do_not_render"));"HALO"!=n.type||"b4w_halo_sky_stars"in n||(n.b4w_halo_sky_stars=!1,b("material",n,"b4w_halo_sky_stars"));"HALO"!=n.type||"b4w_halo_stars_blend_height"in n||(n.b4w_halo_stars_blend_height=
10,b("material",n,"b4w_halo_stars_blend_height"));"HALO"!=n.type||"b4w_halo_stars_min_height"in n||(n.b4w_halo_stars_min_height=0,b("material",n,"b4w_halo_stars_min_height"));"specular_shader"in n||(n.specular_shader="COOKTORR",b("material",n,"specular_shader"));"diffuse_shader"in n||(n.diffuse_shader="LAMBERT",b("material",n,"diffuse_shader"));"roughness"in n||(n.roughness=.5,b("material",n,"roughness"));"diffuse_fresnel"in n||(n.diffuse_fresnel=.1,b("material",n,"diffuse_fresnel"));"diffuse_fresnel_factor"in
n||(n.diffuse_fresnel_factor=.5,b("material",n,"diffuse_fresnel_factor"));"specular_slope"in n||(n.specular_slope=.2,b("material",n,"specular_slope"));"specular_toon_size"in n||(n.specular_toon_size=.5,b("material",n,"specular_toon_size"));"specular_toon_smooth"in n||(n.specular_toon_smooth=.1,b("material",n,"specular_toon_smooth"));"specular_alpha"in n||(n.specular_alpha=1,b("material",n,"specular_alpha"));"b4w_wettable"in n||(n.b4w_wettable=!1,b("material",n,"b4w_wettable"));"b4w_refractive"in n||
(n.b4w_refractive=!1,b("material",n,"b4w_refractive"));"b4w_refr_bump"in n||(n.b4w_refr_bump=0,b("material",n,"b4w_refr_bump"));"b4w_shallow_water_col"in n||(n.b4w_shallow_water_col=[0,.8,.3],b("material",n,"b4w_shallow_water_col"));"b4w_shore_water_col"in n||(n.b4w_shore_water_col=[0,.9,.2],b("material",n,"b4w_shore_water_col"));"b4w_shallow_water_col_fac"in n||(n.b4w_shallow_water_col_fac=1,b("material",n,"b4w_shallow_water_col_fac"));"b4w_shore_water_col_fac"in n||(n.b4w_shore_water_col_fac=.5,
b("material",n,"b4w_shore_water_col_fac"));"b4w_water_sss_strength"in n||(n.b4w_water_sss_strength=5.9,b("material",n,"b4w_water_sss_strength"));"b4w_water_sss_width"in n||(n.b4w_water_sss_width=.45,b("material",n,"b4w_water_sss_width"));"b4w_render_above_all"in n||(n.b4w_render_above_all=!1,b("material",n,"b4w_render_above_all"));"b4w_water_norm_uv_velocity"in n||(n.b4w_water_norm_uv_velocity=.05,b("material",n,"b4w_water_norm_uv_velocity"));"specular_ior"in n||(n.specular_ior=1,b("material",n,"specular_ior"));
"darkness"in n||(n.darkness=0,b("material",n,"darkness"));"diffuse_toon_size"in n||(n.diffuse_toon_size=0,b("material",n,"diffuse_toon_size"));"diffuse_toon_smooth"in n||(n.diffuse_toon_smooth=0,b("material",n,"diffuse_toon_smooth"));l=n.texture_slots;for(f=0;f<l.length;f++)m=l[f],"blend_type"in m||(m.blend_type="MIX",b("texture_slot",m,"blend_type"));if(n.node_tree){l=n.node_tree.nodes;for(f=0;f<l.length;f++)t(l[f]);n.node_tree.animation_data&&c(n.node_tree.animation_data)}}m=a.node_groups;for(g=
0;g<m.length;g++)for(l=m[g].node_tree.nodes,f=0;f<l.length;f++)t(l[f]);l=a.objects;for(g=0;g<l.length;g++){m=l[g];switch(m.type){case "MESH":"b4w_dynamic_geometry"in m||(m.b4w_dynamic_geometry=!1);"b4w_reflexible"in m||(m.b4w_reflexible=!1);"b4w_reflexible_only"in m||(m.b4w_reflexible_only=!1);"b4w_reflective"in m||(m.b4w_reflective=!1);"b4w_reflection_type"in m||(m.b4w_reflection_type="PLANE",b("object",m,"b4w_reflection_type"));"b4w_wind_bending"in m||(m.b4w_wind_bending=!1,b("object",m,"b4w_wind_bending"));
"b4w_wind_bending_angle"in m||(m.b4w_wind_bending_angle=10,m.b4w_wind_bending_freq=.25,b("object",m,"wind bending params"));"b4w_detail_bending_amp"in m||(m.b4w_detail_bending_amp=.1,m.b4w_branch_bending_amp=.3,b("object",m,"detail bending params"));"b4w_detail_bending_freq"in m||(m.b4w_detail_bending_freq=1,b("object",m,"b4w_detail_bending_freq"));"b4w_main_bend_stiffness_col"in m||(m.b4w_main_bend_stiffness_col="",b("object",m,"b4w_main_bend_stiffness_col"));"b4w_detail_bend_colors"in m||(m.b4w_detail_bend_colors=
{leaves_stiffness_col:"",leaves_phase_col:"",overall_stiffness_col:""},b("object",m,"b4w_detail_bend_colors"));"b4w_caustics"in m||(m.b4w_caustics=!1);"vertex_groups"in m&&m.vertex_groups.length&&m.data&&0==m.data.vertex_groups.length&&(m.data.vertex_groups=m.vertex_groups,delete m.vertex_groups,b("object",m,"vertex_groups"));"b4w_vertex_anim"in m&&m.b4w_vertex_anim.length&&m.data&&0==m.data.b4w_vertex_anim.length&&(m.data.b4w_vertex_anim=m.b4w_vertex_anim,delete m.b4w_vertex_anim,b("object",m,"b4w_vertex_anim"));
"b4w_do_not_render"in m||(m.b4w_do_not_render=!1);"use_ghost"in m.game||(m.game.use_ghost=!1);"use_sleep"in m.game||(m.game.use_sleep=!1);"velocity_min"in m.game||(m.game.velocity_min=0);"velocity_max"in m.game||(m.game.velocity_max=0);"collision_group"in m.game||(m.game.collision_group=1);"collision_mask"in m.game||(m.game.collision_mask=255);"b4w_vehicle_settings"in m?m.b4w_vehicle_settings&&("steering_ratio"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.steering_ratio=10),"steering_max"in m.b4w_vehicle_settings||
(m.b4w_vehicle_settings.steering_max=1),"inverse_control"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.inverse_control=!1),"force_max"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.force_max=1500),"brake_max"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.brake_max=100),"speed_ratio"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.speed_ratio=.027),"max_speed_angle"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.max_speed_angle=Math.PI),"delta_tach_angle"in m.b4w_vehicle_settings||
(m.b4w_vehicle_settings.delta_tach_angle=4.43),"suspension_compression"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.suspension_compression=4.4),"suspension_stiffness"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.suspension_stiffness=20),"suspension_damping"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.suspension_damping=2.3),"wheel_friction"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.wheel_friction=1E3),"roll_influence"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.roll_influence=
.1),"max_suspension_travel_cm"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.max_suspension_travel_cm=30),"floating_factor"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.floating_factor=3),"floating_factor"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.floating_factor=3),"water_lin_damp"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.water_lin_damp=.9),"water_rot_damp"in m.b4w_vehicle_settings||(m.b4w_vehicle_settings.water_rot_damp=.9)):(m.b4w_vehicle_settings=null,b("object",m,"b4w_vehicle_settings"));
"b4w_floating_settings"in m?m.b4w_floating_settings&&("floating_factor"in m.b4w_floating_settings||(m.b4w_floating_settings.floating_factor=3),"water_lin_damp"in m.b4w_floating_settings||(m.b4w_floating_settings.water_lin_damp=.8),"water_rot_damp"in m.b4w_floating_settings||(m.b4w_floating_settings.water_rot_damp=.8)):(m.b4w_floating_settings=null,b("object",m,"b4w_floating_settings"));"b4w_character_settings"in m?m.b4w_character_settings&&("walk_speed"in m.b4w_character_settings||(m.b4w_character_settings.walk_speed=
4),"run_speed"in m.b4w_character_settings||(m.b4w_character_settings.run_speed=8),"step_height"in m.b4w_character_settings||(m.b4w_character_settings.step_height=.25),"jump_strength"in m.b4w_character_settings||(m.b4w_character_settings.jump_strength=5),"waterline"in m.b4w_character_settings||(m.b4w_character_settings.waterline=0)):(m.b4w_character_settings=null,b("object",m,"b4w_character_settings"));"b4w_selectable"in m||(m.b4w_selectable=!1,b("object",m,"b4w_selectable"));"b4w_outlining"in m||
(m.b4w_outlining=!1,b("object",m,"b4w_outlining"));"b4w_outline_on_select"in m||(m.b4w_outline_on_select=!1,b("object",m,"b4w_outline_on_select"));"b4w_billboard"in m||(m.b4w_billboard=!1,b("object",m,"b4w_billboard"));"b4w_billboard_geometry"in m||(m.b4w_billboard_geometry="SPHERICAL",b("object",m,"b4w_billboard_geometry"));"b4w_pres_glob_orientation"in m||(m.b4w_pres_glob_orientation=!1,b("object",m,"b4w_pres_glob_orientation"));"b4w_outline_settings"in m||("b4w_glow_settings"in m?m.b4w_outline_settings=
m.b4w_glow_settings:(m.b4w_outline_settings={},m.b4w_outline_settings.outline_duration=1,m.b4w_outline_settings.outline_period=1,m.b4w_outline_settings.outline_relapses=0),b("object",m,"b4w_outline_settings"));"b4w_lod_transition"in m||(m.b4w_lod_transition=.01,b("object",m,"b4w_lod_transition"));"lod_levels"in m||(m.lod_levels=[],b("object",m,"lod_levels"));"b4w_animation_mixing"in m||(m.b4w_animation_mixing=!1,b("object",m,"b4w_animation_mixing"));break;case "EMPTY":"b4w_anchor"in m||(m.b4w_anchor=
null,b("object",m,"b4w_anchor")),!m.b4w_anchor||"max_width"in m.b4w_anchor||(m.b4w_anchor.max_width=250)}"collision_margin"in m.game||(m.game.collision_margin=.04,b("object",m,"collision_margin"));"b4w_anim_behavior"in m||(m.b4w_anim_behavior=m.b4w_cyclic_animation?"CYCLIC":"FINISH_STOP",b("object",m,"b4w_anim_behavior"));if(!("rotation_quaternion"in m)){f=[0,0,0,1];h.euler_to_quat(m.rotation_euler,f);var e=f,n=f[0],q=f[1],r=f[2];e[0]=f[3];e[1]=n;e[2]=q;e[3]=r;m.rotation_quaternion=f;b("object",m,
"rotation_quaternion")}"webgl_do_not_batch"in m&&(m.b4w_do_not_batch=m.webgl_do_not_batch)&&k("object",m,"webgl_do_not_batch");"b4w_shadow_cast_only"in m||(m.b4w_shadow_cast_only=!1,b("object",m,"b4w_shadow_cast_only"));"b4w_correct_bounding_offset"in m||(m.b4w_correct_bounding_offset="AUTO",b("object",m,"b4w_correct_bounding_offset"));e=m.particle_systems;for(f=0;f<e.length;f++)n=e[f],q=n.settings,"use_rotation_dupli"in q||(q.use_rotation_dupli=!1,b("object",q,"use_rotation_dupli")),"use_whole_group"in
q||(q.use_whole_group=!1,b("object",q,"use_whole_group")),n.transforms||(n.transforms=new Float32Array,b("particle_system",n,"transforms")),"b4w_billboard_align"in q||(q.b4w_billboard_align="VIEW",b("particle_settings",q,"b4w_billboard_align")),"b4w_dynamic_grass"in q||(q.b4w_dynamic_grass=!1,b("object",q,"b4w_dynamic_grass")),"b4w_dynamic_grass_scale_threshold"in q||(q.b4w_dynamic_grass_scale_threshold=.01,b("object",q,"b4w_dynamic_grass_scale_threshold")),"b4w_initial_rand_rotation"in q||(q.b4w_initial_rand_rotation=
!1,b("particle_settings",q,"b4w_initial_rand_rotation")),"b4w_rotation_type"in q||(q.b4w_rotation_type="Z",b("particle_settings",q,"b4w_rotation_type")),"b4w_rand_rotation_strength"in q||(q.b4w_rand_rotation_strength=1,b("particle_settings",q,"b4w_rand_rotation_strength")),"b4w_hair_billboard"in q||(q.b4w_hair_billboard=!1,b("particle_settings",q,"b4w_hair_billboard")),"b4w_hair_billboard_type"in q||(q.b4w_hair_billboard_type="BASIC",b("particle_settings",q,"b4w_hair_billboard_type")),"b4w_hair_billboard_jitter_amp"in
q||(q.b4w_hair_billboard_jitter_amp=0,b("particle_settings",q,"b4w_hair_billboard_jitter_amp")),"b4w_hair_billboard_jitter_freq"in q||(q.b4w_hair_billboard_jitter_freq=0,b("particle_settings",q,"b4w_hair_billboard_jitter_freq")),"b4w_hair_billboard_geometry"in q||(q.b4w_hair_billboard_geometry="SPHERICAL",b("particle_settings",q,"b4w_hair_billboard_geometry")),"b4w_wind_bend_inheritance"in q||(q.b4w_wind_bend_inheritance="PARENT",b("particle_settings",q,"b4w_wind_bend_inheritance")),"b4w_shadow_inheritance"in
q||(q.b4w_shadow_inheritance="PARENT",b("particle_settings",q,"b4w_shadow_inheritance")),"b4w_reflection_inheritance"in q||(q.b4w_reflection_inheritance="PARENT",b("particle_settings",q,"b4w_reflection_inheritance")),"b4w_vcol_from_name"in q||(q.b4w_vcol_from_name="",b("particle_settings",q,"b4w_vcol_from_name")),"b4w_vcol_to_name"in q||(q.b4w_vcol_to_name="",b("particle_settings",q,"b4w_vcol_to_name")),"b4w_coordinate_system"in q||(q.b4w_coordinate_system="LOCAL",b("particle_settings",q,"b4w_coordinate_system")),
"b4w_allow_nla"in q||(q.b4w_allow_nla=!0,b("particle_settings",q,"b4w_allow_nla")),"b4w_enable_soft_particles"in q||(q.b4w_enable_soft_particles=!1,b("particle_settings",q,"b4w_enable_soft_particles")),"b4w_particles_softness"in q||(q.b4w_particles_softness=1,b("particle_settings",q,"b4w_particles_softness"));"constraints"in m||(m.constraints=[],b("object",m,"constraints"));e=m.modifiers;for(f=0;f<e.length;f++){a:{n=e[f];switch(n.type){case "ARRAY":if(!("fit_type"in n)){C.error("WARNING Incomplete modifier "+
String(n.type)+' for "'+m.name+'", reexport "'+a.b4w_filepath_blend+'" scene');n=!1;break a}}n=!0}n||(e.splice(f,1),f--)}"animation_data"in m||(m.animation_data={action:null,nla_tracks:[]},b("object",m,"animation_data"));m.animation_data&&("action"in m.animation_data||(m.animation_data.action=null,d("no action in animation data "+m.name)),"nla_tracks"in m.animation_data||(m.animation_data.nla_tracks=[],d("no NLA in animation data "+m.name)),c(m.animation_data));"b4w_collision_id"in m||(m.b4w_collision_id=
"",b("object",m,"b4w_collision_id"));"b4w_viewport_alignment"in m||(m.b4w_viewport_alignment=null,b("object",m,"b4w_viewport_alignment"));(0>m.scale[0]||0>m.scale[1]||0>m.scale[2])&&d('negative scale for object "'+m.name+'", can lead to some errors');e=m.scale;0==e[0]&&0==e[1]&&0==e[2]?f=!0:(f=Math.abs((e[0]-e[1])/e[0]),e=Math.abs((e[1]-e[2])/e[1]),f=.005>f&&.005>e);f||d("non-uniform scale for object "+m.name)}for(var p in F)g=F[p],f=p.match(/.*?(?=>>|$)/i)[0],C.warn('Property "'+String(f)+'" is '+
g.report_type+' for "'+g.type+'". To fix this, reexport '+a.b4w_filepath_blend)};a.check_anim_fcurve_completeness=function(a,b){"num_channels"in a||(a.num_channels=1,d('B4W Warning: no channels number in animation fcurve for "'+b.name+'" action, reexport scene'))};a.apply_mesh_modifiers=function(a){var b;a:{b=a.modifiers;for(var c=0;c<b.length;c++){var d=b[c].type;if("ARRAY"==d||"CURVE"==d){b=!0;break a}}b=!1}if(!b)return null;b=l(a.data,a.data.name+"_MOD");a=a.modifiers;for(c=0;c<a.length;c++){var k=
a[c];switch(k.type){case "ARRAY":for(var d=b,m=k,u=0,p=0,E=0,C=new Float32Array(16),k=[],J=1;J<m.count;J++){m.use_constant_offset&&(u+=m.constant_offset_displace[0],p+=m.constant_offset_displace[1],E+=m.constant_offset_displace[2]);if(m.use_relative_offset)var t=d.b4w_bounding_box,u=u+(t.max_x-t.min_x)*m.relative_offset_displace[0],p=p+(t.max_y-t.min_y)*m.relative_offset_displace[1],E=E+(t.max_z-t.min_z)*m.relative_offset_displace[2];h.trans_matrix(u,p,E,C);for(var G=t=l(d),x=C,H=0;H<G.submeshes.length;H++){var B=
G.submeshes[H];h.positions_multiply_matrix(B.position,x,B.position,0);h.vectors_multiply_matrix(B.normal,x,B.normal,0);h.tangents_multiply_matrix(B.tangent,x,B.tangent,0)}k.push(t)}for(J=0;J<k.length;J++)for(m=d,u=k[J],p=0;p<m.submeshes.length;p++){E=m.submeshes[p];C=u.submeshes[p];t=E.base_length;G=E.indices.length;E.base_length+=C.base_length;for(var I in E)if("base_length"!=I)if("indices"==I)for(E[I]=h.uint32_concat(E[I],C[I]),x=G;x<E.indices.length;x++)E.indices[x]+=t;else"vertex_colors"!=I&&
(E[I]=h.float32_concat(E[I],C[I]))}break;case "CURVE":for(var d=b,J=r.create_spline(k.object),m=new Float32Array(16),p=J.is_3d?4:3,u=new Float32Array(p),p=new Float32Array(p),E=new Float32Array(3),C=new Float32Array(4),t=new Float32Array(4),G=new Float32Array(3),x=new Float32Array(3),H=new Float32Array(3),B=new Float32Array(4),F=new Float32Array(4),U=0;U<d.submeshes.length;U++){var T=d.submeshes[U],w=T.position,fa=T.normal,T=T.tangent,da;a:switch(da=k.deform_axis,da){case "POS_X":case "NEG_X":da=
0;break a;case "POS_Y":case "NEG_Y":da=1;break a;case "POS_Z":case "NEG_Z":da=2;break a;default:throw"Wrong deform axis value "+da;}G[0]=0;G[1]=0;G[2]=0;G[da]=1;for(var ea=r.spline_length(J),V=0;V<w.length/3;V++){H[0]=w[3*V];H[1]=w[3*V+1];H[2]=w[3*V+2];var S=H[da],X=r.spline_len_to_t(J,S);r.spline_point(J,X,u);E[0]=u[0];E[1]=u[1];E[2]=u[2];r.spline_derivative(J,X,p);x[0]=p[0];x[1]=0;x[2]=p[2];n.normalize(x,x);f.rotationTo(G,x,C);0>S?(u[0]=x[0],u[1]=x[1],u[2]=x[2],n.scale(u,S,u),n.add(E,u,E)):S>ea&&
(u[0]=x[0],u[1]=x[1],u[2]=x[2],n.scale(u,S-ea,u),n.add(E,u,E));g.fromRotationTranslation(C,E,m);J.is_3d&&(f.setAxisAngle(G,u[3],t),n.transformQuat(H,t,H));H[da]=0;n.transformMat4(H,m,H);w[3*V]=H[0];w[3*V+1]=H[1];w[3*V+2]=H[2];fa.length&&(B[0]=fa[3*V],B[1]=fa[3*V+1],B[2]=fa[3*V+2],B[3]=0,A.transformMat4(B,m,B),fa[3*V]=B[0],fa[3*V+1]=B[1],fa[3*V+2]=B[2]);T.length&&(F[0]=T[3*V],F[1]=T[3*V+1],F[2]=T[3*V+2],F[3]=0,A.transformMat4(F,m,F),T[3*V]=F[0],T[3*V+1]=F[1],T[3*V+2]=F[2])}}}q.recalculate_mesh_boundings(b)}return b};
a.create_material=function(a){return{name:a,uuid:h.gen_uuid(),use_nodes:!1,diffuse_shader:"LAMBERT",diffuse_color:[.8,.8,.8],diffuse_intensity:1,alpha:1,raytrace_transparency:{fresnel:0,fresnel_factor:1.25},raytrace_mirror:{reflect_factor:0,fresnel:0,fresnel_factor:1.25},specular_color:[1,1,1],specular_intensity:.5,specular_shader:"COOKTORR",specular_hardness:50,specular_slope:.2,emit:0,ambient:1,use_vertex_color_paint:!1,b4w_water:!1,b4w_water_shore_smoothing:!1,b4w_water_dynamic:!1,b4w_generated_mesh:!1,
b4w_waves_height:1,b4w_water_fog_color:[.5,.5,.5],b4w_water_fog_density:.06,b4w_water_num_cascads:5,b4w_water_subdivs:64,b4w_water_detailed_dist:1E3,b4w_terrain:!1,b4w_collision:!1,b4w_collision_id:"",b4w_double_sided_lighting:!1,b4w_water_enable_caust:!1,b4w_water_caust_scale:.25,b4w_water_caust_brightness:.5,physics:{friction:.5,elasticity:0},type:"SURFACE",use_transparency:!1,use_shadeless:!1,offset_z:0,b4w_render_above_all:!1,game_settings:{alpha_blend:"OPAQUE",use_backface_culling:!0},halo:{size:.5,
hardness:50,b4w_halo_rings_color:[1,1,1],b4w_halo_lines_color:[1,1,1],b4w_halo_stars_blend_height:10,b4w_halo_stars_min_height:0},node_tree:null,texture_slots:[]}};a.assign_logic_nodes_object_params=function(a,b){for(var c=b.b4w_logic_nodes,h=0;h<c.length;h++)for(var k=c[h],f=0;f<k.length;f++){var g=k[f],l={register1:"variable1",register2:"variable2",registerd:"variabled"},n;for(n in l)n in g&&(g[l[n]]=g[n]);switch(g.type){case "SELECT":for(var q=0;q<a.length;q++){var r=a[q];r.name==g.object&&(r.b4w_selectable=
!0)}g.bools||(g.bools={});g.bools.not_wait||(g.bools.not_wait=!1);d('Logic nodes type "SELECT" is deprecated');break;case "SWITCH_SELECT":for(var p in g.objects_paths){r=g.objects_paths[p];l=r[0];if(1<r.length)for(q=1;q<r.length;q++)l+="*"+r[q];for(q=0;q<a.length;q++)r=a[q],r.name==l&&(r.b4w_selectable=!0)}if(g.links instanceof Array){d('Format of a "SWITCH_SELECT" node is outdated. It is recommended to reexport the scene "'+b.name+'"');l={};r=0;for(q in g.objects_paths)l[q]=g.links[r],r++;g.links=
l}break;case "SELECT_PLAY":d('Logic nodes type "SELECT_PLAY" is deprecated, node will be muted. To fix this, reexport the scene "'+b.name+'"');g.mute=!0;break;case "SELECT_PLAY_ANIM":d('Logic nodes type "SELECT_PLAY_ANIM" is deprecated');break;case "SHOW":case "HIDE":case "PLAY_ANIM":case "SET_SHADER_NODE_PARAM":case "INHERIT_MAT":for(p in g.objects_paths){r=g.objects_paths[p];l=r[0];if(1<r.length)for(q=1;q<r.length;q++)l+="*"+r[q];for(q=0;q<a.length;q++)r=a[q],r.name==l&&(r.b4w_do_not_batch=!0)}break;
case "PLAY":b.b4w_use_nla=!0;break;case "MOVE_TO":for(p in g.objects_paths){r=g.objects_paths[p];l=r[0];if(1<r.length)for(q=1;q<r.length;q++)l+="*"+r[q];for(q=0;q<a.length;q++)r=a[q],r.name==l&&(r.b4w_do_not_batch=!0)}break;case "TRANSFORM_OBJECT":for(p in g.objects_paths){r=g.objects_paths[p];l=r[0];if(1<r.length)for(q=1;q<r.length;q++)l+="*"+r[q];for(q=0;q<a.length;q++)r=a[q],r.name==l&&(r.b4w_do_not_batch=!0)}break;case "CONDJUMP":if(g.condition)switch(g.floats||(g.floats={}),g.condition){case "GEQUAL":g.floats.cnd=
0;break;case "LEQUAL":g.floats.cnd=1;break;case "GREATER":g.floats.cnd=2;break;case "LESS":g.floats.cnd=3;break;case "NOTEQUAL":g.floats.cnd=4;break;case "EQUAL":g.floats.cnd=5}void 0!=g.number1&&(g.input1=g.number1);void 0!=g.number2&&(g.input2=g.number2);break;case "SEND_REQ":g.bools||(g.bools={});void 0===g.bools.prs&&(g.bools.prs=!0);void 0===g.bools.enc&&(g.bools.enc=!0);break;case "MATH":void 0!=g.number1&&(g.input1=g.number1);void 0!=g.number2&&(g.input2=g.number2);break;case "REGSTORE":void 0!=
g.number1&&(g.input1=g.number1);void 0!=g.number2&&(g.input2=g.number2);break;case "REGSTORE":void 0!=g.number1&&(g.input1=g.number1)}}}};b4w.module.__scenegraph=function(a,p){function t(a){var b=a.dof_object;a.dof_object=null;var c=za.clone_object_r(a);c.dof_object=b;a.dof_object=b;c.framebuffer=null;c.color_attachment=null;c.depth_attachment=null;return c}function c(a,c){var d=[];L.traverse_edges(a,function(b,c,e){-1<d.indexOf(e)?L.replace_edge_attr(a,b,c,e,v(e)):d.push(e)});L.traverse(a,function(b,e){for(var h=0;h<e.slinks_internal.length;h++){var f=e.slinks_internal[h];c||"MAIN_PLANE_REFLECT"!=e.type&&"MAIN_CUBE_REFLECT"!=e.type&&
"MAIN_XRAY"!=e.type||(f.use_renderbuffer=!0);-1<d.indexOf(f)?e.slinks_internal[h]=v(f):d.push(f)}"ANTIALIASING"==e.type&&L.traverse_inputs(a,b,function(a,b,c){if("MOTION_BLUR"==b.type)for(a=0;a<b.slinks_internal.length;a++)c=b.slinks_internal[a],c.min_filter=Y.TF_LINEAR,c.mag_filter=Y.TF_LINEAR});c||L.traverse_inputs(a,b,function(a,b,c){"DEPTH"==c.from&&(c.use_renderbuffer=!0)})});L.traverse(a,function(c,d){var e={};b(a,c,e);for(var h in e){for(var f=e[h],k=f[0],g=0;g<f.length;g++)if(f[g].min_filter==
Y.TF_LINEAR){k=f[g];break}for(var l=f[0],g=0;g<f.length;g++)if(f[g].mag_filter==Y.TF_LINEAR){l=f[g];break}for(var m=f[0],g=0;g<f.length;g++)if(!f[g].use_renderbuffer){m=f[g];break}for(g=0;g<f.length;g++)f[g].min_filter=k.min_filter,f[g].mag_filter=l.mag_filter,f[g].use_renderbuffer=m.use_renderbuffer}})}function b(a,c,d){L.traverse_inputs(a,c,function(c,e,h){h.active&&h.from==h.to&&(d[h.from]=d[h.from]||[],-1==d[h.from].indexOf(h)&&d[h.from].push(h),b(a,c,d))});L.traverse_outputs(a,c,function(a,b,
c){c.active&&(d[c.from]=d[c.from]||[],-1==d[c.from].indexOf(c)&&d[c.from].push(c))});c=L.get_node_attr(a,c);if("MOTION_BLUR"==c.type)for(var e=0;e<c.slinks_internal.length;e++){var h=c.slinks_internal[e];d[h.from].push(h)}}function k(a){var b=["MOTION_BLUR","SMAA_RESOLVE","SMAA_NEIGHBORHOOD_BLENDING","MAIN_PLANE_REFLECT","MAIN_QUBE_REFLECT"],c=L.topsort(a),e=[];L.traverse(c,function(a,h){for(var f=0;f<h.slinks_internal.length;f++){var k=h.slinks_internal[f];-1<b.indexOf(h.type)&&(k.unique_texture=
!0);var m=g(e,k,d(k));k.texture=m;h.textures_internal[f]=m}for(f=0;f<h.textures_internal.length;f++)m=h.textures_internal[f],r(e,m);L.traverse_outputs(c,a,function(f,k,m){-1<b.indexOf(h.type)&&(m.unique_texture=!0);m.texture||((f=l(c,a,m.from))&&m.active&&!m.texture?q(e,f):f=g(e,m,d(m)),m.texture=f)});L.traverse_inputs(c,a,function(a,b,c){r(e,c.texture)});L.traverse_outputs(c,a,function(a,b,c){c.texture&&"NONE"==c.to&&r(e,c.texture)})})}function d(a){a=za.clone_object_json(a);delete a.to;delete a.active;
delete a.texture;return JSON.stringify(a)}function l(a,b,c){var d=null;L.traverse_inputs(a,b,function(a,b,e){if(e.active&&e.from==e.to&&e.from==c&&e.texture)return d=e.texture,!0});L.traverse_outputs(a,b,function(a,b,e){if(e.active&&e.from==c&&e.texture)return d=e.texture,!0});return d}function q(a,b){for(var c=0;c<a.length;c++){var d=a[c];d.tex===b&&d.ref++}}function r(a,b){for(var c=0;c<a.length;c++){var d=a[c];d.tex===b&&d.ref&&d.ref--}}function g(a,b,c){if(b.parent_slink)return q(a,b.parent_slink.texture),
b.parent_slink.texture;if(b.unique_texture)return C(b);for(var d=null,e=0;e<a.length;e++){var h=a[e];if(h.id==c&&0===h.ref){d=h;break}}if(d&&!La.macos_tex_reuse_hack)return d.ref++,d.tex;b=C(b);a.push({id:c,ref:1,tex:b});return b}function C(a){var b=a.size_mult_x*a.size,c=a.size_mult_y*a.size;switch(a.from){case "COLOR":if(a.use_renderbuffer){var d=Y.create_texture("COLOR_RB",a.multisample?Y.TT_RB_RGBA_MS:Y.TT_RB_RGBA);Y.resize(d,b,c)}else d=Y.create_texture("COLOR",Y.TT_RGBA_INT),Y.resize(d,b,c),
Y.set_filters(d,a.min_filter,a.mag_filter);return d;case "DEPTH":return a.use_renderbuffer?(d=Y.create_texture("DEPTH_RB",a.multisample?Y.TT_RB_DEPTH_MS:Y.TT_RB_DEPTH),Y.resize(d,b,c)):(d=Y.create_texture("DEPTH_TEX",Y.TT_DEPTH),Y.resize(d,b,c),Y.set_filters(d,a.min_filter,a.mag_filter)),d;case "CUBEMAP":return d=Y.create_cubemap_texture("CUBEMAP",b);case "SCREEN":case "NONE":return null;default:throw"Wrong slink param: "+a.from;}}function f(a,b){var c=!1;L.traverse_edges(a,function(d,e,h){if(h&&
(d=L.get_node_attr(a,d),e=L.get_node_attr(a,e),b(h,!1,d,e)))return c=!0});c||L.traverse(a,function(a,c){for(var d=0;d<c.slinks_internal.length;d++)if(b(c.slinks_internal[d],!0,c,null))return!0})}function h(a){L.traverse(a,function(b,c){if("SINK"!=c.type){var d=c.camera;L.traverse_outputs(a,b,function(a,b,c){c.active&&c.texture&&(ha.set_attachment(d,c.from,c.texture),c.from==c.to&&b.camera&&ha.set_attachment(b.camera,c.from,c.texture))});for(var e=0;e<c.slinks_internal.length;e++){var h=c.slinks_internal[e];
h.active&&h.from==h.to&&ha.set_attachment(d,h.from,c.textures_internal[e])}!d.color_attachment&&!d.depth_attachment||d.framebuffer||(d.framebuffer=Fa.render_target_create(d.color_attachment,d.depth_attachment))}});L.traverse(a,function(b,c){if("RESOLVE"==c.type||"COPY"==c.type){var d=ka(a,c);c.camera.framebuffer_prev=d[0].camera.framebuffer}})}function n(a){var b=null,c=0;L.traverse(a,function(a,d){if(d.type==W.subs_type){if(c==W.subs_number)return b=d,!0;c++}});return b}function A(a,b){var c=L.node_by_attr(a,
b),d=u("NONE"),e=L.append_node_attr(a,d),h=L.get_sink_nodes(a)[0];L.traverse_edges(a,function(b,c,d){c==h&&L.reconnect_edges(a,b,h,b,e)});L.traverse_edges(a,function(e,h,f){if(e==c)return L.append_edge_attr(a,b,d,y(W.slink_type,"u_color",f.size,f.size_mult_x,f.size_mult_y,f.update_dim)),!0});L.append_edge(a,e,h,y("SCREEN","NONE",.5,.5,.5,!0))}function B(a,b,c){var d=["GRASS_MAP","SHADOW_CAST","MAIN_CUBE_REFLECT"],e=c.cameras,h=b.antialiasing,f=b.hmd_stereo_use,k,g,l;f&&h?L.traverse(a,function(b,c){if("ANTIALIASING"==
c.type){var d=Ga(a,c,"COMPOSITING");k=d?L.get_node_attr(a,d):b}else"COMPOSITING"==c.type&&(k=b)}):k=L.get_sink_nodes(a)[0];L.traverse_inputs(a,k,function(b,c,d){if(ca(a,c,"MAIN_OPAQUE"))return g=b,l=c,!0});for(var m=L.subgraph_node_conn(a,g,L.BACKWARD_DIR),n=[],q=[],r=[],m=L.clone(m,function(h){var k;if(-1<d.indexOf(h.type))q.push(h),k=h;else{k=z(h);if("MAIN_PLANE_REFLECT"==k.type)for(var g=b.reflection_params.plane_refl_subs,l=0;l<g.length;l++)if(g[l][0]==h){b.reflection_params.plane_refl_subs[l]=
[h,k];k.camera.reflection_plane=h.camera.reflection_plane;c.cameras.push(k.camera);break}-1<e.indexOf(h.camera)&&(f?(ha.make_stereo(h.camera,ha.TYPE_HMD_LEFT),ha.make_stereo(k.camera,ha.TYPE_HMD_RIGHT)):(ha.make_stereo(h.camera,ha.TYPE_STEREO_LEFT),ha.make_stereo(k.camera,ha.TYPE_STEREO_RIGHT)),e.push(k.camera));g=L.node_by_attr(a,h);L.traverse_inputs(a,g,function(a,b,c){-1<d.indexOf(b.type)&&n.push([b,k,c])});for(l=0;l<h.slinks_internal.length;l++)k.slinks_internal[l].parent_slink=h.slinks_internal[l];
h=!0;for(l=0;l<L.in_edge_count(a,g);l++){var m=L.get_in_edge(a,g,l),m=L.get_node_attr(a,m);-1==d.indexOf(m.type)&&(h=!1)}h&&r.push(k)}return k},function(a){var b=v(a,!0);b.parent_slink=a;return b}),R=0;R<q.length;R++)L.remove_node(m,L.node_by_attr(m,q[R]));L.cleanup_loose_edges(m);var w=oa(f),R=L.append_node_attr(a,w);L.reconnect_edges(a,g,k,R,k);h=ga();L.append_node_attr(a,h);var u=y("COLOR","COPY",1,1,1,!0);L.append_edge_attr(a,l,h,u);var E=y("COLOR","u_sampler_left",1,1,1,!0);E.unique_texture=
!0;E.min_filter=Y.TF_LINEAR;E.mag_filter=Y.TF_LINEAR;L.append_edge_attr(a,h,w,E);w=y("COLOR","u_sampler_right",1,1,1,!0);w.min_filter=Y.TF_LINEAR;w.mag_filter=Y.TF_LINEAR;w.parent_slink=u;L.append_subgraph(m,a,[L.get_sink_nodes(m)[0],R,w]);for(R=0;R<n.length;R++)L.append_edge_attr(a,n[R][0],n[R][1],n[R][2]);m=y("SCREEN","NONE",0,0,0,!1);for(R=0;R<r.length;R++)L.append_edge_attr(a,h,r[R],m);if(f){var W=[];L.traverse(a,function(b,c){if(-1==d.indexOf(c.type)&&c.slinks_internal.length&&sa(a,c,"STEREO"))for(var e=
0;e<c.slinks_internal.length;e++){var h=c.slinks_internal[e];-1==W.indexOf(h)&&W.push(h)}});L.traverse_edges(a,function(b,c,e){b=L.get_node_attr(a,b);c=L.get_node_attr(a,c);-1==d.indexOf(b.type)&&sa(a,c,"STEREO")&&-1==W.indexOf(e)&&W.push(e)});for(R=0;R<W.length;R++)W[R].size_mult_x*=.5}}function F(a,b){a.num_lights=b;a.light_directions=new Float32Array(3*b);a.light_positions=new Float32Array(3*b);a.light_color_intensities=new Float32Array(3*b);a.light_factors=new Float32Array(0==b%2?2*b:2*b+2)}function D(a,
b,c,d){var h=e("SHADOW_CAST");h.csm_index=a;h.self_shadow_polygon_offset=c.self_shadow_polygon_offset;h.shadow_lamp_index=b;switch(c.lamp_types[b]){case "SPOT":case "POINT":h.camera=ha.create_camera(ha.TYPE_PERSP);ha.set_frustum(h.camera,180*c.spot_sizes[b]/Math.PI,.1,2*c.distances[b]);break;default:h.camera=ha.create_camera(ha.TYPE_ORTHO_ASYMMETRIC)}F(h,d);return h}function e(a){a={type:a,subtype:"",blend:!1,pack:!1,assign_texture:!1,need_fog_update:!1,debug_render_calls:0,debug_render_time:0,debug_render_time_queries:[],
time:0,camera:null,cube_view_matrices:null,cube_cam_frustums:[],bundles:[],slinks_internal:[],textures_internal:[],wind:new Float32Array(3),zsort_eye_last:new Float32Array(3),grass_map_dim:new Float32Array(3),fog_color_density:new Float32Array(4),fog_params:new Float32Array(4),cube_fog:new Float32Array(16),sky_tex_default_value:0,environment_energy:0,num_lights:0,light_directions:null,light_positions:null,light_color_intensities:null,light_factors:null,horizon_color:new Float32Array(3),zenith_color:new Float32Array(3),
sky_tex_fac:new Float32Array(4),sun_intensity:new Float32Array([0,0,0]),sun_direction:new Float32Array(3),sun_quaternion:new Float32Array(4),sky_tex_color:new Float32Array(3),outline_factor:0,draw_outline_flag:0,is_for_outline:!1,outline_color:new Float32Array(3),water:0,water_params:null,use_shoremap:!1,shoremap_center:new Float32Array(2),shoremap_size:new Float32Array(2),shoremap_tex_size:0,max_shore_dist:0,cam_water_depth:0,water_fog_color_density:null,water_waves_height:0,water_waves_length:0,
water_level:0,caustics:!1,caust_scale:0,caust_speed:new Float32Array(2),caust_brightness:0,procedural_skydome:!1,use_as_environment_lighting:!1,mie_brightness:0,rayleigh_brightness:0,spot_brightness:0,mie_strength:0,rayleigh_strength:0,scatter_strength:0,mie_collection_power:0,rayleigh_collection_power:0,mie_distribution:0,sky_color:new Float32Array(3),ssao_hemisphere:0,ssao_blur_depth:0,ssao_blur_discard_value:0,ssao_radius_increase:0,ssao_influence:0,ssao_dist_factor:0,ssao_samples:0,ssao_only:0,
ssao_white:0,brightness:0,contrast:0,exposure:0,saturation:0,god_rays_intensity:0,max_ray_length:0,radial_blur_step:0,steps_per_pass:0,csm_index:0,self_shadow_polygon_offset:0,self_shadow_normal_offset:0,v_light_ts:null,v_light_r:null,v_light_tsr:null,p_light_matrix:null,bloom_key:0,bloom_blur:0,bloom_edge_lum:0,blur_texel_size_mult:0,ext_texel_size_mult:0,mb_decay_threshold:0,mb_factor:0,motion_blur_exp:0,pp_effect:"",jitter_projection_space:new Float32Array(2),small_glow_mask_width:0,large_glow_mask_width:0,
small_glow_mask_coeff:0,large_glow_mask_coeff:0,texel_size:new Float32Array(2),texel_mask:new Float32Array(2),distortion_params:new Float32Array(4),chromatic_aberration_coefs:new Float32Array(4),enable_hmd_stereo:!1,shadow_lamp_index:0,do_render:!0,enqueue:!0,clear_color:!0,clear_depth:!0,depth_test:!0,need_perm_uniforms_update:!0,texel_size_multiplier:1};a.texel_mask[0]=1;a.texel_mask[1]=1;a.distortion_params[2]=1;return a}function z(a){var b=a.camera;a.camera=null;var c=za.clone_object_r(a);a.camera=
b;c.camera=t(b);return c}function y(a,b,c,d,e,h){return{from:a,to:b,size:c,size_mult_x:d,size_mult_y:e,update_dim:h,active:!0,texture:null,multisample:!1,use_renderbuffer:!1,min_filter:Y.TF_NEAREST,mag_filter:Y.TF_NEAREST,unique_texture:!1}}function v(a,b){if(b){var c=a.texture;a.texture=null}a.texture&&za.panic("Failed to clone slink with attached texture");var d=za.clone_object_json(a);b&&(a.texture=c,d.texture=c);return d}function m(){var a=e("GRASS_MAP");a.camera=ha.create_camera(ha.TYPE_ORTHO_ASPECT);
return a}function u(a){var b=e("POSTPROCESSING");b.clear_color=!1;b.clear_depth=!1;b.depth_test=!1;b.camera=ha.create_camera(ha.TYPE_NONE);b.pp_effect=a;switch(a){case "NONE":b.texel_mask[0]=1;b.texel_mask[1]=1;break;case "GRAYSCALE":b.texel_mask[0]=1;b.texel_mask[1]=1;break;case "X_BLUR":b.texel_mask[0]=1;b.texel_mask[1]=0;break;case "Y_BLUR":b.texel_mask[0]=0;b.texel_mask[1]=1;break;case "X_GLOW_BLUR":b.texel_mask[0]=1;b.texel_mask[1]=0;break;case "Y_GLOW_BLUR":b.texel_mask[0]=0;b.texel_mask[1]=
1;break;case "X_EXTEND":b.texel_mask[0]=1;b.texel_mask[1]=0;break;case "Y_EXTEND":b.texel_mask[0]=0;b.texel_mask[1]=1;break;default:throw"Wrong postprocessing effect: "+a;}return b}function K(a,b,c){a=e("BLOOM_BLUR");a.clear_color=!1;a.clear_depth=!1;a.depth_test=!1;a.camera=ha.create_camera(ha.TYPE_NONE);a.pp_effect=c;switch(c){case "X_BLUR":a.texel_mask[0]=1;a.texel_mask[1]=0;break;case "Y_BLUR":a.texel_mask[0]=0;a.texel_mask[1]=1;break;default:throw"Wrong postprocessing effect for bloom blur: "+
c;}return a}function E(a,b){var c=e("GLOW_COMBINE");c.clear_color=!1;c.clear_depth=!1;c.depth_test=!1;c.small_glow_mask_coeff=b.glow_params.small_glow_mask_coeff;c.large_glow_mask_coeff=b.glow_params.large_glow_mask_coeff;c.small_glow_mask_width=b.glow_params.small_glow_mask_width;c.large_glow_mask_width=b.glow_params.large_glow_mask_width;c.camera=a;return c}function M(a,b,c,d,h,f,k,g,l){var m=e("MAIN_"+a);if("OPAQUE"===a)m.clear_color=!0,m.clear_depth=c,m.blend=!1;else if("BLEND"===a)m.clear_color=
!1,m.clear_depth=!1,m.blend=!0;else if("XRAY"===a)m.clear_color=!1,m.clear_depth=!0,m.blend=!0;else if("PLANE_REFLECT"===a||"CUBE_REFLECT"===a)m.clear_color=!0,m.clear_depth=!0,m.blend=!1;else if("GLOW"===a)m.clear_color=!0,m.clear_depth=!1,m.blend=!1;else throw"wrong main subscene type";m.blend&&g&&(m.self_shadow_normal_offset=g.self_shadow_normal_offset);m.camera=b;if(a=k.sky_texture_param)m.sky_tex_fac.set([a.blend_factor,a.horizon_factor,a.zenith_up_factor,a.zenith_down_factor]),m.sky_tex_color.set(a.color),
m.sky_tex_default_value=a.default_value;m.horizon_color.set(k.horizon_color);m.zenith_color.set(k.zenith_color);m.environment_energy=k.environment_energy;m.fog_color_density=f.fog_color_density;m.fog_params=f.fog_params;d&&(m.water_params=d,d.fog_color_density&&(m.water_fog_color_density=new Float32Array(d.fog_color_density)),m.water_waves_height=d.waves_height,m.water_waves_length=d.waves_length,m.water_level=d.water_level,d.caustics&&l&&(m.caustics=!0,m.caust_scale=d.caustic_scale,m.caust_speed.set(d.caustic_speed),
m.caust_brightness=d.caustic_brightness),d.shoremap_image&&(m.use_shoremap=!0,f=d.shore_boundings,m.shoremap_center[0]=(f[0]+f[1])/2,m.shoremap_center[1]=(f[2]+f[3])/2,m.shoremap_size[0]=f[0]-f[1],m.shoremap_size[1]=f[2]-f[3],m.shoremap_tex_size=d.shoremap_tex_size,m.max_shore_dist=d.max_shore_dist));F(m,h);return m}function J(){var a=e("RESOLVE");a.camera=ha.create_camera(ha.TYPE_NONE);return a}function O(a,b,c){var d=e("COLOR_PICKING");b&&(d.type+="_XRAY",d.clear_color=!1,d.clear_depth=!0);d.enqueue=
!1;d.camera=a;F(d,c);return d}function G(a){var b=e("WIREFRAME");b.do_render=!1;b.clear_color=!1;b.clear_depth=!1;b.camera=a;return b}function x(a){var b=e("ANCHOR_VISIBILITY");b.clear_color=!0;b.clear_depth=!1;b.camera=a;return b}function H(a,b,c){a=e("DEPTH");a.camera=b;F(a,c);return a}function P(a){var b=e("DEPTH_PACK");b.clear_color=!1;b.clear_depth=!1;b.camera=a;return b}function I(a,b,c){var d=e("SSAO");d.clear_color=!1;d.clear_depth=!1;d.depth_test=!1;d.camera=a;d.fog_color_density=b.fog_color_density;
d.water_fog_color_density=new Float32Array(b.fog_color_density);d.ssao_radius_increase=c.radius_increase;d.ssao_hemisphere=c.hemisphere;d.ssao_influence=c.influence;d.ssao_dist_factor=c.dist_factor;d.ssao_samples=c.samples;return d}function aa(a,b){var c=e("SSAO_BLUR");c.clear_color=!1;c.clear_depth=!1;c.depth_test=!1;c.camera=a;c.ssao_blur_depth=b.blur_depth;c.ssao_blur_discard_value=b.blur_discard_value;return c}function U(a){var b=e("ANTIALIASING");b.clear_color=!1;b.clear_depth=!1;b.depth_test=
!1;b.texel_size_multiplier=1/a.resolution_factor;b.fxaa_quality=a.aa_quality;b.camera=ha.create_camera(ha.TYPE_NONE);return b}function T(a,b){var c=e(a);c.clear_color="SMAA_BLENDING_WEIGHT_CALCULATION"==a||"SMAA_EDGE_DETECTION"==a?!0:!1;c.clear_depth=!1;c.depth_test=!1;c.texel_size_multiplier=1/b.resolution_factor;c.camera=ha.create_camera(ha.TYPE_NONE);"SMAA_BLENDING_WEIGHT_CALCULATION"==a&&(c.jitter_subsample_ind=new Float32Array(4));return c}function w(a,b,c,d){var h=e("COMPOSITING");h.clear_color=
!1;h.clear_depth=!1;h.depth_test=!1;h.camera=ha.create_camera(ha.TYPE_NONE);h.brightness=a;h.contrast=b;h.exposure=c;h.saturation=d;return h}function fa(a,b){var c=e("MOTION_BLUR");c.clear_color=!1;c.clear_depth=!1;c.depth_test=!1;c.camera=ha.create_camera(ha.TYPE_NONE);c.assign_texture=!0;c.mb_decay_threshold=a;c.mb_factor=b;return c}function da(a){var b=e("DOF");b.clear_color=!1;b.clear_depth=!1;b.depth_test=!1;b.camera=a;b.texel_size_multiplier=b.camera.dof_power;return b}function ea(a,b){var c=
e("OUTLINE_MASK");c.depth_test=!1;c.camera=a;F(c,b);return c}function V(a){var b=e("OUTLINE");ua.outlining_overview_mode?b.outline_color.set(ua.outline_color):b.outline_color.set(a.outline_color);b.outline_factor=a.outline_factor;b.ext_texel_size_mult=5;b.blur_texel_size_mult=3;b.depth_test=!1;b.camera=ha.create_camera(ha.TYPE_NONE);return b}function S(a,b,c,d,h,f,k){var g=e("GOD_RAYS");g.clear_color=!1;g.clear_depth=!1;g.depth_test=!1;g.horizon_color=new Float32Array([1,1,1]);g.zenith_color=new Float32Array([1,
1,1]);g.environment_energy=1;g.pack=d;g.water=b;g.radial_blur_step=h;g.max_ray_length=c;g.steps_per_pass=k;g.camera=a;F(g,f);return g}function X(a,b){var c=e("GOD_RAYS_COMBINE");c.clear_color=!1;c.clear_depth=!1;c.depth_test=!1;c.camera=ha.create_camera(ha.TYPE_NONE);c.god_rays_intensity=a;F(c,b);return c}function la(a,b){var c=e("SKY");c.enqueue=!1;c.clear_color=!1;c.clear_depth=!1;c.depth_test=!1;var d=ha.create_camera(ha.TYPE_NONE);d.width=Cb.cubemap_tex_size;d.height=Cb.cubemap_tex_size;c.camera=
d;c.cube_view_matrices=za.generate_cubemap_matrices();F(c,a);c.horizon_color=new Float32Array([1,1,1]);c.zenith_color=new Float32Array([1,1,1]);c.environment_energy=1;c.sky_color.set(b.sky_color);c.procedural_skydome=b.procedural_skydome;c.use_as_environment_lighting=b.use_as_environment_lighting;c.rayleigh_brightness=b.rayleigh_brightness;c.mie_brightness=b.mie_brightness;c.spot_brightness=b.spot_brightness;c.scatter_strength=b.scatter_strength;c.rayleigh_strength=b.rayleigh_strength;c.mie_strength=
b.mie_strength;c.rayleigh_collection_power=b.rayleigh_collection_power;c.mie_collection_power=b.mie_collection_power;c.mie_distribution=b.mie_distribution;return c}function ga(){var a=e("COPY");a.clear_color=!1;a.clear_depth=!1;a.camera=ha.create_camera(ha.TYPE_NONE);return a}function oa(a){var b=e("STEREO");b.clear_color=!1;b.clear_depth=!1;b.subtype=a?"HMD":"ANAGLYPH";b.camera=ha.create_camera(ha.TYPE_NONE);return b}function na(){var a=e("LUMINANCE");a.clear_color=!1;a.clear_depth=!1;a.camera=ha.create_camera(ha.TYPE_NONE);
return a}function N(){var a=e("AVERAGE_LUMINANCE");a.clear_color=!1;a.clear_depth=!1;a.camera=ha.create_camera(ha.TYPE_NONE);return a}function Z(a,b,c,d){var h=e("LUMINANCE_TRUNCED");h.clear_color=!1;h.clear_depth=!1;h.bloom_key=a;h.bloom_edge_lum=b;h.camera=d;F(h,c);return h}function ba(a){var b=e("BLOOM");b.clear_color=!1;b.clear_depth=!1;b.camera=ha.create_camera(ha.TYPE_NONE);b.bloom_blur=a;return b}function Q(){var a=e("SINK");a.enqueue=!1;return a}function sa(a,b,c){if(b.type===c)return!0;b=
xa(a,b);for(var d=0;d<b.length;d++)if(sa(a,b[d],c))return!0;return!1}function ca(a,b,c){if(b.type===c)return!0;b=ka(a,b);for(var d=0;d<b.length;d++)if(ca(a,b[d],c))return!0;return!1}function Ga(a,b,c){if(b.type===c)return b;b=ka(a,b);for(var d=0;d<b.length;d++){var e=Ga(a,b[d],c);if(e)return e}return null}function ka(a,b){var c=L.node_by_attr(a,b);if(c==L.NULL_NODE)throw"Subscene not in graph";for(var d=[],e=L.in_edge_count(a,c),h=0;h<e;h++){var f=L.get_in_edge(a,c,h);f!=c&&d.push(L.get_node_attr(a,
f))}return d}function xa(a,b){var c=L.node_by_attr(a,b);if(c==L.NULL_NODE)throw"Subscene not in graph";for(var d=[],e=L.out_edge_count(a,c),h=0;h<e;h++){var f=L.get_out_edge(a,c,h);f!=c&&d.push(L.get_node_attr(a,f))}return d}function ra(a){var b=[],c=[];f(a,function(a,d,e,h){a.texture&&-1==b.indexOf(a.texture)&&(b.push(a.texture),c.push(a.texture,b.length-1))});return c}function qa(a,b,c,d){b=""+(a.from+"\\n");b+="NONE"!=a.to?a.to+"\\n":"";b+="(";if(a.update_dim){c=a.size_mult_x;var e=a.size_mult_y;
Math.round(c)!=c&&(c=c.toFixed(2));Math.round(e)!=e&&(e=e.toFixed(2));b+=(1==c?"":c)+"Sx"+((1==e?"":e)+"S")}else c=a.size_mult_x,e=a.size_mult_y,b+=a.size*c+"x"+a.size*e;if("SCREEN"!=a.from){b+=" ";if(a.use_renderbuffer)b+="RR";else{c=a.min_filter;var e=a.mag_filter,h="";c==Y.TF_LINEAR?h+="L":c==Y.TF_NEAREST&&(h+="N");e==Y.TF_LINEAR?h+="L":e==Y.TF_NEAREST&&(h+="N");b+=h}for(c=0;c<d.length;c+=2)d[c]==a.texture&&(b+=" "+d[c+1])}return b+")\\n"}var ha=p("__camera"),ma=p("__config"),R=p("__debug"),L=
p("__graph");p("__obj_util");var Fa=p("__renderer"),Y=p("__textures");p("__tsr");var za=p("__util"),W=ma.debug_subs,La=ma.defaults,ua=ma.outlining,Cb=ma.scenes;a.check_slink_tex_conn=function(a){switch(a.to){case "COLOR":case "CUBEMAP":case "DEPTH":case "SCREEN":case "OFFSCREEN":case "RESOLVE":case "COPY":case "NONE":return!1;default:return!0}};a.traverse_slinks=f;a.create_rendering_graph=function(a,b,d){var e=L.create(),f=[],g=[],l=[],q=[],r=[],z=[],p=[],ua=[],ra=a.lamps_number,C=a.water_params,
F=a.shore_smoothing,qa=a.soft_particles,Fa=a.ssao,ma=a.god_rays,ca=a.materials_params,sa=a.reflection_params,oa=a.bloom_params,Nc=a.motion_blur,Rc=a.compositing,Ga=a.antialiasing,xc=a.world_light_set,Mb=a.world_fog_set,Ua=a.shadow_params,Ya=a.mb_params,Db=a.cc_params,yc=a.god_rays_params,zc=a.outline_params,Gc=a.dof,Ac=a.depth_tex,Za=a.refractions,Pa=Boolean(d.length),jb=1<La.msaa_samples,Rb=y("COLOR","COLOR",1,1,1,!0),kb=y("DEPTH","DEPTH",1,1,1,!0);if(jb){v(kb);var Sb=v(kb);Rb.multisample=!0;Rb.use_renderbuffer=
!0;kb.multisample=!0;kb.use_renderbuffer=!0}var Ea=b.cameras[0];if(Ua){ha.update_camera_shadows(Ea,Ua);for(var Aa=0;Aa<Ua.lamp_types.length;Aa++)for(var lc=Ua.csm_num,$a=0;$a<lc;$a++){var gb=D($a,Aa,Ua,ra);L.append_node_attr(e,gb);l.push(gb);var lb=Ua.csm_resolution,wa=gb.camera;b.shadow_cameras.push(wa);wa.width=lb;wa.height=lb;gb.clear_color=!1;q.push(y("DEPTH","u_shadow_map"+(0<Aa?Aa:$a),lb,1,1,!1));(R.check_depth_only_issue()||La.firefox_shadows_slink_hack)&&gb.slinks_internal.push(y("COLOR",
"COLOR",lb,1,1,!1))}}if(sa&&sa.num_cube_refl&&!Pa)for($a=0;$a<sa.num_cube_refl;$a++){wa=ha.create_camera(ha.TYPE_PERSP);wa.width=a.cubemap_refl_size;wa.height=a.cubemap_refl_size;ha.set_frustum(wa,90,.1,100);ha.set_projection(wa,wa.aspect);var Ma=M("CUBE_REFLECT",wa,!1,C,ra,Mb,xc,null,a.sun_exist);Ma.cube_view_matrices=za.generate_inv_cubemap_matrices();for(Aa=0;6>Aa;Aa++)Ma.cube_cam_frustums.push(ha.create_frustum_planes());L.append_node_attr(e,Ma);var bb=y("CUBEMAP","u_cube_reflection",a.cubemap_refl_size,
1,1,!1);bb.min_filter=Y.TF_LINEAR;bb.mag_filter=Y.TF_LINEAR;var Ha=y("DEPTH","DEPTH",a.cubemap_refl_size,1,1,!1);ua.push(bb);Ma.slinks_internal.push(Ha);p.push(Ma);sa.cube_refl_subs.push(Ma)}if(sa&&0<sa.refl_plane_objs.length&&!Pa)for(Aa=0;Aa<sa.refl_plane_objs.length;Aa++)wa=t(Ea),wa.reflection_plane=new Float32Array(4),b.cameras.push(wa),Ma=M("PLANE_REFLECT",wa,!1,C,ra,Mb,xc,null,a.sun_exist),L.append_node_attr(e,Ma),bb=y("COLOR","u_plane_reflection",1,a.plane_refl_size,a.plane_refl_size,!0),bb.min_filter=
Y.TF_LINEAR,bb.mag_filter=Y.TF_LINEAR,Ha=y("DEPTH","DEPTH",1,a.plane_refl_size,a.plane_refl_size,!0),z.push(bb),Ma.slinks_internal.push(Ha),r.push(Ma),sa.plane_refl_subs.push([Ma]);if(a.dynamic_grass){var Ia=m();L.append_node_attr(e,Ia);lb=Cb.grass_tex_size;Ia.camera.width=lb;Ia.camera.height=lb;var xb=y("DEPTH","u_grass_map_depth",lb,1,1,!1);xb.min_filter=Y.TF_LINEAR;xb.mag_filter=Y.TF_LINEAR;var yb=y("COLOR","u_grass_map_color",lb,1,1,!1);yb.min_filter=Y.TF_LINEAR;yb.mag_filter=Y.TF_LINEAR}else yb=
xb=Ia=null;if(Ac&&Ua){var mc=t(Ea);b.cameras.push(mc);var Qa=H(e,mc,ra);L.append_node_attr(e,Qa);Qa.self_shadow_normal_offset=Ua.self_shadow_normal_offset;for($a=0;$a<l.length;$a++)gb=l[$a],L.append_edge_attr(e,gb,Qa,q[$a]);var Sc=y("COLOR","u_color",1,1,1,!0),Hc=y("DEPTH","u_depth",1,1,1,!0);if(Fa){var nc=t(Ea);b.cameras.push(nc);var Yb=a.ssao_params,db=I(nc,Mb,Yb);L.append_node_attr(e,db);var oc=y("COLOR","u_ssao_mask",1,1,1,!0);L.append_edge_attr(e,Qa,db,Sc);L.append_edge_attr(e,Qa,db,Hc);var Ic=
t(Ea);b.cameras.push(Ic);var pc=aa(Ic,Yb);L.append_node_attr(e,pc);var tb=y("COLOR","u_shadow_mask",1,1,1,!0);L.append_edge_attr(e,db,pc,oc);L.append_edge_attr(e,Qa,pc,Hc)}jb&&Qa.slinks_internal.push(y("DEPTH","DEPTH",1,1,1,!0));Ia&&(L.append_edge_attr(e,Ia,Qa,xb),L.append_edge_attr(e,Ia,Qa,yb))}else Qa=null;var Oa=M("OPAQUE",Ea,jb||!Qa||La.clear_depth_hack,C,ra,Mb,xc,null,a.sun_exist);L.append_node_attr(e,Oa);if(jb){var Ja=J();L.append_node_attr(e,Ja);g.push(Ja);var Sa=y("COLOR","RESOLVE",1,1,1,
!0);Sa.multisample=!0;Sa.use_renderbuffer=!0;var Xb=y("DEPTH","RESOLVE",1,1,1,!0);Xb.multisample=!0;Xb.use_renderbuffer=!0;L.append_edge_attr(e,Oa,Ja,Sa);L.append_edge_attr(e,Oa,Ja,Xb);Qa&&(oc?L.append_edge_attr(e,pc,Oa,tb):Ua?L.append_edge_attr(e,Qa,Oa,y("COLOR","u_shadow_mask",1,1,1,!0)):za.panic("Internal error"))}else g.push(Oa),Qa&&(L.append_edge_attr(e,Qa,Oa,kb),oc?L.append_edge_attr(e,pc,Oa,tb):Ua?L.append_edge_attr(e,Qa,Oa,y("COLOR","u_shadow_mask",1,1,1,!0)):za.panic("Internal error"));Ia&&
(L.append_edge_attr(e,Ia,Oa,xb),L.append_edge_attr(e,Ia,Oa,yb));if(r.length)for(var Eb=r.length,Aa=0;Aa<Eb;Aa++)L.append_edge_attr(e,r[Aa],Oa,z[Aa]);if(p.length)for(Aa=0;Aa<p.length;Aa++)L.append_edge_attr(e,p[Aa],Oa,ua[Aa]);f=g;g=[];if(!Pa&&a.color_picking){wa=t(Ea);b.cameras.push(wa);var Nb=O(wa,!1,ra);L.append_node_attr(e,Nb);if(a.xray){wa=t(Ea);b.cameras.push(wa);var Fb=O(wa,!0,ra);L.append_node_attr(e,Fb);var qc=y("COLOR","COLOR",1,1,1,!0);L.append_edge_attr(e,Nb,Fb,qc);var mb=y("DEPTH","DEPTH",
1,1,1,!0);L.append_edge_attr(e,Nb,Fb,mb)}}else Nb=null;if(ca.refractions&&!Pa)if(jb)Zb=Ja;else{var Zb=ga();L.append_node_attr(e,Zb);var Jc=y("COLOR","COPY",1,1,1,!0);L.append_edge_attr(e,f[0],Zb,Jc)}else Zb=null;if(Ac&&(ca.refractions&&Za||F||qa)){var Gb=t(Ea);b.cameras.push(Gb);var $b=P(Gb);L.append_node_attr(e,$b);var hc=y("DEPTH","u_depth",1,1,1,!0);L.append_edge_attr(e,jb?Ja:Oa,$b,hc);var Hb=y("COLOR","u_scene_depth",1,1,1,!0);Hb.min_filter=Y.TF_NEAREST;Hb.mag_filter=Y.TF_NEAREST}else $b=null;
var rb=function(c){var d=t(Ea);b.cameras.push(d);d=M(c,d,!1,C,ra,Mb,xc,Ua,a.sun_exist);L.append_node_attr(e,d);"XRAY"==c?(c=y("COLOR","COLOR",1,1,1,!0),L.append_edge_attr(e,f[0],d,c),c=y("DEPTH","DEPTH",1,1,1,!0),d.slinks_internal.push(c)):(c=jb&&"RESOLVE"==f[0].type?Oa:f[0],L.append_edge_attr(e,c,d,kb),L.append_edge_attr(e,c,d,Rb));Ia&&(L.append_edge_attr(e,Ia,d,xb),L.append_edge_attr(e,Ia,d,yb));for(c=0;c<l.length;c++)L.append_edge_attr(e,l[c],d,q[c]);$b&&L.append_edge_attr(e,$b,d,Hb);if(r.length){var h=
r.length;for(c=0;c<h;c++)L.append_edge_attr(e,r[c],d,z[c])}if(p.length)for(c=0;c<p.length;c++)L.append_edge_attr(e,p[c],d,ua[c]);Zb&&(c=y("COLOR","u_refractmap",1,1,1,!0),L.append_edge_attr(e,Zb,d,c));return d};if(a.glow_over_blend){var ta=rb("BLEND");g.push(ta);f=g;g=[]}if(a.glow_materials){var zb=t(Ea);b.cameras.push(zb);var ya=M("GLOW",zb,!1,C,ra,Mb,xc);L.append_node_attr(e,ya);L.append_edge_attr(e,jb?Ja:Oa,ya,jb?Sb:kb);var Ta=u("X_GLOW_BLUR");Ta.subtype="GLOW_MASK_SMALL";Ta.texel_size_multiplier=
a.glow_params.small_glow_mask_width;var hb=y("COLOR","u_color",1,1,1,!0);hb.min_filter=Y.TF_LINEAR;hb.mag_filter=Y.TF_LINEAR;L.append_node_attr(e,Ta);L.append_edge_attr(e,ya,Ta,hb);var eb=u("Y_GLOW_BLUR");eb.subtype="GLOW_MASK_SMALL";eb.texel_size_multiplier=a.glow_params.small_glow_mask_width;var Wa=y("COLOR","u_color",1,.5,.5,!0);Wa.min_filter=Y.TF_LINEAR;Wa.mag_filter=Y.TF_LINEAR;L.append_node_attr(e,eb);L.append_edge_attr(e,Ta,eb,Wa);var Ib=u("X_GLOW_BLUR");Ib.subtype="GLOW_MASK_LARGE";Ib.texel_size_multiplier=
a.glow_params.large_glow_mask_width;var Ab=y("COLOR","u_color",1,.5,.5,!0);Ab.min_filter=Y.TF_LINEAR;Ab.mag_filter=Y.TF_LINEAR;L.append_node_attr(e,Ib);L.append_edge_attr(e,eb,Ib,Ab);var ac=u("Y_GLOW_BLUR");ac.subtype="GLOW_MASK_LARGE";ac.texel_size_multiplier=a.glow_params.large_glow_mask_width;var Tb=y("COLOR","u_color",1,.25,.25,!0);Tb.min_filter=Y.TF_LINEAR;Tb.mag_filter=Y.TF_LINEAR;L.append_node_attr(e,ac);L.append_edge_attr(e,Ib,ac,Tb);var Jb=t(Ea);b.cameras.push(Jb);var Bb=E(Jb,a);L.append_node_attr(e,
Bb);var rc=y("COLOR","u_src_color",1,1,1,!0);if(a.glow_over_blend)if(jb){var ic=J();L.append_node_attr(e,ic);L.append_edge_attr(e,ta,ic,Sa);L.append_edge_attr(e,ta,ic,Xb);L.append_edge_attr(e,ic,Bb,rc)}else L.append_edge_attr(e,ta,Bb,rc);else L.append_edge_attr(e,jb?Ja:Oa,Bb,rc);L.append_edge_attr(e,a.glow_over_blend?ta:Oa,Bb,kb);var jc=y("COLOR","u_glow_mask_small",1,.5,.5,!0);jc.min_filter=Y.TF_LINEAR;jc.mag_filter=Y.TF_LINEAR;L.append_edge_attr(e,eb,Bb,jc);var nb=y("COLOR","u_glow_mask_large",
1,.25,.25,!0);nb.min_filter=Y.TF_LINEAR;nb.mag_filter=Y.TF_LINEAR;L.append_edge_attr(e,ac,Bb,nb);f=[Bb];g=[]}a.glow_over_blend||(ta=rb("BLEND"),g.push(ta),f=g,g=[]);if(La.wireframe_debug){wa=t(Ea);b.cameras.push(wa);var Na=G(wa);g.push(Na);L.append_node_attr(e,Na);L.append_edge_attr(e,f[0],Na,Rb);L.append_edge_attr(e,f[0],Na,kb);Ia&&(L.append_edge_attr(e,Ia,Na,xb),L.append_edge_attr(e,Ia,Na,yb));f=g;g=[]}if(jb){var ob=J();L.append_node_attr(e,ob);g.push(ob);L.append_edge_attr(e,f[0],ob,Sa);L.append_edge_attr(e,
f[0],ob,Xb);f=g;g=[]}var Tc=f.slice(0);if(!Pa&&a.anchor_visibility){wa=t(Ea);b.cameras.push(wa);var pb=x(wa);L.append_node_attr(e,pb);L.append_edge_attr(e,f[0],pb,jb?Sb:kb)}if(ma&&Ac&&!Pa){var Kb=yc.max_ray_length,bc=yc.intensity,Ub=yc.steps_per_pass,Ra=f[0],Ob=C?1:0,Lb=y("DEPTH","u_input",1,1,1,!0);Lb.min_filter=Y.TF_LINEAR;Lb.mag_filter=Y.TF_LINEAR;var ub=y("COLOR","u_input",1,.25,.25,!0);ub.min_filter=Y.TF_LINEAR;ub.mag_filter=Y.TF_LINEAR;var Ka=Kb/Ub,Bc=t(Ea);b.cameras.push(Bc);var Kc=S(Bc,Ob,
Kb,!0,Ka,ra,Ub);L.append_node_attr(e,Kc);L.append_edge_attr(e,Ra,Kc,Lb);var Ka=Kb/Ub*.5,sc=t(Ea);b.cameras.push(sc);var cc=S(sc,Ob,Kb,!1,Ka,ra,Ub);L.append_node_attr(e,cc);L.append_edge_attr(e,Kc,cc,ub);var Ka=Kb/Ub*.25,Lc=t(Ea);b.cameras.push(Lc);var dc=S(Lc,Ob,Kb,!1,Ka,ra,Ub);L.append_node_attr(e,dc);L.append_edge_attr(e,cc,dc,ub);var tc=X(bc,ra);g.push(tc);L.append_node_attr(e,tc);L.append_edge_attr(e,Ra,tc,y("COLOR","u_main",1,1,1,!0));L.append_edge_attr(e,dc,tc,y("COLOR","u_god_rays",1,1,1,!0));
f=g;g=[]}if(oa&&!Pa){var Ra=f[0],Pb=na();L.append_node_attr(e,Pb);L.append_edge_attr(e,Ra,Pb,y("COLOR","u_input",1,1,1,!0));var ec=N();L.append_node_attr(e,ec);ec.camera.width=La.edge_min_tex_size_hack?2:1;ec.camera.height=La.edge_min_tex_size_hack?2:1;var fc=y("COLOR","u_input",1,.25,.25,!0);fc.min_filter=Y.TF_LINEAR;fc.mag_filter=Y.TF_LINEAR;var Mc=y("COLOR","u_luminance",1,.25,.25,!0);Mc.min_filter=Y.TF_LINEAR;Mc.mag_filter=Y.TF_LINEAR;L.append_edge_attr(e,Pb,ec,fc);var Xa=oa.key,ib=oa.edge_lum,
td=t(Ea);b.cameras.push(td);var Oc=Z(Xa,ib,ra,td);L.append_node_attr(e,Oc);L.append_edge_attr(e,Ra,Oc,y("COLOR","u_main",1,1,1,!0));L.append_edge_attr(e,Pb,Oc,Mc);L.append_edge_attr(e,ec,Oc,y("COLOR","u_average_lum",1,1,1,!1));var vb=y("COLOR","u_color",1,.25,.25,!0);vb.min_filter=Y.TF_LINEAR;vb.mag_filter=Y.TF_LINEAR;Ta=K(e,Pb,"X_BLUR",!0);L.append_node_attr(e,Ta);L.append_edge_attr(e,Oc,Ta,vb);eb=K(e,Ta,"Y_BLUR",!0);L.append_node_attr(e,eb);L.append_edge_attr(e,Ta,eb,vb);var uc=ba(oa.blur);L.append_node_attr(e,
uc);var Pc=y("COLOR","u_bloom",1,.25,.25,!0);Pc.min_filter=Y.TF_LINEAR;Pc.mag_filter=Y.TF_LINEAR;L.append_edge_attr(e,eb,uc,Pc);L.append_edge_attr(e,Ra,uc,y("COLOR","u_main",1,1,1,!0));g.push(uc);f=g;g=[]}if(Gc&&Ac&&!Pa){var Ra=f[0],gc=t(Ea);b.cameras.push(gc);vb=y("COLOR","u_color",1,1,1,!0);vb.min_filter=Y.TF_LINEAR;vb.mag_filter=Y.TF_LINEAR;var Cc=u("X_BLUR");L.append_node_attr(e,Cc);L.append_edge_attr(e,Ra,Cc,vb);var vc=u("Y_BLUR");L.append_node_attr(e,vc);L.append_edge_attr(e,Cc,vc,vb);var kc=
Tc[0],Uc=da(gc);gc.dof_distance=b.dof_distance;gc.dof_object=b.dof_object;gc.dof_front=b.dof_front;gc.dof_rear=b.dof_rear;gc.dof_power=b.dof_power;gc.dof_on=!0;g.push(Uc);L.append_node_attr(e,Uc);L.append_edge_attr(e,Ra,Uc,y("COLOR","u_sharp",1,1,1,!0));L.append_edge_attr(e,vc,Uc,y("COLOR","u_blurred",1,1,1,!0));L.append_edge_attr(e,kc,Uc,y("DEPTH","u_depth",1,1,1,!0));f=g;g=[]}if(a.xray){var od=rb("XRAY");g.push(od);f=g;g=[]}if(Nc&&!Pa){var hd=f[0],ad=fa(Ya.mb_decay_threshold,Ya.mb_factor);g.push(ad);
L.append_node_attr(e,ad);var pd=y("COLOR","u_mb_tex_curr",1,1,1,!0);L.append_edge_attr(e,hd,ad,pd);var bd=y("COLOR","u_mb_tex_accum",1,1,1,!0);ad.slinks_internal.push(bd);f=g;g=[]}if(!Pa&&a.outline){var Ra=f[0],Vc=t(Ea);b.cameras.push(Vc);var jd=ea(Vc,ra);L.append_node_attr(e,jd);var Wc=u("X_EXTEND"),ud=y("COLOR","u_color",1,1,1,!0),qd=y("COLOR","u_outline_mask",1,1,1,!0);Wc.is_for_outline=!0;L.append_node_attr(e,Wc);L.append_edge_attr(e,jd,Wc,ud);var qb=y("COLOR","u_color",1,.5,.5,!0);qb.min_filter=
Y.TF_LINEAR;qb.mag_filter=Y.TF_LINEAR;var cd=u("Y_EXTEND");cd.is_for_outline=!0;L.append_node_attr(e,cd);L.append_edge_attr(e,Wc,cd,qb);Cc=u("X_BLUR");Cc.is_for_outline=!0;L.append_node_attr(e,Cc);L.append_edge_attr(e,cd,Cc,qb);var Dc=y("COLOR","u_color",1,.25,.25,!0);Dc.min_filter=Y.TF_LINEAR;Dc.mag_filter=Y.TF_LINEAR;var kd=y("COLOR","u_outline_mask_blurred",1,.25,.25,!0);kd.min_filter=Y.TF_LINEAR;kd.mag_filter=Y.TF_LINEAR;vc=u("Y_BLUR");vc.is_for_outline=!0;L.append_node_attr(e,vc);L.append_edge_attr(e,
Cc,vc,Dc);var Qc=V(zc);L.append_node_attr(e,Qc);L.append_edge_attr(e,Ra,Qc,y("COLOR","u_outline_src",1,1,1,!0));L.append_edge_attr(e,jd,Qc,qd);L.append_edge_attr(e,vc,Qc,kd);g.push(Qc);f=g;g=[]}if(Rc&&!Pa){var Ra=f[0],dd=w(Db.brightness,Db.contrast,Db.exposure,Db.saturation);L.append_node_attr(e,dd);L.append_edge_attr(e,Ra,dd,y("COLOR","u_color",1,1,1,!0));g.push(dd);f=g;g=[]}if(Ga){Ra=f[0];if(La.smaa){var wc=y("COLOR","u_color",1,1,1,!0);wc.min_filter=Y.TF_LINEAR;wc.mag_filter=Y.TF_LINEAR;var ld=
T("SMAA_EDGE_DETECTION",a);L.append_node_attr(e,ld);L.append_edge_attr(e,Ra,ld,wc);var Xc=T("SMAA_BLENDING_WEIGHT_CALCULATION",a);L.append_node_attr(e,Xc);L.append_edge_attr(e,ld,Xc,wc);var ed=y("COLOR","u_search_tex",1,1,1,!1),md=y("COLOR","u_area_tex",1,1,1,!1);ed.min_filter=Y.TF_LINEAR;ed.mag_filter=Y.TF_LINEAR;md.min_filter=Y.TF_LINEAR;md.mag_filter=Y.TF_LINEAR;Xc.slinks_internal.push(ed);Xc.slinks_internal.push(md);var Yc=T("SMAA_NEIGHBORHOOD_BLENDING",a);L.append_node_attr(e,Yc);L.append_edge_attr(e,
Ra,Yc,wc);var vd=y("COLOR","u_blend",1,1,1,!0);vd.min_filter=Y.TF_LINEAR;vd.mag_filter=Y.TF_LINEAR;L.append_edge_attr(e,Xc,Yc,vd);g.push(Yc)}else{var wd=U(a);L.append_node_attr(e,wd);var xd=y("COLOR","u_color",1,1,1,!0);xd.min_filter=Y.TF_LINEAR;xd.mag_filter=Y.TF_LINEAR;L.append_edge_attr(e,Ra,wd,xd);g.push(wd)}f=g;g=[]}g.push(f[0]);var Gd=L.node_by_attr(e,f[0]);if("MOTION_BLUR"==f[0].type||"RESOLVE"==f[0].type)var yd=!0;else yd=!1,L.traverse_inputs(e,Gd,function(a,b,c){if(c.from==c.to)return yd=
!0});if(yd){var zd=u("NONE");L.append_node_attr(e,zd);L.append_edge_attr(e,f[0],zd,y("COLOR","u_color",1,1,1,!0));f=g;g=[];g.push(zd)}Nb&&(Fb?g.push(Fb):g.push(Nb));pb&&g.push(pb);if(!Pa&&a.sky_params.procedural_skydome){var Bd=la(ra,a.sky_params);L.append_node_attr(e,Bd);g.push(Bd)}var Zc=Q();L.append_node_attr(e,Zc);for($a=0;$a<g.length;$a++){var rd=g[$a];switch(rd.type){case "COLOR_PICKING":case "COLOR_PICKING_XRAY":L.append_edge_attr(e,rd,Zc,y("COLOR","NONE",1,1,1,!0));L.append_edge_attr(e,rd,
Zc,y("DEPTH","NONE",1,1,1,!0));break;case "SKY":var Hd=y("CUBEMAP","u_sky",Cb.cubemap_tex_size,1,1,!1);L.append_edge_attr(e,rd,Zc,Hd);break;case "ANCHOR_VISIBILITY":var Id=y("COLOR","NONE",1,1,1,!0);L.append_edge_attr(e,rd,Zc,Id);break;default:if(Pa){var Cd=d[0]._render,sd=y("COLOR","OFFSCREEN",1,1,1,!0);sd.texture=Cd;L.append_edge_attr(e,g[$a],Zc,sd);for(Aa=1;Aa<d.length;Aa++){var Dd=d[Aa]._render,Ad=u("NONE");L.append_node_attr(e,Ad);var Jd=y("COLOR","SCALE",1,1,1,!0);L.append_edge_attr(e,g[$a],
Ad,Jd);var Ed=Dd.source_size/Cd.source_size,sd=y("COLOR","OFFSCREEN",1,Ed,Ed,!0);sd.texture=Dd;L.append_edge_attr(e,Ad,Zc,sd)}}else L.append_edge_attr(e,g[$a],Zc,y("SCREEN","NONE",1,1,1,!0))}}Ja&&!xa(e,Ja).length&&(L.remove_node(e,L.node_by_attr(e,Ja)),L.cleanup_loose_edges(e));c(e,Ac);!a.anaglyph_use&&!a.hmd_stereo_use||Pa||B(e,a,b);if(W.enabled){var Fd=n(e);Fd&&A(e,Fd)}k(e);h(e);Ua&&L.traverse(e,function(a,b){if("DEPTH"==b.type||"MAIN_BLEND"==b.type||"MAIN_XRAY"==b.type){for(var c=0,d=ka(e,b),h=
0,f=0;f<d.length;f++){var g=d[f];"SHADOW_CAST"==g.type&&(h++,b.p_light_matrix=b.p_light_matrix||[],b.p_light_matrix[0<g.shadow_lamp_index?g.shadow_lamp_index:c]=g.camera.proj_matrix,c++)}b.v_light_ts&&b.v_light_r||(La.mac_os_shadow_hack?b.v_light_tsr=new Float32Array(9*h):(b.v_light_ts=new Float32Array(4*h),b.v_light_r=new Float32Array(4*h)))}});return e};a.init_subs=e;a.set_texel_size=function(a,b,c){var d=a.texel_size_multiplier;a.texel_size[0]=b*a.texel_mask[0]*d;a.texel_size[1]=c*a.texel_mask[1]*
d};a.set_texel_size_mult=function(a,b){a.texel_size_multiplier=b};a.create_performance_graph=function(){var a=L.create(),b;b=e("PERFORMANCE");var c=ha.create_camera(ha.TYPE_NONE);c.width=1024;c.height=1024;b.camera=c;L.append_node_attr(a,b);c=Q();L.append_node_attr(a,c);L.append_edge_attr(a,b,c,y("COLOR","NONE",1024,1,1,!1));k(a);h(a);return a};a.find_on_screen=function(a){var b=null;L.traverse(a,function(a,c){return c.camera&&null===c.camera.framebuffer?(b=c,!0):!1});return b};a.find_input=function(a,
b,c){a=ka(a,b);for(b=0;b<a.length;b++)if(a[b].type===c)return a[b];return null};a.has_lower_subs=sa;a.has_upper_subs=ca;a.get_inputs=ka;a.get_outputs=xa;a.find_subs=function(a,b){var c=null;L.traverse(a,function(a,d){return d.type==b?(c=d,!0):!1});return c};a.debug_convert_to_dot=function(a){var b="digraph scenegraph {\n",b=b+"    ",b=b+'size="11.7,16.5";\n',b=b+"    ",b=b+'ratio="fill";\n',b=b+"    ",b=b+'node [shape=box margin="0.25,0.055"];\n',c=ra(a);L.traverse(a,function(a,d){var e=b+="    ",
h="",h=d.type.replace(/_/g," ");"POSTPROCESSING"==d.type&&(h+=" ("+d.pp_effect.replace(/_/g," ")+")");if(d.camera){for(var h=h+"\\n",f=0;f<c.length;f+=2){var g=d.camera.color_attachment;c[f]==g&&(h=Y.is_renderbuffer(g)?h+("CR"+c[f+1]+" "):h+("C"+c[f+1]+" "))}for(f=0;f<c.length;f+=2)g=d.camera.depth_attachment,c[f]==g&&(h=Y.is_renderbuffer(g)?h+("DR"+c[f+1]):h+("D"+c[f+1]))}d.slinks_internal.length&&(h+="\\n-----\\n");for(f=0;f<d.slinks_internal.length;f++)h+=qa(d.slinks_internal[f],a,null,c);f="SINK"==
d.type?"dotted":d.enqueue?"solid":"dashed";b=e+(String(a)+' [label="'+h+'" color="black" style="'+(f+",bold")+'"];\n')});L.traverse_edges(a,function(a,d,e){var h=b+="    ",f=qa(e,a,d,c);b=h+(String(a)+" -> "+String(d)+' [label="'+f+'" style="'+(e.active?"solid":"dotted")+'"];\n')});return b+="}"};a.create_rendering_queue=function(a){a=L.topsort_attr(a);for(var b=[],c=0;c<a.length;c++){var d=a[c];d.enqueue&&b.push(d)}return b}};b4w.module.__textures=function(a,p){function t(){return{name:"",type:0,source:"",source_id:"",width:0,height:0,compress_ratio:1,allow_node_dds:!0,source_size:1024,enable_canvas_mipmapping:!1,canvas_context:null,w_target:0,w_texture:null,w_renderbuffer:null,is_movie:!1,vtex_data_id:-1,video_file:null,movie_length:0,fps:0,frame_start:0,frame_offset:0,frame_duration:0,need_resize:!1,scale_fac:1,seq_video:null,seq_movie_length:0,seq_fps:0,seq_cur_frame:-1,seq_video_played:!1,seq_last_discrete_mark:-1,
video_was_stopped:!1,use_auto_refresh:!1,use_cyclic:!1,use_nla:!1,repeat:!0}}function c(c,d,e,h){var f=c.type,g=new Uint8Array([204,204,204,255]),k=t();switch(f){case "DATA_TEX2D":case "IMAGE":var l=w.createTexture(),m=w.TEXTURE_2D;w.bindTexture(m,l);w.texImage2D(m,0,w.RGBA,1,1,0,w.RGBA,w.UNSIGNED_BYTE,g);c.image&&"MOVIE"==c.image.source&&(k.is_movie=!0,k.frame_start=c.frame_start,k.frame_offset=c.frame_offset,k.frame_duration=c.frame_duration,k.use_auto_refresh=c.use_auto_refresh,k.use_cyclic=c.use_cyclic,
k.movie_length=c.movie_length,k.use_nla=c.b4w_nla_video,0!=k.frame_offset&&E.warn('Frame offset for texture "'+c.name+'" has a nonzero value. Can lead to undefined behaviour for mobile devices.'));break;case "NONE":l=w.createTexture();m=w.TEXTURE_2D;w.bindTexture(m,l);if("NONE"==c.b4w_source_type)return null;if("SCENE"==c.b4w_source_type)if(c.b4w_source_id&&(e=J.keysearch("name",c.b4w_source_id,e)))k.source_size=c.b4w_source_size,e._render_to_textures=e._render_to_textures||[],e._render_to_textures.push(c),
w.texImage2D(m,0,w.RGBA,1,1,0,w.RGBA,w.UNSIGNED_BYTE,g);else return null;break;case "ENVIRONMENT_MAP":l=w.createTexture();m=w.TEXTURE_CUBE_MAP;w.bindTexture(m,l);e="POSITIVE_X NEGATIVE_X POSITIVE_Y NEGATIVE_Y POSITIVE_Z NEGATIVE_Z".split(" ");for(var n=0;6>n;n++)w.texImage2D(w["TEXTURE_CUBE_MAP_"+e[n]],0,w.RGBA,1,1,0,w.RGBA,w.UNSIGNED_BYTE,g);break;case "BLEND":return null;default:return E.error('texture "'+c.name+'" has unsupported type "'+f+'"'),null}"NONE"==f&&(!c.b4w_enable_canvas_mipmapping||
"CANVAS"!=c.b4w_source_type)||"DATA_TEX2D"==f||"IMAGE"==f&&"MOVIE"==c.image.source?w.texParameteri(m,w.TEXTURE_MIN_FILTER,w.LINEAR):w.texParameteri(m,w.TEXTURE_MIN_FILTER,fa[x.texture_min_filter]);w.texParameteri(m,w.TEXTURE_MAG_FILTER,w.LINEAR);g=m;e=c.b4w_anisotropic_filtering;"DEFAULT"===e&&(e=d);"OFF"!==e&&x.anisotropic_filtering&&(d=K.get_aniso())&&(e=parseFloat(e.split("x")[0]),w.texParameterf(g,d.TEXTURE_MAX_ANISOTROPY_EXT,e));"REPEAT"!=c.extension||c.b4w_shore_dist_map?(k.repeat=!1,w.texParameteri(m,
w.TEXTURE_WRAP_S,w.CLAMP_TO_EDGE),w.texParameteri(m,w.TEXTURE_WRAP_T,w.CLAMP_TO_EDGE)):(w.texParameteri(m,w.TEXTURE_WRAP_S,w.REPEAT),w.texParameteri(m,w.TEXTURE_WRAP_T,w.REPEAT));k.type=a.TT_RGBA_INT;k.width=1;k.height=1;k.w_texture=l;k.w_target=m;"CANVAS"==c.b4w_source_type&&"NONE"==f?(f=c.b4w_source_id,l=c.b4w_source_size,k.enable_canvas_mipmapping=c.b4w_enable_canvas_mipmapping,k.source_id=f,k.source="CANVAS",m=document.createElement("canvas"),m.width=l,m.height=l,k.canvas_context=m.getContext("2d"),
h in U||(U[h]={}),U[h][f]=k,b(k)):"SCENE"==c.b4w_source_type&&"NONE"==f?(k.source_id=c.b4w_source_id,k.source="SCENE"):(k.source=f,w.generateMipmap(m),w.bindTexture(m,null));k.name=c.name;return c._render=k}function b(a){if("CANVAS"!=a.source)throw"Wrong texture";var b=a.w_target;w.bindTexture(b,a.w_texture);var c=f(a),d=h(a),e=n(a),g=a.canvas_context.canvas;w.pixelStorei(w.UNPACK_FLIP_Y_WEBGL,!0);w.texImage2D(b,0,d,c,e,g);w.pixelStorei(w.UNPACK_FLIP_Y_WEBGL,!1);a.enable_canvas_mipmapping&&w.generateMipmap(b);
w.bindTexture(b,null);a.width=g.width;a.height=g.height}function k(a){var b=a.w_target;w.bindTexture(b,a.w_texture);w.pixelStorei(w.UNPACK_FLIP_Y_WEBGL,!0);4!=a.video_file.length?a.need_resize?q(a,a.video_file,a.width*a.scale_fac,a.height*a.scale_fac,!1):w.texImage2D(b,0,w.RGBA,w.RGBA,w.UNSIGNED_BYTE,a.video_file):w.texImage2D(b,0,w.RGBA,1,1,0,w.RGBA,w.UNSIGNED_BYTE,a.video_file);w.bindTexture(b,null)}function d(a){var b=a.w_target;w.bindTexture(b,a.w_texture);w.pixelStorei(w.UNPACK_FLIP_Y_WEBGL,
!0);a.need_resize?q(a,a.seq_video[a.seq_cur_frame],a.width*a.scale_fac,a.height*a.scale_fac,!1):w.texImage2D(b,0,w.RGBA,w.RGBA,w.UNSIGNED_BYTE,a.seq_video[a.seq_cur_frame]);w.bindTexture(b,null)}function l(){P||(P=document.createElement("canvas"));return P}function q(a,b,c,d,e){e||(r(w.TEXTURE_2D),w.texImage2D(w.TEXTURE_2D,0,w.RGBA,w.RGBA,w.UNSIGNED_BYTE,b));w.bindTexture(w.TEXTURE_2D,null);O.draw_resized_texture(a,c,d,aa,I,"NONE")}function r(a){aa||(aa=w.createFramebuffer());w.bindTexture(a,null);
I||(I=w.createTexture());w.bindTexture(a,I);w.texParameteri(a,w.TEXTURE_WRAP_S,w.CLAMP_TO_EDGE);w.texParameteri(a,w.TEXTURE_WRAP_T,w.CLAMP_TO_EDGE);w.texParameteri(a,w.TEXTURE_MAG_FILTER,w.LINEAR);w.texParameteri(a,w.TEXTURE_MIN_FILTER,w.LINEAR)}function g(a){a.video_file.oncanplay=function(){k(a)}}function C(a){return J.check_npot(a)?(a=Math.pow(2,parseInt(a).toString(2).length),J.clamp(a,2,x.max_texture_size)):a}function f(b){switch(b.type){case a.TT_RGBA_INT:b=w.RGBA;break;case a.TT_RGB_INT:b=
w.RGB;break;case a.TT_RGBA_FLOAT:b=w.RGBA;break;case a.TT_RGB_FLOAT:b=w.RGB;break;case a.TT_DEPTH:b=w.DEPTH_COMPONENT;break;default:throw"Wrong texture type";}return b}function h(b){switch(b.type){case a.TT_RGBA_INT:b=x.webgl2?w.RGBA8:w.RGBA;break;case a.TT_RGB_INT:b=x.webgl2?w.RGB8:w.RGB;break;case a.TT_RGBA_FLOAT:b=x.webgl2?w.RGBA8:w.RGBA;break;case a.TT_RGB_FLOAT:b=x.webgl2?w.RGB8:w.RGB;break;case a.TT_DEPTH:b=x.webgl2?w.DEPTH_COMPONENT24:w.DEPTH_COMPONENT;break;default:throw"Wrong texture type";
}return b}function n(b){switch(b.type){case a.TT_RGBA_INT:b=w.UNSIGNED_BYTE;break;case a.TT_RGB_INT:b=w.UNSIGNED_BYTE;break;case a.TT_RGBA_FLOAT:b=w.FLOAT;break;case a.TT_RGB_FLOAT:b=w.FLOAT;break;case a.TT_DEPTH:b=w.UNSIGNED_INT;break;default:throw"Wrong texture type";}return b}function A(a){return a&&a.name&&a.w_renderbuffer?!0:!1}function B(a,b){if(b in T&&a in T[b]){var c=T[b][a];c.video_file?c.video_file.play():c.seq_video&&(c.seq_video_played=!0);return!0}return!1}function F(a,b){if(b in T&&
a in T[b]){var c=T[b][a];c.video_file?c.video_file.pause():c.seq_video&&(c.seq_video_played=!1);return!0}return!1}function D(a,b){if(b in T&&a in T[b]){var c=T[b][a];c.video_file?c.video_file.currentTime=c.frame_offset/c.fps:c.seq_video&&(c.seq_cur_frame=z(c,c.frame_offset),d(c));return!0}return!1}function e(a){return a.video_file?!a.video_file.paused:a.seq_video?a.seq_video_played:!1}function z(a,b){return Math.round(b*a.seq_movie_length/a.movie_length)}function y(a,b){if(G.is_dynamic(a))return v(a,
b);for(var c=a.meta_objects,d=0;d<c.length;d++){var e=v(c[d],b);if(e)return e}return null}function v(a,b){for(var c=null,d=a.scenes_data,e=0;e<d.length;e++)for(var h=d[e].batches,f=0;f<h.length;f++)for(var g=h[f],k=0;k<g.textures.length;k++)if(g.textures[k].name==b){c=g.textures[k];break}return c}var m=p("__config"),u=p("__dds"),K=p("__extensions"),E=p("__print"),M=p("__time"),J=p("__util"),O=p("__renderer"),G=p("__obj_util"),x=m.defaults,H=m.sfx,P=null,I=null,aa=null;a.TF_NEAREST=0;a.TF_LINEAR=0;
a.TF_NEAREST_MIPMAP_NEAREST=0;a.TF_LINEAR_MIPMAP_NEAREST=0;a.TF_NEAREST_MIPMAP_LINEAR=0;a.TF_LINEAR_MIPMAP_LINEAR=0;a.TT_RGBA_INT=10;a.TT_RGB_INT=20;a.TT_RGBA_FLOAT=30;a.TT_RGB_FLOAT=40;a.TT_DEPTH=50;a.TT_RB_RGBA=60;a.TT_RB_DEPTH=70;a.TT_RB_RGBA_MS=80;a.TT_RB_DEPTH_MS=90;var U={},T={},w=null,fa;a.setup_context=function(b){fa=[b.NEAREST_MIPMAP_NEAREST,b.NEAREST_MIPMAP_LINEAR,b.LINEAR_MIPMAP_NEAREST,b.LINEAR_MIPMAP_LINEAR];a.TF_NEAREST=b.NEAREST;a.TF_LINEAR=b.LINEAR;a.TF_NEAREST_MIPMAP_NEAREST=b.NEAREST_MIPMAP_NEAREST;
a.TF_LINEAR_MIPMAP_NEAREST=b.LINEAR_MIPMAP_NEAREST;a.TF_NEAREST_MIPMAP_LINEAR=b.NEAREST_MIPMAP_LINEAR;a.TF_LINEAR_MIPMAP_LINEAR=b.LINEAR_MIPMAP_LINEAR;w=b};a.get_canvas_context=function(a,b){return b in U&&a in U[b]?U[b][a].canvas_context:null};a.update_canvas_context=function(a,c){return c in U&&a in U[c]?(b(U[c][a]),!0):!1};a.create_texture=function(b,c){var d=t();d.name=b;d.type=c;d.source="NONE";if(c==a.TT_RB_RGBA||c==a.TT_RB_DEPTH||c==a.TT_RB_RGBA_MS||c==a.TT_RB_DEPTH_MS)d.w_renderbuffer=w.createRenderbuffer();
else{var e=w.TEXTURE_2D,h=w.createTexture();w.bindTexture(e,h);w.texParameteri(e,w.TEXTURE_MAG_FILTER,w.LINEAR);w.texParameteri(e,w.TEXTURE_MIN_FILTER,w.LINEAR);w.texParameteri(e,w.TEXTURE_WRAP_S,w.CLAMP_TO_EDGE);w.texParameteri(e,w.TEXTURE_WRAP_T,w.CLAMP_TO_EDGE);w.bindTexture(e,null);d.w_target=e;d.w_texture=h}return d};a.create_cubemap_texture=function(b,c){var d=w.createTexture(),e=w.TEXTURE_CUBE_MAP;w.bindTexture(e,d);w.texParameteri(e,w.TEXTURE_MAG_FILTER,w.LINEAR);w.texParameteri(e,w.TEXTURE_MIN_FILTER,
w.LINEAR);w.texParameteri(e,w.TEXTURE_WRAP_S,w.CLAMP_TO_EDGE);w.texParameteri(e,w.TEXTURE_WRAP_T,w.CLAMP_TO_EDGE);for(var h="TEXTURE_CUBE_MAP_POSITIVE_X TEXTURE_CUBE_MAP_NEGATIVE_X TEXTURE_CUBE_MAP_POSITIVE_Y TEXTURE_CUBE_MAP_NEGATIVE_Y TEXTURE_CUBE_MAP_POSITIVE_Z TEXTURE_CUBE_MAP_NEGATIVE_Z".split(" "),f=0;6>f;f++)w.texImage2D(w[h[f]],0,w.RGBA,c,c,0,w.RGBA,w.UNSIGNED_BYTE,null);w.bindTexture(e,null);e=t();e.name=b;e.type=a.TT_RGBA_INT;e.source="NONE";e.width=3*c;e.height=2*c;e.compress_ratio=1;e.w_texture=
d;e.w_target=w.TEXTURE_CUBE_MAP;return e};a.set_filters=function(a,b,c){if(!A(a)){var d=a.w_target;w.bindTexture(d,a.w_texture);b&&w.texParameteri(d,w.TEXTURE_MIN_FILTER,b);c&&w.texParameteri(d,w.TEXTURE_MAG_FILTER,c);w.bindTexture(d,null)}};a.get_filters=function(b){if(A(b))return{min:a.TF_NEAREST,mag:a.TF_NEAREST};var c=b.w_target;w.bindTexture(c,b.w_texture);b=w.getTexParameter(c,w.TEXTURE_MIN_FILTER);var d=w.getTexParameter(c,w.TEXTURE_MAG_FILTER);w.bindTexture(c,null);return{min:b,mag:d}};a.resize=
function(b,c,d){c=Math.max(c,x.edge_min_tex_size_hack?2:1);d=Math.max(d,x.edge_min_tex_size_hack?2:1);if(b.width!=c||b.height!=d){switch(b.type){case a.TT_RB_RGBA:w.bindRenderbuffer(w.RENDERBUFFER,b.w_renderbuffer);w.renderbufferStorage(w.RENDERBUFFER,w.RGB565,c,d);w.bindRenderbuffer(w.RENDERBUFFER,null);break;case a.TT_RB_DEPTH:w.bindRenderbuffer(w.RENDERBUFFER,b.w_renderbuffer);w.renderbufferStorage(w.RENDERBUFFER,w.DEPTH_COMPONENT16,c,d);w.bindRenderbuffer(w.RENDERBUFFER,null);break;case a.TT_RB_RGBA_MS:w.bindRenderbuffer(w.RENDERBUFFER,
b.w_renderbuffer);w.renderbufferStorageMultisample(w.RENDERBUFFER,x.msaa_samples,w.RGBA8,c,d);w.bindRenderbuffer(w.RENDERBUFFER,null);break;case a.TT_RB_DEPTH_MS:w.bindRenderbuffer(w.RENDERBUFFER,b.w_renderbuffer);w.renderbufferStorageMultisample(w.RENDERBUFFER,x.msaa_samples,w.DEPTH_COMPONENT24,c,d);w.bindRenderbuffer(w.RENDERBUFFER,null);break;default:var e=b.w_target;w.bindTexture(e,b.w_texture);var g=f(b),k=h(b),l=n(b);w.texImage2D(e,0,k,c,d,0,g,l,null);w.bindTexture(e,null)}c>x.max_texture_size||
d>x.max_texture_size?E.error('Slink texture "'+b.name+'" has unsupported size: '+c+"x"+d+". Max available: "+x.max_texture_size+"x"+x.max_texture_size+"."):(b.width=c,b.height=d)}};a.create_texture_bpy=c;a.update_video_texture=k;a.update_seq_video_texture=d;a.update_texture=function(a,b,c,d,e){var h=a.source,f=a.w_texture,k=a.w_target,m=1,n=1;w.bindTexture(k,f);if(4==b.length){var z=!0;b=new Uint8Array([255*b[0],255*b[1],255*b[2],255*b[3]])}if("IMAGE"==h)if(z)w.texImage2D(k,0,w.RGBA,1,1,0,w.RGBA,
w.UNSIGNED_BYTE,b),a.width=1,a.height=1;else if(c){n=u.get_width_height(b);z=J.check_npot(n.width)||J.check_npot(n.height);if(n.width>x.max_texture_size||n.height>x.max_texture_size){E.error('Texture "'+d+'" has unsupported size: '+n.width+"x"+n.height+". Max available: "+x.max_texture_size+"x"+x.max_texture_size+".");return}m=n.width;n=n.height;z&&(a.need_resize=!0,r(k),m=C(m*a.scale_fac),n=C(n*a.scale_fac));u.upload_dds_levels(w,K.get_s3tc(),b,!0);a.need_resize&&(q(a,null,m,n,!0),w.bindTexture(k,
f),w.generateMipmap(k));a.width=m;a.height=n;a.compress_ratio=u.get_compress_ratio(b)}else{w.pixelStorei(w.UNPACK_FLIP_Y_WEBGL,!0);a.is_movie?x.seq_video_fallback?(m=b[0].width,n=b[0].height):(m=b.videoWidth,n=b.videoHeight):(m=b.width,n=b.height);a.width=m;a.height=n;if(m>x.max_texture_size||m>x.max_texture_size)E.warn('Texture "'+d+'" has unsupported size: '+m+"x"+n+". Max available: "+x.max_texture_size+"x"+x.max_texture_size+". Reduced image size will be used."),a.scale_fac=Math.min(x.max_texture_size/
m,x.max_texture_size/n),a.need_resize=!0;a.is_movie&&(x.seq_video_fallback?(e in T||(T[e]={}),T[e][a.name]=a,a.seq_video=b,a.seq_movie_length=b.length,a.fps=a.seq_fps*a.movie_length/b.length,b=b[0]):(e in T||(T[e]={}),T[e][a.name]=a,a.video_file=b,a.video_file.loop=a.use_cyclic,a.fps=b.duration?a.movie_length/b.duration:M.get_framerate(),H.disable_playback_rate_hack||(b.playbackRate=M.get_framerate()/a.fps,H.clamp_playback_rate_hack&&2<b.playbackRate&&(b.playbackRate=2)),g(a)));m=C(a.width*a.scale_fac);
n=C(a.height*a.scale_fac);a.need_resize?(d=l(),f=d.getContext("2d"),d.width=m,d.height=n,f.drawImage(b,0,0,a.width,a.height,0,0,m,n),w.texImage2D(k,0,w.RGBA,w.RGBA,w.UNSIGNED_BYTE,d)):J.check_npot(a.width)||J.check_npot(a.height)?(q(a,b,m,n,!1),a.need_resize=!0):w.texImage2D(k,0,w.RGBA,w.RGBA,w.UNSIGNED_BYTE,b);f=a.w_texture;w.bindTexture(k,f);a.is_movie||w.generateMipmap(k);w.bindTexture(k,null);a.width=m;a.height=n}else if("ENVIRONMENT_MAP"==h)if(n=[["POSITIVE_X",2,0],["NEGATIVE_X",0,0],["POSITIVE_Y",
1,1],["NEGATIVE_Y",0,1],["POSITIVE_Z",1,0],["NEGATIVE_Z",2,1]],z){for(m=0;6>m;m++)w.texImage2D(w["TEXTURE_CUBE_MAP_"+n[m][0]],0,w.RGBA,1,1,0,w.RGBA,w.UNSIGNED_BYTE,b);a.width=3;a.height=2}else{w.pixelStorei(w.UNPACK_FLIP_Y_WEBGL,!1);if(b.width%3||b.height%2){E.error('Cubemap texture "'+d+'" has unsupported size: '+b.width+"x"+b.height+". The width must be multiple of three and the height - multiple of two.");return}m=b.width/3;if(m>x.max_cube_map_size)E.warn('Cubemap texture "'+d+'" has unsupported size: '+
b.width+"x"+b.height+". Max available: "+3*x.max_cube_map_size+"x"+2*x.max_cube_map_size+". Reduced image size will be used."),d=C(x.max_cube_map_size/m*m),a.need_resize=!0;else if(d=C(m),3*d>x.max_texture_size||2*d>x.max_texture_size)a.need_resize=!0;if(a.need_resize||x.resize_cubemap_canvas_hack)for(f=d,z=0;6>z;z++)c=n[z],e=l(),e.width=f,e.height=f,h=e.getContext("2d"),"POSITIVE_Y"==c[0]||"NEGATIVE_Y"==c[0]?(h.translate(0,f),h.scale(1,-1)):(h.translate(f,0),h.scale(-1,1)),h.drawImage(b,c[1]*m,c[2]*
m,m,m,0,0,f,f),w.texImage2D(w["TEXTURE_CUBE_MAP_"+c[0]],0,w.RGBA,w.RGBA,w.UNSIGNED_BYTE,e);else{n=b;b=d;r(w.TEXTURE_2D);w.texImage2D(w.TEXTURE_2D,0,w.RGBA,w.RGBA,w.UNSIGNED_BYTE,n);w.bindTexture(w.TEXTURE_2D,null);for(n=0;6>n;n++)w.texImage2D(w.TEXTURE_CUBE_MAP_POSITIVE_X+n,0,w.RGBA,b,b,0,w.RGBA,w.UNSIGNED_BYTE,null);w.bindTexture(a.w_target,null);w.bindFramebuffer(w.FRAMEBUFFER,aa);for(n=0;6>n;n++)O.draw_resized_cubemap_texture(a,w.TEXTURE_CUBE_MAP_POSITIVE_X+n,b,m,I,n);w.bindFramebuffer(w.FRAMEBUFFER,
null);w.bindTexture(a.w_target,a.w_texture);w.texParameteri(a.w_target,w.TEXTURE_MIN_FILTER,fa[x.texture_min_filter]);w.texParameteri(a.w_target,w.TEXTURE_MAG_FILTER,w.LINEAR)}a.width=3*d;a.height=2*d;w.generateMipmap(k)}else"DATA_TEX2D"==h&&(w.texImage2D(k,0,w.RGBA,b.width,b.height,0,w.RGBA,w.UNSIGNED_BYTE,b.data),a.width=b.width,a.height=b.height);w.bindTexture(k,null)};a.delete_texture=function(a){w.deleteTexture(a)};a.is_texture=function(a){return a&&a.name&&(a.w_texture||a.w_renderbuffer)?!0:
!1};a.is_renderbuffer=A;a.is_float=function(b){return b.type==a.TT_RGBA_FLOAT||b.type==a.TT_RGB_FLOAT?!0:!1};a.get_texture_texel_size=function(b){var c=0;switch(b.type){case a.TT_RGBA_INT:case a.TT_RGB_INT:c=4;break;case a.TT_RGBA_FLOAT:case a.TT_RGB_FLOAT:c=16;break;case a.TT_DEPTH:c=3;break;case a.TT_RB_RGBA:case a.TT_RB_DEPTH:c=2;break;case a.TT_RB_RGBA_MS:c=4*x.msaa_samples;break;case a.TT_RB_DEPTH_MS:c=3*x.msaa_samples}return c};a.generate_texture=function(a,b){var d=null;switch(a){case "SSAO_TEXTURE":d=
{name:"special_ssao_texture",type:"DATA_TEX2D",extension:"REPEAT",b4w_anisotropic_filtering:"OFF"},c(d,null,b,0),d.image={filepath:null}}return d};a.cleanup=function(){if(!x.seq_video_fallback)for(var a in T)for(var b in T[a])T[a][b].video_file.pause(),T[a][b].video_file.src="",T[a][b].video_file.load();U={};T={}};a.pause=function(){for(var a in T)for(var b in T[a]){var c=T[a][b];e(c)&&(F(b,a),c.video_was_stopped=!0)}};a.reset=function(){for(var a in T)for(var b in T[a])D(b,a),T[a][b].video_was_stopped=
!1};a.play=function(a){for(var b in T)for(var c in T[b]){var d=T[b][c];if(!a||d.video_was_stopped)B(c,b),d.video_was_stopped=!1}};a.video_allow_nla=function(a,b){return b in T&&a in T[b]?T[b][a].use_nla:!1};a.play_video=B;a.pause_video=F;a.reset_video=D;a.set_frame_video=function(a,b,c){return c in T&&a in T[c]?(a=T[c][a],a.video_file?a.video_file.currentTime=b/a.fps:a.seq_video&&(a.seq_cur_frame=b,d(a)),!0):!1};a.video_is_played=e;a.video_update_is_available=function(a){return a.video_file||a.seq_video?
a.video_file?2<=a.video_file.readyState:!0:0};a.video_get_current_frame=function(a){return a.video_file||a.seq_video?a.video_file?Math.round(a.video_file.currentTime*a.fps):a.seq_cur_frame:0};a.video_get_start_frame=function(a){return a.video_file||a.seq_video?a.video_file?a.frame_offset:z(a,a.frame_offset):0};a.video_get_end_frame=function(a){if(!a.video_file&&!a.seq_video)return 0;var b=Math.min(a.frame_duration,a.movie_length-a.frame_offset);return a.video_file?a.frame_offset+b:z(a,a.frame_offset+
b)};a.seq_video_get_discrete_timemark=function(a,b){return Math.round(b*a.seq_fps*(M.get_framerate()/a.fps))};a.video_get_duration=function(a){return Math.min(a.frame_duration,a.movie_length-a.frame_offset)};a.video_frame_to_seq_frame=z;a.get_canvas_context_by_object=function(a,b){var c=y(a,b);return c&&"CANVAS"==c.source?c.canvas_context:null};a.update_canvas_context_by_object=function(a,c){var d=y(a,c);return d&&"CANVAS"==d.source?(b(d),!0):!1};a.share_batch_canvas_textures=function(a){for(var c=
{},d=0;d<a.length;d++){for(var e=a[d].textures,h=[],f=0;f<e.length;f++){var g=e[f];if("CANVAS"==g.source)if(g.name in c)g=c[g.name];else{var k=e[f],g=t();g.name=k.name;g.source="CANVAS";g.width=k.width;g.height=k.height;g.enable_canvas_mipmapping=k.enable_canvas_mipmapping;g.type=k.type;k=document.createElement("canvas");k.width=g.width;k.height=g.height;g.canvas_context=k.getContext("2d");g.w_target=w.TEXTURE_2D;g.w_texture=w.createTexture();w.bindTexture(w.TEXTURE_2D,g.w_texture);g.enable_canvas_mipmapping?
w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MIN_FILTER,fa[x.texture_min_filter]):w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MIN_FILTER,w.LINEAR);w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MAG_FILTER,w.LINEAR);w.bindTexture(w.TEXTURE_2D,null);k=g;k.canvas_context.drawImage(e[f].canvas_context.canvas,0,0);b(k);c[g.name]=g}h.push(g)}a[d].textures=h}}};b4w.module.__assets=function(a,p){function t(){return A.is_built_in_data()?p(A.paths.built_in_data_module).data:null}function c(){var a={_source_url:null,_parse_response:function(b){switch(a.responseType){case "json":case "text":return b;case "arraybuffer":b=atob(b);for(var c=b.length,d=new Int8Array(c),e=0;e<c;e++)d[e]=b.charCodeAt(e);return d.buffer;default:return b}},status:0,readyState:0,response:"",responseType:"",onreadystatechange:null,overrideMimeType:function(){},addEventListener:function(){},
open:function(b,c,d){a._source_url=c;a.readyState=1},send:function(){a.status=404;a.readyState=4;var b=t();b&&a._source_url in b&&(a.status=200,b[a._source_url]&&(a.response=a._parse_response(b[a._source_url])));if("[object Function]"==={}.toString.call(a.onreadystatechange))a.onreadystatechange()}};return a}function b(b){for(var c=0,h=0;h<b.length;h++){var f=b[h];20===f.state&&c++;if(c>=v.max_requests)break;if(10===f.state)switch(f.state=20,c++,f.type){case a.AT_ARRAYBUFFER:k(f,"arraybuffer");break;
case a.AT_JSON:k(f,"json");break;case a.AT_TEXT:k(f,"text");break;case a.AT_AUDIOBUFFER:d(f);break;case a.AT_IMAGE_ELEMENT:l(f);break;case a.AT_AUDIO_ELEMENT:q(f);break;case a.AT_VIDEO_ELEMENT:r(f);break;case a.AT_SEQ_VIDEO_ELEMENT:g(f);break;default:e.panic("Wrong asset type: "+f.type)}}}function k(b,d){var e=t(),h=e&&b.url in e?new c:new XMLHttpRequest;if("GET"==b.request)h.open("GET",b.url,!0);else if("POST"==b.request)switch(h.open("POST",b.url,!0),b.post_type){case a.APT_TEXT:h.setRequestHeader("Content-type",
"text/plain");break;case a.APT_JSON:h.setRequestHeader("Content-type","application/json")}"text"==d?(h.overrideMimeType("text/plain"),h.responseType="text"):"json"==d?(h.overrideMimeType("application/json"),h.responseType="text"):h.responseType=d;h.onreadystatechange=function(){if(40!=b.state&&4==h.readyState){if(200==h.status||0==h.status){var a=h.response;if(a){if("json"==d&&"string"==typeof a)try{a=JSON.parse(a,b.json_reviver)}catch(c){F.error(c+" (parsing JSON "+b.url+")");b.asset_cb(null,b.id,
b.type,b.url,b.param);return}b.asset_cb(a,b.id,b.type,b.url,b.param)}else F.error("empty responce when trying to get "+b.url),b.asset_cb(null,b.id,b.type,b.url,b.param)}else F.error(h.status+" when trying to get "+b.url),b.asset_cb(null,b.id,b.type,b.url,b.param);b.state=30}};h.addEventListener("progress",function(a){a.lengthComputable&&b.progress_cb(a.loaded/a.total)},!1);h.send(b.post_data)}function d(a){"GET"!=a.request&&e.panic("Unsupported request type for audio buffer");var b=t(),d=b&&a.url in
b?new c:new XMLHttpRequest;d.open("GET",a.url,!0);d.responseType="arraybuffer";d.onreadystatechange=function(){if(40!=a.state&&4==d.readyState)if(200==d.status||0==d.status){var b=d.response;b?D.decode_audio_data(b,function(b){a.asset_cb(b,a.id,a.type,a.url,a.param);a.state=30},function(){a.asset_cb(null,a.id,a.type,a.url,a.param);F.error("failed to decode "+a.url);a.state=30}):(a.asset_cb(null,a.id,a.type,a.url,a.param),F.error("empty responce when trying to get "+a.url),a.state=30)}else a.asset_cb(null,
a.id,a.type,a.url,a.param),F.error(d.status+" when trying to get "+a.url),a.state=30};d.send(a.post_data)}function l(a){"GET"!=a.request&&e.panic("Unsupported request type for image element");var b=document.createElement("img");y.allow_cors&&(b.crossOrigin="Anonymous");b.onload=function(){40!=a.state&&(a.asset_cb(b,a.id,a.type,a.url,a.param),a.state=30)};b.addEventListener("error",function(){40!=a.state&&(a.asset_cb(null,a.id,a.type,a.url,a.param),F.error("could not load image: "+a.url),a.state=30)},
!1);var c=t();if(c&&a.url in c)if(c[a.url]){var d=f(a.url);b.src="data:"+d+";base64,"+c[a.url]}else B.is_ie11()?(c=document.createEvent("CustomEvent"),c.initCustomEvent("error",!1,!1,null)):c=new CustomEvent("error"),b.dispatchEvent(c);else b.src=a.url}function q(a){"GET"!=a.request&&e.panic("Unsupported request type for audio element");var b=document.createElement("audio");if(y.allow_cors||y.cors_chrome_hack)b.crossOrigin="Anonymous";b.addEventListener("loadeddata",function(){40!=a.state&&(a.asset_cb(b,
a.id,a.type,a.url,a.param),a.state=30)},!1);b.addEventListener("error",function(){40!=a.state&&(a.asset_cb(null,a.id,a.type,a.url,a.param),F.error("could not load sound: "+a.url),a.state=30)},!1);b.addEventListener("stalled",function(){40!=a.state&&(a.asset_cb(null,a.id,a.type,a.url,a.param),F.error("could not load sound: "+a.url),a.state=30)},!1);var c=t();if(c&&a.url in c)if(c[a.url]){var d=h(a.url);b.src="data:"+d+";base64,"+c[a.url];40!=a.state&&(a.asset_cb(b,a.id,a.type,a.url,a.param),a.state=
30)}else B.is_ie11()?(c=document.createEvent("CustomEvent"),c.initCustomEvent("error",!1,!1,null)):c=new CustomEvent("error"),b.dispatchEvent(c);else b.src=a.url,y.is_mobile_device&&b.load();y.mobile_firefox_media_hack&&(b.autoplay=!0,b.pause());setTimeout(function(){b.some_prop_to_prevent_gc=1},5E3)}function r(a){function b(c){40!=a.state&&(a.asset_cb(null,a.id,a.type,a.url),F.error("could not load video: "+a.url,a.param),a.state=30)}"GET"!=a.request&&e.panic("Unsupported request type for video element");
var c=document.createElement("video");c.muted=!0;if(y.allow_cors||y.is_mobile_device)c.crossOrigin="Anonymous";c.addEventListener("loadeddata",function(){c.removeEventListener("error",b,!1);40!=a.state&&(a.asset_cb(c,a.id,a.type,a.url,a.param),a.state=30)},!1);c.addEventListener("error",b,!1);var d=t();if(d&&a.url in d)if(d[a.url]){var h=n(a.url);c.src="data:"+h+";base64,"+d[a.url];40!=a.state&&c.addEventListener("loadeddata",function(){a.asset_cb(c,a.id,a.type,a.url,a.param);a.state=30},!1)}else B.is_ie11()?
(d=document.createEvent("CustomEvent"),d.initCustomEvent("error",!1,!1,null)):d=new CustomEvent("error"),c.dispatchEvent(d);else c.src=a.url,y.is_mobile_device&&c.load();y.mobile_firefox_media_hack&&(c.autoplay=!0,c.pause());setTimeout(function(){c.some_prop_to_prevent_gc=1},1E4)}function g(b){function d(a){b.asset_cb(a,b.id,b.type,b.url,b.param);b.state=30}"GET"!=b.request&&e.panic("Unsupported request type for seq video element");var h=t(),f=h&&b.url in h?new c:new XMLHttpRequest;if(null==b.post_type&&
null==b.post_data)f.open("GET",b.url,!0);else switch(f.open("POST",b.url,!0),b.post_type){case a.APT_TEXT:f.setRequestHeader("Content-type","text/plain");break;case a.APT_JSON:f.setRequestHeader("Content-type","application/json")}f.responseType="arraybuffer";f.onreadystatechange=function(){if(40!=b.state&&4==f.readyState)if(200==f.status||0==f.status){var a=f.response;a?C(a,d):(b.asset_cb(null,b.id,b.type,b.url,b.param),F.error("empty responce when trying to get "+b.url),b.state=30)}else b.asset_cb(null,
b.id,b.type,b.url,b.param),F.error(f.status+" when trying to get "+b.url),b.state=30};f.addEventListener("progress",function(a){a.lengthComputable&&b.progress_cb(a.loaded/a.total)},!1);f.send(b.post_data)}function C(a,b){for(var c=new Int32Array(a),d=new Int8Array(a),e=c[3],h={images:[],blobs:[],fps:c[4]},f=20,g=0;g<e;g++){var k=c[f/4],m=d.subarray(f+4,f+4+k),m=new Blob([m],{type:"image/jpg"}),l=document.createElement("img");l.src=window.URL.createObjectURL(m);h.images.push(l);h.blobs.push(m);f+=
k+8-k%4}l.onload=function(){for(var a=0;a<h.images.length;a++)window.URL.revokeObjectURL(h.images[a].src);delete h.blobs;b(h)}}function f(a){var b="image";switch(e.get_file_extension(a).toLowerCase()){case "jpeg":case "jpg":b+="/jpeg";break;case "png":b+="/png"}return b}function h(a){var b="audio";switch(e.get_file_extension(a).toLowerCase()){case "ogv":case "ogg":b+="/ogg";break;case "mp3":b+="/mpeg";break;case "m4v":case "mp4":b+="/mp4";break;case "webm":b+="/webm"}return b}function n(a){var b=
"video";switch(e.get_file_extension(a).toLowerCase()){case "ogv":b+="/ogg";break;case "webm":b+="/webm";break;case "m4v":b+="/mp4"}return b}var A=p("__config"),B=p("__compat"),F=p("__print"),D=p("__sfx"),e=p("__util"),z=p("__version"),y=A.defaults,v=A.assets;a.AT_ARRAYBUFFER=10;a.AT_JSON=20;a.AT_TEXT=30;a.AT_AUDIOBUFFER=40;a.AT_IMAGE_ELEMENT=50;a.AT_AUDIO_ELEMENT=60;a.AT_VIDEO_ELEMENT=70;a.AT_SEQ_VIDEO_ELEMENT=80;a.APT_JSON=a.AT_JSON;a.APT_TEXT=a.AT_TEXT;var m=[],u=0,K={};a.split_extension=function(a){a=
a.split(".");var b=Array(2);b[0]=a.slice(0,-1).join(".");b[1]=String(a.slice(-1));return b};a.get_text_sync=function(a){if(K[a])return K[a];var b=v.prevent_caching?a+z.timestamp():a,c=new XMLHttpRequest;c.overrideMimeType("text/plain");c.open("GET",b,!1);c.send(null);if(200==c.status||0==c.status){b=c.responseText;if(b.length)return K[a]=b;e.panic("Error XHR: responce is empty, GET "+a)}else e.panic("Error XHR: "+c.status+", GET "+a)};a.cleanup=function(){for(var a=0;a<m.length;a++)m[a].state=40;
m=[];u=0;K={}};a.enqueue=function(a,c,d,e,h){for(var f=0;f<a.length;f++){var g=a[f],g={id:g.id,type:g.type,url:g.url,request:g.request?g.request:"GET",post_type:g.post_type?g.post_type:null,post_data:g.post_data?g.post_data:null,param:g.param?g.param:null,state:10,asset_cb:c||function(){},pack_cb:d||function(){},progress_cb:e||function(){},json_reviver:h||null,pack_index:u};if(v.prevent_caching){var k=t();k&&g.url in k||(g.url+=z.timestamp())}m.push(g)}b(m);u++};a.update=function(){b(m);for(var a=
m,c=0,d=!0,e=0;e<a.length;e++){var h=a[e];h.pack_index===a[c].pack_index?30!==h.state&&(d=!1):(d&&(a[e-1].pack_cb(),d=e-c,a.splice(c,d),e-=d),c=e,d=30===a[e].state?!0:!1);e===a.length-1&&d&&(a[e].pack_cb(),a.splice(c))}}};b4w.module.__loader=function(a,p){function t(b,d,f,g){var k=e,l=B.create(),n;for(n in d){var q=c(d[n]);(g&&q.is_resource||!b&&q.primary_only)&&h(q);B.append_node_attr(l,q)}for(n in d)for(q=d[n],q.name=n,b=0;b<q.inputs.length;b++)B.append_edge_attr(l,d[q.inputs[b]],q,null);d=c({name:"out",priority:a.FINISH_PRIORITY,cb_before:function(a,b,c,d,e,h){b.is_primary&&(k.start_secondary_threads=!0);A(b)||(b.status=2);b.loaded_cb(b.id,!0);e(b,c);F.log("%cTHREAD "+b.id+": LOADED CALLBACK","color: #f0f;")},relative_size:5});
if(f)f=B.get_sink_nodes(l);else{n=B.clone(l);do{f=B.get_sink_nodes(n);q=[];for(b=0;b<f.length;b++){g=f[b];var r=B.get_node_attr(n,g);r.background_loading&&q.push(g)}for(b=0;b<q.length;b++)B.remove_node(n,q[b]);q.length&&B.cleanup_loose_edges(n)}while(q.length)}B.append_node_attr(l,d);for(b=0;b<f.length;b++)g=f[b],r=B.get_node_attr(l,g),d.inputs.push(r.name),B.append_edge_attr(l,r,d,null);return l}function c(a){a.background_loading=a.background_loading||!1;a.priority||0===a.priority||(a.priority=a.SYNC_PRIORITY);
a.inputs=a.inputs||[];a.is_finished=a.is_finished||!1;a.skip=a.skip||!1;a.relative_size=a.relative_size||0;a.is_resource=a.is_resource||!1;a.primary_only=a.primary_only||!1;a.status=0;a.loop_index=0;a.load_rate=0;a.cb_param=a.cb_param||null;return a}function b(a,b,c){b.complete_load_cb(c,b);b.status=3;a.active_threads--;b.stageload_cb=null;b.complete_load_cb=null;b.stage_graph=null;b.stages_queue=null}function k(a,b){for(var c=[],d=[],e=0;e<b.length;e++){var h=b[e];B.get_node_attr(a.stage_graph,h).is_finished&&
(B.traverse_outputs(a.stage_graph,h,function(d,e,h){var f=!0;B.traverse_inputs(a.stage_graph,d,function(a,b,c){if(!b.is_finished)return f=!1,1});f&&-1==c.indexOf(d)&&-1==b.indexOf(d)&&c.push(d)}),d.push(e))}for(e=d.length-1;0<=e;e--)b.splice(d[e],1);return c}function d(a){var b=[],c=a.stages_queue,d=!1;do{var e=k(a,c);b.push.apply(b,c);0<e.length&&(d=!0);c=e}while(0<e.length);c=function(b,c){var d=B.get_node_attr(a.stage_graph,b),e=B.get_node_attr(a.stage_graph,c),h=e.priority-d.priority;0==h&&(h=
d.background_loading-e.background_loading);return h};d&&b.sort(c);a.stages_queue=b;return a.stages_queue.length}function l(a,b,c){if(b.skip)return b.is_finished=!0,r(a,b),!1;if(!b.cb_before&&!b.cb_loop&&!b.cb_after)return r(a,b),!1;if(0==b.status&&(b.status++,b.cb_before))return b.cb_before(c,a,b,b.cb_param,r,g),!0;if(1==b.status){if(b.cb_loop)return b.cb_loop(c,a,b,b.cb_param,r,g),!0;b.status++}return 2==b.status&&(b.status++,b.cb_after)?(b.cb_after(c,a,b,b.cb_param,r,g),!0):!1}function q(a){if(0==
a.stages_size_total)return 100;var b=0;B.traverse(a.stage_graph,function(c,d){a.do_not_load_resources&&d.is_resource||(b+=d.load_rate*d.relative_size)});return D.trunc(100*b/a.stages_size_total)}function r(a,b){b.is_finished=!0;b.status=3;C(a,b,1)}function g(a,b,c){1>c?C(a,b,c):b.status++}function C(a,b,c){var d=e;if(b.cb_before||b.cb_loop||b.cb_after)if(b.load_rate=c,b=q(a),a.curr_percents!=b||1==c)a.stageload_cb(b,performance.now()-a.time_load_start),a.curr_percents=b,d.make_idle_iteration=!0}function f(a,
b){var c=null;B.traverse(a.stage_graph,function(a,d){if(d.name==b)return c=d,1});return c}function h(a){a.skip=!0;a.load_rate=1}function n(){return 0==e.active_threads}function A(a){return a&&(3==a.status||4==a.status)}var B=p("__graph"),F=p("__print"),D=p("__util");a.SYNC_PRIORITY=0;a.ASYNC_PRIORITY=1;a.FINISH_PRIORITY=2;var e=null;a.get_scheduler=function(){return e};a.create_scheduler=function(){var a={threads:[],current_thread_index:0,active_threads:0,start_secondary_threads:!1,make_idle_iteration:!1};
return e=a};a.create_thread=function(a,b,c,d,h,f,g,k){var l=e,n=l.threads.length,q={id:n,is_primary:0==n,status:0,filepath:b,binary_name:"",loaded_cb:c||function(){},load_hidden:k||!1,wait_complete_loading:f,time_load_start:0,curr_percents:0,stages_size_total:0,reset_time_cycle:!1,stageload_cb:d||function(){},complete_load_cb:h||function(){},stage_graph:null,stages_queue:null,has_video_textures:!1,has_background_music:!1,init_wa_context:!1};a=t(q.is_primary,a,f,g);q.stage_graph=a;b=[];c=B.get_source_nodes(a);
for(d=0;d<c.length;d++)b.push(c[d]);q.stages_queue=b;B.traverse(a,function(a,b){if(b.cb_before||b.cb_loop||b.cb_after)q.do_not_load_resources&&b.is_resource||(q.stages_size_total+=b.relative_size)});l.threads.push(q);l.active_threads++;return q.id};a.update_scheduler=function(c){var h=e;if(h&&!n(h))if(h.make_idle_iteration)h.make_idle_iteration=!1;else{var f=performance.now();do{var g=h.threads[h.current_thread_index],k=c[g.id];if(!A(g))if(0==g.status&&(g.status=1,g.time_load_start=performance.now(),
g.stageload_cb(0,0)),d(g)){var q=g,r=q.stages_queue.length;do{var p=B.get_node_attr(q.stage_graph,q.stages_queue[0]),C=l(q,p,k);p.priority==a.ASYNC_PRIORITY&&(q.reset_time_cycle=!0);p=q.stages_queue.shift();q.stages_queue.push(p);r--}while(!C&&0!=r)}else b(h,g,k);h.start_secondary_threads&&(h.current_thread_index=(h.current_thread_index+1)%h.threads.length);if(g.reset_time_cycle){g.reset_time_cycle=!1;break}}while(16>performance.now()-f)}};a.abort_thread=function(a){var c=e;b(c,a,null);a.status=4;
a.is_primary&&(c.start_secondary_threads=!0);a.loaded_cb(a.id,!1)};a.stage_part_finish_cb=g;a.skip_stage_by_name=function(a,b){var c=f(a,b);null!==c&&h(c)};a.is_finished=n;a.thread_is_finished=A;a.is_primary_loaded=function(a){var b=e;if(!b)return!1;a|=0;return b.threads[a]&&(3==b.threads[a].status||2==b.threads[a].status)};a.graph_to_dot=function(a){F.error("Debug mode isn't enabled. Can not retrieve the graph.")};a.cleanup=function(){e=null}};b4w.module.__logic_nodes=function(a,p){function t(a,b,c,d,e,h){switch(b.state){case 1:r.error("Unknown node type: "+a.type);break;case 2:c.curr_node=a.slot_idx_order}}function c(a){var b=C.get("url_params");if(b&&a in b)return Number(b[a]);b=location.href.toString();if(-1==b.indexOf("?"))return 0;for(var b=b.split("?")[1].split("&"),c=0;c<b.length;c++){var d=b[c].split("=");if(1<d.length&&d[0]==a)return Number(d[1])}return 0}function b(a){return l.get_object(l.GET_OBJECT_BY_DUPLI_NAME_LIST,a.dupli_name_list,
0)}function k(a,b){var c=a.b4w_logic_nodes,d=b.logic_threads;b.state=1;for(var e=0;e<c.length;e++){var h={nodes:[],thread_state:{scene:a,curr_node:0,in_progress:!1,thread_index:e,variables:{R1:0,R2:0,R3:0,R4:0,R5:0,R6:0,R7:0,R8:0}}};d.push(h);for(var f=d[d.length-1],g=c[e],k=0;k<g.length;k++){var l=g[k],l={type:l.type,label:l.label,slot_idx_order:l.slot_idx_order,slot_idx_jump:l.slot_idx_jump,frame_start:l.frame_range[0],frame_end:l.frame_range[1],frame_start_mask:l.frame_range_mask?l.frame_range_mask[0]:
!0,frame_end_mask:l.frame_range_mask?l.frame_range_mask[1]:!0,state:-1,sel_objs_len:-1,sel_obj_idx:-1,var1:l.variable1,var2:l.variable2,inp1:l.input1,inp2:l.input2,vard:l.variabled,url:l.url,param_name:l.param_name,op:l.operation,mute:l.mute,dupli_name_list:l.object,obj:null,objects:{},anim_name:l.anim_name,parse_resp_list:l.parse_resp_list,objects_paths:l.objects_paths,nodes_paths:l.nodes_paths,floats:l.floats,bools:l.bools,vars:l.variables,strings:l.strings,materials_names:l.materials_names,shader_nd_type:l.shader_nd_type,
common_usage_names:l.common_usage_names,send_req_vars_list:l.send_req_vars_list,thread:f,process_node:aa[l.type]?aa[l.type]:t,processed:!1,timer:0,tmp1:0,camera_state:null,sel_obj_idxs:null,links_dict:l.links,links_idxs:[]};f.nodes.push(l)}for(g=0;g<f.nodes.length;g++)l=f.nodes[g],l.process_node(l,b,h.thread_state,0,0)}var c=a.timeline_markers,m;for(m in c)b.sorted_markers_values.push(c[m]);b.sorted_markers_values.sort(function(a,b){return a-b});b.state=2;J.push(b)}function d(a,b){switch(b){case 0:return Boolean(Number(a))?
Number(a):0;case 1:return String(a);default:return null}}var l=p("__objects");p("__obj_util");var q=p("__scenes"),r=p("__print"),g=p("__nla"),C=p("__config"),f=p("__controls"),h=p("__util"),n=p("__animation"),A=p("__assets"),B=p("__batch"),F=p("__geometry"),D=p("__time"),e=p("__camera"),z=p("__vec3");p("__vec4");var y=p("__physics"),v=p("__transform"),m=p("__sfx");p("__constraints");var u=p("__mat3"),K=p("__mat4"),E=p("__tsr"),M=p("__quat"),J=[],O=new Float32Array(4);new Float32Array(4);var G=new Float32Array(3),
x=new Float32Array(3),H=new Float32Array(2),P=new Float32Array(9),I=new Float32Array(16),aa={ENTRYPOINT:function(a,b,c,d,e,h){switch(b.state){case 2:c.curr_node=a.slot_idx_order}},HIDE:function(a,c,d,e,h,f){switch(c.state){case 1:a.obj=b(a);break;case 2:q.change_visibility(a.obj,!0),d.curr_node=a.slot_idx_order}},SHOW:function(a,c,d,e,h,f){switch(c.state){case 1:a.obj=b(a);break;case 2:q.change_visibility(a.obj,!1),d.curr_node=a.slot_idx_order}},PAGEPARAM:function(a,b,d,e,h,f){switch(b.state){case 2:d.variables[a.vard]=
c(a.param_name),d.curr_node=a.slot_idx_order}},SWITCH_SELECT:function(a,b,c,d,e,h){switch(b.state){case 1:a:{c=b.logic_threads[c.thread_index];d=l.get_selectable_objects();a.sel_obj_idxs=[];a.links_idxs=[];for(var g in a.objects_paths){var k=l.get_object(l.GET_OBJECT_BY_DUPLI_NAME_LIST,a.objects_paths[g],0);e=d.indexOf(k);if(-1==e){r.error("logic script error: non-selectable object:",a.objects_paths[g][a.objects_paths[g].length-1]);break a}a.sel_obj_idxs.push(e);a.links_idxs.push(a.links_dict[g])}a.state=
-1;a.sel_objs_len=d.length;g=[];for(e=0;e<d.length;e++)g.push(f.create_selection_sensor(d[e],!0));d=T();f.create_sensor_manifold(k,"LOGIC_NODES_SWITCH_SELECT_"+a.label,f.CT_SHOT,g,f.default_OR_logic_fun,d,[a,b,c])}break;case 2:if(-1==a.state){b=b.logic_threads[c.thread_index].nodes;for(k=0;k<b.length;k++)g=b[k],"SWITCH_SELECT"==g.type&&(g.state=-1);a.state=-2}-1<a.state&&(c.curr_node=a.state?a.slot_idx_jump:a.slot_idx_order,a.state=-1)}},SELECT:function(a,c,d,e,h,g){switch(c.state){case 1:d=c.logic_threads[d.thread_index];
e=b(a);h=l.get_selectable_objects();g=h.indexOf(e);if(-1==g)r.error("logic script error: non-selectable object:",a.dupli_name_list[a.dupli_name_list.length-1]);else{a.state=-1;a.sel_objs_len=h.length;a.sel_obj_idx=g;g=[];for(var k=0;k<h.length;k++)g.push(f.create_selection_sensor(h[k],!0));h=U();f.create_sensor_manifold(e,"LOGIC_NODES_SELECT_"+a.label,f.CT_SHOT,g,f.default_OR_logic_fun,h,[a,c,d])}break;case 2:if(-1<a.state){d.curr_node=a.state?a.slot_idx_jump:a.slot_idx_order;a.state=-1;break}a.bools.not_wait&&
(d.curr_node=a.slot_idx_order)}},PLAY:function(a,b,c,d,e,f){switch(b.state){case 1:g.stop_nla();a.state=-1;a.bools.not_wait||(a.bools.not_wait=!1);break;case 2:switch(a.state){case -1:if(g.is_play(b._nla))if(b.curr_thread==b.nla_thread&&c.in_progress)break;else if(e=b.nla_thread)for(e.thread_state.curr_node=e.nodes[e.thread_state.curr_node].slot_idx_order,e.nodes[e.thread_state.curr_node].state=-1,e=b.nla_thread.nodes,f=0;f<e.length;f++){var k=e[f];"PLAY"==k.type&&(k.state=-1)}c.in_progress=!a.bools.not_wait;
b.nla_thread=b.curr_thread;a.state=0;a.frame_start_mask&&(g.set_range_start(a.frame_start),g.set_offset_from_range_start(d));if(a.frame_end_mask)g.set_range_end(a.frame_end);else{d=g.get_frame(d);e=-1;for(var l in b.sorted_markers_values)if(d<b.sorted_markers_values[l]){e=l;break}0<=e?g.set_range_end(b.sorted_markers_values[e]):g.set_range_end(g.get_frame_end())}g.play_nla(null);a.bools.not_wait&&(c.curr_node=a.slot_idx_order,a.state=-1,c.in_progress=!1);break;case 0:g.is_play()||(c.curr_node=a.slot_idx_order,
a.state=-1,c.in_progress=!1);break;case 1:c.curr_node=a.slot_idx_order;a.state=-1;b.nla_thread=null;c.in_progress=!1;break;default:h.panic("Unknown state of "+a.name),a.state=-1}}},REDIRECT:function(a,b,c,d,e,h){switch(b.state){case 2:window.location.href=a.url,b.state=3}},MATH:function(a,b,c,e,f,g){switch(b.state){case 2:b=-1==a.var1?a.inp1:d(c.variables[a.var1],0);e=-1==a.var2?a.inp2:d(c.variables[a.var2],0);switch(a.op){case "ADD":c.variables[a.vard]=b+e;break;case "MUL":c.variables[a.vard]=b*
e;break;case "SUB":c.variables[a.vard]=b-e;break;case "DIV":0==e&&h.panic("Division by zero in Logic script");c.variables[a.vard]=b/e;break;case "RAND":c.variables[a.vard]=Math.random()*(e-b)+b}c.curr_node=a.slot_idx_order}},CONDJUMP:function(a,b,c,e,h,f){switch(b.state){case 2:b=-1==a.var1?a.inp1:d(c.variables[a.var1],0);e=-1==a.var2?a.inp2:d(c.variables[a.var2],0);h=!1;switch(a.floats.cnd){case 5:b==e&&(h=!0);break;case 4:b!=e&&(h=!0);break;case 3:b<e&&(h=!0);break;case 2:b>e&&(h=!0);break;case 1:b<=
e&&(h=!0);break;case 0:b>=e&&(h=!0)}c.curr_node=h?a.slot_idx_jump:a.slot_idx_order}},REGSTORE:function(a,b,c,d,e,h){switch(b.state){case 2:c.variables[a.vard]=a.inp1,c.curr_node=a.slot_idx_order}},PLAY_ANIM:function(a,c,d,e,f,g){e=n.SLOT_ALL;""==!a.anim_name&&(e=n.SLOT_0);switch(c.state){case 1:a.obj=b(a);(d=a.common_usage_names.param_anim_behavior)||(d="FINISH_STOP");a.tmp1=n.anim_behavior_bpy_b4w(d);break;case 2:switch(n.is_play(a.obj,e)||0!=a.state||(a.state=1),a.state){case -1:for(var k in c.logic_threads)f=
c.logic_threads[k].thread_state.curr_node,-1!=f&&(f=c.logic_threads[k].nodes[f],"PLAY_ANIM"==f.type&&f!=a&&0==f.state&&f.obj==a.obj&&(f.state=1));if(""==a.anim_name)n.apply_def(a.obj),n.set_behavior(a.obj,a.tmp1,e);else{a:{for(k=c=0;8>k;k++)if((f=a.obj.anim_slots[k])&&f.animation_name&&f.animation_name==a.anim_name)if(0==c)c=1;else{c=!1;break a}c=1==c?!0:!1}c||(n.apply(a.obj,a.anim_name,e),n.set_behavior(a.obj,a.tmp1,e))}a.bools.not_wait||(d.in_progress=!0);n.play(a.obj,null,e);a.state=0;a.bools.not_wait&&
(d.curr_node=a.slot_idx_order,a.state=-1);break;case 0:break;case 1:a.bools.not_wait||(d.in_progress=!1);d.curr_node=a.slot_idx_order;a.state=-1;break;default:h.panic("Unknown state of "+a.name),a.state=-1}}},SELECT_PLAY:function(a,b,c,d,e,h){switch(b.state){case 2:c.curr_node=a.slot_idx_order}},SEND_REQ:function(a,b,c,e,h,f){function g(a,b,c,d,e){if(e[0].bools.prs)for(var h in a)for(var f in e[0].parse_resp_list)h==e[0].parse_resp_list[f]&&(e[1][h]=a[h]);else e[1][e[0].vars.dst]=a;e[0].state=1}function k(a,
b){if(""===a)return b;switch(typeof b){case "string":return d(b,1);case "number":return d(b,0);default:return d(b,1)}}function l(a,b){if(""===a)return b;if(Infinity==b||-Infinity==b)return d(b,1);switch(typeof b){case "string":return d(b,1);case "number":return d(b,0);default:return d(b,1)}}switch(b.state){case 2:switch(a.state){case -1:a.state=0;b=a.bools.prs?A.AT_JSON:A.AT_TEXT;e=a.bools.prs?k:null;if("GET"==a.common_usage_names.request_type)A.enqueue([{id:a.url,type:b,url:a.url,param:[a,c.variables]}],
g,null,null,e);else if("POST"==a.common_usage_names.request_type)if(a.bools.enc){h={};for(f=0;f<a.send_req_vars_list.length;f++){var m=a.send_req_vars_list[f];switch(typeof c.variables[a.send_req_vars_list[f]]){case "string":h[m]=d(c.variables[m],1);break;case "number":h[m]=d(c.variables[m],0);break;default:h[m]=d(c.variables[m],1)}}A.enqueue([{id:a.url,type:b,url:a.url,request:"POST",post_type:A.APT_JSON,post_data:JSON.stringify(h,l),param:[a,c.variables]}],g,null,null,e)}else h=d(c.variables[a.vars.dst1],
1),A.enqueue([{id:a.url,type:b,url:a.url,request:"POST",post_type:A.APT_TEXT,post_data:h,param:[a,c.variables]}],g,null,null,e);break;case 1:a.state=-1,c.curr_node=a.slot_idx_order}}},INHERIT_MAT:function(a,b,c,d,e,h){switch(b.state){case 1:for(b=0;2>b;b++)a.objects["id"+b]=l.get_object(l.GET_OBJECT_BY_DUPLI_NAME_LIST,a.objects_paths["id"+b],0);break;case 2:B.inherit_material(a.objects.id0,a.materials_names.id0,a.objects.id1,a.materials_names.id1),c.curr_node=a.slot_idx_order}},SET_SHADER_NODE_PARAM:function(a,
b,c,e,h,f){switch(b.state){case 1:a.objects_paths.id0&&(a.objects.id0=l.get_object(l.GET_OBJECT_BY_DUPLI_NAME_LIST,a.objects_paths.id0,0),a.nodes_paths.id0.unshift(a.materials_names.id0));break;case 2:"ShaderNodeRGB"==a.shader_nd_type&&l.set_nodemat_rgb(a.objects.id0,a.nodes_paths.id0,a.bools.id0?d(c.variables[a.vars.id0],0):a.floats.id0,a.bools.id1?d(c.variables[a.vars.id1],0):a.floats.id1,a.bools.id2?d(c.variables[a.vars.id2],0):a.floats.id2),"ShaderNodeValue"==a.shader_nd_type&&l.set_nodemat_value(a.objects.id0,
a.nodes_paths.id0,a.bools.id0?d(c.variables[a.vars.id0],0):a.floats.id0),c.curr_node=a.slot_idx_order}},DELAY:function(a,b,c,e,h,f){switch(b.state){case 2:-1==a.state?(a.state=0,a.timer=0,c.in_progress=!0):0==a.state&&(a.timer+=h,(a.bools.dl?d(c.variables[a.vars.dl],0):a.floats.dl)<a.timer&&(a.state=-1,c.curr_node=a.slot_idx_order,c.in_progress=!1))}},APPLY_SHAPE_KEY:function(a,b,c,e,h,f){switch(b.state){case 1:b=a.objects.id0=l.get_object(l.GET_OBJECT_BY_DUPLI_NAME_LIST,a.objects_paths.id0,0);c=
a.common_usage_names.sk;F.check_shape_keys(b)?F.has_shape_key(b,c)||(r.error("Wrong key name:",c),a.mute=!0):(r.error("No shape keys in object:",b.name),a.mute=!0);break;case 2:F.apply_shape_key(a.objects.id0,a.common_usage_names.sk,a.bools.skv?d(c.variables[a.vars.skv],0):a.floats.skv),c.curr_node=a.slot_idx_order}},OUTLINE:function(a,b,c,e,h,f){switch(b.state){case 1:b=a.objects.id0=l.get_object(l.GET_OBJECT_BY_DUPLI_NAME_LIST,a.objects_paths.id0,0);b&&b.render&&b.render.outlining||(r.error("Can't evaluate 'Outline' logic node: wrong object"),
a.mute=!0);break;case 2:b=a.objects.id0;switch(a.common_usage_names.outline_operation){case "PLAY":e=b.render.outline_anim_settings_default;l.apply_outline_anim(b,e.outline_duration,e.outline_period,e.outline_relapses);break;case "STOP":l.clear_outline_anim(b);break;case "INTENSITY":b.render.outline_intensity=a.bools["in"]?d(c.variables[a.vars["in"]],0):a.floats["in"]}c.curr_node=a.slot_idx_order}},MOVE_CAMERA:function(a,b,c,f,g,k){function m(a,b,c,d){switch(e.get_move_style(a)){case e.MS_TARGET_CONTROLS:e.set_trans_pivot(a,
b,c);break;case e.MS_EYE_CONTROLS:case e.MS_STATIC:v.set_tsr(a,d);break;case e.MS_HOVER_CONTROLS:z.sub(c,b,G),z.normalize(G,G),e.set_hover_pivot(a,c),c=b=0,x[0]=G[0],x[1]=0,x[2]=G[2],b=z.dot(x,G),c=Math.acos(b/(z.length(x)*z.length(G))),b=G[2]?Math.atan(G[0]/G[2]):0<G[0]?0:Math.PI,0<G[2]&&0<G[0]?H[1]=-(Math.PI+H[1]):0<G[2]&&0>G[0]?H[1]=-(Math.PI+H[1]):0>G[2]&&0>G[0]?(H[0]+=Math.PI,b=-(Math.PI-b)):0>G[2]&&0<G[0]&&(H[0]+=Math.PI,b-=Math.PI),e.rotate_hover_camera(a,b+Math.PI,-c,!0,!0)}v.update_transform(a);
y.sync_transform(a)}function n(a,b,c,d){K.lookAt(b,c,h.AXIS_Y,I);K.invert(I,I);K.rotateX(I,Math.PI/2,I);u.fromMat4(I,P);M.fromMat3(P,O);M.normalize(O,O);a=E.get_scale(a.render.world_tsr);E.set_sep(b,a,O,d)}switch(b.state){case 1:a.objects.ca=l.get_object(l.GET_OBJECT_BY_DUPLI_NAME_LIST,a.objects_paths.id0,0);a.objects.tr=l.get_object(l.GET_OBJECT_BY_DUPLI_NAME_LIST,a.objects_paths.id1,0);a.objects.ta=l.get_object(l.GET_OBJECT_BY_DUPLI_NAME_LIST,a.objects_paths.id2,0);a.state=-1;a.camera_state={trans_start:new Float32Array(3),
trans_end:new Float32Array(3),interp_trans:new Float32Array(3),target_start:new Float32Array(3),target_end:new Float32Array(3),interp_target:new Float32Array(3),tsr_start:new Float32Array(8),tsr_end:new Float32Array(8),interp_tsr:new Float32Array(8)};break;case 2:var q=a.objects.ca;b=E.get_trans_view(a.objects.tr.render.world_tsr);f=E.get_trans_view(a.objects.ta.render.world_tsr);switch(a.state){case -1:var r=a.bools.dur?d(c.variables[a.vars.dur],0):a.floats.dur;if(0==r){n(q,b,f,a.camera_state.tsr_end);
m(q,b,f,a.camera_state.tsr_end);c.curr_node=a.slot_idx_order;break}c=E.get_trans_view(q.render.world_tsr);z.copy(c,a.camera_state.trans_start);var p=e.get_move_style(q);p==e.MS_HOVER_CONTROLS?z.copy(q.render.hover_pivot,a.camera_state.target_start):p==e.MS_STATIC||p==e.MS_EYE_CONTROLS?(E.copy(q.render.world_tsr,a.camera_state.tsr_start),n(q,b,f,a.camera_state.tsr_end)):z.copy(q.render.pivot,a.camera_state.target_start);z.copy(b,a.camera_state.trans_end);z.copy(f,a.camera_state.target_end);a.state=
0;r=D.animate(0,1,1E3*r,function(b){p==e.MS_STATIC||p==e.MS_EYE_CONTROLS?E.interpolate(a.camera_state.tsr_start,a.camera_state.tsr_end,h.smooth_step(b),a.camera_state.interp_tsr):(a.camera_state.interp_target=z.lerp(a.camera_state.target_start,a.camera_state.target_end,h.smooth_step(b),a.camera_state.interp_target),a.camera_state.interp_trans=z.lerp(a.camera_state.trans_start,a.camera_state.trans_end,h.smooth_step(b),a.camera_state.interp_trans));m(q,a.camera_state.interp_trans,a.camera_state.interp_target,
a.camera_state.interp_tsr);1==b&&(a.state=1)});break;case 1:D.clear_animation(r),a.state=-1,c.curr_node=a.slot_idx_order}}},SET_CAMERA_MOVE_STYLE:function(a,b,c,d,h,f){switch(b.state){case 1:a.tmp1=e.move_style_bpy_to_b4w(a.common_usage_names.camera_move_style);break;case 2:b=q.get_camera(c.scene),e.set_move_style(b,a.tmp1),v.update_transform(b),y.sync_transform(b),c.curr_node=a.slot_idx_order}},MOVE_TO:function(a,b,c,e,f,g){function k(a,b){v.set_tsr(a,b);v.update_transform(a);y.sync_transform(a)}
switch(b.state){case 1:a.objects.ob=l.get_object(l.GET_OBJECT_BY_DUPLI_NAME_LIST,a.objects_paths.id0,0);a.objects.de=l.get_object(l.GET_OBJECT_BY_DUPLI_NAME_LIST,a.objects_paths.id1,0);a.state=-1;a.obj_state={dest_tsr_start:new Float32Array(8),dest_tsr_end:new Float32Array(8),interp_tsr_dest:new Float32Array(8)};break;case 2:var m=a.objects.ob;E.copy(a.objects.ob.render.world_tsr,a.obj_state.dest_tsr_start);E.copy(a.objects.de.render.world_tsr,a.obj_state.dest_tsr_end);switch(a.state){case -1:b=a.bools.dur?
d(c.variables[a.vars.dur],0):a.floats.dur;if(0==b){k(m,a.obj_state.dest_tsr_end);c.curr_node=a.slot_idx_order;break}a.state=0;var n=D.animate(0,1,1E3*b,function(b){a.obj_state.interp_dest=E.interpolate(a.obj_state.dest_tsr_start,a.obj_state.dest_tsr_end,h.smooth_step(b),a.obj_state.interp_tsr_dest);k(m,a.obj_state.interp_tsr_dest);1==b&&(a.state=1)});break;case 1:D.clear_animation(n),a.state=-1,c.curr_node=a.slot_idx_order}}},TRANSFORM_OBJECT:function(a,b,c,e,f,g){function k(a,b,c){0==c?v.set_tsr(a,
b):v.set_tsr_rel(a,b);v.update_transform(a);y.sync_transform(a)}switch(b.state){case 1:a.objects.ob=l.get_object(l.GET_OBJECT_BY_DUPLI_NAME_LIST,a.objects_paths.id0,0);a.state=-1;a.obj_state={space:0,tsr_start:new Float32Array(8),tsr_end:new Float32Array(8),interp_tsr:new Float32Array(8)};break;case 2:var m=a.objects.ob;switch(a.state){case -1:x[0]=a.bools.trx?d(c.variables[a.vars.trx],0):a.floats.trx;x[1]=a.bools["try"]?d(c.variables[a.vars["try"]],0):a.floats["try"];x[2]=a.bools.trz?d(c.variables[a.vars.trz],
0):a.floats.trz;G[0]=a.bools.rox?d(c.variables[a.vars.rox],0):a.floats.rox;G[1]=a.bools.roy?d(c.variables[a.vars.roy],0):a.floats.roy;G[2]=a.bools.roz?d(c.variables[a.vars.roz],0):a.floats.roz;b=a.bools.sc?c.variables[a.vars.sc]:a.floats.sc;if(a.bools["try"]||a.bools.trz)x[1]^=x[2],x[2]^=x[1],x[1]^=x[2],x[2]=-x[2];if(a.bools.roy||a.bools.roz)G[1]^=G[2],G[2]^=G[1],G[1]^=G[2],G[2]=-G[2];h.euler_to_quat(G,O);E.set_sep(x,b,O,a.obj_state.tsr_end);a.obj_state.space=a.common_usage_names.space_type;switch(a.obj_state.space){case 0:v.get_tsr(m,
a.obj_state.tsr_start);break;case 1:v.get_tsr_rel(m,a.obj_state.tsr_start);break;case 2:v.get_tsr_rel(m,a.obj_state.tsr_start),E.multiply(a.obj_state.tsr_start,a.obj_state.tsr_end,a.obj_state.tsr_end)}b=a.bools.dur?d(c.variables[a.vars.dur],0):a.floats.dur;if(0==b){k(m,a.obj_state.tsr_end,a.obj_state.space);c.curr_node=a.slot_idx_order;break}a.state=0;var n=D.animate(0,1,1E3*b,function(b){E.interpolate(a.obj_state.tsr_start,a.obj_state.tsr_end,h.smooth_step(b),a.obj_state.interp_tsr);k(m,a.obj_state.interp_tsr,
a.obj_state.space);1==b&&(a.state=1)});break;case 1:D.clear_animation(n),a.state=-1,c.curr_node=a.slot_idx_order}}},SPEAKER_PLAY:function(a,b,c,d,e,f){switch(b.state){case 1:a.obj=l.get_object(l.GET_OBJECT_BY_DUPLI_NAME_LIST,a.objects_paths.id0,0);void 0==a.bools.not_wait&&(a.bools.not_wait=!0);break;case 2:switch(m.is_playing(a.obj)||0!=a.state||(a.state=1),a.state){case -1:for(var g in b.logic_threads)d=b.logic_threads[g].thread_state.curr_node,-1!=d&&(d=b.logic_threads[g].nodes[d],"SPEAKER_PLAY"==
d.type&&d!=a&&0==d.state&&d.obj==a.obj&&(d.state=1));a.bools.not_wait||(c.in_progress=!0);m.play_def(a.obj);a.state=0;break;case 0:a.bools.not_wait&&(c.curr_node=a.slot_idx_order,a.state=-1);break;case 1:a.bools.not_wait||(c.in_progress=!1);c.curr_node=a.slot_idx_order;a.state=-1;break;default:h.panic("Unknown state of "+a.name),a.state=-1}}},SPEAKER_STOP:function(a,b,c,d,e,h){switch(b.state){case 1:a.obj=l.get_object(l.GET_OBJECT_BY_DUPLI_NAME_LIST,a.objects_paths.id0,0);break;case 2:m.stop(a.obj),
c.curr_node=a.slot_idx_order}},STOP_ANIM:function(a,c,d,e,h,f){switch(c.state){case 1:a.obj=b(a);break;case 2:n.stop(a.obj,n.SLOT_ALL),a.bools.rst&&n.set_first_frame(a.obj,n.SLOT_ALL),d.curr_node=a.slot_idx_order}},STOP_TIMELINE:function(a,b,c,d,e,h){switch(b.state){case 2:a.bools.rst&&g.set_offset_from_range_start(d),g.stop_nla(),c.curr_node=a.slot_idx_order}},CONSOLE_PRINT:function(a,b,c,d,e,h){switch(b.state){case 2:b={};for(var f in a.vars)d=a.vars[f],b[d]=c.variables[d];r.log(a.common_usage_names.msg,
JSON.stringify(b));c.curr_node=a.slot_idx_order}},STRING:function(a,b,c,e,h,f){switch(b.state){case 2:b=a.bools.id0?d(c.variables[a.vars.id0],1):a.strings.id0;e=a.bools.id1?d(c.variables[a.vars.id1],1):a.strings.id1;switch(a.floats.sop){case 0:c.variables[a.vars.dst]=b+e;break;case 1:c.variables[a.vars.dst]=b.indexOf(e);break;case 2:h=a.bools.id2?d(c.variables[a.vars.id2],1):a.strings.id2;c.variables[a.vars.dst]=b.replace(e,h);break;case 3:c.variables[a.vars.dst]=b.substring(0,b.indexOf(e));c.variables[a.vars.dst1]=
b.substring(b.indexOf(e)+1,b.length);""==c.variables[a.vars.dst]&&(c.variables[a.vars.dst]=c.variables[a.vars.dst1],c.variables[a.vars.dst1]="");break;case 4:switch(a.floats.cnd){case 5:c.variables[a.vars.dst]=b==e?1:0;break;case 4:c.variables[a.vars.dst]=b!=e?1:0;break;case 3:c.variables[a.vars.dst]=b<e?1:0;break;case 2:c.variables[a.vars.dst]=b>e?1:0;break;case 1:c.variables[a.vars.dst]=b<=e?1:0;break;case 0:c.variables[a.vars.dst]=b>=e?1:0}}c.curr_node=a.slot_idx_order}}};a.init_logic=function(a,
b){var c={data_id:b,scene_name:a.name,state:0,nla_thread:null,scene:a,curr_thread:null,logic_threads:[],sorted_markers_values:[]};a._logic=c;k(a,c)};a.update=function(a,b){var c=g.get_start_time();if(!(0>=c))for(var d=0;d<J.length;d++)for(var e=d,h=a,f=b,k=c,l=J[e],m=0;m<J[e].logic_threads.length;m++){l.curr_thread=J[e].logic_threads[m];var n=J[e].logic_threads[m],q=l,r=h,u=f,p=k,z=n.nodes;if(z.length){for(var v=0;v<z.length;v++)z[v].processed=!1;for(v=0;v<z.length;v++){if(0<=n.thread_state.curr_node)var y=
z[n.thread_state.curr_node];else break;if(y.processed)break;if(y.mute)if("ENTRYPOINT"==y.type)break;else n.thread_state.curr_node=y.slot_idx_order,y.processed=!0;else y.process_node(y,q,n.thread_state,r,u,p),y.processed=!0}}}};var U=function(){return function(a,b,c,d){c=d[0];var e=d[1];d=d[2];for(var h=0;h<c.sel_objs_len;h++)if(f.get_sensor_value(a,b,h)&&h==c.sel_obj_idx){if(g.is_play(e._nla)&&e.nla_thread==c.thread)c.state=-1;else if(!d.thread_state.in_progress||c.bools.no_wait)c.state=1;return}c.state=
0}},T=function(){return function(a,b,c,d){c=d[0];var e=d[1];d=d[2];if(-2==c.state){for(var h=0;h<c.sel_objs_len;h++)if(f.get_sensor_value(a,b,h))for(var k=0;k<c.sel_obj_idxs.length;k++)if(c.sel_obj_idxs[k]==h){e.nla_thread==c.thread?(g.is_play(e._nla)&&(c.state=-1),d.thread_state.in_progress||(c.state=1,c.slot_idx_jump=c.links_idxs[k])):(c.state=1,c.slot_idx_jump=c.links_idxs[k]);return}c.state=0}}};a.cleanup=function(){J=[]}};b4w.module.__nla=function(a,p){function t(){return{type:"CLIP",frame_start:0,frame_end:0,scheduled:!1,paused:!1,anim_name:"",anim_uuid:"",anim_slot:0,action_frame_start:0,action_frame_end:0,ext_frame_start:0,ext_frame_end:0,use_reverse:!1,scale:1,repeat:1}}function c(a,b){if(a.animation_data){var d=a.animation_data.nla_tracks;if(d)for(var e=0;e<d.length;e++)b.push(d[e])}d=a.nodes;for(e=0;e<d.length;e++){var h=d[e];h.node_group&&(h=h.node_group.node_tree)&&c(h,b)}}function b(a,b){var c=Math.round(a)-
b.frame_start;b.use_cyclic&&(c%=b.frame_duration,0>c&&(c+=b.frame_duration));return b.frame_offset+c}function k(a,b,c,d){b=(b-d)*e.get_framerate()+a.frame_offset;b>a.frame_start?(b-=a.frame_start,a.cyclic&&c&&(b%=a.frame_end-a.frame_start+1),b+=a.frame_start):b=a.frame_start;return b}function d(a,b){a=z.clamp(a,b.frame_start,b.frame_end);var c=a-b.frame_start,d=(b.frame_end-b.frame_start)/b.repeat,c=c/d&&0==c%d?b.action_frame_end:b.action_frame_start+c%d/b.scale;b.use_reverse&&(c=b.action_frame_end-
c+b.action_frame_start);return c}function l(a,b){for(var c=[],d=0;d<a.length;d++){var e=a[d].strips;if(e)for(var h=0;h<e.length;h++){var f=e[h],g=t();g.type=f.type;g.frame_start=f.frame_start;g.frame_end=f.frame_end;g.anim_slot=b;g.action_frame_start=f.action_frame_start;g.action_frame_end=f.action_frame_end;g.use_reverse=f.use_reverse;g.scale=f.scale;g.repeat=f.repeat;f.action&&(g.anim_name=f.action.name,g.anim_uuid=f.action.uuid);c.push(g)}}return c}function q(a){return("SPEAKER"==a.type||"LAMP"==
a.type)&&a.data.animation_data&&a.data.animation_data.nla_tracks.length?!0:!1}function r(a){if("MESH"!=a.type||!a.data)return!1;a=a.data.materials;if(!a)return!1;for(var b=0;b<a.length;b++){var c=a[b],d=c.node_tree;if(c.use_nodes&&d&&g(d))return!0}return!1}function g(a,b){if(a.animation_data){var c=a.animation_data.nla_tracks;if(c&&c.length)return!0}for(var c=a.nodes,d=0;d<c.length;d++){var e=c[d];e.node_group&&(e=e.node_group.node_tree)&&g(e,b)}return!1}function C(a,b){var c=B.get_active();if(c._nla){var d=
k(c._nla,b,!0,v);c._nla.frame_offset-=d-a;c._nla.force_update=!0}}var f=p("__animation");p("__camera");p("__controls");p("__config");p("__lights");p("__loader");var h=p("__objects"),n=p("__obj_util"),A=p("__print"),B=p("__scenes"),F=p("__sfx"),D=p("__textures"),e=p("__time"),z=p("__util"),y=[],v=-1;a.update_object=function(a,b){var d;d=null;for(var e=b.scenes_data.length-1;0<=e;e--){var h=b.scenes_data[e];if(h.scene.b4w_use_nla&&(d=h,h.scene._is_main))break}if(d){d.obj_has_nla_on_scene=!0;var g=0;
if((e=a.animation_data)&&e.nla_tracks.length){var k=e.nla_tracks;if(n.is_armature(b)||n.is_camera(b)||n.is_mesh(b)||n.is_empty(b)||n.is_lamp(b)||n.is_speaker(b))k=l(k,g),k.length&&(b.nla_events=b.nla_events.concat(k),g++)}q(a)&&(k=a.data.animation_data.nla_tracks,k=l(k,g),k.length&&(b.nla_events=b.nla_events.concat(k),g++));if(n.is_mesh(b))for(h=a.data.materials,e=0;e<h.length;e++){var r=h[e];if(r.use_nodes&&r.node_tree&&(k=[],c(r.node_tree,k),k=l(k,g),k.length)){for(var r=g,p=k,v=f.get_all_actions(),
y=[],A=0,C=0;C<p.length;C++){var B=p[C];""!=B.anim_uuid?B=z.keysearch("uuid",B.anim_uuid,v):(B=B.anim_name,B=z.keysearch("name",B,v)||z.keysearch("name",B+"_B4W_BAKED",v));if(B){var B=B.fcurves,D=[],w;for(w in B)D.push(w);y.push(D)}}for(C=0;C<y.length;C++){v=!1;for(B=0;B<C;B++)if(z.arrays_have_common(y[C],y[B])){p[C].anim_slot=p[B].anim_slot;v=!0;break}v||(p[C].anim_slot=g+A++)}g=r+A;b.nla_events=b.nla_events.concat(k)}}for(e=0;e<a.particle_systems.length;e++)h=a.particle_systems[e],w=h.settings,
"EMITTER"==w.type&&w.b4w_allow_nla&&(w=t(),w.type="CLIP",w.frame_start=d.scene.frame_start,w.frame_end=d.scene.frame_end+1,w.anim_name=h.name,w.anim_slot=g,w.action_frame_start=w.frame_start,w.action_frame_end=w.frame_end,b.nla_events.push(w),g++);h=g+1;for(e=0;e<b.vertex_anim.length;e++)k=b.vertex_anim[e],k.allow_nla&&(g=h,w=t(),w.type="CLIP",w.frame_start=d.scene.frame_start,w.frame_end=d.scene.frame_end+1,w.anim_name=k.name,w.anim_slot=g,w.action_frame_start=w.frame_start,w.action_frame_end=w.frame_end,
b.nla_events.push(w))}};a.update_scene=function(a,b,c){a._nla||(a._nla={frame_start:a.frame_start,frame_end:a.frame_end,frame_offset:0,last_frame:-1,range_end:a.frame_end,range_start:a.frame_start,user_callback:null,cyclic:b,objects:[],textures:[],scene_name:a.name,is_stopped:!1,force_update:!1,rewinded_to_start:!0});b=a._nla;for(var d=h.get_scene_objs_derived(a,"ALL",c),e=0;e<d.length;e++){var f=d[e];if(f.nla_events.length){for(var g=0;g<f.scenes_data.length;g++){var k=f.scenes_data[g];k.scene==
a&&k.obj_has_nla_on_scene&&b.objects.push(f)}for(var g=f.nla_events,k=b,l=f.name,n=0;n<g.length;n++){var q=g[n],r=l+" ["+q.frame_start+":"+q.frame_end+"]",p=Math.max(k.frame_start,q.frame_start);q.action_frame_start+=p-q.frame_start;q.frame_start=p;q.frame_end=Math.min(k.frame_end+1,q.frame_end);q.frame_start>q.frame_end?(A.warn("NLA: out of scene range: "+r),g.splice(n,1),n--):q.anim_name||"CLIP"!=q.type||(A.warn('NLA: no action in strip for object "'+l+'".'),g.splice(n,1),n--)}f=f.nla_events;g=
b;for(k=0;k<f.length;k++){l=f[k];n=g.frame_start;q=g.frame_end+1;for(r=0;r<f.length;r++)p=f[r],l.anim_slot==p.anim_slot&&(p.frame_end<=l.frame_start&&(n=l.frame_start),p.frame_start>=l.frame_end&&(q=Math.min(q,p.frame_start)));l.ext_frame_start=n;l.ext_frame_end=q}}}a=a._render.video_textures;for(e=0;e<a.length;e++)d=a[e]._render,d.use_nla&&(d.video_file||d.seq_video)&&d.vtex_data_id==c&&(f=t(),f.type="VIDEO",d.use_cyclic?(f.frame_start=0,f.frame_end=b.frame_end):(f.frame_start=z.clamp(d.frame_start,
0,b.frame_end),f.frame_end=z.clamp(d.frame_start+d.frame_duration,0,b.frame_end)),f.anim_name=a[e].name,b.textures.push(d));y.push(b)};a.start=function(){v=0};a.get_start_time=function(){return v};a.get_frame_offset=function(a){return a._nla?a._nla.frame_offset:null};a.set_frame_offset=function(a,b){return a._nla?(a._nla.frame_offset=b,!0):!1};a.update=function(a,c){if(!(0>v)){0==v&&(v=a);for(var h=0;h<y.length;h++){var g=y[h];g.is_stopped&&(g.frame_offset-=e.get_framerate()*c);var l=k(g,a,!0,v);
if((!g.is_stopped||g.force_update)&&l>=g.range_end)if(g.cyclic){var l=g,n=a;l.user_callback&&l.user_callback();C(l.range_start,n);l.rewinded_to_start=!0;l=k(l,n,!0,v)}else{var n=g,q=l;n.is_stopped=!0;n.frame_offset-=q-n.range_end;n.user_callback&&n.user_callback()}if(!g.is_stopped||g.force_update){for(var n=g,q=l,r=0;r<n.objects.length;r++){for(var p=n.objects[r],A=p.nla_events,t=0;t<A.length;t++){var I=A[t];"SOUND"==I.type&&q<n.last_frame-1E-6&&(I.scheduled=!1)}for(t=0;t<A.length;t++)switch(I=A[t],
I.type){case "CLIP":if(I.ext_frame_start<=q&&q<I.ext_frame_end&&!I.scheduled){var B=p,U=I;""!=U.anim_uuid?f.apply_by_uuid(B,U.anim_uuid,U.anim_slot):f.apply(B,U.anim_name,U.anim_slot);f.set_behavior(B,f.AB_FINISH_STOP,U.anim_slot);var T=d(U.frame_start,U);f.set_frame(B,T,U.anim_slot);for(B=0;B<A.length;B++)A[B]!=I&&A[B].anim_slot==I.anim_slot&&(A[B].scheduled=!1);I.scheduled=!0}I.scheduled&&(B=p,U=d(q,I),T=f.get_current_frame_float(B,I.anim_slot),1E-6<Math.abs(U-T)&&f.set_frame(B,U,I.anim_slot));
break;case "SOUND":(q<n.last_frame-1E-6||n.last_frame<I.frame_start)&&I.frame_start<=q&&q<I.frame_end&&!I.scheduled&&(B=p,T=I,U=(T.frame_start-q)/e.get_framerate(),T=(T.frame_end-T.frame_start)/e.get_framerate(),F.play(B,U,T),I.scheduled=!0),n.last_frame<I.frame_end&&I.frame_end<=q&&I.scheduled&&(I.scheduled=!1)}}n=a;q=g;r=l;for(p=0;p<q.textures.length;p++)if(A=q.textures[p],A.video_file||A.seq_video){t=D.video_get_current_frame(A);I=A;B=b(r,I);B=z.clamp(B,I.frame_offset,I.frame_offset+D.video_get_duration(I)-
1);I.seq_video&&(B=D.video_frame_to_seq_frame(I,B),B==I.seq_movie_length&&B--);I=B;B=D.video_get_start_frame(A);T=U=!1;if(q.force_update||q.rewinded_to_start)T=!0;if(!q.is_stopped){var w;w=A;var fa=b(r,w);w=w.frame_offset<=fa&&fa<=w.frame_offset+D.video_get_duration(w);fa=D.video_is_played(A);A.use_cyclic&&I==B&&(T=!0);fa||t==I||(T=!0);w&&!fa?D.play_video(A.name,A.vtex_data_id):w&&fa?U=!0:!w&&fa&&(A.video_file&&t<I?U=!0:D.pause_video(A.name,A.vtex_data_id))}T?(D.set_frame_video(A.name,I,A.vtex_data_id),
A.seq_video&&(A.seq_last_discrete_mark=D.seq_video_get_discrete_timemark(A,n))):U&&D.video_update_is_available(A)&&(A.video_file?D.update_video_texture(A):(t=D.seq_video_get_discrete_timemark(A,n),t!=A.seq_last_discrete_mark&&(A.seq_cur_frame=I,D.update_seq_video_texture(A)),A.seq_last_discrete_mark=t))}g.last_frame=l}g.force_update=!1;g.rewinded_to_start=!1}}};a.calc_curr_frame_scene=k;a.cleanup=function(){y.length=0;v=-1};a.bpy_obj_has_nla=function(a){var b=a.animation_data;return b&&b.nla_tracks.length||
q(a)||r(a)?!0:!1};a.set_frame=C;a.get_frame=function(a){var b=B.get_active();return b._nla?k(b._nla,a,!0,v):-1};a.stop_nla=function(){var a=B.get_active();a._nla&&(a._nla.is_stopped=!0);for(var a=a._nla.textures,b=0;b<a.length;b++){var c=a[b];D.pause_video(c.name,c.vtex_data_id)}};a.play_nla=function(a){var b=B.get_active();b._nla&&(b._nla.is_stopped=!1,b._nla.user_callback=a?a:null)};a.get_frame_start=function(){var a=B.get_active();return a._nla?a._nla.frame_start:-1};a.get_frame_end=function(){var a=
B.get_active();return a._nla?a._nla.frame_end:-1};a.is_play=function(){var a=B.get_active();return a._nla?!a._nla.is_stopped:!1};a.check_nla=function(){var a=B.get_active();return a._nla?a.b4w_use_nla:!1};a.check_logic_nodes=function(){var a=B.get_active();return a._nla?0<a.b4w_logic_nodes.length:!1};a.set_range=function(a,b){var c=B.get_active();if(c._nla)c._nla.range_start=a,c._nla.range_end=b;else return!1};a.set_range_end=function(a){var b=B.get_active();if(b._nla)b._nla.range_end=a;else return!1};
a.set_range_start=function(a){var b=B.get_active();if(b._nla)b._nla.range_start=a;else return!1};a.reset_range=function(){var a=B.get_active();if(a._nla)a=a._nla,a.range_start=a.frame_start,a.range_end=a.frame_end;else return!1};a.set_cyclic=function(a){var b=B.get_active();if(b._nla)b._nla.cyclic=a;else return!1};a.clear_callback=function(){var a=B.get_active();a._nla&&(a._nla.user_callback=null)};a.set_offset_from_range_start=function(a){var b=B.get_active()._nla;b&&(b.frame_offset=-(a-v)*e.get_framerate()+
b.range_start,b.force_update=!0)};a.get_frame_end=function(){var a=B.get_active()._nla;return a?a.frame_end:null}};b4w.module.__camera=function(a,p){function t(a){var b=a.render,c=a.render,d=V.get_trans_view(c.world_tsr),e=V.get_quat_view(c.world_tsr),e=S.quat_to_dir(e,S.AXIS_MY,N),f=ca;f.set(S.AXIS_Y);f[3]=0;e=S.line_plane_intersect(f,-c.hover_zero_level,d,e,c.hover_pivot);f=q(a,oa)[1];if(!e||Math.abs(f)<ga)w.warn("Active hover camera view vector and the supporting plane are parallel to each other. Hover pivot will be set based on the camera position."),c.hover_pivot[0]=d[0],c.hover_pivot[1]=0,c.hover_pivot[2]=
d[2],h(a,d,c.hover_pivot),I.correct_up(a,c.vertical_axis,!0);c=q(a,oa);d=ea.obj_point_distance(a,a.render.hover_pivot);b.distance_limits||(b.distance_limits={min:d,max:d});b.vertical_limits||(b.vertical_limits={down:c[1],up:c[1]});b=S.calc_returning_angle(c[1],b.vertical_limits.up,b.vertical_limits.down);0<c[1]&&w.warn("Active hover camera has wrong orientation");b?y(a,0,b):m(a)}function c(b){b=b.render;switch(b.move_style){case a.MS_TARGET_CONTROLS:var c=V.get_trans_view(b.world_tsr);b.init_dist=
X.dist(c,b.pivot);b.init_top=b.cameras[0].top;break;case a.MS_HOVER_CONTROLS:c=V.get_trans_view(b.world_tsr),b.init_dist=X.dist(c,b.hover_pivot),b.init_top=b.cameras[0].top}}function b(){return{left:new Float32Array([0,0,0,0]),right:new Float32Array([0,0,0,0]),top:new Float32Array([0,0,0,0]),bottom:new Float32Array([0,0,0,0]),near:new Float32Array([0,0,0,0]),far:new Float32Array([0,0,0,0])}}function k(b){switch(b){case "STATIC":return a.MS_STATIC;case "TARGET":return a.MS_TARGET_CONTROLS;case "EYE":return a.MS_EYE_CONTROLS;
case "HOVER":return a.MS_HOVER_CONTROLS;default:throw"Unknown move style";}}function d(c){var d={type:c,name:"",size_mult:1,width:0,height:0,framebuffer:null,framebuffer_prev:null,color_attachment:null,depth_attachment:null,aspect:0,fov:0,near:0,far:0,left:0,right:0,top:0,bottom:0,hmd_fov:la.create(),world_tsr:new Float32Array(9),view_matrix:new Float32Array(16),billboard_view_matrix:new Float32Array(16),proj_matrix:new Float32Array(16),view_proj_matrix:new Float32Array(16),view_proj_inv_matrix:new Float32Array(16),
prev_view_proj_matrix:new Float32Array(16),sky_vp_inv_matrix:new Float32Array(16),view_tsr:V.create_ext(),shadow_cast_billboard_view_tsr:V.create_ext(),dof_distance:0,dof_front:0,dof_rear:0,dof_power:0,dof_object:null,dof_on:!1,lod_eye:new Float32Array(3),frustum_planes:b(),stereo_conv_dist:0,stereo_eye_dist:0,reflection_plane:null,csm_centers:null,csm_radii:null,csm_center_dists:new Float32Array(4),pcf_blur_radii:new Float32Array(4)};d.hmd_fov[0]=d.hmd_fov[2]=45;d.hmd_fov[1]=d.hmd_fov[3]=55;if(c==
a.TYPE_NONE)return d;switch(c){case a.TYPE_PERSP:g(d,40,.1,1E3);break;case a.TYPE_ORTHO:g(d,2.5,.1,1E3);break;case a.TYPE_PERSP_ASPECT:break;case a.TYPE_ORTHO_ASPECT:break;case a.TYPE_ORTHO_ASYMMETRIC:break;case a.TYPE_STEREO_LEFT:case a.TYPE_STEREO_RIGHT:case a.TYPE_HMD_LEFT:case a.TYPE_HMD_RIGHT:throw"Stereo camera may only be created from perspective one";default:throw"Unknown camera type";}return d}function l(b,c,d){if(b.type!=a.TYPE_STEREO_LEFT&&b.type!=a.TYPE_STEREO_RIGHT&&b.type!=a.TYPE_HMD_LEFT&&
b.type!=a.TYPE_HMD_RIGHT)throw"set_stereo_params(): wrong camera type";if(b.type==a.TYPE_STEREO_LEFT||b.type==a.TYPE_STEREO_RIGHT)b.stereo_conv_dist=c;b.stereo_eye_dist=d;u(b,b.aspect);if(da.check_active()&&(c=da.get_active(),b=c._render.shadow_params))for(c=da.get_camera(c).render.cameras,d=0;d<c.length;d++)O(c[d],b)}function q(a,b){var c=V.get_quat_view(a.render.world_tsr);return r(c,b)}function r(a,b){var c=S.quat_to_dir(a,S.AXIS_Y,N),d=S.quat_to_dir(a,S.AXIS_Z,Z),e=-Math.asin(c[1]/X.length(c)),
c=Math.abs(e)>Math.PI/4?X.scale(d,-S.sign(e),ba):X.scale(c,-S.sign(d[1]),ba),h=Math.atan(Math.abs(c[0]/c[2]));0<d[1]&&(e=S.sign(e)*Math.PI-e);d=h;0>c[2]&&(d=Math.PI-d);0>c[0]&&(d=2*Math.PI-d);b[0]=d;b[1]=e;return b}function g(b,c,d,e,h){switch(b.type){case a.TYPE_PERSP:case a.TYPE_STEREO_LEFT:case a.TYPE_STEREO_RIGHT:b.fov=c;b.aspect=1;break;case a.TYPE_ORTHO:b.top=c;b.aspect=1;break;case a.TYPE_PERSP_ASPECT:delete b.fov;b.fov=c;b.aspect=h/c;break;case a.TYPE_ORTHO_ASPECT:b.top=c;b.aspect=h/c;break;
case a.TYPE_HMD_LEFT:case a.TYPE_HMD_RIGHT:break;default:w.error("set_frustum(): Unsupported camera type: "+b.type)}b.near=d;b.far=e}function C(b,c){var d=V.get_trans_view(c.render.world_tsr),e=V.get_quat_view(c.render.world_tsr),d=U.fromRotationTranslation(e,d,ka);U.rotateX(d,-Math.PI/2,d);U.invert(d,b.view_matrix);if(b.reflection_plane){var d=b.reflection_plane[0],e=b.reflection_plane[1],h=b.reflection_plane[2],f=b.reflection_plane[3],g=ka;g[0]=1-2*d*d;g[1]=-2*d*e;g[2]=-2*d*h;g[3]=0;g[4]=-2*d*e;
g[5]=1-2*e*e;g[6]=-2*e*h;g[7]=0;g[8]=-2*d*h;g[9]=-2*e*h;g[10]=1-2*h*h;g[11]=0;g[12]=-2*d*f;g[13]=-2*e*f;g[14]=-2*h*f;g[15]=1;U.multiply(b.view_matrix,g,b.view_matrix);V.from_mat4(b.view_matrix,b.view_tsr);u(b,b.aspect,!0);d=ca;e=ka;U.invert(b.view_matrix,e);U.transpose(e,e);la.transformMat4(b.reflection_plane,e,d);e=Ga;e[0]=(S.sign(d[0])+b.proj_matrix[8])/b.proj_matrix[0];e[1]=(S.sign(d[1])+b.proj_matrix[9])/b.proj_matrix[5];e[2]=-1;e[3]=(1+b.proj_matrix[10])/b.proj_matrix[14];la.scale(d,2/(d[0]*
e[0]+d[1]*e[1]+d[2]*e[2]+d[3]*e[3]),d);b.proj_matrix[2]=d[0];b.proj_matrix[6]=d[1];b.proj_matrix[10]=d[2]+1;b.proj_matrix[14]=d[3]}if(da.check_active())var k=da.get_active(),k=da.get_subs(k,"STEREO");if(b.type==a.TYPE_STEREO_LEFT||k&&k.enable_hmd_stereo&&b.type==a.TYPE_HMD_LEFT)b.view_matrix[12]+=b.stereo_eye_dist/2;else if(b.type==a.TYPE_STEREO_RIGHT||k&&k.enable_hmd_stereo&&b.type==a.TYPE_HMD_RIGHT)b.view_matrix[12]-=b.stereo_eye_dist/2;V.from_mat4(b.view_matrix,b.view_tsr);E(b);K(b);V.copy(c.render.world_tsr,
b.world_tsr)}function f(b,c,d,e){U.lookAt(c,d,e,b.view_matrix);d=da.get_active();d=da.get_subs(d,"STEREO");da.check_active()&&(d=da.get_active(),d=da.get_subs(d,"STEREO"));if(b.type==a.TYPE_STEREO_LEFT||d&&d.enable_hmd_stereo&&b.type==a.TYPE_HMD_LEFT)b.view_matrix[12]+=b.stereo_eye_dist/2;else if(b.type==a.TYPE_STEREO_RIGHT||d&&d.enable_hmd_stereo&&b.type==a.TYPE_HMD_RIGHT)b.view_matrix[12]-=b.stereo_eye_dist/2;V.from_mat4(b.view_matrix,b.view_tsr);E(b);K(b);V.set_trans(c,b.world_tsr)}function h(a,
b,c){c=X.subtract(c,b,N);X.normalize(c,c);c=S.rotation_to_stable(S.AXIS_MY,c,Q);ea.set_rotation(a,c);ea.set_translation(a,b)}function n(a){var b=a.render,c=b.cameras;if(!c)throw"Wrong object";for(var d=b.shadow_cameras,e=0;e<d.length;e++){var h=d[e];X.copy(V.get_trans_view(b.world_tsr),h.lod_eye)}for(e=0;e<c.length;e++)if(h=c[e],C(h,a),S.extract_frustum_planes(h.view_proj_matrix,h.frustum_planes),h.dof_object&&h.dof_on){var d=V.get_trans_view(b.world_tsr),f=ea.get_translation(h.dof_object,N),d=X.dist(d,
f);h.dof_distance=d}}function A(b){b=b.render;if(b.move_style==a.MS_TARGET_CONTROLS){var c=V.get_quat_view(b.world_tsr),c=S.quat_to_dir(c,S.AXIS_Z,N);b.target_cam_upside_down=0<c[1]}}function B(b){var c=b.render,d=c.horizontal_limits;!d||c.move_style!=a.MS_EYE_CONTROLS&&c.move_style!=a.MS_TARGET_CONTROLS||(b=q(b,oa),d.camera_space?(d.left+=b[0],d.right+=b[0]):(d.left_local-=b[0],d.right_local-=b[0]),d.left=S.angle_wrap_0_2pi(d.left),d.right=S.angle_wrap_0_2pi(d.right),d.left_local=S.angle_wrap_0_2pi(d.left_local),
d.right_local=S.angle_wrap_0_2pi(d.right_local))}function F(b){var c=b.render,d=c.vertical_limits;if(d)switch(c.move_style){case a.MS_EYE_CONTROLS:case a.MS_TARGET_CONTROLS:b=q(b,oa);d.camera_space?(d.up+=b[1],d.down+=b[1]):(d.up_local-=b[1],d.down_local-=b[1]);d.up=S.angle_wrap_periodic(d.up,-Math.PI,Math.PI);d.down=S.angle_wrap_periodic(d.down,-Math.PI,Math.PI);d.up_local=S.angle_wrap_periodic(d.up_local,-Math.PI,Math.PI);d.down_local=S.angle_wrap_periodic(d.down_local,-Math.PI,Math.PI);break;case a.MS_HOVER_CONTROLS:d.up=
S.angle_wrap_periodic(d.up,-Math.PI,Math.PI),d.down=S.angle_wrap_periodic(d.down,-Math.PI,Math.PI),d.up=S.clamp(d.up,-Math.PI/2,0),d.down=S.clamp(d.down,-Math.PI/2,0)}}function D(b){var c=b.render;if(T.is_camera(b)){var d=c.cameras;if(d[0].type===a.TYPE_ORTHO){switch(c.move_style){case a.MS_TARGET_CONTROLS:var e=V.get_trans_view(c.world_tsr),e=X.dist(e,c.pivot),c=e/c.init_dist*c.init_top;break;case a.MS_HOVER_CONTROLS:e=V.get_trans_view(c.world_tsr);e=X.distance(e,c.hover_pivot);c=e/c.init_dist*c.init_top;
break;default:c=d[0].top}for(e=0;e<d.length;e++){var h=d[e];h.top=c;u(h,h.aspect)}n(b)}}}function e(a,b,c,d,e){var h=a.render,f=b,g=c;if(d||e)a=q(a,na),d&&(f=b-a[0]),e&&(g=c-a[1]);if(f||g)b=fa.identity(Q),f&&(f=fa.setAxisAngle(h.vertical_axis,f,sa),fa.multiply(b,f,b)),h=V.get_quat_view(h.world_tsr),g&&(f=S.quat_to_dir(h,S.AXIS_X,N),g=fa.setAxisAngle(f,g,sa),fa.normalize(g,g),fa.multiply(b,g,b)),fa.multiply(b,h,h)}function z(a,b,c,d,e){var h=a.render,f=b,g=c;if(d||e){var k=q(a,na);d&&(f=b-k[0]);e&&
(g=c-k[1])}v(a,a.render.pivot,f,g);a=q(a,na);a=S.angle_wrap_periodic(a[1],-Math.PI,Math.PI);h.target_cam_upside_down=Math.abs(a)>Math.PI/2}function y(a,b,c,d,e){var h=a.render,f=b,g=c;if(d||e){var k=q(a,na);d&&(f=b-k[0]);e&&(g=c-k[1])}h.enable_hover_hor_rotation||(f=0);v(a,h.hover_pivot,f,g);g&&m(a)}function v(a,b,c,d){var e=a.render;if(c||d){var h=fa.identity(Q);c&&(c=fa.setAxisAngle(S.AXIS_Y,c,sa),fa.multiply(h,c,h));J(a);a=V.get_quat_view(e.world_tsr);d&&(c=S.quat_to_dir(a,S.AXIS_X,N),d=fa.setAxisAngle(c,
d,sa),fa.normalize(d,d),fa.multiply(h,d,h));e=V.get_trans_view(e.world_tsr);S.rotate_point_pivot(e,b,h,e);fa.multiply(h,a,a)}}function m(a){var b=a.render,c=q(a,oa)[1],d=a.render;a=d.vertical_limits;d=d.distance_limits;a.down-a.up?(c=(a.down-c)/(a.down-a.up),c=Math.max(c,0)):c=0;c=c*(d.max-d.min)+d.min;a=V.get_trans_view(b.world_tsr);d=V.get_quat_view(b.world_tsr);d=S.quat_to_dir(d,S.AXIS_MY,N);X.normalize(d,d);X.scale(d,c,d);X.subtract(b.hover_pivot,d,a)}function u(b,c,d){switch(b.type){case a.TYPE_PERSP:if(!c)throw"No aspect ratio";
b.aspect=c;case a.TYPE_PERSP_ASPECT:U.perspective(S.rad(b.fov),b.aspect,b.near,b.far,b.proj_matrix);break;case a.TYPE_ORTHO:if(!c)throw"No aspect ratio";b.aspect=c;case a.TYPE_ORTHO_ASPECT:c=b.top*b.aspect;U.ortho(-c,c,-b.top,b.top,b.near,b.far,b.proj_matrix);break;case a.TYPE_ORTHO_ASYMMETRIC:U.ortho(b.left,b.right,b.bottom,b.top,b.near,b.far,b.proj_matrix);break;case a.TYPE_STEREO_LEFT:case a.TYPE_STEREO_RIGHT:if(!c)throw"No aspect ratio";b.aspect=c;var e=Math.tan(b.fov*Math.PI/360);c=b.near*e;
var h=b.aspect*b.stereo_conv_dist*e;b.type==a.TYPE_STEREO_LEFT?(e=h-b.stereo_eye_dist/2,h+=b.stereo_eye_dist/2):(e=h+b.stereo_eye_dist/2,h-=b.stereo_eye_dist/2);e=-(b.near/b.stereo_conv_dist*e);h*=b.near/b.stereo_conv_dist;U.frustum(e,h,-c,c,b.near,b.far,b.proj_matrix);b.left=e;b.right=h;break;case a.TYPE_HMD_LEFT:case a.TYPE_HMD_RIGHT:if(da.check_active())if(e=da.get_active(),(e=da.get_subs(e,"STEREO"))&&e.enable_hmd_stereo){c=Math.tan(S.rad(b.hmd_fov[0])/2);var e=Math.tan(S.rad(b.hmd_fov[1])/2),
h=Math.tan(S.rad(b.hmd_fov[2])/2),f=Math.tan(S.rad(b.hmd_fov[3])/2);b.top=b.near*c;b.right=b.near*e;b.bottom=-b.near*h;b.left=-b.near*f;U.frustum(b.left,b.right,b.bottom,b.top,b.near,b.far,b.proj_matrix)}else c||(c=b.aspect),U.perspective(S.rad(b.fov),c,b.near,b.far,b.proj_matrix);break;case a.TYPE_NONE:return;default:throw"Wrong camera type: "+b.type;}d||(E(b),K(b))}function K(a){U.copy(a.view_matrix,a.sky_vp_inv_matrix);a.sky_vp_inv_matrix[12]=0;a.sky_vp_inv_matrix[13]=0;a.sky_vp_inv_matrix[14]=
0;a.sky_vp_inv_matrix[15]=1;U.multiply(a.proj_matrix,a.sky_vp_inv_matrix,a.sky_vp_inv_matrix);U.invert(a.sky_vp_inv_matrix,a.sky_vp_inv_matrix)}function E(a){U.copy(a.view_matrix,a.view_proj_matrix);U.multiply(a.proj_matrix,a.view_proj_matrix,a.view_proj_matrix);U.invert(a.view_proj_matrix,a.view_proj_inv_matrix)}function M(b,c,d,e,h){e||(e=new Float32Array(24));c||(c=b.near);d||(d=b.far);var f,g,k,l,m,n,q,r;switch(b.type){case a.TYPE_NONE:throw"Extraction from NONE camera is not possible";case a.TYPE_PERSP:case a.TYPE_PERSP_ASPECT:f=
c*Math.tan(b.fov*Math.PI/360);l=-f;g=f*b.aspect;k=-g;m=d/c*f;r=-m;n=m*b.aspect;q=-n;break;case a.TYPE_ORTHO:case a.TYPE_ORTHO_ASPECT:k=b.top*b.aspect;f=m=b.top;g=n=k;l=r=-b.top;k=q=-k;break;case a.TYPE_ORTHO_ASYMMETRIC:f=m=b.top;g=n=b.right;l=r=b.bottom;k=q=b.left;break;case a.TYPE_STEREO_LEFT:case a.TYPE_STEREO_RIGHT:m=c/b.near;f=c*Math.tan(b.fov*Math.PI/360);l=-f;g=b.right*m;k=b.left*m;q=d/c;m=f*q;r=-m;n=g*q;q*=k;break;case a.TYPE_HMD_LEFT:case a.TYPE_HMD_RIGHT:m=c/b.near;f=b.top*m;l=b.bottom*m;
g=b.right*m;k=b.left*m;q=d/c;m=f*q;r=l*q;n=g*q;q*=k;break;default:throw"Wrong camera type: "+b.type;}e[0]=k;e[1]=l;e[2]=-c;e[3]=g;e[4]=l;e[5]=-c;e[6]=g;e[7]=f;e[8]=-c;e[9]=k;e[10]=f;e[11]=-c;e[12]=q;e[13]=r;e[14]=-d;e[15]=q;e[16]=m;e[17]=-d;e[18]=n;e[19]=m;e[20]=-d;e[21]=n;e[22]=r;e[23]=-d;h&&(c=ka,U.invert(b.view_matrix,c),S.positions_multiply_matrix(e,c,e,0));return e}function J(b){return T.is_camera(b)&&b.render&&b.render.move_style==a.MS_HOVER_CONTROLS}function O(a,b){if(b.enable_csm){var c=b.csm_num;
if(!a.csm_centers){var d=b.csm_num;a.csm_centers=Array(d);for(var e=0;e<d;e++)a.csm_centers[e]=new Float32Array(3);a.csm_radii=new Float32Array(d)}for(d=0;d<c;d++){var e=0==d?a.near:G(b,a,d-1),h=G(b,a,d),e=M(a,e,h,xa),e=P.get_frustum_mec(e);a.csm_centers[d].set(e.center);a.csm_radii[d]=e.radius;a.csm_center_dists[d]=X.length(e.center);a.pcf_blur_radii[d]=x(b.first_cascade_blur_radius,b.last_cascade_blur_radius,c,d)}}else a.pcf_blur_radii[0]=b.first_cascade_blur_radius}function G(a,b,c){var d=a.csm_num,
e=S.clamp(a.csm_first_cascade_border,b.near,b.far);a=S.clamp(a.csm_last_cascade_border,b.near,b.far);c=x(e,a,d,c);return S.clamp(c,b.near,b.far)}function x(a,b,c,d){switch(d){case 0:break;case c-1:a=b;break;default:a=0==a?0:a*Math.pow(b/a,d/(c-1))}return a}function H(a,b){b||(b=new Float32Array(3));var c=V.get_trans_view(a.render.world_tsr);X.copy(c,b);return b}var P=p("__boundings");p("__config");var I=p("__constraints"),aa=p("__container");p("__mat3");var U=p("__mat4"),T=p("__obj_util"),w=p("__print"),
fa=p("__quat"),da=p("__scenes"),ea=p("__transform"),V=p("__tsr"),S=p("__util"),X=p("__vec3"),la=p("__vec4");p("__physics");a.TYPE_NONE=10;a.TYPE_PERSP=20;a.TYPE_ORTHO=30;a.TYPE_PERSP_ASPECT=40;a.TYPE_ORTHO_ASPECT=50;a.TYPE_ORTHO_ASYMMETRIC=60;a.TYPE_STEREO_LEFT=70;a.TYPE_STEREO_RIGHT=80;a.TYPE_HMD_LEFT=90;a.TYPE_HMD_RIGHT=100;a.MS_STATIC=0;a.MS_TARGET_CONTROLS=2;a.MS_EYE_CONTROLS=3;a.MS_HOVER_CONTROLS=4;var ga=Math.PI/180/2,oa=new Float32Array(2),na=new Float32Array(2),N=new Float32Array(3),Z=new Float32Array(3),
ba=new Float32Array(3),Q=new Float32Array(4),sa=new Float32Array(4),ca=new Float32Array(4),Ga=new Float32Array(4);new Float32Array(16);var ka=new Float32Array(16),xa=new Float32Array(24);a.camera_object_to_camera=function(b,e){var h=e.render,f=b.data;switch(f.type){case "PERSP":var l=d(a.TYPE_PERSP);if(f.angle_y)var m=f.angle_y/Math.PI*180;g(l,m,f.clip_start,f.clip_end);break;case "ORTHO":l=d(a.TYPE_ORTHO),g(l,f.ortho_scale/2,f.clip_start,f.clip_end)}l.name=e.name;h.underwater=!1;h.move_style=k(f.b4w_move_style);
h.dof_distance=f.dof_distance;m=f.dof_object;h.dof_object=m?m._object:null;h.dof_front=f.b4w_dof_front;h.dof_rear=f.b4w_dof_rear;h.dof_power=f.b4w_dof_power;h.enable_hover_hor_rotation=f.b4w_enable_hover_hor_rotation;h.hover_zero_level=f.b4w_hover_zero_level;h.cameras=[l];h.shadow_cameras=[];h.velocity_trans=f.b4w_trans_velocity;h.velocity_rot=f.b4w_rot_velocity;h.velocity_zoom=f.b4w_zoom_velocity;h.move_style==a.MS_TARGET_CONTROLS&&(h.pivot.set(f.b4w_target),A(e));f=e.render;m=f.move_style;if(m===
a.MS_TARGET_CONTROLS||m===a.MS_EYE_CONTROLS||m===a.MS_HOVER_CONTROLS){var n=b.data,q=null,r=null,p=null,z=null,v=null;m===a.MS_TARGET_CONTROLS||m===a.MS_EYE_CONTROLS?(n.b4w_use_panning&&(f.use_panning=n.b4w_use_panning),n.b4w_use_horizontal_clamping&&(q={left:n.b4w_rotation_left_limit,left_local:n.b4w_rotation_left_limit,right:n.b4w_rotation_right_limit,right_local:n.b4w_rotation_right_limit,camera_space:"LOCAL"==n.b4w_horizontal_clamping_type}),n.b4w_use_vertical_clamping&&(r={down:n.b4w_rotation_down_limit,
down_local:n.b4w_rotation_down_limit,up:n.b4w_rotation_up_limit,up_local:n.b4w_rotation_up_limit,camera_space:"LOCAL"==n.b4w_vertical_clamping_type}),m===a.MS_TARGET_CONTROLS&&n.b4w_use_target_distance_limits&&n.b4w_distance_min<=n.b4w_distance_max&&(p={min:n.b4w_distance_min,max:n.b4w_distance_max})):m===a.MS_HOVER_CONTROLS&&(n.b4w_use_horizontal_clamping&&n.b4w_horizontal_translation_min<=n.b4w_horizontal_translation_max&&(z={min:n.b4w_horizontal_translation_min,max:n.b4w_horizontal_translation_max}),
n.b4w_use_vertical_clamping&&n.b4w_vertical_translation_min<=n.b4w_vertical_translation_max&&(v={min:n.b4w_vertical_translation_min,max:n.b4w_vertical_translation_max}),n.b4w_use_zooming&&(n.b4w_hover_angle_min<=n.b4w_hover_angle_max?r={down:n.b4w_hover_angle_min,up:n.b4w_hover_angle_max}:w.error("Wrong angle limits for the HOVER camera. Disabling angle limits."),n.b4w_distance_min<=n.b4w_distance_max?p={min:n.b4w_distance_min,max:n.b4w_distance_max}:w.error("Wrong distance limits for the HOVER camera. Disabling distance limits.")));
f.horizontal_limits=q;f.vertical_limits=r;f.distance_limits=p;f.hover_horiz_trans_limits=z;f.hover_vert_trans_limits=v;f=e.render;switch(f.move_style){case a.MS_EYE_CONTROLS:f.horizontal_limits&&(f.horizontal_limits.left*=-1,f.horizontal_limits.right*=-1);break;case a.MS_TARGET_CONTROLS:f.vertical_limits&&(f.vertical_limits.down*=-1,f.vertical_limits.up*=-1);break;case a.MS_HOVER_CONTROLS:f.hover_vert_trans_limits&&(m=-f.hover_vert_trans_limits.min,f.hover_vert_trans_limits.min=-f.hover_vert_trans_limits.max,
f.hover_vert_trans_limits.max=m),f.vertical_limits&&(f.vertical_limits.down*=-1,f.vertical_limits.up*=-1)}B(e);F(e)}h.move_style===a.MS_HOVER_CONTROLS&&t(e);l.type==a.TYPE_ORTHO&&c(e)};a.init_hover_behavior=t;a.init_ortho_props=c;a.create_frustum_planes=b;a.move_style_bpy_to_b4w=k;a.create_camera=d;a.check_attachment=function(a,b){switch(b){case "COLOR":case "CUBEMAP":return Boolean(a.color_attachment);case "DEPTH":return Boolean(a.depth_attachment);case "SCREEN":return!Boolean(a.color_attachment)&&
!Boolean(a.depth_attachment);default:throw"Wrong attachment type: "+b;}};a.set_attachment=function(a,b,c){switch(b){case "COLOR":case "CUBEMAP":a.color_attachment=c;break;case "DEPTH":a.depth_attachment=c;break;case "SCREEN":a.color_attachment=null;a.depth_attachment=null;break;default:throw"Wrong attachment type: "+b;}};a.get_attachment=function(a,b){switch(b){case "COLOR":case "CUBEMAP":return a.color_attachment;case "DEPTH":return a.depth_attachment;case "SCREEN":return null;default:throw"Wrong attachment type: "+
b;}};a.make_stereo=function(b,c){if(b.type!=a.TYPE_PERSP||c!=a.TYPE_STEREO_LEFT&&c!=a.TYPE_STEREO_RIGHT&&c!=a.TYPE_HMD_LEFT&&c!=a.TYPE_HMD_RIGHT)throw"make_stereo(): wrong camera type";b.type=c;l(b,6,.065)};a.set_stereo_params=l;a.get_camera_angles=q;a.get_camera_angles_from_quat=r;a.get_camera_angles_char=function(a,b){q(a,b);b[0]=S.angle_wrap_0_2pi(b[0]+Math.PI);b[1]*=-1;return b};a.get_angles=function(a,b){var c=V.get_quat_view(a.render.world_tsr),d=S.quat_to_dir(c,S.AXIS_MY,N),e=Math.asin(d[1]/
X.length(d));0==d[0]&&0==d[2]?c=0:(Math.abs(e)>Math.PI/4&&(d=0>=e?S.quat_to_dir(c,S.AXIS_MZ,Z):S.quat_to_dir(c,S.AXIS_Z,Z)),c=Math.atan(Math.abs(d[0]/d[2])),0<d[2]&&(c=Math.PI-c),0<d[0]&&(c=2*Math.PI-c));b[0]=c;b[1]=e;return b};a.set_frustum=g;a.set_frustum_asymmetric=function(b,c,d,e,h,f,g){switch(b.type){case a.TYPE_ORTHO_ASYMMETRIC:b.left=c;b.right=d;b.bottom=e;b.top=h;b.near=f;b.far=g;break;default:w.error("set_frustum_asymmetric(): Unsupported camera type: "+b.type)}};a.get_move_style=function(a){return a.render.move_style};
a.set_view=C;a.set_view_eye_target_up=f;a.set_view_trans_quat=function(a,b,c){var d=N;d[0]=0;d[1]=-1;d[2]=0;X.transformQuat(d,c,d);d[0]+=b[0];d[1]+=b[1];d[2]+=b[2];var e=Z;e[0]=0;e[1]=0;e[2]=-1;X.transformQuat(e,c,e);f(a,b,d,e)};a.set_look_at=h;a.update_camera_transform=n;a.update_camera=function(b){var c=b.render,d=b.render;if(d.move_style===a.MS_TARGET_CONTROLS||d.move_style===a.MS_EYE_CONTROLS){if(d.horizontal_limits){var h=d.horizontal_limits.left,f=d.horizontal_limits.right,g=q(b,oa);(g=d.move_style==
a.MS_TARGET_CONTROLS?S.calc_returning_angle(g[0],h,f):S.calc_returning_angle(g[0],f,h))&&(d.move_style==a.MS_TARGET_CONTROLS?z(b,g,0):e(b,g,0))}d.vertical_limits&&(h=d.vertical_limits.down,f=d.vertical_limits.up,g=q(b,oa),(g=d.move_style==a.MS_TARGET_CONTROLS?S.calc_returning_angle(g[1],f,h):S.calc_returning_angle(g[1],h,f))&&(d.move_style==a.MS_TARGET_CONTROLS?z(b,0,g):e(b,0,g)));if(d.move_style===a.MS_TARGET_CONTROLS&&d.distance_limits){var g=b.render,h=V.get_trans_view(g.world_tsr),f=X.subtract(h,
g.pivot,N),k=X.length(f);k>g.distance_limits.max?(X.scale(f,g.distance_limits.max/k,f),X.add(g.pivot,f,h)):k<g.distance_limits.min&&(k=V.get_quat_view(g.world_tsr),k=S.quat_to_dir(k,S.AXIS_MY,Z),X.scale(k,100*g.distance_limits.min,k),X.add(f,k,f),X.scale(f,-g.distance_limits.min/X.length(f),f),X.add(g.pivot,f,h))}}d.move_style===a.MS_HOVER_CONTROLS&&(d=b.render,d.hover_horiz_trans_limits&&(h=S.clamp(d.hover_pivot[0],d.hover_horiz_trans_limits.min,d.hover_horiz_trans_limits.max)-d.hover_pivot[0],d.hover_pivot[0]+=
h,g=V.get_trans_view(d.world_tsr),g[0]+=h),d.hover_vert_trans_limits&&(h=S.clamp(d.hover_pivot[2],d.hover_vert_trans_limits.min,d.hover_vert_trans_limits.max)-d.hover_pivot[2],d.hover_pivot[2]+=h,g=V.get_trans_view(d.world_tsr),g[2]+=h),d=b.render,g=q(b,oa)[1],(d=S.calc_returning_angle(g,d.vertical_limits.up,d.vertical_limits.down))&&y(b,0,d));D(b);switch(c.move_style){case a.MS_TARGET_CONTROLS:d=V.get_trans_view(c.world_tsr);g=V.get_quat_view(c.world_tsr);I.rotate_to(d,g,c.pivot);g=c.cameras;for(h=
0;h<g.length;h++)f=g[h],f.type!=a.TYPE_STEREO_LEFT&&f.type!=a.TYPE_STEREO_RIGHT||l(f,X.dist(d,c.pivot),f.stereo_eye_dist);I.correct_up(b,c.vertical_axis);break;case a.MS_EYE_CONTROLS:b.constraint||I.correct_up(b,c.vertical_axis)}A(b)};a.update_camera_upside_down=A;a.prepare_horizontal_limits=B;a.prepare_vertical_limits=F;a.update_ortho_scale=D;a.rotate_eye_camera=e;a.rotate_target_camera=z;a.rotate_hover_camera=y;a.is_float_aspect=function(b){switch(b.type){case a.TYPE_PERSP:case a.TYPE_ORTHO:case a.TYPE_STEREO_LEFT:case a.TYPE_STEREO_RIGHT:return!0;
default:return!1}};a.get_angular_diameter=function(b){b=b.render.cameras[0];switch(b.type){case a.TYPE_PERSP:case a.TYPE_PERSP_ASPECT:case a.TYPE_STEREO_LEFT:case a.TYPE_STEREO_RIGHT:return Math.PI*b.fov/180;default:return w.error("get_angular_diameter(): Unsupported camera type: "+b.type),0}};a.set_projection=u;a.calc_sky_vp_inverse=K;a.calc_view_proj_inverse=E;a.extract_frustum_corners=M;a.assign_boundings=function(a){a=a.render;var b=P.zero_bounding_box();b.min_x=-1;b.max_x=1;b.min_y=-1;b.max_y=
1;b.min_z=-1;b.max_z=1;a.bb_local=b;var c=P.create_bounding_sphere(1,[0,0,0]);a.bs_local=c;a.bcap_local=P.create_bounding_capsule(1,b);a.bcyl_local=P.create_bounding_cylinder(1,b);a.bcon_local=P.create_bounding_cone(1,b)};a.is_static_camera=function(b){return T.is_camera(b)&&b.render&&b.render.move_style==a.MS_STATIC};a.is_target_camera=function(b){return T.is_camera(b)&&b.render&&b.render.move_style==a.MS_TARGET_CONTROLS};a.is_eye_camera=function(b){return T.is_camera(b)&&b.render&&b.render.move_style==
a.MS_EYE_CONTROLS};a.is_hover_camera=J;a.is_ortho_camera=function(b){return T.is_camera(b)&&b.render&&b.render.cameras[0].type==a.TYPE_ORTHO};a.update_camera_shadows=O;a.csm_far_plane=G;a.project_point=function(b,c,d){b=b.render.cameras[0];switch(b.type){case a.TYPE_PERSP:case a.TYPE_PERSP_ASPECT:case a.TYPE_ORTHO:case a.TYPE_ORTHO_ASPECT:case a.TYPE_STEREO_LEFT:case a.TYPE_STEREO_RIGHT:case a.TYPE_HMD_LEFT:case a.TYPE_HMD_RIGHT:var e=ca;e.set(c);e[3]=1;la.transformMat4(e,b.view_proj_matrix,e);c=
-e[1]/e[3];d[0]=(e[0]/e[3]+1)/2*b.width;d[1]=(c+1)/2*b.height;aa.viewport_to_canvas_coords(d[0],d[1],d,b);2<d.length&&(d[2]=(e[2]/Math.abs(e[3])+1)/2);return d;default:return w.error("Non-compatible camera"),d}};a.get_first_cam=function(a){return a.render.cameras[0]};a.get_edge=function(b,c){switch(b.type){case a.TYPE_PERSP:case a.TYPE_PERSP_ASPECT:case a.TYPE_STEREO_LEFT:case a.TYPE_STEREO_RIGHT:var d=Math.tan(S.rad(b.fov)/2);switch(c){case "LEFT":return-d*b.aspect;case "RIGHT":return d*b.aspect;
case "TOP":return d;case "BOTTOM":return-d}break;case a.TYPE_ORTHO:case a.TYPE_ORTHO_ASPECT:switch(c){case "LEFT":return-b.top*b.aspect;case "RIGHT":return b.top*b.aspect;case "TOP":return b.top;case "BOTTOM":return-b.top}break;case a.TYPE_ORTHO_ASYMMETRIC:switch(c){case "LEFT":return b.left;case "RIGHT":return b.right;case "TOP":return b.top;case "BOTTOM":return b.bottom}break;case a.TYPE_HMD_LEFT:case a.TYPE_HMD_RIGHT:switch(c){case "LEFT":return Math.tan(S.rad(b.hmd_fov[3])/2);case "RIGHT":return Math.tan(S.rad(b.hmd_fov[1])/
2);case "TOP":return Math.tan(S.rad(b.hmd_fov[0])/2);case "BOTTOM":return Math.tan(S.rad(b.hmd_fov[2])/2)}break;default:S.panic("Unknown camera type")}};a.is_ortho=function(b){switch(b.type){case a.TYPE_ORTHO:case a.TYPE_ORTHO_ASPECT:case a.TYPE_ORTHO_ASYMMETRIC:return!0;default:return!1}};a.get_fov=function(b,c){switch(b.type){case a.TYPE_PERSP:case a.TYPE_PERSP_ASPECT:case a.TYPE_STEREO_LEFT:case a.TYPE_STEREO_RIGHT:var d=S.rad(b.fov);return c?d*b.aspect:d;default:return 0}};a.set_trans_pivot=function(a,
b,c){a=a.render;V.set_trans(b,a.world_tsr);X.copy(c,a.pivot)};a.hover_set_vertical_limits=function(a,b){var c=a.render;c.vertical_limits=c.vertical_limits||{};c.vertical_limits.down=b.down;c.vertical_limits.up=b.up;F(a);m(a)};a.apply_distance_limits=function(b,c){var d=b.render;c?(d.distance_limits=d.distance_limits||{},d.distance_limits.min=c.min,d.distance_limits.max=c.max,b.render.move_style==a.MS_HOVER_CONTROLS&&m(b)):d.distance_limits=null};a.set_hover_pivot=function(a,b){var c=a.render,d=X.subtract(b,
c.hover_pivot,N),e=V.get_trans_view(c.world_tsr),d=X.add(d,e,d);ea.set_translation(a,d);X.copy(b,c.hover_pivot)};a.set_target_pivot=function(a,b){var c=a.render,d=X.subtract(b,c.pivot,N),e=V.get_trans_view(c.world_tsr),d=X.add(d,e,d);ea.set_translation(a,d);X.copy(b,c.pivot)};a.get_eye=H;a.set_move_style=function(b,d){b.render.move_style=d;b.render.horizontal_limits=null;b.render.vertical_limits=null;b.render.distance_limits=null;b.render.hover_horiz_trans_limits=null;b.render.hover_vert_trans_limits=
null;b.render.cameras[0].type==a.TYPE_ORTHO&&c(b);switch(d){case a.MS_HOVER_CONTROLS:t(b);break;case a.MS_TARGET_CONTROLS:var e=H(b,N),h=V.get_quat_view(b.render.world_tsr),h=S.quat_to_dir(h,S.AXIS_MY,Z),e=X.scaleAndAdd(e,h,10,h);X.copy(e,b.render.pivot)}}};b4w.module.__lights=function(a,p){function t(a){k.scale(a.color,a.energy,a.color_intensity)}p("__print");var c=p("__tsr"),b=p("__util"),k=p("__vec3"),d=new Float32Array(3);new Float32Array(3);a.lamp_to_light=function(a,q){var r=a.data,g={name:"",type:r.type,prev_direction:new Float32Array(3),direction:new Float32Array(3),color:new Float32Array(3),color_intensity:new Float32Array(3),default_energy:0,spot_size:0,spot_blend:0,generate_shadows:!1,need_sun_fog_update:!1,dynamic_intensity:!1,use_diffuse:!0,
use_specular:!0,energy:1,distance:25,falloff_type:"INVERSE_SQUARE"},g=q.light=g;g.name=q.name;g.use_diffuse=r.use_diffuse;g.use_specular=r.use_specular;var p=c.get_quat_view(q.render.world_tsr),p=b.quat_to_dir(p,b.AXIS_Y,d);k.normalize(p,p);g.direction.set(p);g.color[0]=r.color[0];g.color[1]=r.color[1];g.color[2]=r.color[2];g.energy=g.default_energy=r.energy;t(g);g.distance=r.distance;if("POINT"===g.type||"SPOT"===g.type)g.distance=r.distance;"SPOT"===g.type?(g.spot_blend=r.spot_blend,g.spot_size=
r.spot_size):"POINT"===g.type&&(g.spot_size=Math.PI/2);g.generate_shadows=r.b4w_generate_shadows;g.dynamic_intensity=r.b4w_dynamic_intensity};a.set_light_color=function(a,b){a.color[0]=b[0];a.color[1]=b[1];a.color[2]=b[2];t(a)};a.set_light_spot_blend=function(a,b){a.spot_blend=b};a.set_light_distance=function(a,b){a.distance=b};a.set_light_spot_size=function(a,b){a.spot_size=b};a.set_light_energy=function(a,b){a.energy=b;t(a)};a.update_light_transform=function(a){if("LAMP"!=a.type)throw"Wrong light object";
var d=a.light;if(d){a=c.get_quat_view(a.render.world_tsr);b.quat_to_dir(a,b.AXIS_Y,d.direction);k.normalize(d.direction,d.direction);if("SUN"==d.type){a=Math.acos(k.dot(d.prev_direction,b.VEC3_UNIT));var r=Math.acos(k.dot(d.direction,b.VEC3_UNIT));d.need_sun_fog_update=Math.floor(a/.025)!=Math.floor(r/.025)?!0:!1}k.copy(d.direction,d.prev_direction)}}};b4w.module.__scenes=function(a,p){function t(a){for(var b=0;b<a.length;b++){var c=a[b];if(!c._render_to_textures||!c._render_to_textures.length)return c}return null}function c(){if(!Ua)throw"No active scene available";return Ua}function b(a,b,c){if(!va.depth_tex_available||!k(a,b,c))return null;c=a.b4w_shadow_settings;var d={};c.csm_resolution>va.max_texture_size?(d.csm_resolution=va.max_texture_size,ab.error("Shadow map texture has unsupported size. Changed to "+va.max_texture_size+".")):d.csm_resolution=
c.csm_resolution;a=Ba.get_shadow_lamps(b,va.ssao&&a.b4w_enable_ssao);d.self_shadow_polygon_offset=c.self_shadow_polygon_offset;d.self_shadow_normal_offset=c.self_shadow_normal_offset;d.enable_csm=c.b4w_enable_csm&&1==a.length;d.lamp_types=[];d.spot_sizes=[];d.distances=[];for(b=0;b<a.length;b++)d.lamp_types.push(a[b].light.type),d.spot_sizes.push(a[b].light.spot_size),d.distances.push(a[b].light.distance),"SPOT"!=d.lamp_types[b]&&"POINT"!=d.lamp_types[b]||!d.enable_csm||(ab.warn("Generating shadows for SPOT or POINT light. Disabling Cascaded Shadow Maps"),
d.enable_csm=!1);d.enable_csm?(d.csm_num=c.csm_num,d.csm_first_cascade_border=c.csm_first_cascade_border,d.first_cascade_blur_radius=c.first_cascade_blur_radius,d.csm_last_cascade_border=c.csm_last_cascade_border,d.last_cascade_blur_radius=c.last_cascade_blur_radius,d.fade_last_cascade=c.fade_last_cascade,d.blend_between_cascades=c.blend_between_cascades):(d.csm_num=1,d.csm_first_cascade_border=c.csm_first_cascade_border,d.first_cascade_blur_radius=c.first_cascade_blur_radius,d.csm_last_cascade_border=
c.csm_last_cascade_border,d.last_cascade_blur_radius=c.last_cascade_blur_radius,d.fade_last_cascade=!1,d.blend_between_cascades=!1);return d}function k(a,b,c){if(0!=b.length&&va.shadows)switch(a.b4w_render_shadows){case "OFF":return!1;case "ON":return!0}else return!1;var d=!1,e=!1;a=va.ssao&&a.b4w_enable_ssao;if(0==b.length&&!a)return!1;for(b=0;b<c.length;b++){var h=c[b];h.b4w_shadow_cast&&(d=!0);h.b4w_shadow_receive&&(e=!0);if((a||d)&&e)return!0}return!1}function d(a){for(var b=0;b<a.length;b++)if("SUN"==
a[b].light.type)return!0;return!1}function l(a){if(!va.shore_smoothing)return!1;a=na(a);for(var b=0;b<a.length;b++){var c=a[b];if(c.b4w_water&&c.b4w_water_shore_smoothing)return!0}return!1}function q(a){for(var b=0;b<a.length;b++)for(var c=a[b].particle_systems,d=0;d<c.length;d++)if(Ba.check_obj_soft_particles_accessibility(a[b],c[d].settings))return!0;return!1}function r(a){for(var b=na(a),c=[],d=0;d<b.length;d++){var e=b[d];if(e.b4w_water){for(var h={},f=0;f<a.length;f++)for(var g=a[f],k=g.data.materials,
l=0;l<k.length;l++)k[l]==e&&(h.water_level=g.location[1]);h.fog_color_density=e.b4w_water_fog_color.slice(0);h.fog_color_density.push(e.b4w_water_fog_density);e.b4w_water_dynamic?(h.dynamic=!0,h.waves_height=e.b4w_waves_height,h.waves_length=e.b4w_waves_length,h.dst_noise_scale0=e.b4w_water_dst_noise_scale0,h.dst_noise_scale1=e.b4w_water_dst_noise_scale1,h.dst_noise_freq0=e.b4w_water_dst_noise_freq0,h.dst_noise_freq1=e.b4w_water_dst_noise_freq1,h.dir_min_shore_fac=e.b4w_water_dir_min_shore_fac,h.dir_freq=
e.b4w_water_dir_freq,h.dir_noise_scale=e.b4w_water_dir_noise_scale,h.dir_noise_freq=e.b4w_water_dir_noise_freq,h.dir_min_noise_fac=e.b4w_water_dir_min_noise_fac,h.dst_min_fac=e.b4w_water_dst_min_fac,h.waves_hor_fac=e.b4w_water_waves_hor_fac):(h.dynamic=!1,h.waves_height=0,h.waves_length=0);h.caustics=e.b4w_water_enable_caust;h.caustic_scale=e.b4w_water_caust_scale;h.caustic_brightness=e.b4w_water_caust_brightness;h.caustic_speed=new Float32Array([.3,.7]);h.shoremap_image=null;e=e.texture_slots;for(f=
0;f<e.length;f++)g=e[f].texture,!0===g.b4w_shore_dist_map&&(h.shoremap_image=g.image,h.shoremap_tex_size=g.image.size[0],h.shore_boundings=g.b4w_shore_boundings,h.max_shore_dist=g.b4w_max_shore_dist);c.push(h)}}if(0<c.length){h=c[0];if(!h.dynamic)for(d=0;d<c.length;d++)c[d].dynamic&&(h=c[d]);return h}return null}function g(a){var b={refractions:!1};a=na(a);for(var c=function(a){if(a){a=a.nodes;for(var d=0;d<a.length;d++){var e=a[d];"GROUP"==e.type&&e.node_group&&c(e.node_group.node_tree);"GROUP"==
e.type&&"B4W_REFRACTION"==e.node_tree_name&&(b.refractions=!0)}}},d=0;d<a.length;d++){var e=a[d];e.b4w_refractive&&(b.refractions=!0);e.node_tree&&c(e.node_tree)}return b}function C(a,b){if(va.reflections)switch(a.b4w_render_reflections){case "OFF":return!1}else return!1;for(var c=[],d=0,e=0;e<b.length;e++){var h=b[e];h.render.reflective&&"CUBE"==h.render.reflection_type&&d++;if(h.reflective_objs.length){for(var f=null,g=0;g<c.length;g++)if(c[g]==h){f=g;break}null==f&&c.push(h)}}return{refl_plane_objs:c,
num_cube_refl:d,cube_refl_subs:[],plane_refl_subs:[]}}function f(a,b){var c=a.b4w_sky_settings,d={};d.render_sky=c.render_sky;d.procedural_skydome=c.procedural_skydome&&b;d.use_as_environment_lighting=c.use_as_environment_lighting;d.sky_color=c.color;d.rayleigh_brightness=c.rayleigh_brightness;d.mie_brightness=c.mie_brightness;d.spot_brightness=c.spot_brightness;d.scatter_strength=c.scatter_strength;d.rayleigh_strength=c.rayleigh_strength;d.mie_strength=c.mie_strength;d.rayleigh_collection_power=
c.rayleigh_collection_power;d.mie_collection_power=c.mie_collection_power;d.mie_distribution=c.mie_distribution;d.reflexible=c.reflexible;d.reflexible_only=c.reflexible_only;!b&&c.procedural_skydome&&ab.warn("There is no sun on the scene. Procedural sky won't be rendered");return d}function h(a){var b={};a=a.b4w_ssao_settings;b.radius_increase=a.radius_increase;b.hemisphere=a.hemisphere;b.blur_depth=a.blur_depth;b.blur_discard_value=a.blur_discard_value;b.influence=a.influence;b.dist_factor=a.dist_factor;
b.samples=a.samples;return b}function n(a){if(!(va.bloom&&a.b4w_enable_bloom&&a._render.sun_exist))return null;var b={};a=a.b4w_bloom_settings;b.blur=a.blur;b.edge_lum=a.edge_lum;b.key=a.key;return b}function A(a){var b={};a=a.b4w_motion_blur_settings;b.mb_decay_threshold=a.motion_blur_decay_threshold;b.mb_factor=a.motion_blur_factor;return b}function B(a){var b={};a=a.b4w_color_correction_settings;b.brightness=a.brightness;b.contrast=a.contrast;b.exposure=a.exposure;b.saturation=a.saturation;return b}
function F(a){var b={};a=a.b4w_god_rays_settings;b.intensity=a.intensity;b.max_ray_length=a.max_ray_length;b.steps_per_pass=a.steps_per_pass;return b}function D(a){var b={};b.outline_color=a.b4w_outline_color;b.outline_factor=a.b4w_outline_factor;return b}function e(a){var b={};a=a.b4w_glow_settings;b.small_glow_mask_coeff=a.small_glow_mask_coeff;b.large_glow_mask_coeff=a.large_glow_mask_coeff;b.small_glow_mask_width=a.small_glow_mask_width;b.large_glow_mask_width=a.large_glow_mask_width;return b}
function z(a,b){var c=a.light_settings,d={};d.environment_energy=c.environment_energy;d.use_environment_light=c.use_environment_light;d.environment_color=c.environment_color;d.horizon_color=a.horizon_color.slice(0);d.zenith_color=a.zenith_color.slice(0);d.use_sky_paper=a.use_sky_paper;d.use_sky_blend=a.use_sky_blend;d.use_sky_real=a.use_sky_real;d.sky_texture_slot=null;d.sky_texture_param=null;d.environment_texture_slot=null;if(d.use_environment_light&&"SKY_TEXTURE"==d.environment_color&&(!b.procedural_skydome||
!b.use_as_environment_lighting)){for(var c=null,e=0;e<a.texture_slots.length;e++)if(a.texture_slots[e].texture.b4w_use_as_environment_lighting){c=a.texture_slots[e];break}c?d.environment_texture_slot=c:(ab.warn("environment lighting is set to 'Sky Texture', but there is no world texture with 'Sky Texture Usage' property set to 'ENVIRONMENT_LIGHTING'"),d.use_environment_light=!1)}for(e=0;e<a.texture_slots.length;e++)if(a.texture_slots[e].texture.b4w_use_as_skydome){c=a.texture_slots[e];d.sky_texture_slot=
c;d.sky_texture_param={blend_factor:c.blend_factor,horizon_factor:c.horizon_factor,zenith_up_factor:c.zenith_up_factor,zenith_down_factor:c.zenith_down_factor,color:c.color,default_value:c.default_value,invert:c.invert,use_rgb_to_intensity:c.use_rgb_to_intensity,blend_type:c.blend_type,use_map_blend:c.use_map_blend,use_map_horizon:c.use_map_horizon,use_map_zenith_up:c.use_map_zenith_up,use_map_zenith_down:c.use_map_zenith_down};break}return d}function y(a){var b=a.fog_settings,c={};c.use_fog=b.use_fog;
c.intensity=b.intensity;c.depth=b.depth;c.start=b.start;c.height=b.height;c.falloff=b.falloff;c.color=b.use_custom_color?b.color.slice(0):a.horizon_color.slice(0);a=c.color;c.fog_color_density=new Float32Array([a[0],a[1],a[2],1/c.depth]);c.fog_params=new Float32Array([c.intensity,c.depth,c.start,c.height]);return c}function v(a){if(!va.dynamic_grass)return!1;for(var b=!1,c=!1,d=0;d<a.length;d++){for(var e=a[d],h=e.data.materials,f=0;f<h.length;f++)h[f].b4w_terrain&&(b=!0);e=e.particle_systems;for(f=
0;f<e.length;f++)h=e[f].settings,"HAIR"==h.type&&h.b4w_dynamic_grass&&(c=!0);if(b&&c)return!0}return!1}function m(a,b){if($c.outlining_overview_mode)return!0;if(va.enable_selectable)switch(a.b4w_enable_object_selection){case "OFF":return!1;case "ON":return!0;case "AUTO":for(var c=0;c<b.length;c++)if(b[c]._object.render.selectable)return!0;return!1}else return!1}function u(a,b){if($c.outlining_overview_mode)return!0;if(va.enable_outlining)switch(a.b4w_enable_outlining){case "OFF":return!1;case "ON":return!0;
case "AUTO":for(var c=0;c<b.length;c++)if(b[c]._object.render.outlining)return!0;return!1}else return!1}function K(a,b){if(va.glow_materials)switch(a.b4w_enable_glow_materials){case "OFF":return!1;case "ON":return!0;case "AUTO":for(var c=0;c<b.length;c++)for(var d=b[c].data.materials,e=0;e<d.length;e++)if(Ca.check_material_glow_output(d[e]))return!0;return!1}else return!1}function E(a,b){if(va.refractions)switch(a.b4w_render_refractions){case "OFF":return!1;case "ON":return!0;case "AUTO":return b.refractions}else return!1}
function M(a){for(var b=0;b<a.length;b++)for(var c=a[b].data.materials,d=0;d<c.length;d++){var e=c[d],h=e.game_settings.alpha_blend;if(e.b4w_render_above_all&&"OPAQUE"!=h&&"CLIP"!=h)return!0}return!1}function J(a,b){switch(a.b4w_enable_anchors_visibility){case "OFF":return!1;case "ON":return!0;case "AUTO":for(var c=0;c<b.length;c++){var d=b[c]._object;if(d.anchor&&d.anchor.detect_visibility)return!0}return!1}}function O(a,b,c){var d=ua.node_by_attr(a,b);ua.traverse_inputs(a,d,function(a,b,d){if(d.active){switch(d.from){case "COLOR":case "CUBEMAP":a=
b.camera.color_attachment;break;case "DEPTH":a=b.camera.depth_attachment;break;case "SCREEN":a=null;break;case "MAIN_CUBE_REFLECT":return;default:throw"Wrong slink";}switch(d.to){case "COLOR":case "CUBEMAP":case "DEPTH":case "NONE":case "SCREEN":case "OFFSCREEN":case "RESOLVE":case "COPY":case "u_cube_reflection":case "u_plane_reflection":break;default:if(!a)throw"Connection of SCREEN is forbidden";if(a.w_renderbuffer)throw"Batch texture can't use renderbuffer";ja.check_uniform(c.shader,d.to)&&R.append_texture(c,
a,d.to)}}});for(a=0;a<b.slinks_internal.length;a++){var d=b.slinks_internal[a],e=b.textures_internal[a];switch(d.to){case "COLOR":case "CUBEMAP":case "DEPTH":case "NONE":case "SCREEN":case "OFFSCREEN":case "RESOLVE":case "COPY":break;default:if(e.w_renderbuffer)throw"Batch texture can't use renderbuffer";ja.check_uniform(c.shader,d.to)&&R.append_texture(c,e,d.to)}}}function G(a,b){return{do_render:!0,do_render_cube:[!0,!0,!0,!0,!0,!0],obj_render:a,batch:b}}function x(a,b,c,d,e,h){for(var f=b.render,
g=Ba.get_scene_data(b,e).batches,k=0;k<g.length;k++){var l=g[k];if(!(l.shadow_cast_only||l.reflexible_only||"MAIN"!=l.type&&"NODES_GLOW"!=l.type&&"PARTICLES"!=l.type&&"LINE"!=l.type)&&("OPAQUE"==l.subtype&&"OPAQUE"==d||"BLEND"==l.subtype&&"BLEND"==d||"XRAY"==l.subtype&&"XRAY"==d||"NODES_GLOW"==l.type&&"GLOW"==d)){h||(H(l,a,b,c,d,e),R.update_shader(l),P(l));var m=G(f,l);a.bundles.push(m);O(c,a,l);I(l)}}var n=function(a,b){return a==b?0:a>b?1:-1};a.bundles.sort(function(a,b){return a.batch&&b.batch?
-n(a.batch.blend,b.batch.blend)||-n(a.batch.alpha_clip,b.batch.alpha_clip)||n(a.batch.offset_z,b.batch.offset_z):0})}function H(a,b,c,d,e,h){var f=c.render,g=Ba.get_scene_data(c,h),k="NO_SHADOWS";c=Z(h,["SHADOW_CAST"]);if(c.length&&a.shadow_receive){switch(e){case "OPAQUE":k="SHADOW_MAPPING_OPAQUE";break;case "BLEND":case "XRAY":k="SHADOW_MAPPING_BLEND";break;case "COLOR_ID":case "REFLECT":case "GLOW":k="NO_SHADOWS";break;case "DEPTH":k="SHADOW_MASK_GENERATION";break;default:throw"Wrong subscene type";
}for(var l=0;l<c.length;l++)R.assign_shadow_receive_dirs(a,h._render.shadow_params,c[l])}c=a.shaders_info;ja.set_directive(c,"SHADOW_USAGE",k);a.dynamic_grass&&(l=ia.find_subs(d,"GRASS_MAP"))&&aa(a,l,f);if("DEPTH"!=a.type&&"COLOR_ID"!=e||a.has_nodes){l=b.num_lights;ja.set_directive(c,"NUM_LIGHTS",l);ja.set_directive(c,"NUM_LFACTORS",0==l%2?l/2:Math.floor(l/2)+1);ja.set_directive(c,"REFLECTION_PASS",0);ja.set_directive(c,"SSAO_ONLY",0);ja.set_directive(c,"INVERT_FRONTFACING",0);b.water_params&&b.water_fog_color_density?
ja.set_directive(c,"WATER_EFFECTS",1):ja.set_directive(c,"WATER_EFFECTS",0);if(b.water_params&&b.caustics&&f.caustics){ja.set_directive(c,"CAUSTICS",1);if(l=h._render.shadow_params){f=l.lamp_types;for(l=e=0;l<f.length;l++)"SUN"==f[l]&&(e=l);ja.set_directive(c,"SUN_NUM",e)}ja.set_directive(c,"CAUST_SCALE",ja.glsl_value(b.caust_scale));ja.set_directive(c,"CAUST_SPEED",ja.glsl_value(b.caust_speed,2));ja.set_directive(c,"CAUST_BRIGHT",ja.glsl_value(b.caust_brightness))}else ja.set_directive(c,"CAUSTICS",
0);b.water_params&&(ja.set_directive(c,"WAVES_HEIGHT",ja.glsl_value(b.water_waves_height)),ja.set_directive(c,"WAVES_LENGTH",ja.glsl_value(b.water_waves_length)),ja.set_directive(c,"WATER_LEVEL",ja.glsl_value(b.water_level)));l=g.cube_refl_subs;f=g.plane_refl_subs;if(-1!==a.texture_names.indexOf("u_mirrormap"))ja.set_directive(c,"REFLECTION_TYPE","REFL_MIRRORMAP");else if(a.reflective&&l)g=l.camera.color_attachment,R.append_texture(a,g,"u_cube_reflection"),ja.set_directive(c,"REFLECTION_TYPE","REFL_CUBE");
else if(a.reflective&&f.length)for(l=0;l<f.length;l++)g=f[l].camera.color_attachment,R.append_texture(a,g,"u_plane_reflection"),ja.set_directive(c,"REFLECTION_TYPE","REFL_PLANE");else ja.set_directive(c,"REFLECTION_TYPE","REFL_NONE");(l=ia.find_subs(d,"SKY"))?a.procedural_sky?(g=l.camera.color_attachment,R.append_texture(a,g,"u_sky")):va.procedural_fog?(a.cube_fog=l.cube_fog,ja.set_directive(c,"PROCEDURAL_FOG",1)):ja.set_directive(c,"PROCEDURAL_FOG",0):ja.set_directive(c,"PROCEDURAL_FOG",0);g=h._render.world_light_set;
g.use_environment_light&&(ja.set_directive(c,"USE_ENVIRONMENT_LIGHT",1),"SKY_TEXTURE"==g.environment_color?(g=g.environment_texture_slot?R.get_batch_texture(g.environment_texture_slot,!1):l.camera.color_attachment,ja.set_directive(c,"SKY_TEXTURE",1),R.append_texture(a,g,"u_sky_texture")):"SKY_COLOR"==g.environment_color&&ja.set_directive(c,"SKY_COLOR",1));g=h._render.world_fog_set;g.use_fog&&(ja.set_directive(c,"USE_FOG",1),ja.set_directive(c,"FOG_TYPE",g.falloff));a.refractive?(va.depth_tex_available&&
ja.set_directive(c,"USE_REFRACTION_CORRECTION",1),"MAIN"==a.type&&a.has_nodes||"NODES_GLOW"==a.type?(ja.set_directive(c,"REFRACTIVE",1),h._render.refractions?ja.set_directive(c,"USE_REFRACTION",1):ja.set_directive(c,"USE_REFRACTION",0)):h._render.refractions?ja.set_directive(c,"REFRACTIVE",1):ja.set_directive(c,"REFRACTIVE",0)):(ja.set_directive(c,"REFRACTIVE",0),ja.set_directive(c,"USE_REFRACTION",0),ja.set_directive(c,"USE_REFRACTION_CORRECTION",0));a.water&&(va.shore_smoothing&&a.water_shore_smoothing&&
ia.find_subs(d,"DEPTH_PACK")?ja.set_directive(c,"SHORE_SMOOTHING",1):ja.set_directive(c,"SHORE_SMOOTHING",0),a.water_dynamic&&b.water_params&&b.water_waves_height?ja.set_directive(c,"DYNAMIC",1):ja.set_directive(c,"DYNAMIC",0));"PARTICLES"==a.type&&(ja.set_directive(c,"SIZE_RAMP_LENGTH",a.particles_data.size_ramp_length),ja.set_directive(c,"COLOR_RAMP_LENGTH",a.particles_data.color_ramp_length));if(!a.forked_batch)for(a=a.textures,b=0;b<a.length;b++)if(g=a[b],"SCENE"==g.source)for(d=0;d<Ya.length;d++)for(c=
Ya[d],l=Ya[d]._render_to_textures,f=0;f<l.length;f++)l[f]._render==g&&ua.append_edge_attr(Db,c,h,null)}}function P(a){var b=a.shader.attributes,c=a.bufs_data.pointers,d;for(d in b)c[d]||Da.panic('missing data for "'+d+'" attribute');if("MAIN"==a.type||"NODES_GLOW"==a.type)if(b=ja.get_varyings_count(a.shader.vshader),10<b&&("MAIN"==a.type&&ab.warn("Varying limit exceeded for main shader - "+b+', materials: "'+a.material_names.join(", ")+'"'),"MAIN"==a.type&&a.has_nodes||"NODES_GLOW"==a.type))d=c=0,
a.uv_maps_usage&&(c=Da.get_dict_length(a.uv_maps_usage)),a.vertex_colors_usage&&(d=Da.get_dict_length(a.vertex_colors_usage)),ab.warn("Varying limit exceeded for node shader - "+b+", uv: "+c+", vc: "+d+', materials: "'+a.material_names.join(", ")+'"')}function I(a){8<a.textures.length&&ab.warn(a.type,"too many textures used - "+a.textures.length+' (max 8), materials "'+a.material_names.join(", ")+'"')}function aa(a,b,c){a.grass_map_dim=b.grass_map_dim;var d=b.grass_map_dim[0],e=b.grass_map_dim[1],
h=b.grass_map_dim[2];c=c.bb_local;c=Math.max(c.max_x-c.min_x,c.max_z-c.min_z);h=0==h?c:Math.max(h,c);b.grass_map_dim[2]=h;b=b.camera;Fa.set_frustum(b,h/2,-e,-d,h/2);Fa.set_projection(b);d=a.grass_size||0;d=0==d?c:Math.max(d,c);a.grass_size=d}function U(a){ga(a);var b=ba(a,"MAIN_OPAQUE"),c=!0,d=a._render.shadow_params;ua.traverse(a._render.graph,function(e,h){"SHADOW_CAST"===h.type&&(w(h,a,b.camera,h.bundles,d,c),c=!1)})}function T(a){ua.traverse(a._render.graph,function(a,b){"OUTLINE"===b.type&&(b.draw_outline_flag=
1)})}function w(a,b,c,d,e,h){if(0!=d.length){var f=a.camera,g=cb.get_trans_value(c.world_tsr,Gc);cb.set_trans(g,f.world_tsr);cb.copy(c.view_tsr,f.shadow_cast_billboard_view_tsr);if("SUN"===e.lamp_types[a.shadow_lamp_index]||"HEMI"===e.lamp_types[a.shadow_lamp_index]){g=kb;L.zero_bounding_box(g);for(var k=0;k<d.length;k++){var l=d[k].obj_render;0==k?L.copy_bb(l.bb_world,g):L.expand_bounding_box(g,l.bb_world)}d=L.extract_bb_corners(g,jb);Da.positions_multiply_matrix(d,f.view_matrix,d);if(e.enable_csm){b=
Va.copy(c.csm_centers[a.csm_index],Gc);e=pa.invert(c.view_matrix,Pa);Da.positions_multiply_matrix(b,e,b);Da.positions_multiply_matrix(b,f.view_matrix,b);a=c.csm_radii[a.csm_index];if(h)for(Ea=0,Aa=-Infinity,h=2;h<d.length;h+=3)Ea=Math.min(Ea,d[h]),Aa=Math.max(Aa,d[h]);h=kb;h.max_x=b[0]+a;h.max_y=b[1]+a;h.max_z=Aa;h.min_x=b[0]-a;h.min_y=b[1]-a;h.min_z=Ea}else{c=h=kb;e=Rb;e.set(d);d=yc/9;g=pa.identity(Pa);pa.rotate(g,d,Da.AXIS_MZ,g);for(var l=k=-1,m=0;10>m;m++){var n=L.bb_from_coords(e,Sb),q=(n.max_x-
n.min_x)*(n.max_y-n.min_y);if(-1==k||q<k)k=q,l=m,L.copy_bb(n,c);Da.positions_multiply_matrix(e,g,e)}c=l*d;0<c&&(d=pa.identity(Pa),pa.rotate(d,c,Da.AXIS_MZ,d),pa.multiply(d,f.view_matrix,f.view_matrix),cb.from_mat4(f.view_matrix,f.view_tsr));c=h.max_x-h.min_x;d=h.max_y-h.min_y;c&&d&&(e=Math.abs(c-d)/2,2<c/d?(h.max_y+=e,h.min_y-=e):2<d/c&&(h.max_x+=e,h.min_x-=e));h.max_x+=.005;h.max_y+=.005;h.max_z+=.005;h.min_x-=.005;h.min_y-=.005;h.min_z-=.005;fa(a,b._render.graph)}Fa.set_frustum_asymmetric(f,h.min_x,
h.max_x,h.min_y,h.max_y,-h.max_z,-h.min_z);Fa.set_projection(f);Da.extract_frustum_planes(f.view_proj_matrix,f.frustum_planes)}else"SPOT"!==e.lamp_types[a.shadow_lamp_index]&&"POINT"!==e.lamp_types[a.shadow_lamp_index]||Fa.set_projection(f,f.aspect)}}function fa(a,b){for(var c=a.camera,d=ia.get_outputs(b,a),e=0;e<d.length;e++){var h=d[e];if("MAIN_OPAQUE"==h.type||"DEPTH"==h.type||"MAIN_BLEND"==h.type||"MAIN_XRAY"==h.type)if(va.mac_os_shadow_hack)h.v_light_tsr.set(c.view_tsr,9*a.shadow_lamp_index);
else{var f=cb.get_trans_view(c.view_tsr),g=cb.get_scale(c.view_tsr),k=cb.get_quat_view(c.view_tsr);Fc.set(f[0],f[1],f[2],g,Za);h.v_light_ts.set(Za,4*a.shadow_lamp_index);h.v_light_r.set(k,4*a.shadow_lamp_index)}}}function da(a,b,c,d,e){for(var h=b.render,f=Ba.get_scene_data(b,d).batches,g=0;g<f.length;g++){var k=f[g];"COLOR_ID"==k.type&&(e||(H(k,a,b,c,"COLOR_ID",d),R.update_shader(k),P(k)),"COLOR_PICKING"==a.type&&"COLOR_ID"==k.subtype||"COLOR_PICKING_XRAY"==a.type&&"COLOR_ID_XRAY"==k.subtype)&&(e||
(R.set_batch_directive(k,"USE_OUTLINE",0),R.update_shader(k),P(k)),k=G(h,k),a.bundles.push(k))}}function ea(a,b,c,d,e){d||(e.dynamic_grass&&(d=ia.find_subs(c,"GRASS_MAP"))&&aa(e,d,b),R.update_shader(e),P(e));b=G(b,e);a.bundles.push(b);O(c,a,e);I(e)}function V(a,b){S(a,b);for(var c=0;c<a.scenes_data.length;c++)for(var d=sb.get_scene_objs(a.scenes_data[c].scene,"ALL",-1),e=0;e<d.length;e++)d[e].parent==a&&V(d[e],b)}function S(a,b){a.render.hide=b;if(Ba.is_lamp(a))for(var c=0;c<a.scenes_data.length;c++)for(var d=
a.scenes_data[c],e=Z(d.scene,Nc),h=0;h<e.length;h++)la(a,d,e[h])}function X(a,b){for(var c=Z(b,Nc),d=a.light,e=a.render,h=Ba.get_scene_data(a,b),f=h.light_index,g=cb.get_trans_view(e.world_tsr),e=cb.get_quat_view(e.world_tsr),k=0;k<c.length;k++){var l=c[k];l.light_positions.set(g,3*f);l.light_directions.set(d.direction,3*f);l.light_color_intensities.set(d.color_intensity,3*f);switch(d.type){case "SUN":l.sun_quaternion.set(e);l.sun_intensity=d.color_intensity;"SKY"===l.type?(l.need_fog_update=d.need_sun_fog_update,
Va.copy(d.direction,l.sun_direction),oa(b,l)):Va.copy(d.direction,l.sun_direction);break;case "HEMI":case "POINT":case "SPOT":break;default:ab.error("Unknown light type: "+d.type+'".')}la(a,h,l);for(var m=0;m<l.bundles.length;m++){var n=l.bundles[m].batch;n.lamp_uuid_indexes&&R.set_lamp_data(n,a)}}c=ba(b,"MAIN_OPAQUE").camera;h=h.shadow_subscenes;d=b._render.shadow_params;for(k=0;k<h.length;k++)l=h[k],Fa.set_view_trans_quat(l.camera,g,e),w(l,b,c,l.bundles,d,!0),fa(l,b._render.graph)}function la(a,
b,c){var d=a.render;a=a.light;b=b.light_index;var e=zc;e[0]=a.use_diffuse&&!d.hide?1:0;e[1]=a.use_specular&&!d.hide?1:0;c.light_factors.set(e,2*b);c.need_perm_uniforms_update=!0}function ga(a){var b=sb.get_scene_objs(a,"LAMP",sb.DATA_ID_ALL),b=Ba.get_shadow_lamps(b,va.ssao&&a.b4w_enable_ssao);if(b.length)for(var c=0;c<b.length;c++)for(var d=b[c],e=d.render,h=cb.get_trans_value(e.world_tsr,Gc),e=cb.get_quat_value(e.world_tsr,Ac),f=0;f<d.scenes_data.length;f++){var g=d.scenes_data[f],k=g.shadow_subscenes;
if(g.scene==a)for(g=0;g<k.length;g++)Fa.set_view_trans_quat(k[g].camera,h,e)}}function oa(a,b){wb.draw(b);if(b.need_fog_update)for(var c=Z(a,["MAIN_OPAQUE","MAIN_BLEND","MAIN_XRAY","MAIN_GLOW"]),d=0;d<c.length;d++)for(var e=c[d].bundles,h=0;h<e.length;h++){var f=e[h];f.do_render&&(f=f.batch,R.check_batch_perm_uniform(f,"u_cube_fog")&&wb.update_batch_permanent_uniform(f,"u_cube_fog"))}}function na(a){for(var b=[],c=0;c<a.length;c++)for(var d=a[c].data,e=0;e<d.materials.length;e++){var h=d.materials[e];
-1==b.indexOf(h)&&b.push(h)}return b}function N(a,b,c){for(var d=a._render,e=a._camera.render.cameras,h=0;h<e.length;h++){var f=e[h];Fa.set_projection(f,b/c);d.shadow_params&&Fa.update_camera_shadows(f,d.shadow_params)}d.shadow_params&&(d.need_shadow_update=!0,ba(a,"DEPTH").need_perm_uniforms_update=!0,ba(a,"MAIN_BLEND").need_perm_uniforms_update=!0);var g=d.graph;ia.traverse_slinks(g,function(d,e,h,f){if(d.update_dim){f=d.size_mult_x*b;var k=d.size_mult_y*c;if(e)for(e=0;e<h.slinks_internal.length;e++)h.slinks_internal[e]==
d&&fb.resize(d.texture,f,k);else switch(fb.is_texture(d.texture)&&fb.resize(d.texture,f,k),d=h.camera,d.width=f,d.height=k,h.type){case "DOF":Q(a,{dof_power:h.camera.dof_power,dof_on:h.camera.dof_on});break;case "GLOW_COMBINE":ca(a,{small_glow_mask_width:h.small_glow_mask_width,large_glow_mask_width:h.large_glow_mask_width});break;case "BLOOM":sa(a,{bloom_blur:h.bloom_blur});break;case "OUTLINE":h=ia.find_input(g,h,"POSTPROCESSING");d=ia.find_input(g,h,"POSTPROCESSING");f=ia.find_input(g,d,"POSTPROCESSING");
k=ia.find_input(g,f,"POSTPROCESSING");ia.set_texel_size(h,1/b,1/c);ia.set_texel_size(d,1/b,1/c);ia.set_texel_size(f,1/b,1/c);ia.set_texel_size(k,1/b,1/c);break;default:ia.set_texel_size(h,1/b,1/c)}}})}function Z(a,b){for(var c=[],d=0;d<b.length;d++){var e=b[d];ua.traverse(a._render.graph,function(a,b){b.type==e&&c.push(b)})}return c}function ba(a,b){return ia.find_subs(a._render.graph,b)}function Q(a,b){var c=ba(a,"DOF");if(!c)return ab.error("DOF is not enabled on the scene. Check camera settings"),
0;var d=a._render.graph;"boolean"==typeof b.dof_on&&(c.camera.dof_on=b.dof_on);"number"==typeof b.dof_distance&&(c.camera.dof_distance=b.dof_distance);"number"==typeof b.dof_front&&(c.camera.dof_front=b.dof_front);"number"==typeof b.dof_rear&&(c.camera.dof_rear=b.dof_rear);if("number"==typeof b.dof_power){c.camera.dof_power=b.dof_power;var e=ia.find_input(d,c,"POSTPROCESSING"),d=ia.find_input(d,e,"POSTPROCESSING");ia.set_texel_size_mult(e,c.camera.dof_power);ia.set_texel_size(e,1/c.camera.width,1/
c.camera.height);ia.set_texel_size_mult(d,c.camera.dof_power);ia.set_texel_size(d,1/c.camera.width,1/c.camera.height)}}function sa(a,b){var c=ba(a,"LUMINANCE_TRUNCED"),d=ba(a,"BLOOM");if(!c||!d)return ab.error("Bloom is not enabled on the scene"),0;"number"==typeof b.bloom_key&&(c.bloom_key=b.bloom_key,c.need_perm_uniforms_update=!0);"number"==typeof b.bloom_edge_lum&&(c.bloom_edge_lum=b.bloom_edge_lum,c.need_perm_uniforms_update=!0);if("number"==typeof b.bloom_blur){var e=a._render.graph,c=ia.find_input(e,
d,"BLOOM_BLUR"),e=ia.find_input(e,c,"BLOOM_BLUR");d.bloom_blur=b.bloom_blur;ia.set_texel_size_mult(c,b.bloom_blur);ia.set_texel_size(c,1/d.camera.width,1/d.camera.height);ia.set_texel_size_mult(e,b.bloom_blur);ia.set_texel_size(e,1/d.camera.width,1/d.camera.height)}}function ca(a,b){var c=ba(a,"GLOW_COMBINE");if(!c)return ab.error("Glow is not enabled on the scene"),null;for(var d=a._render.graph,e=ia.get_inputs(d,c),h=0;h<e.length;++h){var f=e[h];if("POSTPROCESSING"===f.type&&"GLOW_MASK_LARGE"===
f.subtype)var g=f;if("POSTPROCESSING"===f.type&&"GLOW_MASK_SMALL"===f.subtype)var k=f}e=ia.find_input(d,g,"POSTPROCESSING");d=ia.find_input(d,k,"POSTPROCESSING");"number"==typeof b.small_glow_mask_coeff&&(c.small_glow_mask_coeff=b.small_glow_mask_coeff,c.need_perm_uniforms_update=!0);"number"==typeof b.large_glow_mask_coeff&&(c.large_glow_mask_coeff=b.large_glow_mask_coeff,c.need_perm_uniforms_update=!0);"number"==typeof b.small_glow_mask_width&&(c.small_glow_mask_width=b.small_glow_mask_width,ia.set_texel_size_mult(k,
b.small_glow_mask_width),ia.set_texel_size(k,1/c.camera.width,1/c.camera.height),k.need_perm_uniforms_update=!0,ia.set_texel_size_mult(d,b.small_glow_mask_width),ia.set_texel_size(d,1/c.camera.width,1/c.camera.height),d.need_perm_uniforms_update=!0);"number"==typeof b.large_glow_mask_width&&(c.large_glow_mask_width=b.large_glow_mask_width,ia.set_texel_size_mult(g,b.large_glow_mask_width),ia.set_texel_size(g,1/c.camera.width,1/c.camera.height),g.need_perm_uniforms_update=!0,ia.set_texel_size_mult(e,
b.large_glow_mask_width),ia.set_texel_size(e,1/c.camera.width,1/c.camera.height),e.need_perm_uniforms_update=!0)}function Ga(a,b){var c=ba(Ua,"MAIN_OPAQUE");if(!c||!c.water_params)return ab.error("get_water_surface_level() - no water parameters on the scene"),0;var d=c.water_waves_height,e=c.water_waves_length,h=c.water_level,f=c.water_params;if(!d||!f.dynamic)return f.water_level;var g=Va.length(c.wind),k=c.time;g&&(k*=g);var l=zc;l[0]=20/e*(a-.25*k);l[1]=20/e*(b-.25*k);g=Da.cellular2x2(l);l[0]=
17/e*(b+.1*k);l[1]=17/e*(a+.1*k);var l=Da.cellular2x2(l),g=g+l-1,m=f.dst_noise_scale0,l=f.dst_noise_scale1,n=f.dst_noise_freq0,q=f.dst_noise_freq1,r=zc;r[0]=m*(a+n*k);r[1]=m*(b+n*k);m=Da.snoise(r);r[0]=l*(b-q*k);r[1]=l*(a-q*k);l=Da.snoise(r);l*=d*m;if(c.use_shoremap)if(q=(a-c.shoremap_center[0])/c.shoremap_size[0],r=(c.shoremap_center[1]+b)/c.shoremap_size[1],q+=.5,r+=.5,1<q||0>q||1<r||0>r)d=l;else var q=Da.get_array_smooth_value(Ua._render.shore_distances,c.shoremap_tex_size,q,r),r=f.dir_min_shore_fac,
m=f.dir_freq,R=f.dir_noise_scale,p=f.dir_noise_freq,n=f.dir_min_noise_fac,f=f.dst_min_fac,c=e/c.max_shore_dist/Math.PI,R=[R/e*(a+p*k),R/e*(b+p*k)],e=Math.sqrt(q),d=d*Math.max(q,r)*Math.sin(e/c+m*k)*Math.max(Da.snoise(R),n),k=Math.max(e,f),d=d*(1-k)+l*k,g=g*q;else d=l;return h+(d+.05*g)}function ka(a,b,c){b.is_for_outline&&"POSTPROCESSING"==b.type&&c.do_render!=b.do_render&&(b.do_render=c.do_render);c.do_render||"OUTLINE"!=b.type||(b.draw_outline_flag=0)}function xa(a,b,c,d){var e=ua.get_node_attr(a,
b);Fa.set_attachment(e.camera,c,d);e.assign_texture=!0;ua.traverse_outputs(a,b,function(b,e,h){h.active&&h.from==c&&ia.check_slink_tex_conn(h)&&ra(a,b,h.to,d)});ua.traverse_inputs(a,b,function(b,e,h){h.active&&h.from==c&&h.from==h.to&&xa(a,b,c,d)})}function ra(a,b,c,d){a=ua.get_node_attr(a,b).bundles;for(b=0;b<a.length;b++)R.replace_texture(a[b].batch,d,c)}function qa(a){var b=ba(a,"GRASS_MAP");if(b){var c=b.camera,d=a._camera.render;a=cb.get_trans_view(d.world_tsr);var e=Gc;e[0]=0;e[1]=-b.grass_map_dim[2]/
2;e[2]=0;b=cb.get_quat_view(d.world_tsr);Va.transformQuat(e,b,e);e[0]+=a[0];e[1]=0;e[2]+=a[2];b=Ac;b[0]=0;b[1]=0;b[2]=0;b[3]=1;Fa.set_view_trans_quat(c,e,b)}}function ha(a,b){ua.traverse(a,function(c,d){if("MOTION_BLUR"==d.type){if(!d.slinks_internal[0]||!d.textures_internal[0])throw"Wrong MOTION_BLUR subscene";var e=d.slinks_internal[0],h=d.textures_internal[0];d.textures_internal[0]=d.camera.color_attachment;ua.traverse_outputs(a,c,function(b,c,d){d.active&&ra(a,b,d.to,h)});xa(a,c,e.from,h);ra(a,
c,e.to,d.textures_internal[0]);d.motion_blur_exp=Math.exp(-b/d.mb_factor)}})}function ma(a){return a._render.wind}var R=p("__batch"),L=p("__boundings"),Fa=p("__camera");p("__compat");var Y=p("__config"),za=p("__container");p("__constraints");var W=p("__debug"),La=p("__geometry"),ua=p("__graph"),Cb=p("__hud");p("__lights");var pa=p("__mat4"),Ca=p("__nodemat"),sb=p("__objects"),Ba=p("__obj_util"),Vb=p("__physics"),fd=p("__prerender"),gd=p("__primitives"),ab=p("__print"),wb=p("__renderer"),ia=p("__scenegraph"),
Ec=p("__sfx"),ja=p("__shaders"),fb=p("__textures"),cb=p("__tsr"),Da=p("__util"),Va=p("__vec3"),Fc=p("__vec4"),va=Y.defaults,$c=Y.outlining,Wb=Y.scenes,Qb="GRASS_MAP SHADOW_CAST MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_GLOW MAIN_PLANE_REFLECT MAIN_CUBE_REFLECT COLOR_PICKING COLOR_PICKING_XRAY DEPTH OUTLINE_MASK WIREFRAME".split(" ");a.OBJECT_SUBSCENE_TYPES=Qb;var Nc="MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_GLOW MAIN_PLANE_REFLECT MAIN_CUBE_REFLECT GOD_RAYS GOD_RAYS_COMBINE SKY LUMINANCE_TRUNCED DEPTH SHADOW_CAST COLOR_PICKING COLOR_PICKING_XRAY OUTLINE_MASK".split(" "),
Rc="MAIN_OPAQUE SSAO MAIN_BLEND MAIN_XRAY MAIN_GLOW MAIN_PLANE_REFLECT MAIN_CUBE_REFLECT".split(" "),nd="SHADOW_CAST MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_GLOW MAIN_PLANE_REFLECT MAIN_CUBE_REFLECT COLOR_PICKING COLOR_PICKING_XRAY DEPTH GOD_RAYS OUTLINE_MASK WIREFRAME".split(" "),xc="MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_GLOW MAIN_PLANE_REFLECT MAIN_CUBE_REFLECT".split(" "),Mb=null,Ua=null,Ya=[],Db=null,yc=Math.PI/2,zc=new Float32Array(2),Gc=new Float32Array(3),Ac=new Float32Array(4),Za=new Float32Array(4),
Pa=new Float32Array(16),jb=new Float32Array(24),Rb=new Float32Array(24),kb=L.zero_bounding_box(),Sb=L.zero_bounding_box(),Ea=0,Aa=-Infinity;a.create_scene_render=function(){return{}};a.set_active=function(a){Ua=a;Ec.set_active_scene(a)};a.prepare_rendering=function(a,b){var c=a._render,d=ia.create_rendering_queue(c.graph);if(a==b){N(a,za.get_viewport_width(),za.get_viewport_height());for(var e=0;e<d.length;e++)a._render.queue.push(d[e])}else for(e=a._render_to_textures[0],N(a,e._render.source_size,
e._render.source_size),e=0;e<d.length;e++)b._render.queue.push(d[e]);d=Z(a,nd);for(e=0;e<d.length;e++)d[e].wind.set(c.wind);for(e=0;e<c.queue.length;e++)"SHADOW_CAST"==c.queue[e].type&&wb.draw(c.queue[e])};a.get_main=function(){Mb||(Mb=t(Ya));return Mb};a.find_main_scene=t;a.get_active=c;a.check_active=function(){return Ua?!0:!1};a.get_camera=function(a){return a._camera};a.get_all_scenes=function(){return Ya};a.get_rendered_scenes=function(){if(1==Ya.length)return Ya;for(var a=0;a<Ya.length;a++){var b=
Ya[a]._render.graph;ua.traverse(b,function(b,c){for(var d=0;d<c.bundles.length;d++){for(var e=c.bundles[d].batch.textures,h=null,f=0;f<e.length;f++)if("SCENE"==e[f].source&&e[f].source_id==Ya[a].name&&"COPY"!=c.type){ab.error('Texture-scene loop detected. A scene is rendered to texture "'+e[f].name+'" yet this texture belongs to the same scene.');ua.node_by_attr(Db,Ya[a]);h=c.bundles[d].batch;break}h&&(h.textures=[],h.texture_names=[],R.update_batch_material_debug(h,null),R.update_shader(h))}})}for(var c=
[],a=0;a<Ya.length;a++)if(b=Ya[a],!b._render_to_textures.length){b=ua.node_by_attr(Db,b);ua.enforce_acyclic(Db,b);b=ua.subgraph_node_conn(Db,b,ua.BACKWARD_DIR);b=ua.topsort(b);ua.traverse(b,function(a,b){c.push(b)});break}return c};a.append_scene=function(a,c,k,R,p){a._render_to_textures=a._render_to_textures||[];a._nla=null;var W=a._render,L=a._camera.render;W.video_textures=[];var N=a.world;W.lamps_number=k.length;W.sun_exist=d(k);W.sky_params=f(N,W.sun_exist);W.world_light_set=z(N,W.sky_params);
W.world_fog_set=y(N);W.anchor_visibility=J(a,p);L.cameras[0].type!=Fa.TYPE_PERSP&&"HMD"==va.stereo?(ab.warn("Head-mounted display stereo is disabled for the non-perspective camera"),p=!1):p="HMD"==va.stereo;W.hmd_stereo_use=p;L.cameras[0].type!=Fa.TYPE_PERSP&&"ANAGLYPH"==va.stereo?(ab.warn("Anaglyph stereo is disabled for the non-perspective camera"),p=!1):p="ANAGLYPH"==va.stereo;W.anaglyph_use=p;W.reflection_params=C(a,c);W.bloom_params=n(a);W.mb_params=A(a);W.cc_params=B(a);W.god_rays_params=F(a);
W.outline_params=D(a);W.glow_params=e(a);W.dof=va.dof&&(0<L.dof_distance||L.dof_object);W.motion_blur=va.motion_blur&&a.b4w_enable_motion_blur;W.compositing=va.compositing&&a.b4w_enable_color_correction;W.antialiasing=va.antialiasing&&1==va.msaa_samples&&"NONE"!=a.b4w_antialiasing_quality;W.ssao=va.ssao&&a.b4w_enable_ssao;W.god_rays=va.god_rays&&a.b4w_enable_god_rays&&W.sun_exist;W.depth_tex=va.depth_tex_available;W.glow_over_blend=a.b4w_glow_settings.render_glow_over_blend;W.ssao_params=h(a);p=g(R);
W.materials_params=p;W.refractions=E(a,p);W.shadow_params=b(a,k,R);W.water_params=r(R);W.xray=M(R);W.soft_particles=q(R);W.shore_smoothing=l(R);W.dynamic_grass=v(R);W.color_picking=m(a,R);W.outline=u(a,R);W.glow_materials=K(a,R);switch(a.b4w_reflection_quality){case "LOW":W.cubemap_refl_size=Wb.cube_reflect_low;W.plane_refl_size=Wb.plane_reflect_low;break;case "MEDIUM":W.cubemap_refl_size=Wb.cube_reflect_medium;W.plane_refl_size=Wb.plane_reflect_medium;break;case "HIGH":W.cubemap_refl_size=Wb.cube_reflect_high;
W.plane_refl_size=Wb.plane_reflect_high;break;default:W.cubemap_refl_size=Wb.cube_reflect_low,W.plane_refl_size=Wb.plane_reflect_low}if(za.is_hidpi())ab.log("%cENABLE HIDPI MODE","color: #00a"),W.aa_quality="AA_QUALITY_LOW",W.resolution_factor=1,va.msaa_samples=1;else if(1<va.msaa_samples)ab.log("%cENABLE MSAA RENDERING: "+va.msaa_samples+"x","color: #00a"),W.resolution_factor=1;else{W.aa_quality="AA_QUALITY_"+a.b4w_antialiasing_quality;switch(a.b4w_antialiasing_quality){case "LOW":W.antialiasing&&
(W.resolution_factor=1);break;case "MEDIUM":va.quality==Y.P_LOW||va.quality==Y.P_HIGH?W.resolution_factor=1:va.quality==Y.P_ULTRA&&(W.resolution_factor=1.33);break;case "HIGH":va.quality==Y.P_LOW?W.resolution_factor=1:va.quality==Y.P_HIGH?W.resolution_factor=1.33:va.quality==Y.P_ULTRA&&(W.resolution_factor=2);break;case "NONE":va.quality==Y.P_LOW||va.quality==Y.P_HIGH?W.resolution_factor=1:va.quality==Y.P_ULTRA&&(W.resolution_factor=2)}va.quality==Y.P_CUSTOM&&(W.resolution_factor=1)}k=a._render_to_textures.sort(function(a,
b){return b._render.source_size-a._render.source_size});W.graph=ia.create_rendering_graph(W,L,k);W.queue=[];W.need_shadow_update=!1;W.need_grass_map_update=!1;W.need_outline=!1;W.wind=new Float32Array(3);Ya.push(a);Db||(Db=ua.create());ua.append_node_attr(Db,a);for(W=0;W<c.length;W++)Ba.scene_data_set_active(c[W],!0,a);a=za.get_container();za.resize(a.clientWidth,a.clientHeight,!0)};a.append_scene_vtex=function(a,b,c){for(var d=0;d<b.length;d++)b[d]._render&&b[d]._render.is_movie&&(b[d]._render.vtex_data_id=
c,a._render.video_textures.push(b[d]))};a.get_graph=function(a){return a._render.graph};a.generate_auxiliary_batches=function(a){ua.traverse(a,function(b,c){var d=null;switch(c.type){case "POSTPROCESSING":d=R.create_postprocessing_batch(c.pp_effect);break;case "SSAO":d=R.create_ssao_batch(c);break;case "SSAO_BLUR":d=R.create_ssao_blur_batch(c);break;case "DEPTH_PACK":d=R.create_depth_pack_batch();break;case "GOD_RAYS":d=ia.find_input(a,c,"RESOLVE")||ia.find_input(a,c,"WIREFRAME")||ia.find_input(a,
c,"MAIN_BLEND")||ia.find_input(a,c,"GOD_RAYS");d=R.create_god_rays_batch(d.camera.color_attachment,c.pack,c.water,c.steps_per_pass);break;case "GOD_RAYS_COMBINE":var d=ia.find_input(a,c,"RESOLVE")||ia.find_input(a,c,"WIREFRAME")||ia.find_input(a,c,"MAIN_BLEND"),e=ia.find_input(a,c,"GOD_RAYS"),d=R.create_god_rays_combine_batch(d.camera.color_attachment,e.camera.color_attachment);break;case "MOTION_BLUR":d=R.create_motion_blur_batch(c.mb_decay_threshold);break;case "DOF":var d=R.create_dof_batch(),
e=ia.find_input(a,c,"POSTPROCESSING"),h=ia.find_input(a,e,"POSTPROCESSING");ia.set_texel_size_mult(e,c.camera.dof_power);ia.set_texel_size_mult(h,c.camera.dof_power);break;case "OUTLINE":var d=R.create_outline_batch(),e=ia.find_input(a,c,"POSTPROCESSING"),h=ia.find_input(a,e,"POSTPROCESSING"),f=ia.find_input(a,h,"POSTPROCESSING"),g=ia.find_input(a,f,"POSTPROCESSING");ia.set_texel_size_mult(h,c.blur_texel_size_mult);ia.set_texel_size_mult(e,c.blur_texel_size_mult);ia.set_texel_size_mult(g,c.ext_texel_size_mult*
c.outline_factor);ia.set_texel_size_mult(f,c.ext_texel_size_mult*c.outline_factor);break;case "GLOW_COMBINE":d=R.create_glow_combine_batch();break;case "COMPOSITING":d=R.create_compositing_batch();break;case "ANTIALIASING":d=R.create_antialiasing_batch(c);break;case "SMAA_RESOLVE":case "SMAA_EDGE_DETECTION":case "SMAA_BLENDING_WEIGHT_CALCULATION":case "SMAA_NEIGHBORHOOD_BLENDING":d=R.create_smaa_batch(c.type);break;case "STEREO":d=R.create_stereo_batch(c.subtype);break;case "SKY":d=R.create_procedural_sky_batch();
break;case "LUMINANCE":d=R.create_luminance_batch();break;case "AVERAGE_LUMINANCE":d=R.create_average_luminance_batch();break;case "LUMINANCE_TRUNCED":d=R.create_luminance_trunced_batch();break;case "BLOOM_BLUR":d=R.create_bloom_blur_batch();break;case "BLOOM":d=ia.find_input(a,c,"BLOOM_BLUR");e=ia.find_input(a,d,"BLOOM_BLUR");ia.set_texel_size_mult(d,c.bloom_blur);ia.set_texel_size_mult(e,c.bloom_blur);d=R.create_bloom_combine_batch();break;case "VELOCITY":d=R.create_velocity_batch();break;case "ANCHOR_VISIBILITY":d=
R.create_anchor_visibility_batch();break;case "PERFORMANCE":d=R.create_performance_batch()}d&&(e=G(Ba.create_render("NONE"),d),P(d),c.bundles.push(e),O(a,c,d),I(d))})};a.append_object=function(a,b,c){switch(b.type){case "MESH":case "LINE":var d=a._render.graph,e=b.render;!ia.find_subs(d,"SHADOW_CAST")&&e.shadow_receive&&(e.shadow_receive=!1);var h=Z(a,Qb);c&&b.use_obj_physics&&Vb.append_object(b,a);for(e=0;e<h.length;e++){var f=h[e],g=b,k=d,l=a,m=c;switch(f.type){case "MAIN_OPAQUE":x(f,g,k,"OPAQUE",
l,m);break;case "MAIN_BLEND":x(f,g,k,"BLEND",l,m);break;case "MAIN_XRAY":x(f,g,k,"XRAY",l,m);break;case "MAIN_GLOW":x(f,g,k,"GLOW",l,m);break;case "MAIN_PLANE_REFLECT":case "MAIN_CUBE_REFLECT":for(var n=g.render,q=Ba.get_scene_data(g,l).batches,r=0;r<q.length;r++){var W=q[r];if(("MAIN"==W.type||"PARTICLES"==W.type||"LINE"==W.type)&&"REFLECT"==W.subtype){if("MAIN_PLANE_REFLECT"==f.type){var p;a:{p=l._render.reflection_params.plane_refl_subs;for(var z=0;z<p.length;z++)for(var v=0;v<p[z].length;v++)if(p[z][v]==
f){p=z;break a}p=null}if(p==n.plane_reflection_id)continue}else{a:{if(l._render.reflection_params)for(p=l._render.reflection_params.cube_refl_subs,z=0;z<p.length;z++)if(p[z]==f){p=z;break a}p=null}if(p==n.cube_reflection_id)continue}m||(H(W,f,g,k,"REFLECT",l),p=W.shaders_info,ja.set_directive(p,"WATER_EFFECTS",0),ja.set_directive(p,"REFLECTION_PASS",1),ja.set_directive(p,"TEXTURE_NORM",0),"MAIN_PLANE_REFLECT"==f.type&&ja.set_directive(p,"INVERT_FRONTFACING",1),R.update_shader(W),P(W));W=G(n,W);f.bundles.push(W)}}break;
case "DEPTH":n=Ba.get_scene_data(g,l).batches;for(q=0;q<n.length;q++)r=n[q],"DEPTH"!=r.type||r.shadow_cast_only||!r.shadow_receive||"DEPTH"!=r.subtype&&"NODES"!=r.subtype||(m||(H(r,f,g,k,"DEPTH",l),R.update_shader(r),P(r)),W=G(g.render,r),f.bundles.push(W),O(k,f,r),I(r));break;case "SHADOW_CAST":n=!1;q=g.render;g=Ba.get_scene_data(g,l).batches;r=ia.find_subs(k,"GRASS_MAP");for(W=0;W<g.length;W++)p=g[W],"DEPTH"==p.type&&"SHADOW_CAST"==p.subtype&&(n=!0,m||(z=f.num_lights,R.set_batch_directive(p,"NUM_LIGHTS",
z),R.set_batch_directive(p,"NUM_LFACTORS",0==z%2?z/2:Math.floor(z/2)+1),ja.set_directive(p.shaders_info,"SHADOW_USAGE","SHADOW_CASTING"),p.dynamic_grass&&r&&aa(p,r,q),R.set_batch_directive(p,"SHADOW_TEX_RES",ja.glsl_value(l._render.shadow_params.csm_resolution)),R.update_shader(p),P(p)),p=G(q,p),f.bundles.push(p));n&&(g=l._render.shadow_params,m=ia.find_subs(k,"MAIN_OPAQUE"),w(f,l,m.camera,f.bundles,g,!0));break;case "COLOR_PICKING":da(f,g,k,l,m);break;case "COLOR_PICKING_XRAY":da(f,g,k,l,m);break;
case "OUTLINE_MASK":k=g.render;g=Ba.get_scene_data(g,l).batches;for(l=0;l<g.length;l++)n=g[l],"COLOR_ID"==n.type&&"OUTLINE"==n.subtype&&(m||(R.set_batch_directive(n,"USE_OUTLINE",1),R.update_shader(n),P(n)),n=G(k,n),f.bundles.push(n));break;case "GRASS_MAP":k=g.render;g=Ba.get_scene_data(g,l).batches;for(l=0;l<g.length;l++)n=g[l],"GRASS_MAP"==n.type&&(m||(R.update_shader(n),P(n)),n=G(k,n),f.bundles.push(n),n=f.camera,p=k.bb_world,q=f.grass_map_dim[0],r=f.grass_map_dim[1],W=f.grass_map_dim[2],0==q&&
0==r?(q=p.min_y,r=p.max_y):(q=Math.min(q,p.min_y),r=Math.max(r,p.max_y)),p=1E-4*(r-q),f.grass_map_dim[0]=q-p,f.grass_map_dim[1]=r+p,Fa.set_frustum(n,W/2,-r,-q,W/2),Fa.set_projection(n));break;case "WIREFRAME":for(n=g.render,g=Ba.get_scene_data(g,l).batches,l=0;l<g.length;l++)q=g[l],"WIREFRAME"==q.type&&ea(f,n,k,m,q)}}for(e=0;e<b.scenes_data.length;e++)for(c=b.scenes_data[e].batches,d=0;d<c.length;d++)null==c[d].shader&&c.splice(d--,1);break;case "LAMP":X(b,a),sb.sort_lamps(a)}Ba.scene_data_set_active(b,
!0,a)};a.schedule_shadow_update=function(a){a._render.need_shadow_update=!0};a.update_shadow_billboard_view=function(a,b){var c=a.render.cameras[0];ua.traverse(b,function(a,b){if("SHADOW_CAST"===b.type){var d=cb.get_trans_view(c.world_tsr);cb.set_trans(d,b.camera.world_tsr);cb.copy(c.view_tsr,b.camera.shadow_cast_billboard_view_tsr)}})};a.update_shadow_receive_subs=fa;a.get_csm_borders=function(a,b){for(var c=a._render.shadow_params,d=new Float32Array(c.csm_num),e=0;e<c.csm_num;e++)d[e]=Fa.csm_far_plane(c,
b,e);return d};a.append_wireframe_batch=ea;a.change_visibility_rec=V;a.change_visibility=S;a.is_hidden=function(a){return a.render.hide};a.remove_object_bundles=function(a,b,c){b=b.render;a=Z(a,Qb);for(var d=0;d<a.length;d++)for(var e=a[d].bundles,h=e.length-1;0<=h;h--){var f=e[h];f.obj_render==b&&(f.batch&&c&&La.cleanup_bufs_data(f.batch.bufs_data),e.splice(h,1))}};a.update_lamp_scene_color_intensity=function(a,b){for(var c=a.light,d=Ba.get_scene_data(a,b).light_index,e=Z(b,Nc),h=0;h<e.length;h++){var f=
e[h];f.light_color_intensities.set(c.color_intensity,3*d);f.need_perm_uniforms_update=!0}};a.update_lamp_scene=X;a.cleanup=function(){for(var a=0;a<Ya.length;a++){var b=Ya[a];ua.traverse(b._render.graph,function(a,b){if("SINK"!=b.type){var c=b.camera;wb.render_target_cleanup(c.framebuffer,c.color_attachment,c.depth_attachment,c.width,c.height);for(var c=b.bundles,d=0;d<c.length;d++){var e=c[d].batch;e&&R.clear_batch(e)}}});b._render.graph=[];b._render.queue=[]}Ua=Mb=null;Ya.length=0;Db=null};a.make_frustum_shot=
function(a,b,c){a=Fa.extract_frustum_corners(a,a.near,a.far,null,!0);var d=gd.generate_frustum(a);a=Ba.create_render("DYNAMIC");a.bb_world=a.bb_local=L.big_bounding_box();a.bs_world=a.bs_local=L.big_bounding_sphere();var e=a.bs_world.radius;a.be_world=a.be_local=L.create_bounding_ellipsoid([e,0,0],[0,e,0],[0,0,e],a.bs_world.center);c=R.create_shadeless_batch(d,c,.5);c=G(a,c);b.bundles.push(c)};a.get_scene_timeline=function(a){return[a.frame_start,a.frame_end]};a.setup_dim=function(a,b,c){za.setup_viewport_dim(a,
b,c);Ua&&N(Ua,a,b)};a.setup_scene_dim=N;a.subs_array=Z;a.get_subs=ba;a.get_environment_colors=function(a){a=Z(a,Nc)[0];var b=a.horizon_color,c=a.zenith_color,d=[],e=[];d[0]=b[0];d[1]=b[1];d[2]=b[2];e[0]=c[0];e[1]=c[1];e[2]=c[2];return[a.environment_energy,d,e]};a.set_environment_colors=function(a,b,c,d){a=Z(a,Nc);for(var e=0;e<a.length;e++){var h=a[e];isNaN(b)||(h.environment_energy=b);c&&h.horizon_color.set(c);d&&h.zenith_color.set(d);h.need_perm_uniforms_update=!0}};a.get_sky_params=function(a){if(a=
ba(a,"SKY")){var b={};b.color=Array(3);Va.copy(a.sky_color,b.color);b.procedural_skydome=a.procedural_skydome;b.use_as_environment_lighting=a.use_as_environment_lighting;b.rayleigh_brightness=a.rayleigh_brightness;b.mie_brightness=a.mie_brightness;b.spot_brightness=a.spot_brightness;b.scatter_strength=a.scatter_strength;b.rayleigh_strength=a.rayleigh_strength;b.mie_strength=a.mie_strength;b.rayleigh_collection_power=a.rayleigh_collection_power;b.mie_collection_power=a.mie_collection_power;b.mie_distribution=
a.mie_distribution;return b}return null};a.set_sky_params=function(a,b){var c=ba(a,"SKY");c&&("number"==typeof b.procedural_skydome&&(c.procedural_skydome=b.procedural_skydome),"number"==typeof b.use_as_environment_lighting&&(c.use_as_environment_lighting=b.use_as_environment_lighting),"object"==typeof b.color&&c.sky_color.set(b.color),"number"==typeof b.rayleigh_brightness&&(c.rayleigh_brightness=b.rayleigh_brightness),"number"==typeof b.mie_brightness&&(c.mie_brightness=b.mie_brightness),"number"==
typeof b.spot_brightness&&(c.spot_brightness=b.spot_brightness),"number"==typeof b.scatter_strength&&(c.scatter_strength=b.scatter_strength),"number"==typeof b.rayleigh_strength&&(c.rayleigh_strength=b.rayleigh_strength),"number"==typeof b.mie_strength&&(c.mie_strength=b.mie_strength),"number"==typeof b.rayleigh_collection_power&&(c.rayleigh_collection_power=b.rayleigh_collection_power),"number"==typeof b.mie_collection_power&&(c.mie_collection_power=b.mie_collection_power),"number"==typeof b.mie_distribution&&
(c.mie_distribution=b.mie_distribution),c.need_perm_uniforms_update=!0,c.need_fog_update=!0,oa(a,c))};a.get_fog_color_density=function(a,b){var c=b||[],d=Z(a,Rc)[0].fog_color_density;c[0]=d[0];c[1]=d[1];c[2]=d[2];c[3]=d[3];return c};a.set_fog_color_density=function(a,b){for(var c=Z(a,Rc),d=0;d<c.length;d++){var e=c[d];e.fog_color_density.set(b);e.need_perm_uniforms_update=!0}};a.get_ssao_params=function(a){var b=ba(a,"SSAO");a=ba(a,"SSAO_BLUR");if(!b)return null;var c=b.bundles[0].batch,d={};d.ssao_quality=
R.get_batch_directive(c,"SSAO_QUALITY")[1];d.ssao_hemisphere=b.ssao_hemisphere;d.ssao_blur_depth=a.ssao_blur_depth;d.blur_discard_value=a.ssao_blur_discard_value;d.radius_increase=b.ssao_radius_increase;d.influence=b.ssao_influence;d.dist_factor=b.ssao_dist_factor;d.ssao_only=b.ssao_only;d.ssao_white=R.get_batch_directive(c,"SSAO_WHITE")[1];return d};a.set_ssao_params=function(a,b){var c=ba(a,"SSAO"),d=ba(a,"SSAO_BLUR");if(!c)return ab.error("SSAO is not enabled on the scene"),0;if("string"==typeof b.ssao_quality){var e=
c.bundles[0].batch;R.set_batch_directive(e,"SSAO_QUALITY",b.ssao_quality);R.update_shader(e,!0)}"number"==typeof b.ssao_hemisphere&&(e=c.bundles[0].batch,R.set_batch_directive(e,"SSAO_HEMISPHERE",b.ssao_hemisphere),R.update_shader(e,!0));"number"==typeof b.ssao_blur_depth&&(e=d.bundles[0].batch,R.set_batch_directive(e,"SSAO_BLUR_DEPTH",b.ssao_blur_depth),R.update_shader(e,!0));"number"==typeof b.ssao_blur_discard_value&&(d.ssao_blur_discard_value=b.ssao_blur_discard_value);"number"==typeof b.ssao_radius_increase&&
(c.ssao_radius_increase=b.ssao_radius_increase);"number"==typeof b.ssao_influence&&(c.ssao_influence=b.ssao_influence);"number"==typeof b.ssao_dist_factor&&(c.ssao_dist_factor=b.ssao_dist_factor);if("number"==typeof b.ssao_only){c=ba(a,"MAIN_OPAQUE");c.ssao_only=b.ssao_only;for(var h=0;h<c.bundles.length;h++)e=c.bundles[h].batch,R.set_batch_directive(e,"SSAO_ONLY",b.ssao_only),R.update_shader(e,!0)}"number"==typeof b.ssao_white&&(e=c.bundles[0].batch,R.set_batch_directive(e,"SSAO_WHITE",b.ssao_white),
R.update_shader(e,!0));c.need_perm_uniforms_update=!0;d.need_perm_uniforms_update=!0};a.get_dof_params=function(a){a=ba(a,"DOF");if(!a)return null;var b={};b.dof_distance=a.camera.dof_distance;b.dof_front=a.camera.dof_front;b.dof_rear=a.camera.dof_rear;b.dof_power=a.camera.dof_power;b.dof_object=a.camera.dof_object;return b};a.set_dof_params=Q;a.get_god_rays_params=function(a){var b=Z(a,["GOD_RAYS"]);a=ba(a,"GOD_RAYS_COMBINE");if(!b||!a)return null;var c={};c.god_rays_max_ray_length=b[0].max_ray_length;
c.god_rays_intensity=a.god_rays_intensity;c.god_rays_steps=R.get_batch_directive(b[0].bundles[0].batch,"STEPS_PER_PASS")[1];return c};a.set_god_rays_params=function(a,b){var c=Z(a,["GOD_RAYS"]),d=ba(a,"GOD_RAYS_COMBINE");if(!c||!d)return ab.error("God Rays are not enabled on the scene"),0;"number"==typeof b.god_rays_intensity&&(d.god_rays_intensity=b.god_rays_intensity);if("number"==typeof b.god_rays_max_ray_length)for(var e=b.god_rays_max_ray_length,h=0;h<c.length;h++)c[h].max_ray_length=e,c[h].radial_blur_step=
e/c[h].steps_per_pass/(h+1),c[h].need_perm_uniforms_update=!0;if("number"==typeof b.god_rays_steps)for(var f=ja.glsl_value(b.god_rays_steps,1),e=c[0].max_ray_length,h=0;h<c.length;h++){c[h].steps_per_pass=f;c[h].radial_blur_step=e/f/(h+1);c[h].need_perm_uniforms_update=!0;var g=c[h].bundles[0].batch;R.set_batch_directive(g,"STEPS_PER_PASS",f);R.update_shader(g,!0)}d.need_perm_uniforms_update=!0};a.get_bloom_params=function(a){var b=ba(a,"LUMINANCE_TRUNCED");a=ba(a,"BLOOM");if(!b||!a)return null;var c=
{};c.bloom_key=b.bloom_key;c.bloom_edge_lum=b.bloom_edge_lum;c.bloom_blur=a.bloom_blur;return c};a.set_bloom_params=sa;a.get_glow_material_params=function(a){a=ba(a,"GLOW_COMBINE");if(!a)return null;var b={};b.small_glow_mask_coeff=a.small_glow_mask_coeff;b.large_glow_mask_coeff=a.large_glow_mask_coeff;b.small_glow_mask_width=a.small_glow_mask_width;b.large_glow_mask_width=a.large_glow_mask_width;return b};a.set_glow_material_params=ca;a.get_wind_params=function(a){var b=ma(a);a=Va.length(b);if(0==
a)return null;var b=180*Math.atan(b[0]/b[2])/Math.PI,c={};c.wind_dir=b;c.wind_strength=a;return c};a.schedule_grass_map_update=function(a){a._render.need_grass_map_update=!0};a.get_water_surface_level=Ga;a.get_water_mat_params=function(a,b){var c=ba(a,"MAIN_OPAQUE");if(c&&(b.waves_height=c.water_waves_height,b.waves_length=c.water_waves_length,c.water_fog_color_density)){b.water_fog_density=c.water_fog_color_density[3];var d=b.water_fog_color=[];d[0]=c.water_fog_color_density[0];d[1]=c.water_fog_color_density[1];
d[2]=c.water_fog_color_density[2]}};a.set_water_params=function(a,b){var c=ba(a,"MAIN_OPAQUE");if(!c||!c.water_params)return ab.error("set_water_params() - no water parameters on the scene"),null;c=c.water_params;"number"==typeof b.dst_noise_scale0&&(c.dst_noise_scale0=b.dst_noise_scale0);"number"==typeof b.dst_noise_scale1&&(c.dst_noise_scale1=b.dst_noise_scale1);"number"==typeof b.dst_noise_freq0&&(c.dst_noise_freq0=b.dst_noise_freq0);"number"==typeof b.dst_noise_freq1&&(c.dst_noise_freq1=b.dst_noise_freq1);
"number"==typeof b.dir_min_shore_fac&&(c.dir_min_shore_fac=b.dir_min_shore_fac);"number"==typeof b.dir_freq&&(c.dir_freq=b.dir_freq);"number"==typeof b.dir_noise_scale&&(c.dir_noise_scale=b.dir_noise_scale);"number"==typeof b.dir_noise_freq&&(c.dir_noise_freq=b.dir_noise_freq);"number"==typeof b.dir_min_noise_fac&&(c.dir_min_noise_fac=b.dir_min_noise_fac);"number"==typeof b.dst_min_fac&&(c.dst_min_fac=b.dst_min_fac);"number"==typeof b.waves_hor_fac&&(c.waves_hor_fac=b.waves_hor_fac);"number"==typeof b.water_dynamic&&
(c.dynamic=b.water_dynamic);for(var d=Z(a,xc),e=0;e<d.length;e++){var h=d[e];"number"==typeof b.water_fog_density&&c.fog_color_density&&(h.water_fog_color_density[3]=b.water_fog_density);"object"==typeof b.water_fog_color&&c.fog_color_density&&h.water_fog_color_density.set(b.water_fog_color);"number"==typeof b.waves_height&&(h.water_waves_height=b.waves_height);"number"==typeof b.waves_length&&(h.water_waves_length=b.waves_length);h.need_perm_uniforms_update=!0}};a.get_shore_dist=function(a,b){var c=
ba(Ua,"MAIN_OPAQUE");if(!c.use_shoremap)return 100;var d=c.max_shore_dist,e=c.water_level,h=(a[0]-c.shoremap_center[0])/c.shoremap_size[0],f=(c.shoremap_center[1]+a[2])/c.shoremap_size[1],h=h+.5,f=f+.5;if(1<h||0>h||1<f||0>f)e=1;else return c=d*Da.get_array_smooth_value(Ua._render.shore_distances,c.shoremap_tex_size,h,f),e=(e-a[1])*b,e=Math.sqrt(c*c+e*e)};a.update=function(a,b){for(var d=c()._camera.render,e=0;e<Ya.length;e++){var h=Ya[e],f=h._render.graph,g=h._render;if(g.water_params)var k=cb.get_trans_view(d.world_tsr),
l=k[1]-Ga(k[0],k[2]);for(k=0;k<g.video_textures.length;k++){var m=g.video_textures[k]._render,n=m.video_file,q=m.seq_video;if(!(h.b4w_use_nla&&m.use_nla||!n&&!q)&&fb.video_is_played(m)){var r=fb.video_get_current_frame(m),R=fb.video_get_start_frame(m);n&&va.is_mobile_device&&(R-=5);var p=fb.video_get_end_frame(m);r>=p&&m.use_cyclic||r<R?(fb.reset_video(m.name,m.vtex_data_id),q&&(m.seq_last_discrete_mark=fb.seq_video_get_discrete_timemark(m,a))):r>=p&&!m.use_cyclic?fb.pause_video(m.name,m.vtex_data_id):
fb.video_update_is_available(m)&&(n?fb.update_video_texture(m):(n=fb.seq_video_get_discrete_timemark(m,a),n!=m.seq_last_discrete_mark&&(fb.update_seq_video_texture(m),m.seq_cur_frame++),m.seq_last_discrete_mark=n))}}ua.traverse(f,function(b,c){-1<nd.indexOf(c.type)&&(c.time=a);g.water_params&&(c.cam_water_depth=l)})}for(e=0;e<Ya.length;e++)if(h=Ya[e],g=h._render,f=g.graph,d=g.queue,d.length)for(g.need_shadow_update&&(U(h),g.need_shadow_update=!1),g.need_grass_map_update&&(qa(h),g.need_grass_map_update=
!1),g.need_outline&&(T(h),g.need_outline=!1),g.motion_blur&&ha(f,b),h=ia.find_subs(f,"OUTLINE_MASK"),k=0;k<d.length;k++)m=d[k],fd.prerender_subs(m),h&&ka(f,m,h),wb.draw(m);va.show_hud_debug_info&&Cb.show_debug_info(Ya,b)};a.request_outline=function(a){a._render.need_outline=!0};a.get_all_subscenes=function(a){var b=[];ua.traverse(a._render.graph,function(a,c){b.push(c)});return b};a.get_cam_water_depth=function(){var a=ba(Ua,"MAIN_BLEND"),b=Ua;return a||b._render.water_params?a.cam_water_depth:null};
a.get_object_data_id=function(a){return a.render.data_id};a.update_scene_permanent_uniforms=function(a){ua.traverse(a._render.graph,function(a,b){b.need_perm_uniforms_update=!0})};a.set_wireframe_mode=function(a,b){a.do_render=b!=W.WM_NONE;for(var c=0;c<a.bundles.length;c++)a.bundles[c].batch.wireframe_mode=b;a.blend=b==W.WM_TRANSPARENT_WIREFRAME;a.need_perm_uniforms_update=!0};a.set_wireframe_edge_color=function(a,b){for(var c=0;c<a.bundles.length;c++)a.bundles[c].batch.wireframe_edge_color=b,a.need_perm_uniforms_update=
!0};a.update_force_scene=function(a,b){var c=b.field,d=a._render.wind;if(c&&"WIND"==c.type&&d){var e=cb.get_quat_view(b.render.world_tsr);Da.quat_to_dir(e,Da.AXIS_Y,d);Va.normalize(d,d);Va.scale(d,c.strength,d);c=Z(a,nd);for(e=0;e<c.length;e++)c[e].wind.set(d)}};a.pick_color=function(a,b,c){var d=ba(a,"COLOR_PICKING");if(d)return b=za.canvas_to_viewport_coords(b,c,zc,d.camera),fd.prerender_subs(d,d.camera),wb.draw(d,d.bundles),(a=ba(a,"COLOR_PICKING_XRAY"))?(fd.prerender_subs(a,a.camera),wb.draw(a,
a.bundles),d=a.camera):d=d.camera,b[1]=d.height-b[1],wb.read_pixels(d.framebuffer,b[0],b[1]);ab.error("Object Selection is not available on the scene");return null};a.set_outline_color=function(a){var b=c();if(b=ba(b,"OUTLINE"))b.outline_color.set(a),b.need_perm_uniforms_update=!0};a.get_wind=ma;a.get_meta_tags=function(a){var b={title:"",description:""};a.b4w_tags&&(b.title=a.b4w_tags.title,b.description=a.b4w_tags.description);return b};a.update_cube_reflect_subs=function(a,b){var c=Gc;Va.negate(b,
c);for(var d=0;6>d;d++){var e=a.cube_view_matrices[d],h=a.cube_cam_frustums[d],f=a.camera;pa.translate(Da.INV_CUBE_VIEW_MATRS[d],c,e);pa.multiply(f.proj_matrix,e,f.view_proj_matrix);Da.extract_frustum_planes(f.view_proj_matrix,h)}};a.update_plane_reflect_subs=function(a,b,c){Da.trans_quat_to_plane(b,c,Da.AXIS_Y,a.camera.reflection_plane)};a.assign_scene_data_subs=function(a,b,c){var d=a._render.shadow_params,e=a._render.reflection_params;c=Ba.get_shadow_lamps(c,va.ssao&&a.b4w_enable_ssao);for(var h=
0;h<b.length;h++){var f=b[h],g=Ba.get_scene_data(f,a);if(e)if(null!=f.render.plane_reflection_id){var k=e.plane_refl_subs;k.length&&(f=f.render.plane_reflection_id,g.plane_refl_subs=k[f])}else null!=f.render.cube_reflection_id&&(k=e.cube_refl_subs,k.length&&(f=f.render.cube_reflection_id,g.cube_refl_subs=k[f]))}for(h=0;h<c.length;h++)if(g=Ba.get_scene_data(c[h],a),d)for(b=Z(a,["SHADOW_CAST"]),e=0;e<b.length;e++)h==b[e].shadow_lamp_index&&g.shadow_subscenes.push(b[e])};a.marker_frame=function(a,b){return a.timeline_markers[b]}};b4w.module.__physics=function(a,p){function t(a,b){for(var c=a.cons_descends,d=0;d<c.length;d++)c[d].physics_settings.use_collision_compound&&b.push(c[d]),t(c[d],b);return null}function c(a,b,c){for(var d=a._physics.bundles,e=0;e<d.length;e++)for(var h=d[e].physics,f=0;f<h.collision_tests.length;f++){var g=h.collision_tests[f];"ANY"!=g.collision_id&&c!=g.collision_id||z(g,a,b)}}function b(a,b,c){if(H.is_active(a))switch(b){case H.IN_LOADED:var e=k(a);e._physics.worker_loaded=!0;c=Date.now()-performance.now();
H.post_msg(a,H.OUT_INIT,c,V.max_fps,V.calc_fps?S.fps_measurement_interval:0);break;case H.IN_LOG:I.log_raw("URANIUM:",c.slice(1));break;case H.IN_ERROR:I.error(c);break;case H.IN_FBMSG:x.fbmsg.apply(this,c.slice(1));break;case H.IN_TRANSFORM:var h=d(c.body_id);if(h){a=c.trans;e=c.quat;b=c.linvel;var f=c.angvel,h=h.physics;h.curr_time=c.time;w.set_sep(a,1,e,h.curr_tsr);da.copy(b,h.linvel);da.copy(f,h.angvel)}break;case H.IN_PROP_OFFSET:(a=d(c.chassis_hull_body_id))&&w.set_sep(c.trans,1,c.quat,a.vehicle.prop_offsets[c.prop_ind]);
break;case H.IN_FLOATER_BOB_TRANSFORM:if(e=d(c[1]))a=c[4],e=e.floater.bobs[c[2]],T.set_translation(e,c[3]),T.set_rotation(e,a),T.update_transform(e);break;case H.IN_VEHICLE_SPEED:if(h=d(c[1]))h.vehicle.speed=c[2];break;case H.IN_COLLISION:e=k(a);l(e,c.body_id_a,c.body_id_b,c.result,null,null,0);break;case H.IN_COLLISION_POS_NORM:e=k(a);l(e,c.body_id_a,c.body_id_b,c.result,c.coll_point,c.coll_norm,c.coll_dist);break;case H.IN_COLLISION_IMPULSE:if(h=d(c[1]))a=h.physics,a.col_imp_test_cb&&a.col_imp_test_cb(c[2]);
break;case H.IN_RAY_HIT:case H.IN_RAY_HIT_POS_NORM:e=k(a);if(a=e._physics.ray_tests[c.id])if(e=d(c.body_id_hit),b==H.IN_RAY_HIT)b=a.callback,b(a.id,c.hit_fract,e,c.hit_time);else{b=c.hit_fract;var f=c.hit_time,h=c.hit_pos,g=a.callback;h?g(a.id,b,e,f,h,c.hit_norm):g(a.id,b,e,f)}break;case H.IN_REMOVE_RAY_TEST:m(id);break;case H.IN_PING:a=ga.indexOf(a);e=(c[2]-c[1]).toFixed(3);b=(performance.now()-c[2]).toFixed(3);c=(performance.now()-c[1]).toFixed(3);console.log("Physics #"+a+" Ping: OUT "+e+" ms, IN "+
b+" ms, ALL "+c+" ms");break;case H.IN_FPS:la=c[1];break;case H.IN_DEBUG_STATS:a=ga.indexOf(a);console.log("Worker: #"+String(a));console.log(c[1]);break;default:I.error("Wrong message: "+b)}}function k(a){for(var b=0;b<ga.length;b++)if(ga[b]==a)return oa[b]}function d(a){return na[a]||null}function l(a,b,c,e,h,f,g){a=a._physics.bundles;for(var k=0;k<a.length;k++)for(var l=a[k].physics,m=0;m<l.collision_tests.length;m++){for(var n=l.collision_tests[m],r=n.pairs,p=!1,z=0;z<r.length;z++){var v=r[z];
if(v[0]===b&&v[1]===c){n.pair_results[z]=e;p=!0;break}}p&&(r=q(n),h&&n.body_id_src!=b&&(p=h,z=f,v=g,p[0]+=z[0]*v,p[1]+=z[1]*v,p[2]+=z[2]*v,z[0]*=-1,z[1]*=-1,z[2]*=-1),p=r?n.body_id_src==b?d(c):d(b):null,n.callback(r,p,h,f,g))}}function q(a){a=a.pair_results;for(var b=!1,c=0;c<a.length;c++)b=b||a[c];return b}function r(){ba.body++;return ba.body}function g(a){var b=Z.indexOf(a);return-1==b?(Z.push(a),Z.length-1):b}function C(a){return{body_id:a,mass:0,is_ghost:!1,simulated:!0,is_vehicle:!1,is_character:!1,
is_floater:!1,cons_id:null,collision_id:"",collision_id_num:0,collision_callbacks:{},collision_tests:[],col_imp_test_cb:null,curr_time:0,curr_tsr:new Float32Array([0,0,0,1,0,0,0,1]),linvel:new Float32Array(3),angvel:new Float32Array(3),cached_trans:new Float32Array(3),cached_quat:new Float32Array(4)}}function f(a,b){switch(a){case "BOX":var c=b.bb_local;break;case "CYLINDER":c=b.bcyl_local;break;case "CONE":c=b.bcon_local;break;case "SPHERE":c=b.bs_local;break;case "CAPSULE":c=b.bcap_local}return c}
function h(a){if(!a)return null;var b={};"number"===typeof a.min_x&&(b.min_x=a.min_x);"number"===typeof a.min_y&&(b.min_y=a.min_y);"number"===typeof a.min_z&&(b.min_z=a.min_z);"number"===typeof a.max_x&&(b.max_x=a.max_x);"number"===typeof a.max_y&&(b.max_y=a.max_y);"number"===typeof a.max_z&&(b.max_z=a.max_z);"object"===typeof a.center&&(b.center=a.center);"number"===typeof a.radius&&(b.radius=a.radius);"number"===typeof a.height&&(b.height=a.height);return b}function n(a,b,c,d,e){var h=w.get_trans_view(a.render.world_tsr),
f=w.invert(b.render.world_tsr,ca),g=new Float32Array(3);w.transform_vec3(h,f,g);switch(b.vehicle.type){case 10:b=b.vehicle_settings;a=a.render.bb_local;H.post_msg(e,H.OUT_ADD_CAR_WHEEL,c,g,b.suspension_rest_length,b.roll_influence,(a.max_y-a.min_y)/2,d);break;case 20:H.post_msg(e,H.OUT_ADD_BOAT_BOB,c,g,a.synchronize_pos)}}function A(a){return a.physics&&a.physics.cons_id}function B(a,b,c,d,e,h,f,g,k,l){var m;ba.constraint++;m=ba.constraint.toString(16);var n=b.physics.body_id;e=e.physics.body_id;
var q=F(n);H.post_msg(q,H.OUT_APPEND_CONSTRAINT,m,a,g,n,c,d,e,h,f,k,l);b.physics.cons_id=m}function F(a){for(var b=0;b<oa.length;b++)for(var c=oa[b]._physics.bundles,d=0;d<c.length;d++)if(c[d].physics.body_id==a)return ga[b];return null}function D(a){var b;if(b=(b=a.physics)?0===b.mass?!0:!0===b.is_ghost?!0:!1===b.simulated?!0:"RIGID_BODY"!==b.type&&"DYNAMIC"!==b.type?!0:!1:!1){b=w.get_trans_view(a.render.world_tsr);var c=w.get_quat_view(a.render.world_tsr);b=b[0]!=a.physics.cached_trans[0]||b[1]!=
a.physics.cached_trans[1]||b[2]!=a.physics.cached_trans[2]||c[0]!=a.physics.cached_quat[0]||c[1]!=a.physics.cached_quat[1]||c[2]!=a.physics.cached_quat[2]||c[3]!=a.physics.cached_quat[3]}if(b){b=a.physics;var d=a.render,c=w.get_trans_view(d.world_tsr),d=w.get_quat_view(d.world_tsr);da.copy(c,b.cached_trans);aa.copy(d,b.cached_quat);var e=H.get_msg_cache(H.OUT_SET_TRANSFORM);e.body_id=b.body_id;e.trans=c;"DYNAMIC"==b.type?aa.identity(e.quat):e.quat=d;b=F(b.body_id);H.post_msg(b,H.OUT_SET_TRANSFORM)}a=
a.cons_descends;for(b=0;b<a.length;b++)D(a[b])}function e(a,b,c,d,e){e=e||new Float32Array(3);a=w.get_quat_view(a.render.world_tsr);e[0]=b;e[1]=c;e[2]=d;return da.transformQuat(e,a,e)}function z(a,b,c){var d=a.pairs,e=a.pair_results,h=a.body_id_src,f=[],g=a.collision_id;if(!f)throw"At least one destination required";for(var k=0;k<b._physics.bundles.length;k++){var l=b._physics.bundles[k];if("ANY"==g||l.physics.collision_id==g)l=l.physics.body_id,f&&-1==f.indexOf(l)&&f.push(l)}for(b=0;b<f.length;b++)g=
f[b],h<g&&!y(d,h,g)?(d.push([h,g]),e.push(!1)):h>g&&!y(d,g,h)&&(d.push([g,h]),e.push(!1));H.post_msg(c,H.OUT_ACTIVATE,h);H.post_msg(c,H.OUT_APPEND_COLLISION_TEST,d,a.calc_pos_norm)}function y(a,b,c){for(var d=0;d<a.length;d++)if(a[d][0]==b&&a[d][1]==c)return!0;return!1}function v(a){if(a.physics&&a.physics.col_imp_test_cb){a=a.physics;var b=F(a.body_id);H.post_msg(b,H.OUT_CLEAR_COLLISION_IMPULSE_TEST,a.body_id);a.col_imp_test_cb=null}}function m(a){var b=u(a),c=K(a),b=b._physics;b.ray_tests[a]&&(delete b.ray_tests[a],
b.ray_tests_arr.splice(b.ray_tests_arr.indexOf,1),H.post_msg(c,H.OUT_REMOVE_RAY_TEST,a))}function u(a){for(var b=0;b<oa.length;b++){var c=oa[b];if(c._physics.ray_tests[a])return c}return null}function K(a){for(var b=0;b<oa.length;b++)if(oa[b]._physics.ray_tests[a])return ga[b];return null}function E(a,b,c){if(b.steering_wheel){a=a.physics.body_id;var d=b.engine_force*b.force_max,e=b.brake_force*b.brake_max,h=-b.steering*b.steering_max*2*Math.PI/b.steering_ratio;b.inverse_control&&(h*=-1);switch(b.type){case 10:H.post_msg(c,
H.OUT_UPDATE_CAR_CONTROLS,a,d,e,h);break;case 20:H.post_msg(c,H.OUT_UPDATE_BOAT_CONTROLS,a,d,e,h)}}}function M(a){return a.is_vehicle&&"CHASSIS"==a.vehicle_settings.part}function J(a){return a.is_vehicle&&"HULL"==a.vehicle_settings.part}function O(a){return a.is_floating&&"MAIN_BODY"==a.floating_settings.part}var G=p("__config");p("__constraints");var x=p("__debug"),H=p("__ipc");p("__mat4");var P=p("__obj_util"),I=p("__print"),aa=p("__quat");p("__renderer");var U=p("__scenes"),T=p("__transform"),
w=p("__tsr"),fa=p("__util"),da=p("__vec3"),ea=p("__version"),V=G.physics,S=G.defaults,X=G.assets,la=0,ga=[],oa=[],na={},N=[],Z=["ANY"],ba={body:0,constraint:0,ray_test:0},Q=new Float32Array(3);new Float32Array(4);var sa=new Float32Array(4);new Float32Array(16);var ca=w.create(),Ga=w.create();a.init_scene_physics=function(a){a._physics={worker_loaded:!1,bundles:[],ray_tests:{},ray_tests_arr:[]};var c=V.uranium_path;X.prevent_caching&&(c+=ea.timestamp());I.log("%cLOAD PHYSICS","color: #0a0",V.use_workers?
"Using Separate Worker Thread,":"Using Same Thread,","Max FPS: "+V.max_fps);I.log("%cPHYSICS PATH","color: #0a0",c);var d=H.create_worker(c,!V.use_workers);H.attach_handler(d,b);ga.push(d);oa.push(a);V.ping&&setInterval(function(){H.post_msg(d,H.OUT_PING,performance.now())},1E3)};a.check_worker_loaded=function(a){return a._physics?a._physics.worker_loaded:!0};a.cleanup=function(){for(var a=0;a<ga.length;a++)H.terminate(ga[a]);ga.length=0;oa.length=0;na={};N.length=0;Z.length=0;for(var b in ba)ba[b]=
0};a.append_object=function(a,b){if(!a.render)throw"No object render: "+a.name;var d=a.physics_settings,e;a:{for(var k=0;k<oa.length;k++)if(oa[k]==b){e=ga[k];break a}e=void 0}var l=[];d.use_collision_compound&&t(a,l);var m=b._physics.bundles;if(M(a)||J(a)||a.is_character||O(a)||a.use_obj_physics){var q,p=a,z=e,v=p.render,W=p.physics_settings,y=W.physics_type,u=r();if("CAMERA"==p.type)var x=W.use_collision_bounds?W.collision_bounds_type:"BOX",Z=f(x,v),ba=v.friction,G=v.elasticity,ba=.5,G=0;else if("EMPTY"==
p.type)x="EMPTY",Z=null,G=ba=0;else{var x=W.use_collision_bounds?W.collision_bounds_type:"BOX",Z=f(x,v),Q=w.get_scale(v.world_tsr);if(1!=Q){var D=Z;switch(x){case "BOX":D.min_x*=Q;D.max_x*=Q;D.min_y*=Q;D.max_y*=Q;D.min_z*=Q;D.max_z*=Q;break;case "CYLINDER":case "CONE":case "CAPSULE":D.height*=Q;D.radius*=Q;break;case "SPHERE":D.radius*=Q}}ba=v.friction;G=v.elasticity}var F=w.get_trans_view(v.world_tsr),K=w.get_quat_view(v.world_tsr),T=W.use_ghost,la=W.use_sleep,ia=W.mass,S=W.velocity_min,ja=W.velocity_max,
V=W.damping,ea=W.rotation_damping,X=p.collision_id,da=g(X),Fc=W.collision_margin,va=W.collision_group,$c=W.collision_mask,Wb=v.bs_local.radius,Qb=h(Z),Nc=p.correct_bounding_offset,Rc;var nd=x;if(l.length){var xc=[],Mb={};Mb.quat=new Float32Array([0,0,0,1]);Mb.trans=new Float32Array(3);Mb.worker_bounding=Qb;Mb.bounding_type=nd;xc.push(Mb);var Ua=w.invert(v.world_tsr,ca),Ya=w.get_quat_view(v.world_tsr);aa.invert(Ya,sa);for(var Db=0;Db<l.length;Db++){var yc={},zc=l[Db],Gc=zc.physics_settings.collision_bounds_type,
Ac=new Float32Array(4),Za=new Float32Array(3),Pa=w.get_trans_view(zc.render.world_tsr),jb=w.get_quat_view(zc.render.world_tsr);w.transform_vec3(Pa,Ua,Za);aa.multiply(sa,jb,Ac);yc.trans=Za;yc.quat=Ac;yc.bounding_type=Gc;yc.worker_bounding=h(f(Gc,zc.render));xc.push(yc)}Rc=xc}else Rc=[];H.post_msg(z,H.OUT_APPEND_BOUNDING_BODY,u,F,K,y,T,la,ia,S,ja,V,ea,da,Fc,va,$c,x,Qb,Wb,ba,G,Rc,Nc);na[u]=p;N.push(p);var Rb=C(u);Rb.type=y;Rb.mass=ia;Rb.is_ghost=T;Rb.collision_id=X;Rb.collision_id_num=da;q=Rb;a.physics=
q;var kb={batch:null,physics:q};m.push(kb);c(b,e,q.collision_id)}else for(var Sb=P.get_scene_data(a,b).batches,Ea=0;Ea<Sb.length;Ea++){var Aa=Sb[Ea],lc;if(!(lc="PHYSICS"!=Aa.type))a:{for(var $a=b._physics.bundles,gb=0;gb<$a.length;gb++){var lb=$a[gb].batch;if(lb&&lb.id==Aa.id){lc=!0;break a}}lc=!1}if(!lc)if(Aa.submesh.base_length)if(Aa.water&&b._render.water_params){var wa=Aa,Ma=b,bb=e,Ha=U.get_subs(Ma,"MAIN_OPAQUE");H.post_msg(bb,H.OUT_APPEND_WATER,Ha.water_level);if(Ha.water_params&&wa.water_dynamics){var Ia=
{};Ia.dst_noise_scale0=wa.dst_noise_scale0;Ia.dst_noise_scale1=wa.dst_noise_scale1;Ia.dst_noise_freq0=wa.dst_noise_freq0;Ia.dst_noise_freq1=wa.dst_noise_freq1;Ia.dir_min_shore_fac=wa.dir_min_shore_fac;Ia.dir_freq=wa.dir_freq;Ia.dir_noise_scale=wa.dir_noise_scale;Ia.dir_noise_freq=wa.dir_noise_freq;Ia.dir_min_noise_fac=wa.dir_min_noise_fac;Ia.dst_min_fac=wa.dst_min_fac;Ia.waves_hor_fac=wa.waves_hor_fac;var xb=Ha.water_waves_height,yb=Ha.water_waves_length;Ha.use_shoremap?H.post_msg(bb,H.OUT_ADD_WATER_WRAPPER,
Ia,Ha.shoremap_size[0],Ha.shoremap_size[1],Ha.shoremap_center[0],Ha.shoremap_center[1],Ha.max_shore_dist,xb,yb,Ha.shoremap_tex_size,Ma._render.shore_distances):H.post_msg(bb,H.OUT_ADD_WATER_WRAPPER,Ia,0,0,0,0,0,xb,yb,0,null)}}else{if(Aa.use_ghost){var mc=a,Qa=Aa,Sc=e,Hc=r(),nc=Qa.submesh,Yb=nc.va_frames[0].a_position,db=nc.indices||null,oc=Qa.collision_id,Ic=g(oc),pc=Qa.collision_margin,tb=Qa.collision_group,Oa=Qa.collision_mask,Ja=w.get_trans_view(mc.render.world_tsr);H.post_msg(Sc,H.OUT_APPEND_GHOST_MESH_BODY,
Hc,Yb,db,Ja,Ic,pc,tb,Oa);var Sa=C(Hc);Sa.is_ghost=!0;Sa.collision_id=oc;Sa.collision_id_num=Ic;q=Sa}else{var Xb=a,Eb=Aa,Nb=e,Fb=r(),qc=Eb.submesh,mb=qc.va_frames[0].a_position,Zb=qc.indices||null,Jc=w.get_trans_view(Xb.render.world_tsr),Gb=Eb.friction,$b=Eb.elasticity,hc=Eb.collision_id,Hb=g(hc);H.post_msg(Nb,H.OUT_APPEND_STATIC_MESH_BODY,Fb,mb,Zb,Jc,Gb,$b,Hb,Eb.collision_margin,Eb.collision_group,Eb.collision_mask);var rb=C(Fb);rb.collision_id=hc;rb.collision_id_num=Hb;q=rb}kb={batch:Aa,physics:q};
m.push(kb);c(b,e,q.collision_id)}else I.error("Object "+a.name+" has collision material with no assigned vertices")}if(M(a)||J(a)){var ta=a,zb=e,ya=ta.physics.body_id;M(ta)?(ta.vehicle.type=10,H.post_msg(zb,H.OUT_APPEND_CAR,ya,ta.vehicle.suspension_compression,ta.vehicle.suspension_stiffness,ta.vehicle.suspension_damping,ta.vehicle.wheel_friction,ta.vehicle.max_suspension_travel_cm)):J(ta)&&(ta.vehicle.type=20,H.post_msg(zb,H.OUT_APPEND_BOAT,ya,ta.vehicle.floating_factor,ta.vehicle.water_lin_damp,
ta.vehicle.water_rot_damp));if(ta.vehicle.props){var Ta=ta.vehicle.props;switch(ta.vehicle.type){case 10:n(Ta[1],ta,ya,!0,zb);n(Ta[0],ta,ya,!0,zb);n(Ta[3],ta,ya,!1,zb);n(Ta[2],ta,ya,!1,zb);break;case 20:for(var hb=0;hb<Ta.length;hb++)n(Ta[hb],ta,ya,!1,zb)}}E(a,a.vehicle,e)}else if(a.is_character){var eb=e,Wa=a.render,Ib=a.physics,Ab=Wa.bb_local.max_y-Wa.bb_local.min_y,ac=Ib.body_id,Tb=a.character_settings,Jb=Tb.walk_speed,Bb=Tb.run_speed,rc=Tb.step_height,ic=Tb.jump_strength,jc=Tb.waterline,nb=fa.dir_ground_proj_angle(a);
H.post_msg(eb,H.OUT_APPEND_CHARACTER,ac,nb,Ab,Jb,Bb,rc,ic,jc);Ib.is_character=!0}else if(O(a)){var Na=a,ob=e,Tc=Na.physics.body_id;H.post_msg(ob,H.OUT_APPEND_FLOATER,Tc,Na.floater.floating_factor,Na.floater.water_lin_damp,Na.floater.water_rot_damp);if(Na.floater.bobs)for(var pb=Na.floater.bobs,Kb=0;Kb<pb.length;Kb++){var bc=pb[Kb],Ub=w.get_trans_view(bc.render.world_tsr),Ra=w.invert(Na.render.world_tsr,ca),Ob=new Float32Array(3);w.transform_vec3(Ub,Ra,Ob);H.post_msg(ob,H.OUT_ADD_FLOATER_BOB,Tc,Ob,
bc.bob_synchronize_pos)}Na.physics.is_floater=!0}for(Ea=0;Ea<N.length;Ea++)if(a=N[Ea],a.physics){var Lb=a;if(!A(Lb))for(var ub=0;ub<Lb.physics_constraints.length;ub++){var Ka=Lb.physics_constraints[ub],Bc=Ka.target,Kc=Ka.pivot_type;if(Bc.physics){var sc=new Float32Array([Ka.pivot_x,Ka.pivot_y,Ka.pivot_z]),cc,Lc=new Float32Array([Ka.axis_x,Ka.axis_y,Ka.axis_z]);cc=fa.euler_to_quat(Lc,new Float32Array(4));var dc=w.identity(ca),dc=w.set_trans(sc,dc),dc=w.set_quat(cc,dc),tc=w.multiply(Lb.render.world_tsr,
dc,ca),Pb=w.invert(Bc.render.world_tsr,Ga),ec=w.multiply(Pb,tc,Pb),fc=w.get_trans_view(ec),Mc=w.get_quat_view(ec),Xa=Ka,ib={};ib.use_limit_x=Xa.use_limit_x;ib.use_limit_y=Xa.use_limit_y;ib.use_limit_z=Xa.use_limit_z;ib.use_angular_limit_x=Xa.use_angular_limit_x;ib.use_angular_limit_y=Xa.use_angular_limit_y;ib.use_angular_limit_z=Xa.use_angular_limit_z;ib.limit_max_x=Xa.limit_max_x;ib.limit_min_x=Xa.limit_min_x;ib.limit_max_y=Xa.limit_max_y;ib.limit_min_y=Xa.limit_min_y;ib.limit_max_z=Xa.limit_max_z;
ib.limit_min_z=Xa.limit_min_z;ib.limit_angle_max_x=Xa.limit_angle_max_x;ib.limit_angle_min_x=Xa.limit_angle_min_x;ib.limit_angle_max_y=Xa.limit_angle_max_y;ib.limit_angle_min_y=Xa.limit_angle_min_y;ib.limit_angle_max_z=Xa.limit_angle_max_z;ib.limit_angle_min_z=Xa.limit_angle_min_z;B(Kc,Lb,sc,cc,Bc,fc,Mc,ib,null,null)}}}};a.find_obj_by_body_id=d;a.update=function(a,b){for(var c=0;c<ga.length;c++){var d=ga[c],e=a,h=b;d&&H.is_fallback(d)&&H.post_msg(d,H.OUT_UPDATE_WORLD,e,h);for(h=0;h<N.length;h++){var f=
N[h],g=f.physics;if(g.simulated&&g.curr_time){var k=H.is_fallback(d)?e-g.curr_time:performance.now()/1E3-g.curr_time,k=Math.min(k,10/V.max_fps),k=k-1/V.max_fps;S.no_phy_interp_hack&&(k=0);var l=ca;w.integrate(g.curr_tsr,k,g.linvel,g.angvel,ca);T.set_tsr(f,l);T.update_transform(f);D(f);if(f.vehicle)for(var g=f,k=g.vehicle.props,l=g.render.world_tsr,m=ca,n=0;n<k.length;n++){var q=k[n];w.multiply(l,g.vehicle.prop_offsets[n],m);T.set_tsr(q,m);T.update_transform(q)}f.vehicle&&f.vehicle.steering_wheel&&
(m=f,k=m.vehicle,g=k.steering_wheel)&&(n=m.vehicle.steering_wheel_axis,w.multiply(m.render.world_tsr,m.vehicle.steering_wheel_tsr,g.render.world_tsr),l=Q,w.transform_dir_vec3(n,m.render.world_tsr,l),m=sa,aa.setAxisAngle(l,-k.steering*k.steering_max*2*Math.PI,m),k=w.get_quat_view(g.render.world_tsr),aa.multiply(m,k,k),T.update_transform(g));f.vehicle&&f.vehicle.speedometer&&(m=f,k=m.vehicle,g=k.speedometer)&&(n=m.vehicle.speedometer_axis,w.multiply(m.render.world_tsr,m.vehicle.speedometer_tsr,g.render.world_tsr),
l=Q,w.transform_dir_vec3(n,m.render.world_tsr,l),m=sa,n=Math.abs(k.speed)*k.speed_ratio,n>k.max_speed_angle&&(n=k.max_speed_angle),aa.setAxisAngle(l,-n,m),k=w.get_quat_view(g.render.world_tsr),aa.multiply(m,k,k),aa.normalize(k,k),T.update_transform(g));f.vehicle&&f.vehicle.tachometer&&(l=f,g=l.vehicle,f=g.tachometer)&&(m=l.vehicle.tachometer_axis,w.multiply(l.render.world_tsr,l.vehicle.tachometer_tsr,f.render.world_tsr),k=Q,w.transform_dir_vec3(m,l.render.world_tsr,k),l=sa,aa.setAxisAngle(k,-Math.abs(g.engine_force)*
g.delta_tach_angle,l),g=w.get_quat_view(f.render.world_tsr),aa.multiply(l,g,g),aa.normalize(g,g),T.update_transform(f))}}H.post_msg_arr(d);d=U.get_subs(oa[c],"MAIN_OPAQUE");d.water_params&&0<d.water_params.waves_height&&(e=da.length(d.wind),H.post_msg(ga[c],H.OUT_SET_WATER_TIME,d.time*e))}};a.get_active_scene=function(){return oa[0]};a.pause=function(){for(var a=0;a<ga.length;a++)H.post_msg(ga[a],H.OUT_PAUSE)};a.resume=function(){for(var a=0;a<ga.length;a++)H.post_msg(ga[a],H.OUT_RESUME)};a.enable_simulation=
function(a){a=a.physics;if(!a)throw"No object physics";if(!a.simulated){var b=a.body_id,c=F(b);a.simulated=!0;H.post_msg(c,H.OUT_ENABLE_SIMULATION,b)}};a.disable_simulation=function(a){a=a.physics;if(!a)throw"No object physics";if(a.simulated){var b=a.body_id,c=F(b);a.simulated=!1;H.post_msg(c,H.OUT_DISABLE_SIMULATION,b)}};a.scene_has_physics=function(a){return Boolean(a._physics)};a.obj_has_physics=function(a){return Boolean(a.physics)};a.has_dynamic_physics=function(a){return(a=a.physics)&&a.simulated&&
("RIGID_BODY"==a.type||"DYNAMIC"==a.type)&&0<a.mass&&0==a.is_ghost?!0:!1};a.has_simulated_physics=function(a){return(a=a.physics)&&a.simulated?!0:!1};a.set_gravity=function(a,b){var c=a.physics.body_id,d=F(c);H.post_msg(d,H.OUT_SET_GRAVITY,c,b)};a.has_constraint=A;a.apply_constraint=B;a.clear_constraint=function(a){a=a.physics;var b=a.cons_id,c=F(body_a);H.post_msg(c,H.OUT_REMOVE_CONSTRAINT,b);a.cons_id=null};a.pull_to_constraint_pivot=function(b,c,d,e,h,f){c=w.set_sep(c,1,d,ca);h=w.set_sep(h,1,f,
Ga);w.invert(c,c);w.multiply(h,c,c);T.get_tsr(e,h);w.multiply(h,c,c);T.set_tsr(b,c);T.update_transform(b);e=w.get_trans_view(b.render.world_tsr);h=w.get_quat_view(b.render.world_tsr);a.set_transform(b,e,h)};a.set_transform=function(a,b,c){var d=a.physics,e=w.get_trans_view(a.render.world_tsr);a=w.get_quat_view(a.render.world_tsr);w.set_sep(e,1,a,d.curr_tsr);e=H.get_msg_cache(H.OUT_SET_TRANSFORM);e.body_id=d.body_id;e.trans=b;e.quat=c;b=F(d.body_id);H.post_msg(b,H.OUT_SET_TRANSFORM)};a.sync_transform=
D;a.apply_velocity=function(a,b,c,d){e(a,b,c,d,Q);a=a.physics.body_id;b=Math.abs(0);c=Math.abs(0);d=Math.abs(0);var h=Math.abs(Q[0]),f=Math.abs(Q[1]),g=Math.abs(Q[2]);Q[0]=h?Q[0]/h*Math.max(h,b):0;Q[1]=f?Q[1]/f*Math.max(f,c):0;Q[2]=g?Q[2]/g*Math.max(g,d):0;b=F(a);H.post_msg(b,H.OUT_SET_LINEAR_VELOCITY,a,Q[0],Q[1],Q[2])};a.apply_velocity_world=function(a,b,c,d){a=a.physics.body_id;var e=F(a);H.post_msg(e,H.OUT_SET_LINEAR_VELOCITY,a,b,c,d)};a.apply_force=function(a,b,c,d){e(a,b,c,d,Q);a=a.physics.body_id;
b=F(a);H.post_msg(b,H.OUT_APPLY_CENTRAL_FORCE,a,Q[0],Q[1],Q[2])};a.apply_torque=function(a,b,c,d){e(a,b,c,d,Q);a=a.physics.body_id;b=F(a);H.post_msg(b,H.OUT_APPLY_TORQUE,a,Q[0],Q[1],Q[2])};a.set_character_move_dir=function(a,b,c){a=a.physics.body_id;var d=F(a);H.post_msg(d,H.OUT_SET_CHARACTER_MOVE_DIR,a,b,c)};a.set_character_move_type=function(a,b){var c=a.physics.body_id,d=F(c);H.post_msg(d,H.OUT_SET_CHARACTER_MOVE_TYPE,c,b)};a.set_character_walk_velocity=function(a,b){var c=a.physics.body_id,d=
F(c);H.post_msg(d,H.OUT_SET_CHARACTER_WALK_VELOCITY,c,b)};a.set_character_run_velocity=function(a,b){var c=a.physics.body_id,d=F(c);H.post_msg(d,H.OUT_SET_CHARACTER_RUN_VELOCITY,c,b)};a.set_character_fly_velocity=function(a,b){var c=a.physics.body_id,d=F(c);H.post_msg(d,H.OUT_SET_CHARACTER_FLY_VELOCITY,c,b)};a.character_jump=function(a){a=a.physics.body_id;var b=F(a);H.post_msg(b,H.OUT_CHARACTER_JUMP,a)};a.character_rotation_inc=function(a,b,c){a=a.physics.body_id;var d=F(a);H.post_msg(d,H.OUT_CHARACTER_ROTATION_INCREMENT,
a,b,c)};a.set_character_rotation=function(a,b,c){a=a.physics.body_id;var d=F(a);H.post_msg(d,H.OUT_SET_CHARACTER_ROTATION,a,b,c)};a.set_character_rotation_h=function(a,b){var c=a.physics.body_id,d=F(c);H.post_msg(d,H.OUT_SET_CHARACTER_HOR_ROTATION,c,b)};a.set_character_rotation_v=function(a,b){var c=a.physics.body_id,d=F(c);H.post_msg(d,H.OUT_SET_CHARACTER_VERT_ROTATION,c,b)};a.append_collision_test=function(a,b,c,d){var e=a.physics,h=e.body_id;b=b||"ANY";for(var f=0;f<e.collision_tests.length;f++)if(a=
e.collision_tests[f],a.collision_id==b&&a.callback==c)return;a={body_id_src:h,calc_pos_norm:d||!1,collision_id:b,callback:c,pairs:[],pair_results:[]};e.collision_tests.push(a);b=F(h);c=k(b);z(a,c,b)};a.remove_collision_test=function(a,b,c){a=a.physics;for(var d=F(a.body_id),e=k(d),h=0;h<a.collision_tests.length;h++){var f=a.collision_tests[h];if(f.collision_id==b&&f.callback==c){if(q(f)){var g=da.set(0,0,0,Q);f.callback(!1,null,g,g,0)}a.collision_tests.splice(h,1);h--;for(var g=d,l=e._physics.bundles,
f=f.pairs,m=0;m<l.length;m++)for(var n=l[m].physics,r=0;r<n.collision_tests.length;r++)for(var p=n.collision_tests[r],z=0;z<p.pairs.length;z++)for(var v=p.pairs[z],y=0;y<f.length;y++){var u=f[y];v[0]==u[0]&&v[1]==u[1]&&(f.splice(y,1),y--)}f.length&&H.post_msg(g,H.OUT_REMOVE_COLLISION_TEST,f)}}};a.apply_collision_impulse_test=function(a,b){a.physics&&a.physics.col_imp_test_cb&&v(a);var c=a.physics,d=F(c.body_id);H.post_msg(d,H.OUT_APPLY_COLLISION_IMPULSE_TEST,c.body_id);c.col_imp_test_cb=b};a.clear_collision_impulse_test=
v;a.append_ray_test=function(a,b,c,d,e,h,f,l,m){var n;ba.ray_test++;n=ba.ray_test;d=d||"ANY";a={id:n,body_id:a?a.physics.body_id:0,from:new Float32Array(b),to:new Float32Array(c),collision_id:d,collision_id_num:g(d),autoremove:h,calc_all_hits:f,calc_pos_norm:l,ign_src_rot:m,callback:e};b=F(a.body_id)||ga[0];c=k(b)._physics;n=a.id;c.ray_tests[n]=a;c.ray_tests_arr.push(a);H.post_msg(b,H.OUT_APPEND_RAY_TEST,a.id,a.body_id,a.from,a.to,a.collision_id_num,a.autoremove,a.calc_all_hits,a.calc_pos_norm,a.ign_src_rot);
return n};a.remove_ray_test=m;a.change_ray_test_from_to=function(a,b,c){var d=u(a),e=K(a);(d=d._physics.ray_tests[a])&&!d.autoremove&&(d.from.set(b),d.to.set(c),H.post_msg(e,H.OUT_CHANGE_RAY_TEST_FROM_TO,a,b,c))};a.is_ray_test=function(a){return u(a)._physics.ray_tests[a]?!0:!1};a.vehicle_throttle=function(a,b){var c=a.vehicle;c.engine_force=b;var d=F(a.physics.body_id);E(a,c,d)};a.vehicle_steer=function(a,b){var c=a.vehicle;c.steering=b;var d=F(a.physics.body_id);E(a,c,d)};a.vehicle_brake=function(a,
b){var c=a.vehicle;c.brake_force=b;var d=F(a.physics.body_id);E(a,c,d)};a.is_vehicle_chassis=M;a.is_vehicle_hull=J;a.is_car_wheel=function(a){if(!a.is_vehicle)return!1;a=a.vehicle_settings.part;return"WHEEL_FRONT_LEFT"==a||"WHEEL_FRONT_RIGHT"==a||"WHEEL_BACK_LEFT"==a||"WHEEL_BACK_RIGHT"==a?!0:!1};a.is_boat_bob=function(a){return a.is_vehicle?"BOB"==a.vehicle_settings.part?!0:!1:!1};a.is_floater_bob=function(a){return a.is_floating?"BOB"==a.floating_settings.part?!0:!1:!1};a.is_vehicle_steering_wheel=
function(a){return a.is_vehicle&&"STEERING_WHEEL"==a.vehicle_settings.part?!0:!1};a.is_vehicle_speedometer=function(a){return a.is_vehicle&&"SPEEDOMETER"==a.vehicle_settings.part?!0:!1};a.is_vehicle_tachometer=function(a){return a.is_vehicle&&"TACHOMETER"==a.vehicle_settings.part?!0:!1};a.get_vehicle_speed=function(a){return a.vehicle.speed};a.wheel_index=function(a){switch(a){case "WHEEL_FRONT_LEFT":return 0;case "WHEEL_FRONT_RIGHT":return 1;case "WHEEL_BACK_LEFT":return 2;case "WHEEL_BACK_RIGHT":return 3}};
a.is_character=function(a){return a.is_character};a.is_floater_main=O;a.get_fps=function(){return la};a.debug_workers=function(){for(var a=0;a<ga.length;a++)H.post_msg(ga[a],H.OUT_DEBUG)};a.remove_bounding_object=function(a){var b=N.indexOf(a);-1==b&&I.error("Object "+a.name+" doesn't have bounding physics");for(var c=a.physics.body_id,d=F(c),e=k(d),h=e._physics.bundles,f=[],g=0;g<h.length;g++)for(var l=h[g].physics,m=0;m<l.collision_tests.length;m++)for(var n=l.collision_tests[m],r=0;r<n.pairs.length;r++){var p=
n.pairs[r],z=n.pair_results[r];if(p[0]==c||p[1]==c)n.pairs.splice(r,1),n.pair_results.splice(r,1),r--,z&&!q(n)&&(z=da.set(0,0,0,Q),n.callback(!1,null,z,z,0)),f.push(p)}f.length&&H.post_msg(d,H.OUT_REMOVE_COLLISION_TEST,f);a.physics&&a.physics.col_imp_test_cb&&v(a);delete na[c];N.splice(b,1);a=e._physics.bundles;for(b=0;b<a.length;b++)a[b].physics.body_id==c&&(a.splice(b,1),b--);H.post_msg(d,H.OUT_REMOVE_BODY,c)}};b4w.module.__data=function(a,p){function t(a,b){wb[b.id]=null;ia[b.id]=null}function c(a,b,c){var d;a instanceof ArrayBuffer&&(a=Q.get_width_height(a));d=a.width;a=a.height;R.log("%cLOAD IMAGE "+d+"x"+a,"color: #"+(2048<d||2048<a?"a00":1024<d||1024<a?"aa0":"0a0"),b);-1==b.indexOf(Ec)&&c&&R.warn("image",b,"is not from app root.")}function b(a,b,c,d,e,h){d=b.filepath;if(!d)throw"Nothing requested";na.enqueue([{id:d,type:na.AT_JSON,url:d}],function(d,h,f,g){if(d){R.log("%cLOAD METADATA","color: #616",
g);h=Ca.str_to_version(d.b4w_format_version);switch(Ca.version_cmp(h,Ba.min_format_version)){case -1:h[0]<Ba.min_format_version[0]?Ca.panic("JSON version is too old relative to B4W engine: "+Ca.version_to_str(h)+", required: "+Ca.version_to_str(Ba.min_format_version)+". Reexport scene with the latest B4W addon to fix it."):R.warn("JSON version is a bit old relative to B4W engine: "+ +Ca.version_to_str(h)+", required: "+Ca.version_to_str(Ba.min_format_version)+". Some compatibility issues can occur. Reexport scene with the latest B4W addon to fix it.");
break;case 1:h[0]>Ba.min_format_version[0]?Ca.panic("B4W engine version is too old relative to JSON. Can't load the scene. Update your engine version to fix it."):R.warn("B4W engine version is a bit old relative to JSON. Some compatibility issues can occur. Update your engine version to fix it.")}Ba.loaded_data_version=h;for(var k in d)a[k]=d[k];b.is_primary&&(ja=Y.find_main_scene(a.scenes));(d=a.binaries[0].binfile)?b.binary_name=d:(ca.skip_stage_by_name(b,"load_binaries"),ca.skip_stage_by_name(b,
"prepare_bindata"));Ba.is_mobile_device||ca.skip_stage_by_name(b,"mobile_media_start");Ba.antialiasing&&Ba.smaa||ca.skip_stage_by_name(b,"load_smaa_textures");if(a.b4w_export_errors)for(d=0;d<a.b4w_export_errors.length;d++)k=a.b4w_export_errors[d],(b.is_primary&&"PRIMARY"==k.type||"ALL"==k.type)&&R.export_error(k.text);if(a.b4w_export_warnings)for(d=0;d<a.b4w_export_warnings.length;d++)k=a.b4w_export_warnings[d],(b.is_primary&&"PRIMARY"==k.type||"ALL"==k.type)&&R.export_warn(k.text);e(b,c)}else ca.abort_thread(b)},
null,function(a){h(b,c,a)})}function k(a,b,c,d,e,h){d=S(b.filepath)+b.binary_name;if(!d)throw"Binary data is missing";na.enqueue([{id:d,type:na.AT_ARRAYBUFFER,url:d}],function(d,h,f,g){d?(R.log("%cLOAD BINARY","color: #616",g),a.bin_data=d,d=q(d),h=Ca.str_to_version(a.b4w_format_version),d[0]!=h[0]&&Ca.panic("BIN version does not match to JSON version: "+Ca.version_to_str(d)+", required: "+Ca.version_to_str(Ba.min_format_version)+". Couldn't load the scene. Reexport scene to fix it."),d[1]!=h[1]&&
R.warn("BIN version does not match to JSON version: "+ +Ca.version_to_str(d)+", required: "+Ca.version_to_str(Ba.min_format_version)+". Some compatibility issues can occur. Reexport scene to fix it."),e(b,c)):ca.abort_thread(b)},null,function(a){h(b,c,a)})}function d(a,b,c,d,e,h){W.check_shaders_loaded()&&e(b,c)}function l(a,b,c,d,e,h){d=a.bin_data;h=a.binaries[0];var f=a.objects,g=a.meshes;a=a.actions;for(var k=Ca.check_endians(),l=q(d),l=5<=l[0]&&4<l[1]?12:0,m=["indices"],n=["normal","tangent"],
p=["color","group"],R=["position","texcoord","texcoord2"],W=0;W<g.length;W++)for(var z=g[W].submeshes,v=0;v<z.length;v++)for(var y in z[v]){var u=z[v][y][1];if(-1!=m.indexOf(y)){var A=4*z[v][y][0]+h["int"]+l,N=z[v],L=y,ua=d;if(k)var x=new Uint32Array(ua,A,u);else for(var x=new Uint32Array(u),ua=new DataView(ua),C=0;C<u;C++)x[C]=ua.getUint32(A+4*C,!0);N[L]=x}else if(-1!=R.indexOf(y))A=4*z[v][y][0]+h["float"]+l,z[v][y]=r(d,A,u,k);else if(-1!=n.indexOf(y)){A=2*z[v][y][0]+h["short"]+l;N=z[v];L=y;ua=d;
x=new Float32Array(u);ua=new DataView(ua);for(C=0;C<u;C++)x[C]=ua.getInt16(A+2*C,!0)/32767;N[L]=x}else if(-1!=p.indexOf(y)){A=2*z[v][y][0]+h.ushort+l;N=z[v];L=y;ua=d;x=new Float32Array(u);ua=new DataView(ua);for(C=0;C<u;C++)x[C]=ua.getUint16(A+2*C,!0)/65535;N[L]=x}}for(y=0;y<f.length;y++)for(g=f[y].particle_systems,m=0;m<g.length;m++)n=g[m],n.transforms=r(d,4*n.transforms[0]+h["float"]+l,n.transforms[1],k);for(f=0;f<a.length;f++){y=a[f];g=y.fcurves;m=y.frame_range;p=m[0];R=m[1];W=oa.get_approx_curve_length(p,
R);m=null;0>W&&(W=0);var v=z=!1,t;for(t in g)z|=-1<t.indexOf("rotation_euler"),v|=-1<t.indexOf("rotation_quaternion");n=[];for(t in g)if(z&&v&&-1<t.indexOf("rotation_euler"))delete g[t];else{var u=g[t],w;for(w in u)A=u[w],N=r(d,h["float"]+4*A.bin_data_pos[0]+l,A.bin_data_pos[1],k),L=new Float32Array(W),null===m&&(m=new Int8Array(W)),oa.approximate_curve(A,N,L,m,p,R),A._pierced_points=L;-1<t.indexOf("rotation_euler")&&(oa.fcurve_replace_euler_by_quat(g[t]),n.push(t))}for(p=0;p<n.length;p++)R=n[p],
W=R.replace("euler","quaternion"),g[W]=g[R],delete g[R];y._bflags=m}e(b,c)}function q(a){var b=new Uint8Array(a,0,4),c=(new Uint32Array(a,4,1))[0];a=(new Uint32Array(a,8,1))[0];for(var d=0;d<b.length;d++)if("B4WB"[d]!=String.fromCharCode(b[d])){c=5;a=4;break}return[c,a]}function r(a,b,c,d){if(d)d=new Float32Array(a,b,c);else{d=new Float32Array(c);a=new DataView(a);for(var e=0;e<c;e++)d[e]=a.getFloat32(b+4*e,!0)}return d}function g(a,b,c,d,h,g){var k=a.cameras,l=a.groups,m=a.materials,n=a.meshes,q=
a.node_groups,r=a.objects,p=a.particles,W=a.scenes,v=a.speakers,y=a.lamps,u=a.textures,A=a.worlds;q||(R.warn('"node_groups" datablock undefined. reexport main scene.'),q=a.node_groups=[]);for(var N="actions armatures cameras curves groups images lamps materials meshes node_groups objects particles scenes sounds speakers textures worlds".split(" "),t={},w=0;w<N.length;w++)for(var E=a[N[w]],Z=0;Z<E.length;Z++){var J=E[Z];t[J.uuid]=J}for(var I=0;I<W.length;I++){for(var ba=W[I],Cb=ba.objects,B=0;B<Cb.length;B++)z(Cb,
B,t);ba.camera&&z(ba,"camera",t);ba.world&&z(ba,"world",t)}for(I=0;I<l.length;I++)for(var G=l[I].objects,B=0;B<G.length;B++)z(G,B,t);for(I=0;I<r.length;I++){var Q=r[I];Q.dupli_group&&z(Q,"dupli_group",t);Q.parent&&z(Q,"parent",t);Q.dg_parent&&z(Q,"dg_parent",t);if(Q.animation_data){var pa=Q.animation_data;pa.action&&z(pa,"action",t);if(pa.nla_tracks)for(B=0;B<pa.nla_tracks.length;B++)for(var D=pa.nla_tracks[B],M=0;M<D.strips.length;M++)D.strips[M].action&&z(D.strips[M],"action",t)}switch(Q.type){case "MESH":if(!Q.data)throw"mesh not found for object "+
Q.name;z(Q,"data",t);for(var F=!1,H=Q.modifiers,B=0;B<H.length;B++){var O=H[B];"ARMATURE"==O.type?(F&&R.warn('Object "'+Q.name+'" has more than one armature modifiers. Only the first one will be used.'),F=!0,z(O,"object",t)):"CURVE"==O.type&&z(O,"object",t)}var aa=Q.particle_systems;if(aa)for(B=0;B<aa.length;B++)z(aa[B],"settings",t);break;case "ARMATURE":z(Q,"data",t);for(var U=Q.pose.bones,Ba=Q.data.bones,B=0;B<U.length;B++){var K=U[B];K.bone=Ba[K.bone];var sb=K.constraints;if(sb)for(M=0;M<sb.length;M++){var ca=
sb[M];ca.target&&z(ca,"target",t)}for(var sa=K.parent_recursive,M=0;M<sa.length;M++)sa[M]=U[sa[M]]}break;case "LAMP":case "CAMERA":case "SPEAKER":case "CURVE":z(Q,"data",t)}if(sb=Q.constraints)for(B=0;B<sb.length;B++)ca=sb[B],ca.target&&z(ca,"target",t);var Vb=Q.lod_levels;if(Vb)for(B=0;B<Vb.length;B++){var T=Vb[B];T.object&&z(T,"object",t)}}for(I=0;I<n.length;I++)for(var gd=n[I].materials,B=0;B<gd.length;B++)z(gd,B,t);for(I=0;I<m.length;I++){for(var P=m[I],Fa=P.texture_slots,B=0;B<Fa.length;B++)z(Fa[B],
"texture",t);var la=P.node_tree;la&&e(la,t)}for(I=0;I<q.length;I++)(la=q[I].node_tree)&&e(la,t);for(I=0;I<u.length;I++){var ab=u[I],ga=ab.type;"IMAGE"!=ga&&"ENVIRONMENT_MAP"!=ga||z(ab,"image",t)}for(I=0;I<k.length;I++){var na=k[I];na.dof_object&&z(na,"dof_object",t)}for(I=0;I<v.length;I++){var wb=v[I];wb.sound&&z(wb,"sound",t);if(wb.animation_data&&(pa=wb.animation_data,pa.action&&z(pa,"action",t),pa.nla_tracks))for(B=0;B<pa.nla_tracks.length;B++)for(D=pa.nla_tracks[B],M=0;M<D.strips.length;M++)D.strips[M].action&&
z(D.strips[M],"action",t)}for(I=0;I<p.length;I++){for(var S=p[I],Fa=S.texture_slots,B=0;B<Fa.length;B++)z(Fa[B],"texture",t);S.dupli_group&&z(S,"dupli_group",t);S.dupli_object&&z(S,"dupli_object",t)}for(I=0;I<y.length;I++){var Ga=y[I];if(Ga.animation_data&&(pa=Ga.animation_data,pa.action&&z(pa,"action",t),pa.nla_tracks))for(B=0;B<pa.nla_tracks.length;B++)for(D=pa.nla_tracks[B],M=0;M<D.strips.length;M++)D.strips[M].action&&z(D.strips[M],"action",t)}for(I=0;I<A.length;I++)if(Fa=A[I].texture_slots)for(B=
0;B<Fa.length;B++)z(Fa[B],"texture",t);L.check_bpy_data(a);for(var V=a.textures,ka=b.is_primary?a.scenes[0].b4w_anisotropic_filtering:ja.b4w_anisotropic_filtering,ea=0;ea<V.length;ea++)b.is_primary||"SCENE"!=V[ea].b4w_source_type||(V[ea].b4w_source_id=""),La.create_texture_bpy(V[ea],ka,a.scenes,b.id);for(var X={},fa=a.objects,da=0;da<fa.length;da++){var Da=fa[da];if("MESH"===Da.type&&!Da.particle_systems.length)for(var cb=Da.data,fb=cb.name,ha=cb.submeshes,xa=cb.materials,ra=0;ra<ha.length;ra++)0!==
ha[ra].base_length||X[fb]||(xa[ra]&&R.warn('material "'+xa[ra].name+'" is not assigned to any face (object "'+Da.name+'").'),X[fb]=!0)}for(var va=a.meshes,Ec=0;Ec<va.length;Ec++){var Va=va[Ec];Va.materials.length||Va.uv_textures.length&&R.warn('mesh "'+Va.name+'" has a UV map but has no exported material.')}var Qb=a.materials,Wb=L.create_material("DEFAULT");Qb.push(Wb);for(var Fc=a.meshes,jc=Ca.keysearch("name","DEFAULT",a.materials),nb=0;nb<Fc.length;nb++){var Na=Fc[nb];0==Na.materials.length&&Na.materials.push(jc)}for(var ob=
a.actions,Tc=b.id,pb=0;pb<ob.length;pb++){var Kb=ob[pb];Kb._data_id=Tc;oa.append_action(Kb)}for(var bc=a.scenes,Ub=0;Ub<bc.length;Ub++){for(var Ra=bc[Ub],Ob=[],Lb=[],ub=bc[Ub].objects,Ka=0;Ka<ub.length;Ka++){var Bc=ub[Ka];x(ub,Bc,Ob,Lb);var Kc=Bc.dupli_group;if(Kc)for(var sc=Kc.objects,cc=0;cc<sc.length;cc++)x(sc,sc[cc],Ob,Lb)}for(Ka=0;Ka<Lb.length;Ka++)for(var Lc=Lb[Ka],dc=[Ra],tc=0;tc<dc.length;tc++){for(var Pb=dc[tc].objects,ec=0;ec<Pb.length;ec++){var fc=Pb[ec].dupli_group;if(fc){var Mc=fc.objects,
Xa=Mc.indexOf(Lc);-1<Xa&&Mc.splice(Xa,1)}}var Xa=Pb.indexOf(Lc);-1<Xa&&Pb.splice(Xa,1)}for(Ka=0;Ka<Ob.length;Ka++)Ca.append_unique(Ob[Ka][0],Ob[Ka][1])}!b.is_primary&&1<a.scenes.length&&(a.scenes=[Y.find_main_scene(a.scenes)],R.warn("loading data contains multiple scenes.","Only the first one will be loaded."));var ib=b.is_primary?ja:Y.find_main_scene(a.scenes);ua.set_framerate(ja.fps);if(1<a.scenes.length){var td=a.scenes.indexOf(ja);a.scenes.splice(td,1);a.scenes.unshift(ja)}for(var Oc=0;Oc<a.scenes.length;Oc++){var vb=
a.scenes[Oc];vb._render=Y.create_scene_render();vb._is_main=vb==ib;vb._is_primary_thread=b.is_primary;fd.enabled&&vb.b4w_enable_physics&&(b.is_primary||!ma.scene_has_physics(ja)&&vb==Y.find_main_scene(a))&&ma.init_scene_physics(vb);b.is_primary?vb.b4w_enable_audio&&za.attach_scene_sfx(vb):vb.b4w_enable_audio&&!ja._sfx&&za.attach_scene_sfx(ja)}for(var uc=0;uc<a.scenes.length;uc++){var Pc=a.scenes[uc],gc,Cc=[];C(Pc.objects,"ALL",Cc);gc=Cc;Pc.b4w_use_logic_editor&&L.assign_logic_nodes_object_params(gc,
Pc);for(var vc=0;vc<gc.length;vc++){var kc=gc[vc];qa.check_bpy_obj_scene_compatibility(kc,Pc,a)&&(kc._scenes||(kc._scenes=[]),kc._scenes.push(b.is_primary?Pc:ja))}for(var Uc=gc,od=0;od<Uc.length;od++){var hd=Uc[od];if(hd._scenes)for(var ad=hd.particle_systems,pd=0;pd<ad.length;pd++){var bd=ad[pd].settings;if("HAIR"==bd.type)if("OBJECT"==bd.render_type){var Vc=bd.dupli_object;Vc._scenes||(Vc._scenes=hd._scenes.slice())}else if("GROUP"==bd.render_type)for(var jd=bd.dupli_group,Wc=0;Wc<jd.objects.length;Wc++)Vc=
jd.objects[Wc],Vc._scenes||(Vc._scenes=hd._scenes.slice())}}}for(var ud=a.scenes,qd=[],qb=0;qb<ud.length;qb++)f(ud[qb].objects,0,b.is_primary,qd);ia[b.id]=[];for(qb=0;qb<qd.length;qb++)for(var cd=qd[qb],Dc=0;Dc<cd.length;Dc++)for(var kd=cd[Dc],Qc=0;Qc<kd.length;Qc++)ia[b.id].push(kd[Qc]);for(var dd=a.particles,qb=0;qb<dd.length;qb++){var wc=dd[qb].dupli_object;wc&&(wc._is_hair_dupli=!0,ia[b.id].push(wc));var ld=dd[qb].dupli_group;if(ld)for(var Xc=ld.objects,Dc=0;Dc<Xc.length;Dc++)wc=Xc[Dc],wc._is_hair_dupli=
!0,ia[b.id].push(wc)}for(var ed=ia[b.id],qb=ed.length-1;0<=qb;qb--)ed[qb]._scenes||ed.splice(qb,1);for(var md=ia[b.id],uc=0;uc<md.length;uc++)if(kc=md[uc],!b.is_primary&&kc.parent&&-1<$c.indexOf(kc.parent.type)&&(kc.parent=""),"MESH"==kc.type){var Yc=L.apply_mesh_modifiers(kc);Yc&&(a.meshes.push(Yc),kc.data=Yc)}h(b,c)}function C(a,b,c){for(var d=0;d<a.length;d++){var e=a[d];"ALL"!=b&&b!=e.type||c.push(e);(e=e.dupli_group)&&C(e.objects,b,c)}}function f(a,b,c,d){d[b]=d[b]||[];for(var e=d[b],h=0;h<a.length;h++){var g=
a[h],k=la(g);e[k]=e[k]||[];(c||-1==$c.indexOf(g.type))&&-1==e[k].indexOf(g)&&e[k].push(g);(g=g.dupli_group)&&f(g.objects,b+1,c,d)}}function h(a,b,c){var d=[];a=ia[a];for(var e=0;e<a.length;e++){var h=a[e];if(h.type==c||"ALL"==c)for(var f=0;f<h._scenes.length;f++)b==h._scenes[f]&&d.push(h)}return d}function n(a,b,c,d,e,h){h=ia[b.id];d=b.id;for(var f=0;f<h.length;f++){for(var g=h[f],k=ha.create_object(g.name,g.type,g.origin_name),l=0;l<g._scenes.length;l++)ha.append_scene_data(k,g._scenes[l]);g._object=
k;qa.update_object(g,k);k.render.data_id=d;k.is_hair_dupli=g._is_hair_dupli||!1}d=qa.get_all_objects(b.id);for(f=0;f<h.length;f++)g=h[f],k=g._object,ka.update_object(g,k);if(b.is_primary)for(f=b.id,g=0;g<a.scenes.length;g++)for(var k=a.scenes[g],l=0,m=qa.get_scene_objs(k,"LAMP",f),n=0;n<m.length;n++)ha.get_scene_data(m[n],k).light_index=l++;for(f=0;f<h.length;f++)g=h[f],k=g._object,k.is_hair_dupli||(qa.update_object_relations(g,k),Cb.update_transform(k));for(a=0;a<h.length;a++)if(f=h[a],g=f._object,
ha.is_mesh(g)&&(k=f.lod_levels.length))for(l=g,m=0;m<k;m++)if(n=f.lod_levels[m].object){n=n._object;n.render.lod_transition_ratio=g.render.lod_transition_ratio;l.render.lod_dist_max=f.lod_levels[m].distance;n.render.lod_dist_min=f.lod_levels[m].distance;if(f.lod_levels[m+1])n.render.lod_dist_max=f.lod_levels[m+1].distance;else{n.render.last_lod=!0;n.render.lod_dist_max=1E6;break}l.render.last_lod=!1;l=n}else{l.render.last_lod=!0;l.render.lod_dist_max=f.lod_levels[m].distance;break}for(h=0;h<d.length;h++)if(a=
d[h],"MESH"==a.type&&(f=a.armobj)){var f=f.render,g=a.render.bone_skinning_info,k=[],q;for(q in g)l=g[q],k.push(4*l.deform_bone_index,4*l.bone_index);f.mesh_to_arm_bone_maps.push(k);f.skinned_renders.push(a.render)}h=q=-1;a=oa.get_max_bones();for(f=0;f<d.length;f++)g=d[f],k=g.render,ha.is_mesh(g)&&k.is_skinning&&(g=k.max_bones,g>q&&(q=g),a>=g&&g>h&&(h=g));for(f=0;f<d.length;f++)g=d[f],k=g.render,ha.is_mesh(g)&&k.is_skinning&&(k.frames_blending=!0,q<a?k.max_bones=q:k.max_bones<=a?k.max_bones=h:(R.warn('too many bones for "'+
g.name+'" / '+k.max_bones+" bones (max "+a+" with blending, "+2*a+" without blending). Blending between frames will be disabled."),k.max_bones=q,k.frames_blending=!1),k.frames_blending=k.frames_blending&&!gd.frames_blending_hack);for(q=0;q<d.length;q++)if(h=d[q],h.is_vehicle)if(a=h.vehicle_settings,"CHASSIS"==a.part){h.vehicle={};h.vehicle.force_max=a.force_max;h.vehicle.brake_max=a.brake_max;h.vehicle.suspension_compression=a.suspension_compression;h.vehicle.suspension_stiffness=a.suspension_stiffness;
h.vehicle.suspension_damping=a.suspension_damping;h.vehicle.wheel_friction=a.wheel_friction;h.vehicle.roll_influence=a.roll_influence;h.vehicle.max_suspension_travel_cm=a.max_suspension_travel_cm;h.vehicle.engine_force=0;h.vehicle.brake_force=1;h.vehicle.steering=0;h.vehicle.speed=0;h.vehicle.props=[];h.vehicle.prop_offsets=[];h.vehicle.steering_wheel=null;g=(f=ha.get_dg_parent(h))?ha.get_dg_objects(f,d):d;for(f=0;f<g.length;f++)k=g[f],k.is_vehicle&&(l=k.vehicle_settings,ma.is_car_wheel(k)&&a.name==
l.name?(l=ma.wheel_index(k.vehicle_settings.part),h.vehicle.props[l]=k,h.vehicle.prop_offsets[l]=new Float32Array(8)):ma.is_vehicle_steering_wheel(k)&&a.name==l.name?(h.vehicle.steering_wheel=k,h.vehicle.steering_max=l.steering_max,h.vehicle.steering_ratio=l.steering_ratio,h.vehicle.inverse_control=l.inverse_control,l=pa.invert(h.render.world_tsr,pa.create()),k=pa.multiply(l,k.render.world_tsr,l),h.vehicle.steering_wheel_tsr=k,l=new Float32Array([1,0,0]),pa.transform_dir_vec3(l,k,l),h.vehicle.steering_wheel_axis=
l):ma.is_vehicle_speedometer(k)&&a.name==l.name?(h.vehicle.speedometer=k,h.vehicle.speed_ratio=l.speed_ratio,h.vehicle.max_speed_angle=l.max_speed_angle,l=pa.invert(h.render.world_tsr,pa.create()),k=pa.multiply(l,k.render.world_tsr,l),h.vehicle.speedometer_tsr=k,l=new Float32Array([1,0,0]),pa.transform_dir_vec3(l,k,l),h.vehicle.speedometer_axis=l):ma.is_vehicle_tachometer(k)&&a.name==l.name&&(h.vehicle.tachometer=k,h.vehicle.delta_tach_angle=l.delta_tach_angle,l=pa.invert(h.render.world_tsr,pa.create()),
k=pa.multiply(l,k.render.world_tsr,l),h.vehicle.tachometer_tsr=k,l=new Float32Array([1,0,0]),pa.transform_dir_vec3(l,k,l),h.vehicle.tachometer_axis=l));if(4!=h.vehicle.props.length)throw"Not enough wheels for chassis "+h.name;}else if("HULL"==a.part)for(h.vehicle={},h.vehicle.props=[],h.vehicle.prop_offsets=[],h.vehicle.force_max=a.force_max,h.vehicle.brake_max=a.brake_max,h.vehicle.floating_factor=a.floating_factor,h.vehicle.water_lin_damp=a.water_lin_damp,h.vehicle.water_rot_damp=a.water_rot_damp,
h.vehicle.engine_force=0,h.vehicle.brake_force=1,h.vehicle.steering=0,h.vehicle.speed=0,h.vehicle.steering_wheel=null,g=(f=ha.get_dg_parent(h))?ha.get_dg_objects(f,d):d,f=0;f<g.length;f++)k=g[f],k.is_vehicle&&(l=k.vehicle_settings,ma.is_boat_bob(k)&&a.name==l.name?(h.vehicle.props.push(k),h.vehicle.prop_offsets.push(new Float32Array(8))):ma.is_vehicle_steering_wheel(k)&&a.name==l.name?(h.vehicle.steering_wheel=k,h.vehicle.steering_max=l.steering_max,h.vehicle.steering_ratio=l.steering_ratio,h.vehicle.inverse_control=
l.inverse_control,l=pa.invert(h.render.world_tsr,pa.create()),k=pa.multiply(l,k.render.world_tsr,l),h.vehicle.steering_wheel_tsr=k,l=new Float32Array([1,0,0]),pa.transform_dir_vec3(l,k,l),h.vehicle.steering_wheel_axis=l):ma.is_vehicle_speedometer(k)&&a.name==l.name?(h.vehicle.speedometer=k,h.vehicle.speed_ratio=l.speed_ratio,h.vehicle.max_speed_angle=l.max_speed_angle,l=pa.invert(h.render.world_tsr,pa.create()),k=pa.multiply(l,k.render.world_tsr,l),h.vehicle.speedometer_tsr=k,l=new Float32Array([1,
0,0]),pa.transform_dir_vec3(l,k,l),h.vehicle.speedometer_axis=l):ma.is_vehicle_tachometer(k)&&a.name==l.name&&(h.vehicle.tachometer=k,h.vehicle.delta_tach_angle=l.delta_tach_angle,l=pa.invert(h.render.world_tsr,pa.create()),k=pa.multiply(l,k.render.world_tsr,l),h.vehicle.tachometer_tsr=k,l=new Float32Array([1,0,0]),pa.transform_dir_vec3(l,k,l),h.vehicle.tachometer_axis=l));for(q=0;q<d.length;q++)if(h=d[q],h.is_floating&&(a=h.floating_settings,"MAIN_BODY"==a.part))for(h.floater={},h.floater.floating_factor=
a.floating_factor,h.floater.water_lin_damp=a.water_lin_damp,h.floater.water_rot_damp=a.water_rot_damp,h.floater.bobs=[],f=(f=ha.get_dg_parent(h))?ha.get_dg_objects(f,d):d,g=0;g<f.length;g++)k=f[g],k.is_floating&&(l=k.floating_settings,ma.is_floater_bob(k)&&a.name==l.name&&(h.floater.bobs.push(k),k.bob_synchronize_pos=k.floating_settings.synchronize_position));e(b,c)}function A(a,b,c,d,e,f){for(d=0;d<a.scenes.length;d++)f=a.scenes[d],f._camera=f.camera._object;for(d=0;d<a.scenes.length;d++){f=b.is_primary?
a.scenes[d]:ja;var g=b.is_primary?qa.get_scene_objs(f,"LAMP",b.id):qa.get_scene_objs(f,"LAMP",0),k=qa.get_scene_objs(f,"ALL",b.id),l=h(b.id,f,"MESH"),m=h(b.id,f,"EMPTY");b.is_primary&&Y.append_scene(f,k,g,l,m);for(var n=0;n<m.length;n++)qa.update_force(m[n]._object);k=[];Y.set_active(f);N.generate_main_batches(f,l,g,k);n=h(b.id,f,"LINE");N.generate_line_batches(f,n);m=Y.get_graph(f);if(b.is_primary){n=f._render.sky_params;if(n.render_sky||n.procedural_skydome)n=N.generate_sky_meta_obj(f,n),k.push(n);
Y.generate_auxiliary_batches(m)}for(n=0;n<l.length;n++)N.create_forked_batches(l[n]._object,m,f);for(n=0;n<k.length;n++)N.create_forked_batches(k[n],m,f),qa.objects_storage_add(k[n]);k=qa.get_scene_objs(f,"ALL",b.id);Y.assign_scene_data_subs(f,k,g);for(n=0;n<k.length;n++)f=k[n],f.render.use_shape_keys&&qa.update_boundings(f)}Y.append_scene_vtex(ja,a.textures,b.id);b.is_primary&&ja._render.video_textures.length&&(b.has_video_textures=!0);d=a.materials;if(Vb.dds_available&&Ba.use_dds)for(a=0;a<d.length;a++){l=
d[a];n=l.texture_slots;for(f=0;f<n.length;f++)if(k=n[f],m=k.texture,"IMAGE"==m.type||"ENVIRONMENT_MAP"==m.type)g=m.image,g._is_dds||(-1<g.filepath.indexOf(".dds")?g._is_dds=!0:(g._is_dds=!m.b4w_disable_compression&&!k.use_map_normal&&"ENVIRONMENT_MAP"!=m.type&&!m.b4w_shore_dist_map&&"MOVIE"!=g.source,g._is_dds&&(g.filepath+=".dds")));if(f=l.node_tree)for(l=f.nodes,f=0;f<l.length;f++)g=l[f],"TEXTURE"==g.type&&(n=g.texture)&&(g=n.image)&&!g._is_dds&&(g._is_dds=n._render.allow_node_dds&&!n.b4w_disable_compression&&
"MOVIE"!=g.source&&"ENVIRONMENT_MAP"!=n.type,g._is_dds&&(g.filepath+=".dds"))}else for(a=a.images,d=0;d<a.length;d++)f=a[d],g=Boolean("FILE"==f.source&&-1<f.filepath.indexOf(".dds")),f._is_dds=g;e(b,c)}function B(a,b,c,d,e,h){d=a.groups;h=a.objects;for(var f={},g={},k={},l={},m=0;m<d.length;m++){var n=d[m];f[n.uuid]=n;k[n.uuid]=n}for(m=0;m<h.length;m++)n=h[m],g[n.uuid]=n,l[n.uuid]=n;a=a.scenes;for(m=0;m<a.length;m++)F(a[m].objects,null,l,k);for(var q in k)q in f||d.push(k[q]);for(q in l)q in g||h.push(l[q]);
e(b,c)}function F(a,b,c,d){for(var e=[],h=0;h<a.length;h++){var f=a[h],g=c[f.uuid];if(f=g.proxy){b&&-1==e.indexOf(f.uuid)&&e.push(f.uuid);for(var k=c[f.uuid],l=k.constraints,f=0;f<l.length;f++){var m=Ca.clone_object_json(l[f]);m.name+="_CLONE";g.constraints.push(m)}"b4w_proxy_inherit_anim"in g&&!g.b4w_proxy_inherit_anim||(g.animation_data&&(k.animation_data=Ca.clone_object_json(g.animation_data)),k.b4w_use_default_animation=g.b4w_use_default_animation,k.b4w_auto_skel_anim=g.b4w_auto_skel_anim,k.b4w_anim_behavior=
g.b4w_anim_behavior,k.b4w_cyclic_animation=g.b4w_cyclic_animation)}}for(h=0;h<e.length;h++)g=Ca.get_index_for_key_value(a,"uuid",e[h]),-1<g&&a.splice(g,1);e={};if(b)for(h=0;h<a.length;h++)f=a[h],g=c[f.uuid],l=Ca.clone_object_json(g),g="origin_name"in g?g.origin_name:g.name,l.name=ha.gen_dupli_name(b.name,g),l.origin_name=g,l.dg_parent={uuid:b.uuid},D(l),c[l.uuid]=l,e[f.uuid]=l.uuid,f.uuid=l.uuid;for(h=0;h<a.length;h++)f=a[h],g=c[f.uuid],g.dupli_group&&(f=g.dupli_group,l=d[f.uuid],k=Ca.clone_object_json(l),
k.name=Ca.unique_name(l.name+"_CLONE"),k.uuid=Ga.hexdigest("Group"+k.name),d[k.uuid]=k,f.uuid=k.uuid,F(k.objects,g,c,d));if(b)for(h=0;h<a.length;h++){f=a[h];g=c[f.uuid];g.parent&&g.parent.uuid in e?g.parent.uuid=e[g.parent.uuid]:g.parent&&(R.warn("Object's \""+g.name+'" parent is not in dupli group. Disabling parenting.'),g.parent=null);l=g.constraints;for(f=0;f<l.length;f++)b=l[f],b.target&&b.target.uuid in e&&(b.target.uuid=e[b.target.uuid]);if(b=g.pose)for(d=b.bones,f=0;f<d.length;f++)if(l=d[f].constraints)for(k=
0;k<l.length;k++)b=l[k],b.target&&b.target.uuid in e&&(b.target.uuid=e[b.target.uuid]);b=g.modifiers;for(f=0;f<b.length;f++)d=b[f],d.object&&d.object.uuid in e&&(d.object.uuid=e[d.object.uuid]);if((g=g.lod_levels)&&g.length)for(f=0;f<g.length;f++)b=g[f],b.object&&b.object.uuid in e&&(b.object.uuid=e[b.object.uuid])}for(var n in e)fb[n]=e[n]}function D(a){a.uuid=Ga.hexdigest("Object"+a.name)}function e(a,b){for(var c=a.nodes,d=0;d<c.length;d++){var e=c[d];"TEXTURE"==e.type&&e.texture&&z(e,"texture",
b);"LAMP"==e.type&&e.lamp&&(e.lamp.uuid in fb&&(e.lamp.uuid=fb[e.lamp.uuid]),b[e.lamp.uuid]||(e.lamp=null));"GROUP"==e.type&&e.node_group&&z(e,"node_group",b)}e=a.links;for(d=0;d<e.length;d++){var h=e[d];y(h,"from_node",c);y(h,"to_node",c);v(h,"from_socket",h.from_node.outputs);v(h,"to_socket",h.to_node.inputs)}if(c=a.animation_data)if(c.action&&z(c,"action",b),c.nla_tracks)for(d=0;d<c.nla_tracks.length;d++)for(e=c.nla_tracks[d],h=0;h<e.strips.length;h++)e.strips[h].action&&z(e.strips[h],"action",
b)}function z(a,b,c){(c=c[a[b].uuid])||R.error("Dangling link found:",b,a);a[b]=c}function y(a,b,c){c=Ca.keysearch("name",a[b].name,c);a[b]=c}function v(a,b,c){c=Ca.keysearch("identifier",a[b].identifier,c);a[b]=c}function m(a,b,d,e,h,f){e=S(b.filepath);for(var g=a.images,k={},l=[],m=0;m<g.length;m++){var n=g[m],q=n.uuid;if("FILE"===n.source||"MOVIE"===n.source){var r=K(n,a.textures);if(!r.length)R.warn("image ",n.name," has no users.");else if(!r[0].b4w_shore_dist_map){r=Ca.normpath_preserve_protocol(e+
n.filepath);if("FILE"===n.source){var p=n._is_dds?na.AT_ARRAYBUFFER:na.AT_IMAGE_ELEMENT;Vb.min50_available&&Ba.use_min50&&(r=na.split_extension(r),"dds"==r[1]?(r=na.split_extension(r[0]),r=r[0]+".min50."+r[1]+".dds"):r=r[0]+".min50."+r[1])}else"MOVIE"===n.source&&(Ba.seq_video_fallback?(r=na.split_extension(r),r=r[0]+".altconv.seq",p=na.AT_SEQ_VIDEO_ELEMENT):(r=na.split_extension(r),p=za.detect_video_container(r[1]),r=p!=r[1]?r[0]+".altconv."+p:r[0]+"."+p,p=na.AT_VIDEO_ELEMENT));l.push({id:q,type:p,
url:r});k[q]=n}}}if(l.length){var W=0;na.enqueue(l,function(e,h,g,m){if(e){if(g==na.AT_VIDEO_ELEMENT||g==na.AT_SEQ_VIDEO_ELEMENT){if(g==na.AT_VIDEO_ELEMENT)var n=e.videoWidth,q=e.videoHeight;else n=e.images[0].width,q=e.images[0].height;R.log("%cLOAD VIDEO "+n+"x"+q,"color: #"+(2048<n||2048<q?"a00":1024<n||1024<q?"aa0":"0a0"),m);-1==m.indexOf(Ec)&&R.warn("video",m,"is not from app root.")}else c(e,m,!0);h=k[h];m=K(h,a.textures);for(n=0;n<m.length;n++){var q=m[n],r=q.image.filepath;g==na.AT_SEQ_VIDEO_ELEMENT?
(q._render.seq_fps=e.fps,La.update_texture(q._render,e.images,h._is_dds,r,b.id)):La.update_texture(q._render,e,h._is_dds,r,b.id)}}e=++W/l.length;f(b,d,e)},function(){R.log("%cLOADED ALL IMAGES","color: #0a0");h(b,d)})}else h(b,d)}function u(a,b,c,d,e,h){a=Y.get_rendered_scenes();for(d=0;d<a.length;d++)if(h=a[d],h.b4w_use_nla){var f=h.b4w_nla_cyclic;h.b4w_use_logic_editor&&(f=!1);ka.update_scene(h,f,b.id)}e(b,c)}function K(a,b){for(var c=[],d=0;d<b.length;d++){var e=b[d];e.image===a&&c.push(e)}return c}
function E(a,b,c,d,e,h){a=S(b.filepath);var f=[],g={};d=qa.get_all_objects(b.id);for(var k=0;k<d.length;k++){var l=d[k];if(M(l)){var m=l.sfx.uuid;"BACKGROUND_MUSIC"==za.get_spk_behavior(l)?(m=Ca.gen_uuid(),b.has_background_music=!0):"NONE"!=za.get_spk_behavior(l)&&Ba.init_wa_context_hack&&(b.init_wa_context=!0);if(!(m in g)){g[m]=[];var n=Ca.normpath_preserve_protocol(a+l.sfx.filepath);switch(za.source_type(l)){case za.AST_ARRAY_BUFFER:var q=na.AT_AUDIOBUFFER;break;case za.AST_HTML_ELEMENT:q=na.AT_AUDIO_ELEMENT}var n=
na.split_extension(n),r=za.detect_audio_container(n[1]),n=r!=n[1]?n[0]+".altconv."+r:n[0]+"."+r;f.push({id:m,type:q,url:n})}g[m].push(l)}}if(f.length){var p=0;na.enqueue(f,function(a,d,e,k){if(a)for(R.log("%cLOAD SOUND","color: #0aa",k),-1==k.indexOf(Ec)&&R.warn("sound",k,"is not from app root."),d=g[d],e=0;e<d.length;e++)za.update_spkobj(d[e],a);a=++p/f.length;h(b,c,a)},function(){R.log("%cLOADED ALL SOUNDS","color: #0aa");e(b,c)})}else e(b,c)}function M(a){return ha.is_speaker(a)&&za.source_type(a)!=
za.AST_NONE}function J(a,b,c){a=qa.get_scene_objs(a,"SPEAKER",b);for(b=0;b<a.length;b++){var d=a[b];ha.is_speaker(d)&&(za.is_cyclic(d)||c)&&za.play_def(d)}}function O(a,b){for(var c=a._render.video_textures,d=0;d<c.length;d++){var e=c[d]._render;a.b4w_use_nla&&c[d].b4w_nla_video||!c[d].use_auto_refresh||b!=e.vtex_data_id||(La.reset_video(e.name,b),La.play_video(e.name,b))}}function G(a,b,c,d,e,h){ka.start();R.log("%cSTART NLA","color: #0a0");e(b,c)}function x(a,b,c,d){if(b.lod_levels&&b.lod_levels.length)for(var e=
b.lod_levels.length,h=0;h<e;h++){var f=b.lod_levels[h],g=f.object;if(g){var k=Ca.clone_object_nr(g);k.name=b.name+"_LOD_"+String(h+1);D(k);k.lod_levels=[];c.push([a,k]);d.push(g);f.object=k}}}function H(a,b,c,d,e,h){d=!0;for(h=0;h<a.scenes.length;h++)if(!ma.check_worker_loaded(a.scenes[h])){d=!1;break}d&&(e(b,c),R.log("%cPHYSICS READY","color: #0a0"))}function P(a,b,c,d,e,h){for(d=0;d<a.scenes.length;d++){h=a.scenes[d];if(b.is_primary)var f=ma.scene_has_physics(h);else f=ma.scene_has_physics(ja)||
ma.scene_has_physics(h),h=ja;if(fd.enabled&&f)for(f=0;f<Wb.length;f++)for(var g=qa.get_scene_objs(h,Wb[f],b.id),k=0;k<g.length;k++){var l=g[k];l.render.data_id==b.id&&(ma.append_object(l,h),b.load_hidden&&ma.obj_has_physics(l)&&ma.disable_simulation(l))}}e(b,c)}function I(a,b,d,e,h,f){var g={};e=[];var k=a.scenes;for(f=0;f<a.scenes.length;f++){var l=k[f];if(l._render.water_params&&(l=l._render.water_params.shoremap_image)&&"FILE"===l.source){var m=l.uuid,n=S(b.filepath),n=Ca.normpath_preserve_protocol(n+
l.filepath);e.push({id:m,type:l._is_dds?na.AT_ARRAYBUFFER:na.AT_IMAGE_ELEMENT,url:n});g[m]=l}}e.length?na.enqueue(e,function(d,e,h,f){if(d){c(d,f,!0);e=g[e];f=K(e,a.textures);for(h=0;h<f.length;h++){var l=f[h];La.update_texture(l._render,d,e._is_dds,l.image.filepath,b.id)}for(h=0;h<k.length;h++)if(f=k[h],f._render.water_params.shoremap_image===e){var m=d,n=e,q=document.createElement("canvas"),l=n.size[0],n=n.size[1];q.width=l;q.height=n;q=q.getContext("2d");q.drawImage(m,0,0);m=q.getImageData(0,0,
l,n).data;q=new Float32Array(4);q[0]=1/16581375;q[1]=1/65025;q[2]=1/255;q[3]=1;for(var l=l*n,n=new Float32Array(l),r=0;r<l;r++)n[r]=q[1]*m[4*r+2]+q[2]*m[4*r+3];f._render.shore_distances=n}}},function(){h(b,d)}):h(b,d)}function aa(a,b,d,e,h,f){e=a.scenes[0];a=[];var g=["SMAA_EDGE_DETECTION","SMAA_BLENDING_WEIGHT_CALCULATION","SMAA_NEIGHBORHOOD_BLENDING","SMAA_RESOLVE"];for(f=0;f<g.length;f++){var k=Y.get_subs(e,g[f]);k&&a.push(k)}if(a.length){e=[];S(b.filepath);f=na.AT_IMAGE_ELEMENT;e.push({id:"SEARCH_TEXTURE",
type:f,filepath:Z.paths.smaa_search_texture_path});e.push({id:"AREA_TEXTURE",type:f,url:Z.paths.smaa_area_texture_path});for(f=0;f<a.length;f++)if(g=a[f],"SMAA_BLENDING_WEIGHT_CALCULATION"==g.type){a=g.slinks_internal;for(f=0;f<a.length;f++)if(g=a[f],"u_search_tex"==g.to)var l=g.texture;else if("u_area_tex"==g.to)var m=g.texture;break}e.length?na.enqueue(e,function(a,d,e,h){a&&(c(a,h,!1),d="SEARCH_TEXTURE"==d?l:m,d.source="IMAGE",d.auxilary_texture=!0,e=-1!=h.indexOf(".dds")?1:0,La.update_texture(d,
a,e,h,b.id),La.set_filters(d,La.TF_LINEAR,La.TF_LINEAR))},function(){h(b,d)}):h(b,d)}else h(b,d)}function U(a,b,c,d,e,h){for(c=0;c<a.scenes.length;c++){e=a.scenes[c];b.is_primary||(e=ja);var f=qa.get_scene_objs(e,"LAMP",b.id);for(h=0;h<f.length;h++){var g=f[h];g.render.data_id==b.id&&d.added_objects.push({scene:e,obj:g})}f=qa.get_scene_objs(e,"ALL",b.id);for(h=0;h<f.length;h++)g=f[h],"LAMP"!=g.type&&g.render.data_id==b.id&&(b.load_hidden&&ha.is_mesh(g)&&Y.change_visibility(g,!0),d.added_objects.push({scene:e,
obj:g}))}}function T(a,b,c,d,e,h){var f=d.added_objects;e=d.obj_counter;if(f.length){a=f[e].obj;var g=f[e].scene;e=ha.get_scene_data(a,g);Y.append_object(g,a,!1);a.anchor&&ga.append(a);d=++d.obj_counter/f.length;f=e.cube_refl_subs;if(null!=a.render.cube_reflection_id&&f){var k=sb.copy(a.render.bs_world.center,cb);Y.update_cube_reflect_subs(f,k)}f=a.reflective_objs;if(f.length&&g._render.reflection_params)for(g=pa.get_trans_view(a.render.world_tsr),a=pa.get_quat_view(a.render.world_tsr),e=e.plane_refl_subs,
k=0;k<e.length;k++)Y.update_plane_reflect_subs(e[k],g,a),ha.update_refl_objects(f,e[k].camera.reflection_plane)}else d=1;h(b,c,d)}function w(a,b,c,d,e,h){if(b.is_primary){a=Y.get_main();d=Y.get_rendered_scenes();for(h=0;h<d.length;h++){var f=d[h];Y.prepare_rendering(f,a);f.b4w_use_logic_editor&&xa.init_logic(f,b.id)}Y.set_active(a)}else Y.update_scene_permanent_uniforms(ja);a=qa.get_all_objects(b.id);qa.update_objects_dynamics(a);e(b,c)}function fa(a,b,c,d,e,h){if(b.is_primary)for(d=0;d<a.scenes.length;d++)O(a.scenes[d],
b.id),J(a.scenes[d],b.id);else O(ja,b.id),J(ja,b.id);e(b,c)}function da(a,b,c,d,e,h){for(d=0;d<a.scenes.length;d++)a.scenes[d].camera=null;Ba.media_auto_activation&&(b.has_video_textures||b.has_background_music||b.init_wa_context)?Da||ea(a,e,b,c):e(b,c)}function ea(a,b,c,d){var e=Qb.parentElement;Fc=e.style.zIndex;e.style.zIndex="999";Da=document.createElement("div");Da.style.position="relative";Da.style.height="88px";Da.style.width="88px";var h=Math.round(Qb.offsetHeight/2-44),f=Math.round(Qb.offsetWidth/
2-44);Da.style.top=h.toString()+"px";Da.style.left=f.toString()+"px";Da.style.backgroundImage="url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALAAAACwCAYAAACvt+ReAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAbrwAAG68BXhqRHAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAABVDSURBVHic7Z15kF1Vncc/v05Ys7JIQJZ0GLaAgCzCQARGFMIwZKTiqCPBAbTEEodBhYKALJKSVWYsCpTBcgCLAdQBHWZACCCyhCElIRiWEMOSBZAkCglJOoTQyW/++J3Xfe95971+273v3fvOp6qr+5573+vT3d8+93vP+Z3fTwjUhKoKsC0wLvKxDTA68rEVMNK9ZDiwpft6PdDvvl4LvA+sBt5zn1cCy4EVwDJgpYhouj9RMZB2d6ATUdWtgD2BXvcxARgPbJ5RFzYAS4BFwGL38YqIvJ/R988NQcCAqm4LHADsA+yLibannX1KYBMm6JeBBcA8EVnZ3i61n64UsKoOAyYCh7iPCeTvd6HA68BcYA6wQEQ2trdL2ZO3P1rDqGoPsD9wNHAkMKqBt1nNoFctfV7j2ldj/rbPXdsvIuvd994S88QAIzCfHPXOHyHurRvt21PALOAFEdnUwHvkjsILWFV7gcnAUcDYWl8GvAEsZNCDLhKR91rfw4RvrjoWuyv0us97ALtS+99rFfAEMFNElqTRx06hkAJ2I94ngRMwXzsUmzCxzsP85csisja9HtaPqo7CbM9EzK/vRW1/vwXATODJ0h2hSBRKwO5hbAom3KFuw2uAZzD/+JyIrEm5ey1FVUcDB2Ee/hPU9vM+ANwnIu+m3L3MKISAVXU3YCrwNwx6zSTWArOBJ7Gn+P4q1+YGVR0OfByzSX+N+exKfAg8DtwtIm9m0L1UybWAVfWjwJcw4Vb6WRT4A3YbnV0U0VZCVTfDRDwZOJDKv5dNwGPAXSLydja9az25FLCqbg9MA44FhlW4bDXwIPYgszyrvnUSqrojJuRqlqof+C1wp4i8k1XfWkWuBKyqmwN/D3wRW7ZN4m3gfzHhfpBV3zoZNyofBXwem81I4gPgHsxabMiqb82SGwGr6lHAV7A50yQWA3cCT4c4gmRcPMeRwCnY0ngSK4BbRGRWZh1rgo4XsJtZOAvzdUm8CfwSeKxbJu+bxQl5EnAqsEuFy+YAPxKRP2fWsQboWAG7X/JJwGkMRnVFWQXcDjwchNsYbnVyMibkMQmXvA/8DLi/U+9qHSlg95B2HvCxhNP9wG+AO0SkL+F8oE7cws9UzCNvlnDJAuA6EVmWacdqoOMErKpHA98keS7zReAGEXkr2151B6q6C3A2sF/C6bWYpXgy215Vp2MErKpbYMI9NuF0H3ArNrPQkbeyouCs2wnA6SQPIo8AN3XKDE9HCFhVdwK+iwWv+DwLXF+k5c88oKrbAecAByecfh24shMsRdsFrKqHYn53pHdqAzYtdk8YdduDG40nA18DtvBOrwP+TURmZ96xCG0VsKp+DrtV+f1YDFwrIkuz7lOgHBeSej6wm38KmzP+deadcrRFwG765kxsmszncexBrXChf3nGzVScg63o+cwEftyOHSGZC9htmLwAONQ71Y/9N/9P1n0K1I6qngycQXkMyjPANVkPPJkKWFVHApcDe3un1mIPBc9n2Z9AY6jqgcBFlM9SLAAuy3J+PjMBu20yM4DdvVPLge+JyBtZ9SXQPC4G+zJsD1+U14BLs9p+lYmAXTzDFZRHQi0EZojIqiz6EWgtqroNcCmWQyPKUuDiLKY+Uxewqo4BrqL8CfZF4PKQrCPfuIe7S7Dg+ShvARekPTilKmBVHYGNvHt4p54FrshT3GmgMm4V9SJsf16URcBFae43TE3Abrbh+5Q/sM0Gri761p5uwwXNTwcO904twOxEKrMTqaRPcvO851Eu3uewqZYg3oIhIh9iVnGOd2ofYLrLhtRy0sr/dSbl/4nzMdvwYUrfM9Bm3MB0JfCCd+pQbFNCy2m5gN3ysL/CthCbWgmrawXHPdfMAF7xTk12iyAtpaUCVtXDsNiGKMuxqbIg3i7BzSzNwPbXRfmqC95qGS0TsKqOA75N/MGwjzDP25W41K+XYausA83AeS58tiW0RMCRucBo7oF+zPMWOrlcoDJudfUqIBrkMxK40KVIaJpWjcBnUR6MfkuIbQiIyDzgNq95d+AbrXj/pgWsqpMo3wb0eIgqC5Rw8cL+Xrrj3P7HpmhKwKr6EeBfvOYlwA3NvG+gkFyPxUhEOcvtQG+YhgXstpucSzykbgO2kyLMOARiOE1ci2XHLDES+I7TUkM0MwJPoTxvw63hoS1QCRFZjCVKiXIAcGKj79mQgJ11+LLX/BxwX6MdCXQN92K7N6Kc1qiVaHQE/ibx7JB9wA/D7uHAUDiN3MhgMRyArWlwqbluAbsskf5qyq0hb0OgVlwe4tu85sPcjFZd1CVgN/l8htf8IrYrNRCohwexAK8oX3OxxTVT7wg8FdghctyPbYEP1iFQF04zNzBYQxpge+Cz9bxPzQJ2qYb+wWu+NyTaCzSKW2q+32v+gttDWRP1jMDTiOfpXYUllg4EmuFOrJ5JiS2xDPI1UZOAXTWgT3vNt4f8vIFmcRq63Wv+jCtQMyS1jsCnEM/E8haWZjO3qOrDqrp/u/sRAGwSIFqzbjjwj7W8cEgBuwQWftDFfxagMvpngLmqerNbmAm0CVci4ude87GquvNQr61lBP6cd90SrCJ6ERiO7d/7o6pe0KoY1UBDPI5lJS3Rg2mvKlUF7J4Gj/Ga7yjgtNk2wNXAC6r6+XZ3phtxmvqF1/wpl/2nIkONwFOI1x7+E/B0/d3LDXsBvwz+uG08hRWqLLEZySl4B6goYLdN6ASv+b8LOPomEfxxG3Be+F6v+cRqq3PVRuCjie9xWwM82nj3ckfwx+3hYeLzwqNITqoNVBfw8d7xg10aqB78cYa46kd+bM3kStcnCtjVRNgn2gQ81Gznck7wx9kxE9NciYluOreMSiOwr/g/iMjbiVd2H8Efp4wr3+XvaPcdAZAgYJeYz/ccIVwyTvDH6ePf8Y9x2oyRNALvD4yNHPdhKVED5QR/nB5PY7XoSmwD7OtflCRgf9n4/0I61CEJ/rjFuCSB/sBZNhsRE7DL4XqEd01Rlo2zIPjj1uJrb5JvI/wReCIwOnK8GpiXQseKTPDHrWMutv5QYix2txvAF7Bf42BOsA8NE/xxkzjtzfWaYxr1BezvNvbTxQfqJ/jj5njWO45pdEDALuqnN3JuE5asJNAagj9ujGeJL2rs4YpmAvER+EDiyakXplkeqUsJ/rhOXMXP16JNRFKaRQU80XtteHhLj+CP68PX4sB8cE9So+Pl1LoTKBH8cW34WowL2BUlHB+5QIE/pt+vgCP44+rMJ+6DJ7h49YEReE/io/Ebwf9mTvDHFRCR1dhO+BLDcOWLS6Lt9V7j1/gKZEfwx8ks9I4nwKCAd/dOLkq9O4GhCP44jp84vRcqj8BBwJ1D8MeGr8legB5Xn8CPdg9lAjqL4I/jOSMAxquq9ADbAtFfyJpQWbNj6Vp/7BKoR3PxbQmM7QHGedcuy6xXgUbpVn+83DselyRg/6JA59Jt/tjX5g5BwPmnm/xx4gjs5576S0adCbSWbvDHK7zj7XqI78AAy7weyC9F9serveNRSQIOS8jFoIj+2Bfw6CDgYlM0f+xrc3QPVnC52kWB/FMUf+yPwCN7sBysUT7IqDOB7Mm7P97gHW+eJOCwC7n45NUff+gdb5YkYP+iQDHJoz9OFPBwrzGMwN1FnvxxooADgRLvt7sD9dJD+Yjrj8iBYrMSmA7sLyL3tbszQ1Bmd4djw/Lm3kX+016gePQDtwAXi8if292ZGqko4ChhBC4+jwDfFpEX292ROqlJwBVLGgVyz0Lg3BxYhUr4MyUbeihfeRtFoGjkyedWoyzsYTgJ68sZdSaQPnn0udVIFHBZhE9GnQmkS159bjV8bb4XBFw88u5zq+Hb27XDMX8UZfuMOhNoLSuBa4AfugIpRWQH7/id4ZTvM9oxo84EWkPRfG41fG0uTxKwr/JA51JEn1sNX5uJAg4jcOdTZJ9bjbId9D3Au8SD2EdFaxAEOoqizOfWjapuC4yINL0PvNcjIgos9a7vzapjgZroB34C7C0i1xT4Ia0aE7zjJSIyUPUwMfNfoCN4BDhIRL7eBQ9p1ej1jhfBYODOYu+kr/ZA9nSrz63EeO94CQwK2B+B90y9O4FKdMN8biPs5R0vhkEBvwJsxGoPAOyqqqNCnYxM6ab53LpQ1dHAzpGmjcCr4DK0i8h64jZCgH0y6l8g+Nyh2Jd4Ec7XnWZjlYkq1uIKpMZCYIqIHNdFixGN4GvxpdIX1QScx8QXeaFr53Mb5EDveECr0e1Dz2PF5EpD9d6qOsbVqg20huBz60RVxxCvoqUkjcAishJ4PXKhAB9Pu4NdRPC5jXEIcf/7SrSGi58XYm7CiwPNEXxuc/ganBM98AU8xzs+TFXDLuXGCD63SZz2fAHHBllfwAuI79AYSbAR9RLiFlrHwcTT/67CKzkbE7CIbASe8t7kk6l0rZgEn9tajvaOZ4nIpmhDUm60Wd7xEarqJ5QIxAk+t8W4bJmHec2+NhMF/DwWI1xiBHB467pWKILPTY8jga0jx+8SmT4rUSZgFx/sK/2ElnYt/wSfmz7HecdPOG3GqJRedaZ3fKCq7tSSbuWf4HNTRlV3BA7wmh9KujZRwCKyBJuRGGgCjm9J7/JL8LnZMZn44sV8EfF3DQGVR2AoH4VPUNUtm+1ZDgk+N0NUdQvKLauvxQGqCfgJ4nnTRgHHNt613BF8bns4jngGnjUkzD6UqChgEfkA+I3XPFVVu6EsQfC5bcBp67Ne831Oi4kMJcb7iecP3hE4orHu5YLgc9vLJCA6WbAB02BFqgpYRN4FHveap6mqJF2fY4LPbTNu9D3Fa340GnmWRC124G4guny3G+VLfHkl+NzO4Rhg18jxRuBXQ71oSAGLyJvAY17zNFUdlnB5nngAOCD43PbjRt8ves2/E5E/DfXaWh/I7iJejuuj5HxeWEROFBF/G1WgPZwI7BI57gd+XssLaxKwiLwN/NZrPlVVRyRdHwjUiqqOBKZ5zQ+LyLJaXl/PlNidwPrI8RjgS3W8PhBIYhrxed/12B2/JmoWsIi8gz3QRTlJVXdJuj4QGApV3Q34W6/5F272qybqXZT4FfF8wsOBbxVwWi2QMk4z/0x8Z/wy4N563qcuAbtpplu95n0I4ZaB+jmR8oQlP613KrPuZWERmQX83ms+XVW3q/e9At2Jqm4PnOY1zxaR2fW+V6NxDTcCfZHjEQQrEaiBiHWI7rZYB/x7I+/XkICdyb7daz4ImNLI+wW6ipOBQ72220TkL428WTORZfcDL3htp6tqbxPvGSgwqro78E9e8zxsVbQhGhaw25/0r8DaSPPmwPldGvgeqIKqbgWcD0R3uK/BEnmX7XWrlaZie92wf4PXvBtwbvDDgRJOC+cQXy4G+HGj1qFE08HpIvIUFgAe5QjKA5MD3ctUyhPkzBSRJ5t941btrriJeGZLgDNU1c/rGugyVPUgyn3vq8DNrXj/lgjYbfn4PvG8asOA74aHuu7FLRVPZ7D2CpjvvapVsdct298mIiuAHxAPft8auERVt2nV9wnkA1dZ83vEq2sqcJ2I+OWNG6alGzRF5DnKl5rHAZe6p9BAF6CqWwOXUV6c+6ci8mwrv1fLdxiLyK8Bf1/ZnsCMML1WfFxeh0uBv/JOPSgidQXq1EJaW+R/Avjr2hOBi13WwUABcQmpLwQ+5p2agz3ot5xUBOxyuF5HPD0VWLLsC0K61uLh/qYXUb5MPB+42uWebjmpLja4LUdXAHt4p54HZpSK1QXyjbMNF2PxMFEWAReKyNryV7WG1FfLXJnQq7EVuigvAZeLyLq0+xBID/dccwnltdzeBKYPldehWVJPEyUiq7H/Tj+74H7AFWGKLb+4qbJrKBfvUuCitMULGYzAJdzu0xmUVx1/BxuJ/ZW8QAfjFim+R/lU2WvApVkVyMw04MZ54sspLyTeB1wpIvOy7E+gMdzy8HTiixRgD2yXi0hf+avSIfOIMeeZLgA+4Z3aiC2C3NtMeF0gPVxU2VQstsHPzPR74NqsH8zbEvLoUgmdCZyUcHo2FiOa2X9xYGjcwPMtksuuPQjclNZUWTXaGrOrqicDX03ox1Lsv3lx5p0KlOF2UpxPeTzvJuA/0lhhq5W2B52r6gHYL2esd+pD4A7gnmAp2oOzDFOAM4jvpACLKvuBiPj1tTOl7QIGUNVx2CqOv34OVhv3epcZKJARbuv7OZQvToDNNFzZyqiyRukIAcNAZcZvUF4fDGyW4mfAA2E0Thc36v4d9qC2dcIlM4GbOyWXcscIuISqTgLOJl7kucR84AYReSPbXnUHbm73bCzwymcNcKPbQtYxdJyAYeD29R3Ki92B5Y69D7grzFS0BrfIdAqW7ml4wiXzsJmhpjZgpkFHChhqupWtxpKrPNSO6Zsi4LLsnwCcSjzFaYl1wG10sHXrWAGXcOvtX8cq2CSxHPgvTMibKlwTiOAGh0nAl4GdK1z2DPCjThx1o3S8gEs4b/wVbItSEkuxxMizOnW0aDduAWkSZhd2rXDZMmxu9+nMOtYEuREwDET8n4jd8pJsBdiIfC82Iod4YwaCzY8CvkD5YkSJ9Vj+57s7ZYahFnIl4BLOVkwDPk3yQwfYU/ODmJDfzqpvnYSq7oQVzp5MsscFeyh+GHsorjkzeqeQSwGXUNUdsTodn6JybLNiO0BmYjloczO6NIKbTz8SqyK1P5X/xhuB32HCbfuCRKPkWsAlXJ2OqZiQq+23W4cFC80C5opIf5Vrc4OzCAdhNuFwKtsrsCX6R7El+iHrsHU6hRBwCbe74yTMJ1e6ZZbow56052JiTn33QCtR1bHAwcAh2EbKoUqercFS4t6Xt5+1GoUScAm3yfAo7Dbq12FIfAmWr+t5bLXvZbcVqmNQ1THYCtm+2Bae3ant7zcfeAh4slrV97xSSAFHccujx2P1nbet9WXAW1j1+iVY4sIlWT3kuHoj44EJQC+WGKaecmbvAk9gGSALvexeeAGXcJP3+2Ej8yTKwzdroQ+bJ12BTdetwFYE10Q+r8PiZPtL03guGHw49qC5NWZvRkc+74DNb5c+GqmAugrz9rOAl7plLrxrBBzFTejvhXnHQ7C8FXn7XSjwCvCs+1jYjSuRefujpYLzl/tj/nIi5i/9PV/tZiNmZV7Gcmq8mNXO304mCDgBd8vfA/OfvZgXHQ9klZxwPbAY89+L3NevhpXFcoKA68BN05V86g7Adgz62NGYd90KG72Hua8B3sdG0H5MnH2YZy755ncY9NTLijTNlTb/Dz+sKh/f1rAbAAAAAElFTkSuQmCC')";
Da.style.backgroundSize="88px";Va=document.createElement("div");Va.style.position="relative";Va.style.height=Qb.offsetHeight.toString()+"px";Va.style.width=Qb.offsetWidth.toString()+"px";Va.style.background="rgba(0, 0, 0, 0.5)";Va.style.zIndex="999";e.appendChild(Va);Va.appendChild(Da);Da.addEventListener("click",function(){c.has_video_textures&&(La.play(),La.pause(),La.reset());if(c.has_background_music){if(c.is_primary)for(var e=0;e<a.scenes.length;e++)J(a.scenes[e],c.id,!0);else J(ja,c.id,!0);
za.pause()}c.init_wa_context&&za.play_empty_sound();V();b(c,d)},!1)}function V(){if(Da){var a=Qb.parentElement;a.style.zIndex=Fc;Va.removeChild(Da);a.removeChild(Va);Da=Va=null;Fc=0}}function S(a){(a=a.split("/").slice(0,-1).join("/"))&&(a+="/");return a}function X(a,b,c){oa.is_animated(b)&&oa.remove(b);qa.clear_outline_anim(b);ba.check_sensor_manifold(b)&&ba.remove_sensor_manifold(b);ma.obj_has_physics(b)&&ma.remove_bounding_object(b);Y.remove_object_bundles(a,b,c);ha.is_speaker(b)&&za.speaker_remove(b);
ga.is_anchor(b)&&ga.remove(b)}function la(a){var b=oa.get_bpy_armobj(a);a=b&&b.parent==a?null:a.parent||b;return a?1+la(a):0}var ga=p("__anchors"),oa=p("__animation"),na=p("__assets"),N=p("__batch");p("__camera");var Z=p("__config"),ba=p("__controls"),Q=p("__dds"),sa=p("__extensions");p("__lights");var ca=p("__loader");p("__mat4");var Ga=p("__md5"),ka=p("__nla"),xa=p("__logic_nodes"),ra=p("__nodemat"),qa=p("__objects"),ha=p("__obj_util"),ma=p("__physics"),R=p("__print"),L=p("__reformer"),Fa=p("__renderer"),
Y=p("__scenes"),za=p("__sfx"),W=p("__shaders"),La=p("__textures"),ua=p("__time"),Cb=p("__transform"),pa=p("__tsr"),Ca=p("__util"),sb=p("__vec3"),Ba=Z.defaults,Vb=Z.assets,fd=Z.physics,gd=Z.animation,ab=Z.sfx,wb=null,ia=null,Ec="",ja=null,fb={},cb=new Float32Array(3),Da=null,Va=null,Fc=0,va=!1,$c=["LAMP","CAMERA"],Wb=["MESH","CAMERA","EMPTY"],Qb=null;a.is_primary_loaded=function(a){return ca.is_primary_loaded(a)};a.update=function(){ca.update_scheduler(wb)};a.setup_canvas=function(a){Qb=a};a.update_media_controls=
function(a,b){if(Da){Va.style.height=b.toString()+"px";Va.style.width=a.toString()+"px";var c=Math.round(b/2-44),d=Math.round(a/2-44);Da.style.top=c.toString()+"px";Da.style.left=d.toString()+"px"}};a.load=function(a,c,e,h,f){var q={load_main:{priority:ca.ASYNC_PRIORITY,background_loading:!1,inputs:[],is_resource:!1,relative_size:500,primary_only:!1,cb_before:b},duplicate_objects:{priority:ca.SYNC_PRIORITY,background_loading:!1,inputs:["load_main"],is_resource:!1,relative_size:50,primary_only:!1,
cb_before:B},load_binaries:{priority:ca.ASYNC_PRIORITY,background_loading:!1,inputs:["load_main"],is_resource:!1,relative_size:500,primary_only:!1,cb_before:k},wait_for_shaders:{priority:ca.SYNC_PRIORITY,background_loading:!1,inputs:[],is_resource:!1,relative_size:50,primary_only:!0,cb_loop:d},prepare_bindata:{priority:ca.SYNC_PRIORITY,background_loading:!1,inputs:["duplicate_objects","load_binaries"],is_resource:!1,relative_size:100,primary_only:!1,cb_before:l},prepare_bpy_data:{priority:ca.SYNC_PRIORITY,
background_loading:!1,inputs:["duplicate_objects","prepare_bindata"],is_resource:!1,relative_size:100,primary_only:!1,cb_before:g},process_objects:{priority:ca.SYNC_PRIORITY,background_loading:!1,inputs:["prepare_bpy_data"],is_resource:!1,relative_size:150,primary_only:!1,cb_before:n},process_scenes:{priority:ca.SYNC_PRIORITY,background_loading:!1,inputs:["process_objects","wait_for_shaders"],is_resource:!1,relative_size:300,primary_only:!1,cb_before:A},load_smaa_textures:{priority:ca.ASYNC_PRIORITY,
background_loading:!1,inputs:["process_scenes"],is_resource:!1,relative_size:30,primary_only:!0,cb_before:aa},load_shoremap:{priority:ca.ASYNC_PRIORITY,background_loading:!1,inputs:["process_scenes"],is_resource:!1,relative_size:30,primary_only:!0,cb_before:I},load_textures:{priority:ca.ASYNC_PRIORITY,background_loading:!0,inputs:["process_scenes"],is_resource:!0,relative_size:500,primary_only:!1,cb_before:m},update_scenes_nla:{priority:ca.SYNC_PRIORITY,background_loading:!1,inputs:["process_scenes",
"load_textures"],is_resource:!1,relative_size:50,primary_only:!1,cb_before:u},wait_physics_workers:{priority:ca.SYNC_PRIORITY,background_loading:!1,inputs:["load_shoremap"],is_resource:!1,relative_size:20,primary_only:!1,cb_loop:H},add_physics_objects:{priority:ca.SYNC_PRIORITY,background_loading:!1,inputs:["wait_physics_workers"],is_resource:!1,relative_size:50,primary_only:!1,cb_before:P},add_objects:{priority:ca.SYNC_PRIORITY,background_loading:!1,inputs:["add_physics_objects"],is_resource:!1,
relative_size:600,primary_only:!1,cb_before:U,cb_loop:T,cb_after:w,cb_param:{added_objects:[],obj_counter:0}},load_speakers:{priority:ca.ASYNC_PRIORITY,background_loading:!0,inputs:["add_objects"],is_resource:!0,relative_size:100,primary_only:!1,cb_before:E},mobile_media_start:{priority:ca.SYNC_PRIORITY,background_loading:!1,inputs:["load_textures","update_scenes_nla","load_speakers"],is_resource:!0,relative_size:5,primary_only:!1,cb_before:da,cb_loop:da},synchronize_media:{priority:ca.SYNC_PRIORITY,
background_loading:!0,inputs:["mobile_media_start"],is_resource:!0,relative_size:50,primary_only:!1,cb_before:fa},start_nla:{priority:ca.SYNC_PRIORITY,background_loading:!0,inputs:["mobile_media_start"],is_resource:!1,relative_size:5,primary_only:!0,cb_before:G}},r=ca.get_scheduler();r||(r=ca.create_scheduler(),wb={},ia={},fb={});wb[r.threads.length]={};return ca.create_thread(q,a,c,e,t,h||ab.audio_loading_hack,Ba.do_not_load_resources,f)};a.unload=function(a){var b=ca.get_scheduler();if(!b||!b.threads.length||
a&&!ca.thread_is_finished(b.threads[a]))R.error("Unable to unload data!");else{if(0==a)R.log("%cUNLOAD ALL","color: #00a"),ga.cleanup(),oa.cleanup(),za.cleanup(),ka.cleanup(),Y.cleanup(),ca.cleanup(),ma.cleanup(),qa.cleanup(),Ca.cleanup(),Fa.cleanup(),ra.cleanup(),W.cleanup(),ba.cleanup(),sa.cleanup(),na.cleanup(),La.cleanup(),xa.cleanup(),ia=null,fb={},wb=ja=null,va=!1;else{R.log("%cUNLOAD DATA "+a,"color: #00a");oa.remove_actions(a);for(var b=Y.get_all_scenes(),c=0;c<b.length;c++)for(var d=b[c],
e=qa.get_scene_objs(d,"ALL",a),h=e.length-1;0<=h;h--){var f=e[h];X(d,f,!0);qa.remove_object(f)}}V()}};a.prepare_object_unloading=X;a.set_debug_resources_root=function(a){Ec=a};a.activate_media=function(){va||Ba.media_auto_activation||(La.play(),La.pause(),La.reset(),J(ja,qa.DATA_ID_ALL,!0),za.pause(),Ba.init_wa_context_hack&&za.play_empty_sound(),va=!0)}};b4w.module.__batch=function(a,p){function t(a){a={type:a,subtype:"",id:0,render_id:0,odd_id_prop:"",textures:[],texture_names:[],material_names:[],common_attributes:[],uv_maps_usage:null,vertex_colors_usage:{},shader:null,shaders_info:{vert:null,frag:null,directives:[],node_elements:[]},attribute_setters:[],particle_system:null,bufs_data:null,use_shape_keys:!1,debug_sphere:!1,debug_sphere_dynamic:!1,wireframe_mode:0,num_vertices:0,num_triangles:0,jitter_amp:0,jitter_freq:0,grass_scale_threshold:0,
grass_size:0,grass_map_dim:new Float32Array(3),cube_fog:new Float32Array(16),alpha_clip:!1,blend:!1,color_mask:!1,depth_mask:!1,xray:!1,use_backface_culling:!1,use_shadeless:!1,dynamic_geometry:!1,shadow_cast:!1,shadow_cast_only:!1,shadow_receive:!1,reflexible:!1,reflexible_only:!1,reflective:!1,dynamic_grass:!1,procedural_sky:!1,draw_mode:ea.DM_DEFAULT,zsort_type:ea.ZSORT_DISABLED,can_fork_outline:!1,forked_batch:!1,psys_name:"",shadow_source:"",halo:!1,halo_size:0,halo_hardness:0,halo_stars_blend:0,
halo_stars_height:0,halo_rings_color:new Float32Array(3),halo_lines_color:new Float32Array(3),halo_particles:!1,ambient:0,emit:0,diffuse_intensity:1,reflect_factor:0,specular_color_factor:0,specular_alpha:1,parallax_scale:0,diffuse_color_factor:0,alpha_factor:1,normal_factor:0,mirror_factor:0,offset_z:0,refr_bump:0,diffuse_params:Array(2),specular_params:new Float32Array(3),texture_scale:new Float32Array(3),specular_color:new Float32Array(3),diffuse_color:new Float32Array(4),fresnel_params:new Float32Array(4),
lamp_uuid_indexes:null,lamp_light_positions:null,lamp_light_directions:null,lamp_light_color_intensities:null,lamp_light_factors:null,has_nodes:!1,water:!1,water_dynamic:!1,water_shore_smoothing:!1,water_generated_mesh:!1,water_num_cascads:0,water_subdivs:0,water_detailed_dist:0,water_norm_uv_velocity:.1,shallow_water_col_fac:0,shore_water_col_fac:0,foam_factor:0,foam_uv_freq:new Float32Array(2),foam_mag:new Float32Array(2),foam_scale:new Float32Array(2),shallow_water_col:new Float32Array(3),shore_water_col:new Float32Array(3),
normalmap_scales:null,refractive:!1,particles_data:null,line_width:0};a.diffuse_color[3]=1;a.color_mask=!0;a.depth_mask=!0;a.line_width=1;return a}function c(a){switch(a.type){case "MAIN":case "PARTICLES":case "LINE":a.subtype=a.blend?a.xray?"XRAY":"BLEND":"OPAQUE";break;case "DEPTH":a.subtype=a.has_nodes?"NODES":"DEPTH";break;case "COLOR_ID":a.subtype=a.xray?"COLOR_ID_XRAY":"COLOR_ID"}}function b(a){var b=a.bufs_data;a.bufs_data=null;var c=X.copy_object_props_by_value(a);a.bufs_data=b;c.bufs_data=
b;return c}function k(a,b){for(var c=[],d=0;d<a.length;d++){var e=a[d],h=e._object.render,f=T.zero_bounding_box();T.copy_bb(h.bb_original,f);var g=e.data.b4w_bounding_cylinder_radius,k=e.data.b4w_bounding_sphere_radius,m=e.data.b4w_bounding_sphere_center,n=e.data.b4w_bounding_ellipsoid_axes,r=e.data.b4w_bounding_ellipsoid_center;if(h.billboard){var g=Math.max(Math.abs(f.max_x),Math.abs(f.min_x)),k=Math.max(Math.abs(f.max_y),Math.abs(f.min_y)),p=Math.max(Math.abs(f.max_z),Math.abs(f.min_z)),p=Math.sqrt(g*
g+k*k+p*p),g=Math.sqrt(g*g+k*k);f.max_x=f.max_y=f.max_z=p;f.min_x=f.min_y=f.min_z=-p;k=p;m[0]=m[1]=m[2]=0;n[0]=n[1]=n[2]=p;r[0]=r[1]=r[2]=0}h.bb_local=f;p=T.bounding_box_transform(f,h.world_tsr);h.bb_world=p;q(h,g,g,f);f=T.create_bounding_sphere(k,m);h.bs_local=f;f=T.bounding_sphere_transform(f,h.world_tsr);h.bs_world=f;n=T.create_bounding_ellipsoid([n[0],0,0],[0,n[1],0],[0,0,n[2]],r);h.be_local=n;n=T.bounding_ellipsoid_transform(n,h.world_tsr);h.be_world=n;c=c.concat(l(e,h,b))}return c}function d(a,
b,c){for(var d=[],e=[],h={},f=0;f<a.length;f++){var g=a[f],k=g._object.render,m=T.zero_bounding_box();T.copy_bb(k.bb_original,m);var n=T.bounding_box_transform(m,k.world_tsr),q=T.create_bounding_sphere(g.data.b4w_bounding_sphere_radius,g.data.b4w_bounding_sphere_center),r=T.bounding_sphere_transform(q,k.world_tsr),p=g.data.b4w_bounding_ellipsoid_axes,p=T.create_bounding_ellipsoid([p[0],0,0],[0,p[1],0],[0,0,p[2]],g.data.b4w_bounding_ellipsoid_center),v=T.bounding_ellipsoid_transform(p,k.world_tsr);
k.bb_local=m;k.bb_world=n;k.bs_local=q;k.bs_world=r;k.be_local=p;k.be_world=v;m={};m.shadow_cast=k.shadow_cast;m.shadow_cast_only=k.shadow_cast_only;m.shadow_receive=k.shadow_receive;m.selectable=k.selectable;m.origin_selectable=k.origin_selectable;m.outlining=k.outlining;m.origin_outlining=k.origin_outlining;m.outline_anim_settings_default=k.outline_anim_settings_default;m.reflexible=k.reflexible;m.reflexible_only=k.reflexible_only;m.reflective=k.reflective;m.cube_reflection_id=k.cube_reflection_id;
m.plane_reflection_id=k.plane_reflection_id;m.reflection_type=k.reflection_type;m.caustics=k.caustics;m.wind_bending=k.wind_bending;m.main_bend_col=k.main_bend_col;m.detail_bend_col=k.detail_bend_col;m.billboard=k.billboard;m.billboard_type=k.billboard_type;m.billboard_spherical=k.billboard_spherical;m.dynamic_grass=k.dynamic_grass;m.do_not_cull=k.do_not_cull;m.disable_fogging=k.disable_fogging;m.mats_values=k.mats_values;m.mats_value_inds=k.mats_value_inds;m.mats_anim_inds=k.mats_anim_inds;m.mats_rgbs=
k.mats_rgbs;m.mats_rgb_inds=k.mats_rgb_inds;m.mats_rgb_anim_inds=k.mats_rgb_anim_inds;m.dynamic_geometry=k.dynamic_geometry;n=k.bs_world.center;m.grid_id=0==c?[0,0]:[Math.floor(n[0]/c),Math.floor(n[2]/c)];m.lod_dist_max=k.lod_dist_max;m.lod_dist_min=k.lod_dist_min;m.lod_transition_ratio=k.lod_transition_ratio;m.do_not_render=k.do_not_render;k=JSON.stringify(m);h[k]=h[k]||[];h[k].push(g)}for(var y in h){m=JSON.parse(y);c=h[y];var g=X.create_render("STATIC"),u;for(u in m)g[u]=m[u];g.data_id=a[0]._object.render.data_id;
g.wind_bending_amp=0;g.wind_bending_freq=0;g.detail_bending_freq=0;g.detail_bending_amp=0;g.branch_bending_amp=0;g.hide=!1;for(f=0;f<c.length;f++)k=c[f]._object,0==f?(g.bb_world=ca.clone_object_r(k.render.bb_world),g.bs_world=ca.clone_object_r(k.render.bs_world),g.be_local=ca.clone_object_r(k.render.be_local),g.be_world=ca.clone_object_r(k.render.be_world)):(T.expand_bounding_box(g.bb_world,k.render.bb_world),T.expand_bounding_sphere(g.bs_world,k.render.bs_world));g.bb_local=ca.clone_object_r(g.bb_world);
g.bs_local=ca.clone_object_r(g.bs_world);e.push({render:g,bpy_objects:c})}for(a=0;a<e.length;a++)for(h=e[a].render,f=e[a].bpy_objects,y=0;y<f.length;y++){u=f[y];c=u._object.render;g=l(u,h,b);k=sa.create();c.billboard&&!c.billboard_pres_glob_orientation?(m=sa.get_trans_view(c.world_tsr),sa.set_trans(m,k)):sa.copy(c.world_tsr,k);m={};if(h.wind_bending||h.billboard)m.au_center_pos=[k[0],k[1],k[2]];h.wind_bending&&(m.au_wind_bending_amp=[c.wind_bending_amp],m.au_wind_bending_freq=[u.b4w_wind_bending_freq],
m.au_detail_bending_amp=[u.b4w_detail_bending_amp],m.au_detail_bending_freq=[u.b4w_detail_bending_freq],m.au_branch_bending_amp=[u.b4w_branch_bending_amp]);for(n=0;n<g.length;n++)p=g[n].render,q=g[n].submesh,r=g[n].batch,p.is_hair_particles?p.billboard?ea.submesh_apply_particle_transform(q,k):ea.submesh_apply_transform(q,k):("COLOR_ID"==r.type&&(g[n].render=c,r.odd_id_prop=u.uuid,z(r,c),p=O(c),J(r,p,0)),q=ea.submesh_apply_transform(q,k),ea.submesh_apply_params(q,m));d=d.concat(g)}return d}function l(a,
b,c){var d=[],e=r(c,b),h=O(b),f=a.data,k=f.materials,l=Array(k.length),m=Z.find_subs(c,"MAIN_OPAQUE"),n=!1;m&&(n=m.light_positions.length?!0:!1);for(var q=0;q<e.length;q++)for(var p=e[q],v=0;v<k.length;v++){var y=k[v];if(("LENS_FLARES"!=y.name||n)&&!ea.has_empty_submesh(f,v)){var A=t(p);"COLOR_ID"==p&&(A.can_fork_outline=!(a.b4w_do_not_render||y.b4w_do_not_render));"MAIN"==p&&(l[v]=A);if(M(A,y)){"DEPTH"==p&&l[v]&&(A.use_shadeless=l[v].use_shadeless);A.draw_mode=b.use_shape_keys||b.dynamic_geometry?
ea.DM_DYNAMIC_TRIANGLES:ea.DM_DEFAULT;z(A,b);for(var N=A,C=a.particle_systems,x=0;x<C.length;x++){var w=C[x].settings.b4w_vcol_from_name,I=C[x].settings.b4w_vcol_to_name;""!==w&&""!==I&&(N.vertex_colors_usage[w]={generate_buffer:!1,src:[{name:w,mask:7}]})}"DYNAMIC"==b.type&&(A.odd_id_prop=a.uuid);J(A,h);var B=ea.extract_submesh(f,v,A.common_attributes,b.bone_skinning_info,A.vertex_colors_usage,A.uv_maps_usage);"LENS_FLARES"==y.name&&(B=la.prepare_lens_flares(B));d.push({batch:A,submesh:B,mat_names:[y.name],
render:b,rel_bpy_objects:[a]})}}}var Q=a.particle_systems;if(0<Q.length&&d.length){for(var G=!1,D=!1,q=0;q<Q.length;q++){var F=Q[q],H=F.settings;H.use_render_emitter&&(G=!0);"HAIR"!=H.type||"OBJECT"!=H.render_type&&"GROUP"!=H.render_type&&F.transforms.length||(D=!0);if(G&&D)break}var aa=d[0].batch.vertex_colors_usage;if(D)if(1<k.length){for(var U,K={},T=0;T<Q.length;T++){var P=Q[T].settings;if("HAIR"==P.type&&("OBJECT"==P.render_type||"GROUP"==P.render_type)){var ga=P.b4w_vcol_from_name,S=P.b4w_vcol_to_name;
""!==ga&&""!==S&&(K[ga]=ca.clone_object_r(aa[ga]))}}"a_bending_col_main"in aa&&(K.a_bending_col_main=ca.clone_object_r(aa.a_bending_col_main));"a_bending_col_detail"in aa&&(K.a_bending_col_detail=ca.clone_object_r(aa.a_bending_col_detail));U=ea.extract_submesh_all_mats(f,[],K)}else U=d[0].submesh;else U=null;for(var oa,V=U,ka=a._object,da=[],ha=a.particle_systems,ra=a.data,qa=0;qa<ha.length;qa++){var ma=ha[qa],Za=ma.settings;if(Za.count)if("EMITTER"==Za.type){if("DYNAMIC"==b.type){var Pa=t("PARTICLES"),
jb,Rb=ra.materials,kb=ma.settings.material-1;kb>=Rb.length&&(fa.warn('Wrong material used for rendering particle system "'+ma.name+'"'),kb=0);jb=Rb[kb];"HALO"===ma.settings.render_type&&(Pa.halo_particles=!0);g(Pa,jb);var Sb=Pa,Ea=a,Aa=ma.settings;switch(Aa.b4w_billboard_align){case "VIEW":u(Sb,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_VIEW");break;case "XY":u(Sb,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_XY");break;case "YZ":u(Sb,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_YZ");break;case "ZX":u(Sb,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_ZX");
break;default:throw"Wrong billboard align value";}u(Sb,"BILLBOARD",0);var lc=Aa.b4w_enable_soft_particles&&X.check_obj_soft_particles_accessibility(Ea,Aa);Aa.b4w_enable_soft_particles&&!lc&&fa.warn('Emitter object "'+Ea.name+'" has a particle settings "'+Aa.name+'", which uses material with incorrect type of alpha.');u(Sb,"SOFT_PARTICLES",0<Aa.b4w_particles_softness&&lc&&xa.depth_tex_available?1:0);u(Sb,"SOFT_STRENGTH",ba.glsl_value(Aa.b4w_particles_softness));ba.set_directive(Sb.shaders_info,"WORLD_SPACE",
"WORLD"==Aa.b4w_coordinate_system?1:0);Pa.dynamic_geometry=!0;Pa.odd_id_prop=ka.name+"_"+Za.uuid;Pa.psys_name=ma.name;J(Pa,h);la.init_particles_data(Pa,ma,jb);var $a=la.generate_emitter_particles_submesh(Pa,ra,ma,ka.render.world_tsr);da.push({batch:Pa,submesh:$a,mat_names:[jb.name],render:b,rel_bpy_objects:[a]})}}else if("HAIR"==Za.type){var gb=ca.init_rand_r_seed(ma.seed);Za.b4w_dynamic_grass&&(b.do_not_cull=!0);var lb=na.check_particles_bin_format(xa.loaded_data_version)&&!Za.b4w_initial_rand_rotation&&
!Za.b4w_hair_billboard,wa=4;lb&&(wa=8);if(ma.transforms.length)var Ma=ma.transforms;else for(var bb=ea.geometry_random_points(V,Za.count,!1,gb),Ma=new Float32Array(bb.length*wa),Ha=0;Ha<bb.length;Ha++){var Ia=.75+.5*ca.rand_r(gb);Ma[Ha*wa]=bb[Ha][0];Ma[Ha*wa+1]=bb[Ha][1];Ma[Ha*wa+2]=bb[Ha][2];Ma[Ha*wa+3]=Ia;lb&&(Ma[Ha*wa+4]=1,Ma[Ha*wa+5]=0,Ma[Ha*wa+6]=0,Ma[Ha*wa+7]=0)}var xb=Z.find_subs(c,"GRASS_MAP")?!0:!1;if("OBJECT"==Za.render_type)var yb=[r(c,Za.dupli_object._object.render,!0)],mc=E(a,b,aa,V,
[Za.dupli_object],yb,[Ma],Za,ma,xb,gb,!1),da=da.concat(mc);else if("GROUP"==Za.render_type){for(var Qa=Za.dupli_group.objects,yb=[],Ha=0;Ha<Qa.length;Ha++){var Sc=r(c,Qa[Ha]._object.render,!0);yb.push(Sc)}for(var Hc=!1,nc=[],Ha=0;Ha<Qa.length;Ha++)nc.push(Qa[Ha]._object);if(Za.use_whole_group){for(var Yb,db=Ma,oc=nc,Ic=lb,pc=wa,tb={},Oa=new Float32Array([0,0,0,1]),Ja=0;Ja<db.length;Ja+=pc)for(var Sa=0;Sa<oc.length;Sa++){var Xb=Ga.create(),Eb=sa.get_scale(oc[Sa].render.world_tsr),Nb=sa.get_trans_view(oc[Sa].render.world_tsr);
Ga.scale(Nb,Eb,Xb);var Fb=Ga.clone([db[Ja],db[Ja+1],db[Ja+2]]);tb[Sa]||(tb[Sa]=new Float32Array(db.length));Ic&&(tb[Sa][Ja+4]=Oa[0]=db[Ja+4],tb[Sa][Ja+5]=Oa[1]=db[Ja+5],tb[Sa][Ja+6]=Oa[2]=db[Ja+6],tb[Sa][Ja+7]=Oa[3]=db[Ja+7],ca.quat_bpy_b4w(Oa,Oa),ca.transformQuatFast(Xb,Oa,Xb));Ga.add(Fb,Xb,Fb);tb[Sa][Ja]=Fb[0];tb[Sa][Ja+1]=Fb[1];tb[Sa][Ja+2]=Fb[2];tb[Sa][Ja+3]=db[Ja+3]}Yb=tb;Hc=!0}else{var qc;if(Za.use_group_count){for(var mb=Ma,Zb=nc,Jc=Za.dupli_weights,Gb=gb,$b=lb,hc=wa,Hb={},rb=[],ta=0;ta<Zb.length;ta++)for(var zb=
Zb[ta],ya=zb.origin_name||zb.name,Ta=0;Ta<Jc.length;Ta++){var hb=Jc[Ta];ya==hb.name&&rb.push(hb)}Jc.length!=rb.length&&fa.error("dupli weights match failed");for(ta=0;ta<mb.length;ta+=hc){for(var eb,Wa=rb,Ib=[0],Ab=0;Ab<Wa.length;Ab++)Ib[Ab+1]=Ib[Ab]+Wa[Ab].count;for(var ac=Ib[Ib.length-1]*ca.rand_r(Gb),Tb=0,Ab=0;Ab<Ib.length;Ab++)if(ac>=Ib[Ab]&&ac<Ib[Ab+1]){Tb=Ab;break}eb=Tb;Hb[eb]=Hb[eb]||[];Hb[eb].push(mb[ta],mb[ta+1],mb[ta+2],mb[ta+3]);$b&&Hb[eb].push(mb[ta+4],mb[ta+5],mb[ta+6],mb[ta+7])}for(eb in Hb)Hb[eb]=
new Float32Array(Hb[eb]);qc=Hb}else{for(var Jb=Ma,Bb=gb,rc=lb,ic=wa,jc=nc.length,nb={},Na=0;Na<Jb.length;Na+=ic){var ob=Math.floor(jc*ca.rand_r(Bb));nb[ob]=nb[ob]||[];nb[ob].push(Jb[Na],Jb[Na+1],Jb[Na+2],Jb[Na+3]);rc&&nb[ob].push(Jb[Na+4],Jb[Na+5],Jb[Na+6],Jb[Na+7])}for(ob in nb)nb[ob]=new Float32Array(nb[ob]);qc=nb}Yb=qc}mc=E(a,b,aa,V,Qa,yb,Yb,Za,ma,xb,gb,Hc);da=da.concat(mc)}"INSTANCE"==Za.b4w_wind_bend_inheritance&&ka.render.wind_bending&&fa.warn('Emitter object "'+ka.name+"\" has a particle system with wind bending inheritance from the particle instance. Wind bending on the emitter isn't disabled. Expect unforeseen behavior.")}else throw"Unknown particle settings type";
}oa=da;d=G?d.concat(oa):oa}return d}function q(a,b,c,d){a.bcyl_local=T.create_bounding_cylinder(b,d);a.bcap_local=T.create_bounding_capsule(c,d);a.bcon_local=T.create_bounding_cone(b,d)}function r(a,b,c){var d;b.do_not_render&&!c?(d=[],b.selectable&&Z.find_subs(a,"COLOR_PICKING")&&d.push("COLOR_ID")):(d=["MAIN","NODES_GLOW"],(b.selectable&&Z.find_subs(a,"COLOR_PICKING")||b.outlining&&Z.find_subs(a,"OUTLINE_MASK"))&&!c&&d.push("COLOR_ID"),Z.find_subs(a,"WIREFRAME")&&d.push("WIREFRAME"),((b.shadow_cast||
b.shadow_receive)&&Z.find_subs(a,"DEPTH")||Z.find_subs(a,"SHADOW_CAST"))&&d.push("DEPTH"),Z.find_subs(a,"GRASS_MAP")&&d.push("GRASS_MAP"));d.push("PHYSICS");if(b.shadow_cast_only||b.reflexible_only)for(a=null,b.shadow_cast_only&&(a=["MAIN","NODES_GLOW","COLOR_ID","PHYSICS","WIREFRAME"]),b.reflexible_only&&(b=["COLOR_ID","PHYSICS","DEPTH","WIREFRAME"],a=null!==a?ca.array_intersect(a,b):b),b=a,a=0;a<b.length;a++)c=d.indexOf(b[a]),-1!==c&&d.splice(c,1);return d}function g(a,b,c){switch(a.type){case "MAIN":if(b.b4w_do_not_render)a=
!1;else{if(b.use_nodes)D(a,b,"MAIN");else{f(a,b);var d=b.game_settings.alpha_blend;a.xray=b.b4w_render_above_all&&"OPAQUE"!=d&&"CLIP"!=d;a.offset_z=b.offset_z;a.texture_scale.set([1,1,1]);var e=b.texture_slots;ka.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.diffuse_color);switch(b.name){case "LENS_FLARES":x(a,"special_lens_flares.glslv","special_lens_flares.glslf");m(a,"a_position");m(a,"a_texcoord");var g=c?[1,1,1,0]:null,g=h(e[0],g);H(a,g);break;default:x(a,"main.glslv",
"main_stack.glslf");if(!b.use_shadeless){var k=S.create_lighting_graph(b.uuid,b.name,{use_shadeless:b.use_shadeless,diffuse_shader:b.diffuse_shader,specular_shader:b.specular_shader});a.shaders_info.node_elements=S.compose_node_elements(k)}var l=n("use_map_color_diffuse",!0,e),q=n("use_map_color_spec",!0,e),r=n("use_map_normal",!0,e),p=n("use_map_mirror",!0,e),g=n("use_stencil",!0,e),k=l[0],q=q[0],r=r[0],p=p[0],l=l[1],e=g[0]&&n("use_rgb_to_intensity",!0,e)[0];if(k){switch(k.blend_type){case "MIX":u(a,
"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX");break;case "MULTIPLY":u(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY")}g="IMAGE"==k.texture._render.source&&c?[a.diffuse_color[0],a.diffuse_color[1],a.diffuse_color[2],1]:"ENVIRONMENT_MAP"==k.texture._render.source&&c?[.8,.8,.8,1]:null;g=h(k,g);H(a,g,"u_colormap0");xa.alpha_clip_filtering_hack&&"CLIP"==d&&Q.set_filters(g,Q.TF_NEAREST,Q.TF_NEAREST);a.diffuse_color_factor=k.diffuse_color_factor;a.alpha_factor=k.use_map_alpha?k.alpha_factor:0;a.texture_scale.set(k.scale)}d=
k&&k==q;q&&(d||(g=c?[.5,.5,.5,1]:null,g=h(q,g),H(a,g,"u_specmap0")),a.specular_color_factor=q.specular_color_factor);if(r&&(m(a,"a_normal"),m(a,"a_tangent"),g=c?[.5,.5,1,1]:null,g=h(r,g),H(a,g,"u_normalmap0"),a.normal_factor=r.normal_factor,g=r.texture,g.b4w_use_map_parallax&&xa.parallax)){var z=ba.glsl_value(g.b4w_parallax_steps),v=ba.glsl_value(g.b4w_parallax_lod_dist);u(a,"PARALLAX",1);u(a,"PARALLAX_STEPS",z);u(a,"PARALLAX_LOD_DIST",v);a.parallax_scale=g.b4w_parallax_scale}p&&(g=c?[0,0,.5,1]:null,
g=h(p,g),H(a,g,"u_mirrormap"),a.mirror_factor=p.mirror_factor);if(p=k&&l&&e?1:0)g=c?[.8,.8,.8,1]:null,g=h(l,g),H(a,g,"u_colormap1"),g=c?[.5,.5,.5,1]:null,g=h(e,g),H(a,g,"u_stencil0");(c=k||q||r)&&a.texture_scale.set(c.scale);u(a,"TEXTURE_SPEC",void 0==q?0:1);u(a,"ALPHA_AS_SPEC",d?1:0);u(a,"TEXTURE_STENCIL_ALPHA_MASK",p);m(a,"a_position");m(a,"a_normal");(k||q||r)&&m(a,"a_texcoord");if(b.b4w_water){a.water=!0;a.water_dynamic=b.b4w_water_dynamic;b.b4w_water_shore_smoothing&&!a.blend?(fa.warn('Material: "'+
b.name+'" is opaque.',"Disabling shore smoothing."),a.water_shore_smoothing=!1):a.water_shore_smoothing=b.b4w_water_shore_smoothing;x(a,"special_water.glslv","special_water.glslf");c=S.create_lighting_graph(b.uuid,b.name,{use_shadeless:!1,diffuse_shader:b.diffuse_shader,specular_shader:b.specular_shader});a.shaders_info.node_elements=S.compose_node_elements(c);m(a,"a_position");xa.water_wireframe_debug?(m(a,"a_polyindex"),a.depth_mask=!0,a.wireframe_edge_color=[0,0,0],u(a,"DEBUG_WIREFRAME",1)):u(a,
"DEBUG_WIREFRAME",0);d=b.texture_slots;c=n("use_map_normal",!0,d);p=n("use_map_mirror",!0,d)[0];c.length&&(g=h(c[0]),H(a,g,"u_normalmap0"),a.water_norm_uv_velocity=b.b4w_water_norm_uv_velocity);u(a,"NUM_NORMALMAPS",c.length);a.normalmap_scales=Array(c.length);for(g=0;g<c.length;g++)a.normalmap_scales[g]=new Float32Array(2),a.normalmap_scales[g].set([c[g].scale[0],c[g].scale[1]]);p&&(g=h(p),H(a,g,"u_mirrormap"),a.mirror_factor=p.mirror_factor);p=null;if(xa.foam)for(g=0;g<d.length;g++){var y=d[g];if(!0===
y.texture.b4w_water_foam){p=y;break}}p?(u(a,"FOAM",1),g=h(p),H(a,g,"u_foam"),a.foam_factor=b.b4w_foam_factor,a.foam_uv_freq.set(p.texture.b4w_foam_uv_freq),a.foam_mag.set(p.texture.b4w_foam_uv_magnitude),a.foam_scale[0]=p.scale[0],a.foam_scale[1]=p.scale[1]):u(a,"FOAM",0);for(g=0;g<d.length;g++)if(y=d[g],!0===y.texture.b4w_shore_dist_map){var N=y;break}N&&xa.allow_vertex_textures?(N=h(N),H(a,N,"u_shore_dist_map"),u(a,"SHORE_PARAMS",1),N=y.texture.b4w_shore_boundings,u(a,"MAX_SHORE_DIST",ba.glsl_value(y.texture.b4w_max_shore_dist)),
u(a,"SHORE_MAP_SIZE_X",ba.glsl_value(N[0]-N[1])),u(a,"SHORE_MAP_SIZE_Y",ba.glsl_value(N[2]-N[3])),u(a,"SHORE_MAP_CENTER_X",ba.glsl_value((N[0]+N[1])/2)),u(a,"SHORE_MAP_CENTER_Y",ba.glsl_value((N[2]+N[3])/2))):u(a,"SHORE_PARAMS",0);if(b.b4w_generated_mesh&&xa.depth_tex_available)u(a,"GENERATED_MESH",1),a.water_generated_mesh=!0,a.water_num_cascads=b.b4w_water_num_cascads,a.water_subdivs=b.b4w_water_subdivs,a.water_detailed_dist=b.b4w_water_detailed_dist;else{m(a,"a_normal");if(p||c.length)m(a,"a_texcoord"),
m(a,"a_tangent");u(a,"GENERATED_MESH",0)}if(b.b4w_water_dynamic){y=ba.glsl_value(b.b4w_water_dst_noise_scale0);N=ba.glsl_value(b.b4w_water_dst_noise_scale1);c=ba.glsl_value(b.b4w_water_dst_noise_freq0);var d=ba.glsl_value(b.b4w_water_dst_noise_freq1),p=ba.glsl_value(b.b4w_water_dir_min_shore_fac),g=ba.glsl_value(b.b4w_water_dir_freq),z=ba.glsl_value(b.b4w_water_dir_noise_scale),v=ba.glsl_value(b.b4w_water_dir_noise_freq),t=ba.glsl_value(b.b4w_water_dir_min_noise_fac),w=ba.glsl_value(b.b4w_water_dst_min_fac),
I=ba.glsl_value(b.b4w_water_waves_hor_fac);u(a,"DST_NOISE_SCALE_0",y);u(a,"DST_NOISE_SCALE_1",N);u(a,"DST_NOISE_FREQ_0",c);u(a,"DST_NOISE_FREQ_1",d);u(a,"DIR_MIN_SHR_FAC",p);u(a,"DIR_FREQ",g);u(a,"DIR_NOISE_SCALE",z);u(a,"DIR_NOISE_FREQ",v);u(a,"DIR_MIN_NOISE_FAC",t);u(a,"DST_MIN_FAC",w);u(a,"WAVES_HOR_FAC",I)}B(a,b);F(a,b);a.shallow_water_col.set(b.b4w_shallow_water_col);a.shore_water_col.set(b.b4w_shore_water_col);a.shallow_water_col_fac=b.b4w_shallow_water_col_fac;a.shore_water_col_fac=b.b4w_shore_water_col_fac;
u(a,"ABSORB",ba.glsl_value(b.b4w_water_absorb_factor));u(a,"SSS_STRENGTH",ba.glsl_value(b.b4w_water_sss_strength));u(a,"SSS_WIDTH",ba.glsl_value(b.b4w_water_sss_width))}"HALO"===b.type&&(y=b.halo,x(a,"halo.glslv","halo.glslf"),u(a,"NUM_RINGS",y.ring_count),u(a,"NUM_LINES",y.line_count),u(a,"NUM_STARS",y.star_tip_count),u(a,"SKY_STARS",b.b4w_halo_sky_stars?1:0),a.common_attributes=["a_position"],a.halo_size=y.size,a.halo_hardness=y.hardness/20,a.halo_rings_color.set(y.b4w_halo_rings_color),a.halo_lines_color.set(y.b4w_halo_lines_color),
a.halo_stars_blend=1/b.b4w_halo_stars_blend_height,a.halo_stars_height=b.b4w_halo_stars_min_height,a.halo=!0);u(a,"TEXCOORD",0);u(a,"NORMAL_TEXCOORD",0);k&&C(a,k,"TEXTURE_COLOR0_CO");l&&C(a,l,"TEXTURE_COLOR1_CO");e&&C(a,e,"TEXTURE_STENCIL_ALPHA_MASK_CO");q&&C(a,q,"TEXTURE_SPEC_CO");r&&C(a,r,"TEXTURE_NORM_CO");u(a,"SHADELESS",b.use_shadeless?1:0);a.use_shadeless=b.use_shadeless}d=b.game_settings.alpha_blend;u(a,"ALPHA","OPAQUE"===d?0:1);u(a,"ALPHA_CLIP","CLIP"===d?1:0);u(a,"DOUBLE_SIDED_LIGHTING",
b.b4w_double_sided_lighting?1:0);b.use_vertex_color_paint?(u(a,"VERTEX_COLOR",1),m(a,"a_color")):u(a,"VERTEX_COLOR",0);a.ambient=b.ambient;a.diffuse_intensity=b.diffuse_intensity;a.emit=b.emit;a.specular_color.set(b.specular_color);a.specular_alpha=b.specular_alpha;B(a,b);F(a,b);b.b4w_wettable?u(a,"WETTABLE",1):u(a,"WETTABLE",0);A(a,b);a.refractive=b.b4w_refractive;a.refr_bump=b.b4w_refr_bump}a=!0}break;case "NODES_GLOW":a=D(a,b,"GLOW");break;case "DEPTH":if("LENS_FLARES"===b.name||b.b4w_water||b.b4w_do_not_render||
"HALO"===b.type)a=!1;else if(f(a,b),a.blend)a=!1;else{k=b.game_settings.alpha_blend;b.use_nodes&&"CLIP"==k?D(a,b,"DEPTH"):(x(a,"depth.glslv","depth.glslf"),ka.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.diffuse_color));m(a,"a_position");m(a,"a_normal");u(a,"ALPHA","OPAQUE"===k?0:1);a.texture_scale.set([1,1,1]);if((b=n("use_map_color_diffuse",!0,b.texture_slots)[0])&&"CLIP"===k){switch(b.blend_type){case "MIX":u(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX");break;case "MULTIPLY":u(a,
"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY")}a.texture_scale.set(b.scale);u(a,"TEXTURE_COLOR",1);m(a,"a_texcoord");if("IMAGE"==b.texture._render.source||"ENVIRONMENT_MAP"==b.texture._render.source||"CANVAS"==b.texture._render.source)k=h(b),H(a,k,"u_colormap0");"NONE"==b.texture._render.source&&(k=h(b),H(a,k,"u_colormap0"))}else u(a,"TEXTURE_COLOR",0);a=!0}break;case "PHYSICS":b.b4w_collision?(a.use_ghost=b.b4w_use_ghost,a.collision_id=b.b4w_collision_id,a.collision_margin=b.b4w_collision_margin,
a.collision_group=b.b4w_collision_group,a.collision_mask=b.b4w_collision_mask,a.friction=b.physics.friction,a.elasticity=b.physics.elasticity,a=!0):b.b4w_water?(a.water=!0,a.water_dynamics=b.b4w_water_dynamic,a.dst_noise_scale0=b.b4w_water_dst_noise_scale0,a.dst_noise_scale1=b.b4w_water_dst_noise_scale1,a.dst_noise_freq0=b.b4w_water_dst_noise_freq0,a.dst_noise_freq1=b.b4w_water_dst_noise_freq1,a.dir_min_shore_fac=b.b4w_water_dir_min_shore_fac,a.dir_freq=b.b4w_water_dir_freq,a.dir_noise_scale=b.b4w_water_dir_noise_scale,
a.dir_noise_freq=b.b4w_water_dir_noise_freq,a.dir_min_noise_fac=b.b4w_water_dir_min_noise_fac,a.dst_min_fac=b.b4w_water_dst_min_fac,a.waves_hor_fac=b.b4w_water_waves_hor_fac,a=!0):a=!1;break;case "COLOR_ID":if("LENS_FLARES"===b.name||"HALO"===b.type)a=!1;else{f(a,b);a.zsort_type=ea.ZSORT_DISABLED;a.depth_mask=!0;a.blend=!1;k=b.game_settings.alpha_blend;a.xray=b.b4w_render_above_all&&"OPAQUE"!=k&&"CLIP"!=k;b.use_nodes&&"CLIP"==k?D(a,b,"COLOR_ID"):(x(a,"color_id.glslv","color_id.glslf"),ka.set(b.diffuse_color[0],
b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.diffuse_color));m(a,"a_position");u(a,"ALPHA","OPAQUE"===k?0:1);a.texture_scale.set([1,1,1]);if((b=n("use_map_color_diffuse",!0,b.texture_slots)[0])&&"CLIP"===k){switch(b.blend_type){case "MIX":u(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX");break;case "MULTIPLY":u(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY")}a.texture_scale.set(b.scale);u(a,"TEXTURE_COLOR",1);m(a,"a_texcoord");if("IMAGE"==b.texture._render.source||"ENVIRONMENT_MAP"==b.texture._render.source)k=
h(b),H(a,k,"u_colormap0");"NONE"==b.texture._render.source&&(k=h(b),H(a,k,"u_colormap0"))}else u(a,"TEXTURE_COLOR",0);a=!0}break;case "GRASS_MAP":!b.b4w_terrain||b.b4w_do_not_render?a=!1:(f(a,b),a.blend=!1,a.zsort_type=ea.ZSORT_DISABLED,a.depth_mask=!0,x(a,"grass_map.glslv","grass_map.glslf"),m(a,"a_position"),k=b.b4w_dynamic_grass_size?b.b4w_dynamic_grass_size:null,b=b.b4w_dynamic_grass_color?b.b4w_dynamic_grass_color:null,a.vertex_colors_usage.a_grass_size={generate_buffer:!0,src:[]},k?(a.vertex_colors_usage.a_grass_size.src.push({name:k,
mask:4}),u(a,"DYNAMIC_GRASS_SIZE",1)):u(a,"DYNAMIC_GRASS_SIZE",0),a.vertex_colors_usage.a_grass_color={generate_buffer:!0,src:[]},b?(a.vertex_colors_usage.a_grass_color.src.push({name:b,mask:7}),u(a,"DYNAMIC_GRASS_COLOR",1)):u(a,"DYNAMIC_GRASS_COLOR",0),a=!0);break;case "WIREFRAME":"LENS_FLARES"===b.name||b.b4w_water||b.b4w_do_not_render||"HALO"===b.type?a=!1:(x(a,"wireframe.glslv","wireframe.glslf"),m(a,"a_position"),m(a,"a_normal"),m(a,"a_polyindex"),a.depth_mask=!0,a.wireframe_mode=0,a.wireframe_edge_color=
[0,0,0],a=!0);break;case "PARTICLES":if(b.b4w_do_not_render)a=!1;else{k=b.texture_slots;if(a.halo_particles)x(a,"particles_color.glslv","particles_color.glslf");else if(x(a,"particles_texture.glslv","particles_texture.glslf"),q=S.create_lighting_graph(b.uuid,b.name,{use_shadeless:!1,diffuse_shader:b.diffuse_shader,specular_shader:b.specular_shader}),a.shaders_info.node_elements=S.compose_node_elements(q),k=n("use_map_color_diffuse",!0,k)[0]){u(a,"TEXTURE_COLOR",1);switch(k.blend_type){case "MIX":u(a,
"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX");break;case "MULTIPLY":u(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY")}a.diffuse_color_factor=k.diffuse_color_factor;a.alpha_factor=k.use_map_alpha?k.alpha_factor:0;k=h(k);H(a,k)}ka.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.diffuse_color);a.ambient=b.ambient;a.diffuse_intensity=b.diffuse_intensity;a.emit=b.emit;a.specular_color.set(b.specular_color);a.specular_alpha=b.specular_alpha;m(a,"a_position");m(a,"a_normal");
k=b.game_settings.alpha_blend;u(a,"ALPHA","OPAQUE"===k?0:1);u(a,"ALPHA_CLIP","CLIP"===k?1:0);u(a,"PARTICLES_SHADELESS",b.use_shadeless?1:0);B(a,b);F(a,b);f(a,b);k=b.game_settings.alpha_blend;a.xray=b.b4w_render_above_all&&"OPAQUE"!=k&&"CLIP"!=k;a.offset_z=b.offset_z;a=!0}break;default:throw"Wrong batch type: "+a.type;}return a}function C(a,b,c){switch(b.texture_coords){case "UV":case "ORCO":u(a,c,"TEXTURE_COORDS_UV_ORCO");u(a,"TEXCOORD",1);break;case "NORMAL":u(a,c,"TEXTURE_COORDS_NORMAL");u(a,"NORMAL_TEXCOORD",
1);break;default:u(a,c,0)}}function f(a,b){var c=b.game_settings,d=c.alpha_blend;switch(d){case "ALPHA_SORT":a.blend=!0;a.zsort_type=ea.ZSORT_BACK_TO_FRONT;a.depth_mask=!0;a.alpha_clip=!1;break;case "ALPHA":a.blend=!0;a.zsort_type=ea.ZSORT_DISABLED;a.depth_mask=!0;a.alpha_clip=!1;break;case "CLIP":a.blend=!1;a.zsort_type=ea.ZSORT_DISABLED;a.depth_mask=!0;a.alpha_clip=!0;break;case "ADD":a.blend=!0;a.zsort_type=ea.ZSORT_DISABLED;a.depth_mask=!1;a.alpha_clip=!1;break;case "OPAQUE":a.blend=!1;a.zsort_type=
ea.ZSORT_DISABLED;a.depth_mask=!0;a.alpha_clip=!1;break;default:throw Error("Unknown alpha blend mode: "+d);}a.use_backface_culling=c.use_backface_culling}function h(a,b){var c=a.texture,d=c._render,c=c.image;d&&b&&c&&Q.update_texture(d,b,c._is_dds,c.filepath);return d}function n(a,b,c){for(var d=[],e=c.length,h=0;h<e;h++){var f=c[h];f[a]==b&&f.texture&&f.texture._render&&d.push(f)}return d}function A(a,b){var c=b.raytrace_transparency;a.fresnel_params[0]=c.fresnel;a.fresnel_params[1]=1-c.fresnel_factor/
5;c=b.raytrace_mirror;a.reflect_factor=c.reflect_factor;a.fresnel_params[2]=c.fresnel;a.fresnel_params[3]=1-c.fresnel_factor/5}function B(a,b){var c,d=0;switch(b.specular_shader){case "PHONG":case "COOKTORR":c=b.specular_hardness;break;case "WARDISO":c=b.specular_slope;break;case "TOON":c=b.specular_toon_size;d=b.specular_toon_smooth;break;case "BLINN":c=b.specular_ior;d=b.specular_hardness;break;default:fa.error("unsupported specular shader: "+b.specular_shader+' (material "'+b.name+'")'),c=b.specular_hardness}a.specular_params[0]=
b.specular_intensity;a.specular_params[1]=c;a.specular_params[2]=d}function F(a,b){switch(b.diffuse_shader){case "LAMBERT":a.diffuse_params[0]=0;a.diffuse_params[1]=0;break;case "OREN_NAYAR":a.diffuse_params[0]=b.roughness;a.diffuse_params[1]=0;break;case "FRESNEL":a.diffuse_params[0]=b.diffuse_fresnel;a.diffuse_params[1]=b.diffuse_fresnel_factor;break;case "MINNAERT":a.diffuse_params[0]=b.darkness;a.diffuse_params[1]=0;break;case "TOON":a.diffuse_params[0]=b.diffuse_toon_size;a.diffuse_params[1]=
b.diffuse_toon_smooth;break;default:fa.error("unsupported diffuse shader: "+b.diffuse_shader+' (material "'+b.name+'")'),a.diffuse_params[0]=0,a.diffuse_params[1]=0}}function D(a,b,c){if(!b.use_nodes||b.b4w_do_not_render)return!1;var d;switch(c){case "MAIN":x(a,"main.glslv","main.glslf");d=!1;break;case "GLOW":x(a,"main.glslv","main.glslf");d=!0;break;case "DEPTH":x(a,"depth.glslv","depth.glslf");d=!1;break;case "COLOR_ID":x(a,"color_id.glslv","color_id.glslf"),d=!1}c=S.compose_nmat_graph(b.node_tree,
b.uuid,!1,b.name,c);if(!c)return fa.error('Failed to create node graph for material "'+b.name+'", disable nodes'),e(a,b),!0;a.has_nodes=!0;u(a,"NODES",1);u(a,"NODES_GLOW",d?1:0);var h=b.game_settings.alpha_blend;u(a,"ALPHA","OPAQUE"===h?0:1);u(a,"ALPHA_CLIP","CLIP"===h?1:0);u(a,"DOUBLE_SIDED_LIGHTING",b.b4w_double_sided_lighting?1:0);m(a,"a_position");b.use_orco_tex_coord&&m(a,"a_orco_tex_coord");f(a,b);a.offset_z=b.offset_z;h=b.game_settings.alpha_blend;a.xray=b.b4w_render_above_all&&"OPAQUE"!=h&&
"CLIP"!=h;ka.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.diffuse_color);a.emit=b.emit;a.ambient=b.ambient;A(a,b);b.b4w_wettable?u(a,"WETTABLE",1):u(a,"WETTABLE",0);a.shaders_info.node_elements=S.compose_node_elements(c);var g=!1;V.traverse(c,function(c,d){switch(d.type){case "UVMAP":case "TEX_COORD_UV":case "GEOMETRY_UV":case "UV_MERGED":var f=d.data.name,k=d.data.value;a.uv_maps_usage||(a.uv_maps_usage={});a.uv_maps_usage[k]=f;break;case "GEOMETRY_VC":case "GEOMETRY_VC1":case "GEOMETRY_VC2":case "GEOMETRY_VC3":f=
d.data.name;a.vertex_colors_usage[f]={generate_buffer:!0,src:[{name:d.data.value}]};k=0;if("GEOMETRY_VC"==d.type)k=7;else for(var l=0;l<d.outputs.length;l++){var n="RGB".indexOf(d.outputs[l].identifier);-1<n&&(k|=1<<2-n)}a.vertex_colors_usage[f].src[0].mask=k;break;case "TEX_COORD_NO":case "GEOMETRY_NO":m(a,"a_normal");break;case "MATERIAL_BEGIN":m(a,"a_normal");g=!0;break;case "TEXTURE_COLOR":case "TEXTURE_ENVIRONMENT":f=d.data.name;k=d.data.value;if(!k._render){fa.warn('Wrong texture "'+d.data.value.name+
'" in material "'+b.name+'".');e(a,b);break}!1!==k._render.allow_node_dds&&(k._render.allow_node_dds="TEXTURE_ENVIRONMENT"!=d.type?!0:!1);H(a,k._render,f);xa.alpha_clip_filtering_hack&&"CLIP"==h&&Q.set_filters(d.data.value._render,Q.TF_NEAREST,Q.TF_NEAREST);break;case "TEXTURE_NORMAL":case "B4W_PARALLAX":u(a,"CALC_TBN_SPACE",1);m(a,"a_normal");m(a,"a_tangent");f=d.data.name;k=d.data.value;k._render.allow_node_dds=!1;H(a,k._render,f);break;case "LAMP":d.data&&(a.lamp_uuid_indexes=d.data);break;case "B4W_REFRACTION":a.refractive=
!0}});g||(a.use_shadeless=!0);return!0}function e(a,b){switch(a.type){case "DEPTH":x(a,"depth.glslv","depth.glslf");break;case "COLOR_ID":x(a,"color_id.glslv","color_id.glslf");break;default:x(a,"main.glslv","main_stack.glslf")}u(a,"SHADELESS",1);m(a,"a_position");m(a,"a_normal");ka.set(1,0,1,1,a.diffuse_color);if(b){var c=b.game_settings.alpha_blend;u(a,"ALPHA","OPAQUE"===c?0:1);u(a,"ALPHA_CLIP","CLIP"===c?1:0);u(a,"VERTEX_COLOR",0);a.offset_z=b.offset_z;f(a,b)}return!0}function z(a,b){if("PHYSICS"!==
a.type){"DYNAMIC"==b.type?(b.is_hair_particles?u(a,"AU_QUALIFIER","attribute"):u(a,"AU_QUALIFIER","uniform"),u(a,"STATIC_BATCH",0)):(u(a,"AU_QUALIFIER","attribute"),u(a,"STATIC_BATCH",1));"WIREFRAME"==a.type&&(da.get_standard_derivatives()?u(a,"WIREFRAME_QUALITY",1):u(a,"WIREFRAME_QUALITY",0),a.debug_sphere?(u(a,"DEBUG_SPHERE",1),a.debug_sphere_dynamic?u(a,"DEBUG_SPHERE_DYNAMIC",1):u(a,"DEBUG_SPHERE_DYNAMIC",0)):u(a,"DEBUG_SPHERE",0),u(a,"ALPHA",1));b.use_shape_keys&&(a.use_shape_keys=b.use_shape_keys);
b.wind_bending?(""!==b.main_bend_col?(a.vertex_colors_usage.a_bending_col_main={generate_buffer:!0,src:[{name:b.main_bend_col,mask:4}]},m(a,"a_bending_col_main"),""!==b.detail_bend_col.leaves_stiffness&&""!==b.detail_bend_col.leaves_phase&&""!==b.detail_bend_col.overall_stiffness?(a.vertex_colors_usage.a_bending_col_detail={generate_buffer:!0,src:[{name:b.detail_bend_col.leaves_stiffness,mask:4},{name:b.detail_bend_col.leaves_phase,mask:2},{name:b.detail_bend_col.overall_stiffness,mask:1}]},m(a,"a_bending_col_detail"),
m(a,"a_normal"),u(a,"DETAIL_BEND",1)):u(a,"DETAIL_BEND",0),u(a,"MAIN_BEND_COL",1)):u(a,"MAIN_BEND_COL",0),u(a,"WIND_BEND",1)):u(a,"WIND_BEND",0);b.bend_center_only?u(a,"BEND_CENTER_ONLY",1):u(a,"BEND_CENTER_ONLY",0);u(a,"BILLBOARD_PRES_GLOB_ORIENTATION",b.billboard_pres_glob_orientation|0);b.billboard?u(a,"BILLBOARD",1):u(a,"BILLBOARD",0);b.billboard&&b.is_hair_particles?u(a,"HAIR_BILLBOARD",1):u(a,"HAIR_BILLBOARD",0);b.billboard_spherical?u(a,"BILLBOARD_SPHERICAL",1):u(a,"BILLBOARD_SPHERICAL",0);
switch(b.billboard_type){case "RANDOM":u(a,"BILLBOARD_RANDOM",1);u(a,"BILLBOARD_JITTERED",0);break;case "JITTERED":u(a,"BILLBOARD_RANDOM",0);u(a,"BILLBOARD_JITTERED",1);break;default:u(a,"BILLBOARD_RANDOM",0),u(a,"BILLBOARD_JITTERED",0)}b.dynamic_grass&&xa.allow_vertex_textures?u(a,"DYNAMIC_GRASS",1):u(a,"DYNAMIC_GRASS",0);a.dynamic_grass=b.dynamic_grass;a.dynamic_geometry=b.dynamic_geometry;a.shadow_cast=b.shadow_cast;a.shadow_cast_only=b.shadow_cast_only;a.shadow_receive=b.shadow_receive&&!a.use_shadeless&&
!(a.blend&&xa.disable_blend_shadows_hack);a.reflexible=b.reflexible;a.reflexible_only=b.reflexible_only;a.reflective=b.reflective;b.is_skinning?(m(a,"a_influence"),u(a,"SKINNED",1),xa.amd_skinning_hack?(u(a,"DISABLE_TANGENT_SKINNING",1),u(a,"FRAMES_BLENDING",0)):(u(a,"DISABLE_TANGENT_SKINNING",0),b.frames_blending?u(a,"FRAMES_BLENDING",1):u(a,"FRAMES_BLENDING",0)),u(a,"MAX_BONES",b.max_bones)):(u(a,"SKINNED",0),u(a,"FRAMES_BLENDING",0),u(a,"DISABLE_TANGENT_SKINNING",0));b.vertex_anim?(u(a,"VERTEX_ANIM",
1),xa.vert_anim_mix_normals_hack?u(a,"VERTEX_ANIM_MIX_NORMALS_FACTOR",.5):u(a,"VERTEX_ANIM_MIX_NORMALS_FACTOR","u_va_frame_factor")):u(a,"VERTEX_ANIM",0);if(b.is_skinning&&b.vertex_anim)throw"Skinning and vertex animation are mutually exlusive";b.disable_fogging?u(a,"DISABLE_FOG",1):u(a,"DISABLE_FOG",0);if(a.has_nodes){for(var c=a.shaders_info.node_elements,d=b.mats_value_inds,e=b.mats_rgb_inds,h=0;h<c.length;h++){var f=c[h];switch(f.id){case "VALUE":var g=f.param_values[0];if(g)for(var k=0;k<d.length;k+=
2)if(d[k]==g){f.dirs.push(["VALUE_IND",d[k+1]]);break}break;case "RGB":if(g=f.param_values[0])for(k=0;k<e.length;k+=2)if(e[k]==g){f.dirs.push(["RGB_IND",e[k+1]]);break}}}u(a,"NUM_VALUES",b.mats_values.length);u(a,"NUM_RGBS",b.mats_rgbs.length)}}}function y(a,b,c){if(b.length){for(var d=X.get_shadow_lamps(b,xa.ssao&&c.b4w_enable_ssao),e=a.shaders_info,h=0,f=0;f<a.shaders_info.node_elements.length;f++){var g=a.shaders_info.node_elements[f];if("LIGHTING_LAMP"==g.id){var k=b[h++%b.length],l=k.light;"AREA"==
l.type&&(k=b[h++%b.length],l=k.light);var m=X.get_scene_data(k,c);if("SPOT"==l.type||"POINT"==l.type)var n=Math.cos(l.spot_size/2);if("SPOT"==l.type)var q=l.spot_blend*(1-n);var m=m.light_index,r=Math.floor(m/2),p=0==m%2?"rg":"ba",k=d.indexOf(k);g.dirs=[["LAMP_TYPE",l.type],["LAMP_IND",m],["LAMP_LIGHT_FACT_IND",r],["LAMP_FAC_CHANNELS",p],["LAMP_SPOT_SIZE",ba.glsl_value(n||.01)],["LAMP_SPOT_BLEND",ba.glsl_value(q||.01)],["LAMP_LIGHT_DIST",ba.glsl_value(l.distance)],["LAMP_SHADOW_MAP_IND",k]]}}if(a.lamp_uuid_indexes){c=
0;for(var z in a.lamp_uuid_indexes)c++;a.lamp_light_positions=new Float32Array(3*c);a.lamp_light_directions=new Float32Array(3*c);a.lamp_light_color_intensities=new Float32Array(3*c);a.lamp_light_factors=new Float32Array(4*c);ba.set_directive(e,"NUM_LAMP_LIGHTS",c);for(f=0;f<b.length;f++)v(a,b[f])}}}function v(a,b){if(b.uuid in a.lamp_uuid_indexes){var c=a.lamp_uuid_indexes[b.uuid],d=sa.get_trans_view(b.render.world_tsr);a.lamp_light_positions.set(d,3*c);a.lamp_light_directions.set(b.light.direction,
3*c);a.lamp_light_color_intensities.set(b.light.color_intensity,3*c);var d=ha,e=b.light;d[0]=-1;d[1]=-1;d[2]=-1;d[3]=e.use_specular?1:0;switch(e.type){case "POINT":d[2]=e.distance;break;case "SPOT":d[2]=e.distance;var h=d[0]=Math.cos(e.spot_size/2);d[1]=e.spot_blend*(1-h)}a.lamp_light_factors.set(d,4*c)}}function m(a,b){var c=a.common_attributes;-1==c.indexOf(b)&&c.push(b)}function u(a,b,c){ba.set_directive(a.shaders_info,b,c)}function K(a,b){if("PHYSICS"==a.type)0<b.shape_keys.length&&ea.submesh_init_shape_keys(b,
b.va_frames[0]),a.submesh=b;else{var c=a.zsort_type,d=a.draw_mode;a.halo&&(b=ea.extract_halo_submesh(b));a.water_generated_mesh&&(b=ga.generate_multigrid(a.water_num_cascads,a.water_subdivs,a.water_detailed_dist));c=ea.submesh_to_bufs_data(b,c,d,a.vertex_colors_usage);a.bufs_data=c;a.dynamic_geometry||c.info_for_z_sort_updates||a.use_shape_keys||(c.ibo_array=null,c.vbo_array=null);c=b.va_frames.length;a.num_vertices=b.base_length*c;a:switch(a.draw_mode){case ea.DM_DEFAULT:case ea.DM_TRIANGLES:case ea.DM_DYNAMIC_TRIANGLES:d=
!0;break a;default:d=!1}d?ea.is_indexed(b)?a.num_triangles=b.indices.length/3*c:a.num_triangles=b.base_length/3*c:a.num_triangles=0}}function E(a,b,c,d,e,h,f,g,k,l,m,n){var q=a._object,r=[],p=g.b4w_dynamic_grass;if(!l&&p)return r;for(var v="INSTANCE"==g.b4w_wind_bend_inheritance,y="INSTANCE"==g.b4w_shadow_inheritance,u="INSTANCE"==g.b4w_reflection_inheritance,A=[],N=[],C=0;C<e.length;C++){var x=e[C]._object.render,w=ca.clone_object_nr(b);w.billboard=g.b4w_hair_billboard;w.billboard_type=g.b4w_hair_billboard_type;
w.billboard_spherical="SPHERICAL"==g.b4w_hair_billboard_geometry;w.dynamic_grass=p;w.is_hair_particles=!0;w.mats_values=x.mats_values;w.mats_value_inds=x.mats_value_inds;w.mats_rgbs=x.mats_rgbs;w.mats_rgb_inds=x.mats_rgb_inds;v?(w.wind_bending=x.wind_bending,w.wind_bending_angle=x.wind_bending_angle,w.wind_bending_freq=x.wind_bending_freq,w.detail_bending_freq=x.detail_bending_freq,w.main_bend_col=x.main_bend_col,w.detail_bending_amp=x.detail_bending_amp,w.branch_bending_amp=x.branch_bending_amp,
w.wind_bending_amp=x.wind_bending_amp,w.detail_bend_col=x.detail_bend_col,w.bend_center_only=!1):(w.wind_bending=q.render.wind_bending,w.wind_bending_angle=q.render.wind_bending_angle,w.wind_bending_freq=q.render.wind_bending_freq,w.detail_bending_freq=q.render.detail_bending_freq,w.main_bend_col=q.render.main_bend_col,w.detail_bending_amp=q.render.detail_bending_amp,w.branch_bending_amp=q.render.branch_bending_amp,w.wind_bending_amp=q.render.wind_bending_amp,w.detail_bend_col=q.render.detail_bend_col,
w.bend_center_only=!0);y?(w.shadow_cast=x.shadow_cast,w.shadow_cast_only=x.shadow_cast_only,w.shadow_receive=x.shadow_receive):(w.shadow_cast=q.render.shadow_cast,w.shadow_cast_only=q.render.shadow_cast_only,w.shadow_receive=q.render.shadow_receive);u?(w.reflexible=x.reflexible,w.reflexible_only=x.reflexible_only,w.reflective=x.reflective,w.cube_reflection_id=x.cube_reflection_id,w.plane_reflection_id=x.plane_reflection_id,w.reflection_type=x.reflection_type):(w.reflexible=q.render.reflexible,w.reflexible_only=
q.render.reflexible_only,w.reflective=q.render.reflective,w.cube_reflection_id=q.render.cube_reflection_id,w.plane_reflection_id=q.render.plane_reflection_id,w.reflection_type=q.render.reflection_type);A.push(w);var I=f[C];I||(I=new Float32Array);n&&ca.init_rand_r_seed(k.seed,m);var E=new Float32Array(3),Z=new Float32Array([0,0,0,1]),B=[],ba=na.check_particles_bin_format(xa.loaded_data_version)&&!g.b4w_initial_rand_rotation&&!g.b4w_hair_billboard,Q=4;ba&&(Q=8);for(var G=0;G<I.length;G+=Q){E[0]=I[G];
E[1]=I[G+1];E[2]=I[G+2];var D=I[G+3]*sa.get_scale(x.world_tsr);if(g.b4w_initial_rand_rotation){switch(g.b4w_rotation_type){case "XYZ":var F=new Float32Array([ca.rand_r(m),ca.rand_r(m),ca.rand_r(m)]);Ga.normalize(F,F);break;case "Z":F=new Float32Array([0,1,0]);break;default:throw"Unsupported random rotation type: "+g.b4w_rotation_type;}oa.setAxisAngle(F,g.b4w_rand_rotation_strength*(2*Math.PI*ca.rand_r(m)-Math.PI),Z)}else if(ba&&(Z.set(I.subarray(G+4,G+8)),ca.quat_bpy_b4w(Z,Z),!g.use_whole_group))if(g.use_rotation_dupli){var H=
sa.get_quat_view(x.world_tsr);oa.multiply(Z,H,Z)}else oa.multiply(Z,qa,Z);var aa=sa.set_sep(E,D,Z,sa.create());B.push(aa)}N.push(B)}for(var U={},C=0;C<e.length;C++){var K=e[C],T=h[C],w=A[C],P={};w.wind_bending&&(P.au_wind_bending_amp=[w.wind_bending_amp],P.au_wind_bending_freq=[w.wind_bending_freq],P.au_detail_bending_freq=[w.detail_bending_freq],P.au_detail_bending_amp=[w.detail_bending_amp],P.au_branch_bending_amp=[w.branch_bending_amp],w.wind_bending_amp=0,w.wind_bending_freq=0,w.detail_bending_freq=
0,w.detail_bending_amp=0,w.branch_bending_amp=0);var la=O(w),B=N[C];if(B.length)for(var ga=K.data,S=ga.materials,V=Array(S.length),G=0;G<S.length;G++)if(!ea.has_empty_submesh(ga,G))for(var ka=0;ka<T.length;ka++){var X=T[ka],da=t(X),ha=S[G];"COLOR_ID"==X&&(da.can_fork_outline=!(K.b4w_do_not_render||ha.b4w_do_not_render));"MAIN"==X&&(V[G]=da);if(M(da,ha)){"DEPTH"==X&&V[G]&&(da.use_shadeless=V[G].use_shadeless);da.draw_mode=ea.DM_DEFAULT;z(da,w);da.odd_id_prop=g.uuid;"JITTERED"==g.b4w_hair_billboard_type&&
(da.jitter_amp=g.b4w_hair_billboard_jitter_amp,da.jitter_freq=g.b4w_hair_billboard_jitter_freq);p&&(da.grass_scale_threshold=g.b4w_dynamic_grass_scale_threshold);v||(delete da.vertex_colors_usage.a_bending_col_main,delete da.vertex_colors_usage.a_bending_col_detail);J(da,la);var ra=ea.extract_submesh(ga,G,da.common_attributes,b.bone_skinning_info,da.vertex_colors_usage,da.uv_maps_usage),ma=ea.make_clone_submesh(ra,P,B),Ea=ma,Aa=B;Ea.va_common.au_center_pos=new Float32Array(3*Ea.base_length);for(var lc=
Aa.length,$a=Ea.base_length/lc,gb=0;gb<lc;gb++)for(var lb=Aa[gb],wa=3*$a*gb,Ma=0;Ma<$a;Ma++)Ea.va_common.au_center_pos[wa+3*Ma]=lb[0],Ea.va_common.au_center_pos[wa+3*Ma+1]=lb[1],Ea.va_common.au_center_pos[wa+3*Ma+2]=lb[2];ma=Ea;if(w.wind_bending&&w.bend_center_only){var bb=ma,Ha=q.render.world_tsr;bb.va_common.a_emitter_center=new Float32Array(3*bb.base_length);var Ia=Ga.fromValues(0,0,0);sa.transform_vec3(Ia,Ha,Ia);for(var xb=0;xb<bb.base_length;xb++)bb.va_common.a_emitter_center[3*xb]=Ia[0],bb.va_common.a_emitter_center[3*
xb+1]=Ia[1],bb.va_common.a_emitter_center[3*xb+2]=Ia[2];ma=bb}var yb=g.b4w_vcol_from_name,mc=g.b4w_vcol_to_name,Qa=da,Sc=c,Hc=!v,nc=ga,Yb=[];if(""!==yb&&""!==mc){var db,oc=mc,Ic=Qa.vertex_colors_usage,pc=[],tb=void 0;for(tb in Ic)for(var Oa=Ic[tb].src,Ja=0,Sa=0;Sa<Oa.length;Sa++){var Xb=Oa[Sa].mask;oc==Oa[Sa].name&&pc.push(tb,Xb,Ja);Ja+=ca.rgb_mask_get_channels_count(Xb)}db=pc;if(0<db.length)for(var Eb=0;Eb<db.length;Eb+=3)Yb.push({emitter_attr:yb,emitter_mask:7,particle_attr:db[Eb],particle_mask:db[Eb+
1],dst_channel_offset:db[Eb+2]});else ea.has_attr(Qa.common_attributes,"a_color")&&mc==nc.active_vcol_name&&Yb.push({emitter_attr:yb,emitter_mask:7,particle_attr:"a_color",particle_mask:7,dst_channel_offset:0})}Hc&&("a_bending_col_main"in Sc&&Yb.push({emitter_attr:"a_bending_col_main",emitter_mask:4,particle_attr:"a_bending_col_main",particle_mask:4,dst_channel_offset:0}),"a_bending_col_detail"in Sc&&Yb.push({emitter_attr:"a_bending_col_detail",emitter_mask:7,particle_attr:"a_bending_col_detail",
particle_mask:7,dst_channel_offset:0}));for(var Nb=ma,Fb=B,qc=d,mb=Yb,Zb=da.vertex_colors_usage,Jc=!1,Gb=0;Gb<mb.length;Gb++){var $b=mb[Gb].emitter_attr,hc=qc.va_common[$b];if(hc&&0<hc.length){Jc=!0;break}}if(Jc){var Hb,rb=q.render.bb_local,ta=qc.va_frames[0].a_position,zb=Fb,ya=U,Ta=new Float32Array(3),hb=new Float32Array(3),eb=new Uint32Array(zb.length);if(!("verts_indices"in ya)){ya.cell_size=new Float32Array(3);ya.base_point=new Float32Array(3);ya.verts_indices=new Uint32Array(ta.length/3);ya.octs_indices=
new Uint32Array(ta.length/3);ya.cell_size[0]=(rb.max_x-rb.min_x)/20;ya.cell_size[1]=(rb.max_y-rb.min_y)/20;ya.cell_size[2]=(rb.max_z-rb.min_z)/20;ya.base_point[0]=rb.min_x;ya.base_point[1]=rb.min_y;ya.base_point[2]=rb.min_z;for(var Wa=0;Wa<ta.length/3;Wa++){var Ib=ta[3*Wa+1],Ab=ta[3*Wa+2],ac=ca.trunc((ta[3*Wa]-ya.base_point[0])/ya.cell_size[0]),Tb=ca.trunc((Ib-ya.base_point[1])/ya.cell_size[1]),Jb=ca.trunc((Ab-ya.base_point[2])/ya.cell_size[2]),ac=ca.clamp(ac,0,19),Tb=ca.clamp(Tb,0,19),Jb=ca.clamp(Jb,
0,19);ya.verts_indices[Wa]=Wa;ya.octs_indices[Wa]=Jb*Math.pow(20,2)+20*Tb+ac}ea.sort_two_arrays(ya.octs_indices,ya.verts_indices,ea.SORT_NUMERIC,!0);ya.verts_offsets=new Uint32Array(Math.pow(20,3));for(Wa=0;Wa<ya.octs_indices.length;Wa++)ya.verts_offsets[ya.octs_indices[Wa]]++;delete ya.octs_indices;for(Wa=1;Wa<ya.verts_offsets.length;Wa++)ya.verts_offsets[Wa]+=ya.verts_offsets[Wa-1]}for(var Bb=0;Bb<zb.length;Bb++){Ta[0]=zb[Bb][0];Ta[1]=zb[Bb][1];Ta[2]=zb[Bb][2];for(var rc=1E10,ic=-1,jc=ca.trunc((Ta[0]-
ya.base_point[0])/ya.cell_size[0]),nb=ca.trunc((Ta[1]-ya.base_point[1])/ya.cell_size[1]),Na=ca.trunc((Ta[2]-ya.base_point[2])/ya.cell_size[2]),jc=ca.clamp(jc,0,19),nb=ca.clamp(nb,0,19),Na=ca.clamp(Na,0,19),ob=Na*Math.pow(20,2)+20*nb+jc,Tc=ya.verts_offsets[ob],pb=0==ob?0:ya.verts_offsets[ob-1];pb<Tc;pb++){var Kb=ya.verts_indices[pb];hb[0]=ta[3*Kb];hb[1]=ta[3*Kb+1];hb[2]=ta[3*Kb+2];Ga.sub(hb,Ta,hb);var bc=Ga.sqrLen(hb);bc<=rc&&(rc=bc,ic=Kb)}if(-1==ic)for(pb=0;pb<ta.length/3;pb++)hb[0]=ta[3*pb],hb[1]=
ta[3*pb+1],hb[2]=ta[3*pb+2],Ga.sub(hb,Ta,hb),bc=Ga.sqrLen(hb),bc<=rc&&(rc=bc,ic=pb);eb[Bb]=ic}Hb=eb;for(var Ub=Nb.base_length/Fb.length,Gb=0;Gb<mb.length;Gb++){var Ra=mb[Gb].particle_attr,Ob=mb[Gb].particle_mask,$b=mb[Gb].emitter_attr,Lb=mb[Gb].emitter_mask,hc=qc.va_common[$b];switch(Ra){case "a_bending_col_main":var ub=1;break;case "a_bending_col_detail":ub=3;break;case "a_color":ub=3;break;default:for(var Ka=ub=0;Ka<Zb[Ra].src.length;Ka++)ub+=ca.rgb_mask_get_channels_count(Zb[Ra].src[Ka].mask)}if(hc&&
0<hc.length){var Bc=ca.rgb_mask_get_channels_count(Lb),Kc=ca.rgb_mask_get_channels_count(Ob),sc=Lb&Ob,cc=ca.rgb_mask_get_channels_presence(sc);sc!=Ob&&fa.error("Wrong color extraction from "+$b+" to "+Ra+".");if("a_bending_col_main"==Ra||"a_bending_col_detail"==Ra)Nb.va_common[Ra]=new Float32Array(Nb.base_length*Kc);for(Ka=0;Ka<Fb.length;Ka++){var Lc=Hb[Ka],dc=Lc*Bc,tc=Ka*Ub*ub;if(-1!=Lc)for(var Pb=0;Pb<Ub;Pb++)for(var ec=Pb*ub,fc=0;fc<cc.length;fc++)if(cc[fc]){var Mc=ca.rgb_mask_get_channel_presence_index(Lb,
fc),Xa=mb[Gb].dst_channel_offset+ca.rgb_mask_get_channel_presence_index(Ob,fc);Nb.va_common[Ra][tc+ec+Xa]=hc[dc+Mc]}}}else Nb.va_common[Ra]=new Float32Array(0)}}ma=Nb;r.push({batch:da,submesh:ma,mat_names:[ha.name],render:w,rel_bpy_objects:[a]})}}}return r}function M(a,b){var c=!0;"NODES_GLOW"==a.type&&(c=S.check_material_glow_output(b));return c=c&&g(a,b)}function J(a,b){for(var c=null,d=null,e=0;e<a.textures.length;e++){var h=a.textures[e].canvas_context;h&&(c||(c={}),c[e]=h,a.textures[e].canvas_context=
null);if(h=a.textures[e].video_file)d||(d={}),d[e]=h,a.textures[e].video_file=null}a.id=0;a.render_id=b;a.id=ca.calc_variable_id(a,b);if(c)for(var f in c)a.textures[f].canvas_context=c[f];if(d)for(f in d)a.textures[f].video_file=d[f]}function O(a){var b=a.bone_pointers;a.bone_pointers=null;var c=ca.calc_variable_id(a,0);a.bone_pointers=b;return c}function G(a,b,c,d,e){var h=t("WIREFRAME");x(h,"wireframe.glslv","wireframe.glslf");h.wireframe_mode=0;h.debug_sphere=!0;h.depth_mask=!0;h.odd_id_prop=c;
e&&(h.debug_sphere_dynamic=!0);z(h,b);b=O(b);J(h,b);d?(d=ga.generate_uv_sphere(16,8,1,a.center,!1,!1),ea.scale_submesh_xyz(d,[a.axis_x[0],a.axis_y[1],a.axis_z[2]],a.center)):d=ga.generate_uv_sphere(16,8,a.radius,a.center,!1,!1);ea.submesh_drop_indices(d,1,!0);d.va_common.a_polyindex=ea.extract_polyindices(d);K(h,d);return h}function x(a,b,c){a.shaders_info.vert=b;a.shaders_info.frag=c;ba.set_default_directives(a.shaders_info)}function H(a,b,c){1==a.textures.length&&0==a.texture_names.length&&a.texture_names.push("default0");
c=c||"default"+String(a.textures.length);-1==a.texture_names.indexOf(c)&&(a.textures.push(b),a.texture_names.push(c));a.shader&&N.assign_texture_uniforms(a)}function P(a){if(!a.shaders_info)throw"No shaders info for batch "+a.name;a.shader=ba.get_compiled_shader(a.shaders_info);N.assign_uniform_setters(a.shader);N.assign_attribute_setters(a);N.assign_texture_uniforms(a)}function I(a,b,c){a=a.scenes_data[0].batches;for(var d=0;d<a.length;d++)if(a[d].type==c&&!a[d].forked_batch&&-1!=a[d].material_names.indexOf(b))return a[d];
return null}function aa(a,b,c){a=a.scenes_data[0].batches;for(var d=0;d<a.length;d++)if(a[d].type==c&&a[d].forked_batch&&-1!=a[d].material_names.indexOf(b))return a[d];return null}function U(a,b){a.diffuse_color.set(b.diffuse_color);a.diffuse_intensity=b.diffuse_intensity;a.specular_color.set(b.specular_color);a.specular_color_factor=b.specular_color_factor;a.specular_params.set(b.specular_params);a.emit=b.emit;a.ambient=b.ambient;a.diffuse_color_factor=b.diffuse_color_factor;a.alpha_factor=b.alpha_factor;
a.reflect_factor=b.reflect_factor;a.fresnel_params.set(b.fresnel_params);a.parallax_scale=b.parallax_scale;a.shallow_water_col.set(b.shallow_water_col);a.shallow_water_col_fac=b.shallow_water_col_fac;a.shore_water_col.set(b.shore_water_col);a.shore_water_col_fac=b.shore_water_col_fac;a.foam_factor=b.foam_factor;a.water_norm_uv_velocity=b.water_norm_uv_velocity}var T=p("__boundings");p("__camera");var w=p("__config"),fa=p("__print"),da=p("__extensions"),ea=p("__geometry"),V=p("__graph");p("__lights");
var S=p("__nodemat"),X=p("__obj_util"),la=p("__particles"),ga=p("__primitives"),oa=p("__quat"),na=p("__reformer"),N=p("__renderer"),Z=p("__scenegraph"),ba=p("__shaders");p("__scenes");var Q=p("__textures"),sa=p("__tsr"),ca=p("__util"),Ga=p("__vec3"),ka=p("__vec4"),xa=w.defaults,ra=["MAIN"],qa=new Float32Array([0,-Math.sqrt(.5),0,Math.sqrt(.5)]);new Float32Array(3);var ha=new Float32Array(4);a.BATCH_INHERITED_TEXTURES=ma;var ma="u_colormap0 u_colormap1 u_stencil0 u_specmap0 u_normalmap0 u_mirrormap".split(" ");
a.init_batch=t;a.generate_main_batches=function(a,b,e,h){for(var f=[],g=[],l=0;l<b.length;l++){var m=b[l],n=m._object;n.is_hair_dupli||(X.is_dynamic(n)?f.push(m):g.push(m))}for(var l=[],l=l.concat(k(f,a._render.graph)),n=l=l.concat(d(g,a._render.graph,a.b4w_batch_grid_size)),f=[],g=[],q={},l=0;l<n.length;l++){var r=n[l].batch,p=n[l].render,v=null;if(r.id in q){for(var z=q[r.id],u=g[z].batch,A=g[z].render,N=null,x=null,m=0;m<r.textures.length;m++){var t=r.textures[m].canvas_context;t&&(N||(N={}),N[m]=
t,r.textures[m].canvas_context=null);if(t=r.textures[m].video_file)x||(x={}),x[m]=t,r.textures[m].video_file=null}ca.strict_objs_is_equal(r,u,!0)&&ca.strict_objs_is_equal(p,A,!0)&&(v=g[z]);if(N)for(m in N)r.textures[m].canvas_context=N[m];if(x)for(m in x)r.textures[m].video_file=x[m];if(!v){do r.id++;while(q[r.id])}}v||(v={batch:r,render:n[l].render,rel_bpy_objects:[],submeshes:[],mat_names:[]},q[r.id]=g.length,g.push(v));v.rel_bpy_objects=v.rel_bpy_objects.concat(n[l].rel_bpy_objects);n[l].submesh&&
n[l].submesh.base_length&&v.submeshes.push(n[l].submesh);if(v.mat_names.length)for(m=0;m<n[l].mat_names.length;m++)r=n[l].mat_names[m],-1==v.mat_names.indexOf(r)&&v.mat_names.push(r);else v.mat_names=n[l].mat_names;ea.sort_two_arrays(v.mat_names,v.submeshes,ea.SORT_STRING,!1)}for(l=0;l<g.length;l++){n=g[l].submeshes;if(0==n.length)m=ca.create_empty_submesh(ca.unique_name("%empty"));else if(1==n.length)m=n[0];else{q=[];for(m=0;m<n.length;m++)ea.is_long_submesh(n[m])||q.push(m);if(q.length<n.length)for(m=
0;m<q.length;m++)ea.submesh_drop_indices(n[q[m]]);m=ea.submesh_list_join(n)}f.push({batch:g[l].batch,render:g[l].render,submesh:m,mat_names:g[l].mat_names,rel_bpy_objects:g[l].rel_bpy_objects})}for(g=0;g<f.length;g++)if(n=f[g].batch,n.material_names=f[g].mat_names,K(n,f[g].submesh),y(n,e,a),"STATIC"==f[g].render.type&&"COLOR_ID"!=n.type){if(l=ca.unique_name("%meta%"+n.type+"%"+n.material_names.join("%")+"%"),q=X.create_object(l,"MESH"),q.render=f[g].render,X.append_scene_data(q,a),X.append_batch(q,
a,n),h.push(q),"MAIN"==n.type)for(m=0;m<f[g].rel_bpy_objects.length;m++)l=f[g].rel_bpy_objects[m],l=l._object,l.meta_objects.push(q)}else for(q=[],m=0;m<f[g].rel_bpy_objects.length;m++)l=f[g].rel_bpy_objects[m],l=l._object,-1==q.indexOf(l.name)&&(X.append_batch(l,a,n),q.push(l.name));if(xa.wireframe_debug){for(g=0;g<f.length;g++)if(e=f[g].render,"DYNAMIC"==e.type&&(l=f[g].rel_bpy_objects[0]._object,-1<ra.indexOf(f[g].batch.type))){m=X.get_scene_data(l,a);n=m.batches;q=!1;for(m=0;m<n.length;m++)n[m].debug_sphere&&
(q=!0);q||(e=G(e.be_local,e,l.name,!0,!0),X.append_batch(l,a,e))}for(g=0;g<h.length;g++)l=h[g],e=l.render,m=X.get_scene_data(l,a),n=m.batches,-1<ra.indexOf(n[0].type)&&(e=G(e.bs_local,e,l.name,!1),X.append_batch(l,a,e))}for(g=0;g<b.length;g++)for(m=X.get_scene_data(b[g]._object,a),n=m.batches,m=0;m<n.length;m++)c(n[m]);for(g=0;g<h.length;g++)for(m=X.get_scene_data(h[g],a),n=m.batches,m=0;m<n.length;m++)c(n[m])};a.generate_sky_meta_obj=function(a,b){var d=a._render.world_light_set,e=t("MAIN");x(e,
"special_skydome.glslv","special_skydome.glslf");if(b.procedural_skydome)u(e,"PROCEDURAL_SKYDOME",1),e.procedural_sky=!0;else{var f=d.sky_texture_param;if(f){u(e,"WO_SKYTEX",1);var g=h(d.sky_texture_slot,null);H(e,g,"u_sky");f.invert&&u(e,"MTEX_NEGATIVE",1);f.use_rgb_to_intensity&&u(e,"MTEX_RGBTOINT",1);u(e,"BLENDTYPE",f.blend_type);f.use_map_blend&&u(e,"WOMAP_BLEND",1);f.use_map_horizon&&u(e,"WOMAP_HORIZ",1);f.use_map_zenith_up&&u(e,"WOMAP_ZENUP",1);f.use_map_zenith_down&&u(e,"WOMAP_ZENDOWN",1)}d.use_sky_blend&&
u(e,"WO_SKYBLEND",1);d.use_sky_paper&&u(e,"WO_SKYPAPER",1);d.use_sky_real&&u(e,"WO_SKYREAL",1)}b.reflexible&&(e.reflexible=!0,b.reflexible_only&&(e.reflexible_only=!0));e.offset_z=99999;m(e,"a_position");d=ga.generate_fullscreen_quad();K(e,d);c(e);d=ca.unique_name("%meta_sky%");d=X.create_object(d,"MESH");X.append_scene_data(d,a);f=X.get_scene_data(d,a);d.render=X.create_render("STATIC");d.render.do_not_cull=!0;d.render.bb_local=T.zero_bounding_box();d.render.bs_local=T.zero_bounding_sphere();d.render.bb_world=
T.zero_bounding_box();d.render.bs_world=T.zero_bounding_sphere();f.batches.push(e);return d};a.create_forked_batches=function(a,c,d){d=X.get_scene_data(a,d).batches;var e=[],h=Z.find_subs(c,"SHADOW_CAST"),f=Z.find_subs(c,"MAIN_PLANE_REFLECT"),g=Z.find_subs(c,"MAIN_CUBE_REFLECT"),k=Z.find_subs(c,"OUTLINE_MASK");c=Z.find_subs(c,"COLOR_PICKING");for(var l=0;l<d.length;l++){var m=d[l],n=null;"DEPTH"==m.type&&h&&m.shadow_cast&&(n=b(m),n.subtype="SHADOW_CAST");"MAIN"!=m.type&&"PARTICLES"!=m.type||!f&&!g||
m.blend||!m.reflexible||(n=b(m),n.subtype="REFLECT");"COLOR_ID"==m.type&&m.can_fork_outline&&k&&a.render.outlining&&(c&&a.render.selectable?(n=b(m),n.subtype="OUTLINE"):m.subtype="OUTLINE");n&&(n.forked_batch=!0,J(n,a.render.id),e.push(n))}d.push.apply(d,e)};a.set_local_cylinder_capsule=q;a.wb_angle_to_amp=function(a,b,c){if(b)b=c*(b.max_y-b.min_y);else throw"No bounding box for mesh";if(0==b)return 0;a=b*Math.tan(a/180*Math.PI);return.5*(Math.sqrt(2*Math.sqrt(4*a+1)+2)/2-1)/b};a.bb_bpy_to_b4w=function(a){return{max_x:a.max_x,
min_x:a.min_x,max_y:a.max_y,min_y:a.min_y,max_z:a.max_z,min_z:a.min_z}};a.get_batch_texture=h;a.update_batch_material_debug=e;a.update_batch_lights=y;a.set_lamp_data=v;a.assign_shadow_receive_dirs=function(a,b,c){u(a,"CSM_SECTION0",0);u(a,"CSM_SECTION1",0);u(a,"CSM_SECTION2",0);u(a,"CSM_SECTION3",0);u(a,"NUM_CAST_LAMPS",0);if(b){u(a,"NUM_CAST_LAMPS",b.lamp_types.length);xa.mac_os_shadow_hack&&u(a,"MAC_OS_SHADOW_HACK",1);for(c=0;c<b.csm_num;c++)u(a,"CSM_SECTION"+String(c),1);u(a,"SHADOW_TEX_RES",ba.glsl_value(b.csm_resolution));
u(a,"CSM_FADE_LAST_CASCADE",b.fade_last_cascade?1:0);u(a,"CSM_BLEND_BETWEEN_CASCADES",b.blend_between_cascades?1:0)}else u(a,"SHADOW_TEX_RES",0),u(a,"CSM_FADE_LAST_CASCADE",0),u(a,"CSM_BLEND_BETWEEN_CASCADES",0)};a.set_batch_directive=u;a.get_batch_directive=function(a,b){return ba.get_directive(a.shaders_info,b)};a.update_batch_geometry=K;a.update_batch_id=J;a.calculate_render_id=O;a.create_bounding_ellipsoid_batch=G;a.append_texture=H;a.replace_texture=function(a,b,c){c=a.texture_names.indexOf(c);
-1<c&&(a.textures[c]=b)};a.create_shadeless_batch=function(a,b,c){var d=t("MAIN");1>c&&(d.blend=!0);ka.set(b[0],b[1],b[2],c,d.diffuse_color);d.draw_mode=ea.DM_TRIANGLES;K(d,a);x(d,"main.glslv","main_stack.glslf");u(d,"SHADELESS",1);P(d);return d};a.update_shader=P;a.generate_line_batches=function(a,b){for(var d=0;d<b.length;d++){var e=b[d]._object,h=t("LINE");x(h,"line.glslv","line.glslf");h.blend=!0;var f=ga.generate_line();K(h,f);c(h);X.append_scene_data(e,a);X.get_scene_data(e,a).batches.push(h);
P(h)}};a.check_batch_perm_uniform=function(a,b){return a.shader.permanent_uniform_setters.length?a.shader.permanent_uniform_setters_table[b]?!0:!1:!1};a.create_depth_pack_batch=function(a){a=t("DEPTH_PACK");a.use_backface_culling=!0;a.depth_mask=!1;var b=ga.generate_fullscreen_tri();K(a,b);x(a,"postprocessing/postprocessing.glslv","postprocessing/depth_pack.glslf");P(a);return a};a.create_postprocessing_batch=function(a){var b=t("POSTPROCESSING");x(b,"postprocessing/postprocessing.glslv","postprocessing/postprocessing.glslf");
switch(a){case "NONE":u(b,"POST_EFFECT","POST_EFFECT_NONE");break;case "GRAYSCALE":u(b,"POST_EFFECT","POST_EFFECT_GRAYSCALE");break;case "X_BLUR":u(b,"POST_EFFECT","POST_EFFECT_X_BLUR");break;case "Y_BLUR":u(b,"POST_EFFECT","POST_EFFECT_Y_BLUR");break;case "X_GLOW_BLUR":u(b,"POST_EFFECT","POST_EFFECT_X_GLOW_BLUR");break;case "Y_GLOW_BLUR":u(b,"POST_EFFECT","POST_EFFECT_Y_GLOW_BLUR");break;case "X_EXTEND":u(b,"POST_EFFECT","POST_EFFECT_X_EXTEND");break;case "Y_EXTEND":u(b,"POST_EFFECT","POST_EFFECT_Y_EXTEND");
break;case "FLIP_CUBEMAP_COORDS":u(b,"POST_EFFECT","FLIP_CUBEMAP_COORDS");break;default:throw"Wrong postprocessing effect: "+a;}b.use_backface_culling=!0;b.depth_mask=!1;a=ga.generate_fullscreen_tri();K(b,a);P(b);return b};a.create_ssao_batch=function(a){var b=t("SSAO");b.depth_mask=!1;b.use_backface_culling=!0;var c=ga.generate_fullscreen_tri();K(b,c);x(b,"postprocessing/postprocessing.glslv","postprocessing/ssao.glslf");u(b,"SSAO_QUALITY","SSAO_QUALITY_"+a.ssao_samples);u(b,"SSAO_HEMISPHERE",a.ssao_hemisphere?
1:0);a={texture:Q.generate_texture("SSAO_TEXTURE",a)};c={width:4,height:4,data:new Uint8Array([150,123,254,0,127,3,97,0,164,246,99,0,155,177,14,0,54,83,221,0,2,142,143,0,32,57,79,0,49,160,32,0,57,232,115,0,178,216,203,0,70,196,218,0,241,164,82,0,225,58,85,0,233,88,189,0,144,25,203,0,117,73,12,0])};a=h(a,c);H(b,a,"u_ssao_special_tex");P(b);return b};a.create_ssao_blur_batch=function(a){var b=t("SSAO_BLUR");b.depth_mask=!1;b.use_backface_culling=!0;var c=ga.generate_fullscreen_tri();K(b,c);x(b,"postprocessing/postprocessing.glslv",
"postprocessing/ssao_blur.glslf");u(b,"SSAO_BLUR_DEPTH",a.ssao_blur_depth?1:0);P(b);return b};a.create_dof_batch=function(a){a=t("DOF");a.depth_mask=!1;a.use_backface_culling=!0;var b=ga.generate_fullscreen_tri();K(a,b);x(a,"postprocessing/postprocessing.glslv","postprocessing/dof.glslf");u(a,"DEPTH_RGBA",1);P(a);return a};a.create_outline_batch=function(){var a=t("OUTLINE");a.depth_mask=!1;a.use_backface_culling=!0;var b=ga.generate_fullscreen_tri();K(a,b);x(a,"postprocessing/postprocessing.glslv",
"postprocessing/outline.glslf");P(a);return a};a.create_glow_combine_batch=function(){var a=t("GLOW_COMBINE");a.depth_mask=!1;a.use_backface_culling=!0;var b=ga.generate_fullscreen_tri();K(a,b);x(a,"postprocessing/postprocessing.glslv","postprocessing/glow.glslf");P(a);return a};a.create_god_rays_batch=function(a,b,c,d){a=t("GOD_RAYS");a.depth_mask=!1;a.use_backface_culling=!0;var e=ga.generate_billboard();K(a,e);x(a,"postprocessing/god_rays.glslv","postprocessing/god_rays.glslf");u(a,"DEPTH_RGBA",
b?1:0);u(a,"WATER_EFFECTS",c?1:0);u(a,"STEPS_PER_PASS",ba.glsl_value(d,1));P(a);return a};a.create_god_rays_combine_batch=function(a,b){var c=t("GOD_RAYS_COM");c.depth_mask=!1;c.use_backface_culling=!0;var d=ga.generate_fullscreen_tri();K(c,d);x(c,"postprocessing/postprocessing.glslv","postprocessing/god_rays_combine.glslf");u(c,"SAFARI_CANVAS_ALPHA_HACK",xa.safari_canvas_alpha_hack?1:0);P(c);return c};a.create_procedural_sky_batch=function(){var a=t("SKY");a.depth_mask=!1;a.use_backface_culling=
!0;var b=ga.generate_cube();K(a,b);x(a,"procedural_skydome.glslv","procedural_skydome.glslf");u(a,"WATER_EFFECTS",1);P(a);return a};a.create_antialiasing_batch=function(a){var b=t("ANTIALIASING");b.depth_mask=!1;b.use_backface_culling=!0;var c=ga.generate_fullscreen_tri();K(b,c);x(b,"postprocessing/postprocessing.glslv","postprocessing/antialiasing.glslf");xa.quality_aa_method?(u(b,"AA_METHOD","AA_METHOD_FXAA_QUALITY"),u(b,"AA_QUALITY",a.fxaa_quality)):u(b,"AA_METHOD","AA_METHOD_FXAA_LIGHT");P(b);
return b};a.create_smaa_batch=function(a){var b=t("SMAA"),c=ga.generate_fullscreen_tri();K(b,c);x(b,"postprocessing/smaa.glslv","postprocessing/smaa.glslf");u(b,"AA_METHOD","AA_METHOD_SMAA_HIGH");u(b,"SMAA_PASS",a);u(b,"SMAA_PREDICATION",0);u(b,"SMAA_REPROJECTION",0);P(b);b.depth_mask=!1;b.use_backface_culling=!0;return b};a.create_compositing_batch=function(){var a=t("COMPOSITING");a.depth_mask=!1;a.use_backface_culling=!0;var b=ga.generate_fullscreen_tri();K(a,b);x(a,"postprocessing/postprocessing.glslv",
"postprocessing/compositing.glslf");P(a);return a};a.create_motion_blur_batch=function(a){a=t("MOTION_BLUR");a.use_backface_culling=!0;a.depth_mask=!1;var b=ga.generate_fullscreen_tri();K(a,b);x(a,"postprocessing/postprocessing.glslv","postprocessing/motion_blur.glslf");P(a);return a};a.create_stereo_batch=function(a){var b=t("STEREO");b.use_backface_culling=!0;b.depth_mask=!1;var c=ga.generate_fullscreen_tri();K(b,c);x(b,"postprocessing/postprocessing.glslv","postprocessing/stereo.glslf");u(b,"ANAGLYPH",
"ANAGLYPH"===a?1:0);u(b,"DISABLE_DISTORTION_CORRECTION",xa.use_browser_distortion_cor?1:0);P(b);return b};a.create_luminance_batch=function(){var a=t("LUMINANCE");a.depth_mask=!1;a.use_backface_culling=!0;var b=ga.generate_fullscreen_tri();K(a,b);x(a,"postprocessing/postprocessing.glslv","postprocessing/luminance.glslf");P(a);return a};a.create_average_luminance_batch=function(){var a=t("LUMINANCE");a.depth_mask=!1;a.use_backface_culling=!0;var b=ga.generate_fullscreen_tri();K(a,b);x(a,"postprocessing/postprocessing.glslv",
"postprocessing/luminance_av.glslf");P(a);return a};a.create_luminance_trunced_batch=function(){var a=t("LUMINANCE_X_BLUR");a.depth_mask=!1;a.use_backface_culling=!0;var b=ga.generate_fullscreen_tri();K(a,b);x(a,"postprocessing/luminance_trunced.glslv","postprocessing/luminance_trunced.glslf");P(a);return a};a.create_bloom_blur_batch=function(){var a=t("POSTPROCESSING");a.use_backface_culling=!0;a.depth_mask=!1;var b=ga.generate_fullscreen_tri();K(a,b);x(a,"postprocessing/postprocessing.glslv","postprocessing/bloom_blur.glslf");
P(a);return a};a.create_bloom_combine_batch=function(){var a=t("BLOOM");a.depth_mask=!1;a.use_backface_culling=!0;var b=ga.generate_fullscreen_tri();K(a,b);x(a,"postprocessing/postprocessing.glslv","postprocessing/bloom_combine.glslf");P(a);return a};a.create_velocity_batch=function(){var a=t("VELOCITY");a.depth_mask=!1;a.use_backface_culling=!0;var b=ga.generate_fullscreen_tri();K(a,b);x(a,"postprocessing/postprocessing.glslv","postprocessing/velocity.glslf");P(a);return a};a.create_anchor_visibility_batch=
function(){var a=t("ANCHOR_VISIBILITY");a.depth_mask=!0;a.use_backface_culling=!0;a.draw_mode=ea.DM_POINTS;x(a,"anchors.glslv","anchors.glslf");var b=ga.generate_index(1);K(a,b);u(a,"ANCHOR_NUM",1);P(a);a.positions=new Float32Array([0,0,0]);return a};a.create_performance_batch=function(){var a=t("PERFORMANCE");a.depth_mask=!1;a.use_backface_culling=!0;var b=ga.generate_fullscreen_tri();K(a,b);x(a,"postprocessing/postprocessing.glslv","postprocessing/performance.glslf");u(a,"POST_EFFECT","POST_EFFECT_X_BLUR");
P(a);return a};a.update_anchor_visibility_batch=function(a,b){var c=b.length/3;if(c!=a.positions.length/3){var d=ga.generate_index(c);K(a,d);u(a,"ANCHOR_NUM",c);P(a)}a.positions=b};a.get_first_batch=function(a){if(!a.scenes_data.length)return null;a=a.scenes_data[0];return a.batches.length?a.batches[0]:null};a.find_batch_material=I;a.find_batch_material_forked=aa;a.set_material_props=U;a.check_batch_type=function(a,b){for(var c=a.scenes_data[0].batches,d=0;d<c.length;d++)if(c[d].type==b)return!0;
return!1};a.clear_batch=function(a){for(var b=a.textures,c=0;c<b.length;c++)Q.delete_texture(b[c].w_texture);ea.cleanup_bufs_data(a.bufs_data)};a.inherit_material=function(a,b,c,d){for(var e=["MAIN","DEPTH","COLOR_ID"],h=!1,f=0;f<e.length;f++){var g=e[f],k=I(a,b,g),l=I(c,d,g);if(k&&l){var h=!0,m=aa(c,d,g);"MAIN"==g&&(U(l,k),m&&U(m,k));for(g=0;g<l.texture_names.length;g++){var n=l.texture_names[g];if(-1!==ma.indexOf(n)){var q=k.texture_names.indexOf(n);-1!==q&&(l.textures[g]=k.textures[q],m&&(n=m.texture_names.indexOf(n),
-1!==n&&(m.textures[n]=k.textures[q])))}}}}h||fa.error("Wrong objects for inheriting material!")}};b4w.module.__nodemat=function(a,p){function t(a,b,e,g,k){var p=ra.get_active(),p=d(b,k,p.uuid);if(p in R)return R[p];if("DEPTH"!=k&&"COLOR_ID"!=k){b=Q.create();for(var v=a.nodes,z=0;z<v.length;z++)if(null==E(b,v[z],0,g,k))return R[p]=null;if(e&&-1==u(a,b,"GROUP_OUTPUT","group"))return null;z=X(b);v=e?a.links:a.links.slice();if(!la(b,v,z))return null;if(e)return b;for(z=0;z<v.length;z++){e=v[z];for(var y=h(e.from_node,b),A=h(e.to_node,b),N=0;N<y.length;N++)for(var x=0;x<A.length;x++){var w=y[N],I=
A[x],Z=Q.get_node_attr(b,w),J=Q.get_node_attr(b,I);if(!V(b,w,I,Z,J,e))return R[p]=null}}f(b);a="GLOW"==k?u(a,b,"B4W_GLOW_OUTPUT","material",!0):u(a,b,"OUTPUT","material",!1,!0);-1==a&&(b=q(),a=0);n(b);a=Q.subgraph_node_conn(b,a,Q.BACKWARD_DIR);c(a,g,k);r(a);B(a);m(a);C(a,g,k)}else g=t(a,b,e,g,"MAIN"),g=Q.clone(g,function(a){var b=qa.clone_object_nr(a);b.inputs=qa.clone_object_r(a.inputs);b.outputs=qa.clone_object_r(a.outputs);return b}),a=u(a,g,"OUTPUT","material",!1,!0),l(g,a),a=Q.subgraph_node_conn(g,
a,Q.BACKWARD_DIR),r(a);return R[p]=a}function c(a,c,d){var e=[];Q.traverse(a,function(a,b){"MATERIAL"!=b.type&&"MATERIAL_EXT"!=b.type||e.push({node_id:a,node:b})});for(d=0;d<e.length;++d){var h=e[d].node_id,f=e[d].node,g=Q.gen_node_id(a);Q.append_node(a,g,f.data.material_begin);var k=Q.gen_node_id(a);Q.append_node(a,k,f.data.material_end);Q.append_edge(a,g,k,[4,2]);for(var l={5:["LIGHTING_APPLY",10],6:["LIGHTING_APPLY",6],7:["MATERIAL_END",3],8:["MATERIAL_END",4],9:["MATERIAL_END",5]},m=Q.in_edge_count(a,
h),n=[],q=[],r=[],p={},v=0;v<m;v++){var z=Q.get_in_edge(a,h,v);z in p||(p[z]=0);var y=Q.get_edge_attr(a,z,h,p[z]++);n.push([z,h,y]);var u=l[y[1]];if(u)switch(u[0]){case "MATERIAL_END":q.push([z,k,[y[0],u[1]]]);break;case "LIGHTING_APPLY":r.push([z,[y[0],u[1]]])}else q.push([z,g,y])}b(a,f.data.value,g,k,r,c);for(v=0;v<n.length;v++)Q.remove_edge_by_attr(a,n[v][0],n[v][1],n[v][2]);for(v=0;v<q.length;v++)Q.append_edge(a,q[v][0],q[v][1],q[v][2]);f=Q.out_edge_count(a,h);g=[];l=[];m={};for(v=0;v<f;v++)n=
Q.get_out_edge(a,h,v),n in m||(m[n]=0),y=Q.get_edge_attr(a,h,n,m[n]++),g.push([h,n,y]),l.push([k,n,y]);for(v=0;v<g.length;v++)Q.remove_edge_by_attr(a,g[v][0],g[v][1],g[v][2]);for(v=0;v<l.length;v++)Q.append_edge(a,l[v][0],l[v][1],l[v][2]);Q.remove_node(a,h)}}function b(a,b,c,d,e,h){var f={name:"LIGHTING_AMBIENT",type:"LIGHTING_AMBIENT"},g=E(a,f,0,h,null),l=g;k(a,c,g,"E");k(a,c,g,"A");k(a,c,g,"D");g=ra.get_active();g=Ga.get_scene_objs(g,"LAMP",Ga.DATA_ID_ALL);if(!b.use_shadeless)for(var m,n,q=0;q<
g.length;q++){var r=g[q].light,f={name:"LIGHTING_LAMP",type:"LIGHTING_LAMP"};m=E(a,f,0,h,null);f={name:"LIGHTING_APPLY",type:"LIGHTING_APPLY"};n=E(a,f,0,h,null);k(a,l,n,"color");k(a,l,n,"specular");k(a,m,n,"ldir");k(a,c,n,"normal");k(a,c,n,"D");k(a,c,n,"S");k(a,m,n,"lcolorint");k(a,c,m,"shadow_factor");l="COOKTORR"==b.specular_shader?"SPECULAR_PHONG":"SPECULAR_"+b.specular_shader;f={name:l,type:l};f=E(a,f,0,h,null);k(a,m,f,"ldir");k(a,m,f,"lfac");k(a,c,f,"normal");k(a,f,n,"sfactor");"SPECULAR_PHONG"!=
l&&"SPECULAR_BLINN"!=l||k(a,m,f,"norm_fac");k(a,c,f,"sp_params");l="HEMI"==r.type?"DIFFUSE_LAMBERT":"DIFFUSE_"+b.diffuse_shader;f={name:l,type:l};f=E(a,f,0,h,null);k(a,m,f,"ldir");k(a,m,f,"lfac");k(a,c,f,"normal");k(a,m,f,"norm_fac");k(a,f,n,"lfactor");"DIFFUSE_LAMBERT"!=l&&k(a,c,f,"dif_params");for(m=0;m<e.length;m++)Q.append_edge(a,e[m][0],n,e[m][1]);l=n}k(a,l,d,"color");k(a,l,d,"specular")}function k(a,b,c,d){for(var e=Q.get_node_attr(a,b),h=Q.get_node_attr(a,c),f,g=0;g<h.inputs.length;g++)if(d==
h.inputs[g].identifier){f=g;break}for(var k,g=0;g<e.outputs.length;g++)if(d==e.outputs[g].identifier){k=g;break}void 0!=f&&void 0!=k&&Q.append_edge(a,b,c,[k,f])}function d(a,b,c){switch(b){case "GLOW":return a+c+"11";case "COLOR_ID":case "DEPTH":return a+c+"00";default:return a+c+"10"}}function l(a,b){Q.traverse_edges(a,function(c,d,e){var h=Q.get_node_attr(a,d);d==b&&"Color"==h.inputs[e[1]].identifier&&Q.remove_edge_by_attr(a,c,d,e)})}function q(){var a=Q.create(),b={data:null,dirs:[],params:[],
inputs:[{default_value:new Float32Array([0,0,0]),identifier:"Color",is_linked:!1,name:"Color"},{default_value:1,identifier:"Alpha",is_linked:!1,name:"Alpha"}],outputs:[],type:"OUTPUT",vparams:[]};Q.append_node(a,0,b);return a}function r(a){Q.traverse(a,function(b,c){for(var d=c.inputs,e=c.outputs,h=0;h<d.length;h++)g(a,d[h],b,h,1);for(h=0;h<e.length;h++)g(a,e[h],b,h,0)})}function g(a,b,c,d,e){if(b.is_linked){var h=!0;Q.traverse_edges(a,function(a,b,f){if(!e&&a==c&&f[0]==d||e&&b==c&&f[1]==d)h=!1});
h&&(b.is_linked=!1)}}function C(a,b,c){var d=[];Q.traverse_edges(a,function(e,h,f){var g=Q.get_node_attr(a,e),k=Q.get_node_attr(a,h),g=qa.is_vector(g.outputs[f[0]].default_value),k=qa.is_vector(k.inputs[f[1]].default_value);if(g!=k){var l,m={default_value:[0,0,0],identifier:"Vector",is_linked:!0,name:"Vector"},n={default_value:0,identifier:"Value",is_linked:!0,name:"Value"};g&&!k?l=K("vector_to_scalar","B4W_VECTOSCAL",[m],[n]):!g&&k&&(l=K("scalar_to_vector","B4W_SCALTOVEC",[n],[m]));E(a,l,0,b,c);
d.push([e,h,a.nodes[a.nodes.length-2],f])}});for(var e=0;e<d.length;++e)Q.remove_edge_by_attr(a,d[e][0],d[e][1],d[e][3]),Q.append_edge(a,d[e][0],d[e][2],[d[e][3][0],0]),Q.append_edge(a,d[e][2],d[e][1],[0,d[e][3][1]])}function f(a){var b=[];Q.traverse(a,function(c,d){switch(d.type){case "B4W_TRANSLUCENCY":Q.traverse_edges(a,function(a,e,h){a==c&&"Translucency"==d.outputs[h[0]].name&&b.push(a,e,[h[0]+1,h[1]+1])})}});for(var c=0;c<b.length;c+=3)Q.append_edge(a,b[c],b[c+1],b[c+2])}function h(a,b){var c=
[];Q.traverse(b,function(b,d){d.name==a.name&&c.push(b)});if(c.length)return c;throw"Node not found";}function n(a){var b=[];Q.traverse(a,function(a,c){"B4W_PARALLAX"!=c.type&&"REROUTE"!=c.type||b.push(a,c)});for(var c=0;c<b.length;c+=2){var d=b[c],e=b[c+1];if("B4W_PARALLAX"==e.type){var h=A(a,d,1);if(-1!=h){var f=Q.get_in_edge(a,h,0);Q.remove_edge(a,h,d,-1);-1!=f&&Q.remove_edge(a,f,h,-1);d=Q.get_node_attr(a,h);e.data=d.data;e.params[0]=d.params[0];Q.remove_node(a,h)}e.inputs.splice(1,1)}else if("REROUTE"==
e.type){for(var e=Q.get_in_edge(a,d,0),g=Q.out_edge_count(a,d),h=[],f=[],k=[],l=0;l<g;l++){var m=Q.get_out_edge(a,d,l),n=f.indexOf(m);-1!=n?k[n]+=1:(f.push(m),k.push(1),h.push(d,m))}if(-1!=e)for(g=Q.get_edge_attr(a,e,d,0)[0],l=0;l<f.length;l++)for(m=0;m<k[l];m++)n=Q.get_edge_attr(a,d,f[l],m)[1],Q.append_edge(a,e,f[l],[g,n]);for(l=0;l<h.length;l+=2)Q.remove_edge(a,h[l],h[l+1],-1)}}}function A(a,b,c){a=a.edges;for(var d=0;d<a.length;d+=3)if(a[d+1]==b&&a[d+2][1]==c)return a[d];return-1}function B(a){D(a);
z(a);F(a)}function F(a,b){var c=[],d="",e="",h={};Q.traverse(a,function(a,b){if("GEOMETRY_UV"==b.type||"UVMAP"==b.type||"TEX_COORD_UV"==b.type){c.push(a,b);var f=b.data.value;d?d==f||e||(e=f,h[e]=0):(d=f,h[d]=0);h[f]++}});for(var f in h)if(2>h[f]){for(var g=0;g<c.length;g+=2)c[g+1].data.value==f&&c.splice(g,2);delete h[f];d==f&&(d=e,e="");e==f&&(e="")}if(!(3>c.length)){var g={default_value:[0,0,0],identifier:"UV_geom",is_linked:!1,name:"UV_geom"},k={default_value:[0,0,0],identifier:"UV_cycles",is_linked:!1,
name:"UV_cycles"};f=K("merged_uv","UV_MERGED",[],[g,k]);f.uv_layer=d;E(a,f,0,"",b);var l=a.nodes[a.nodes.length-2];f=a.nodes[a.nodes.length-1];if(e){k=K("merged_uv","UV_MERGED",[],[g,k]);k.uv_layer=e;E(a,k,0,"",b);var m=a.nodes[a.nodes.length-2],k=a.nodes[a.nodes.length-1]}else k=null;for(var n=-1,q=null,g=0;g<c.length;g+=2){var r=c[g],p=c[g+1];v(p,c[1])?(n=l,q=f):k&&(n=m,q=k);for(var z=[],y=Q.out_edge_count(a,r),u={},A=0;A<y;A++){var N=Q.get_out_edge(a,r,A);N in u||(u[N]=0);var x=Q.get_edge_attr(a,
r,N,u[N]++);z.push(r,N,x);x=x.splice(0,x.length);switch(p.type){case "GEOMETRY_UV":x[0]=0;q.outputs[0].is_linked=!0;break;case "UVMAP":case "TEX_COORD_UV":x[0]=1,q.outputs[1].is_linked=!0}Q.append_edge(a,n,N,x)}for(var A=0;A<z.length;A+=3)Q.remove_edge(a,z[A],z[A+1],0);Q.remove_node(a,r)}}}function D(a){var b=[];Q.traverse(a,function(a,c){"GEOMETRY_VC"!=c.type&&"GEOMETRY_NO"!=c.type&&"GEOMETRY_FB"!=c.type&&"GEOMETRY_VW"!=c.type&&"GEOMETRY_GL"!=c.type&&"GEOMETRY_LO"!=c.type&&"GEOMETRY_OR"!=c.type||
b.push(a,c)});for(var c=[],d=0;d<b.length;d+=2){for(var e=b[d],h=b[d+1],f=!0,g=0;g<c.length;g++){var k=c[g];if(y(h,k.attr)){f=[];g=Q.out_edge_count(a,e);for(n=0;n<g;n++){var l=Q.get_out_edge(a,e,n),m=Q.get_edge_attr(a,e,l,0);f.push(e,l,m);Q.append_edge(a,k.id,l,m)}for(var n=0;n<f.length;n+=3)Q.remove_edge(a,f[n],f[n+1],0);Q.remove_node(a,e);f=!1;break}}f&&(k={id:e,attr:h},c.push(k))}}function e(a){for(var b={},c=0;c<a.nodes.length;c+=2)b[a.nodes[c]]=[];for(c=0;c<a.edges.length;c+=3){var d=a.edges[c],
e=a.edges[c+1];a:for(var h=b[e],f=d,g=0;g<=h.length;g++){if(g>=h.length||h[g]>f)h.splice(g,0,f);else if(h[g]!=f)continue;break a}for(var e=b[e],d=b[d],f=h=0,g=e.length+d.length,k=[],l=0;l<g;l++)h>e.length||e[h]>d[f]?k.push(d[f++]):k.push(e[h++])}return b}function z(a){var b=[];Q.traverse(a,function(a,c){"TEXTURE_COLOR"!=c.type&&"TEXTURE_NORMAL"!=c.type||b.push(a,c)});if(b.length){for(var c=e(a),d=[],h=0;h<b.length;h+=2){for(var f=b[h],g=b[h+1],k=!0,l=0;l<d.length;l++){var m=d[l];if(!(3<=m.merged_nodes.length||
!y(g,m.attr)||-1<c[f].indexOf(m.id)||-1<c[m.id].indexOf(f))){for(var n=!1,q=0;q<m.merged_nodes.length;q++){var r=m.merged_nodes[q].id;if(-1<c[f].indexOf(r)||-1<c[r].indexOf(f)){n=!0;break}}if(!n){for(var l=[],r=Q.in_edge_count(a,f),p={},q=0;q<r;q++)n=Q.get_in_edge(a,f,q),n in p||(p[n]=0),k=Q.get_edge_attr(a,n,f,p[n]++),l.push(n,f,k);for(var r=[],p=Q.out_edge_count(a,f),v={},q=0;q<p;q++)n=Q.get_out_edge(a,f,q),n in v||(v[n]=0),k=Q.get_edge_attr(a,f,n,v[n]++),r.push(f,n,k);k=l.concat(r);for(q=0;q<k.length;q+=
3)Q.remove_edge(a,k[q],k[q+1],0);Q.remove_node(a,f);q={id:f,attr:g,edges_in:l,edges_out:r};m.merged_nodes.push(q);k=!1;break}}}k&&(m={id:f,attr:g,merged_nodes:[]},d.push(m))}for(h=0;h<d.length;h++){m=d[h];c=m.merged_nodes.length;for(l=0;l<c;l++){g=m.merged_nodes[l];q=g.attr;f=g.edges_in;g=g.edges_out;m.attr.inputs[l+1].is_linked=q.inputs[0].is_linked;m.attr.inputs[l+1].default_value=q.inputs[0].default_value;m.attr.outputs[2*(l+1)].is_linked=q.outputs[0].is_linked;m.attr.outputs[2*(l+1)].default_value=
q.outputs[0].default_value;m.attr.outputs[2*(l+1)+1].is_linked=q.outputs[1].is_linked;m.attr.outputs[2*(l+1)+1].default_value=q.outputs[1].default_value;for(q=0;q<f.length;q+=3)n=f[q],k=f[q+2],k[1]+=l+1,Q.append_edge(a,n,m.id,k);for(q=0;q<g.length;q+=3)n=g[q+1],k=g[q+2],k[0]+=2*(l+1),Q.append_edge(a,m.id,n,k);m.attr.dirs.push(["USE_uv"+(l+2),1])}Q.remove_node(a,m.id);Q.append_node(a,m.id,m.attr)}}}function y(a,b){if(a.type!==b.type)return!1;switch(a.type){case "GEOMETRY_VC":return a.data.value==b.data.value;
case "GEOMETRY_NO":case "GEOMETRY_FB":case "GEOMETRY_VW":case "GEOMETRY_GL":case "GEOMETRY_LO":case "GEOMETRY_OR":return!0;case "TEXTURE_COLOR":case "TEXTURE_NORMAL":return a.data.value.uuid==b.data.value.uuid;default:return!1}}function v(a,b){var c=["GEOMETRY_UV","TEX_COORD_UV","UVMAP"];return-1!=c.indexOf(a.type)&&-1!=c.indexOf(b.type)?a.data.value==b.data.value:!1}function m(a){var b=[];Q.traverse(a,function(a,c){"GEOMETRY_VC"==c.type&&b.push(a,c)});for(var c=0;c<b.length;c+=2){for(var d=b[c],
e=b[c+1],h=!1,f=[],g=[],k=[[],[],[]],l=Q.out_edge_count(a,d),m=0;m<l;m++){var n=Q.get_out_edge(a,d,m);if("SEPRGB"!=Q.get_node_attr(a,n).type){h=!1;break}f.push(d,n);for(var q={},r=Q.out_edge_count(a,n),h=0;h<r;h++){var p=Q.get_out_edge(a,n,h);p in q||(q[p]=0);var v=Q.get_edge_attr(a,n,p,q[p]++);f.push(n,p);k[v[0]].push(d,p,v)}g.push(n);h=!0}if(h){for(m=d=l=0;m<k.length;m++)k[m].length&&(l++,d|=1<<2-m);if(l){e.type+=l;e.outputs=[];for(m=0;m<k.length;m++)if(k[m].length)for(e.outputs.push({default_value:0,
identifier:"RGB"[m],is_linked:!0,name:"RGB"[m]}),h=0;h<k[m].length;h+=3)k[m][h+2][0]=qa.rgb_mask_get_channel_presence_index(d,m);for(m=0;m<f.length;m+=2)Q.remove_edge(a,f[m],f[m+1],0);for(m=0;m<g.length;m++)Q.remove_node(a,g[m]);for(m=0;m<k.length;m++)for(h=0;h<k[m].length;h+=3)Q.append_edge(a,k[m][h],k[m][h+1],k[m][h+2])}}}}function u(a,b,c,d,e,f){a=a.nodes;for(var g=null,k=0;k<a.length;k++){var l=a[k];e?"GROUP"==l.type&&l.node_tree_name==c&&(g=l):l.type==c&&(g=l)}return g?h(g,b)[0]:(f||ka.error('No "'+
c+'" node in node '+d),-1)}function K(a,b,c,d){return{name:a,type:b,inputs:c,outputs:d}}function E(a,b,c,d,e){var h=b.name,f=b.type,g=[],k=[],l=[],m=[],n=null,q=[];switch(f){case "BSDF_ANISOTROPIC":case "BSDF_DIFFUSE":case "BSDF_GLOSSY":case "BSDF_GLASS":case "BSDF_HAIR":case "BSDF_TRANSPARENT":case "BSDF_TRANSLUCENT":case "BSDF_REFRACTION":case "BSDF_TOON":case "BSDF_VELVET":case "SUBSURFACE_SCATTERING":case "EMISSION":case "AMBIENT_OCCLUSION":case "VOLUME_ABSORPTION":case "VOLUME_SCATTER":case "BUMP":case "NORMAL_MAP":case "VECT_TRANSFORM":case "BLACKBODY":case "WAVELENGTH":case "SEPXYZ":case "COMBXYZ":case "LIGHT_FALLOFF":case "TEX_IMAGE":case "TEX_ENVIRONMENT":case "TEX_SKY":case "TEX_NOISE":case "TEX_WAVE":case "TEX_MUSGRAVE":case "TEX_GRADIENT":case "TEX_MAGIC":case "TEX_CHECKER":case "TEX_BRICK":case "WIREFRAME":case "LAYER_WEIGHT":case "TANGENT":case "LIGHT_PATH":case "ATTRIBUTE":case "HOLDOUT":case "PARTICLE_INFO":case "HAIR_INFO":case "OBJECT_INFO":case "SCRIPT":case "NEW_GEOMETRY":k=
fa(b);l=da(b);ka.warn(f+" node is not fully supported.");break;case "BRIGHTCONTRAST":case "ADD_SHADER":case "MIX_SHADER":k=fa(b);l=da(b);break;case "UVMAP":var r=b.uv_layer;r||(f="EMPTY_UV");if("EMPTY_UV"!=f){var n=G("param_"+f+"_a"),p=G("param_"+f+"_v");g.push(ea(n));g.push(ea(p));m.push(ea(p));n={name:n,value:r}}l=da(b);break;case "UV_MERGED":n=G("param_UV_MERGED_a");p=G("param_UV_MERGED_v");g.push(ea(n));g.push(ea(p));l.push(U(b,"UV_geom"));l.push(U(b,"UV_cycles"));m.push(ea(p));n={name:n,value:b.uv_layer};
break;case "CAMERA":k=[];l=da(b);break;case "COMBRGB":case "COMBHSV":k=fa(b);l=da(b);break;case "CURVE_RGB":k=fa(b);l=da(b);ka.warn("CURVE_RGB node is not fully supported.");break;case "CURVE_VEC":k=fa(b);l=da(b);ka.warn("CURVE_VEC node is not fully supported.");break;case "GEOMETRY":if(!x(b))return!0;f=H(b,c);if(!f)return ka.error("Geometry output is not supported"),null;switch(f){case "GEOMETRY_UV":(r=b.uv_layer)||(f="EMPTY_UV");"EMPTY_UV"!=f&&(n=G("param_GEOMETRY_UV_a"),p=G("param_GEOMETRY_UV_v"),
g.push(ea(n)),g.push(ea(p)),m.push(ea(p)),n={name:n,value:r});l.push(U(b,"UV"));break;case "GEOMETRY_VC":(r=b.color_layer)||(f="EMPTY_VC");"EMPTY_VC"!=f&&(n=G("param_GEOMETRY_VC_a"),p=G("param_GEOMETRY_VC_v"),g.push(ea(n)),g.push(ea(p)),m.push(ea(p)),n={name:n,value:r});l.push(U(b,"Vertex Color"));break;case "GEOMETRY_NO":l.push(U(b,"Normal"));break;case "GEOMETRY_FB":l.push(U(b,"Front/Back"));break;case "GEOMETRY_VW":l.push(U(b,"View"));break;case "GEOMETRY_GL":l.push(U(b,"Global"));break;case "GEOMETRY_LO":l.push(U(b,
"Local"));break;case "GEOMETRY_OR":r=G("param_GEOMETRY_OR_v"),g.push(ea(r)),l.push(U(b,"Orco")),m.push(ea(r))}break;case "TEX_COORD":if(!x(b))return!0;f=P(b,c);if(!f)return ka.error("Texture coordinate output is not supported"),null;switch(f){case "TEX_COORD_UV":(r=b.uv_layer)||(f="EMPTY_UV");"EMPTY_UV"!=f&&(n=G("param_TEX_COORD_UV_a"),p=G("param_TEX_COORD_UV_v"),g.push(ea(n)),g.push(ea(p)),m.push(ea(p)),n={name:n,value:b.uv_layer});l.push(U(b,"UV"));break;case "TEX_COORD_NO":l.push(U(b,"Normal"));
break;case "TEX_COORD_GE":r=G("param_TEX_COORD_GE_v");g.push(ea(r));l.push(U(b,"Generated"));m.push(ea(r));break;case "TEX_COORD_OB":l.push(U(b,"Object"));ka.warn('Output "Object" of node "Texture Coordinate" doesn\'t supported fully.');break;case "TEX_COORD_CA":l.push(U(b,"Camera"));break;case "TEX_COORD_WI":l.push(U(b,"Window"));ka.warn('Output "Window" of node "Texture Coordinate" doesn\'t supported fully.');break;case "TEX_COORD_RE":l.push(U(b,"Reflection")),ka.warn('Output "Reflection" of node "Texture Coordinate" doesn\'t supported fully.')}break;
case "GROUP":r=b.node_tree_name;switch(r){case "B4W_LINEAR_TO_SRGB":if(!M(b,[1],[1])){n=J(b,d,e);break}f="B4W_LINEAR_TO_SRGB";break;case "B4W_NORMAL_VIEW":case "B4W_VECTOR_VIEW":if(!M(b,[1],[1])){n=J(b,d,e);break}f="B4W_VECTOR_VIEW";break;case "B4W_SRGB_TO_LINEAR":if(!M(b,[1],[1])){n=J(b,d,e);break}f="B4W_SRGB_TO_LINEAR";break;case "B4W_REFLECT":if(!M(b,[1,1],[1])){n=J(b,d,e);break}f="B4W_REFLECT";break;case "B4W_REFRACTION":if(!M(b,[1,0],[1])){n=J(b,d,e);break}f="B4W_REFRACTION";break;case "B4W_PARALLAX":if(!M(b,
[1,1,0,0,0],[1])){n=J(b,d,e);break}f="B4W_PARALLAX";p=G("temp_texture");m.push(ea(p));break;case "B4W_CLAMP":if(!M(b,[1],[1])){n=J(b,d,e);break}f="B4W_CLAMP";break;case "B4W_TRANSLUCENCY":if(!M(b,[0,0,0,0,0],[0])){n=J(b,d,e);break}f="B4W_TRANSLUCENCY";break;case "B4W_TIME":if(!M(b,[],[0])){n=J(b,d,e);break}f="B4W_TIME";break;case "B4W_SMOOTHSTEP":if(!M(b,[0,0,0],[0])){n=J(b,d,e);break}f="B4W_SMOOTHSTEP";break;case "B4W_GLOW_OUTPUT":f="B4W_GLOW_OUTPUT";break;default:n=J(b,d,e)}k=fa(b);l=da(b);"B4W_TRANSLUCENCY"==
r&&(r=w("TranslucencyParams","TranslucencyParams",[0,0,0,0]),r.is_linked=l[0].is_linked,l.push(r));break;case "LAMP":n=b.lamp;if(!n)return ka.error("There is no lamp in node: "+b.name),null;l.push(U(b,"Color"));l.push(U(b,"Light Vector"));l.push(U(b,"Distance"));l.push(U(b,"Visibility Factor"));n.uuid in L?q.push(["LAMP_INDEX",String(L[n.uuid])]):(L[n.uuid]=Fa,q.push(["LAMP_INDEX",String(Fa++)]));n=L;break;case "LIGHTING_AMBIENT":k=[w("E","E",[0,0,0],!0),w("A","A",[0,0,0],!0),w("D","D",[0,0,0],!0)];
l=[w("color","color",[0,0,0],!0),w("specular","specular",[0,0,0],!0)];break;case "LIGHTING_BEGIN":l=[w("E","E",[0,0,0],!0),w("A","A",[0,0,0],!0),w("D","D",[0,0,0],!0),w("S","S",[0,0,0],!0),w("normal","normal",[0,0,0],!0),w("dif_params","dif_params",[0,0],!0),w("sp_params","sp_params",[0,0],!0),w("shadow_factor","shadow_factor",0,!0),w("translucency_color","translucency_color",0,!0),w("translucency_params","translucency_params",[0,0,0,0],!0)];break;case "LIGHTING_END":k=[w("color","color",[0,0,0],
!0),w("specular","specular",[0,0,0],!0)];break;case "LIGHTING_LAMP":k=[w("shadow_factor","shadow_factor",0,!0)];l=[w("ldir","ldir",[0,0,0],!0),w("lfac","lfac",[0,0],!0),w("lcolorint","lcolorint",[0,0,0],!0),w("norm_fac","norm_fac",0,!0)];break;case "DIFFUSE_LAMBERT":k=[w("ldir","ldir",[0,0,0],!0),w("lfac","lfac",[0,0],!0),w("normal","normal",[0,0,0],!0),w("norm_fac","norm_fac",0,!0)];l=[w("lfactor","lfactor",0,!0)];break;case "DIFFUSE_FRESNEL":case "DIFFUSE_MINNAERT":case "DIFFUSE_OREN_NAYAR":case "DIFFUSE_TOON":k=
[w("ldir","ldir",[0,0,0],!0),w("lfac","lfac",[0,0],!0),w("normal","normal",[0,0,0],!0),w("norm_fac","norm_fac",0,!0),w("dif_params","dif_params",[0,0],!0)];l=[w("lfactor","lfactor",0,!0)];break;case "SPECULAR_BLINN":case "SPECULAR_PHONG":k=[w("ldir","ldir",[0,0,0],!0),w("lfac","lfac",[0,0],!0),w("normal","normal",[0,0,0],!0),w("norm_fac","norm_fac",0,!0),w("sp_params","sp_params",[0,0],!0)];l=[w("sfactor","sfactor",0,!0)];break;case "SPECULAR_TOON":case "SPECULAR_WARDISO":k=[w("ldir","ldir",[0,0,
0],!0),w("lfac","lfac",[0,0],!0),w("normal","normal",[0,0,0],!0),w("sp_params","sp_params",[0,0],!0)];l=[w("sfactor","sfactor",0,!0)];break;case "LIGHTING_APPLY":k=[w("color","color",[0,0,0,0],!0),w("specular","specular",[0,0,0],!0),w("lfactor","lfactor",0,!0),w("sfactor","sfactor",0,!0),w("ldir","ldir",[0,0,0],!0),w("normal","normal",[0,0,0],!0),w("translucency_params","translucency_params",[0,0,0,0],!0),w("D","D",[0,0,0],!0),w("S","S",[0,0,0],!0),w("lcolorint","lcolorint",[0,0,0],!0),w("translucency_color",
"translucency_color",0,!0)];l=[w("color","color",[0,0,0,0],!0),w("specular","specular",[0,0,0],!0)];break;case "NORMAL":k=fa(b);l=da(b);r=U(b,"Normal");m.push(ea(G("param_NORMAL_Normal"),r.default_value,3));break;case "MAPPING":r=b.vector_type;f="MAPPING";k.push(aa(b,"Vector"));l.push(U(b,"Vector"));var p=b.rotation,v=b.scale,z=b.translation,y=sa.create(),u=qa.euler_to_rotation_matrix(p);"TEXTURE"==r&&(v[0]=v[0]||1,v[1]=v[1]||1,v[2]=v[2]||1);var A=new Float32Array([v[0],0,0,0,v[1],0,0,0,v[2]]);sa.multiply(u,
A,y);y=qa.mat3_to_mat4(y,ca.create());switch(r){case "POINT":y[12]=z[0];y[13]=z[1];y[14]=z[2];break;case "TEXTURE":y[12]=z[0];y[13]=z[1];y[14]=z[2];y=ca.invert(y,y);break;case "NORMAL":ca.invert(y,y),ca.transpose(y,y)}switch(r){case "NORMAL":q.push(["MAPPING_IS_NORMAL",1]);case "TEXTURE":q.push(["MAPPING_TRS_MATRIX",xa.glsl_value(y,16)]);break;case "POINT":0!==ha.length(p)?q.push(["MAPPING_TRS_MATRIX",xa.glsl_value(y,16)]):(0!==ha.length(v)&&q.push(["MAPPING_SCALE",xa.glsl_value(v,3)]),0!==ha.length(z)&&
q.push(["MAPPING_TRANSLATION",xa.glsl_value(z,3)]));break;case "VECTOR":0!==ha.length(p)?q.push(["MAPPING_TRS_MATRIX",xa.glsl_value(y,16)]):0!==ha.length(v)&&q.push(["MAPPING_SCALE",xa.glsl_value(v,3)])}b.use_min&&q.push(["MAPPING_MIN_CLIP",xa.glsl_value(b.min,3)]);b.use_max&&q.push(["MAPPING_MAX_CLIP",xa.glsl_value(b.max,3)]);break;case "MATERIAL":case "MATERIAL_EXT":n=[];r=[];p=[];v=[w("E","E",[0,0,0],!0),w("A","A",[0,0,0],!0),w("D","D",[0,0,0],!0),w("S","S",[0,0,0],!0),w("normal","normal",[0,0,
0],!0),w("dif_params","dif_params",[0,0],!0),w("sp_params","sp_params",[0,0],!0),w("shadow_factor","shadow_factor",0,!0)];z=[w("color","color",[0,0,0],!0),w("specular","specular",[0,0,0],!0),w("normal","normal",[0,0,0],!0)];y=[U(b,"Color"),U(b,"Alpha"),U(b,"Normal")];u=[];A=aa(b,"Color");A.default_value.splice(3);p.push(A);k.push(A);A=aa(b,"Spec");A.default_value.splice(3);p.push(A);k.push(A);p.push(w("DiffuseIntensity","DiffuseIntensity",b.diffuse_intensity));k.push(A);var N=aa(b,"Normal");N.default_value.splice(3);
p.push(N);k.push(N);"MATERIAL_EXT"==f?((A=aa(b,"Emit"))||(A=w("Emit","Emit",0)),p.push(A),k.push(A),(A=aa(b,"Translucency"))?(A.default_value=0,A.name="Translucency",A.identifier="Translucency"):A=w("Translucency","Translucency",0),k.push(A),(A=aa(b,"Translucency"))?(A.default_value=[0,0,0,0],A.name="TranslucencyParams",A.identifier="TranslucencyParams"):A=w("TranslucencyParams","TranslucencyParams",[0,0,0,0]),k.push(A),l=aa(b,"Reflectivity"),A=aa(b,"Ray Mirror"),l?(A=l,l="Reflectivity"):A?l="Ray Mirror":
(A=l,l="Reflectivity"),A||(A=w(l,l,0)),k.push(A),z.push(A),(A=aa(b,"SpecTra"))||(A=w("SpecTra","SpecTra",0)),k.push(A),z.push(A),(A=aa(b,"Alpha"))||(A=w("Alpha","Alpha",b.alpha)),k.push(A),z.push(A),y.push(U(b,"Diffuse")),y.push(U(b,"Spec")),n.push(["MATERIAL_EXT",1]),r.push(["MATERIAL_EXT",1])):(p.push(w("emit_intensity","emit_intensity",0)),z.push(w("reflect_factor","reflect_factor",0)),z.push(w("specular_alpha","specular_alpha",0)),z.push(w("alpha_in","alpha_in",0)),y.push(w("diffuse_out","diffuse_out",
0)),y.push(w("spec_out","spec_out",0)),n.push(["MATERIAL_EXT",0]),r.push(["MATERIAL_EXT",0]));u.push(ea(G("param_MATERIAL_alpha"),b.alpha));u.push(ea(G("param_MATERIAL_spec_alpha"),b.specular_alpha));l=y;N.is_linked&&n.push(["USE_MATERIAL_NORMAL",1]);b.use_diffuse&&(n.push(["USE_MATERIAL_DIFFUSE",1]),r.push(["USE_MATERIAL_DIFFUSE",1]));b.use_specular&&r.push(["USE_MATERIAL_SPECULAR",1]);var A=[],t=0;switch(b.specular_shader){case "COOKTORR":case "PHONG":N=b.specular_hardness;break;case "WARDISO":N=
b.specular_slope;break;case "TOON":N=b.specular_toon_size;t=b.specular_toon_smooth;break;case "BLINN":N=b.specular_ior;t=b.specular_hardness;break;default:ka.error("unsupported specular shader: "+b.specular_shader+' (material "'+b.material_name+'")'),N=b.specular_hardness}var C,Z;switch(b.diffuse_shader){case "LAMBERT":Z=C=0;break;case "OREN_NAYAR":C=b.roughness;Z=0;break;case "FRESNEL":C=b.diffuse_fresnel;Z=b.diffuse_fresnel_factor;break;case "MINNAERT":C=b.darkness;Z=0;break;case "TOON":C=b.diffuse_toon_size;
Z=b.diffuse_toon_smooth;break;default:ka.error("unsupported diffuse shader: "+b.diffuse_shader+' (material "'+b.material_name+'")'),Z=C=0}A.push(ea(G("param_MATERIAL_diffuse"),[C,Z],2));A.push(ea(G("param_MATERIAL_spec"),[b.specular_intensity,N,t],3));n.push(["SHADELESS_MAT",b.use_shadeless?1:0]);N={name:b.name,value:{specular_shader:b.specular_shader,diffuse_shader:b.diffuse_shader,use_shadeless:b.use_shadeless}};n={name:b.name,value:{specular_shader:b.specular_shader,diffuse_shader:b.diffuse_shader,
use_shadeless:b.use_shadeless},material_begin:{name:"material_begin",type:"MATERIAL_BEGIN",inputs:p,outputs:v,params:A,data:N,dirs:n,vparams:[]},material_end:{name:"material_end",type:"MATERIAL_END",inputs:z,outputs:y,params:u,data:N,dirs:r,vparams:[]}};break;case "MATH":switch(b.operation){case "ADD":f="MATH_ADD";break;case "SUBTRACT":f="MATH_SUBTRACT";break;case "MULTIPLY":f="MATH_MULTIPLY";break;case "DIVIDE":f="MATH_DIVIDE";break;case "SINE":f="MATH_SINE";break;case "COSINE":f="MATH_COSINE";break;
case "TANGENT":f="MATH_TANGENT";break;case "ARCSINE":f="MATH_ARCSINE";break;case "ARCCOSINE":f="MATH_ARCCOSINE";break;case "ARCTANGENT":f="MATH_ARCTANGENT";break;case "POWER":f="MATH_POWER";break;case "LOGARITHM":f="MATH_LOGARITHM";break;case "MINIMUM":f="MATH_MINIMUM";break;case "MAXIMUM":f="MATH_MAXIMUM";break;case "ROUND":f="MATH_ROUND";break;case "LESS_THAN":f="MATH_LESS_THAN";break;case "GREATER_THAN":f="MATH_GREATER_THAN";break;case "MODULO":f="MATH_MODULO";break;case "ABSOLUTE":f="MATH_ABSOLUTE";
break;default:return ka.error("Unsupported MATH operation: "+b.operation),null}q.push(["MATH_USE_CLAMP",Number(b.use_clamp)]);k=fa(b);l=da(b);break;case "MIX_RGB":switch(b.blend_type){case "MIX":f="MIX_RGB_MIX";break;case "ADD":f="MIX_RGB_ADD";break;case "MULTIPLY":f="MIX_RGB_MULTIPLY";break;case "SUBTRACT":f="MIX_RGB_SUBTRACT";break;case "SCREEN":f="MIX_RGB_SCREEN";break;case "DIVIDE":f="MIX_RGB_DIVIDE";break;case "DIFFERENCE":f="MIX_RGB_DIFFERENCE";break;case "DARKEN":f="MIX_RGB_DARKEN";break;case "LIGHTEN":f=
"MIX_RGB_LIGHTEN";break;case "OVERLAY":f="MIX_RGB_OVERLAY";break;case "DODGE":f="MIX_RGB_DODGE";break;case "BURN":f="MIX_RGB_BURN";break;case "HUE":f="MIX_RGB_HUE";break;case "SATURATION":f="MIX_RGB_SATURATION";break;case "VALUE":f="MIX_RGB_VALUE";break;case "COLOR":f="MIX_RGB_COLOR";break;case "SOFT_LIGHT":f="MIX_RGB_SOFT_LIGHT";break;case "LINEAR_LIGHT":f="MIX_RGB_LINEAR_LIGHT";break;default:return ka.error("Unsupported MIX_RGB blend type: "+b.blend_type),null}q.push(["MIX_RGB_USE_CLAMP",Number(b.use_clamp)]);
k=fa(b);l=da(b);break;case "OUTPUT":k=fa(b);l=[];break;case "RGB":r=d+"%join%"+b.name;r={name:"-1",value:r};m.push(r);l.push(U(b,"Color"));break;case "SEPRGB":case "SEPHSV":k=fa(b);l=da(b);break;case "TEXTURE":f=I(b);if("TEXTURE_EMPTY"==f)l.push(U(b,"Color")),l.push(U(b,"Normal")),l.push(U(b,"Value"));else if("TEXTURE_ENVIRONMENT"==f)k.push(aa(b,"Vector")),l.push(U(b,"Color")),l.push(U(b,"Value"));else{if("TEXTURE_NORMAL"==f&&"ENVIRONMENT_MAP"==b.texture.type)return ka.error("Wrong output for ENVIRONMENT_MAP texture: "+
b.name),null;for(n=0;4>n;++n)n?(A=w("Vector"+n,"Vector"+n,[0,0,0]),"TEXTURE_COLOR"==f&&(r=w("Color"+n,"Color"+n,[0,0,0]),p=w("Value"+n,"Value"+n,0)),"TEXTURE_NORMAL"==f&&(r=w("Normal"+n,"Normal"+n,[0,0,0]),p=w("Value"+n,"Value"+n,0))):(A=aa(b,"Vector"),"TEXTURE_COLOR"==f&&(r=U(b,"Color"),p=U(b,"Value")),"TEXTURE_NORMAL"==f&&(r=U(b,"Normal"),p=U(b,"Value"))),k.push(A),l.push(r),l.push(p)}p=G("param_TEXTURE_texture");m.push(ea(p));n={name:p,value:b.texture};break;case "VALTORGB":k=fa(b);l=da(b);ka.warn("VALTORGB node is not fully supported.");
break;case "VALUE":f="VALUE";r=d+"%join%"+b.name;r={name:"-1",value:r};m.push(r);l.push(U(b,"Value"));break;case "VECT_MATH":switch(b.operation){case "ADD":f="VECT_MATH_ADD";break;case "SUBTRACT":f="VECT_MATH_SUBTRACT";break;case "AVERAGE":f="VECT_MATH_AVERAGE";break;case "DOT_PRODUCT":f="VECT_MATH_DOT_PRODUCT";break;case "CROSS_PRODUCT":f="VECT_MATH_CROSS_PRODUCT";break;case "NORMALIZE":f="VECT_MATH_NORMALIZE";break;default:return ka.error("Unsupported VECT_MATH operation: "+b.operation),null}k=
fa(b);l=da(b);break;default:k=fa(b),l=da(b)}f={name:h,type:f,vparams:g,inputs:k,outputs:l,params:m,data:n,dirs:q};h=Q.gen_node_id(a);Q.append_node(a,Q.gen_node_id(a),f);if(f="GEOMETRY"==b.type||"TEX_COORD"==b.type)a:{f=b.outputs;for(k=g=0;k<f.length;k++)if(f[k].is_linked&&g++>c){f=!0;break a}f=!1}return f&&null==E(a,b,++c,d,e)?null:h}function M(a,b,c){for(var d=a.inputs,e=a.outputs,h=a.node_tree_name,f=0;f<b.length;f++){var g=d[f],k=b[f];if(!g||g.default_value instanceof Array!=k)return ka.warn('Wrong inputs for custom node group "'+
a.name+'" of type: "',h,'".Processing as general node group.'),!1}for(f=0;f<c.length;f++)if(b=e[f],d=c[f],!b||b.default_value instanceof Array!=d)return ka.warn('Wrong outputs for custom node group "'+a.name+'" of type: "',h,'".Processing as general node group.'),!1;return!0}function J(a,b,c){var d=a.node_group.node_tree,e={},h;for(h in d)if("links"==h||"nodes"==h){e[h]=[];for(var f=0;f<d[h].length;f++){e[h][f]={};for(var g in d[h][f])if("links"==h){e[h][f][g]={};for(var k in d[h][f][g])e[h][f][g][k]=
O(d[h][f][g][k])}else e[h][f][g]=O(d[h][f][g])}}else e[h]=O(d[h]);d=a.node_tree_name;if("B4W_REPLACE"==d||"B4W_LEVELS_OF_QUALITY"==d)h=K("Group input","GROUP_INPUT",[],a.inputs),f=K("Group output","GROUP_OUTPUT",a.outputs,[]),g=null,g="B4W_REPLACE"==d||"B4W_LEVELS_OF_QUALITY"==d&&(Y.quality==ba.P_LOW||Y.force_low_quality_nodes)?{from_node:h,from_socket:h.outputs[1],to_node:f,to_socket:f.inputs[0]}:{from_node:h,from_socket:h.outputs[0],to_node:f,to_socket:f.inputs[0]},e.nodes=[h,f],e.links=[g];d=a.name;
h=e.nodes;f=e.links;for(g=0;g<h.length;g++)h[g].name=S(h[g].type,d,h[g].name);for(g=0;g<f.length;g++)f[g].from_node.name=S(f[g].from_node.type,d,f[g].from_node.name),f[g].to_node.name=S(f[g].to_node.type,d,f[g].to_node.name);return{node_group_graph:t(e,a.node_group.uuid,!0,b,c),node_group_links:e.links}}function O(a){var b=typeof a;return"string"!=b&&"number"!=b&&"boolean"!=b&&a?qa.clone_object_nr(a):a}function G(a){ma[a]||(ma[a]=0);var b=a+ma[a],b=b.replace(/ /g,"_").replace(/\//g,"_");ma[a]++;return b}
function x(a){a=a.outputs;for(var b=0;b<a.length;b++)if(a[b].is_linked)return!0;return!1}function H(a,b){for(var c=a.outputs,d=0,e=0;e<c.length;e++){var h=c[e];if(h.is_linked&&!(d++<b))switch(h.identifier){case "UV":return"GEOMETRY_UV";case "Vertex Color":return"GEOMETRY_VC";case "Normal":return"GEOMETRY_NO";case "Front/Back":return"GEOMETRY_FB";case "View":return"GEOMETRY_VW";case "Global":return"GEOMETRY_GL";case "Local":return"GEOMETRY_LO";case "Orco":return"GEOMETRY_OR";default:return null}}}
function P(a,b){for(var c=a.outputs,d=0,e=0;e<c.length;e++){var h=c[e];if(h.is_linked&&!(d++<b))switch(h.identifier){case "Camera":return"TEX_COORD_CA";case "Generated":return"TEX_COORD_GE";case "Normal":return"TEX_COORD_NO";case "Object":return"TEX_COORD_OB";case "Reflection":return"TEX_COORD_RE";case "UV":return"TEX_COORD_UV";case "Window":return"TEX_COORD_WI";default:return null}}}function I(a){if(!a.texture)return"TEXTURE_EMPTY";for(var b=a.outputs,c=!1,d=!1,e=!1,h=0;h<b.length;h++){var f=b[h];
if(f.is_linked)switch(f.identifier){case "Color":c=!0;break;case "Normal":d=!0;break;case "Value":e=!0;break;default:throw"Unknown texture output";}}if(c)return d&&ka.warn('Node "'+a.name+'" has both Color and Normal outputs. Normal will be omitted'),"ENVIRONMENT_MAP"==a.texture.type?"TEXTURE_ENVIRONMENT":"TEXTURE_COLOR";if(d)return"TEXTURE_NORMAL";if(e)return"ENVIRONMENT_MAP"==a.texture.type?"TEXTURE_ENVIRONMENT":"TEXTURE_COLOR"}function aa(a,b){for(var c=a.inputs,d=0;d<c.length;d++){var e=c[d];
if(e.identifier==b)return T(e)}return null}function U(a,b){for(var c=a.outputs,d=0;d<c.length;d++){var e=c[d];if(e.identifier==b)return T(e)}return null}function T(a){var b=a.name,c=a.identifier,d=a.is_linked;a=a.default_value;a=qa.is_vector(a)?a.slice(0):a;return{name:b,identifier:c,is_linked:d,default_value:a}}function w(a,b,c,d){return{name:a,identifier:b,is_linked:d||!1,default_value:c}}function fa(a){for(var b=[],c=0;c<a.inputs.length;c++){var d=T(a.inputs[c]);d.default_value.length&&d.default_value.splice(3);
b.push(d)}return b}function da(a){for(var b=[],c=0;c<a.outputs.length;c++){var d=T(a.outputs[c]);b.push(d)}return b}function ea(a,b,c){b=null===b||void 0===b?null:xa.glsl_value(b,c);return{name:a,value:b}}function V(a,b,c,d,e,h){var f=[],g=h.from_socket.identifier;h=h.to_socket.identifier;var k=d.outputs;for(d=0;d<k.length;d++)if(k[d].identifier==g){f.push(d);break}e=e.inputs;for(d=0;d<e.length;d++)if(e[d].identifier==h){f.push(d);break}2==f.length&&Q.append_edge(a,b,c,f);return!0}function S(a,b,
c){return"GROUP_INPUT"==a?b+"*GI*"+c:"GROUP_OUTPUT"==a?b+"*GO*"+c:b+"%join%"+c}function X(a){var b=[];Q.traverse(a,function(a,c){"GROUP"==c.type&&b.push(c)});return b}function la(a,b,c){for(var d=0;d<c.length;d++){var e=c[d].data.node_group_graph,h=c[d].data.node_group_links;if(!e)return!1;Q.traverse(e,function(b,c){Q.append_node(a,Q.gen_node_id(a),c)});for(e=0;e<h.length;e++)b.push(h[e]);Z(c[d],b,a)}return!0}function ga(a,b,c,d,e,h){switch(a.type){case "GROUP":a.name==b&&d.push(c);break;case "GROUP_INPUT":a.name.indexOf(b+
"*GI*")||e.push(c);break;case "GROUP_OUTPUT":a.name.indexOf(b+"*GO*")||h.push(c)}}function oa(a,b,c){for(var d=[],e=0;e<c.length;e++){for(var h=c[e],f=null,g=0;g<b.length;g++)if(h.from_socket.identifier==b[g].to_socket.identifier){f=b[g];break}f?(h.from_node=f.from_node,h.from_socket=f.from_socket):d.push(h)}for(e=0;e<b.length;e++)a.splice(a.indexOf(b[e]),1);return d}function na(a,b){if(b.length)for(var c=b[0].from_node.name,d=0;d<a.length;d++)a[d].from_node.name==c&&b.push(a[d])}function N(a,b,c,
d){for(var e=0;e<d.length;e++){for(var f=d[e],g,k=0;k<c.inputs.length;k++)if(f.from_socket.identifier==c.inputs[k].identifier){g=c.inputs[k].default_value;break}for(var k=f,l=b,m=g,n=h(k.to_node,l),q=0;q<n.length;q++)for(var r=Q.get_node_attr(l,n[q]),p=0;p<r.inputs.length;p++){var v=r.inputs[p];if(v.identifier==k.to_socket.identifier){r=v.default_value instanceof Object?0:1;if((m instanceof Object?0:1)==r)v.default_value=m;else switch(r){case 0:v=v.default_value;v[0]=v[1]=v[2]=m;break;case 1:v.default_value=
(m[0]+m[1]+m[2])/3}break}}f=a.indexOf(f);-1!=f&&a.splice(f,1)}}function Z(a,b,c){for(var d=a.name,e=[],h=[],f=[],g=[],k=0;k<b.length;k++){var l=b[k];ga(l.from_node,d,l,e,f,g);ga(l.to_node,d,l,h,f,g)}h=oa(b,h,f);e=oa(b,g,e);na(b,h);N(b,c,a,h);if(e.length){var m;Q.traverse(c,function(a,b){"GROUP_OUTPUT"!=b.type||b.name.indexOf(d+"*GO*")||(m=b)});N(b,c,m,e)}}var ba=p("__config"),Q=p("__graph"),sa=p("__mat3"),ca=p("__mat4"),Ga=p("__objects"),ka=p("__print"),xa=p("__shaders"),ra=p("__scenes"),qa=p("__util"),
ha=p("__vec3"),ma={},R={},L={},Fa=0;new Float32Array(4);var Y=ba.defaults;a.compose_nmat_graph=t;a.create_lighting_graph=function(a,c,e){var h=ra.get_active();a=d(a,"MAIN",h.uuid);if(a in R)return R[a];var h=Q.create(),f={name:"LIGHTING_BEGIN",type:"LIGHTING_BEGIN"},g=E(h,f,0,c,null),f={name:"LIGHTING_END",type:"LIGHTING_END"},f=E(h,f,0,c,null);b(h,e,g,f,[[g,[8,10]],[g,[9,6]]],c);r(h);return R[a]=h};a.compose_node_elements=function(a){var b=[],c={};ma={};var d=Q.topsort(a);Q.traverse(d,function(a,
d){var e;e=[];for(var h=[],f=[],g=[],k=[],l=[],m=0;m<d.inputs.length;m++){var n=d.inputs[m];if(n.is_linked)e.push(null),h.push(null);else{e.push(G("in_"+d.type+"_"+n.identifier));var q=xa.glsl_value(n.default_value,0);Y.shader_constants_hack&&(0<=d.type.indexOf("MIX_RGB_")&&("Color1"==n.identifier||"Color2"==n.identifier||"Fac"==n.identifier)||0<=d.type.indexOf("MATH_")&&("Value"==n.identifier||"Value_001"==n.identifier)||0<=d.type.indexOf("VECT_MATH_")&&"Vector_001"==n.identifier||0<=d.type.indexOf("LIGHTING_APPLY")||
0<=d.type.indexOf("MATERIAL_END")||0<=d.type.indexOf("MATERIAL_BEGIN"))&&(n=q,n=n.replace(/(,)/g,"$1 "),n=n.replace(/(^|[^0-9]|\s)(0\.0)($|[^0-9]|\s)/g,"$1ZERO_VALUE_NODES$3"),n=n.replace(/(^|[^0-9]|\s)(1\.0)($|[^0-9]|\s)/g,"$1UNITY_VALUE_NODES$3"),q=n=n.replace(/\s+/g,""));h.push(q)}}for(m=0;m<d.outputs.length;m++)n=d.outputs[m],n.is_linked?f.push(null):f.push(G("out_"+d.type+"_"+n.identifier));for(m=0;m<d.params.length;m++)n=d.params[m],g.push(n.name),k.push(n.value);for(m=0;m<d.vparams.length;m++)l.push(d.vparams[m].name);
e={id:d.type,inputs:e,input_values:h,outputs:f,params:g,param_values:k,vparams:l,dirs:JSON.parse(JSON.stringify(d.dirs))};b.push(e);c[a]=e});Q.traverse_edges(d,function(a,b,e){var h=Q.get_node_attr(d,a);Q.get_node_attr(d,b);var f=h.outputs[e[0]];a=c[a].outputs;b=c[b].inputs;h=a[e[0]]||G("out_"+h.type+"_"+f.identifier);a[e[0]]=h;b[e[1]]=h});return b};a.check_material_glow_output=function(a){if(a.node_tree)for(var b=0;b<a.node_tree.nodes.length;b++){var c=a.node_tree.nodes[b];if("GROUP"==c.type&&"B4W_GLOW_OUTPUT"==
c.node_tree_name)return!0}return!1};a.cleanup=function(){for(var a in R)delete R[a];for(var b in L)delete L[b];Fa=0}};b4w.module.__animation=function(a,p){function t(a,b){var c=a.anim_slots[b];c&&c.finish_callback&&c.exec_finish_callback&&(c.exec_finish_callback=!1,c.finish_callback(a,b))}function c(a,b,c){c=a.anim_slots[c];c.type=30;var d=b.frame_start,e=b.frame_end-d+1;c.start=d;c.length=e;c.current_frame_float=d;c.animation_name=b.name;for(e=d=0;e<a.vertex_anim.length;e++){var h=a.vertex_anim[e];if(h==b)break;else d+=h.frame_end-h.frame_start+1}c.va_frame_offset=d}function b(a,b,c){for(var d=a.scenes_data,e=0;e<
d.length;e++)for(var h=d[e].batches,f=0;f<h.length;f++){var g=h[f].particles_data;if(g&&g.name==b){var k=a.anim_slots[c];k.type=50;k.animation_name=g.name;k.start=g.frame_start;k.length=g.frame_end-k.start;g.cyclic||(k.length+=g.lifetime_frames)}}}function k(a){return a.replace(/_B4W_BAKED$/,"")}function d(a,b){if(a.animation_data){var c=a.animation_data.action;c&&c._render.type==ka&&b.push(c)}for(var c=a.nodes,e=0;e<c.length;e++){var h=c[e];h.node_group&&(h=h.node_group.node_tree)&&d(h,b)}}function l(a){return aa.is_mesh(a)&&
a.render.vertex_anim?!0:!1}function q(a,b,c){var d=a.anim_slots;if(-1==c)for(c=0;8>c;c++){var e=d[c];e&&(e.current_frame_float=b,g(a,0,c,!0))}else if(e=d[c])e.current_frame_float=b,g(a,0,c,!0)}function r(a,b,c){if(-1==b)for(b=0;8>b;b++){var d=a[b];d&&c(d)}else(d=a[b])&&c(d)}function g(a,b,c,d){F(a,b,c,d);t(a,c);a.render.anim_mixing&&(z(a,b),e(a,b))}function C(a,b,c){var d=b.frame_range;if(d[0]>d[1])return w.warn('Incompatible action "'+b.name+'" has been applied to object "'+a.name+'"'),!1;var e=
b._render,g=a.anim_slots[c];g.animation_name=b.name;g.action_frame_range=d;g.action_step=e.pierce_step;g.action_bflags=e.bflags;g.channels_mask.set(e.channels_mask);g.start=d[0];g.length=d[1]-d[0];g.current_frame_float=d[0];switch(e.type){case sa:if(aa.is_armature(a)){g.type=10;var k=f(a,b);if(!k){for(var k=a.render.bone_pointers,d=[],l=[],m=b._render.num_pierced,q=0;q<m;q++){for(var r in k){var p=k[r],z=p.tsr_basis,u=b._render.bones[r];u?X.copy(u.subarray(8*q,8*q+8),z):X.identity(z);p.tsr_channel_cache_valid=
!1}p=y(k);d.push(p.trans);l.push(p.quats)}k={trans:d,quats:l};a.action_anim_cache.push(b,k)}g.trans=k.trans;g.quats=k.quats;g=k;r=a.render;k=r.skinned_renders;l=a.anim_slots[c];d=l.skinning_data;a:{m=r.skinning_data_cache;for(q=0;q<m.length;q+=2)if(b==m[q]){m=m[q+1];break a}m=null}if(m)l.skinning_data=m;else{for(l=0;l<k.length;l++){for(var m=k[l].bone_skinning_info,q=[],p=[],z=g.trans,u=g.quats,N=0;N<z.length;N++){var x=v(z[N],u[N],m);q.push(x.trans);p.push(x.quats)}d.push({trans:q,quats:p})}r.skinning_data_cache.push(b,
d)}r.anim_mixing&&(b=r.two_last_skeletal_slots,c>b[1]?(g=b[1],b[1]=c,b[0]=g):c>b[0]&&c<b[1]&&(b[0]=c),h(a))}break;case ca:aa.is_speaker(a)&&(g.volume=e.params.volume||null,g.pitch=e.params.pitch||null,g.type=40);break;case xa:aa.is_lamp(a)&&(g.color=e.params.color||null,g.energy=e.params.energy||null,g.type=70);break;case ka:if("MESH"==a.type){g.type=60;r=f(a,b);if(!r){r=[];d=[];l=[];m=[];q=b._render;p=a.render.mats_anim_inds;z=a.render.mats_rgb_anim_inds;for(k in q.params)u=b.name+"%join%"+k,A(k,
u,q,d,r,p),A(k,u,q,m,l,z);r={val_inds:r,values:d,rgb_inds:l,rgbs:m};a.action_anim_cache.push(b,r)}g.node_value_inds=r.val_inds;g.nodemat_values=r.values;g.node_rgb_inds=r.rgb_inds;g.nodemat_rgbs=r.rgbs}break;case Ga:if(r=e.params.tsr){g.type=20;k=f(a,b);if(!k){k=b._render.num_pierced;d=[];l=[];for(m=0;m<k;m++)d.push(r.subarray(8*m,8*m+4)),l.push(r.subarray(8*m+4,8*m+8));k={trans:d,quats:l};a.action_anim_cache.push(b,k)}g.trans=k.trans;g.quats=k.quats;U.obj_has_particles(a)&&U.update_start_pos(a,g.trans[0],
g.quats[0])}else return w.warn('Incompatible action "'+b.name+'" has been applied to object "'+a.name+'"'),!1}aa.is_armature(a)&&e.type!=sa&&n(a,c);return!0}function f(a,b){for(var c=a.action_anim_cache,d=0;d<c.length;d+=2)if(b==c[d])return c[d+1];return null}function h(a){var b=a.render.two_last_skeletal_slots;if(-1!=b[0]&&-1!=b[1]){var c=a.anim_slots;a=c[b[1]].current_frame_float;var d=Math.floor(a),e=a-d,b=c[b[0]];a=b.current_frame_float;d=Math.floor(a);b.current_frame_float=d+e}}function n(a,
b){var c=a.render.two_last_skeletal_slots,d=c[1];c[0]=-1;c[1]=-1;if(-1!=b)for(var e=a.anim_slots;0<=d;d--){var h=e[d];if(h&&10==h.type)if(d>c[1])c[1]=d;else{d>c[0]&&(c[1]=d);break}}}function A(a,b,c,d,e,h){for(var f=0;f<h.length;f+=2)b==h[f]&&(e.push(h[f+1]),d.push(new Float32Array(c.params[a])))}function B(a){a=a._render;for(var b in a.params)if(-1!=b.indexOf("nodes"))return!0;return!1}function F(a,b,c,d){if((c=a.anim_slots[c])&&null!=c.type&&(c.play||d)){var e=a.render,h=c.current_frame_float,f=
c.start,g=c.length,h=h+c.speed*b*V.get_framerate(),k=c.type,l=c.speed;if(0<=l&&h>=f+g||0>l&&h<f)switch(d||(c.exec_finish_callback=!0),c.behavior){case 10:h=0<=l?(h-f)%g+f:f+g-1E-6;break;case 20:h=0<=l?f:f+g-1E-6;c.play=!1;break;case 30:h=0<=l?f+g-1E-6:f,c.play=!1}c.current_frame_float=h;switch(k){case 10:if(!e.anim_mixing){d=D(c);b=d[0];h=d[1];d=d[2];e.quats_before=c.quats[b];e.quats_after=c.quats[h];e.trans_before=c.trans[b];e.trans_after=c.trans[h];e.frame_factor=d;d=e.skinned_renders;c=c.skinning_data;
for(f=0;f<d.length;f++)g=d[f],k=c[f],g.quats_before=k.quats[b],g.quats_after=k.quats[h],g.trans_before=k.trans[b],g.trans_after=k.trans[h],g.frame_factor=e.frame_factor;S.update_transform(a)}break;case 20:d=D(c);var e=qa,h=d[0],f=d[1],g=d[2],k=c.trans,l=k[h][1],m=k[h][2],n=k[f][1],q=k[f][2];e[0]=(1-g)*k[h][0]+g*k[f][0];e[1]=(1-g)*l+g*n;e[2]=(1-g)*m+g*q;h=ma;m=d[0];f=d[1];g=d[2];k=c.quats;l=R;l[0]=k[m][0];l[1]=k[m][1];l[2]=k[m][2];l[3]=k[m][3];m=L;m[0]=k[f][0];m[1]=k[f][1];m[2]=k[f][2];m[3]=k[f][3];
fa.slerp(l,m,g,h);f=d[2];g=c.trans;d=(1-f)*g[d[0]][3]+f*g[d[1]][3];a.parent&&a.pinverse_tsr&&(f=X.create(),X.set_sep(e,d,h,f),X.multiply(a.pinverse_tsr,f,f),e=X.get_trans_view(f),h=X.get_quat_view(f),d=X.get_scale(f));c.trans_smooth_period&&(f=ha,S.get_translation(a,f),la.smooth_v(e,f,b,c.trans_smooth_period,e));c.quat_smooth_period&&(f=R,S.get_rotation(a,f),la.smooth_q(h,f,b,c.quat_smooth_period,h));f=c.channels_mask;f[0]&&S.set_translation_rel(a,e);f[1]&&S.set_rotation_rel(a,h);f[2]&&S.set_scale_rel(a,
d);S.update_transform(a);T.sync_transform(a);break;case 30:d=c.current_frame_float-c.start;0>d&&(d=0);d>=c.length&&(d=c.length);a=Math.floor(d);b=a+1;d-=a;10!=c.behavior&&b==c.length&&(b=--a,d=1);c=c.va_frame_offset;ra[0]=a+c;ra[1]=b+c;ra[2]=d;d=ra;e.va_frame=d[0];e.va_frame_factor=d[2];break;case 40:d=D(c);b=d[0];e=d[1];d=d[2];c.volume&&ea.set_volume(a,(1-d)*c.volume[b]+d*c.volume[e]);c.pitch&&ea.playrate(a,(1-d)*c.pitch[b]+d*c.pitch[e]);break;case 50:b=10==c.behavior?(h-f)/V.get_framerate():h/V.get_framerate();
U.set_time(a,c.animation_name,b);break;case 60:d=D(c);b=d[0];e=d[1];d=d[2];k=c.nodemat_values;l=c.node_value_inds;h=c.nodemat_rgbs;f=c.node_rgb_inds;for(c=0;c<l.length;c++)m=k[c],g=l[c],a.render.mats_values[g]=(1-d)*m[b]+d*m[e];for(c=0;c<f.length;c++)l=h[c],g=f[c],k=l.subarray(3*b,3*b+3),l=l.subarray(3*e,3*e+3),k=ga.lerp(k,l,d,qa),a.render.mats_rgbs[3*g]=k[0],a.render.mats_rgbs[3*g+1]=k[1],a.render.mats_rgbs[3*g+2]=k[2];break;case 70:d=D(c);b=d[0];e=d[1];d=d[2];f=c.channels_mask;(h=c.energy)&&f[0]&&
na.set_light_energy(a.light,(1-d)*h[b]+d*h[e]);(c=c.color)&&f[1]&&(qa[0]=(1-d)*c[3*b]+d*c[3*e],qa[1]=(1-d)*c[3*b+1]+d*c[3*e+1],qa[2]=(1-d)*c[3*b+2]+d*c[3*e+2],na.set_light_color(a.light,qa));b=a.scenes_data;for(c=0;c<b.length;c++)N.update_lamp_scene_color_intensity(a,b[c].scene);break;default:la.panic("Unknown animation type:"+k)}}}function D(a){var b=a.action_frame_range[0],c=a.action_frame_range[1]-b,b=a.current_frame_float-b;0>b&&(b=0);b>=c&&(b=c);b/=a.action_step;c=Math.floor(b);a=a.action_bflags[c]?
b-c:0;b=Math.ceil(c+a);ra[0]=c;ra[1]=b;ra[2]=a;return ra}function e(a,b){var c=a.render,d=c.anim_mix_factor,e=c.two_last_skeletal_slots,h=e[0],e=e[1];if(-1!=e){if(-1!=h){var f=a.anim_slots[h];if(f.play||0==b){var g=D(f),k=g[0],l=g[1];c.frame_factor=g[2];var g=f.quats[k],m=f.quats[l],k=f.trans[k],l=f.trans[l]}else d=1}else d=1;e=a.anim_slots[e];if(e.play||0==b){var h=D(e),n=h[0],q=h[1];c.frame_factor=h[2]}else if(-1!=h&&f.play)d=0;else return;h=e.quats[n];f=e.quats[q];n=e.trans[n];q=e.trans[q];if(1==
d)c.quats_before.set(h),c.quats_after.set(f),c.trans_before.set(n),c.trans_after.set(q);else if(0==d)c.quats_before.set(g),c.quats_after.set(m),c.trans_before.set(k),c.trans_after.set(l);else{for(e=0;e<g.length;e+=4){for(var r=ma,p=R,v=0;4>v;v++)r[v]=g[e+v],p[v]=h[e+v];fa.slerp(r,p,d,r);for(v=0;4>v;v++)c.quats_before[e+v]=r[v];for(v=0;4>v;v++)r[v]=m[e+v],p[v]=f[e+v];fa.slerp(r,p,d,r);for(v=0;4>v;v++)c.quats_after[e+v]=r[v]}la.blend_arrays(k,n,d,c.trans_before);la.blend_arrays(l,q,d,c.trans_after)}S.update_transform(a);
oa.update_skinned_renders(a)}}function z(a,b){var c=a.render,d=c.anim_mix_factor,e=c.anim_mix_factor_change_speed;if(0!=e){var d=c.anim_destination_mix_factor-d,h=e*b;la.sign(d)==la.sign(e)&&Math.abs(h)<Math.abs(d)?c.anim_mix_factor+=h:(c.anim_mix_factor=c.anim_destination_mix_factor,c.anim_mix_factor_change_speed=0)}}function y(a){var b=[],c=[],d=new Float32Array(4),e=new Float32Array(4),h;for(h in a){var f=a[h],g=d,k=e,l=f.chain,m=l[l.length-1],n=m.tsr_channel_cache;m.tsr_channel_cache_valid||X.identity(n);
for(m=l.length-1;0<=m;m--){var q=l[m],r=q.tsr_channel_cache;if(q.tsr_channel_cache_valid)n=r;else{var p=q.tsr_local_rest,v=q.tsr_basis;X.invert(p,Fa);X.multiply(v,Fa,Fa);X.multiply(p,Fa,Fa);X.multiply(n,Fa,r);n=r;q.tsr_channel_cache_valid=!0}}l=q.tsr_channel_cache;g[0]=l[0];g[1]=l[1];g[2]=l[2];g[3]=l[3];k[0]=l[4];k[1]=l[5];k[2]=l[6];k[3]=l[7];fa.normalize(k,k);f=f.bone_index;for(g=0;4>g;g++)k=4*f+g,b[k]=d[g],c[k]=e[g]}return{trans:b,quats:c}}function v(a,b,c){var d=[],e=[];new Float32Array(4);new Float32Array(4);
for(var h in c)for(var f=c[h],g=f.bone_index,f=f.deform_bone_index,k=0;4>k;k++){var l=4*f+k,m=4*g+k;d[l]=a[m];e[l]=b[m]}d=new Float32Array(d);e=new Float32Array(e);return{trans:d,quats:e}}function m(a){var b=a._render;if(b.bones)b.type=sa;else if(b.params)if("volume"in b.params||"pitch"in b.params)b.type=ca;else if(B(a))b.type=ka;else{var c;a:{if(a._render.params){a=a.fcurves;for(c in a)if("color"==c&&!a[c][3]){c=!0;break a}if("energy"==c){c=!0;break a}}c=!1}b.type=c?xa:Ga}else b.type=Q}function B(a){if(a=
a._render.params)for(var b in a)if(-1!=b.indexOf("nodes"))return!0;return!1}function u(a,b){b[0]=b[1]=b[2]=0;for(var c in a)"location"==c?b[0]=1:"rotation_quaternion"==c?b[1]=1:"scale"==c&&(b[2]=1)}function K(a,b){b[0]=b[1]=0;for(var c in a)"energy"==c?b[0]=1:"color"==c&&(b[1]=1)}function E(a,b,c,d,e,h,f){var g=a+(b-a)/2,k=M(g,d,e,h,f)-c;return.02>Math.abs(k)?g:0<k?E(a,g,c,d,e,h,f):E(g,b,c,d,e,h,f)}function M(a,b,c,d,e){var h=1-a;return b*h*h*h+3*c*h*h*a+3*d*h*a*a+e*a*a*a}function J(a,b){var c={type:null,
animation_name:null,action_frame_range:null,action_step:0,action_bflags:null,channels_mask:new Int8Array(3),quats:null,trans:null,skinning_data:[],play:!1,behavior:20,current_frame_float:0,start:0,length:0,trans_smooth_period:0,quat_smooth_period:0,exec_finish_callback:!1,va_frame_offset:null,speed:1,volume:null,pitch:null,color:null,energy:null,nodemat_values:[],node_value_inds:[],nodemat_rgbs:[],node_rgb_inds:[]};if(!a.anim_slots.length)for(var d=0;8>d;d++)a.anim_slots.push(null);a.anim_slots[b]=
c;-1==Y.indexOf(a)&&Y.push(a)}function O(a,b){S.update_transform(a);T.sync_transform(a);g(a,0,b,!0)}function G(a,d,e){e=e||0;if(aa.is_mesh(a)){var h=x(a,d);if(h)return J(a,e),c(a,h,e),O(a,e),!0;if((h=H(a,d))&&"EMITTER"==h.p_type)return J(a,e),b(a,h.name,e),O(a,e),!0}if(h=la.keysearch("name",d,za)||la.keysearch("name",d+"_B4W_BAKED",za)){J(a,e);if(C(a,h,e))return O(a,e),!0;a.anim_slots[e]=null}w.error('Unsupported object: "'+a.name+'" or animation name: "'+d+'"');return!1}function x(a,b){for(var c=
0;c<a.vertex_anim.length;c++){var d=a.vertex_anim[c];if(d.name===b)return d}return null}function H(a,b){for(var c=a.scenes_data,d=0;d<c.length;d++)for(var e=c[d].batches,h=0;h<e.length;h++){var f=e[h].particles_data;if(f&&f.name===b)return f}return null}function P(a){a=a.modifiers;for(var b=0;b<a.length;b++){var c=a[b];if("ARMATURE"==c.type)return c.object}return null}var I=p("__config"),aa=p("__obj_util"),U=p("__particles"),T=p("__physics"),w=p("__print"),fa=p("__quat"),da=p("__reformer"),ea=p("__sfx"),
V=p("__time"),S=p("__transform"),X=p("__tsr"),la=p("__util"),ga=p("__vec3"),oa=p("__armature"),na=p("__lights"),N=p("__scenes"),Z=I.animation,ba=I.defaults;a.LAST_FRAME_EPSILON=1E-6;a.OBJ_ANIM_TYPE_NONE=0;a.OBJ_ANIM_TYPE_ARMATURE=10;a.OBJ_ANIM_TYPE_OBJECT=20;a.OBJ_ANIM_TYPE_VERTEX=30;a.OBJ_ANIM_TYPE_SOUND=40;a.OBJ_ANIM_TYPE_PARTICLES=50;a.OBJ_ANIM_TYPE_MATERIAL=60;a.OBJ_ANIM_TYPE_LIGHT=70;a.SLOT_0=0;a.SLOT_1=1;a.SLOT_2=2;a.SLOT_3=3;a.SLOT_4=4;a.SLOT_5=5;a.SLOT_6=6;a.SLOT_7=7;a.SLOT_ALL=-1;a.AB_CYCLIC=
10;a.AB_FINISH_RESET=20;a.AB_FINISH_STOP=30;var Q=a.AT_NONE=0,sa=a.AT_ARMATURE=1,ca=a.AT_SPEAKER=2,Ga=a.AT_OBJECT=3,ka=a.AT_MATERIAL=4,xa=a.AT_LIGHT=5,ra=Array(3),qa=new Float32Array(3),ha=new Float32Array(3),ma=new Float32Array(4),R=new Float32Array(4),L=new Float32Array(4),Fa=X.create();new Float32Array(16);var Y=[],za=[];a.get_max_bones=function(){return la.trunc((ba.max_vertex_uniform_vectors-50)/4)};a.frame_to_sec=function(a){return a/V.get_framerate()};a.update=function(a){for(var b=0;b<Y.length;b++){for(var c=
Y[b],d=0;8>d;d++)F(c,a,d);c.render.anim_mixing&&(z(c,a),e(c,a))}for(b=0;b<Y.length;b++)for(c=Y[b],d=0;8>d&&c.anim_slots.length;d++)t(c,d)};a.get_all_actions=function(){return za};a.get_anim_names=function(a){var b=[];if(l(a))for(var c=0;c<a.vertex_anim.length;c++)b.push(a.vertex_anim[c].name);for(var d=[],c=0;c<za.length;c++){var e=za[c],h=e._render;h.type==Ga?d.push(e):h.type==sa&&"ARMATURE"==a.type?d.push(e):h.type==ca&&"SPEAKER"==a.type&&d.push(e)}if("MESH"==a.type)for(c=0;c<a.actions.length;c++)e=
a.actions[c],e._render.type==ka&&d.push(e);for(c=0;c<d.length;c++)b.push(k(d[c].name));if(U.obj_has_particles(a)&&U.obj_has_anim_particles(a))for(a=a.scenes_data,c=0;c<a.length;c++)for(d=a[c].batches,e=0;e<d.length;e++)(h=d[e].particles_data)&&b.push(h.name);return b};a.strip_baked_suffix=k;a.get_anim_type=function(a,b){var c=a.anim_slots[b];return c?c.type:0};a.apply_def=function(a){for(var d=0,e=a.scenes_data,h=0;h<e.length;h++)for(var f=e[h].batches,g=0;g<f.length;g++){var k=f[g].particles_data;
k&&"EMITTER"==k.p_type&&(J(a,d),b(a,k.name,d),O(a,d),a.anim_slots[d].behavior=k.cyclic?10:a.anim_behavior_def,d++)}e=a.actions.slice();for(h=0;h<e.length;h++)f=e[h],J(a,d),C(a,f,d)?(O(a,d),a.anim_slots[d].behavior=a.anim_behavior_def,d++):a.anim_slots[d]=null;l(a)&&(J(a,d),c(a,a.vertex_anim[0],d),O(a,d),a.anim_slots[d].behavior=a.anim_behavior_def)};a.anim_behavior_bpy_b4w=function(a){switch(a){case "CYCLIC":return 10;case "FINISH_RESET":return 20;case "FINISH_STOP":return 30;default:la.panic("Wrong animation behavior")}};
a.get_bpy_material_actions=function(a){var b=[];a=a.data.materials;for(var c=0;c<a.length;c++){var e=a[c].node_tree;e&&d(e,b)}return b};a.play=function(a,b,c){r(a.anim_slots,c,function(a){a.play=!0;a.finish_callback=b?b:null;a.exec_finish_callback=!1});a.render.anim_mixing&&h(a)};a.stop=function(a,b){r(a.anim_slots,b,function(a){a.play=!1;a.finish_callback=null;a.exec_finish_callback=!1})};a.is_play=function(a,b){var c=a.anim_slots;if(-1==b)for(var d=0;8>d;d++){if(c[d]&&c[d].play)return!0}else if(c=
c[b])return c.play;return!1};a.set_frame=q;a.set_first_frame=function(a,b){b=b||0;r(a.anim_slots,b,function(c){q(a,c.start,b)})};a.get_current_frame_float=function(a,b){var c=a.anim_slots[b];return c&&c.current_frame_float?c.current_frame_float:0};a.is_cyclic=function(a,b){var c=a.anim_slots[b];return c&&10==c.behavior};a.set_behavior=function(a,b,c){r(a.anim_slots,c,function(a){a.behavior=b})};a.get_behavior=function(a,b){var c=a.anim_slots[b];return c&&c.behavior};a.apply_smoothing=function(a,b,
c,d){r(a.anim_slots,d,function(a){a.trans_smooth_period=b||0;a.quat_smooth_period=c||0})};a.remove_slot_animation=function(a,b){if(-1==b)for(var c=0;8>c;c++)a.anim_slots[c]=null;else a.anim_slots[b]=null;a.render.anim_mixing&&n(a,b)};a.update_object_animation=g;a.obj_is_animatable=function(a){if("ARMATURE"==a.type||a.armobj)return!0;for(var b=0;b<a.actions.length;b++){var c=a.actions[b]._render.type;if(c==Ga||c==sa||c==ca&&"SPEAKER"==a.type||c==xa&&"LAMP"==a.type||c==ka&&"MESH"==a.type)return!0}return U.obj_has_particles(a)&&
U.obj_has_anim_particles(a)||"MESH"==a.type&&a.vertex_anim.length?!0:!1};a.bpy_obj_is_animatable=function(a,b){if("ARMATURE"==b.type||P(a))return!0;for(var c=0;c<b.actions.length;c++){var d=b.actions[c]._render.type;if(d==Ga||d==sa||d==ca&&"SPEAKER"==b.type||d==ka&&"MESH"==b.type)return!0}return U.bpy_obj_has_particles(a)&&U.bpy_obj_has_anim_particles(a)||"MESH"==b.type&&a.data.b4w_vertex_anim.length?!0:!1};a.is_animated=function(a){return Boolean(a.anim_slots.length)};a.calc_pose_data=y;a.extract_skinned_pose_data=
v;a.append_action=function(a){var b=new RegExp(/pose.bones\[\".+\"\]/g),c=X.create(),d=function(a,d,e,h,f){if(-1<e.search(b)){a=d;e=e.split('"')[1];var g=c}else 8==f?(e="tsr",g=c):g=1<f?new Float32Array(f):0;if(!a[e]){f=a;d=e;if("object"==typeof g&&g.length)for(var k=g.length,l=new Float32Array(h*k),m=0;m<h;m++)for(var n=0;n<k;n++)l[m*k+n]=g[n];else if("number"==typeof g)for(l=new Float32Array(h),m=0;m<h;m++)l[m]=g;else la.panic("Wrong storage default value");f[d]=l}return a[e]},e=function(a,b){if(-1<
a.indexOf("location"))var c=0,d=b;else-1<a.indexOf("rotation_quaternion")?(c=4,d=0==b?3:b-1):-1<a.indexOf("scale")?(c=3,d=0):(c=0,d=b);return c+d},h=function(a,b){for(var c=0;c<b;c++){var d=a.subarray(8*c+4,8*c+8);fa.normalize(d,d)}},f=a._render={type:Q,num_pierced:0,pierce_step:0,params:null,bones:null,bflags:null,channels_mask:new Int8Array(3)};f.pierce_step=1/Z.frame_steps;var g=a.fcurves,k={},l={},n=0,q;for(q in g){var r=g[q],p;for(p in r){var v=r[p],z=v._pierced_points;da.check_anim_fcurve_completeness(v,
a);v=v.num_channels;n||(n=z.length);for(var v=d(k,l,q,n,v),y=v.length/n,A=e(q,p|0),N=0;N<n;N++)v[N*y+A]=z[N]}}if(la.get_dict_length(k)){for(var x in k)"tsr"==x&&h(k[x],n);f.params=k}if(la.get_dict_length(l)){for(var t in l)h(l[t],n);f.bones=l}f.num_pierced=n;f.bflags=a._bflags;"tsr"in k&&u(g,f.channels_mask);("color"in k||"energy"in k)&&K(g,f.channels_mask);m(a);za.push(a)};a.get_approx_curve_length=function(a,b){return(b-a)*Z.frame_steps+1};a.approximate_curve=function(a,b,c,d,e,h){var f,g,k=new Float32Array(2),
l=new Float32Array(2),m=new Float32Array(2),n=new Float32Array(2),q=b[1],r=b[2],p=b[a.last_frame_offset+1];a=b[a.last_frame_offset+2];for(var v=0,z=0,y=null;e<=h;e++)if(e<q)for(var u=0;u<Z.frame_steps;u++)c[v++]=r;else if(e>p)for(u=0;u<Z.frame_steps;u++)c[v++]=a;else{var A=b[z],N=3;0===A&&(N+=2);0===y&&(N+=2);var x=2===A?0:1;if(b[z+1]==b[z+N+1])y=A,z+=N;else{u=0;e==b[z+1]&&(x&&(d[v]=1),c[v]=b[z+2],v++,u++);if(e==p)for(;u<Z.frame_steps;u++)c[v++]=a;else for(k[0]=b[z+1],k[1]=b[z+2],0!==A?(l[0]=0,l[1]=
0):0===y?(l[0]=b[z+5],l[1]=b[z+6]):(l[0]=b[z+3],l[1]=b[z+4]),0!==A?(m[0]=0,m[1]=0):(m[0]=b[z+N+3],m[1]=b[z+N+4]),n[0]=b[z+N+1],n[1]=b[z+N+2];u<Z.frame_steps;u++){var t=e+u/Z.frame_steps;switch(A){case 0:f=k;g=l;var C=m,w=n,I=[],J=[],B=void 0,ba=void 0,G=void 0,B=void 0;I[0]=f[0]-g[0];I[1]=f[1]-g[1];J[0]=w[0]-C[0];J[1]=w[1]-C[1];G=w[0]-f[0];B=Math.abs(I[0]);ba=Math.abs(J[0]);0!=B+ba&&B+ba>G&&(B=G/(B+ba),g[0]=f[0]-B*I[0],g[1]=f[1]-B*I[1],C[0]=w[0]-B*J[0],C[1]=w[1]-B*J[1]);x&&(d[v]=1);f=v;g=k;C=l;w=
m;I=n;t=E(0,1,t,g[0],C[0],w[0],I[0]);t=M(t,g[1],C[1],w[1],I[1]);c[f]=t;v++;break;case 1:g=k[0];C=k[1];f=w=(n[1]-C)/(n[0]-g);g=C-w*g;x&&(d[v]=1);c[v]=f*t+g;v++;break;case 2:x&&(d[v]=1);c[v]=b[z+2];v++;break;default:la.panic("Unknown keyframe interpolation mode: "+A)}}e+1==b[z+N+1]&&(y=A,z+=N)}}};a.apply=G;a.apply_by_uuid=function(a,b,c){c=c||0;var d=la.keysearch("uuid",b,za);if(d){J(a,c);if(C(a,d,c))return O(a,c),!0;a.anim_slots[c]=null}w.error('Unsupported object: "'+a.name+'" or animation uuid: "'+
b+'"');return!1};a.validate_action_by_name=function(a,b){var c=la.keysearch("name",b,za)||la.keysearch("name",b+"_B4W_BAKED",za);if(c){if(c._render.type==Q)return!1}else if(!(H(a,b)||aa.is_mesh(a)&&x(a,b)))return!1;return!0};a.get_slot_num_by_anim=function(a,b){for(var c=a.anim_slots,d=0;d<c.length;d++){var e=c[d];if(e&&k(e.animation_name)==k(b))return d}return-1};a.get_anim_by_slot_num=function(a,b){var c=a.anim_slots[b];return c&&c.animation_name?k(c.animation_name):null};a.remove=function(a){a.anim_slots.length=
0;a=Y.indexOf(a);-1!=a&&Y.splice(a,1)};a.remove_actions=function(a){for(var b=za.length-1;0<=b;b--)za[b]._data_id==a&&za.splice(b,1)};a.apply_to_first_empty_slot=function(a,b){if(!a.anim_slots.length)return G(a,b,0)?0:-1;for(var c=0;c<a.anim_slots.length;c++)if(!a.anim_slots[c])return G(a,b,c)?c:-1};a.set_skel_mix_factor=function(a,b,c){a.render.anim_mix_factor_change_speed=(b-a.render.anim_mix_factor)/c;a.render.anim_destination_mix_factor=b};a.set_speed=function(a,b,c){r(a.anim_slots,c,function(a){a.speed=
b})};a.get_speed=function(a,b){return a.anim_slots[b].speed};a.get_anim_start_frame=function(a,b){return a.anim_slots[b].start};a.get_anim_length=function(a,b){return a.anim_slots[b].length};a.cleanup=function(){Y.length=0;za.length=0};a.fcurve_replace_euler_by_quat=function(a){var b=(a[0]||a[1]||a[2])._pierced_points.length,c=ma,d=qa,e=Boolean(a[0]);e||(a[0]={_pierced_points:new Float32Array(b),num_channels:8});var h=Boolean(a[1]);h||(a[1]={_pierced_points:new Float32Array(b),num_channels:8});var f=
Boolean(a[2]);f||(a[2]={_pierced_points:new Float32Array(b),num_channels:8});a[3]={_pierced_points:new Float32Array(b),num_channels:8};for(var g=0;g<b;g++)d[0]=e?a[0]._pierced_points[g]:0,d[1]=h?a[1]._pierced_points[g]:0,d[2]=f?a[2]._pierced_points[g]:0,la.euler_to_quat(d,c),a[0]._pierced_points[g]=c[3],a[1]._pierced_points[g]=c[0],a[2]._pierced_points[g]=c[1],a[3]._pierced_points[g]=c[2]};a.get_bpy_armobj=P};b4w.module.__time=function(a,p){var t=p("__config");p("__print");p("__util");var c=0,b=0,k=[],d=0,l=0,q=[],r=-1;a.set_timeline=function(a){c=a;b=performance.now();for(a=0;a<k.length;a++){var d=k[a];c>d.expire_time&&(k.splice(a,1),a--,d.callback())}for(a=0;a<q.length;a++){var d=q[a],f=1-(d.expire_time-c)/d.duration,f=Math.min(f,1);d.callback(d.from+f*(d.to-d.from));1==f&&(q.splice(a,1),a--)}};a.get_timeline=function(){return c};a.set_timeout=function(a,l){var f;d++;f=d;var h={id:f,callback:a,expire_time:c+
(performance.now()-b+l)/1E3};k.push(h);return f};a.clear_timeout=function(a){for(var b=0;b<k.length;b++)if(k[b].id==a){k.splice(b,1);break}};a.clear_animation=function(a){for(var b=q.length;b--;)if(q[b].id==a){q.splice(b,1);break}};a.animate=function(a,b,d,h){d/=1E3;var k;l++;k=l;q.push({id:k,callback:h,from:a,to:b,expire_time:c+d,duration:d});h(a);return k};a.reset=function(a){b=c=0;k.length=0;l=d=q.length=0};a.get_framerate=function(){return-1!==t.animation.framerate?t.animation.framerate:r};a.set_framerate=
function(a){r=a}};b4w.module.__transform=function(a,p){function t(a,b){if(g.has_child_of(a)){var c=g.get_child_of_offset(a);A.set_trans(b,c)}else A.set_trans(b,a.render.world_tsr)}function c(a,b){var c=a.render;if(g.has_child_of(a)){A.set_quat(b,c.world_tsr);var d=g.get_child_of_parent_tsr(a),d=A.invert(d,m),e=g.get_child_of_offset(a);A.multiply(d,c.world_tsr,e)}else A.set_quat(b,c.world_tsr)}function b(a,b){if(g.has_child_of(a)){var c=g.get_child_of_offset(a);A.set_quat(b,c)}else A.set_quat(b,a.render.world_tsr)}
function k(a,b){if(g.has_child_of(a)){var c=g.get_child_of_offset(a);A.copy(b,c)}else A.copy(b,a.render.world_tsr)}function d(a,b){if(g.has_child_of(a)){var c=g.get_child_of_offset(a);A.copy(c,b)}else A.copy(a.render.world_tsr,b);return b}function l(a){var b=a.render,c=a.scenes_data,d=a.type;"CAMERA"==d&&r.update_camera_upside_down(a);g.update_constraint(a,K);"CAMERA"==d&&r.update_camera(a);var e=A.get_trans_value(b.world_tsr,y),k=A.get_quat_value(b.world_tsr,v);b.bb_local&&b.bb_world&&(q.bounding_box_transform(b.bb_local,
b.world_tsr,b.bb_world),q.bounding_sphere_transform(b.bs_local,b.world_tsr,b.bs_world),q.bounding_ellipsoid_transform(b.be_local,b.world_tsr,b.be_world));switch(d){case "SPEAKER":n.speaker_update_transform(a,K);break;case "MESH":var p=a.armobj;p&&(A.invert(p.render.world_tsr,m),A.multiply(m,b.world_tsr,m),z.set(m[0],m[1],m[2],m[3],b.arm_rel_trans),f.set(m[4],m[5],m[6],m[7],b.arm_rel_quat));break;case "CAMERA":r.update_camera_transform(a);if(h.check_active()){var u=h.get_active();h.get_camera(u)==
a&&n.listener_update_transform(u,e,k,K)}break;case "LAMP":C.update_light_transform(a)}for(u=0;u<c.length;u++){var t=c[u];if(t.is_active){var p=t.scene,aa=p._render;switch(d){case "LAMP":h.update_lamp_scene(a,p);break;case "CAMERA":h.schedule_grass_map_update(p);aa.shadow_params&&(aa.shadow_params.enable_csm&&h.schedule_shadow_update(p),h.update_shadow_billboard_view(a,aa.graph));break;case "MESH":b.bb_local&&b.bb_world&&(b.shadow_cast&&h.schedule_shadow_update(p),aa=t.cube_refl_subs,null!=b.cube_reflection_id&&
aa&&h.update_cube_reflect_subs(aa,e));break;case "EMPTY":B.update_force(a)}t=t.plane_refl_subs;aa=a.reflective_objs;if(aa.length)for(var U=0;U<t.length;U++){var T=t[U].camera;h.update_plane_reflect_subs(t[U],e,k);F.update_refl_objects(aa,T.reflection_plane);r.set_view(T,h.get_camera(p));D.extract_frustum_planes(T.view_proj_matrix,T.frustum_planes)}}}c=a.cons_descends;for(u=0;u<c.length;u++)l(c[u]);a=a.cons_armat_bone_descends;for(u=0;u<a.length;u++)c=a[u],p=c[0],g.update_bone_constraint(p,c[1]);b.force_zsort=
!0}var q=p("__boundings"),r=p("__camera"),g=p("__constraints"),C=p("__lights");p("__mat3");p("__mat4");p("__particles");var f=p("__quat"),h=p("__scenes"),n=p("__sfx"),A=p("__tsr"),B=p("__objects"),F=p("__obj_util"),D=p("__util"),e=p("__vec3"),z=p("__vec4"),y=new Float32Array(3),v=new Float32Array(4);new Float32Array(9);var m=A.create(),u=A.create(),K=0;a.SPACE_WORLD=0;a.SPACE_LOCAL=1;a.update=function(a){K=a};a.set_translation=function(a,b){var c=a.render;if(g.has_child_of(a)){A.set_trans(b,c.world_tsr);
var d=g.get_child_of_parent_tsr(a),d=A.invert(d,m),e=g.get_child_of_offset(a);A.multiply(d,c.world_tsr,e)}else A.set_trans(b,c.world_tsr)};a.set_translation_rel=t;a.get_translation=function(a,b){var c=A.get_trans_view(a.render.world_tsr);e.copy(c,b);return b};a.get_translation_rel=function(a,b){if(g.has_child_of(a)){var c=g.get_child_of_offset(a);e.copy(A.get_trans_view(c),b)}else c=A.get_trans_view(a.render.world_tsr),e.copy(c,b);return b};a.set_rotation=c;a.set_rotation_rel=b;a.get_rotation=function(a,
b){var c=A.get_quat_view(a.render.world_tsr);f.copy(c,b);return b};a.get_rotation_rel=function(a,b){if(g.has_child_of(a)){var c=g.get_child_of_offset(a);f.copy(A.get_quat_view(c),b)}else c=A.get_quat_view(a.render.world_tsr),f.copy(c,b);return b};a.set_rotation_euler=function(a,b){var d=D.euler_to_quat(b,v);c(a,d)};a.set_rotation_euler_rel=function(a,c){var d=D.euler_to_quat(c,v);b(a,d)};a.set_scale=function(a,b){var c=a.render;if(g.has_child_of(a)){var c=g.get_child_of_offset(a),d=A.get_scale(g.get_child_of_parent_tsr(a));
A.set_scale(b/d,c)}else A.set_scale(b,c.world_tsr)};a.set_scale_rel=function(a,b){var c=a.render;g.has_child_of(a)?(c=g.get_child_of_offset(a),A.set_scale(b,c)):A.set_scale(b,c.world_tsr)};a.get_scale=function(a){return A.get_scale(a.render.world_tsr)};a.get_scale_rel=function(a){return g.has_child_of(a)?(a=g.get_child_of_offset(a),A.get_scale(a)):A.get_scale(a.render.world_tsr)};a.set_tsr=function(a,b){A.copy(b,a.render.world_tsr);if(g.has_child_of(a)){var c=g.get_child_of_parent_tsr(a),c=A.invert(c,
m),d=g.get_child_of_offset(a);A.multiply(c,a.render.world_tsr,d)}};a.set_tsr_rel=k;a.get_tsr=function(a,b){return A.copy(a.render.world_tsr,b)};a.get_tsr_rel=d;a.get_object_size=function(a){var b=a.render;a=b.bb_original;var c=A.get_scale(b.world_tsr),b=c*(a.max_x-a.min_x),d=c*(a.max_y-a.min_y);a=c*(a.max_z-a.min_z);return.5*Math.sqrt(b*b+d*d+a*a)};a.get_object_center=function(a,b,c){c||(c=new Float32Array(3));b?(a=a.render,e.copy(a.bs_world.center,c)):(a=a.render,b=a.bb_original,c[0]=(b.max_x+b.min_x)/
2,c[1]=(b.max_y+b.min_y)/2,c[2]=(b.max_z+b.min_z)/2,A.transform_vec3(c,a.world_tsr,c));return c};a.move_local=function(a,b,c,e){var h=d(a,m),f=y;f[0]=b;f[1]=c;f[2]=e;A.transform_vec3(f,h,f);t(a,f)};a.rotate_local=function(a,b){var c=d(a,m),e=A.set_quat(b,A.identity(u));A.multiply(c,e,e);k(a,e)};a.update_transform=l;a.distance=function(a,b){var c=A.get_trans_view(a.render.world_tsr),d=A.get_trans_view(b.render.world_tsr);return e.dist(c,d)};a.obj_point_distance=function(a,b){var c=A.get_trans_view(a.render.world_tsr);
return e.dist(c,b)};a.get_object_bounding_box=function(a){return{max_x:a.render.bb_world.max_x,min_x:a.render.bb_world.min_x,max_y:a.render.bb_world.max_y,min_y:a.render.bb_world.min_y,max_z:a.render.bb_world.max_z,min_z:a.render.bb_world.min_z}}};b4w.module.__tsr=function(a,p){function t(){var a=new Float32Array(8);a[3]=1;a[7]=1;return a}function c(){var a=new Float32Array(9);a[3]=1;a[7]=1;return a}function b(a,b,c,d){d[0]=a[0];d[1]=a[1];d[2]=a[2];d[3]=b;d[4]=c[0];d[5]=c[1];d[6]=c[2];d[7]=c[3];return d}function k(a,b,c){var d=b[0],f=b[1],g=b[2],e=b[3],k=b[4],l=b[5],q=b[6];b=b[7];var m=a[0]*e,r=a[1]*e,p=a[2]*e;a=b*m+l*p-q*r;var e=b*r+q*m-k*p,t=b*p+k*r-l*m,m=-k*m-l*r-q*p;c[0]=a*b+m*-k+e*-q-t*-l;c[1]=e*b+m*-l+t*-k-a*-q;c[2]=t*b+m*-q+a*-l-e*-k;
c[0]+=d;c[1]+=f;c[2]+=g;return c}p("__mat3");var d=p("__mat4"),l=p("__quat"),q=p("__util"),r=p("__vec3"),g=new Float32Array(3),C=new Float32Array(4),f=new Float32Array(16);a.create=t;a.from_values=function(a,b,c,d,f,g,e,k){var l=t();l[0]=a;l[1]=b;l[2]=c;l[3]=d;l[4]=f;l[5]=g;l[6]=e;l[7]=k;return l};a.create_ext=c;a.from_values_ext=function(a,b,d,f,g,k,e,l){var q=c();q[0]=a;q[1]=b;q[2]=d;q[3]=f;q[4]=g;q[5]=k;q[6]=e;q[7]=l;return q};a.copy=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];
b[5]=a[5];b[6]=a[6];b[7]=a[7];return b};a.identity=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;a[4]=0;a[5]=0;a[6]=0;a[7]=1;return a};a.set_sep=b;a.set_trans=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];return b};a.set_scale=function(a,b){b[3]=a;return b};a.set_transcale=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b};a.set_quat=function(a,b){b[4]=a[0];b[5]=a[1];b[6]=a[2];b[7]=a[3];return b};a.get_trans_view=function(a){return a.subarray(0,3)};a.get_trans_value=function(a,b){b[0]=a[0];b[1]=
a[1];b[2]=a[2];return b};a.get_scale=function(a){return a[3]};a.get_quat_view=function(a){return a.subarray(4,8)};a.get_quat_value=function(a,b){b[0]=a[4];b[1]=a[5];b[2]=a[6];b[3]=a[7];return b};a.invert=function(a,b){var c=1/a[3];if(!c)return null;var d=a[0],f=a[1],g=a[2];C[0]=a[4];C[1]=a[5];C[2]=a[6];C[3]=a[7];l.invert(C,C);var e=C[0],k=C[1],q=C[2],r=C[3],d=d*c,f=f*c,m=g*c,g=r*d+k*m-q*f,p=r*f+q*d-e*m,t=r*m+e*f-k*d,d=-e*d-k*f-q*m;b[0]=-(g*r+d*-e+p*-q-t*-k);b[1]=-(p*r+d*-k+t*-e-g*-q);b[2]=-(t*r+d*
-q+g*-k-p*-e);b[3]=c;b[4]=e;b[5]=k;b[6]=q;b[7]=r;return b};a.to_mat4=function(a,b){var c=a.subarray(0,3),f=a[3],g=a.subarray(4,8);d.fromRotationTranslation(g,c,b);for(c=0;12>c;c++)b[c]*=f;return b};a.from_mat4=function(a,c){var d=q.matrix_to_trans(a,g),f=q.matrix_to_scale(a),k=q.matrix_to_quat(a,C);b(d,f,k,c);return c};a.multiply=function(a,b,c){k(b,a,c);c[3]=a[3]*b[3];var d=a[4],f=a[5],g=a[6];a=a[7];var e=b[4],l=b[5],q=b[6];b=b[7];c[4]=d*b+a*e+f*q-g*l;c[5]=f*b+a*l+g*e-d*q;c[6]=g*b+a*q+d*l-f*e;c[7]=
a*b-d*e-f*l-g*q;return c};a.transform_mat4=function(a,b,c){var g=b.subarray(0,3),k=b[3];b=b.subarray(4,8);g=d.fromRotationTranslation(b,g,f);for(b=0;12>b;b++)g[b]*=k;d.multiply(g,a,c);return c};a.transform_vec3=k;a.transform_vec3_inv=function(a,b,c){var d=b[3],f=a[0]-b[0],g=a[1]-b[1],e=a[2]-b[2];a=b[4];var k=b[5],l=b[6];b=b[7];var q=a*a+k*k+l*l+b*b,q=q?1/q:0;a=-a*q;k=-k*q;l=-l*q;b*=q;var q=b*f+k*e-l*g,m=b*g+l*f-a*e,r=b*e+a*g-k*f,f=-a*f-k*g-l*e;c[0]=q*b+f*-a+m*-l-r*-k;c[1]=m*b+f*-k+r*-a-q*-l;c[2]=
r*b+f*-l+q*-k-m*-a;c[0]/=d;c[1]/=d;c[2]/=d;return c};a.transform_vectors=function(a,b,c,d){d||(d=0);var f=a.length,g=b[0],e=b[1],k=b[2],l=b[3],q=b[4],m=b[5],r=b[6];b=b[7];for(var p=0;p<f;p+=3){var t=a[p]*l,C=a[p+1]*l,J=a[p+2]*l,O=b*t+m*J-r*C,G=b*C+r*t-q*J,x=b*J+q*C-m*t,t=-q*t-m*C-r*J;c[d+p]=O*b+t*-q+G*-r-x*-m;c[d+p+1]=G*b+t*-m+x*-q-O*-r;c[d+p+2]=x*b+t*-r+O*-m-G*-q;c[d+p]+=g;c[d+p+1]+=e;c[d+p+2]+=k}return c};a.transform_dir_vectors=function(a,b,c,d){d||(d=0);var f=a.length,g=b[3],e=b[4],k=b[5],l=b[6];
b=b[7];for(var q=0;q<f;q+=3){var m=a[q]*g,r=a[q+1]*g,p=a[q+2]*g,t=b*m+k*p-l*r,C=b*r+l*m-e*p,J=b*p+e*r-k*m,m=-e*m-k*r-l*p;c[d+q]=t*b+m*-e+C*-l-J*-k;c[d+q+1]=C*b+m*-k+J*-e-t*-l;c[d+q+2]=J*b+m*-l+t*-k-C*-e}return c};a.transform_dir_vec3=function(a,b,c){var d=b[3],f=b[4],g=b[5],e=b[6];b=b[7];var k=a[0]*d,l=a[1]*d,q=a[2]*d;a=b*k+g*q-e*l;var d=b*l+e*k-f*q,m=b*q+f*l-g*k,k=-f*k-g*l-e*q;c[0]=a*b+k*-f+d*-e-m*-g;c[1]=d*b+k*-g+m*-f-a*-e;c[2]=m*b+k*-e+a*-g-d*-f;return c};a.transform_tangents=function(a,b,c,d){d||
(d=0);var f=a.length,g=b[3],e=b[4],k=b[5],l=b[6];b=b[7];for(var q=0;q<f;q+=4){var m=a[q]*g,r=a[q+1]*g,p=a[q+2]*g,t=b*m+k*p-l*r,C=b*r+l*m-e*p,J=b*p+e*r-k*m,m=-e*m-k*r-l*p;c[d+q]=t*b+m*-e+C*-l-J*-k;c[d+q+1]=C*b+m*-k+J*-e-t*-l;c[d+q+2]=J*b+m*-l+t*-k-C*-e;c[d+q+3]=a[q+3]}return c};a.translate=function(a,b,c){var d=a[3],f=a[4],g=a[5],e=a[6],k=a[7],l=b[0]*d,q=b[1]*d,m=b[2]*d;b=k*l+g*m-e*q;var d=k*q+e*l-f*m,r=k*m+f*q-g*l,l=-f*l-g*q-e*m;c[0]=a[0]+b*k+l*-f+d*-e-r*-g;c[1]=a[1]+d*k+l*-g+r*-f-b*-e;c[2]=a[2]+
r*k+l*-e+b*-g-d*-f;c[3]=a[3];c[4]=a[4];c[5]=a[5];c[6]=a[6];c[7]=a[7];return c};a.interpolate=function(a,b,c,d){var f=a.subarray(0,3),g=b.subarray(0,3),e=d.subarray(0,3);r.lerp(f,g,c,e);f=a[3];d[3]=f+c*(b[3]-f);a=a.subarray(4,8);b=b.subarray(4,8);f=d.subarray(4,8);l.slerp(a,b,c,f);return d};a.extrapolate=function(a,b,c,d){var f=a.subarray(0,3),g=b.subarray(0,3),e=d.subarray(0,3);e[0]=g[0]*(c+1)-f[0]*c;e[1]=g[1]*(c+1)-f[1]*c;e[2]=g[2]*(c+1)-f[2]*c;d[3]=b[3]*(c+1)-a[3]*c;a=a.subarray(4,8);b=b.subarray(4,
8);f=d.subarray(4,8);f[0]=b[0]*(c+1)-a[0]*c;f[1]=b[1]*(c+1)-a[1]*c;f[2]=b[2]*(c+1)-a[2]*c;f[3]=b[3]*(c+1)-a[3]*c;l.normalize(f,f);return d};a.integrate=function(a,b,c,d,f){f[0]=a[0]+b*c[0];f[1]=a[1]+b*c[1];f[2]=a[2]+b*c[2];f[3]=a[3];c=d[0];var g=d[1];d=d[2];var e=a[4],k=a[5],l=a[6],q=a[7];f[4]=.5*(c*q+g*l-d*k);f[5]=.5*(g*q+d*e-c*l);f[6]=.5*(d*q+c*k-g*e);f[7]=.5*(-c*e-g*k-d*l);f[4]=a[4]+f[4]*b;f[5]=a[5]+f[5]*b;f[6]=a[6]+f[6]*b;f[7]=a[7]+f[7]*b;a=f[4];b=f[5];c=f[6];g=f[7];a=a*a+b*b+c*c+g*g;0<a&&(a=
1/Math.sqrt(a),f[4]*=a,f[5]*=a,f[6]*=a,f[7]*=a)}};b4w.module.__util=function(a,p){function t(a){return 0<a?1:0>a?-1:0}function c(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=Math.sqrt(b*b+c*c+d*d),f=1/f;a[0]=b*f;a[1]=c*f;a[2]=d*f;a[3]=e*f}function b(a,b){return b[0]*a[0]+b[1]*a[1]+b[2]*a[2]+b[3]}function k(a,b){var c=b;switch(typeof a){case "number":return d(a,c);case "string":return l(a,c);case "boolean":return d(a|0,c);case "function":case "undefined":return d(0,c);case "object":if(a){var e=a instanceof Array;if(a.buffer instanceof ArrayBuffer&&"undefined"!==
a.byteLength)for(e=0;e<a.length;e++)c=d(a[e],c);else if(e)for(e=0;e<a.length;e++)c=k(a[e],c);else for(var f in a)c=k(a[f],c)}else c=d(0,c)}return c}function d(a,b){var c=b;I[0]=a;c=(c<<5)-c+aa[0];c&=c;c=(c<<5)-c+aa[1];return c&c}function l(a,b){for(var c=b,d=0;d<a.length;d++)var e=a.charCodeAt(d),c=(c<<5)-c+e,c=c&c;return c}function q(a){return(34*a+1)*a%289}function r(a){return a-Math.floor(a)}function g(a){return C((34*a+5)*a)}function C(a){return a-289*Math.floor(a/289)}function f(a){return a-
7*Math.floor(a/7)}function h(a,b,c){a-=b;c-=b;return b+(a-Math.floor(a/c)*c)}function n(a){return h(a,0,2*Math.PI)}function A(a,b){if(a&&b){var c=a instanceof Array,d=a.buffer instanceof ArrayBuffer&&"undefined"!==a.byteLength,e=b.buffer instanceof ArrayBuffer&&"undefined"!==b.byteLength;if(c!=b instanceof Array||d!=e)return!1;if(c){if(a.length!=b.length)return!1;for(c=0;c<a.length;c++)if(!B(a[c],b[c]))return!1}else if(d){if(a.length!=b.length)return!1;for(c=0;c<a.length;c++)if(a[c]!=b[c])return!1}else{for(var f in a)if(!B(a[f],
b[f]))return!1;for(f in b)if(!(f in a))return!1}return!0}return!(a||b)}function B(a,b){if(typeof a!=typeof b)return!1;switch(typeof a){case "number":case "string":case "boolean":return a==b;case "object":return A(a,b);default:return!0}}function F(a){if(""==a)return".";var b=0==a.indexOf("/")|0;b&&0==a.indexOf("//")&&0!=a.indexOf("///")&&(b=2);a=a.split("/");for(var c=[],d=0;d<a.length;d++){var e=a[d];""!=e&&"."!=e&&(".."!=e||!b&&!c.length||c.length&&".."==c[c.length-1]?c.push(e):c.length&&c.pop())}a=
c.join("/");for(d=0;d<b;d++)a="/"+a;return a||"."}var D=p("__mat3"),e=p("__mat4"),z=p("__print"),y=p("__tsr"),v=p("__quat"),m=p("__vec3"),u=p("__vec4"),K=0,E={},M=new Float32Array(3),J=new Float32Array(3),O=new Float32Array(4),G=new Float32Array(4),x=new Float32Array(9),H=new Float32Array(16),P=new Float32Array(16),I=new Float64Array(1),aa=new Uint32Array(I.buffer),U=new Float32Array([0,0,0]),T=new Float32Array([0,0,0,1]),w=new Float32Array([0,0,0,1,0,0,0,1]),fa=new Float32Array([1,1,1]),da=new Float32Array([1,
0,0]),ea=new Float32Array([0,1,0]),V=new Float32Array([0,0,1]),S=new Float32Array([-1,0,0]),X=new Float32Array([0,-1,0]),la=new Float32Array([0,0,-1]),ga=Math.floor(44488.07041494893),oa=[new Float32Array([0,0,-1,0,0,-1,0,0,-1,0,0,0,0,0,0,1]),new Float32Array([0,0,1,0,0,-1,0,0,1,0,0,0,0,0,0,1]),new Float32Array([1,0,0,0,0,0,-1,0,0,1,0,0,0,0,0,1]),new Float32Array([1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1]),new Float32Array([1,0,0,0,0,-1,0,0,0,0,-1,0,0,0,0,1]),new Float32Array([-1,0,0,0,0,-1,0,0,0,0,1,0,0,
0,0,1])];a.VEC3_IDENT=U;a.QUAT4_IDENT=T;a.TSR8_IDENT=w;a.VEC3_UNIT=fa;a.AXIS_X=da;a.AXIS_Y=ea;a.AXIS_Z=V;a.AXIS_MX=S;a.AXIS_MY=X;a.AXIS_MZ=la;a.INV_CUBE_VIEW_MATRS=oa;a.isdef=function(a){return"undefined"!=typeof a};a.keyfind=function(a,b,c){for(var d=[],e=c.length,f=0;f<e;f++){var h=c[f];h[a]==b&&d.push(h)}return d};a.float32_concat=function(a,b){var c=a.length,d=new Float32Array(c+b.length);d.set(a);d.set(b,c);return d};a.uint32_concat=function(a,b){var c=a.length,d=new Uint32Array(c+b.length);
d.set(a);d.set(b,c);return d};a.check_endians=function(){var a=new Uint16Array([255]);return 255==(new DataView(a.buffer)).getUint16(0,!0)};a.array_intersect=function(a,b){var c=[],d={},e=b.length,f,h;for(f=0;f<e;f++)d[b[f]]=!0;e=a.length;for(f=0;f<e;f++)h=a[f],h in d&&c.push(h);return c};a.sign=t;a.keycheck=function(a,b,c){for(var d=c.length,e=0;e<d;e++)if(c[e][a]==b)return!0;return!1};a.keysearch=function(a,b,c){for(var d=0;d<c.length;d++){var e=c[d];if(e[a]===b)return e}return null};a.key2search=
function(a,b,c,d,e){for(var f=0;f<e.length;f++){var h=e[f];if(h[a]==b&&h[c]==d)return h}return null};a.get_index_for_key_value=function(a,b,c){for(var d=0;d<a.length;d++)if(a[d][b]==c)return d;return-1};a.append_unique=function(a,b){for(var c=0;c<a.length;c++)if(a[c]==b)return;a.push(b)};a.check_uniqueness=function(a){for(var b=0;b<a.length-1;b++)for(var c=a[b],d=b+1;d<a.length;d++)if(c==a[d])return!1;return!0};a.trans_matrix=function(a,b,c,d){d||(d=new Float32Array(16));e.identity(d);d[12]=a;d[13]=
b;d[14]=c;return d};var na=1;a.rand=function(){na=(69069*na+5)%Math.pow(2,32);return Math.round(na/65536)%32768/32767};a.srand=function(a){na=a};a.rand_r=function(a){var b=a[0]%ga*48271-3399*Math.floor(a[0]/ga);a[0]=0<b?b:b+2147483647;return(a[0]-1)/2147483646};a.init_rand_r_seed=function(a,b){b||(b=[]);b[0]=5E4+Math.floor(a);return b};a.euler_to_quat=function(a,b){b||(b=new Float32Array(4));var c=Math.cos(a[1]/2),d=Math.cos(a[2]/2),e=Math.cos(a[0]/2),f=Math.sin(a[1]/2),h=Math.sin(a[2]/2),g=Math.sin(a[0]/
2);b[0]=f*h*e+c*d*g;b[1]=f*d*e+c*h*g;b[2]=c*h*e-f*d*g;b[3]=c*d*e-f*h*g;return b};a.euler_to_rotation_matrix=function(a){var b=D.create(),c=Math.cos(a[0]),d=Math.cos(a[1]),e=Math.cos(a[2]),f=Math.sin(a[0]),h=Math.sin(a[1]);a=Math.sin(a[2]);var g=c*e,k=c*a,l=f*e,m=f*a;b[0]=d*e;b[1]=d*a;b[2]=-h;b[3]=h*l-k;b[4]=h*m+g;b[5]=d*f;b[6]=h*g+m;b[7]=h*k-l;b[8]=d*c;return b};a.quat_to_euler=function(a,b){var c=a[0],d=a[1],e=a[2],f=a[3],h=c*c,g=d*d,k=e*e,l=c*d+e*f;.499999<l?(b[0]=0,b[1]=2*Math.atan2(c,f),b[2]=
Math.PI/2):-.499999>l?(b[0]=0,b[1]=-2*Math.atan2(c,f),b[2]=-Math.PI/2):(b[0]=Math.atan2(2*c*f-2*d*e,1-2*h-2*k),b[1]=Math.atan2(2*d*f-2*c*e,1-2*g-2*k),b[2]=Math.asin(2*c*d+2*e*f));return b};a.quat_to_dir=function(a,b,c){c||(c=new Float32Array(3));m.transformQuat(b,a,c);return c};a.dir_to_quat=function(a,b,c){c||(c=new Float32Array(4));a=m.normalize(a,M);var d=m.dot(b,a);a=m.cross(b,a,J);d=Math.acos(d);c[0]=a[0]*Math.sin(d/2);c[1]=a[1]*Math.sin(d/2);c[2]=a[2]*Math.sin(d/2);c[3]=Math.cos(d/2);return c};
a.trans_quat_to_plane=function(a,b,c,d){d||(d=new Float32Array(4));m.transformQuat(c,b,d);d[3]=-m.dot(a,d);return d};a.dir_ground_proj_angle=function(a){var b=y.get_quat_view(a.render.world_tsr);switch(a.type){case "CAMERA":M[0]=0;M[1]=-1;M[2]=0;m.transformQuat(M,b,M);J[0]=0;J[1]=0;J[2]=-1;break;case "MESH":M[0]=0;M[1]=0;M[2]=1;m.transformQuat(M,b,M);J[0]=0;J[1]=0;J[2]=1;break;case "EMPTY":M[0]=0,M[1]=1,M[2]=0,m.transformQuat(M,b,M),J[0]=0,J[1]=1,J[2]=0}M[1]=0;m.normalize(M,M);a=m.dot(M,J);b=0<-M[0]*
J[2]?-1:1;return Math.acos(a)*b};a.blend_arrays=function(a,b,c,d){if(0==c)return a;d=d||[];for(var e=0;e<a.length;e++)d[e]=(1-c)*a[e]+c*b[e];return d};a.unique_id=function(){K++;return K.toString(16)};a.unique_name=function(a){E[a]||(E[a]=0);var b=a+E[a];E[a]++;return b};a.create_empty_va_frame=function(){return{a_position:new Float32Array(0),a_tangent:new Float32Array(0),a_normal:new Float32Array(0)}};a.create_empty_submesh=function(a){var b={a_influence:new Float32Array(0),a_color:new Float32Array(0),
a_texcoord:new Float32Array(0)};return{name:a,base_length:0,indices:null,va_frames:[],va_common:b,shape_keys:[]}};a.clone_object_json=function(a){return JSON.parse(JSON.stringify(a))};a.clone_object_r=function(b){if(!(b instanceof Object))return b;var c;c=b.constructor;switch(c){case Float32Array:case Uint32Array:case Uint16Array:c=new c(b);break;case Array:c=new c(b.length);for(var d=0;d<b.length;d++)c[d]=a.clone_object_r(b[d]);break;default:for(d in c=new c,b)c[d]=a.clone_object_r(b[d])}return c};
a.clone_object_nr=function(a){var b=a instanceof Array?[]:{},c;for(c in a)if(a[c]instanceof Object){var d=a[c].constructor;switch(d){case Float32Array:case Uint32Array:case Uint16Array:b[c]=new d(a[c]);break;case Array:b[c]=a[c].slice(0);break;default:b[c]=a[c]}}else b[c]=a[c];return b};a.matrix_to_quat=function(a,b){b||(b=new Float32Array(4));D.fromMat4(a,x);var c=x[0],d=x[3],e=x[6],f=x[1],h=x[4],g=x[7],k=x[2],l=x[5],m=x[8],c=Math.sqrt(c*c+d*d+e*e)||1,f=Math.sqrt(f*f+h*h+g*g)||1,k=Math.sqrt(k*k+
l*l+m*m)||1;x[0]/=c;x[3]/=c;x[6]/=c;x[1]/=f;x[4]/=f;x[7]/=f;x[2]/=k;x[5]/=k;x[8]/=k;v.fromMat3(x,b);v.normalize(b,b);return b};a.matrix_to_trans=function(a,b){b||(b=new Float32Array(3));b[0]=a[12];b[1]=a[13];b[2]=a[14];return b};a.matrix_to_scale=function(a){O[0]=.577350269189626;O[1]=.577350269189626;O[2]=.577350269189626;O[3]=0;u.transformMat4(O,a,O);return u.length(O)};a.extract_frustum_planes=function(a,b){var d=b.left,e=b.right,f=b.top,h=b.bottom,g=b.near,k=b.far;d[0]=a[3]+a[0];d[1]=a[7]+a[4];
d[2]=a[11]+a[8];d[3]=a[15]+a[12];e[0]=a[3]-a[0];e[1]=a[7]-a[4];e[2]=a[11]-a[8];e[3]=a[15]-a[12];f[0]=a[3]-a[1];f[1]=a[7]-a[5];f[2]=a[11]-a[9];f[3]=a[15]-a[13];h[0]=a[3]+a[1];h[1]=a[7]+a[5];h[2]=a[11]+a[9];h[3]=a[15]+a[13];g[0]=a[3]+a[2];g[1]=a[7]+a[6];g[2]=a[11]+a[10];g[3]=a[15]+a[14];k[0]=a[3]-a[2];k[1]=a[7]-a[6];k[2]=a[11]-a[10];k[3]=a[15]-a[14];c(d);c(e);c(f);c(h);c(g);c(k);return b};a.sphere_is_out_of_frustum=function(a,c,d){return d<-b(a,c.left)||d<-b(a,c.right)||d<-b(a,c.top)||d<-b(a,c.bottom)||
d<-b(a,c.near)||d<-b(a,c.far)?!0:!1};a.ellipsoid_is_out_of_frustum=function(a,c,d,e,f){h=m.dot(d,c.far);g=m.dot(e,c.far);k=m.dot(f,c.far);h=Math.sqrt(h*h+g*g+k*k);if(h<-b(a,c.near)||h<-b(a,c.far))return!0;var h=m.dot(d,c.left),g=m.dot(e,c.left),k=m.dot(f,c.left);if(Math.sqrt(h*h+g*g+k*k)<-b(a,c.left))return!0;h=m.dot(d,c.right);g=m.dot(e,c.right);k=m.dot(f,c.right);if(Math.sqrt(h*h+g*g+k*k)<-b(a,c.right))return!0;h=m.dot(d,c.top);g=m.dot(e,c.top);k=m.dot(f,c.top);if(Math.sqrt(h*h+g*g+k*k)<-b(a,c.top))return!0;
h=m.dot(d,c.bottom);g=m.dot(e,c.bottom);k=m.dot(f,c.bottom);return Math.sqrt(h*h+g*g+k*k)<-b(a,c.bottom)?!0:!1};a.positions_multiply_matrix=function(a,b,c,d){d||(d=0);for(var e=a.length,f=0;f<e;f+=3){var h=a[f],g=a[f+1],k=a[f+2];c[d+f]=b[0]*h+b[4]*g+b[8]*k+b[12];c[d+f+1]=b[1]*h+b[5]*g+b[9]*k+b[13];c[d+f+2]=b[2]*h+b[6]*g+b[10]*k+b[14]}return c};a.vectors_multiply_matrix=function(a,b,c,d){d||(d=0);for(var e=a.length,f=0;f<e;f+=3){var h=a[f],g=a[f+1],k=a[f+2];c[d+f]=b[0]*h+b[4]*g+b[8]*k;c[d+f+1]=b[1]*
h+b[5]*g+b[9]*k;c[d+f+2]=b[2]*h+b[6]*g+b[10]*k}return c};a.tangents_multiply_matrix=function(a,b,c,d){d||(d=0);for(var e=a.length,f=0;f<e;f+=4){var h=a[f],g=a[f+1],k=a[f+2];c[d+f]=b[0]*h+b[4]*g+b[8]*k;c[d+f+1]=b[1]*h+b[5]*g+b[9]*k;c[d+f+2]=b[2]*h+b[6]*g+b[10]*k;c[d+f+3]=a[f+3]}return c};a.vecdir_multiply_matrix=function(a,b,c){c||(c=new Float32Array(3));O[0]=a[0];O[1]=a[1];O[2]=a[2];O[3]=0;u.transformMat4(O,b,O);c[0]=O[0];c[1]=O[1];c[2]=O[2]};a.flatten=function(a,b){var c=a.length;if(!c)throw"flatten(): Wrong or empty array";
var d=a[0].length;if(!d)throw"flatten(): Wrong or empty subarray";b||(b=new Float32Array(c*d));for(var e=0;e<c;e++)for(var f=0;f<d;f++)b[e*d+f]=a[e][f];return b};a.vectorize=function(a,b){b||(b=[]);for(var c=0;c<a.length;c+=3){var d=new Float32Array([a[c],a[c+1],a[c+2]]);b[c/3]=d}return b};a.binary_search_max=function(b,c,d,e){if(e<d)return d;var f=d+Math.floor((e-d)/2);return b[f]>c?a.binary_search_max(b,c,d,f-1):b[f]<c?a.binary_search_max(b,c,f+1,e):f};a.cmp_arr=function(a,b){for(var c=0;c<a.length;c++)if(a[c]!=
b[c])return!1;return!0};a.cmp_arr_float=function(a,b,c){for(var d=0;d<a.length;d++)if(Math.abs(a[d]-b[d])>c)return!1;return!0};a.scale_mat4=function(a,b,c){c||(c=new Float32Array(16));for(var d=0;12>d;d++)c[d]=a[d]*b;c[12]=a[12];c[13]=a[13];c[14]=a[14];c[15]=a[15];return c};a.transform_mat4=function(a,b,c,d,f){f||(f=new Float32Array(16));b=e.fromRotationTranslation(c,d,H);e.multiply(b,a,f);return f};a.transform_vec3=function(a,b,c,d,f){f||(f=new Float32Array(3));c=e.fromRotationTranslation(c,d,H);
1!==b&&(d=e.identity(P),b=m.set(b,b,b,M),e.scale(d,b,d),e.multiply(c,d,c));m.transformMat4(a,c,f);return f};a.transform_vec4=function(a,b,c,d,f){f||(f=new Float32Array(4));b=e.fromRotationTranslation(c,d,H);u.transformMat4(a,b,f);return f};a.inverse_transform_vec3=function(a,b,c,d,f){f||(f=new Float32Array(3));b=e.fromRotationTranslation(c,d,H);e.invert(b,b);m.transformMat4(a,b,f);return f};a.transcale_quat_to_matrix=function(a,b,c){c||(c=new Float32Array(16));e.fromRotationTranslation(b,a,c);a=a[3];
for(b=0;12>b;b++)c[b]*=a;return c};a.matrix_to_transcale_quat=function(b,c,d){a.matrix_to_trans(b,c);c[3]=a.matrix_to_scale(b);a.matrix_to_quat(b,d)};a.array_stringify=function(a){for(var b=[],c=0;c<a.length;c++)b.push(a[c]);return JSON.stringify(b)};a.rotate_point_pivot=function(a,b,c,d){d||(d=new Float32Array(3));m.subtract(b,a,M);m.transformQuat(M,c,M);m.subtract(b,M,d)};a.generate_cubemap_matrices=function(){M[0]=0;M[1]=0;M[2]=0;var a=new Float32Array(16),b=new Float32Array(16),c=new Float32Array(16),
d=new Float32Array(16),f=new Float32Array(16),h=new Float32Array(16);e.lookAt(M,[-1,0,0],[0,-1,0],a);e.scale(a,[-1,1,1],a);e.scale(a,[-1,1,-1],b);e.lookAt(M,[0,-1,0],[0,0,-1],c);e.scale(c,[1,1,-1],c);e.scale(c,[1,-1,-1],d);e.lookAt(M,[0,0,-1],[0,-1,0],f);e.scale(f,[-1,1,1],f);e.scale(f,[-1,1,-1],h);return[a,b,c,d,f,h]};a.generate_inv_cubemap_matrices=function(){M[0]=0;M[1]=0;M[2]=0;var a=new Float32Array(16),b=new Float32Array(16),c=new Float32Array(16),d=new Float32Array(16),f=new Float32Array(16),
h=new Float32Array(16);e.lookAt(M,[1,0,0],[0,-1,0],a);e.scale(a,[-1,1,-1],b);e.lookAt(M,[0,1,0],[0,0,1],c);e.scale(c,[1,-1,-1],d);e.lookAt(M,[0,0,1],[0,-1,0],f);e.scale(f,[-1,1,-1],h);return[a,b,c,d,f,h]};a.calc_variable_id=function(a,b){return k(a,b)};a.hash_code=k;a.hash_code_string=l;a.mat3_to_mat4=function(a,b){b[15]=1;b[14]=0;b[13]=0;b[12]=0;b[11]=0;b[10]=a[8];b[9]=a[7];b[8]=a[6];b[7]=0;b[6]=a[5];b[5]=a[4];b[4]=a[3];b[3]=0;b[2]=a[2];b[1]=a[1];b[0]=a[0];return b};a.quat_to_angle_axis=function(a,
b){b||(b=a);var c=a[0]*a[0]+a[1]*a[1]+a[2]*a[2];0<c?(b[3]=2*Math.acos(a[3]),c=1/Math.sqrt(c),b[0]=a[0]*c,b[1]=a[1]*c,b[2]=a[2]*c):(b[3]=0,b[0]=1,b[1]=0,b[2]=0);return b};a.trunc=function(a){return isNaN(a)||"undefined"==typeof a?NaN:a|0};a.rad=function(a){return a*Math.PI/180};a.deg=function(a){return 180*a/Math.PI};a.snoise=function(a){var b=.366025403784439*a[0]+.366025403784439*a[1],c=Math.floor(a[0]+b),d=Math.floor(a[1]+b),e=.211324865405187*c+.211324865405187*d,b=a[0]-c+e;a=a[1]-d+e;var f=b>
a?1:0,h=1-f,e=b+.211324865405187-f,g=a+.211324865405187-h,k=b+-.577350269189626,l=a+-.577350269189626,c=c%289,d=d%289,m=q(q(d)+c),h=q(q(d+h)+c+f),n=q(q(d+1)+c+1),c=Math.max(.5-(b*b+a*a),0),d=Math.max(.5-(e*e+g*g),0),f=Math.max(.5-(k*k+l*l),0),c=c*c*c*c,d=d*d*d*d,f=f*f*f*f,p=2*r(.024390243902439*m)-1,v=2*r(.024390243902439*h)-1,z=2*r(.024390243902439*n)-1,m=Math.abs(p)-.5,h=Math.abs(v)-.5,n=Math.abs(z)-.5,p=p-Math.floor(p+.5),v=v-Math.floor(v+.5),z=z-Math.floor(z+.5);return 130*(c*(1.79284291400159-
.85373472095314*(p*p+m*m))*(p*b+m*a)+d*(1.79284291400159-.85373472095314*(v*v+h*h))*(v*e+h*g)+f*(1.79284291400159-.85373472095314*(z*z+n*n))*(z*k+n*l))};a.cellular2x2=function(a){var b=1/7,c=b/2,d=C(Math.floor(a[0])),e=C(Math.floor(a[1])),h=r(a[0]);a=r(a[1]);var k=h-.5,l=h-1.5,h=a-.5;a-=1.5;var m=g(d),d=g(d+1),n=m,q=d,m=g(m+e),d=g(d+e),n=g(n+e+1),q=g(q+e+1),p=f(m)*b+c,v=f(d)*b+c,z=f(n)*b+c,e=f(q)*b+c,m=f(Math.floor(m*b))*b+c,d=f(Math.floor(d*b))*b+c,n=f(Math.floor(n*b))*b+c,b=f(Math.floor(q*b))*b+
c,c=k+.7*p,v=l+.7*v,k=k+.7*z,l=l+.7*e,e=h+.7*m,h=h+.7*d,m=a+.7*n;a+=.7*b;return Math.min(c*c+e*e,v*v+h*h,k*k+m*m,l*l+a*a)};a.quat_project=function(a,b,c,d,e){e||(e=new Float32Array(4));a=m.transformQuat(b,a,M);b=c[0];var f=c[1];c=c[2];x[0]=f*f+c*c;x[1]=-f*b;x[2]=-c*b;x[3]=-b*f;x[4]=b*b+c*c;x[5]=-c*f;x[6]=-b*c;x[7]=-f*c;x[8]=b*b+f*f;m.transformMat3(a,x,a);m.normalize(a,a);v.rotationTo(d,a,e);return e};a.cam_quat_to_mesh_quat=function(a,b){b||(b=new Float32Array(4));var c=O,d=G,c=v.setAxisAngle([0,
1,0],Math.PI,v.create()),d=v.setAxisAngle([1,0,0],Math.PI/2,v.create());v.multiply(c,d,c);v.multiply(a,c,b);return b};a.cleanup=function(){K=0;E={}};a.clamp=function(a,b,c){return Math.min(Math.max(a,b),c)};a.smooth=function(a,b,c,d){c=Math.exp(-c/d);return(1-c)*a+c*b};a.smooth_v=function(a,b,c,d,e){e||(e=new Float32Array(a.length));c=Math.exp(-c/d);for(d=0;d<e.length;d++)e[d]=(1-c)*a[d]+c*b[d];return e};a.smooth_q=function(a,b,c,d,e){e||(e=new Float32Array(a.length));c=Math.exp(-c/d);v.slerp(a,b,
c,e);return e};a.is_arr_buf_view=function(a){return"object"===typeof a&&a.buffer&&a.buffer instanceof ArrayBuffer?!0:!1};a.is_vector=function(a,b){if(a instanceof Array||a.buffer&&a.buffer instanceof ArrayBuffer)if(b&&b==a.length||!b)return!0;return!1};a.correct_cam_quat_up=function(a,b){var c=D.fromQuat(a,x);J[0]=0;J[1]=1;J[2]=0;M[0]=c[3];M[1]=c[4];M[2]=c[5];var d=m.cross(J,M,M);m.normalize(d,d);var e=c[7];!b&&0<e&&(d[0]*=-1,d[1]*=-1,d[2]*=-1);J[0]=c[0];J[1]=c[1];J[2]=c[2];m.normalize(J,J);v.rotationTo(J,
d,G);v.multiply(G,a,a)};a.get_array_smooth_value=function(a,b,c,d){c=c*b-.5;var e=d*b-.5;d=c-Math.floor(c);var f=e-Math.floor(e);c=Math.floor(c);var e=Math.floor(e),h=b-1,g=a[e*b+c],k=a[e*b+Math.min(c+1,h)],l=a[Math.min(e+1,h)*b+c];a=a[Math.min(e+1,h)*b+Math.min(c+1,h)];return(g*(1-d)+k*d)*(1-f)+(l*(1-d)+a*d)*f};a.rgb_mask_get_channels_count=function(a){for(var b=0,c=0;3>c;c++)0<(a&1<<c)&&b++;return b};a.rgb_mask_get_channels_presence=function(a){for(var b=[0,0,0],c=0;3>c;c++)0<(a&1<<c)&&(b[2-c]=
1);return b};a.rgb_mask_get_channel_presence_index=function(a,b){var c=0;(1==b||2==b)&&0<(a&4)&&c++;2==b&&0<(a&2)&&c++;return c};a.gen_uuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)})};a.get_dict_length=function(a){var b=0,c;for(c in a)a.hasOwnProperty(c)&&b++;return b};a.random_from_array=function(a){if(!a.length)return null;var b=Math.floor(Math.random()*a.length);return a[b]};a.xz_direction=function(a,
b,c){c||(c=new Float32Array(3));c[0]=a[0]-b[0];c[1]=0;c[2]=a[2]-b[2];m.normalize(c,c)};a.transformQuatFast=function(a,b,c){var d=a[0],e=a[1];a=a[2];var f=b[0],h=b[1],g=b[2];b=b[3];var k=h*a-g*e,l=g*d-f*a,m=f*e-h*d,n=h*m-g*l,g=g*k-f*m,f=f*l-h*k;c[0]=d+2*k*b+2*n;c[1]=e+2*l*b+2*g;c[2]=a+2*m*b+2*f;return c};a.assert=function(a){if(!a)throw Error("Assertion failed");};a.panic=function(a){a&&z.error.apply(z,arguments);throw"engine panic:\nThe engine tried to perform an invalid operation and halted.\nPlease copy the console contents above and submit it to the Blend4Web forum at\nhttps://www.blend4web.com/en/forums/forum/17/";
};a.angle_wrap_periodic=h;a.angle_wrap_0_2pi=n;a.get_file_extension=function(a){return/(?:\.([^.]+))?$/.exec(a)[1]};a.strict_objs_is_equal=function(a,b){for(var c in a){var d=!0,e=a[c],f=b[c];switch(typeof e){case "number":case "string":case "boolean":d=e==f;break;case "object":d=A(e,f)}if(!d)return!1}return!0};a.quat_bpy_b4w=function(a,b){var c=a[0],d=a[2],e=a[3];b[0]=a[1];b[1]=d;b[2]=e;b[3]=c;return b};a.gen_color_id=function(a){a+=1;132651<a&&z.error("Color ID pool depleted");var b=Math.floor(a/
2601);a%=2601;var c=Math.floor(a/51);return new Float32Array([b/51,c/51,a%51/51])};a.line_plane_intersect=function(a,b,c,d,e){O.set(a);O[3]=b;G.set(d);G[3]=0;a=u.dot(O,G);if(0==a)return null;G.set(c);G[3]=1;a=-u.dot(O,G)/a;e[0]=c[0]+a*d[0];e[1]=c[1]+a*d[1];e[2]=c[2]+a*d[2];return e};a.get_plane_normal=function(a,b,c,d){var e=b[0]-a[0],f=c[0]-a[0],h=b[1]-a[1],g=c[1]-a[1];b=b[2]-a[2];a=c[2]-a[2];d[0]=h*a-b*g;d[1]=f*b-e*a;d[2]=e*g-h*f;return d};a.copy_array=function(a,b){for(var c=0;c<a.length;c++)b[c]=
a[c];return b};a.rotation_to_stable=function(a,b,c){var d=m.dot(a,b);-.9999999>d?(m.cross(da,a,M),1E-6>m.length(M)&&m.cross(ea,a,M),m.normalize(M,M),v.setAxisAngle(M,Math.PI,c)):(m.cross(a,b,M),c.set(M),c[3]=1+d,v.normalize(c,c));return c};a.calc_returning_angle=function(a,b,c){if(b==c)return c-a;a=n(a);b=n(b);c=n(c);b=2*Math.PI-b;c=n(c+b);a=n(a+b);return a>c?(c-=a,a=2*Math.PI-a,-c>a?a:c):0};a.smooth_step=function(a,b,c){isFinite(b)&&isFinite(c)&&(a=clamp(a,b,c));return a*a*(3-2*a)};a.lerp=function(a,
b,c){return b+a*(c-b)};a.arrays_have_common=function(a,b){for(var c=0;c<a.length;c++)for(var d=0;d<b.length;d++)if(b[d]==a[c])return!0;return!1};a.create_zero_array=function(a){for(var b=Array(a),c=0;c<a;c++)b[c]=0;return b};a.version_cmp=function(a,b){for(var c=Math.max(a.length,b.length),d=0;d<c;d++){var e=t((d>=a.length?0:a[d])-(d>=b.length?0:b[d]));if(e)return e}return 0};a.version_to_str=function(a){return a.join(".")};a.str_to_version=function(a){return a.split(".").map(function(a){return a|
0})};a.srgb_to_lin=function(a,b){b[0]=Math.pow(a[0],2.2);b[1]=Math.pow(a[1],2.2);b[2]=Math.pow(a[2],2.2);return b};a.lin_to_srgb=function(a,b){b[0]=Math.pow(a[0],1/2.2);b[1]=Math.pow(a[1],1/2.2);b[2]=Math.pow(a[2],1/2.2);return b};a.normpath_preserve_protocol=function(a){var b=a.split("://",2);return 1<b.length?(b[1]=F(b[1]),b.join("://")):F(a)};a.check_npot=function(a){return 0!=parseInt(a.toString(2).substr(1),2)}};b4w.module.__sfx=function(a,p){function t(){var a=window.AudioContext||window.webkitAudioContext;if(a){a=new a;if(a.createGain)return a;F.warn("deprecated WebAudio implementation");return null}F.warn("WebAudio is not supported");return null}function c(a,c,e){var f=a.sfx;if("NONE"!=f.behavior){var h=f.loop,g=f.pitch;if(f.src&&(h||0<=e)){f.base_seed=Math.floor(5E4*Math.random());var k=O.currentTime+c,k=Math.max(0,k);f.start_time=k;f.state=20;b(a);"POSITIONAL"==f.behavior||"BACKGROUND_SOUND"==f.behavior?
(c=O.createBufferSource(),c.buffer=f.src,c.playbackRate.value=g,z.isdef(c.onended)&&(c.onended=function(){f.state=50}),h?(f.source_node&&f.source_node.disconnect(),c.loop=!0,c.start(k),f.duration=0):(h=c.buffer?c.buffer.duration:0,e>h?(h=k+e+f.fade_out,c.loop=!0,c.start(k),c.stop(h),f.duration=e):(c.loop=!1,c.start(k),f.duration=h)),c.connect(f.proc_chain_in),f.source_node=c,d(f),l(f)):"BACKGROUND_MUSIC"==f.behavior&&(D.clear_timeout(f.bgm_start_timeout),D.clear_timeout(f.bgm_stop_timeout),e=function(){var b=
a.sfx,c=b.src;c&&(c.volume=1,c.loop=b.loop,b.source_node=b.source_node||O.createMediaElementSource(c),b.source_node.connect(b.proc_chain_in),20==b.state&&(c.currentTime&&(c.currentTime=0),c.play()))},0==c?e():f.bgm_start_timeout=D.set_timeout(e,1E3*c),h?f.duration=0:(e=A(a),f.duration=e));q(f,k)}}}function b(a){var b=a.sfx;if(!b.proc_chain_in){var c=e.get_trans_view(a.render.world_tsr);a=e.get_quat_view(a.render.world_tsr);if(m.mix_mode){var d=O.createBiquadFilter();d.type="peaking"}else d=null;var f=
O.createGain();switch(b.behavior){case "POSITIONAL":var h=O.createPanner();"string"!=typeof h.panningModel?(h.panningModel=h.EQUALPOWER,h.distanceModel=h.INVERSE_DISTANCE):(h.panningModel="equalpower",h.distanceModel="inverse");h.setPosition(c[0],c[1],c[2]);y.copy(c,b.last_position);c=u;z.quat_to_dir(a,z.AXIS_MY,c);h.setOrientation(c[0],c[1],c[2]);y.copy(c,b.direction);h.refDistance=b.dist_ref;h.maxDistance=b.dist_max;h.rolloffFactor=b.attenuation;h.coneInnerAngle=b.cone_angle_inner;h.coneOuterAngle=
b.cone_angle_outer;h.coneOuterGain=b.cone_volume_outer;var g=O.createGain();g.gain.value=n(b);d?(h.connect(d),d.connect(g)):h.connect(g);g.connect(f);b.proc_chain_in=h;if(b.volume_random){var k=O.createGain();f.connect(k);k.connect(O?G._sfx.proc_chain_in:null)}else k=null,f.connect(O?G._sfx.proc_chain_in:null);break;case "BACKGROUND_SOUND":h=null;g=O.createGain();g.gain.value=n(b);d?(b.proc_chain_in=d,d.connect(g)):b.proc_chain_in=g;g.connect(f);b.volume_random?(k=O.createGain(),f.connect(k),k.connect(O?
G._sfx.proc_chain_in:null)):(k=null,f.connect(O?G._sfx.proc_chain_in:null));break;case "BACKGROUND_MUSIC":k=h=null,g=O.createGain(),g.gain.value=n(b),d?(b.proc_chain_in=d,d.connect(g)):b.proc_chain_in=g,g.connect(f),f.connect(O?G._sfx.proc_chain_in:null)}b.panner_node=h;b.filter_node=d;b.gain_node=g;b.fade_gain_node=f;b.rand_gain_node=k}}function k(a){var b=a.sfx,d=b.duration,b=b.delay+b.delay_random*Math.random();c(a,b,d)}function d(a){a.volume_random&&a.rand_gain_node.gain.cancelScheduledValues(a.start_time);
a.pitch_random&&a.source_node.playbackRate.cancelScheduledValues(a.start_time);a.vp_rand_end_time=a.start_time}function l(a){if(a.volume_random||a.pitch_random){var b=a.rand_gain_node,c=a.source_node,d=c.buffer?c.buffer.duration:0;if(d){var e=a.start_time;H[0]=a.base_seed;for(var f=0;5>f;){var h=a.pitch+a.pitch_random*z.rand_r(H);if(e>=a.vp_rand_end_time){if(a.volume_random){var g=1-z.clamp(a.volume_random,0,1)*Math.random();b.gain.setValueAtTime(g,e)}a.pitch_random&&c.playbackRate.setValueAtTime(h,
e);f++}e+=d/h}a.vp_rand_end_time=e-.001}}}function q(a,b){if(a.fade_in||a.fade_out){var c=a.fade_gain_node;c.gain.cancelScheduledValues(b);a.fade_in?(c.gain.setValueAtTime(0,b),c.gain.linearRampToValueAtTime(1,b+a.fade_in)):c.gain.setValueAtTime(1,b);a.fade_out&&!a.loop&&(c.gain.setValueAtTime(1,b+a.duration),c.gain.linearRampToValueAtTime(0,b+a.duration+a.fade_out))}}function r(a){if("SPEAKER"!=a.type)throw"Wrong object type";var b=a.sfx;if(50==b.state)b.state=30;else if(20==b.state||40==b.state){var c=
b.fade_gain_node,d=O.currentTime;b.fade_out&&(c.gain.setValueAtTime(c.gain.value,d),c.gain.linearRampToValueAtTime(0,d+b.fade_out));"BACKGROUND_MUSIC"==b.behavior?b.src&&(D.clear_timeout(b.bgm_start_timeout),D.clear_timeout(b.bgm_stop_timeout),b.bgm_stop_timeout=D.set_timeout(function(){var b=a.sfx.src;b&&(b.currentTime&&(b.currentTime=0),b.pause())},1E3*b.fade_out)):(c=b.source_node,b.duration<c.buffer.duration?b.fade_out&&20==b.state?c.stop(d+b.fade_out):20==b.state&&(c.stop(0),c.disconnect()):
c.disconnect(),b.start_time=0,b.pause_time=0,b.buf_offset=0);b.state=30}}function g(a){a=a.sfx;if(20==a.state){var b=O.currentTime;a.pause_time=b;if("BACKGROUND_MUSIC"==a.behavior){var c=a.src;c&&c.pause()}else{if(b>a.start_time){H[0]=a.base_seed;for(var e=a.source_node.buffer.duration,f=a.start_time;f<b;)c=a.pitch+a.pitch_random*z.rand_r(H),f+=e/c;a.buf_offset=(e/c-(f-b))*c}else a.buf_offset=0;a.source_node.stop(0);a.source_node.disconnect();d(a)}a.state=40}}function C(a){var b=a.sfx;if(40==b.state){var c=
O.currentTime;b.start_time+=c-b.pause_time;"BACKGROUND_MUSIC"==b.behavior?b.src.play():(f(a),b.vp_rand_end_time=c,a=b.source_node,z.isdef(a.onended)&&(a.onended=function(){b.state=50}),a.start(b.start_time,b.buf_offset),l(b));q(b,b.start_time);b.state=20}}function f(a){a=a.sfx;var b=O.createBufferSource();b.loop=a.source_node.loop;b.buffer=a.source_node.buffer;b.playbackRate.value=a.source_node.playbackRate.value;a.panner_node?b.connect(a.panner_node):b.connect(a.gain_node);a.source_node=b}function h(a){a=
a.sfx;return!a||20!=a.state&&40!=a.state&&30!=a.state&&50!=a.state?!1:!0}function n(a){return a.muted?0:a.volume}function A(a){a=a.sfx;return(a=a.src)?a.duration:0}var B=p("__config"),F=p("__print"),D=p("__time"),e=p("__tsr"),z=p("__util"),y=p("__vec3"),v=B.defaults,m=B.sfx;a.AST_NONE=10;a.AST_ARRAY_BUFFER=20;a.AST_HTML_ELEMENT=30;var u=new Float32Array(3),K=new Float32Array(3),E=new Float32Array(3),M=[],J=[],O=null,G=null,x=[],H=[1],P=null;a.create_sfx=function(){return{uuid:-1,filepath:"",behavior:"NONE",
disable_doppler:!1,muted:!1,volume:1,pitch:1,attenuation:1,dist_ref:1,dist_max:1E4,cone_angle_inner:360,cone_angle_outer:360,cone_volume_outer:1,cyclic:!1,loop:!1,delay:0,delay_random:0,volume_random:0,pitch_random:0,fade_in:0,fade_out:0,start_time:0,pause_time:0,buf_offset:0,duration:0,vp_rand_end_time:0,base_seed:1,src:null,state:10,last_position:new Float32Array(3),direction:new Float32Array(3),speed_avg:new Float32Array(3),bgm_start_timeout:-1,bgm_stop_timeout:-1,duck_time:0}};a.init=function(){var a=
document.createElement("audio"),b=document.createElement("video");a.canPlayType&&(""!=a.canPlayType("audio/ogg")&&(M.push("ogg"),M.push("ogv")),""!=a.canPlayType("audio/mpeg")&&M.push("mp3"),""!=a.canPlayType("audio/mp4")&&(M.push("mp4"),M.push("m4v")),""!=a.canPlayType("audio/webm")&&M.push("webm"));b.canPlayType&&(""!=b.canPlayType("video/ogg")&&J.push("ogv"),""!=b.canPlayType("video/mp4")&&J.push("m4v"),""!=b.canPlayType("video/webm")&&J.push("webm"));(O=m.webaudio?t():null)&&F.log("%cINIT WEBAUDIO: "+
O.sampleRate+"Hz","color: #00a")};a.attach_scene_sfx=function(a){var b={listener_last_eye:new Float32Array(3),listener_direction:new Float32Array(3),listener_speed_avg:new Float32Array(3)};a._sfx=b;if(O){var c=O.createGain(),d=O.createGain();b.gain_node=c;b.fade_gain_node=d;c.connect(d);d.connect(O.destination);if(a.b4w_enable_dynamic_compressor){var d=O.createDynamicsCompressor(),e=a.b4w_dynamic_compressor_settings;d.threshold.value=e.threshold;d.knee.value=e.knee;d.ratio.value=e.ratio;d.attack.value=
e.attack;d.release.value=e.release;d.connect(c);b.compressor_node=d;b.proc_chain_in=d}else b.compressor_node=null,b.proc_chain_in=c;c=O.listener;b.disable_doppler=v.disable_doppler_hack;b.disable_doppler||(c.dopplerFactor=a.audio_doppler_factor,c.speedOfSound=a.audio_doppler_speed);b.muted=!1;b.volume=1;b.duck_time=0}};a.set_active_scene=function(a){G=a};a.detect_audio_container=function(a){a||(a="ogg");return-1<M.indexOf(a)?a:"ogg"==a&&-1<M.indexOf("mp4")?"mp4":"mp3"==a&&-1<M.indexOf("ogg")?"ogg":
"mp4"==a&&-1<M.indexOf("ogg")?"ogg":"ogv"==a&&-1<M.indexOf("m4v")?"m4v":"webm"==a&&-1<M.indexOf("m4v")?"m4v":"m4v"==a&&-1<M.indexOf("webm")?"webm":""};a.detect_video_container=function(a){a||(a="webm");return-1<J.indexOf(a)?a:"ogv"==a&&-1<J.indexOf("m4v")?"m4v":"webm"==a&&-1<J.indexOf("m4v")?"m4v":"m4v"==a&&-1<J.indexOf("webm")?"webm":""};a.update_object=function(a,b){var c=a.data,d=b.sfx;d.uuid=a.data.sound.uuid;d.filepath=a.data.sound.filepath;switch(c.b4w_behavior){case "POSITIONAL":case "BACKGROUND_SOUND":d.behavior=
O?c.b4w_behavior:"NONE";break;case "BACKGROUND_MUSIC":var e;O?(window.MediaElementAudioSourceNode?e=!0:(F.warn("MediaElementAudioSourceNode not found"),e=!1),e=e?"BACKGROUND_MUSIC":"BACKGROUND_SOUND"):e="NONE";d.behavior=e;break;default:throw"Wrong speaker behavior";}c.sound||(d.behavior="NONE");d.disable_doppler=c.b4w_disable_doppler||v.disable_doppler_hack;d.muted=c.muted;d.volume=c.volume;d.pitch=c.pitch;d.attenuation=c.attenuation;d.dist_ref=c.distance_reference;d.dist_max=c.distance_max||1E4;
d.cone_angle_inner=c.cone_angle_inner;d.cone_angle_outer=c.cone_angle_outer;d.cone_volume_outer=c.cone_volume_outer;d.cyclic=c.b4w_cyclic_play;d.loop=c.b4w_loop;d.delay=c.b4w_delay;d.delay_random=c.b4w_delay_random;d.volume_random=c.b4w_volume_random;d.pitch_random=c.b4w_pitch_random;d.fade_in=c.b4w_fade_in;d.fade_out=c.b4w_fade_out;x.push(b)};a.source_type=function(b){if("SPEAKER"!=b.type)throw"Wrong object type";switch(b.sfx.behavior){case "POSITIONAL":return a.AST_ARRAY_BUFFER;case "BACKGROUND_SOUND":return a.AST_ARRAY_BUFFER;
case "BACKGROUND_MUSIC":return a.AST_HTML_ELEMENT;case "NONE":return a.AST_NONE;default:throw"Wrong speaker behavior";}};a.update_spkobj=function(a,b){var c=a.sfx;switch(c.behavior){case "POSITIONAL":case "BACKGROUND_SOUND":case "BACKGROUND_MUSIC":c.src=b;break;case "NONE":break;default:throw"Wrong speaker behavior";}};a.play_empty_sound=function(){var a=O.createBufferSource();a.buffer=O.createBuffer(1,22050,22050);a.connect(O.destination);a.start(0)};a.decode_audio_data=function(a,b,c){O?O.decodeAudioData(a,
b,c):c()};a.speaker_remove=function(a){r(a);a.sfx=null;x.splice(x.indexOf(a),1)};a.cleanup=function(){for(var a=0;a<x.length;a++){var b=x[a].sfx;"BACKGROUND_MUSIC"==b.behavior?(b=b.src)&&b.pause():b.source_node&&b.source_node.disconnect()}G&&G._sfx&&(a=G._sfx,a.listener_last_eye[0]=0,a.listener_last_eye[1]=0,a.listener_last_eye[2]=0,a.listener_speed_avg[0]=0,a.listener_speed_avg[1]=0,a.listener_speed_avg[2]=0);G=null;x.splice(0);P=null};a.update=function(a,b){if(O&&0!=x.length){for(var c=0;c<x.length;c++){var d=
x[c],e=d.sfx,f=e.source_node,h=O.currentTime;!e.loop&&20==e.state&&e.duration&&e.start_time+e.duration<h&&("BACKGROUND_MUSIC"==e.behavior||f&&!z.isdef(f.onended))&&(e.state=50);e.cyclic&&50==e.state&&k(d);20==e.state&&3>e.vp_rand_end_time-h&&l(e)}P&&P.speakers.length&&(-1==P.active||a>P.active_start_time+P.durations[P.active])&&(c=P,-1<c.active&&r(c.speakers[c.active]),-1==c.active&&c.random?d=Math.round(Math.random()*(c.speakers.length-1)):c.random?(d=1+Math.round(Math.random()*(c.speakers.length-
2)),d=(c.active+d)%c.speakers.length):d=(c.active+1)%c.speakers.length,k(c.speakers[d]),c.active=d,c.active_start_time=a)}};a.play=c;a.play_def=k;a.stop=r;a.is_playing=function(a){return 20==a.sfx.state};a.speaker_pause=g;a.speaker_resume=C;a.playrate=function(a,b){var c=a.sfx;c.pitch=b;!h(a)||"POSITIONAL"!=c.behavior&&"BACKGROUND_SOUND"!=c.behavior||(c.source_node.playbackRate.value=b,d(c),l(c))};a.get_playrate=function(a){return a.sfx.pitch};a.cyclic=function(a,b){a.sfx.cyclic=Boolean(b)};a.is_cyclic=
function(a){return a.sfx.cyclic};a.listener_update_transform=function(a,b,c,d){if(O&&a._sfx){var e=u;e[0]=0;e[1]=-1;e[2]=0;y.transformQuat(e,c,e);K[0]=0;K[1]=0;K[2]=-1;y.transformQuat(K,c,K);c=O.listener;c.setPosition(b[0],b[1],b[2]);c.setOrientation(e[0],e[1],e[2],K[0],K[1],K[2]);y.copy(e,a._sfx.listener_direction);!a._sfx.disable_doppler&&d&&(E[0]=(b[0]-a._sfx.listener_last_eye[0])/d,E[1]=(b[1]-a._sfx.listener_last_eye[1])/d,E[2]=(b[2]-a._sfx.listener_last_eye[2])/d,z.smooth_v(E,a._sfx.listener_speed_avg,
d,.3,E),c.setVelocity(E[0],E[1],E[2]),y.copy(E,a._sfx.listener_speed_avg));y.copy(b,a._sfx.listener_last_eye)}};a.listener_reset_speed=function(a,b){if(O&&G._sfx&&!G._sfx.disable_doppler){var c=u;b?y.copy(b,c):y.copy(G._sfx.listener_direction,c);y.scale(c,a,c);O.listener.setVelocity(c[0],c[1],c[2]);y.copy(c,G._sfx.listener_speed_avg)}};a.speaker_update_transform=function(a,b){var c=a.sfx;if(h(a)&&"POSITIONAL"==c.behavior){var d=e.get_trans_view(a.render.world_tsr),f=e.get_quat_view(a.render.world_tsr),
g=c.panner_node;g.setPosition(d[0],d[1],d[2]);var k=u;z.quat_to_dir(f,z.AXIS_MY,k);g.setOrientation(k[0],k[1],k[2]);f=c.last_position;!c.disable_doppler&&b&&(K[0]=(d[0]-f[0])/b,K[1]=(d[1]-f[1])/b,K[2]=(d[2]-f[2])/b,z.smooth_v(K,c.speed_avg,b,.3,K),g.setVelocity(K[0],K[1],K[2]),y.copy(K,c.speed_avg));y.copy(d,f)}};a.speaker_reset_speed=function(a,b,c){var d=a.sfx;if(h(a)&&"POSITIONAL"==d.behavior&&!d.disable_doppler){var f=u;c?y.copy(c,f):y.copy(d.direction,f);y.scale(f,b,f);d.panner_node.setVelocity(f[0],
f[1],f[2]);y.copy(f,d.speed_avg);a=e.get_trans_view(a.render.world_tsr);y.copy(a,d.last_position)}};a.get_spk_behavior=function(a){return a.sfx.behavior};a.check_active_speakers=function(){for(var a=0;a<x.length;a++)if(h(x[a]))return!0;return!1};a.set_master_volume=function(a){var b=G._sfx;b&&(b.volume=a,O&&(b.gain_node.gain.value=n(b)))};a.get_master_volume=function(){var a=G._sfx;return a?a.volume:0};a.set_volume=function(a,b){var c=a.sfx;c.volume=b;h(a)&&(c.gain_node.gain.value=n(c))};a.get_volume=
function(a){return a.sfx.volume};a.mute=function(a,b){a.sfx.muted=Boolean(b);h(a)&&(a.sfx.gain_node.gain.value=n(a.sfx))};a.is_muted=function(a){return a.sfx.muted};a.mute_master=function(a){var b=G._sfx;b&&(b.muted=Boolean(a),O&&(b.gain_node.gain.value=n(b)))};a.is_master_muted=function(){var a=G._sfx;return a?a.muted:!1};a.get_speaker_objects=function(){return x};a.pause=function(){for(var a=0;a<x.length;a++)g(x[a])};a.resume=function(){for(var a=0;a<x.length;a++)C(x[a])};a.set_compressor_params=
function(a,b){if(a._sfx&&a._sfx.compressor_node){var c=a._sfx.compressor_node;c.threshold.value=b.threshold;c.knee.value=b.knee;c.ratio.value=b.ratio;c.attack.value=b.attack;c.release.value=b.release}};a.get_compressor_params=function(a){if(!a._sfx||!a._sfx.compressor_node)return null;a=a._sfx.compressor_node;return{threshold:a.threshold.value,knee:a.knee.value,ratio:a.ratio.value,attack:a.attack.value,release:a.release.value}};a.duck=function(a,b,c){if(h(a)){a=a.sfx;var d=a.fade_gain_node,e=O.currentTime;
d.gain.setValueAtTime(d.gain.value,e);d.gain.linearRampToValueAtTime(b,e+c);a.duck_time=c}};a.unduck=function(a){if(h(a)){a=a.sfx;var b=a.fade_gain_node,c=O.currentTime;b.gain.setValueAtTime(b.gain.value,c);b.gain.linearRampToValueAtTime(1,c+a.duck_time);a.duck_time=0}};a.duck_master=function(a,b){if(O){var c=G._sfx,d=c.fade_gain_node,e=O.currentTime;d.gain.setValueAtTime(d.gain.value,e);d.gain.linearRampToValueAtTime(a,e+b);c.duck_time=b}};a.unduck_master=function(){if(O){var a=G._sfx,b=a.fade_gain_node,
c=O.currentTime;b.gain.setValueAtTime(b.gain.value,c);b.gain.linearRampToValueAtTime(1,c+a.duck_time);a.duck_time=0}};a.apply_playlist=function(a,b,c){P={active:-1,active_start_time:0,random:c,speakers:[],durations:[]};for(c=0;c<a.length;c++){var d=a[c],e=A(d);0==e?F.warn("Ignoring speaker with zero duration: "+d.name):(r(d),d.sfx.cyclic=!1,P.speakers.push(d),P.durations.push(e+b))}};a.get_duration=A;a.clear_playlist=function(){if(P)for(var a=P.speakers,b=0;b<a.length;b++)r(a[b]);P=null};a.get_positional_params=
function(a){return(a=a.sfx)&&"POSITIONAL"==a.behavior?{dist_ref:a.dist_ref,dist_max:a.dist_max,attenuation:a.attenuation}:null};a.set_positional_params=function(a,b){var c=a.sfx;if(c&&"POSITIONAL"==c.behavior){c.dist_ref=b.dist_ref;c.dist_max=b.dist_max;c.attenuation=b.attenuation;var d=c.panner_node;d&&(d.refDistance=c.dist_ref,d.maxDistance=c.dist_max,d.rolloffFactor=c.attenuation)}};a.set_filter_params=function(a,b){var c=a.sfx;c&&c.filter_node&&(c.filter_node.frequency.value=b.freq,c.filter_node.Q.value=
b.Q,c.filter_node.gain.value=b.gain)};a.get_filter_params=function(a){return(a=a.sfx)&&a.filter_node?{freq:a.filter_node.frequency.value,Q:a.filter_node.Q.value,gain:a.filter_node.gain.value}:null};a.get_filter_freq_response=function(a,b,c,d){a=a.sfx;if(!a||!a.filter_node)return null;a.filter_node.getFrequencyResponse(b,c,d)}};b4w.module.__vec3=function(a,p){var t="undefined"!==typeof Float32Array?Float32Array:Array,c=Math.random;a.create=function(){var a=new t(3);a[0]=0;a[1]=0;a[2]=0;return a};a.clone=function(a){var c=new t(3);c[0]=a[0];c[1]=a[1];c[2]=a[2];return c};a.fromValues=function(a,c,d){var l=new t(3);l[0]=a;l[1]=c;l[2]=d;return l};a.copy=function(a,c){c[0]=a[0];c[1]=a[1];c[2]=a[2];return c};a.set=function(a,c,d,l){l[0]=a;l[1]=c;l[2]=d;return l};a.add=function(a,c,d){d[0]=a[0]+c[0];d[1]=a[1]+c[1];d[2]=a[2]+c[2];
return d};a.subtract=function(a,c,d){d[0]=a[0]-c[0];d[1]=a[1]-c[1];d[2]=a[2]-c[2];return d};a.sub=a.subtract;a.multiply=function(a,c,d){d[0]=a[0]*c[0];d[1]=a[1]*c[1];d[2]=a[2]*c[2];return d};a.mul=a.multiply;a.divide=function(a,c,d){d[0]=a[0]/c[0];d[1]=a[1]/c[1];d[2]=a[2]/c[2];return d};a.div=a.divide;a.min=function(a,c,d){d[0]=Math.min(a[0],c[0]);d[1]=Math.min(a[1],c[1]);d[2]=Math.min(a[2],c[2]);return d};a.max=function(a,c,d){d[0]=Math.max(a[0],c[0]);d[1]=Math.max(a[1],c[1]);d[2]=Math.max(a[2],
c[2]);return d};a.scale=function(a,c,d){d[0]=a[0]*c;d[1]=a[1]*c;d[2]=a[2]*c;return d};a.scaleAndAdd=function(a,c,d,l){l[0]=a[0]+c[0]*d;l[1]=a[1]+c[1]*d;l[2]=a[2]+c[2]*d;return l};a.distance=function(a,c){var d=c[0]-a[0],l=c[1]-a[1],q=c[2]-a[2];return Math.sqrt(d*d+l*l+q*q)};a.dist=a.distance;a.squaredDistance=function(a,c){var d=c[0]-a[0],l=c[1]-a[1],q=c[2]-a[2];return d*d+l*l+q*q};a.sqrDist=a.squaredDistance;a.length=function(a){var c=a[0],d=a[1];a=a[2];return Math.sqrt(c*c+d*d+a*a)};a.len=a.length;
a.squaredLength=function(a){var c=a[0],d=a[1];a=a[2];return c*c+d*d+a*a};a.sqrLen=a.squaredLength;a.negate=function(a,c){c[0]=-a[0];c[1]=-a[1];c[2]=-a[2];return c};a.inverse=function(a,c){c[0]=1/a[0];c[1]=1/a[1];c[2]=1/a[2];return c};a.normalize=function(a,c){var d=a[0],l=a[1],q=a[2],d=d*d+l*l+q*q;0<d&&(d=1/Math.sqrt(d),c[0]=a[0]*d,c[1]=a[1]*d,c[2]=a[2]*d);return c};a.dot=function(a,c){return a[0]*c[0]+a[1]*c[1]+a[2]*c[2]};a.cross=function(a,c,d){var l=a[0],q=a[1];a=a[2];var r=c[0],g=c[1];c=c[2];
d[0]=q*c-a*g;d[1]=a*r-l*c;d[2]=l*g-q*r;return d};a.lerp=function(a,c,d,l){var q=a[0],r=a[1];a=a[2];l[0]=q+d*(c[0]-q);l[1]=r+d*(c[1]-r);l[2]=a+d*(c[2]-a);return l};a.random=function(a,k){a=a||1;var d=2*c()*Math.PI,l=2*c()-1,q=Math.sqrt(1-l*l)*a;k[0]=Math.cos(d)*q;k[1]=Math.sin(d)*q;k[2]=l*a;return k};a.transformMat4=function(a,c,d){var l=a[0],q=a[1];a=a[2];var r=c[3]*l+c[7]*q+c[11]*a+c[15],r=r||1;d[0]=(c[0]*l+c[4]*q+c[8]*a+c[12])/r;d[1]=(c[1]*l+c[5]*q+c[9]*a+c[13])/r;d[2]=(c[2]*l+c[6]*q+c[10]*a+c[14])/
r;return d};a.transformMat3=function(a,c,d){var l=a[0],q=a[1];a=a[2];d[0]=l*c[0]+q*c[3]+a*c[6];d[1]=l*c[1]+q*c[4]+a*c[7];d[2]=l*c[2]+q*c[5]+a*c[8];return d};a.transformQuat=function(a,c,d){var l=a[0],q=a[1],r=a[2];a=c[0];var g=c[1],p=c[2];c=c[3];var f=c*l+g*r-p*q,h=c*q+p*l-a*r,n=c*r+a*q-g*l,l=-a*l-g*q-p*r;d[0]=f*c+l*-a+h*-p-n*-g;d[1]=h*c+l*-g+n*-a-f*-p;d[2]=n*c+l*-p+f*-g-h*-a;return d};a.rotateX=function(a,c,d,l){var q=[],r=[];q[0]=a[0]-c[0];q[1]=a[1]-c[1];q[2]=a[2]-c[2];r[0]=q[0];r[1]=q[1]*Math.cos(d)-
q[2]*Math.sin(d);r[2]=q[1]*Math.sin(d)+q[2]*Math.cos(d);l[0]=r[0]+c[0];l[1]=r[1]+c[1];l[2]=r[2]+c[2];return l};a.rotateY=function(a,c,d,l){var q=[],r=[];q[0]=a[0]-c[0];q[1]=a[1]-c[1];q[2]=a[2]-c[2];r[0]=q[2]*Math.sin(d)+q[0]*Math.cos(d);r[1]=q[1];r[2]=q[2]*Math.cos(d)-q[0]*Math.sin(d);l[0]=r[0]+c[0];l[1]=r[1]+c[1];l[2]=r[2]+c[2];return l};a.rotateZ=function(a,c,d,l){var q=[],r=[];q[0]=a[0]-c[0];q[1]=a[1]-c[1];q[2]=a[2]-c[2];r[0]=q[0]*Math.cos(d)-q[1]*Math.sin(d);r[1]=q[0]*Math.sin(d)+q[1]*Math.cos(d);
r[2]=q[2];l[0]=r[0]+c[0];l[1]=r[1]+c[1];l[2]=r[2]+c[2];return l};a.forEach=function(){var b=a.create();return function(a,c,l,q,r,g){c||(c=3);l||(l=0);for(q=q?Math.min(q*c+l,a.length):a.length;l<q;l+=c)b[0]=a[l],b[1]=a[l+1],b[2]=a[l+2],r(b,g,b),a[l]=b[0],a[l+1]=b[1],a[l+2]=b[2];return a}}();a.angle=function(b,c){var d=a.fromValues(b[0],b[1],b[2]),l=a.fromValues(c[0],c[1],c[2]);a.normalize(d,d);a.normalize(l,l);d=a.dot(d,l);return 1<d?0:Math.acos(d)};a.str=function(a){return"vec3("+a[0]+", "+a[1]+", "+
a[2]+")"};"undefined"!==typeof a&&(a.vec3=a)};b4w.module.vec3=b4w.module.__vec3;
b4w.module.__vec4=function(a,p){var t="undefined"!==typeof Float32Array?Float32Array:Array,c=Math.random;a.create=function(){var a=new t(4);a[0]=0;a[1]=0;a[2]=0;a[3]=0;return a};a.clone=function(a){var c=new t(4);c[0]=a[0];c[1]=a[1];c[2]=a[2];c[3]=a[3];return c};a.fromValues=function(a,c,d,l){var q=new t(4);q[0]=a;q[1]=c;q[2]=d;q[3]=l;return q};a.copy=function(a,c){c[0]=a[0];c[1]=a[1];c[2]=a[2];c[3]=a[3];return c};a.set=function(a,c,d,l,q){q[0]=a;q[1]=c;q[2]=d;q[3]=l;return q};a.add=function(a,c,
d){d[0]=a[0]+c[0];d[1]=a[1]+c[1];d[2]=a[2]+c[2];d[3]=a[3]+c[3];return d};a.subtract=function(a,c,d){d[0]=a[0]-c[0];d[1]=a[1]-c[1];d[2]=a[2]-c[2];d[3]=a[3]-c[3];return d};a.sub=a.subtract;a.multiply=function(a,c,d){d[0]=a[0]*c[0];d[1]=a[1]*c[1];d[2]=a[2]*c[2];d[3]=a[3]*c[3];return d};a.mul=a.multiply;a.divide=function(a,c,d){d[0]=a[0]/c[0];d[1]=a[1]/c[1];d[2]=a[2]/c[2];d[3]=a[3]/c[3];return d};a.div=a.divide;a.min=function(a,c,d){d[0]=Math.min(a[0],c[0]);d[1]=Math.min(a[1],c[1]);d[2]=Math.min(a[2],
c[2]);d[3]=Math.min(a[3],c[3]);return d};a.max=function(a,c,d){d[0]=Math.max(a[0],c[0]);d[1]=Math.max(a[1],c[1]);d[2]=Math.max(a[2],c[2]);d[3]=Math.max(a[3],c[3]);return d};a.scale=function(a,c,d){d[0]=a[0]*c;d[1]=a[1]*c;d[2]=a[2]*c;d[3]=a[3]*c;return d};a.scaleAndAdd=function(a,c,d,l){l[0]=a[0]+c[0]*d;l[1]=a[1]+c[1]*d;l[2]=a[2]+c[2]*d;l[3]=a[3]+c[3]*d;return l};a.distance=function(a,c){var d=c[0]-a[0],l=c[1]-a[1],q=c[2]-a[2],r=c[3]-a[3];return Math.sqrt(d*d+l*l+q*q+r*r)};a.dist=a.distance;a.squaredDistance=
function(a,c){var d=c[0]-a[0],l=c[1]-a[1],q=c[2]-a[2],r=c[3]-a[3];return d*d+l*l+q*q+r*r};a.sqrDist=a.squaredDistance;a.length=function(a){var c=a[0],d=a[1],l=a[2];a=a[3];return Math.sqrt(c*c+d*d+l*l+a*a)};a.len=a.length;a.squaredLength=function(a){var c=a[0],d=a[1],l=a[2];a=a[3];return c*c+d*d+l*l+a*a};a.sqrLen=a.squaredLength;a.negate=function(a,c){c[0]=-a[0];c[1]=-a[1];c[2]=-a[2];c[3]=-a[3];return c};a.inverse=function(a,c){c[0]=1/a[0];c[1]=1/a[1];c[2]=1/a[2];c[3]=1/a[3];return c};a.normalize=
function(a,c){var d=a[0],l=a[1],q=a[2],r=a[3],d=d*d+l*l+q*q+r*r;0<d&&(d=1/Math.sqrt(d),c[0]=a[0]*d,c[1]=a[1]*d,c[2]=a[2]*d,c[3]=a[3]*d);return c};a.dot=function(a,c){return a[0]*c[0]+a[1]*c[1]+a[2]*c[2]+a[3]*c[3]};a.lerp=function(a,c,d,l){var q=a[0],r=a[1],g=a[2];a=a[3];l[0]=q+d*(c[0]-q);l[1]=r+d*(c[1]-r);l[2]=g+d*(c[2]-g);l[3]=a+d*(c[3]-a);return l};a.random=function(b,k){b=b||1;k[0]=c();k[1]=c();k[2]=c();k[3]=c();a.normalize(k,k);a.scale(k,b,k);return k};a.transformMat4=function(a,c,d){var l=a[0],
q=a[1],r=a[2];a=a[3];d[0]=c[0]*l+c[4]*q+c[8]*r+c[12]*a;d[1]=c[1]*l+c[5]*q+c[9]*r+c[13]*a;d[2]=c[2]*l+c[6]*q+c[10]*r+c[14]*a;d[3]=c[3]*l+c[7]*q+c[11]*r+c[15]*a;return d};a.transformQuat=function(a,c,d){var l=a[0],q=a[1],r=a[2],g=c[0],p=c[1],f=c[2];c=c[3];var h=c*l+p*r-f*q,n=c*q+f*l-g*r,t=c*r+g*q-p*l,l=-g*l-p*q-f*r;d[0]=h*c+l*-g+n*-f-t*-p;d[1]=n*c+l*-p+t*-g-h*-f;d[2]=t*c+l*-f+h*-p-n*-g;d[3]=a[3];return d};a.forEach=function(){var b=a.create();return function(a,c,l,q,r,g){c||(c=4);l||(l=0);for(q=q?Math.min(q*
c+l,a.length):a.length;l<q;l+=c)b[0]=a[l],b[1]=a[l+1],b[2]=a[l+2],b[3]=a[l+3],r(b,g,b),a[l]=b[0],a[l+1]=b[1],a[l+2]=b[2],a[l+3]=b[3];return a}}();a.str=function(a){return"vec4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};"undefined"!==typeof a&&(a.vec4=a)};b4w.module.vec4=b4w.module.__vec4;
b4w.module.__quat=function(a,p){var t=p("__vec3"),c=p("__vec4"),b=p("__mat3"),k="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new k(4);a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};a.rotationTo=function(){var b=t.create(),c=t.fromValues(1,0,0),k=t.fromValues(0,1,0);return function(r,g,p){var f=t.dot(r,g);if(-.9999999>f)return t.cross(c,r,b),1E-6>t.length(b)&&t.cross(k,r,b),t.normalize(b,b),a.setAxisAngle(b,Math.PI,p),p;if(.9999999<f)return p[0]=0,p[1]=0,p[2]=0,p[3]=1,p;t.cross(r,
g,b);p[0]=b[0];p[1]=b[1];p[2]=b[2];p[3]=1+f;return a.normalize(p,p)}}();a.setAxes=function(){var c=b.create();return function(b,k,r,g){c[0]=k[0];c[3]=k[1];c[6]=k[2];c[1]=r[0];c[4]=r[1];c[7]=r[2];c[2]=-b[0];c[5]=-b[1];c[8]=-b[2];return a.normalize(a.fromMat3(c,g),g)}}();a.clone=c.clone;a.fromValues=c.fromValues;a.copy=c.copy;a.set=c.set;a.identity=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};a.setAxisAngle=function(a,b,c){b*=.5;var k=Math.sin(b);c[0]=k*a[0];c[1]=k*a[1];c[2]=k*a[2];c[3]=Math.cos(b);
return c};a.add=c.add;a.multiply=function(a,b,c){var k=a[0],g=a[1],p=a[2];a=a[3];var f=b[0],h=b[1],n=b[2];b=b[3];c[0]=k*b+a*f+g*n-p*h;c[1]=g*b+a*h+p*f-k*n;c[2]=p*b+a*n+k*h-g*f;c[3]=a*b-k*f-g*h-p*n;return c};a.mul=a.multiply;a.scale=c.scale;a.rotateX=function(a,b,c){b*=.5;var k=a[0],g=a[1],p=a[2];a=a[3];var f=Math.sin(b);b=Math.cos(b);c[0]=k*b+a*f;c[1]=g*b+p*f;c[2]=p*b-g*f;c[3]=a*b-k*f;return c};a.rotateY=function(a,b,c){b*=.5;var k=a[0],g=a[1],p=a[2];a=a[3];var f=Math.sin(b);b=Math.cos(b);c[0]=k*
b-p*f;c[1]=g*b+a*f;c[2]=p*b+k*f;c[3]=a*b-g*f;return c};a.rotateZ=function(a,b,c){b*=.5;var k=a[0],g=a[1],p=a[2];a=a[3];var f=Math.sin(b);b=Math.cos(b);c[0]=k*b+g*f;c[1]=g*b-k*f;c[2]=p*b+a*f;c[3]=a*b-p*f;return c};a.calculateW=function(a,b){var c=a[0],k=a[1],g=a[2];b[0]=c;b[1]=k;b[2]=g;b[3]=Math.sqrt(Math.abs(1-c*c-k*k-g*g));return b};a.dot=c.dot;a.lerp=c.lerp;a.slerp=function(a,b,c,k){var g=a[0],p=a[1],f=a[2];a=a[3];var h=b[0],n=b[1],t=b[2];b=b[3];var B,F,D;F=g*h+p*n+f*t+a*b;0>F&&(F=-F,h=-h,n=-n,
t=-t,b=-b);1E-6<1-F?(B=Math.acos(F),D=Math.sin(B),F=Math.sin((1-c)*B)/D,c=Math.sin(c*B)/D):F=1-c;k[0]=F*g+c*h;k[1]=F*p+c*n;k[2]=F*f+c*t;k[3]=F*a+c*b;return k};a.invert=function(a,b){var c=a[0],k=a[1],g=a[2],p=a[3],f=c*c+k*k+g*g+p*p,f=f?1/f:0;b[0]=-c*f;b[1]=-k*f;b[2]=-g*f;b[3]=p*f;return b};a.conjugate=function(a,b){b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];b[3]=a[3];return b};a.length=c.length;a.len=a.length;a.squaredLength=c.squaredLength;a.sqrLen=a.squaredLength;a.normalize=c.normalize;a.fromMat3=function(a,
b){var c=a[0]+a[4]+a[8];if(0<c)c=Math.sqrt(c+1),b[3]=.5*c,c=.5/c,b[0]=(a[5]-a[7])*c,b[1]=(a[6]-a[2])*c,b[2]=(a[1]-a[3])*c;else{var k=0;a[4]>a[0]&&(k=1);a[8]>a[3*k+k]&&(k=2);var g=(k+1)%3,p=(k+2)%3,c=Math.sqrt(a[3*k+k]-a[3*g+g]-a[3*p+p]+1);b[k]=.5*c;c=.5/c;b[3]=(a[3*g+p]-a[3*p+g])*c;b[g]=(a[3*g+k]+a[3*k+g])*c;b[p]=(a[3*p+k]+a[3*k+p])*c}return b};a.str=function(a){return"quat("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};"undefined"!==typeof a&&(a.quat=a)};b4w.module.quat=b4w.module.__quat;
b4w.module.__mat3=function(a,p){var t="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new t(9);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};a.fromMat4=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[4];b[4]=a[5];b[5]=a[6];b[6]=a[8];b[7]=a[9];b[8]=a[10];return b};a.clone=function(a){var b=new t(9);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return b};a.copy=function(a,b){b[0]=a[0];b[1]=a[1];
b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return b};a.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};a.transpose=function(a,b){if(b===a){var k=a[1],d=a[2],l=a[5];b[1]=a[3];b[2]=a[6];b[3]=k;b[5]=a[7];b[6]=d;b[7]=l}else b[0]=a[0],b[1]=a[3],b[2]=a[6],b[3]=a[1],b[4]=a[4],b[5]=a[7],b[6]=a[2],b[7]=a[5],b[8]=a[8];return b};a.invert=function(a,b){var k=a[0],d=a[1],l=a[2],q=a[3],r=a[4],g=a[5],p=a[6],f=a[7],h=a[8],n=h*r-g*f,t=-h*q+g*
p,B=f*q-r*p,F=k*n+d*t+l*B;if(!F)return null;F=1/F;b[0]=n*F;b[1]=(-h*d+l*f)*F;b[2]=(g*d-l*r)*F;b[3]=t*F;b[4]=(h*k-l*p)*F;b[5]=(-g*k+l*q)*F;b[6]=B*F;b[7]=(-f*k+d*p)*F;b[8]=(r*k-d*q)*F;return b};a.adjoint=function(a,b){var k=a[0],d=a[1],l=a[2],q=a[3],r=a[4],g=a[5],p=a[6],f=a[7],h=a[8];b[0]=r*h-g*f;b[1]=l*f-d*h;b[2]=d*g-l*r;b[3]=g*p-q*h;b[4]=k*h-l*p;b[5]=l*q-k*g;b[6]=q*f-r*p;b[7]=d*p-k*f;b[8]=k*r-d*q;return b};a.determinant=function(a){var b=a[3],k=a[4],d=a[5],l=a[6],q=a[7],r=a[8];return a[0]*(r*k-d*
q)+a[1]*(-r*b+d*l)+a[2]*(q*b-k*l)};a.multiply=function(a,b,k){var d=a[0],l=a[1],q=a[2],r=a[3],g=a[4],p=a[5],f=a[6],h=a[7];a=a[8];var n=b[0],t=b[1],B=b[2],F=b[3],D=b[4],e=b[5],z=b[6],y=b[7];b=b[8];k[0]=n*d+t*r+B*f;k[1]=n*l+t*g+B*h;k[2]=n*q+t*p+B*a;k[3]=F*d+D*r+e*f;k[4]=F*l+D*g+e*h;k[5]=F*q+D*p+e*a;k[6]=z*d+y*r+b*f;k[7]=z*l+y*g+b*h;k[8]=z*q+y*p+b*a;return k};a.mul=a.multiply;a.translate=function(a,b,k){var d=a[0],l=a[1],q=a[2],r=a[3],g=a[4],p=a[5],f=a[6],h=a[7];a=a[8];var n=b[0];b=b[1];k[0]=d;k[1]=
l;k[2]=q;k[3]=r;k[4]=g;k[5]=p;k[6]=n*d+b*r+f;k[7]=n*l+b*g+h;k[8]=n*q+b*p+a;return k};a.rotate=function(a,b,k){var d=a[0],l=a[1],q=a[2],r=a[3],g=a[4],p=a[5],f=a[6],h=a[7];a=a[8];var n=Math.sin(b);b=Math.cos(b);k[0]=b*d+n*r;k[1]=b*l+n*g;k[2]=b*q+n*p;k[3]=b*r-n*d;k[4]=b*g-n*l;k[5]=b*p-n*q;k[6]=f;k[7]=h;k[8]=a;return k};a.scale=function(a,b,k){var d=b[0];b=b[1];k[0]=d*a[0];k[1]=d*a[1];k[2]=d*a[2];k[3]=b*a[3];k[4]=b*a[4];k[5]=b*a[5];k[6]=a[6];k[7]=a[7];k[8]=a[8];return k};a.fromTranslation=function(a,
b){b[0]=1;b[1]=0;b[2]=0;b[3]=0;b[4]=1;b[5]=0;b[6]=a[0];b[7]=a[1];b[8]=1;return b};a.fromRotation=function(a,b){var k=Math.sin(a),d=Math.cos(a);b[0]=d;b[1]=k;b[2]=0;b[3]=-k;b[4]=d;b[5]=0;b[6]=0;b[7]=0;b[8]=1;return b};a.fromScaling=function(a,b){b[0]=a[0];b[1]=0;b[2]=0;b[3]=0;b[4]=a[1];b[5]=0;b[6]=0;b[7]=0;b[8]=1;return b};a.fromMat2d=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=0;b[3]=a[2];b[4]=a[3];b[5]=0;b[6]=a[4];b[7]=a[5];b[8]=1;return b};a.fromQuat=function(a,b){var k=a[0],d=a[1],l=a[2],q=a[3],r=k+
k,g=d+d,p=l+l,k=k*r,f=d*r,d=d*g,h=l*r,n=l*g,l=l*p,r=q*r,g=q*g,q=q*p;b[0]=1-d-l;b[3]=f-q;b[6]=h+g;b[1]=f+q;b[4]=1-k-l;b[7]=n-r;b[2]=h-g;b[5]=n+r;b[8]=1-k-d;return b};a.normalFromMat4=function(a,b){var k=a[0],d=a[1],l=a[2],q=a[3],r=a[4],g=a[5],p=a[6],f=a[7],h=a[8],n=a[9],t=a[10],B=a[11],F=a[12],D=a[13],e=a[14],z=a[15],y=k*g-d*r,v=k*p-l*r,m=k*f-q*r,u=d*p-l*g,K=d*f-q*g,E=l*f-q*p,M=h*D-n*F,J=h*e-t*F,h=h*z-B*F,O=n*e-t*D,n=n*z-B*D,t=t*z-B*e,B=y*t-v*n+m*O+u*h-K*J+E*M;if(!B)return null;B=1/B;b[0]=(g*t-p*n+
f*O)*B;b[1]=(p*h-r*t-f*J)*B;b[2]=(r*n-g*h+f*M)*B;b[3]=(l*n-d*t-q*O)*B;b[4]=(k*t-l*h+q*J)*B;b[5]=(d*h-k*n-q*M)*B;b[6]=(D*E-e*K+z*u)*B;b[7]=(e*m-F*E-z*v)*B;b[8]=(F*K-D*m+z*y)*B;return b};a.str=function(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"};a.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2))};"undefined"!==
typeof a&&(a.mat3=a)};b4w.module.mat3=b4w.module.__mat3;
b4w.module.__mat4=function(a,p){var t="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new t(16);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};a.clone=function(a){var b=new t(16);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b};a.copy=function(a,b){b[0]=a[0];
b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b};a.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};a.transpose=function(a,b){if(b===a){var k=a[1],d=a[2],l=a[3],q=a[6],r=a[7],g=a[11];b[1]=a[4];b[2]=a[8];b[3]=a[12];b[4]=k;b[6]=a[9];b[7]=a[13];b[8]=d;b[9]=q;b[11]=a[14];b[12]=l;b[13]=
r;b[14]=g}else b[0]=a[0],b[1]=a[4],b[2]=a[8],b[3]=a[12],b[4]=a[1],b[5]=a[5],b[6]=a[9],b[7]=a[13],b[8]=a[2],b[9]=a[6],b[10]=a[10],b[11]=a[14],b[12]=a[3],b[13]=a[7],b[14]=a[11],b[15]=a[15];return b};a.invert=function(a,b){var k=a[0],d=a[1],l=a[2],q=a[3],r=a[4],g=a[5],p=a[6],f=a[7],h=a[8],n=a[9],t=a[10],B=a[11],F=a[12],D=a[13],e=a[14],z=a[15],y=k*g-d*r,v=k*p-l*r,m=k*f-q*r,u=d*p-l*g,K=d*f-q*g,E=l*f-q*p,M=h*D-n*F,J=h*e-t*F,O=h*z-B*F,G=n*e-t*D,x=n*z-B*D,H=t*z-B*e,P=y*H-v*x+m*G+u*O-K*J+E*M;if(!P)return null;
P=1/P;b[0]=(g*H-p*x+f*G)*P;b[1]=(l*x-d*H-q*G)*P;b[2]=(D*E-e*K+z*u)*P;b[3]=(t*K-n*E-B*u)*P;b[4]=(p*O-r*H-f*J)*P;b[5]=(k*H-l*O+q*J)*P;b[6]=(e*m-F*E-z*v)*P;b[7]=(h*E-t*m+B*v)*P;b[8]=(r*x-g*O+f*M)*P;b[9]=(d*O-k*x-q*M)*P;b[10]=(F*K-D*m+z*y)*P;b[11]=(n*m-h*K-B*y)*P;b[12]=(g*J-r*G-p*M)*P;b[13]=(k*G-d*J+l*M)*P;b[14]=(D*v-F*u-e*y)*P;b[15]=(h*u-n*v+t*y)*P;return b};a.adjoint=function(a,b){var k=a[0],d=a[1],l=a[2],q=a[3],r=a[4],g=a[5],p=a[6],f=a[7],h=a[8],n=a[9],t=a[10],B=a[11],F=a[12],D=a[13],e=a[14],z=a[15];
b[0]=g*(t*z-B*e)-n*(p*z-f*e)+D*(p*B-f*t);b[1]=-(d*(t*z-B*e)-n*(l*z-q*e)+D*(l*B-q*t));b[2]=d*(p*z-f*e)-g*(l*z-q*e)+D*(l*f-q*p);b[3]=-(d*(p*B-f*t)-g*(l*B-q*t)+n*(l*f-q*p));b[4]=-(r*(t*z-B*e)-h*(p*z-f*e)+F*(p*B-f*t));b[5]=k*(t*z-B*e)-h*(l*z-q*e)+F*(l*B-q*t);b[6]=-(k*(p*z-f*e)-r*(l*z-q*e)+F*(l*f-q*p));b[7]=k*(p*B-f*t)-r*(l*B-q*t)+h*(l*f-q*p);b[8]=r*(n*z-B*D)-h*(g*z-f*D)+F*(g*B-f*n);b[9]=-(k*(n*z-B*D)-h*(d*z-q*D)+F*(d*B-q*n));b[10]=k*(g*z-f*D)-r*(d*z-q*D)+F*(d*f-q*g);b[11]=-(k*(g*B-f*n)-r*(d*B-q*n)+h*
(d*f-q*g));b[12]=-(r*(n*e-t*D)-h*(g*e-p*D)+F*(g*t-p*n));b[13]=k*(n*e-t*D)-h*(d*e-l*D)+F*(d*t-l*n);b[14]=-(k*(g*e-p*D)-r*(d*e-l*D)+F*(d*p-l*g));b[15]=k*(g*t-p*n)-r*(d*t-l*n)+h*(d*p-l*g);return b};a.determinant=function(a){var b=a[0],k=a[1],d=a[2],l=a[3],q=a[4],r=a[5],g=a[6],p=a[7],f=a[8],h=a[9],n=a[10],t=a[11],B=a[12],F=a[13],D=a[14];a=a[15];return(b*r-k*q)*(n*a-t*D)-(b*g-d*q)*(h*a-t*F)+(b*p-l*q)*(h*D-n*F)+(k*g-d*r)*(f*a-t*B)-(k*p-l*r)*(f*D-n*B)+(d*p-l*g)*(f*F-h*B)};a.multiply=function(a,b,k){var d=
a[0],l=a[1],q=a[2],r=a[3],g=a[4],p=a[5],f=a[6],h=a[7],n=a[8],t=a[9],B=a[10],F=a[11],D=a[12],e=a[13],z=a[14];a=a[15];var y=b[0],v=b[1],m=b[2],u=b[3];k[0]=y*d+v*g+m*n+u*D;k[1]=y*l+v*p+m*t+u*e;k[2]=y*q+v*f+m*B+u*z;k[3]=y*r+v*h+m*F+u*a;y=b[4];v=b[5];m=b[6];u=b[7];k[4]=y*d+v*g+m*n+u*D;k[5]=y*l+v*p+m*t+u*e;k[6]=y*q+v*f+m*B+u*z;k[7]=y*r+v*h+m*F+u*a;y=b[8];v=b[9];m=b[10];u=b[11];k[8]=y*d+v*g+m*n+u*D;k[9]=y*l+v*p+m*t+u*e;k[10]=y*q+v*f+m*B+u*z;k[11]=y*r+v*h+m*F+u*a;y=b[12];v=b[13];m=b[14];u=b[15];k[12]=y*d+
v*g+m*n+u*D;k[13]=y*l+v*p+m*t+u*e;k[14]=y*q+v*f+m*B+u*z;k[15]=y*r+v*h+m*F+u*a;return k};a.mul=a.multiply;a.translate=function(a,b,k){var d=b[0],l=b[1];b=b[2];var q,r,g,p,f,h,n,t,B,F,D,e;a===k?(k[12]=a[0]*d+a[4]*l+a[8]*b+a[12],k[13]=a[1]*d+a[5]*l+a[9]*b+a[13],k[14]=a[2]*d+a[6]*l+a[10]*b+a[14],k[15]=a[3]*d+a[7]*l+a[11]*b+a[15]):(q=a[0],r=a[1],g=a[2],p=a[3],f=a[4],h=a[5],n=a[6],t=a[7],B=a[8],F=a[9],D=a[10],e=a[11],k[0]=q,k[1]=r,k[2]=g,k[3]=p,k[4]=f,k[5]=h,k[6]=n,k[7]=t,k[8]=B,k[9]=F,k[10]=D,k[11]=e,
k[12]=q*d+f*l+B*b+a[12],k[13]=r*d+h*l+F*b+a[13],k[14]=g*d+n*l+D*b+a[14],k[15]=p*d+t*l+e*b+a[15]);return k};a.scale=function(a,b,k){var d=b[0],l=b[1];b=b[2];k[0]=a[0]*d;k[1]=a[1]*d;k[2]=a[2]*d;k[3]=a[3]*d;k[4]=a[4]*l;k[5]=a[5]*l;k[6]=a[6]*l;k[7]=a[7]*l;k[8]=a[8]*b;k[9]=a[9]*b;k[10]=a[10]*b;k[11]=a[11]*b;k[12]=a[12];k[13]=a[13];k[14]=a[14];k[15]=a[15];return k};a.rotate=function(a,b,k,d){var l=k[0],q=k[1];k=k[2];var r=Math.sqrt(l*l+q*q+k*k),g,p,f,h,n,t,B,F,D,e,z,y,v,m,u,K,E,M,J,O;if(1E-7>Math.abs(r))return null;
r=1/r;l*=r;q*=r;k*=r;g=Math.sin(b);p=Math.cos(b);f=1-p;b=a[0];r=a[1];h=a[2];n=a[3];t=a[4];B=a[5];F=a[6];D=a[7];e=a[8];z=a[9];y=a[10];v=a[11];m=l*l*f+p;u=q*l*f+k*g;K=k*l*f-q*g;E=l*q*f-k*g;M=q*q*f+p;J=k*q*f+l*g;O=l*k*f+q*g;l=q*k*f-l*g;q=k*k*f+p;d[0]=b*m+t*u+e*K;d[1]=r*m+B*u+z*K;d[2]=h*m+F*u+y*K;d[3]=n*m+D*u+v*K;d[4]=b*E+t*M+e*J;d[5]=r*E+B*M+z*J;d[6]=h*E+F*M+y*J;d[7]=n*E+D*M+v*J;d[8]=b*O+t*l+e*q;d[9]=r*O+B*l+z*q;d[10]=h*O+F*l+y*q;d[11]=n*O+D*l+v*q;a!==d&&(d[12]=a[12],d[13]=a[13],d[14]=a[14],d[15]=a[15]);
return d};a.rotateX=function(a,b,k){var d=Math.sin(b);b=Math.cos(b);var l=a[4],q=a[5],r=a[6],g=a[7],p=a[8],f=a[9],h=a[10],n=a[11];a!==k&&(k[0]=a[0],k[1]=a[1],k[2]=a[2],k[3]=a[3],k[12]=a[12],k[13]=a[13],k[14]=a[14],k[15]=a[15]);k[4]=l*b+p*d;k[5]=q*b+f*d;k[6]=r*b+h*d;k[7]=g*b+n*d;k[8]=p*b-l*d;k[9]=f*b-q*d;k[10]=h*b-r*d;k[11]=n*b-g*d;return k};a.rotateY=function(a,b,k){var d=Math.sin(b);b=Math.cos(b);var l=a[0],q=a[1],r=a[2],g=a[3],p=a[8],f=a[9],h=a[10],n=a[11];a!==k&&(k[4]=a[4],k[5]=a[5],k[6]=a[6],
k[7]=a[7],k[12]=a[12],k[13]=a[13],k[14]=a[14],k[15]=a[15]);k[0]=l*b-p*d;k[1]=q*b-f*d;k[2]=r*b-h*d;k[3]=g*b-n*d;k[8]=l*d+p*b;k[9]=q*d+f*b;k[10]=r*d+h*b;k[11]=g*d+n*b;return k};a.rotateZ=function(a,b,k){var d=Math.sin(b);b=Math.cos(b);var l=a[0],q=a[1],r=a[2],g=a[3],p=a[4],f=a[5],h=a[6],n=a[7];a!==k&&(k[8]=a[8],k[9]=a[9],k[10]=a[10],k[11]=a[11],k[12]=a[12],k[13]=a[13],k[14]=a[14],k[15]=a[15]);k[0]=l*b+p*d;k[1]=q*b+f*d;k[2]=r*b+h*d;k[3]=g*b+n*d;k[4]=p*b-l*d;k[5]=f*b-q*d;k[6]=h*b-r*d;k[7]=n*b-g*d;return k};
a.fromTranslation=function(a,b){b[0]=1;b[1]=0;b[2]=0;b[3]=0;b[4]=0;b[5]=1;b[6]=0;b[7]=0;b[8]=0;b[9]=0;b[10]=1;b[11]=0;b[12]=a[0];b[13]=a[1];b[14]=a[2];b[15]=1;return b};a.fromScaling=function(a,b){b[0]=a[0];b[1]=0;b[2]=0;b[3]=0;b[4]=0;b[5]=a[1];b[6]=0;b[7]=0;b[8]=0;b[9]=0;b[10]=a[2];b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};a.fromRotation=function(a,b,k){var d=b[0],l=b[1];b=b[2];var q=Math.sqrt(d*d+l*l+b*b),r;if(1E-7>Math.abs(q))return null;q=1/q;d*=q;l*=q;b*=q;q=Math.sin(a);a=Math.cos(a);
r=1-a;k[0]=d*d*r+a;k[1]=l*d*r+b*q;k[2]=b*d*r-l*q;k[3]=0;k[4]=d*l*r-b*q;k[5]=l*l*r+a;k[6]=b*l*r+d*q;k[7]=0;k[8]=d*b*r+l*q;k[9]=l*b*r-d*q;k[10]=b*b*r+a;k[11]=0;k[12]=0;k[13]=0;k[14]=0;k[15]=1;return k};a.fromXRotation=function(a,b){var k=Math.sin(a),d=Math.cos(a);b[0]=1;b[1]=0;b[2]=0;b[3]=0;b[4]=0;b[5]=d;b[6]=k;b[7]=0;b[8]=0;b[9]=-k;b[10]=d;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};a.fromYRotation=function(a,b){var k=Math.sin(a),d=Math.cos(a);b[0]=d;b[1]=0;b[2]=-k;b[3]=0;b[4]=0;b[5]=1;b[6]=
0;b[7]=0;b[8]=k;b[9]=0;b[10]=d;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};a.fromZRotation=function(a,b){var k=Math.sin(a),d=Math.cos(a);b[0]=d;b[1]=k;b[2]=0;b[3]=0;b[4]=-k;b[5]=d;b[6]=0;b[7]=0;b[8]=0;b[9]=0;b[10]=1;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};a.fromRotationTranslation=function(a,b,k){var d=a[0],l=a[1],q=a[2],r=a[3],g=d+d,p=l+l,f=q+q;a=d*g;var h=d*p,d=d*f,n=l*p,l=l*f,q=q*f,g=r*g,p=r*p,r=r*f;k[0]=1-(n+q);k[1]=h+r;k[2]=d-p;k[3]=0;k[4]=h-r;k[5]=1-(a+q);k[6]=l+g;k[7]=0;k[8]=
d+p;k[9]=l-g;k[10]=1-(a+n);k[11]=0;k[12]=b[0];k[13]=b[1];k[14]=b[2];k[15]=1;return k};a.fromQuat=function(a,b){var k=a[0],d=a[1],l=a[2],q=a[3],r=k+k,g=d+d,p=l+l,k=k*r,f=d*r,d=d*g,h=l*r,n=l*g,l=l*p,r=q*r,g=q*g,q=q*p;b[0]=1-d-l;b[1]=f+q;b[2]=h-g;b[3]=0;b[4]=f-q;b[5]=1-k-l;b[6]=n+r;b[7]=0;b[8]=h+g;b[9]=n-r;b[10]=1-k-d;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};a.frustum=function(a,b,k,d,l,q,r){var g=1/(b-a),p=1/(d-k),f=1/(l-q);r[0]=2*l*g;r[1]=0;r[2]=0;r[3]=0;r[4]=0;r[5]=2*l*p;r[6]=0;r[7]=0;r[8]=
(b+a)*g;r[9]=(d+k)*p;r[10]=(q+l)*f;r[11]=-1;r[12]=0;r[13]=0;r[14]=q*l*2*f;r[15]=0;return r};a.perspective=function(a,b,k,d,l){a=1/Math.tan(a/2);var q=1/(k-d);l[0]=a/b;l[1]=0;l[2]=0;l[3]=0;l[4]=0;l[5]=a;l[6]=0;l[7]=0;l[8]=0;l[9]=0;l[10]=(d+k)*q;l[11]=-1;l[12]=0;l[13]=0;l[14]=2*d*k*q;l[15]=0;return l};a.perspectiveFromFieldOfView=function(a,b,k,d){var l=Math.tan(a.upDegrees*Math.PI/180),q=Math.tan(a.downDegrees*Math.PI/180),r=Math.tan(a.leftDegrees*Math.PI/180);a=Math.tan(a.rightDegrees*Math.PI/180);
var g=2/(r+a),p=2/(l+q);d[0]=g;d[1]=0;d[2]=0;d[3]=0;d[4]=0;d[5]=p;d[6]=0;d[7]=0;d[8]=-((r-a)*g*.5);d[9]=(l-q)*p*.5;d[10]=k/(b-k);d[11]=-1;d[12]=0;d[13]=0;d[14]=k*b/(b-k);d[15]=0;return d};a.ortho=function(a,b,k,d,l,q,r){var g=1/(a-b),p=1/(k-d),f=1/(l-q);r[0]=-2*g;r[1]=0;r[2]=0;r[3]=0;r[4]=0;r[5]=-2*p;r[6]=0;r[7]=0;r[8]=0;r[9]=0;r[10]=2*f;r[11]=0;r[12]=(a+b)*g;r[13]=(d+k)*p;r[14]=(q+l)*f;r[15]=1;return r};a.lookAt=function(c,b,k,d){var l,q,r,g,p,f,h,n,t=c[0],B=c[1];c=c[2];r=k[0];g=k[1];q=k[2];h=b[0];
k=b[1];l=b[2];if(1E-7>Math.abs(t-h)&&1E-7>Math.abs(B-k)&&1E-7>Math.abs(c-l))return a.identity(d);b=t-h;k=B-k;h=c-l;n=1/Math.sqrt(b*b+k*k+h*h);b*=n;k*=n;h*=n;l=g*h-q*k;q=q*b-r*h;r=r*k-g*b;(n=Math.sqrt(l*l+q*q+r*r))?(n=1/n,l*=n,q*=n,r*=n):r=q=l=0;g=k*r-h*q;p=h*l-b*r;f=b*q-k*l;(n=Math.sqrt(g*g+p*p+f*f))?(n=1/n,g*=n,p*=n,f*=n):f=p=g=0;d[0]=l;d[1]=g;d[2]=b;d[3]=0;d[4]=q;d[5]=p;d[6]=k;d[7]=0;d[8]=r;d[9]=f;d[10]=h;d[11]=0;d[12]=-(l*t+q*B+r*c);d[13]=-(g*t+p*B+f*c);d[14]=-(b*t+k*B+h*c);d[15]=1;return d};a.str=
function(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"};a.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2)+Math.pow(a[9],2)+Math.pow(a[10],2)+Math.pow(a[11],2)+Math.pow(a[12],2)+Math.pow(a[13],2)+Math.pow(a[14],2)+Math.pow(a[15],
2))};"undefined"!==typeof a&&(a.mat4=a)};b4w.module.mat4=b4w.module.__mat4;b4w.module.__md5=function(a,p){function t(a,l){var g=a[0],p=a[1],f=a[2],h=a[3],g=b(g,p,f,h,l[0],7,-680876936),h=b(h,g,p,f,l[1],12,-389564586),f=b(f,h,g,p,l[2],17,606105819),p=b(p,f,h,g,l[3],22,-1044525330),g=b(g,p,f,h,l[4],7,-176418897),h=b(h,g,p,f,l[5],12,1200080426),f=b(f,h,g,p,l[6],17,-1473231341),p=b(p,f,h,g,l[7],22,-45705983),g=b(g,p,f,h,l[8],7,1770035416),h=b(h,g,p,f,l[9],12,-1958414417),f=b(f,h,g,p,l[10],17,-42063),p=b(p,f,h,g,l[11],22,-1990404162),g=b(g,p,f,h,l[12],7,1804603682),h=b(h,g,p,
f,l[13],12,-40341101),f=b(f,h,g,p,l[14],17,-1502002290),p=b(p,f,h,g,l[15],22,1236535329),g=k(g,p,f,h,l[1],5,-165796510),h=k(h,g,p,f,l[6],9,-1069501632),f=k(f,h,g,p,l[11],14,643717713),p=k(p,f,h,g,l[0],20,-373897302),g=k(g,p,f,h,l[5],5,-701558691),h=k(h,g,p,f,l[10],9,38016083),f=k(f,h,g,p,l[15],14,-660478335),p=k(p,f,h,g,l[4],20,-405537848),g=k(g,p,f,h,l[9],5,568446438),h=k(h,g,p,f,l[14],9,-1019803690),f=k(f,h,g,p,l[3],14,-187363961),p=k(p,f,h,g,l[8],20,1163531501),g=k(g,p,f,h,l[13],5,-1444681467),
h=k(h,g,p,f,l[2],9,-51403784),f=k(f,h,g,p,l[7],14,1735328473),p=k(p,f,h,g,l[12],20,-1926607734),g=c(p^f^h,g,p,l[5],4,-378558),h=c(g^p^f,h,g,l[8],11,-2022574463),f=c(h^g^p,f,h,l[11],16,1839030562),p=c(f^h^g,p,f,l[14],23,-35309556),g=c(p^f^h,g,p,l[1],4,-1530992060),h=c(g^p^f,h,g,l[4],11,1272893353),f=c(h^g^p,f,h,l[7],16,-155497632),p=c(f^h^g,p,f,l[10],23,-1094730640),g=c(p^f^h,g,p,l[13],4,681279174),h=c(g^p^f,h,g,l[0],11,-358537222),f=c(h^g^p,f,h,l[3],16,-722521979),p=c(f^h^g,p,f,l[6],23,76029189),
g=c(p^f^h,g,p,l[9],4,-640364487),h=c(g^p^f,h,g,l[12],11,-421815835),f=c(h^g^p,f,h,l[15],16,530742520),p=c(f^h^g,p,f,l[2],23,-995338651),g=d(g,p,f,h,l[0],6,-198630844),h=d(h,g,p,f,l[7],10,1126891415),f=d(f,h,g,p,l[14],15,-1416354905),p=d(p,f,h,g,l[5],21,-57434055),g=d(g,p,f,h,l[12],6,1700485571),h=d(h,g,p,f,l[3],10,-1894986606),f=d(f,h,g,p,l[10],15,-1051523),p=d(p,f,h,g,l[1],21,-2054922799),g=d(g,p,f,h,l[8],6,1873313359),h=d(h,g,p,f,l[15],10,-30611744),f=d(f,h,g,p,l[6],15,-1560198380),p=d(p,f,h,g,
l[13],21,1309151649),g=d(g,p,f,h,l[4],6,-145523070),h=d(h,g,p,f,l[11],10,-1120210379),f=d(f,h,g,p,l[2],15,718787259),p=d(p,f,h,g,l[9],21,-343485551);a[0]=g+a[0]&4294967295;a[1]=p+a[1]&4294967295;a[2]=f+a[2]&4294967295;a[3]=h+a[3]&4294967295}function c(a,b,c,d,f,h){b=(b+a&4294967295)+(d+h&4294967295)&4294967295;return(b<<f|b>>>32-f)+c&4294967295}function b(a,b,d,k,f,h,l){return c(b&d|~b&k,a,b,f,h,l)}function k(a,b,d,k,f,h,l){return c(b&k|d&~k,a,b,f,h,l)}function d(a,b,d,k,f,h,l){return c(d^(b|~k),
a,b,f,h,l)}var l="0123456789abcdef".split("");a.hexdigest=function(a){var b=a,c=b.length;a=[1732584193,-271733879,-1732584194,271733878];var d;for(d=64;d<=b.length;d+=64){for(var f=b.substring(d-64,d),h=[],k=void 0,k=0;64>k;k+=4)h[k>>2]=f.charCodeAt(k)+(f.charCodeAt(k+1)<<8)+(f.charCodeAt(k+2)<<16)+(f.charCodeAt(k+3)<<24);t(a,h)}b=b.substring(d-64);f=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(d=0;d<b.length;d++)f[d>>2]|=b.charCodeAt(d)<<(d%4<<3);f[d>>2]|=128<<(d%4<<3);if(55<d)for(t(a,f),d=0;16>d;d++)f[d]=
0;f[14]=8*c;t(a,f);for(b=0;b<a.length;b++){c=a;d=b;f=a[b];h="";for(k=0;4>k;k++)h+=l[f>>8*k+4&15]+l[f>>8*k&15];c[d]=h}return a.join("")}};b4w.module.shader_texts=function(a,p){a["anchors.glslf"]={type:"group",parts:[{type:"include",file:"precision_statement.glslf"},{type:"textline",tokens:"void main ( ) { gl_FragColor = vec4 ( 1.0 ) ; }".split(" ")}]};a["anchors.glslv"]={type:"group",parts:[{type:"var",name:"ANCHOR_NUM",tokens:["0"]},{type:"include",file:"math.glslv"},{type:"textline",tokens:"attribute float a_index ; uniform vec3 u_position [ ANCHOR_NUM ] ; uniform mat4 u_view_proj_matrix ; void main ( ) { gl_Position = u_view_proj_matrix * vec4 ( u_position [ int ( a_index ) ] , 1.0 ) ; gl_PointSize = 4.0 ; }".split(" ")}]};
a["color_id.glslf"]={type:"group",parts:[{type:"var",name:"WATER_LEVEL",tokens:["0.0"]},{type:"var",name:"WAVES_HEIGHT",tokens:["0.0"]},{type:"var",name:"NUM_LAMP_LIGHTS",tokens:["0"]},{type:"var",name:"NUM_VALUES",tokens:["0"]},{type:"var",name:"NUM_RGBS",tokens:["0"]},{type:"var",name:"MAPPING_TRS_MATRIX",tokens:["mat4","(","0.0",")"]},{type:"var",name:"MAPPING_SCALE",tokens:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_TRANSLATION",tokens:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_MIN_CLIP",
tokens:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_MAX_CLIP",tokens:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_IS_NORMAL",tokens:["0.0"]},{type:"var",name:"RGB_IND",tokens:["0"]},{type:"var",name:"VALUE_IND",tokens:["0"]},{type:"var",name:"LAMP_INDEX",tokens:["0"]},{type:"var",name:"NUM_LIGHTS",tokens:["0"]},{type:"var",name:"LAMP_IND",tokens:["0"]},{type:"var",name:"LAMP_SPOT_SIZE",tokens:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",tokens:["0"]},{type:"var",name:"LAMP_LIGHT_DIST",tokens:["0"]},
{type:"var",name:"LAMP_LIGHT_FACT_IND",tokens:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",tokens:["rgb"]},{type:"var",name:"LAMP_SHADOW_MAP_IND",tokens:["0"]},{type:"var",name:"NUM_LFACTORS",tokens:["0"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"std_enums.glsl"},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"include",file:"pack.glslf"},{type:"include",file:"procedural.glslf"},{type:"condition",
parts:[{type:"if",expression:["CAUSTICS"],group:{type:"group",parts:[{type:"include",file:"caustics.glslf"}]}}]},{type:"include",file:"color_util.glslf"},{type:"include",file:"math.glslv"}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform float u_time ; uniform float u_environment_energy ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["NUM_LIGHTS",0,{type:"g_expr",places:2}],
group:{type:"group",parts:[{type:"textline",tokens:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},{type:"textline",tokens:["uniform","vec3","u_camera_eye_frag",";"]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_B4W_VECTOR_VIEW","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},{type:"logical_or_expr",places:2}],
group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat3","u_view_tsr_frag",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_ENVIRONMENT_LIGHT","SKY_TEXTURE",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","samplerCube","u_sky_texture",";"]}]}},{type:"elif",expression:["USE_ENVIRONMENT_LIGHT","SKY_COLOR",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec4","u_diffuse_color",";"]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:"uniform sampler2D u_sampler ; uniform float u_alpha_factor ;".split(" ")}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_OUTLINE",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec3","u_color_id",";"]}]}}]},
{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","sampler2D","u_plane_reflection",";"]}]}},{type:"elif",expression:["REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","samplerCube",
"u_cube_reflection",";"]}]}},{type:"elif",expression:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_B4W_REFRACTION"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","sampler2D","u_refractmap",";"]},{type:"condition",parts:[{type:"if",expression:["USE_REFRACTION"],group:{type:"group",parts:[{type:"textline",tokens:["uniform",
"PRECISION","sampler2D","u_scene_depth",";"]}]}}]}]}}]},{type:"textline",tokens:"uniform float u_emit ; uniform float u_ambient ; uniform vec4 u_fresnel_params ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","float","u_mirror_factor",";"]}]}},{type:"elif",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",
tokens:["uniform","vec4","u_refl_plane",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_LAMP"],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec3 u_lamp_light_positions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_directions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_color_intensities [ NUM_LAMP_LIGHTS ] ; uniform vec4 u_lamp_light_factors [ NUM_LAMP_LIGHTS ] ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_VALUE"],group:{type:"group",
parts:[{type:"textline",tokens:"uniform float u_node_values [ NUM_VALUES ] ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_RGB"],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec3 u_node_rgbs [ NUM_RGBS ] ;".split(" ")}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_OUTLINE"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","float","u_outline_intensity",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",
{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"varying vec3 bC ; varying vec4 bD ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",{type:"logical_or_expr",places:4}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","bE",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CALC_TBN_SPACE"],group:{type:"group",parts:[{type:"textline",tokens:["varying",
"vec4","bF",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","bG",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_B4W_REFRACTION","USE_REFRACTION",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","float","bH",";"]}]}}]},{type:"condition",
parts:[{type:"if",expression:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"varying vec4 bI ; varying vec4 bJ ; varying vec4 bK ; varying vec4 bL ; uniform vec4 u_pcf_blur_radii ; uniform vec4 u_csm_center_dists ; uniform sampler2D u_shadow_map0 ; uniform sampler2D u_shadow_map1 ; uniform sampler2D u_shadow_map2 ; uniform sampler2D u_shadow_map3 ; uniform sampler2D u_shadow_mask ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",
parts:[{type:"condition",parts:[{type:"if",expression:["TEXTURE_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec2","bM",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"include",file:"shadow.glslf"},{type:"include",file:"mirror.glslf"},{type:"include",file:"environment.glslf"},{type:"condition",parts:[{type:"if",expression:["USE_NODE_B4W_REFRACTION"],group:{type:"group",parts:[{type:"condition",
parts:[{type:"if",expression:["USE_REFRACTION"],group:{type:"group",parts:[{type:"include",file:"refraction.glslf"}]}}]}]}}]},{type:"include",file:"nodes.glslf"}]}}]},{type:"textline",tokens:"void main ( ) { mat4 qN ; float qO , qP ; vec4 qQ ; vec3 qR , qS , qT , qU ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["ALPHA"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["NODES"],group:{type:"group",parts:[{type:"textline",tokens:"qR = u_camera_eye_frag - bC ; qR = normalize ( qR ) ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["USE_NODE_B4W_VECTOR_VIEW","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"qN = O ( u_view_tsr_frag ) ; qM ( qR , qN , qS , qT , qU , qQ , qO ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"qM ( qR , mat4 ( 0.0 ) , qS , qT , qU , qQ , qO ) ;".split(" ")}]}}]},{type:"textline",tokens:["qO","=","qO",";"]}]}},{type:"else",
group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["TEXTURE_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:"qO = ( texture2D ( u_sampler , bM ) ) . a ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"qP = u_alpha_factor * qO ; qP += ( 1.0 - step ( 0.0 , qP ) ) ; qO = mix ( qP , 1.0 , u_diffuse_color . a ) ;".split(" ")}]}}]}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"qO = u_diffuse_color . a ;".split(" ")}]}}]}]}}]},{type:"textline",tokens:"if ( qO < 0.5 ) discard ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_OUTLINE"],group:{type:"group",parts:[{type:"textline",tokens:"gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , u_outline_intensity ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"gl_FragColor = vec4 ( u_color_id , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",tokens:["}"]}]};a["color_id.glslv"]={type:"group",parts:[{type:"var",name:"AU_QUALIFIER",tokens:["uniform"]},{type:"var",name:"MAX_BONES",tokens:["0"]},{type:"var",name:"VERTEX_ANIM_MIX_NORMALS_FACTOR",tokens:["u_va_frame_factor"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",file:"scale_texcoord.glslv"},{type:"textline",tokens:["attribute","vec3",
"a_position",";"]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",places:3},{type:"logical_or_expr",places:5}],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec3","a_normal",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",
expression:["CALC_TBN_SPACE"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec4","a_tangent",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["SKINNED"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["WIND_BEND"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["MAIN_BEND_COL"],group:{type:"group",parts:[{type:"textline",tokens:["attribute",
"float","a_bending_col_main",";"]},{type:"condition",parts:[{type:"if",expression:["DETAIL_BEND"],group:{type:"group",parts:[{type:"textline",tokens:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",tokens:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["BEND_CENTER_ONLY"],
group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["WIND_BEND","BILLBOARD",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["VERTEX_ANIM"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec3","a_position_next",";"]},{type:"condition",parts:[{type:"if",
expression:["NODES","ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",{type:"logical_or_expr",places:4}],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec3","a_normal_next",";"]},{type:"condition",parts:[{type:"if",expression:["CALC_TBN_SPACE"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec4","a_tangent_next",";"]}]}}]}]}}]}]}}]}]}}]},
{type:"condition",parts:[{type:"if",expression:["TEXTURE_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["STATIC_BATCH"],group:{type:"group",parts:[{type:"textline",tokens:"const mat3 u_model_tsr = mat3 ( 0.0 , 0.0 , 0.0 , 1.0 , 0.0 , 0.0 , 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat3","u_model_tsr",";"]}]}}]},{type:"textline",
tokens:"uniform mat3 u_view_tsr ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["BILLBOARD"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["SMAA_JITTER"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec2","u_subpixel_jitter",
";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_B4W_REFRACTION"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","PRECISION","float","u_view_max_depth",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["SKINNED"],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ; uniform vec4 u_arm_rel_trans ; uniform vec4 u_arm_rel_quat ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["FRAMES_BLENDING"],
group:{type:"group",parts:[{type:"textline",tokens:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["WIND_BEND"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["BILLBOARD_JITTERED"],group:{type:"group",parts:[{type:"textline",tokens:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",tokens:"uniform vec3 u_wind ; uniform float u_time ;".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["VERTEX_ANIM"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec3","u_texture_scale",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"varying vec3 bC ; varying vec4 bD ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",places:3},{type:"logical_or_expr",places:5}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","bE",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CALC_TBN_SPACE"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bF",";"]}]}}]},{type:"condition",parts:[{type:"if",
expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","bG",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_B4W_REFRACTION","REFRACTIVE",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","float","bH",";"]}]}}]}]}},{type:"else",group:{type:"group",parts:[{type:"condition",parts:[{type:"if",
expression:["TEXTURE_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec2","bM",";"]}]}}]}]}}]},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"include",file:"nodes.glslv"}]}}]},{type:"textline",tokens:"void main ( ) { vec4 tv ; float tw , tx , ty ; vec3 tz , tA , tB , tC , tD , tE ; mat4 tF , tG , tH ; tF = O ( u_view_tsr ) ; tz = a_position ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA","CALC_TBN_SPACE","USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",places:3},{type:"logical_or_expr",places:5},{type:"logical_and_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:["tA","=","a_normal",";"]},{type:"condition",parts:[{type:"if",expression:["CALC_TBN_SPACE"],group:{type:"group",parts:[{type:"textline",tokens:"tB = vec3 ( a_tangent ) ; tC = a_tangent [ 3 ] * cross ( tA , tB ) ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"tB = vec3 ( 0.0 ) ; tC = vec3 ( 0.0 ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"tA = vec3 ( 0.0 ) ; tB = vec3 ( 0.0 ) ; tC = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["VERTEX_ANIM"],group:{type:"group",parts:[{type:"textline",tokens:"tz = mix ( tz , a_position_next , u_va_frame_factor ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["NODES",
"ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",{type:"logical_or_expr",places:4}],group:{type:"group",parts:[{type:"textline",tokens:"tA = mix ( tA , a_normal_next , VERTEX_ANIM_MIX_NORMALS_FACTOR ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["CALC_TBN_SPACE"],group:{type:"group",parts:[{type:"textline",tokens:"tD = vec3 ( a_tangent ) ; tE = a_tangent_next [ 3 ] * cross ( a_normal_next , tD ) ; tB = mix ( tB , tD , u_va_frame_factor ) ; tC = mix ( tC , tE , u_va_frame_factor ) ;".split(" ")}]}}]}]}}]}]}}]},
{type:"condition",parts:[{type:"if",expression:["SKINNED"],group:{type:"group",parts:[{type:"textline",tokens:"sB ( tz , tB , tC , tA ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["WIND_BEND","BILLBOARD",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["tC","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"tC = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"textline",tokens:"tG = O ( u_model_tsr ) ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["BILLBOARD"],group:{type:"group",parts:[{type:"textline",tokens:"tB = ( tG * vec4 ( tC , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["BILLBOARD_PRES_GLOB_ORIENTATION","STATIC_BATCH",{type:"logic_negative_expr",places:1},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"tH = ru ( u_camera_eye , tB , tF , tG ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",
tokens:"tH = ro ( u_camera_eye , tB , tF ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["WIND_BEND","BILLBOARD_JITTERED",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"tH = tH * rg ( u_wind , u_time , u_jitter_amp , u_jitter_freq , tB ) ;".split(" ")}]}}]},{type:"textline",tokens:"c tI = rB ( tz - tC , tC , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , tH ) ; tI . b = tB ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",
tokens:"c tI = rB ( tz , tC , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , tG ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["WIND_BEND"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"tp ( tI . a , tI . b , tA ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["MAIN_BEND_COL","DETAIL_BEND",
{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["tA","=","a_normal",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"tA = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"textline",tokens:"tp ( tI . a , tI . b , tA ) ;".split(" ")}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",places:2},{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["TEXTURE_COLOR"],
group:{type:"group",parts:[{type:"textline",tokens:"bM = rE ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"bC = tI . a ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",places:3},{type:"logical_or_expr",
places:5}],group:{type:"group",parts:[{type:"textline",tokens:"bE = tI . e ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["CALC_TBN_SPACE"],group:{type:"group",parts:[{type:"textline",tokens:"tw = ( dot ( cross ( tI . e , tI . c ) , tI . d ) < 0.0 ) ? - 1.0 : 1.0 ; bF = vec4 ( tI . c , tw ) ;".split(" ")}]}}]},{type:"textline",tokens:"bD = tF * vec4 ( tI . a , 1.0 ) ; tv = u_proj_matrix * bD ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SMAA_JITTER"],group:{type:"group",
parts:[{type:"textline",tokens:"tv . xy += u_subpixel_jitter * tv . w ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"tw = tv . x ; tx = tv . y ; ty = tv . w ; bG . x = ( tw + ty ) / 2.0 ; bG . y = ( tx + ty ) / 2.0 ; bG . z = ty ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_B4W_REFRACTION",
"REFRACTIVE",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"bH = - bD . z / u_view_max_depth ;".split(" ")}]}}]},{type:"textline",tokens:["tu","(",")",";"]}]}}]},{type:"textline",tokens:"gl_Position = u_proj_matrix * tF * vec4 ( tI . a , 1.0 ) ; }".split(" ")}]};a["depth.glslf"]={type:"group",parts:[{type:"var",name:"WATER_LEVEL",tokens:["0.0"]},{type:"var",name:"WAVES_HEIGHT",tokens:["0.0"]},{type:"var",name:"NUM_LAMP_LIGHTS",tokens:["0"]},{type:"var",name:"NUM_VALUES",
tokens:["0"]},{type:"var",name:"NUM_RGBS",tokens:["0"]},{type:"var",name:"MAPPING_TRS_MATRIX",tokens:["mat4","(","0.0",")"]},{type:"var",name:"MAPPING_SCALE",tokens:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_TRANSLATION",tokens:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_MIN_CLIP",tokens:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_MAX_CLIP",tokens:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_IS_NORMAL",tokens:["0.0"]},{type:"var",name:"RGB_IND",tokens:["0"]},{type:"var",name:"VALUE_IND",
tokens:["0"]},{type:"var",name:"LAMP_INDEX",tokens:["0"]},{type:"var",name:"NUM_LIGHTS",tokens:["0"]},{type:"var",name:"LAMP_IND",tokens:["0"]},{type:"var",name:"LAMP_SPOT_SIZE",tokens:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",tokens:["0"]},{type:"var",name:"LAMP_LIGHT_DIST",tokens:["0"]},{type:"var",name:"LAMP_LIGHT_FACT_IND",tokens:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",tokens:["rgb"]},{type:"var",name:"LAMP_SHADOW_MAP_IND",tokens:["0"]},{type:"var",name:"NUM_LFACTORS",tokens:["0"]},{type:"include",
file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"condition",parts:[{type:"if",expression:["SHADELESS",{type:"logic_negative_expr",places:1},"NODES","ALPHA",{type:"logical_and_expr",places:2},"SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",places:2},{type:"logical_or_expr",places:3}],group:{type:"group",parts:[{type:"include",file:"procedural.glslf"}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",
parts:[{type:"include",file:"pack.glslf"},{type:"condition",parts:[{type:"if",expression:["CAUSTICS"],group:{type:"group",parts:[{type:"include",file:"caustics.glslf"}]}}]},{type:"include",file:"color_util.glslf"},{type:"include",file:"math.glslv"}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform float u_time ; uniform float u_environment_energy ;".split(" ")},{type:"condition",parts:[{type:"if",
expression:["NUM_LIGHTS",0,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},{type:"textline",tokens:["uniform","vec3","u_camera_eye_frag",";"]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_B4W_VECTOR_VIEW","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",
places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat3","u_view_tsr_frag",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_ENVIRONMENT_LIGHT","SKY_TEXTURE",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","samplerCube","u_sky_texture",";"]}]}},{type:"elif",expression:["USE_ENVIRONMENT_LIGHT","SKY_COLOR",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",
tokens:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","sampler2D","u_plane_reflection",";"]}]}},{type:"elif",expression:["REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","samplerCube","u_cube_reflection",";"]}]}},{type:"elif",
expression:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"textline",tokens:"uniform float u_emit ; uniform float u_ambient ; uniform vec4 u_fresnel_params ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","float","u_mirror_factor",";"]}]}},
{type:"elif",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec4","u_refl_plane",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_LAMP"],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec3 u_lamp_light_positions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_directions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_color_intensities [ NUM_LAMP_LIGHTS ] ; uniform vec4 u_lamp_light_factors [ NUM_LAMP_LIGHTS ] ;".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["USE_NODE_VALUE"],group:{type:"group",parts:[{type:"textline",tokens:"uniform float u_node_values [ NUM_VALUES ] ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_RGB"],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec3 u_node_rgbs [ NUM_RGBS ] ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["TEXTURE_COLOR"],group:{type:"group",parts:[{type:"textline",
tokens:"uniform sampler2D u_colormap0 ; uniform float u_alpha_factor ;".split(" ")}]}}]},{type:"textline",tokens:["uniform","vec4","u_diffuse_color",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec4 u_pcf_blur_radii ; uniform vec4 u_csm_center_dists ; uniform PRECISION sampler2D u_shadow_map0 ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION1",
"NUM_CAST_LAMPS",1,{type:"g_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","PRECISION","sampler2D","u_shadow_map1",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION2","NUM_CAST_LAMPS",2,{type:"g_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","PRECISION","sampler2D","u_shadow_map2",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION3",
"NUM_CAST_LAMPS",3,{type:"g_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","PRECISION","sampler2D","u_shadow_map3",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","sampler2D","u_shadow_mask",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_B4W_REFRACTION"],group:{type:"group",
parts:[{type:"textline",tokens:["uniform","sampler2D","u_refractmap",";"]},{type:"condition",parts:[{type:"if",expression:["USE_REFRACTION"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","PRECISION","sampler2D","u_scene_depth",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","bC",";"]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_MATERIAL_BEGIN",
"USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",{type:"logical_or_expr",places:4}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","bE",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CALC_TBN_SPACE"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bF",";"]}]}}]}]}},{type:"else",group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["TEXTURE_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec2","bM",
";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",places:2},"NODES","ALPHA",{type:"logical_and_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bD",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bI",";"]},
{type:"condition",parts:[{type:"if",expression:["CSM_SECTION1","NUM_CAST_LAMPS",1,{type:"g_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bJ",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION2","NUM_CAST_LAMPS",2,{type:"g_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bK",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION3",
"NUM_CAST_LAMPS",3,{type:"g_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bL",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","bG",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",
places:2}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["USE_NODE_B4W_REFRACTION","USE_REFRACTION",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","float","bH",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHADELESS",{type:"logic_negative_expr",places:1},"NODES","ALPHA",{type:"logical_and_expr",places:2},"SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",places:2},{type:"logical_or_expr",places:3}],
group:{type:"group",parts:[{type:"include",file:"shadow.glslf"}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"include",file:"mirror.glslf"},{type:"include",file:"environment.glslf"},{type:"condition",parts:[{type:"if",expression:["USE_NODE_B4W_REFRACTION"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["USE_REFRACTION"],group:{type:"group",parts:[{type:"include",file:"refraction.glslf"}]}}]}]}}]},
{type:"include",file:"nodes.glslf"}]}}]},{type:"textline",tokens:"void main ( ) { mat4 tv ; float tw , tx ; vec4 ty ; vec3 tz , tA , tB , tC ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["ALPHA"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["NODES"],group:{type:"group",parts:[{type:"textline",tokens:"tz = u_camera_eye_frag - bC ; tz = normalize ( tz ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["USE_NODE_B4W_VECTOR_VIEW","REFLECTION_TYPE",
"REFL_PLANE",{type:"equal_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"tv = O ( u_view_tsr_frag ) ; qM ( tz , tv , tA , tB , tC , ty , tw ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"qM ( tz , mat4 ( 0.0 ) , tA , tB , tC , ty , tw ) ;".split(" ")}]}}]},{type:"textline",tokens:["tw","=","tw",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["TEXTURE_COLOR"],
group:{type:"group",parts:[{type:"textline",tokens:"tw = ( texture2D ( u_colormap0 , bM ) ) . a ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"tx = u_alpha_factor * tw ; tx += ( 1.0 - step ( 0.0 , tx ) ) ; tw = mix ( tx , 1.0 , u_diffuse_color . a ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"tw = u_diffuse_color . a ;".split(" ")}]}}]}]}}]},
{type:"textline",tokens:"if ( tw < 0.5 ) discard ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["SHADOW_USAGE","NO_SHADOWS",{type:"equal_expr",places:2},"SHADOW_USAGE","SHADOW_CASTING",{type:"equal_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"gl_FragColor = vec4 ( 1.0 ) ;".split(" ")}]}},{type:"elif",expression:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",
tokens:"gl_FragColor = dr ( bD . z ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["CALC_TBN_SPACE"],group:{type:"group",parts:[{type:"textline",tokens:"gl_FragColor . a *= clamp ( bF . r , 0.999999999 , 1.0 ) ;".split(" ")}]}}]}]}}]},{type:"textline",tokens:["}"]}]};a["depth.glslv"]={type:"group",parts:[{type:"var",name:"AU_QUALIFIER",tokens:["uniform"]},
{type:"var",name:"MAX_BONES",tokens:["0"]},{type:"var",name:"NUM_CAST_LAMPS",tokens:["0"]},{type:"var",name:"SHADOW_TEX_RES",tokens:["0.0"]},{type:"var",name:"VERTEX_ANIM_MIX_NORMALS_FACTOR",tokens:["u_va_frame_factor"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",file:"scale_texcoord.glslv"},{type:"textline",tokens:["attribute","vec3","a_position",";"]},{type:"condition",
parts:[{type:"if",expression:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",places:3},"SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",places:2},{type:"logical_or_expr",places:6}],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec3","a_normal",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA","CALC_TBN_SPACE",{type:"logical_and_expr",places:3}],group:{type:"group",
parts:[{type:"textline",tokens:["attribute","vec4","a_tangent",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SKINNED"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["WIND_BEND"],
group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["MAIN_BEND_COL"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","float","a_bending_col_main",";"]},{type:"condition",parts:[{type:"if",expression:["DETAIL_BEND"],group:{type:"group",parts:[{type:"textline",tokens:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",
tokens:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["BEND_CENTER_ONLY"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["VERTEX_ANIM"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec3","a_position_next",";"]},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",
places:2}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",{type:"logical_or_expr",places:4}],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec3","a_normal_next",";"]},{type:"condition",parts:[{type:"if",expression:["CALC_TBN_SPACE"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec4","a_tangent_next",";"]}]}}]}]}}]}]}}]}]}}]},{type:"condition",parts:[{type:"if",
expression:["NODES","ALPHA",{type:"logical_and_expr",places:2},{type:"logic_negative_expr",places:1},"TEXTURE_COLOR",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["STATIC_BATCH"],group:{type:"group",parts:[{type:"textline",tokens:"const mat3 u_model_tsr = mat3 ( 0.0 , 0.0 , 0.0 , 1.0 , 0.0 , 0.0 , 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",
parts:[{type:"textline",tokens:["uniform","mat3","u_model_tsr",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SMAA_JITTER"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{type:"textline",tokens:"uniform mat3 u_view_tsr ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform",
"vec3","u_camera_eye",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["BILLBOARD","SHADOW_USAGE","SHADOW_CASTING",{type:"equal_expr",places:2},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat3","u_shadow_cast_billboard_view_tsr",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS"],group:{type:"group",parts:[{type:"textline",tokens:"uniform PRECISION sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["SKINNED"],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ; uniform vec4 u_arm_rel_trans ; uniform vec4 u_arm_rel_quat ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["FRAMES_BLENDING"],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},
{type:"condition",parts:[{type:"if",expression:["WIND_BEND"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["BILLBOARD_JITTERED"],group:{type:"group",parts:[{type:"textline",tokens:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",tokens:"uniform vec3 u_wind ; uniform float u_time ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["VERTEX_ANIM"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","float",
"u_va_frame_factor",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",places:2},{type:"logic_negative_expr",places:1},"TEXTURE_COLOR",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec3","u_texture_scale",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","float",
"u_normal_offset",";"]},{type:"condition",parts:[{type:"if",expression:["MAC_OS_SHADOW_HACK"],group:{type:"group",parts:[{type:"textline",tokens:"uniform mat3 u_v_light_tsr [ NUM_CAST_LAMPS ] ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"uniform vec4 u_v_light_ts [ NUM_CAST_LAMPS ] ; uniform vec4 u_v_light_r [ NUM_CAST_LAMPS ] ;".split(" ")}]}}]},{type:"textline",tokens:["uniform","mat4","u_p_light_matrix0",";"]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION1",
"NUM_CAST_LAMPS",1,{type:"g_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat4","u_p_light_matrix1",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION2","NUM_CAST_LAMPS",2,{type:"g_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat4","u_p_light_matrix2",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION3","NUM_CAST_LAMPS",
3,{type:"g_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat4","u_p_light_matrix3",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_B4W_REFRACTION"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","PRECISION","float","u_view_max_depth",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying",
"vec3","bC",";"]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",places:3},{type:"logical_or_expr",places:5}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","bE",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CALC_TBN_SPACE"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bF",";"]}]}}]}]}},{type:"else",
group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["TEXTURE_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec2","bM",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",places:2},"NODES","ALPHA",{type:"logical_and_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bD",";"]}]}}]},{type:"condition",parts:[{type:"if",
expression:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bI",";"]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION1","NUM_CAST_LAMPS",1,{type:"g_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bJ",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION2","NUM_CAST_LAMPS",2,{type:"g_expr",places:2},{type:"logical_or_expr",
places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bK",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION3","NUM_CAST_LAMPS",3,{type:"g_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bL",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",places:2}],group:{type:"group",
parts:[{type:"textline",tokens:["varying","vec3","bG",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["USE_NODE_B4W_REFRACTION","REFRACTIVE",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","float","bH",";"]}]}}]}]}}]},{type:"include",file:"dynamic_grass.glslv"},{type:"include",file:"shadow.glslv"},{type:"include",
file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"include",file:"nodes.glslv"}]}}]},{type:"textline",tokens:"void main ( ) { vec2 um ; vec4 un , uo ; float up ; vec3 uq , ur , us , ut , uu , uv ; mat4 uw , ux , uy , uz ; uw = O ( u_view_tsr ) ; uq = a_position ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SHADOW_USAGE","SHADOW_MASK_GENERATION",
{type:"equal_expr",places:2},"CALC_TBN_SPACE","USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",places:3},{type:"logical_or_expr",places:6}],group:{type:"group",parts:[{type:"textline",tokens:["ur","=","a_normal",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"ur = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA","CALC_TBN_SPACE",{type:"logical_and_expr",
places:3}],group:{type:"group",parts:[{type:"textline",tokens:"us = vec3 ( a_tangent ) ; ut = a_tangent [ 3 ] * cross ( ur , us ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"us = vec3 ( 0.0 ) ; ut = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["VERTEX_ANIM"],group:{type:"group",parts:[{type:"textline",tokens:"uq = mix ( uq , a_position_next , u_va_frame_factor ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["NODES",
"ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",{type:"logical_or_expr",places:4}],group:{type:"group",parts:[{type:"textline",tokens:"ur = mix ( ur , a_normal_next , VERTEX_ANIM_MIX_NORMALS_FACTOR ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["CALC_TBN_SPACE"],group:{type:"group",parts:[{type:"textline",tokens:"uu = vec3 ( a_tangent ) ; uv = a_tangent_next [ 3 ] * cross ( a_normal_next , uu ) ; us = mix ( us , uu , u_va_frame_factor ) ; ut = mix ( ut , uv , u_va_frame_factor ) ;".split(" ")}]}}]}]}}]}]}}]},
{type:"condition",parts:[{type:"if",expression:["SKINNED"],group:{type:"group",parts:[{type:"textline",tokens:"sB ( uq , us , ut , ur ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:["ut","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"ut = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",
expression:["DYNAMIC_GRASS"],group:{type:"group",parts:[{type:"textline",tokens:"c uA = t_ ( uq , vec3 ( 0.0 ) , vec3 ( 0.0 ) , ur , ut , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , uw ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"ux = O ( u_model_tsr ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["BILLBOARD"],group:{type:"group",parts:[{type:"textline",tokens:"us = ( ux * vec4 ( ut , 1.0 ) ) . xyz ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["HAIR_BILLBOARD",{type:"logic_negative_expr",places:1},"SHADOW_USAGE","SHADOW_CASTING",{type:"equal_expr",places:2},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uy = O ( u_shadow_cast_billboard_view_tsr ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["uy","=","uw",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["BILLBOARD_PRES_GLOB_ORIENTATION","STATIC_BATCH",
{type:"logic_negative_expr",places:1},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uz = ru ( u_camera_eye , us , uy , ux ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"uz = ro ( u_camera_eye , us , uy ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["WIND_BEND","BILLBOARD_JITTERED",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uz = uz * rg ( u_wind , u_time , u_jitter_amp , u_jitter_freq , us ) ;".split(" ")}]}}]},
{type:"textline",tokens:"c uA = rB ( uq - ut , ut , vec3 ( 0.0 ) , vec3 ( 0.0 ) , ur , uz ) ; uA . b = us ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"c uA = rB ( uq , ut , vec3 ( 0.0 ) , vec3 ( 0.0 ) , ur , ux ) ;".split(" ")}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["WIND_BEND"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",
tokens:["ur","=","a_normal",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"ur = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"textline",tokens:"tp ( uA . a , uA . b , ur ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"bC = uA . a ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",
"WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",places:3},{type:"logical_or_expr",places:5}],group:{type:"group",parts:[{type:"textline",tokens:"bE = uA . e ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["CALC_TBN_SPACE"],group:{type:"group",parts:[{type:"textline",tokens:"up = ( dot ( cross ( uA . e , uA . c ) , uA . d ) < 0.0 ) ? - 1.0 : 1.0 ; bF = vec4 ( uA . c , up ) ;".split(" ")}]}}]}]}}]},{type:"textline",tokens:"un = uw * vec4 ( uA . a , 1.0 ) ; uo = u_proj_matrix * un ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["SMAA_JITTER"],group:{type:"group",parts:[{type:"textline",tokens:"uo . xy += u_subpixel_jitter * uo . w ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",
tokens:"bG = L ( uo ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_B4W_REFRACTION","REFRACTIVE",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"bH = - bD . z / u_view_max_depth ;".split(" ")}]}}]},{type:"textline",tokens:["tu","(",")",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["TEXTURE_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:"bM = rE ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]}]}}]},
{type:"condition",parts:[{type:"if",expression:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"ul ( uA . a , uA . e ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",places:2},"NODES","ALPHA",{type:"logical_and_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["bD","=","un",";"]}]}}]},{type:"condition",
parts:[{type:"if",expression:["SHADOW_USAGE","SHADOW_CASTING",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"um = ( u_proj_matrix * uw [ 3 ] ) . xy ; up = SHADOW_TEX_RES / 2.0 ; um = floor ( um * up + 0.5 ) / up - um ; uo . xy += um ;".split(" ")}]}}]},{type:"textline",tokens:["gl_Position","=","uo",";","}"]}]};a["grass_map.glslf"]={type:"group",parts:[{type:"include",file:"precision_statement.glslf"},{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS_SIZE"],
group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","um",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["varying","float","um",";"]}]}}]}]}},{type:"else",group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","um",";"]}]}}]}]}}]},{type:"textline",
tokens:["void","main","(",")","{"]},{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS_SIZE"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:["gl_FragColor","=","um",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"gl_FragColor = vec4 ( um , vec3 ( 1.0 ) ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS_COLOR"],
group:{type:"group",parts:[{type:"textline",tokens:"gl_FragColor = vec4 ( 1.0 , um ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"gl_FragColor = vec4 ( 1.0 ) ;".split(" ")}]}}]}]}}]},{type:"textline",tokens:["}"]}]};a["grass_map.glslv"]={type:"group",parts:[{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",tokens:["attribute","vec3","a_position",";"]},{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS_SIZE"],
group:{type:"group",parts:[{type:"textline",tokens:["attribute","float","a_grass_size",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec3","a_grass_color",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["STATIC_BATCH"],group:{type:"group",parts:[{type:"textline",tokens:"const mat3 u_model_tsr = mat3 ( 0.0 , 0.0 , 0.0 , 1.0 , 0.0 , 0.0 , 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",
parts:[{type:"textline",tokens:["uniform","mat3","u_model_tsr",";"]}]}}]},{type:"textline",tokens:"uniform mat3 u_view_tsr ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["BILLBOARD"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["WIND_BEND","BILLBOARD_JITTERED",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec3 u_wind ; uniform float u_time ; uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS_SIZE"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","um",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["varying","float","um",";"]}]}}]}]}},{type:"else",group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS_COLOR"],group:{type:"group",parts:[{type:"textline",
tokens:["varying","vec3","um",";"]}]}}]}]}}]},{type:"textline",tokens:"void main ( ) { vec4 un ; vec3 uo ; mat4 up , uq , ur ; up = O ( u_view_tsr ) ; uq = O ( u_model_tsr ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["BILLBOARD"],group:{type:"group",parts:[{type:"textline",tokens:"uo = ( uq * vec4 ( vec3 ( 0.0 ) , 1.0 ) ) . xyz ; ur = ro ( u_camera_eye , uo , up ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["WIND_BEND","BILLBOARD_JITTERED",{type:"logical_and_expr",
places:2}],group:{type:"group",parts:[{type:"textline",tokens:"ur = ur * rg ( u_wind , u_time , u_jitter_amp , u_jitter_freq , vec3 ( 0.0 ) ) ;".split(" ")}]}}]},{type:"textline",tokens:"c us = rB ( a_position , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , ur ) ; us . b = uo ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"c us = rB ( a_position , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , uq ) ;".split(" ")}]}}]},{type:"textline",
tokens:"un = u_proj_matrix * up * vec4 ( us . a , 1.0 ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS_SIZE"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:"um = vec4 ( a_grass_size , a_grass_color ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["um","=","a_grass_size",";"]}]}}]}]}},{type:"else",group:{type:"group",parts:[{type:"condition",
parts:[{type:"if",expression:["DYNAMIC_GRASS_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:["um","=","a_grass_color",";"]}]}}]}]}}]},{type:"textline",tokens:["gl_Position","=","un",";","}"]}]};a["halo.glslf"]={type:"group",parts:[{type:"var",name:"NUM_LINES",tokens:["0"]},{type:"var",name:"NUM_RINGS",tokens:["0"]},{type:"var",name:"NUM_STARS",tokens:["0"]},{type:"var",name:"WAVES_HEIGHT",tokens:["0.0"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"color_util.glslf"},
{type:"textline",tokens:"uniform vec4 u_diffuse_color ; uniform vec3 u_halo_rings_color ; uniform vec3 u_halo_lines_color ; uniform float u_halo_hardness ; uniform float u_halo_size ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SKY_STARS"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec3","u_sun_intensity",";"]},{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",places:1},{type:"logical_and_expr",places:2}],
group:{type:"group",parts:[{type:"textline",tokens:"uniform float u_halo_stars_blend ; uniform float u_halo_stars_height ; uniform float u_cam_water_depth ; varying vec4 un ;".split(" ")}]}}]}]}}]},{type:"textline",tokens:"varying vec2 bM ; varying float uo ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["NUM_RINGS","NUM_LINES",{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"const int up = NUM_RINGS ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",
tokens:"const int up = NUM_LINES ;".split(" ")}]}}]},{type:"textline",tokens:"float ur ( float uq ) { return uq - floor ( uq * ( 1.0 / 0.01 ) ) * 0.01 ; }".split(" ")},{type:"condition",parts:[{type:"if",expression:["NUM_RINGS"],group:{type:"group",parts:[{type:"textline",tokens:"void uA ( inout float us , in float ut [ up ] , in float uu ) { float uv , uw , ux , uy ; for ( int uz = 0 ; uz < NUM_RINGS ; uz ++ ) { uv = 40.0 * ut [ uz ] ; uw = 300.0 * ( ur ( uv ) - 0.005 ) ; ux = uv ; uy = abs ( ux * ( u_halo_size * uw - uu ) ) ; us += 1.0 - min ( uy , 1.0 ) ; } }".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["NUM_LINES"],group:{type:"group",parts:[{type:"textline",tokens:"void uJ ( inout float uB , in float uC [ up ] , in float uD ) { float uE , uF , uG , uH ; for ( int uI = 0 ; uI < NUM_LINES ; uI ++ ) { uE = uC [ uI ] ; uF = uE ; uG = 1000.0 * ( ur ( uE ) - 0.005 ) ; uH = 20.0 * abs ( uF * bM . x + uG * bM . y ) ; uB += 1.0 - min ( uH , 1.0 ) ; } uB *= uD ; }".split(" ")}]}}]},{type:"textline",tokens:"void uQ ( inout float uK , in vec2 uL ) { float uM , uN , uO , uP ; uN = atan ( uL . y , uL . x ) ; uN *= ( 1.0 + 0.25 * float ( NUM_STARS ) ) ; uO = cos ( uN ) ; uP = sin ( uN ) ; uN = ( uO * uL . x + uP * uL . y ) * ( uO * uL . y - uP * uL . x ) ; uM = abs ( uN ) ; if ( uM < 1.0 ) { uM = ( 0.01 * u_halo_size ) / ( uM ) ; uK *= sqrt ( min ( uM , 1.0 ) ) ; } } void main ( ) { vec3 uR ; float uS , uT , uU , uV ; uS = ( bM . x * bM . x + bM . y * bM . y ) ; uT = sqrt ( uS ) ; uS = max ( 1.0 - uS , 0.0 ) ; uS = pow ( uS , u_halo_hardness ) ; uU = u_diffuse_color . a ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["NUM_RINGS","NUM_LINES",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"float uW [ up ] ; for ( int uX = 0 ; uX < up ; uX ++ ) { uW [ uX ] = fract ( uo / ( float ( uX ) + 0.01 ) ) - 1.0 ; }".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["NUM_RINGS"],group:{type:"group",parts:[{type:"textline",tokens:"uV = 0.0 ; uA ( uV , uW , uT ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["NUM_LINES"],
group:{type:"group",parts:[{type:"textline",tokens:"uT = 0.0 ; uJ ( uT , uW , uS ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["NUM_STARS"],group:{type:"group",parts:[{type:"textline",tokens:"uQ ( uS , bM ) ;".split(" ")}]}}]},{type:"textline",tokens:"uS *= uU ; uR = u_diffuse_color . rgb ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["NUM_RINGS"],group:{type:"group",parts:[{type:"textline",tokens:"uV *= uS ; uR += u_halo_rings_color * uV ; uS += uV ;".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["NUM_LINES"],group:{type:"group",parts:[{type:"textline",tokens:"uT *= uU ; uR += u_halo_lines_color * uT ; uS += uT ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["SKY_STARS"],group:{type:"group",parts:[{type:"textline",tokens:"uS *= max ( 1.0 - 2.0 * u_sun_intensity . x , 0.0 ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",places:1},{type:"logical_and_expr",
places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uT = u_halo_stars_blend * ( un . y - u_halo_stars_height ) ; uS *= clamp ( uT , 0.0 , 1.0 ) ; uS *= min ( u_cam_water_depth + 2.0 * WAVES_HEIGHT , 1.0 ) ;".split(" ")}]}}]}]}}]},{type:"textline",tokens:"bu ( uR ) ; bx ( uR , uS ) ; gl_FragColor = vec4 ( uR , uS ) ; }".split(" ")}]};a["halo.glslv"]={type:"group",parts:[{type:"var",name:"PRECISION",tokens:["lowp"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},
{type:"textline",tokens:"attribute vec3 a_position ; attribute vec2 a_halo_bb_vertex ; uniform mat3 u_view_tsr ; uniform mat4 u_proj_matrix ; uniform PRECISION float u_halo_size ; varying vec2 bM ; varying float uo ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["STATIC_BATCH"],group:{type:"group",parts:[{type:"textline",tokens:"const mat3 u_model_tsr = mat3 ( 0.0 , 0.0 , 0.0 , 1.0 , 0.0 , 0.0 , 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",
tokens:["uniform","mat3","u_model_tsr",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",places:1},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","un",";"]}]}}]},{type:"textline",tokens:"void main ( ) { vec4 up , uq ; vec3 ur ; mat4 us , ut , uu ; us = O ( u_view_tsr ) ; ut = O ( u_model_tsr ) ; ur = ( ut * vec4 ( a_position , 1.0 ) ) . xyz ; bM = a_halo_bb_vertex * 2.0 ; uo = fract ( ur . x + ur . y + ur . z ) ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["SKY_STARS"],group:{type:"group",parts:[{type:"textline",tokens:"ut = qT ( ur , us ) ; uu = us ; uu [ 3 ] [ 0 ] = 0.0 ; uu [ 3 ] [ 1 ] = 0.0 ; uu [ 3 ] [ 2 ] = 0.0 ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"ut = qT ( ur , us ) ;".split(" ")}]}}]},{type:"textline",tokens:"up = vec4 ( a_halo_bb_vertex * 2.0 * u_halo_size , 0.0 , 1.0 ) ; up = ut * up ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SKY_STARS"],
group:{type:"group",parts:[{type:"textline",tokens:"uq = u_proj_matrix * uu * up ; uq . z = 0.99999 * uq . w ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",places:1},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["un","=","up",";"]}]}}]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"uq = u_proj_matrix * us * up ;".split(" ")}]}}]},{type:"textline",tokens:["gl_Position",
"=","uq",";","}"]}]};a["line.glslf"]={type:"group",parts:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"color_util.glslf"},{type:"textline",tokens:"uniform vec4 u_diffuse_color ; void main ( ) { float up ; vec3 uq ; uq = u_diffuse_color . xyz ; up = u_diffuse_color . a ; bu ( uq ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["ALPHA"],group:{type:"group",parts:[{type:"textline",tokens:"bx ( uq , up ) ;".split(" ")}]}}]},{type:"textline",tokens:"gl_FragColor = vec4 ( uq , up ) ; }".split(" ")}]};
a["line.glslv"]={type:"group",parts:[{type:"var",name:"AU_QUALIFIER",tokens:["uniform"]},{type:"var",name:"PRECISION",tokens:["lowp"]},{type:"var",name:"MAX_BONES",tokens:["0"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",tokens:"attribute vec3 a_position ; attribute vec3 a_direction ; uniform mat3 u_model_tsr ; uniform mat3 u_view_tsr ; uniform mat4 u_proj_matrix ; uniform float u_height ; uniform float u_line_width ;".split(" ")},{type:"define",name:"M_PI",
tokens:["3.14159265359"]},{type:"textline",tokens:"void main ( ) { mat2 up ; float uq ; vec2 ur , us ; vec4 ut ; mat4 uu , uv ; uu = O ( u_view_tsr ) ; uv = O ( u_model_tsr ) ; c uw = rB ( a_position , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , normalize ( a_direction ) , uv ) ; ut = u_proj_matrix * uu * vec4 ( uw . a , 1.0 ) ; ut . xyz /= ut . w ; ur = ( u_proj_matrix * uu * vec4 ( uw . e , 0.0 ) ) . xy ; uq = M_PI / 2.0 ; up = mat2 ( cos ( uq ) , sin ( uq ) , - sin ( uq ) , cos ( uq ) ) ; ur = up * normalize ( ur ) ; us = ( u_line_width / u_height ) * vec2 ( u_proj_matrix [ 0 ] [ 0 ] / u_proj_matrix [ 1 ] [ 1 ] , 1.0 ) ; gl_Position = vec4 ( ut . xy + ur . xy * us / 2.0 , ut . z , 1.0 ) ; gl_Position *= ut . w ; }".split(" ")}]};
a["main.glslf"]={type:"group",parts:[{type:"var",name:"WATER_LEVEL",tokens:["0.0"]},{type:"var",name:"WAVES_HEIGHT",tokens:["0.0"]},{type:"var",name:"NUM_LAMP_LIGHTS",tokens:["0"]},{type:"var",name:"NUM_VALUES",tokens:["0"]},{type:"var",name:"NUM_RGBS",tokens:["0"]},{type:"var",name:"PARALLAX_STEPS",tokens:["0.0"]},{type:"var",name:"PARALLAX_LOD_DIST",tokens:["0.0"]},{type:"var",name:"WATER_LEVEL",tokens:["0.0"]},{type:"var",name:"WAVES_HEIGHT",tokens:["0.0"]},{type:"var",name:"NUM_LIGHTS",tokens:["0"]},
{type:"var",name:"LAMP_IND",tokens:["0"]},{type:"var",name:"LAMP_SPOT_SIZE",tokens:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",tokens:["0"]},{type:"var",name:"LAMP_LIGHT_DIST",tokens:["0"]},{type:"var",name:"LAMP_LIGHT_FACT_IND",tokens:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",tokens:["rgb"]},{type:"var",name:"LAMP_SHADOW_MAP_IND",tokens:["0"]},{type:"var",name:"NUM_LFACTORS",tokens:["0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},
{type:"condition",parts:[{type:"if",expression:["SHADELESS",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"include",file:"procedural.glslf"},{type:"condition",parts:[{type:"if",expression:["CAUSTICS"],group:{type:"group",parts:[{type:"include",file:"caustics.glslf"}]}}]}]}}]},{type:"include",file:"color_util.glslf"},{type:"include",file:"math.glslv"},{type:"textline",tokens:["uniform","float","u_time",";"]},{type:"condition",parts:[{type:"if",expression:["USE_ENVIRONMENT_LIGHT",
"SKY_TEXTURE",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","samplerCube","u_sky_texture",";"]}]}},{type:"elif",expression:["USE_ENVIRONMENT_LIGHT","SKY_COLOR",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},{type:"textline",tokens:["uniform","float","u_environment_energy",";"]},{type:"condition",parts:[{type:"if",expression:["SHADELESS",
{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["NUM_LIGHTS",0,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS","CAUSTICS",
{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec4","u_sun_quaternion",";"]}]}}]}]}}]},{type:"textline",tokens:["uniform","vec3","u_camera_eye_frag",";"]},{type:"condition",parts:[{type:"if",expression:["NORMAL_TEXCOORD","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},"USE_NODE_B4W_VECTOR_VIEW",{type:"logical_or_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat3","u_view_tsr_frag",";"]}]}}]},{type:"condition",
parts:[{type:"if",expression:["DISABLE_FOG",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS"],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec4 u_underwater_fog_color_density ; uniform float u_cam_water_depth ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["PROCEDURAL_FOG"],group:{type:"group",parts:[{type:"textline",
tokens:["uniform","mat4","u_cube_fog",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_FOG"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec4","u_fog_params",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",places:1},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec3","u_sun_intensity",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS",
"CAUSTICS",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec3","u_sun_direction",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","sampler2D","u_plane_reflection",";"]}]}},{type:"elif",expression:["REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform",
"samplerCube","u_cube_reflection",";"]}]}},{type:"elif",expression:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","sampler2D","u_shadow_mask",";"]}]}},{type:"elif",expression:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",
{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec4 u_pcf_blur_radii ; uniform vec4 u_csm_center_dists ; uniform PRECISION sampler2D u_shadow_map0 ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION1","NUM_CAST_LAMPS",1,{type:"g_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","PRECISION","sampler2D","u_shadow_map1",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION2",
"NUM_CAST_LAMPS",2,{type:"g_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","PRECISION","sampler2D","u_shadow_map2",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION3","NUM_CAST_LAMPS",3,{type:"g_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","PRECISION","sampler2D","u_shadow_map3",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["REFRACTIVE",
"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","sampler2D","u_refractmap",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_B4W_REFRACTION","USE_REFRACTION","REFRACTIVE","USE_REFRACTION_CORRECTION",{type:"logical_and_expr",places:4}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","PRECISION","sampler2D","u_scene_depth",";"]}]}}]},{type:"textline",tokens:"uniform float u_emit ; uniform float u_ambient ; uniform vec4 u_fresnel_params ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},"REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[]}},{type:"elif",expression:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","float","u_mirror_factor",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",
{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec4","u_refl_plane",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_LAMP"],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec3 u_lamp_light_positions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_directions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_color_intensities [ NUM_LAMP_LIGHTS ] ; uniform vec4 u_lamp_light_factors [ NUM_LAMP_LIGHTS ] ;".split(" ")}]}}]},{type:"condition",
parts:[{type:"if",expression:["USE_NODE_VALUE"],group:{type:"group",parts:[{type:"textline",tokens:"uniform float u_node_values [ NUM_VALUES ] ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_RGB"],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec3 u_node_rgbs [ NUM_RGBS ] ;".split(" ")}]}}]},{type:"textline",tokens:["varying","vec3","bC",";"]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",
"WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",places:3},"USE_NODE_TEX_COORD_NO",{type:"logical_or_expr",places:6}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","bE",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES","DISABLE_FOG",{type:"logic_negative_expr",places:1},"TEXTURE_NORM_CO","PARALLAX",{type:"logical_and_expr",places:2},"WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",places:2},"SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",
places:2},"SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",places:2},{type:"logical_or_expr",places:6}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bD",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bF",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",
places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bI",";"]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION1","NUM_CAST_LAMPS",1,{type:"g_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bJ",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION2","NUM_CAST_LAMPS",2,{type:"g_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",
tokens:["varying","vec4","bK",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION3","NUM_CAST_LAMPS",3,{type:"g_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bL",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},"SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",places:2},"REFRACTIVE","USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",
places:4}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","bG",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["REFRACTIVE","USE_NODE_B4W_REFRACTION",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","float","bH",";"]}]}}]},{type:"include",file:"mirror.glslf"},{type:"include",file:"environment.glslf"},{type:"condition",parts:[{type:"if",expression:["SHADELESS",{type:"logic_negative_expr",places:1}],group:{type:"group",
parts:[{type:"include",file:"shadow.glslf"}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_B4W_REFRACTION","USE_REFRACTION",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"include",file:"refraction.glslf"}]}}]},{type:"include",file:"nodes.glslf"},{type:"condition",parts:[{type:"if",expression:["DISABLE_FOG",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"include",file:"fog.glslf"}]}}]},{type:"textline",tokens:"void main ( ) { vec2 vb ; mat4 vc ; vec4 vd ; vec3 ve , vf , vg , vh , vi ; float vj , vk , vl ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["NODES","DISABLE_FOG",{type:"logic_negative_expr",places:1},"TEXTURE_NORM_CO","PARALLAX",{type:"logical_and_expr",places:2},"WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",places:2},"SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",places:2},"SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",places:2},{type:"logical_or_expr",places:6}],group:{type:"group",parts:[{type:"textline",tokens:"vj = length ( bD ) ;".split(" ")}]}}]},{type:"condition",
parts:[{type:"if",expression:["WATER_EFFECTS"],group:{type:"group",parts:[{type:"textline",tokens:"vk = bC . y - WATER_LEVEL ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",places:1},"CAUSTICS","WATER_EFFECTS",{type:"logical_and_expr",places:2},{type:"logical_or_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:["ve","=","u_sun_intensity",";"]}]}}]},{type:"textline",tokens:"vf = normalize ( u_camera_eye_frag - bC ) ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["USE_NODE_B4W_VECTOR_VIEW","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"vc = O ( u_view_tsr_frag ) ; qM ( vf , vc , vg , vh , vi , vd , vl ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"qM ( vf , mat4 ( 0.0 ) , vg , vh , vi , vd , vl ) ;".split(" ")}]}}]},{type:"textline",tokens:"vg = vg ; vl = vl ; vi = vi ; vd = vd ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["SHADELESS",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["WETTABLE"],group:{type:"group",parts:[{type:"textline",tokens:"vg = max ( vg - sqrt ( 0.01 * - min ( vk , 0.0 ) ) , 0.5 * vg ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["CAUSTICS"],group:{type:"group",parts:[{type:"textline",
tokens:"bp ( vg , vk , u_time , vd , vi , u_sun_direction , ve , u_sun_quaternion , bC , vj ) ;".split(" ")}]}}]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["ALPHA"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["ALPHA_CLIP"],group:{type:"group",parts:[{type:"textline",tokens:"if ( vl < 0.5 ) discard ; vl = 1.0 ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["NODES_GLOW",{type:"logic_negative_expr",
places:1}],group:{type:"group",parts:[{type:"textline",tokens:["vl","=","1.0",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["DISABLE_FOG",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS"],group:{type:"group",parts:[{type:"textline",tokens:"va ( vg , length ( bD ) , vf , vk ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"va ( vg , length ( bD ) , vf , 1.0 ) ;".split(" ")}]}}]}]}}]},
{type:"condition",parts:[{type:"if",expression:["SSAO_ONLY","SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",places:2},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"vb = texture2DProj ( u_shadow_mask , bG ) . rg ; vk = vb . g ; vg = vec3 ( vk ) ;".split(" ")}]}}]},{type:"textline",tokens:["bu","(","vg",")",";"]},{type:"condition",parts:[{type:"if",expression:["ALPHA","ALPHA_CLIP",{type:"logic_negative_expr",places:1},{type:"logical_and_expr",places:2},
"NODES_GLOW",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"bx ( vg , vl ) ;".split(" ")}]}}]},{type:"textline",tokens:"gl_FragColor = vec4 ( vg , vl ) ; }".split(" ")}]};a["main.glslv"]={type:"group",parts:[{type:"var",name:"AU_QUALIFIER",tokens:["uniform"]},{type:"var",name:"MAX_BONES",tokens:["0"]},{type:"var",name:"NUM_CAST_LAMPS",tokens:["0"]},{type:"var",name:"PRECISION",tokens:["lowp"]},{type:"var",name:"VERTEX_ANIM_MIX_NORMALS_FACTOR",tokens:["u_va_frame_factor"]},
{type:"include",file:"std_enums.glsl"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",file:"scale_texcoord.glslv"},{type:"textline",tokens:["attribute","vec3","a_position",";"]},{type:"condition",parts:[{type:"if",expression:["NODES",{type:"logic_negative_expr",places:1},"USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",places:3},"USE_NODE_TEX_COORD_NO",{type:"logical_or_expr",
places:7}],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec3","a_normal",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec4","a_tangent",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SKINNED"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",parts:[{type:"if",
expression:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["WIND_BEND"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["MAIN_BEND_COL"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","float","a_bending_col_main",";"]},{type:"condition",parts:[{type:"if",expression:["DETAIL_BEND"],
group:{type:"group",parts:[{type:"textline",tokens:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",tokens:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["BEND_CENTER_ONLY"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec3",
"a_emitter_center",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["VERTEX_ANIM"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec3","a_position_next",";"]},{type:"condition",parts:[{type:"if",expression:["NODES",{type:"logic_negative_expr",places:1},"USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","USE_NODE_TEX_COORD_NO",{type:"logical_or_expr",places:6}],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec3","a_normal_next",
";"]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec4","a_tangent_next",";"]}]}}]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["TEXCOORD"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec2","a_texcoord",";"]}]}}]},
{type:"condition",parts:[{type:"if",expression:["VERTEX_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec3","a_color",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["STATIC_BATCH"],group:{type:"group",parts:[{type:"textline",tokens:"const mat3 u_model_tsr = mat3 ( 0.0 , 0.0 , 0.0 , 1.0 , 0.0 , 0.0 , 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat3","u_model_tsr",";"]}]}}]},{type:"condition",
parts:[{type:"if",expression:["REFLECTION_PASS"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat4","u_view_matrix",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat3","u_view_tsr",";"]}]}}]},{type:"textline",tokens:["uniform","mat4","u_proj_matrix",";"]},{type:"condition",parts:[{type:"if",expression:["NODES",{type:"logic_negative_expr",places:1},"BILLBOARD",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform",
"vec3","u_camera_eye",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SMAA_JITTER"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS"],group:{type:"group",parts:[{type:"textline",tokens:"uniform PRECISION sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["SKINNED"],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ; uniform vec4 u_arm_rel_trans ; uniform vec4 u_arm_rel_quat ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["FRAMES_BLENDING"],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},
{type:"condition",parts:[{type:"if",expression:["WIND_BEND"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["BILLBOARD_JITTERED"],group:{type:"group",parts:[{type:"textline",tokens:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",tokens:"uniform vec3 u_wind ; uniform PRECISION float u_time ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["VERTEX_ANIM"],group:{type:"group",parts:[{type:"textline",tokens:["uniform",
"float","u_va_frame_factor",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec3","u_texture_scale",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","float","u_normal_offset",";"]},{type:"condition",parts:[{type:"if",expression:["MAC_OS_SHADOW_HACK"],
group:{type:"group",parts:[{type:"textline",tokens:"uniform mat3 u_v_light_tsr [ NUM_CAST_LAMPS ] ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"uniform vec4 u_v_light_ts [ NUM_CAST_LAMPS ] ; uniform vec4 u_v_light_r [ NUM_CAST_LAMPS ] ;".split(" ")}]}}]},{type:"textline",tokens:["uniform","mat4","u_p_light_matrix0",";"]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION1","NUM_CAST_LAMPS",1,{type:"g_expr",places:2},{type:"logical_or_expr",places:2}],
group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat4","u_p_light_matrix1",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION2","NUM_CAST_LAMPS",2,{type:"g_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat4","u_p_light_matrix2",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION3","NUM_CAST_LAMPS",3,{type:"g_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",
parts:[{type:"textline",tokens:["uniform","mat4","u_p_light_matrix3",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["REFRACTIVE","USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","PRECISION","float","u_view_max_depth",";"]}]}}]},{type:"textline",tokens:["varying","vec3","bC",";"]},{type:"condition",parts:[{type:"if",expression:["NODES",{type:"logic_negative_expr",places:1},"USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO",
"CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",places:3},"USE_NODE_TEX_COORD_NO",{type:"logical_or_expr",places:7}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","bE",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES","DISABLE_FOG",{type:"logic_negative_expr",places:1},"TEXTURE_NORM_CO","PARALLAX",{type:"logical_and_expr",places:2},"WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",places:2},"SHADOW_USAGE","SHADOW_MASK_GENERATION",
{type:"equal_expr",places:2},"SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",places:2},{type:"logical_or_expr",places:6}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bD",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bF",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES",{type:"logic_negative_expr",
places:1}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","vb",";"]},{type:"condition",parts:[{type:"if",expression:["TEXCOORD"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec2","bM",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["VERTEX_COLOR","DYNAMIC_GRASS",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","vc",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHADOW_USAGE",
"SHADOW_MAPPING_BLEND",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bI",";"]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION1","NUM_CAST_LAMPS",1,{type:"g_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bJ",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION2","NUM_CAST_LAMPS",2,{type:"g_expr",places:2},{type:"logical_or_expr",places:2}],
group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bK",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION3","NUM_CAST_LAMPS",3,{type:"g_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bL",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},"SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",places:2},"REFRACTIVE",
"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",places:4}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","bG",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["REFRACTIVE","NODES",{type:"logic_negative_expr",places:1},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",places:2},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","float","bH",";"]}]}}]},{type:"include",file:"dynamic_grass.glslv"},{type:"include",file:"shadow.glslv"},
{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"condition",parts:[{type:"if",expression:["NODES"],group:{type:"group",parts:[{type:"include",file:"nodes.glslv"}]}}]},{type:"textline",tokens:"void main ( ) { vec4 vd , ve ; float vf ; vec3 vg , vh , vi , vj , vk , vl , vm ; mat4 vn , vo , vp ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["REFLECTION_PASS"],group:{type:"group",parts:[{type:"textline",tokens:["vn","=","u_view_matrix",";"]}]}},{type:"else",
group:{type:"group",parts:[{type:"textline",tokens:"vn = O ( u_view_tsr ) ;".split(" ")}]}}]},{type:"textline",tokens:"vo = O ( u_model_tsr ) ; vg = a_position ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["CALC_TBN_SPACE","USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",places:3},"NODES",{type:"logic_negative_expr",places:1},{type:"logical_or_expr",places:6}],group:{type:"group",parts:[{type:"textline",
tokens:["vh","=","a_normal",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"vh = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["CALC_TBN_SPACE","NODES",{type:"logic_negative_expr",places:1},"TEXTURE_NORM_CO","TEXTURE_COORDS_UV_ORCO",{type:"equal_expr",places:2},{type:"logical_and_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"vi = vec3 ( a_tangent ) ; vj = a_tangent [ 3 ] * cross ( vh , vi ) ;".split(" ")}]}},
{type:"elif",expression:["NODES",{type:"logic_negative_expr",places:1},"TEXTURE_NORM_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",places:2},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"vk = ( vo * vec4 ( a_position , 1.0 ) ) . xyz ; vl = normalize ( ( vo * vec4 ( a_normal , 0.0 ) ) . xyz ) ; vk = vk - u_camera_eye ; vj = cross ( vk , vl ) ; vi = cross ( vl , vj ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"vi = vec3 ( 0.0 ) ; vj = vec3 ( 0.0 ) ;".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["VERTEX_ANIM"],group:{type:"group",parts:[{type:"textline",tokens:"vg = mix ( vg , a_position_next , u_va_frame_factor ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["NODES",{type:"logic_negative_expr",places:1},"USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",{type:"logical_or_expr",places:5}],group:{type:"group",parts:[{type:"textline",tokens:"vh = mix ( vh , a_normal_next , VERTEX_ANIM_MIX_NORMALS_FACTOR ) ;".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["TEXTURE_NORM_CO"],group:{type:"group",parts:[{type:"textline",tokens:"vl = vec3 ( a_tangent ) ; vk = a_tangent_next [ 3 ] * cross ( a_normal_next , vl ) ; vi = mix ( vi , vl , u_va_frame_factor ) ; vj = mix ( vj , vk , u_va_frame_factor ) ;".split(" ")}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["SKINNED"],group:{type:"group",parts:[{type:"textline",tokens:"sB ( vg , vi , vj , vh ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",
expression:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:["vk","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"vk = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS"],group:{type:"group",parts:[{type:"textline",tokens:"c vq = t_ ( vg , vi , vj , vh , vk , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , vn ) ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["BILLBOARD"],group:{type:"group",parts:[{type:"textline",tokens:"vl = ( vo * vec4 ( vk , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["BILLBOARD_PRES_GLOB_ORIENTATION","STATIC_BATCH",{type:"logic_negative_expr",places:1},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"vp = ru ( u_camera_eye , vl , vn , vo ) ;".split(" ")}]}},{type:"else",group:{type:"group",
parts:[{type:"textline",tokens:"vp = ro ( u_camera_eye , vl , vn ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["WIND_BEND","BILLBOARD_JITTERED",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"vm = ( vo * vec4 ( vk , 1.0 ) ) . xyz ; vp = vp * rg ( u_wind , u_time , u_jitter_amp , u_jitter_freq , vm ) ;".split(" ")}]}}]},{type:"textline",tokens:"c vq = rB ( vg - vk , vk , vi , vj , vh , vp ) ; vq . b = vl ;".split(" ")}]}},{type:"else",
group:{type:"group",parts:[{type:"textline",tokens:"c vq = rB ( vg , vk , vi , vj , vh , vo ) ;".split(" ")}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"vf = ( dot ( cross ( vq . e , vq . c ) , vq . d ) < 0.0 ) ? - 1.0 : 1.0 ; bF = vec4 ( vq . c , vf ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["WIND_BEND"],group:{type:"group",parts:[{type:"textline",
tokens:"tp ( vq . a , vq . b , vh ) ;".split(" ")}]}}]},{type:"textline",tokens:"bC = vq . a ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["NODES",{type:"logic_negative_expr",places:1},"USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",places:3},{type:"logical_or_expr",places:6}],group:{type:"group",parts:[{type:"textline",tokens:"bE = vq . e ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",
expression:["NODES",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:"vb = u_camera_eye - vq . a ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["TEXCOORD"],group:{type:"group",parts:[{type:"textline",tokens:"bM = rE ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS"],group:{type:"group",parts:[{type:"textline",tokens:"vc = vq . f ;".split(" ")}]}},{type:"elif",expression:["VERTEX_COLOR"],
group:{type:"group",parts:[{type:"textline",tokens:["vc","=","a_color",";"]}]}}]}]}}]},{type:"textline",tokens:"vd = vn * vec4 ( vq . a , 1.0 ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["NODES","DISABLE_FOG",{type:"logic_negative_expr",places:1},"TEXTURE_NORM_CO","PARALLAX",{type:"logical_and_expr",places:2},"WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",places:2},"SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",places:2},"SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",
places:2},{type:"logical_or_expr",places:6}],group:{type:"group",parts:[{type:"textline",tokens:["bD","=","vd",";"]}]}}]},{type:"textline",tokens:"ve = u_proj_matrix * vd ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SMAA_JITTER"],group:{type:"group",parts:[{type:"textline",tokens:"ve . xy += u_subpixel_jitter * ve . w ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},"SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",
{type:"equal_expr",places:2},"REFRACTIVE","USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",places:4}],group:{type:"group",parts:[{type:"textline",tokens:"bG = L ( ve ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"ul ( vq . a , vq . e ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["REFRACTIVE","NODES",{type:"logic_negative_expr",places:1},
"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",places:2},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"bH = - vd . z / u_view_max_depth ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES"],group:{type:"group",parts:[{type:"textline",tokens:["tu","(",")",";"]}]}}]},{type:"textline",tokens:["gl_Position","=","ve",";","}"]}]};a["main_stack.glslf"]={type:"group",parts:[{type:"var",name:"WATER_LEVEL",tokens:["0.0"]},{type:"var",name:"WAVES_HEIGHT",
tokens:["0.0"]},{type:"var",name:"NUM_LAMP_LIGHTS",tokens:["0"]},{type:"var",name:"NUM_VALUES",tokens:["0"]},{type:"var",name:"NUM_RGBS",tokens:["0"]},{type:"var",name:"PARALLAX_STEPS",tokens:["0.0"]},{type:"var",name:"PARALLAX_LOD_DIST",tokens:["0.0"]},{type:"var",name:"WATER_LEVEL",tokens:["0.0"]},{type:"var",name:"WAVES_HEIGHT",tokens:["0.0"]},{type:"var",name:"NUM_LIGHTS",tokens:["0"]},{type:"var",name:"LAMP_IND",tokens:["0"]},{type:"var",name:"LAMP_SPOT_SIZE",tokens:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",
tokens:["0"]},{type:"var",name:"LAMP_LIGHT_DIST",tokens:["0"]},{type:"var",name:"LAMP_LIGHT_FACT_IND",tokens:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",tokens:["rgb"]},{type:"var",name:"LAMP_SHADOW_MAP_IND",tokens:["0"]},{type:"var",name:"NUM_LFACTORS",tokens:["0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"condition",parts:[{type:"if",expression:["SHADELESS",{type:"logic_negative_expr",places:1}],group:{type:"group",
parts:[{type:"include",file:"procedural.glslf"},{type:"condition",parts:[{type:"if",expression:["CAUSTICS"],group:{type:"group",parts:[{type:"include",file:"caustics.glslf"}]}}]}]}}]},{type:"include",file:"color_util.glslf"},{type:"include",file:"math.glslv"},{type:"textline",tokens:["uniform","float","u_time",";"]},{type:"condition",parts:[{type:"if",expression:["USE_ENVIRONMENT_LIGHT","SKY_TEXTURE",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform",
"samplerCube","u_sky_texture",";"]}]}},{type:"elif",expression:["USE_ENVIRONMENT_LIGHT","SKY_COLOR",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},{type:"textline",tokens:["uniform","float","u_environment_energy",";"]},{type:"condition",parts:[{type:"if",expression:["SHADELESS",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",
expression:["NUM_LIGHTS",0,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec4",
"u_sun_quaternion",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["NORMAL_TEXCOORD","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat3","u_view_tsr_frag",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["DISABLE_FOG",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",
parts:[{type:"if",expression:["WATER_EFFECTS"],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec4 u_underwater_fog_color_density ; uniform float u_cam_water_depth ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["PROCEDURAL_FOG"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat4","u_cube_fog",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_FOG"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec4","u_fog_params",";"]}]}}]}]}}]},
{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",places:1},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec3","u_sun_intensity",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec3","u_sun_direction",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_COLOR0_CO"],
group:{type:"group",parts:[{type:"textline",tokens:["uniform","sampler2D","u_colormap0",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_SPEC","ALPHA_AS_SPEC",{type:"logic_negative_expr",places:1},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","sampler2D","u_specmap0",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_NORM_CO"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","sampler2D","u_normalmap0",
";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_STENCIL_ALPHA_MASK"],group:{type:"group",parts:[{type:"textline",tokens:"uniform sampler2D u_colormap1 ; uniform sampler2D u_stencil0 ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","sampler2D","u_plane_reflection",";"]}]}},{type:"elif",expression:["REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",
places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","samplerCube","u_cube_reflection",";"]}]}},{type:"elif",expression:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","sampler2D","u_shadow_mask",
";"]}]}},{type:"elif",expression:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec4 u_pcf_blur_radii ; uniform vec4 u_csm_center_dists ; uniform PRECISION sampler2D u_shadow_map0 ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION1","NUM_CAST_LAMPS",1,{type:"g_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","PRECISION","sampler2D",
"u_shadow_map1",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION2","NUM_CAST_LAMPS",2,{type:"g_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","PRECISION","sampler2D","u_shadow_map2",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION3","NUM_CAST_LAMPS",3,{type:"g_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","PRECISION","sampler2D",
"u_shadow_map3",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["REFRACTIVE"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","sampler2D","u_refractmap",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["REFRACTIVE","USE_REFRACTION_CORRECTION",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","PRECISION","sampler2D","u_scene_depth",";"]}]}}]},{type:"textline",tokens:"uniform float u_emit ; uniform float u_ambient ; uniform vec4 u_fresnel_params ; uniform float u_specular_alpha ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},"REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","float","u_reflect_factor",";"]}]}},{type:"elif",expression:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","float","u_mirror_factor",";"]}]}}]},{type:"condition",
parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec4","u_refl_plane",";"]}]}}]},{type:"textline",tokens:"uniform vec4 u_diffuse_color ; uniform vec2 u_diffuse_params ; uniform float u_diffuse_intensity ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["TEXTURE_NORM_CO"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","float","u_normal_factor",";"]}]}}]},{type:"condition",
parts:[{type:"if",expression:["TEXTURE_COLOR0_CO"],group:{type:"group",parts:[{type:"textline",tokens:"uniform float u_diffuse_color_factor ; uniform float u_alpha_factor ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_SPEC"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","float","u_specular_color_factor",";"]}]}}]},{type:"textline",tokens:"uniform vec3 u_specular_color ; uniform vec3 u_specular_params ;".split(" ")},{type:"condition",parts:[{type:"if",
expression:["TEXTURE_NORM_CO","PARALLAX",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","float","u_parallax_scale",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["REFRACTIVE"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","float","u_refr_bump",";"]}]}}]},{type:"textline",tokens:"varying vec3 bC ; varying vec3 bE ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["NODES","DISABLE_FOG",{type:"logic_negative_expr",
places:1},"TEXTURE_NORM_CO","PARALLAX",{type:"logical_and_expr",places:2},"WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",places:2},"SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",places:2},"SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",places:2},{type:"logical_or_expr",places:6}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bD",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",places:2}],
group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bF",";"]}]}}]},{type:"textline",tokens:["varying","vec3","vb",";"]},{type:"condition",parts:[{type:"if",expression:["TEXCOORD"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec2","bM",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["VERTEX_COLOR","DYNAMIC_GRASS",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","vc",";"]}]}}]},{type:"condition",parts:[{type:"if",
expression:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bI",";"]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION1","NUM_CAST_LAMPS",1,{type:"g_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bJ",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION2","NUM_CAST_LAMPS",2,{type:"g_expr",places:2},{type:"logical_or_expr",
places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bK",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION3","NUM_CAST_LAMPS",3,{type:"g_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bL",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},"SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",places:2},
"REFRACTIVE",{type:"logical_or_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","bG",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["REFRACTIVE"],group:{type:"group",parts:[{type:"textline",tokens:["varying","float","bH",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHADELESS",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"include",file:"shadow.glslf"}]}}]},{type:"include",file:"mirror.glslf"},{type:"condition",
parts:[{type:"if",expression:["REFRACTIVE"],group:{type:"group",parts:[{type:"include",file:"refraction.glslf"}]}}]},{type:"include",file:"environment.glslf"},{type:"condition",parts:[{type:"if",expression:["SHADELESS",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"include",file:"lighting_nodes.glslf"}]}}]},{type:"condition",parts:[{type:"if",expression:["DISABLE_FOG",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"include",file:"fog.glslf"}]}}]},
{type:"textline",tokens:"void main ( ) { vec4 xi , xj , xk , xl ; mat4 xm ; mat3 xn ; vec2 xo , xp , xq , xr ; vec3 xs , xt , xu , xv , xw , xx , xy , xz , xA ; float xB , xC , xD , xE , xF ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["NODES","DISABLE_FOG",{type:"logic_negative_expr",places:1},"TEXTURE_NORM_CO","PARALLAX",{type:"logical_and_expr",places:2},"WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",places:2},"SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",places:2},
"SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",places:2},{type:"logical_or_expr",places:6}],group:{type:"group",parts:[{type:"textline",tokens:"xB = length ( bD ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS"],group:{type:"group",parts:[{type:"textline",tokens:"xC = bC . y - WATER_LEVEL ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",places:1},"CAUSTICS","WATER_EFFECTS",{type:"logical_and_expr",
places:2},{type:"logical_or_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:["xs","=","u_sun_intensity",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["TEXCOORD"],group:{type:"group",parts:[{type:"textline",tokens:["xo","=","bM",";"]}]}}]},{type:"textline",tokens:"xt = normalize ( bE ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["DOUBLE_SIDED_LIGHTING"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["INVERT_FRONTFACING"],
group:{type:"group",parts:[{type:"textline",tokens:["if","(","!","gl_FrontFacing",")"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["if","(","gl_FrontFacing",")"]}]}}]},{type:"textline",tokens:"xt = xt ; else xt = - xt ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_NORM_CO"],group:{type:"group",parts:[{type:"textline",tokens:"xu = cross ( xt , bF . xyz ) * bF . w ; xn = mat3 ( bF . xyz , xu , xt ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",
expression:["NORMAL_TEXCOORD"],group:{type:"group",parts:[{type:"textline",tokens:"xm = O ( u_view_tsr_frag ) ; xp = normalize ( xm * vec4 ( bE , 0.0 ) ) . st ; xp = xp * vec2 ( 0.495 ) + vec2 ( 0.5 ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_NORM_CO","PARALLAX",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"if ( xB < PARALLAX_LOD_DIST ) { xD = clamp ( 0.5 * ( PARALLAX_LOD_DIST - xB ) , 0.0 , 1.0 ) ; xD = u_parallax_scale * xD ; xu = normalize ( vb * xn ) ; xE = 1.0 / PARALLAX_STEPS ; xq = xu . xy * xD / ( PARALLAX_STEPS * xu . z ) ; xD = 1.0 ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["TEXTURE_NORM_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["xr","=","xp",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["xr","=","xo",";"]}]}}]},{type:"textline",tokens:"xF = texture2D ( u_normalmap0 , xr ) . a ; for ( float xG = 1.0 ; xG <= PARALLAX_STEPS ; xG ++ ) { if ( xF < xD ) { xD -= xE ; xr -= xq ; xF = texture2D ( u_normalmap0 , xr ) . a ; } } xq = xr + xq ; xE = texture2D ( u_normalmap0 , xq ) . a - ( xD + xE ) ; xD = xF - xD ; xE = xD / ( xD - xE ) ; xr = xE * xq + ( 1.0 - xE ) * xr ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["TEXTURE_NORM_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["TEXCOORD"],group:{type:"group",parts:[{type:"textline",tokens:"xo += xr - xp ;".split(" ")}]}}]},{type:"textline",tokens:["xp","=","xr",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["NORMAL_TEXCOORD"],group:{type:"group",parts:[{type:"textline",tokens:"xp += xr - xo ;".split(" ")}]}}]},
{type:"textline",tokens:["xo","=","xr",";"]}]}}]},{type:"textline",tokens:["}"]}]}}]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_NORM_CO"],group:{type:"group",parts:[{type:"textline",tokens:[";"]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_NORM_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"xi = texture2D ( u_normalmap0 , xp ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"xi = texture2D ( u_normalmap0 , xo ) ;".split(" ")}]}}]},
{type:"textline",tokens:"xu = xi . rgb - 0.5 ; xu = mix ( vec3 ( 0.0 , 0.0 , 1.0 ) , xu , u_normal_factor ) ; xu = xn * xu ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["xu","=","xt",";"]}]}}]},{type:"textline",tokens:"xu = normalize ( xu ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["NORMAL_TEXCOORD"],group:{type:"group",parts:[{type:"textline",tokens:"xp = normalize ( xm * vec4 ( xu , 0.0 ) ) . st ; xp = xp * vec2 ( 0.495 ) + vec2 ( 0.5 ) ;".split(" ")}]}}]},
{type:"textline",tokens:"xt = normalize ( vb ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["VERTEX_COLOR","DYNAMIC_GRASS",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"xv = vc ; br ( xv ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["VERTEX_COLOR","DYNAMIC_GRASS",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"xi = vec4 ( xv , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",
parts:[{type:"textline",tokens:["xi","=","u_diffuse_color",";"]}]}}]},{type:"textline",tokens:["xE","=","1.0",";"]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_COLOR0_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"xj = texture2D ( u_colormap0 , xp ) ;".split(" ")}]}},{type:"elif",expression:["TEXTURE_COLOR0_CO","TEXTURE_COORDS_UV_ORCO",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"xj = texture2D ( u_colormap0 , xo ) ;".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["TEXTURE_COLOR0_CO"],group:{type:"group",parts:[{type:"textline",tokens:"br ( xj . rgb ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["TEXTURE_STENCIL_ALPHA_MASK"],group:{type:"group",parts:[{type:"textline",tokens:[";"]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_COLOR1_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"xk = texture2D ( u_colormap1 , xp ) ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"xk = texture2D ( u_colormap1 , xo ) ;".split(" ")}]}}]},{type:"textline",tokens:"br ( xk . rgb ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["TEXTURE_STENCIL_ALPHA_MASK_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"xl = texture2D ( u_stencil0 , xp ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"xl = texture2D ( u_stencil0 , xo ) ;".split(" ")}]}}]},
{type:"textline",tokens:"xj = mix ( xj , xk , xl . r ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"xi . rgb = mix ( xi . rgb , xj . rgb , u_diffuse_color_factor ) ; xD = u_alpha_factor * xj . a ; xD += ( 1.0 - step ( 0.0 , xD ) ) ; xi . a = mix ( xD , 1.0 , u_diffuse_color . a ) ; xE = xj . a ;".split(" ")}]}},{type:"elif",expression:["TEXTURE_BLEND_TYPE",
"TEXTURE_BLEND_TYPE_MULTIPLY",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"xi . rgb *= mix ( vec3 ( 1.0 ) , xj . rgb , u_diffuse_color_factor ) ; xi . a = xj . a ; xE = xj . a ;".split(" ")}]}}]}]}}]},{type:"textline",tokens:"xv = u_diffuse_intensity * xi . rgb ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SHADELESS"],group:{type:"group",parts:[{type:"textline",tokens:["xw","=","xv",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",
tokens:"xx = u_environment_energy * dS ( xu ) ; xx = u_ambient * xx ; xj = du ( xv ) ; xy = u_emit * xi . rgb ; xz = u_specular_color ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["TEXTURE_SPEC"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["ALPHA_AS_SPEC"],group:{type:"group",parts:[{type:"textline",tokens:"xA = vec3 ( xE ) ;".split(" ")}]}},{type:"elif",expression:["TEXTURE_SPEC_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",places:2}],group:{type:"group",
parts:[{type:"textline",tokens:"xA = texture2D ( u_specmap0 , xp ) . rgb ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"xA = texture2D ( u_specmap0 , xo ) . rgb ;".split(" ")}]}}]},{type:"textline",tokens:"br ( xA . rgb ) ; xz = mix ( xz , xA , u_specular_color_factor ) ;".split(" ")}]}}]},{type:"textline",tokens:"xE = u_specular_params [ 0 ] ; xo = vec2 ( u_specular_params [ 1 ] , u_specular_params [ 2 ] ) ; xz = xE * xz ; xh ( xy , xx , xv , xz , bC , xu , xt , xo , u_diffuse_params , xj , 0.0 , vec4 ( 0.0 ) , xw , xA ) ;".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},"REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["NORMAL_TEXCOORD"],group:{type:"group",parts:[{type:"textline",tokens:"dP ( xw , xt , xu , u_reflect_factor , xm ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"dP ( xw , xt , xu , u_reflect_factor , mat4 ( 0.0 ) ) ;".split(" ")}]}}]}]}},
{type:"elif",expression:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["NORMAL_TEXCOORD"],group:{type:"group",parts:[{type:"textline",tokens:"dP ( xw , xt , xu , 0.0 , xm ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"dP ( xw , xt , xu , 0.0 , mat4 ( 0.0 ) ) ;".split(" ")}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHADELESS",{type:"logic_negative_expr",
places:1}],group:{type:"group",parts:[{type:"textline",tokens:["xw","+=","xA",";"]}]}}]},{type:"textline",tokens:"xE = xi . a ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SHADELESS",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["WETTABLE"],group:{type:"group",parts:[{type:"textline",tokens:"xw = max ( xw - sqrt ( 0.01 * - min ( xC , 0.0 ) ) , 0.5 * xw ) ;".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["CAUSTICS"],group:{type:"group",parts:[{type:"textline",tokens:"bp ( xw , xC , u_time , xj , xu , u_sun_direction , xs , u_sun_quaternion , bC , xB ) ;".split(" ")}]}}]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["ALPHA"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["ALPHA_CLIP"],group:{type:"group",parts:[{type:"textline",tokens:"if ( xE < 0.5 ) discard ; xE = 1.0 ;".split(" ")}]}},{type:"else",group:{type:"group",
parts:[{type:"condition",parts:[{type:"if",expression:["SHADELESS",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:"xD = max ( max ( xA . r , xA . g ) , xA . b ) * u_specular_alpha ; xE = xi . a * ( 1.0 - xD ) + xD ;".split(" ")}]}}]}]}}]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["xE","=","1.0",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["REFRACTIVE"],group:{type:"group",parts:[{type:"textline",tokens:"xw = mix ( ef ( bG , xu . xz * u_refr_bump ) , xw , xE ) ; xE = 1.0 ;".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["DISABLE_FOG",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS"],group:{type:"group",parts:[{type:"textline",tokens:"va ( xw , xB , xt , xC ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"va ( xw , xB , xt , 1.0 ) ;".split(" ")}]}}]}]}}]},{type:"textline",tokens:["bu","(","xw",")",";"]},{type:"condition",parts:[{type:"if",expression:["ALPHA",
"ALPHA_CLIP",{type:"logic_negative_expr",places:1},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"bx ( xw , xE ) ;".split(" ")}]}}]},{type:"textline",tokens:"gl_FragColor = vec4 ( xw , xE ) ; }".split(" ")}]};a["particles_color.glslf"]={type:"group",parts:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"color_util.glslf"},{type:"condition",parts:[{type:"if",expression:["SOFT_PARTICLES"],group:{type:"group",parts:[{type:"include",file:"pack.glslf"}]}}]},
{type:"var",name:"SOFT_STRENGTH",tokens:["1.0"]},{type:"textline",tokens:"uniform vec4 u_diffuse_color ; uniform float u_p_alpha_start ; uniform float u_p_alpha_end ; uniform vec2 u_texel_size ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SOFT_PARTICLES"],group:{type:"group",parts:[{type:"textline",tokens:"uniform PRECISION sampler2D u_scene_depth ; uniform float u_view_max_depth ;".split(" ")}]}}]},{type:"textline",tokens:"varying float xi ; varying vec3 vc ;".split(" ")},{type:"condition",
parts:[{type:"if",expression:["SOFT_PARTICLES"],group:{type:"group",parts:[{type:"textline",tokens:"varying vec4 bD ; varying vec3 bG ; varying float xj ;".split(" ")}]}}]},{type:"textline",tokens:"void main ( ) { vec4 xk ; vec3 xl ; float xm , xn , xo ; vec2 xp , xq ; xp = gl_PointCoord - 0.5 ; xm = 2.0 * length ( xp ) ; xm = smoothstep ( u_p_alpha_start , u_p_alpha_end , xm ) ; xm = u_diffuse_color . a * xi * ( 1.0 - xm ) ; xl = vc * u_diffuse_color . rgb ;".split(" ")},{type:"condition",parts:[{type:"if",
expression:["SOFT_PARTICLES"],group:{type:"group",parts:[{type:"textline",tokens:"xq = bG . xy / bG . z ; xp = vec2 ( xp . x , - xp . y ) * xj * u_texel_size ; xp = vec2 ( xq + xp ) ; xk = texture2D ( u_scene_depth , xp ) ; xn = Z ( xk ) ; xo = - bD . z / u_view_max_depth ; xo = xn - xo ; xo = u_view_max_depth / SOFT_STRENGTH * xo ; xm = xm * min ( xo , 1.0 ) ;".split(" ")}]}}]},{type:"textline",tokens:["bu","(","xl",")",";"]},{type:"condition",parts:[{type:"if",expression:["ALPHA","ALPHA_CLIP",{type:"logic_negative_expr",
places:1},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"bx ( xl , xm ) ;".split(" ")}]}}]},{type:"textline",tokens:"gl_FragColor = vec4 ( xl , xm ) ; }".split(" ")}]};a["particles_color.glslv"]={type:"group",parts:[{type:"var",name:"COLOR_RAMP_LENGTH",tokens:["0"]},{type:"var",name:"SIZE_RAMP_LENGTH",tokens:["0"]},{type:"textline",tokens:"attribute vec3 a_position ; attribute vec3 a_normal ; attribute float a_p_delay ; attribute float a_p_lifetime ; attribute vec4 a_p_vels ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["COLOR_RAMP_LENGTH",0,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec4 u_p_color_ramp [ COLOR_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["SIZE_RAMP_LENGTH",0,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec2 u_p_size_ramp [ SIZE_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"textline",tokens:"uniform float u_p_time ; uniform float u_p_length ; uniform int u_p_cyclic ; uniform float u_p_fade_in ; uniform float u_p_fade_out ; uniform float u_p_nfactor ; uniform float u_p_gravity ; uniform float u_p_mass ; uniform float u_p_wind_fac ; uniform float u_p_max_lifetime ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["REFLECTION_PASS"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat4","u_view_matrix",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat3","u_view_tsr",";"]}]}}]},{type:"textline",tokens:"uniform mat4 u_proj_matrix ; uniform vec3 u_wind ; uniform float u_height ; uniform float u_p_size ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["WORLD_SPACE",{type:"logic_negative_expr",places:1}],
group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat3","u_model_tsr",";"]}]}}]},{type:"textline",tokens:"varying float xi ; varying vec3 vc ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SOFT_PARTICLES"],group:{type:"group",parts:[{type:"textline",tokens:"varying vec4 bD ; varying vec3 bG ; varying float xj ;".split(" ")}]}}]},{type:"include",file:"math.glslv"},{type:"include",file:"particles.glslv"},{type:"textline",tokens:"void main ( ) { float xY , xZ , x_ , ya ; vec4 yb , yc ; mat4 yd ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["REFLECTION_PASS"],group:{type:"group",parts:[{type:"textline",tokens:["yd","=","u_view_matrix",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"yd = O ( u_view_tsr ) ;".split(" ")}]}}]},{type:"textline",tokens:"xk ye ; ye = xX ( ) ; yb = yd * vec4 ( ye . b , 1.0 ) ; yc = u_proj_matrix * yb ; gl_Position = yc ; xi = ye . c ; vc = ye . d ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SOFT_PARTICLES"],group:{type:"group",
parts:[{type:"textline",tokens:["bD","=","yb",";"]}]}}]},{type:"textline",tokens:"xY = u_height * u_proj_matrix [ 1 ] [ 1 ] * u_p_size / gl_Position . z ; xY = ye . a * xY ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SOFT_PARTICLES"],group:{type:"group",parts:[{type:"textline",tokens:"xZ = yc . x ; x_ = yc . y ; ya = yc . w ; bG . x = ( xZ + ya ) / 2.0 ; bG . y = ( x_ + ya ) / 2.0 ; bG . z = ya ; xj = xY ;".split(" ")}]}}]},{type:"textline",tokens:["gl_PointSize","=","xY",";","}"]}]};
a["particles_texture.glslf"]={type:"group",parts:[{type:"var",name:"NUM_LIGHTS",tokens:["0"]},{type:"var",name:"LAMP_IND",tokens:["0"]},{type:"var",name:"LAMP_SPOT_SIZE",tokens:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",tokens:["0"]},{type:"var",name:"LAMP_LIGHT_DIST",tokens:["0"]},{type:"var",name:"LAMP_LIGHT_FACT_IND",tokens:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",tokens:["rgb"]},{type:"var",name:"LAMP_SHADOW_MAP_IND",tokens:["0"]},{type:"var",name:"NUM_LFACTORS",tokens:["0"]},{type:"include",
file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"color_util.glslf"},{type:"condition",parts:[{type:"if",expression:["SOFT_PARTICLES"],group:{type:"group",parts:[{type:"include",file:"pack.glslf"}]}}]},{type:"var",name:"PARTICLES_SHADELESS",tokens:["0"]},{type:"var",name:"SOFT_STRENGTH",tokens:["1.0"]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","sampler2D","u_sampler",";"]}]}}]},
{type:"textline",tokens:["uniform","float","u_environment_energy",";"]},{type:"condition",parts:[{type:"if",expression:["NUM_LIGHTS",0,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["DISABLE_FOG",{type:"logic_negative_expr",
places:1}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS"],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec4 u_underwater_fog_color_density ; uniform float u_cam_water_depth ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["PROCEDURAL_FOG"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat4","u_cube_fog",";"]}]}}]},{type:"condition",parts:[{type:"if",
expression:["USE_FOG"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec4","u_fog_params",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","float","u_diffuse_color_factor",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_ENVIRONMENT_LIGHT","SKY_TEXTURE",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","samplerCube","u_sky_texture",
";"]}]}},{type:"elif",expression:["USE_ENVIRONMENT_LIGHT","SKY_COLOR",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["SOFT_PARTICLES"],group:{type:"group",parts:[{type:"textline",tokens:"uniform PRECISION sampler2D u_scene_depth ; uniform float u_view_max_depth ;".split(" ")}]}}]},{type:"textline",tokens:"uniform vec4 u_diffuse_color ; uniform vec2 u_diffuse_params ; uniform float u_diffuse_intensity ; uniform float u_emit ; uniform float u_ambient ; uniform vec3 u_specular_color ; uniform vec3 u_specular_params ; varying float xi ; varying vec3 vc ; varying vec2 bM ; varying vec3 bC ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["PARTICLES_SHADELESS",{type:"logic_negative_expr",places:1},"DISABLE_FOG",{type:"logic_negative_expr",places:1},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","vb",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["DISABLE_FOG",{type:"logic_negative_expr",places:1},"SOFT_PARTICLES",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4",
"bD",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SOFT_PARTICLES"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","bG",";"]}]}}]},{type:"include",file:"environment.glslf"},{type:"condition",parts:[{type:"if",expression:["DISABLE_FOG",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"include",file:"fog.glslf"}]}}]},{type:"condition",parts:[{type:"if",expression:["PARTICLES_SHADELESS",{type:"logic_negative_expr",places:1}],group:{type:"group",
parts:[{type:"include",file:"lighting_nodes.glslf"}]}}]},{type:"textline",tokens:"void main ( ) { vec2 xY ; float xZ , x_ , ya ; vec3 yb , yc , yd , ye , yf , yg , yh , yi ; vec4 yj , yk ; yj = u_diffuse_color ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["TEXTURE_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:"yk = texture2D ( u_sampler , bM ) ; br ( yk . rgb ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX",
{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"yj . rgb = mix ( yj . rgb , yk . rgb , u_diffuse_color_factor ) ;".split(" ")}]}},{type:"elif",expression:["TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"yj . rgb *= mix ( vec3 ( 1.0 ) , yk . rgb , u_diffuse_color_factor ) ;".split(" ")}]}}]},{type:"textline",tokens:"yj . a = yk . a ;".split(" ")}]}}]},{type:"textline",tokens:"yj . rgb *= vc ; yb = u_diffuse_intensity * yj . rgb ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["PARTICLES_SHADELESS",{type:"logic_negative_expr",places:1},"DISABLE_FOG",{type:"logic_negative_expr",places:1},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"yc = normalize ( vb ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["PARTICLES_SHADELESS",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:"yd = u_emit * yj . rgb ; ye = vec3 ( 0.0 , 1.0 , 0.0 ) ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["USE_ENVIRONMENT_LIGHT","SKY_TEXTURE",{type:"logic_negative_expr",places:1},"SKY_COLOR",{type:"logical_and_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:"yf = u_environment_energy * dS ( vec3 ( 0.0 ) ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"yf = u_environment_energy * dS ( ye ) ;".split(" ")}]}}]},{type:"textline",tokens:"yf = u_ambient * yf ; xZ = u_specular_params [ 0 ] ; xY = vec2 ( u_specular_params [ 1 ] , u_specular_params [ 2 ] ) ; yg = xZ * u_specular_color ; xh ( yd , yf , yb , yg , bC , ye , yc , xY , u_diffuse_params , vec4 ( 1.0 ) , 0.0 , vec4 ( 0.0 ) , yh , yi ) ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["yh","=","yb",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["DISABLE_FOG",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:"va ( yh , length ( bD ) , yc , 1.0 ) ;".split(" ")}]}}]},{type:"textline",tokens:"xZ = yj . a * xi ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SOFT_PARTICLES"],group:{type:"group",parts:[{type:"textline",tokens:"x_ = - bD . z / u_view_max_depth ; yj = texture2DProj ( u_scene_depth , bG ) ; ya = Z ( yj ) ; x_ = ya - x_ ; x_ = u_view_max_depth / SOFT_STRENGTH * x_ ; xZ = xZ * min ( x_ , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",tokens:["bu","(","yh",")",";"]},{type:"condition",parts:[{type:"if",expression:["ALPHA","ALPHA_CLIP",{type:"logic_negative_expr",places:1},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"bx ( yh , xZ ) ;".split(" ")}]}}]},{type:"textline",tokens:"gl_FragColor = vec4 ( yh , xZ ) ; }".split(" ")}]};a["particles_texture.glslv"]={type:"group",parts:[{type:"var",name:"BILLBOARD_ALIGN",tokens:["0"]},{type:"var",name:"COLOR_RAMP_LENGTH",tokens:["0"]},
{type:"var",name:"SIZE_RAMP_LENGTH",tokens:["0"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"define",name:"BILLBOARD_ALIGN_VIEW",tokens:["1"]},{type:"define",name:"BILLBOARD_ALIGN_XY",tokens:["2"]},{type:"define",name:"BILLBOARD_ALIGN_YZ",tokens:["3"]},{type:"define",name:"BILLBOARD_ALIGN_ZX",tokens:["4"]},{type:"textline",tokens:"attribute vec3 a_position ; attribute vec3 a_normal ; attribute float a_p_delay ; attribute float a_p_lifetime ; attribute vec4 a_p_vels ; attribute vec2 a_p_bb_vertex ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["COLOR_RAMP_LENGTH",0,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec4 u_p_color_ramp [ COLOR_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["SIZE_RAMP_LENGTH",0,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec2 u_p_size_ramp [ SIZE_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"textline",tokens:"uniform float u_p_time ; uniform float u_p_length ; uniform int u_p_cyclic ; uniform float u_p_fade_in ; uniform float u_p_fade_out ; uniform float u_p_nfactor ; uniform float u_p_gravity ; uniform float u_p_mass ; uniform float u_p_wind_fac ; uniform float u_p_max_lifetime ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["REFLECTION_PASS"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat4","u_view_matrix",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat3","u_view_tsr",";"]}]}}]},{type:"textline",tokens:"uniform mat4 u_proj_matrix ; uniform vec3 u_camera_eye ; uniform vec3 u_wind ; uniform float u_p_size ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["WORLD_SPACE",{type:"logic_negative_expr",places:1}],
group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat3","u_model_tsr",";"]}]}}]},{type:"textline",tokens:"varying float xi ; varying vec3 vc ; varying vec2 bM ; varying vec3 vb ; varying vec3 bC ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["DISABLE_FOG",{type:"logic_negative_expr",places:1},"SOFT_PARTICLES",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bD",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SOFT_PARTICLES"],
group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","bG",";"]}]}}]},{type:"include",file:"particles.glslv"},{type:"textline",tokens:"float x_ ( vec2 xY , vec2 xZ ) { return ( atan ( xZ . y , xZ . x ) - atan ( xY . y , xY . x ) ) ; } void main ( ) { vec4 ya , yb , yc ; float yd , ye , yf ; mat4 yg , yh ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["REFLECTION_PASS"],group:{type:"group",parts:[{type:"textline",tokens:["yg","=","u_view_matrix",";"]}]}},{type:"else",
group:{type:"group",parts:[{type:"textline",tokens:"yg = O ( u_view_tsr ) ;".split(" ")}]}}]},{type:"textline",tokens:"xk yi ; yi = xX ( ) ; if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_VIEW ) { yd = yi . e ; yh = qT ( yi . b , yg ) ; } else if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_XY ) { yd = yi . e ; yh = w ( ) ; yh [ 3 ] = vec4 ( yi . b , 1.0 ) ; } else if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_YZ ) { yd = yi . e ; yh = A ( radians ( 90.0 ) ) ; yh [ 3 ] = vec4 ( yi . b , 1.0 ) ; } else if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_ZX ) { yd = x_ ( vec2 ( EPSILON , 1.0 ) , vec2 ( a_normal . x , a_normal . z ) ) + yi . e ; yh = y ( radians ( - 90.0 ) ) ; yh [ 3 ] = vec4 ( yi . b , 1.0 ) ; } ya = vec4 ( a_p_bb_vertex * 2.0 * yi . a * u_p_size , 0.0 , 1.0 ) ; ya = yh * C ( yd ) * ya ; yb = yg * ya ; yc = u_proj_matrix * yb ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["SOFT_PARTICLES"],group:{type:"group",parts:[{type:"textline",tokens:"yd = yc . x ; ye = yc . y ; yf = yc . w ; bG . x = ( yd + yf ) / 2.0 ; bG . y = ( ye + yf ) / 2.0 ; bG . z = yf ;".split(" ")}]}}]},{type:"textline",tokens:"gl_Position = yc ; xi = yi . c ; vc = yi . d ; bM = a_p_bb_vertex + 0.5 ; bC = ya . xyz ; vb = u_camera_eye - ya . xyz ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["DISABLE_FOG",{type:"logic_negative_expr",places:1},
"SOFT_PARTICLES",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["bD","=","yb",";"]}]}}]},{type:"textline",tokens:["}"]}]};a["procedural_skydome.glslf"]={type:"group",parts:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"color_util.glslf"},{type:"textline",tokens:"uniform vec3 u_sky_color ; uniform vec3 u_sun_direction ; uniform float u_rayleigh_brightness ; uniform float u_mie_brightness ; uniform float u_spot_brightness ; uniform float u_scatter_strength ; uniform float u_rayleigh_strength ; uniform float u_mie_strength ; uniform float u_rayleigh_collection_power ; uniform float u_mie_collection_power ; uniform float u_mie_distribution ; varying vec3 xY ; const float xZ = 0.99 ; const float x_ = 1.8 ; const int ya = 8 ; float yg ( vec3 yb , vec3 yc ) { float yd , ye , yf ; yd = dot ( yc , yc ) ; ye = 2.0 * dot ( yc , yb ) ; yf = dot ( yb , yb ) - 1.0 ; yd = ye * ye - 4.0 * yd * yf ; yd = sqrt ( yd ) ; yd = ( - ye - yd ) / 2.0 ; yd = yf / yd ; return yd ; } float yn ( float yh , float yi ) { float yj , yk , yl , ym ; yj = 3.0 * ( 1.0 - yi * yi ) ; yk = 2.0 * ( 2.0 + yi * yi ) ; yl = 1.0 + yh * yh ; ym = pow ( 1.0 + yi * yi - 2.0 * yi * yh , 1.5 ) ; ym = max ( ym , 0.00001 ) ; return ( yj / yk ) * ( yl / ym ) ; } float yt ( vec3 yo , vec3 yp , float yq ) { vec3 yr ; float ys ; ys = dot ( yp , - yo ) ; if ( ys < 0.0 ) { return 1.0 ; } yr = yo + ys * yp ; if ( length ( yr ) < yq ) { return 0.0 ; } else if ( length ( yr ) >= yq ) { yr = normalize ( yr ) * yq - yo ; ys = acos ( dot ( normalize ( yr ) , yp ) ) ; return smoothstep ( 0.0 , 1.0 , pow ( ys * 2.0 , 3.0 ) ) ; } else return 1.0 ; } vec3 yx ( float yu , vec3 yv , float yw ) { return yv - yv * pow ( u_sky_color , vec3 ( yw / yu ) ) ; } void main ( ) { float yy , yz , yA , yB , yC , yD , yE , yF , yG ; vec3 yH , yI , yJ , yK , yL , yM , yN ; yH = normalize ( xY ) ; yI = u_sun_direction ; yy = dot ( yH , yI ) ; yz = yn ( yy , - 0.01 ) * u_rayleigh_brightness * yI . y ; yA = yn ( yy - 0.5 , u_mie_distribution ) * u_mie_brightness * ( 1.0 - yI . y ) ; yy = smoothstep ( 0.0 , 100.0 , yn ( yy , 0.9995 ) ) * u_spot_brightness ; yJ = vec3 ( 0.0 , xZ , 0.0 ) ; yB = yg ( yJ , yH ) ; yC = yB / float ( ya ) ; yD = yt ( yJ , yH , xZ - 0.3 ) ; yK = vec3 ( 0.0 , 0.0 , 0.0 ) ; yL = vec3 ( 0.0 , 0.0 , 0.0 ) ; for ( int yO = 0 ; yO < ya ; yO ++ ) { yE = yC * float ( yO ) ; yM = yJ + yH * yE ; yF = yt ( yM , yI , xZ - 0.2 ) ; yG = yg ( yM , yI ) ; yN = yx ( yG , vec3 ( x_ ) , u_scatter_strength ) * yF ; yK += yx ( sqrt ( yE ) , u_sky_color * yN , u_rayleigh_strength ) ; yL += yx ( yE , yN , u_mie_strength ) ; } yK = yK * yD * pow ( yB , u_rayleigh_collection_power ) / float ( ya ) ; yL = ( yL * yD * pow ( yB , u_mie_collection_power ) ) / float ( ya ) ; yK = vec3 ( yy * yL + yA * yL + yz * yK ) ; bu ( yK ) ; gl_FragColor = vec4 ( yK , 1.0 ) ; }".split(" ")}]};
a["procedural_skydome.glslv"]={type:"group",parts:[{type:"textline",tokens:"attribute vec3 a_position ; uniform mat4 u_cube_view_matrix ; varying vec3 xY ; void main ( ) { vec4 xZ , x_ ; xZ = vec4 ( a_position . xy , 0.999999 , 1.0 ) ; x_ = u_cube_view_matrix * xZ ; xY = x_ . xyz ; gl_Position = xZ ; }".split(" ")}]};a["special_lens_flares.glslf"]={type:"group",parts:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"color_util.glslf"},{type:"textline",tokens:"uniform sampler2D u_sampler ; varying vec2 bM ; void main ( ) { vec4 xZ ; xZ = texture2D ( u_sampler , bM ) ; bu ( xZ . rgb ) ; bx ( xZ . rgb , xZ . a ) ; gl_FragColor = xZ ; }".split(" ")}]};
a["special_lens_flares.glslv"]={type:"group",parts:[{type:"var",name:"NUM_LIGHTS",tokens:["0"]},{type:"define",name:"LIGHT_INDEX",tokens:["0"]},{type:"include",file:"math.glslv"},{type:"textline",tokens:"attribute float a_lf_dist ; attribute vec2 a_lf_bb_vertex ; attribute vec2 a_texcoord ; uniform mat3 u_view_tsr ; uniform mat4 u_proj_matrix ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; varying vec2 bM ; void main ( ) { vec2 xZ ; float x_ ; vec4 ya ; vec3 yb ; mat4 yc ; yc = O ( u_view_tsr ) ; bM = a_texcoord ; yb = normalize ( u_light_directions [ LIGHT_INDEX ] ) ; ya = u_proj_matrix * yc * vec4 ( yb , 0.0 ) ; ya . x /= ya . w ; ya . y /= ya . w ; ya += 99999.0 * step ( ya . z , 0.0 ) ; ya += 100.0 * ( step ( 1.0 , abs ( ya . x ) ) + step ( 1.0 , abs ( ya . y ) ) ) ; ya . x = - a_lf_dist * ya . x ; ya . y = - a_lf_dist * ya . y ; x_ = u_proj_matrix [ 1 ] [ 1 ] / u_proj_matrix [ 0 ] [ 0 ] ; xZ = vec2 ( a_lf_bb_vertex . x / x_ , a_lf_bb_vertex . y ) ; if ( a_lf_dist > - 0.999 ) { const float yd = 1.9 ; xZ *= ( 1.0 + yd * length ( ya . xy ) ) ; } gl_Position = vec4 ( ya . xy + xZ , 0.999999 , 1.0 ) ; }".split(" ")}]};
a["special_skydome.glslf"]={type:"group",parts:[{type:"var",name:"WATER_LEVEL",tokens:["0.0"]},{type:"define",name:"INV_PI",tokens:["0.318309886"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"color_util.glslf"},{type:"condition",parts:[{type:"if",expression:["WO_SKYTEX","PROCEDURAL_SKYDOME",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","samplerCube","u_sky",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["PROCEDURAL_SKYDOME",
{type:"logic_negative_expr",places:1},"WO_SKYTEX",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"include",file:"std_enums.glsl"},{type:"include",file:"blending.glslf"},{type:"textline",tokens:"uniform vec4 u_sky_tex_fac ; uniform vec3 u_sky_tex_color ; uniform float u_sky_tex_dvar ; vec3 Ac ( vec3 zY , vec3 zZ , float z_ , float Aa ) { float Ab ; Ab = z_ * Aa ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["BLENDTYPE","MIX",{type:"equal_expr",places:2}],group:{type:"group",
parts:[{type:"textline",tokens:"return ym ( zZ , zY , Ab ) ;".split(" ")}]}},{type:"elif",expression:["BLENDTYPE","ADD",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return yq ( zY , zZ , Ab ) ;".split(" ")}]}},{type:"elif",expression:["BLENDTYPE","SUBTRACT",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return yu ( zY , zZ , Ab ) ;".split(" ")}]}},{type:"elif",expression:["BLENDTYPE","MULTIPLY",{type:"equal_expr",places:2}],group:{type:"group",
parts:[{type:"textline",tokens:"return yz ( zY , zZ , Ab ) ;".split(" ")}]}},{type:"elif",expression:["BLENDTYPE","SCREEN",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return yE ( zY , zZ , Ab ) ;".split(" ")}]}},{type:"elif",expression:["BLENDTYPE","OVERLAY",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return yJ ( zY , zZ , Ab ) ;".split(" ")}]}},{type:"elif",expression:["BLENDTYPE","DIFFERENCE",{type:"equal_expr",places:2}],
group:{type:"group",parts:[{type:"textline",tokens:"return yN ( zY , zZ , Ab ) ;".split(" ")}]}},{type:"elif",expression:["BLENDTYPE","DIVIDE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return yR ( zY , zZ , Ab ) ;".split(" ")}]}},{type:"elif",expression:["BLENDTYPE","DARKEN",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return yV ( zY , zZ , Ab ) ;".split(" ")}]}},{type:"elif",expression:["BLENDTYPE","LIGHTEN",{type:"equal_expr",
places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return yZ ( zY , zZ , Ab ) ;".split(" ")}]}},{type:"elif",expression:["BLENDTYPE","HUE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return ze ( zZ , zY , Ab ) ;".split(" ")}]}},{type:"elif",expression:["BLENDTYPE","SATURATION",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return zk ( zZ , zY , Ab ) ;".split(" ")}]}},{type:"elif",expression:["BLENDTYPE","VALUE",{type:"equal_expr",
places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return zq ( zZ , zY , Ab ) ;".split(" ")}]}},{type:"elif",expression:["BLENDTYPE","COLOR",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return zw ( zZ , zY , Ab ) ;".split(" ")}]}},{type:"elif",expression:["BLENDTYPE","SOFT_LIGHT",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return zB ( zZ , zY , Ab ) ;".split(" ")}]}},{type:"elif",expression:["BLENDTYPE","LINEAR_LIGHT",
{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return zF ( zZ , zY , Ab ) ;".split(" ")}]}}]},{type:"textline",tokens:"return vec3 ( 1.0 , 0.0 , 1.0 ) ; } float Ak ( float Ad , float Ae , float Af , float Ag ) { float Ah ; vec3 Ai , Aj ; Ai = vec3 ( Ad ) , Aj = vec3 ( Ae ) ; Ah = Af * Ag ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["BLENDTYPE","MIX",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return ym ( Aj , Ai , Ah ) . x ;".split(" ")}]}},
{type:"elif",expression:["BLENDTYPE","ADD",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return yq ( Ai , Aj , Ah ) . x ;".split(" ")}]}},{type:"elif",expression:["BLENDTYPE","SUBTRACT",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return yu ( Ai , Aj , Ah ) . x ;".split(" ")}]}},{type:"elif",expression:["BLENDTYPE","MULTIPLY",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return zL ( Ad , Ae , Ah , Ag ) ;".split(" ")}]}},
{type:"elif",expression:["BLENDTYPE","SCREEN",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return zR ( Ad , Ae , Ah , Ag ) ;".split(" ")}]}},{type:"elif",expression:["BLENDTYPE","OVERLAY",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return zX ( Ad , Ae , Ah , Ag ) ;".split(" ")}]}},{type:"elif",expression:["BLENDTYPE","DIFFERENCE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return yN ( Ai , Aj , Ah ) . x ;".split(" ")}]}},
{type:"elif",expression:["BLENDTYPE","DIVIDE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return yR ( Ai , Aj , Ah ) . x ;".split(" ")}]}},{type:"elif",expression:["BLENDTYPE","DARKEN",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return yV ( Ai , Aj , Ah ) . x ;".split(" ")}]}},{type:"elif",expression:["BLENDTYPE","LIGHTEN",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return yZ ( Ai , Aj , Ah ) . x ;".split(" ")}]}},
{type:"elif",expression:["BLENDTYPE","SOFT_LIGHT",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return zB ( Aj , Ai , Ah ) . x ;".split(" ")}]}},{type:"elif",expression:["BLENDTYPE","LINEAR_LIGHT",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return zF ( Aj , Ai , Ah ) . x ;".split(" ")}]}}]},{type:"textline",tokens:["return","0.0",";","}"]}]}}]},{type:"condition",parts:[{type:"if",expression:["PROCEDURAL_SKYDOME",{type:"logic_negative_expr",
places:1}],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",places:1},"REFLECTION_PASS",{type:"logic_negative_expr",places:1},{type:"logical_and_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec3 u_camera_eye_frag ; uniform vec3 u_sun_intensity ; uniform float u_environment_energy ; uniform vec4 u_underwater_fog_color_density ;".split(" ")}]}}]},
{type:"textline",tokens:["varying","vec3","xY",";"]},{type:"condition",parts:[{type:"if",expression:["PROCEDURAL_SKYDOME",{type:"logic_negative_expr",places:1},"WO_SKYTEX","WO_SKYBLEND",{type:"logical_or_expr",places:2},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec2","bM",";"]}]}}]},{type:"textline",tokens:"void main ( ) { vec4 Al ; float Am , An , Ao ; vec3 Ap , Aq , Ar , As , At ; Aq = normalize ( xY ) ;".split(" ")},{type:"condition",parts:[{type:"if",
expression:["PROCEDURAL_SKYDOME"],group:{type:"group",parts:[{type:"textline",tokens:"Ap = textureCube ( u_sky , Aq ) . rgb ;".split(" ")}]}},{type:"elif",expression:["WO_SKYTEX","WO_SKYBLEND",{type:"logical_or_expr",places:2},{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:"Ap = u_horizon_color ; bu ( Ap ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:[";"]},{type:"condition",parts:[{type:"if",expression:["WO_SKYPAPER"],
group:{type:"group",parts:[{type:"textline",tokens:"Ar = vec3 ( bM , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"Ar = vec3 ( xY . xy , 0.0 ) ;".split(" ")}]}}]},{type:"textline",tokens:["Am","=","0.0",";"]},{type:"condition",parts:[{type:"if",expression:["WO_SKYBLEND"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["WO_SKYPAPER"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["WO_SKYREAL"],group:{type:"group",
parts:[{type:"textline",tokens:"Am = abs ( bM . y ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"Am = ( bM . y + 1.0 ) * 0.5 ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"An = acos ( Aq . y ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["WO_SKYREAL"],group:{type:"group",parts:[{type:"textline",tokens:"Am = abs ( An * INV_PI - 0.5 ) * 2.0 ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",
tokens:"Am = 1.0 - An * INV_PI ;".split(" ")}]}}]}]}}]}]}}]},{type:"textline",tokens:"As = u_horizon_color ; At = u_zenith_color ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["WO_SKYTEX"],group:{type:"group",parts:[{type:"textline",tokens:"An = 1.0 ; Al = textureCube ( u_sky , Aq ) ; br ( Al . rgb ) ; An = Al . a ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["MTEX_RGBTOINT"],group:{type:"group",parts:[{type:"textline",tokens:"An = bB ( Al ) ;".split(" ")}]}}]},{type:"condition",
parts:[{type:"if",expression:["MTEX_NEGATIVE"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["MTEX_RGBTOINT",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:"Al = vec4 ( vec3 ( 1.0 ) - Al . rgb , Al . a ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"An = 1.0 - An ;".split(" ")}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["WOMAP_HORIZ","WOMAP_ZENUP","WOMAP_ZENDOWN",{type:"logical_or_expr",
places:3}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["MTEX_RGBTOINT"],group:{type:"group",parts:[{type:"textline",tokens:"Al = vec4 ( u_sky_tex_color , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"An = Al . a ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["WOMAP_HORIZ"],group:{type:"group",parts:[{type:"textline",tokens:"As = Ac ( Al . rgb , As , An , u_sky_tex_fac [ 1 ] ) ;".split(" ")}]}}]},{type:"condition",
parts:[{type:"if",expression:["WOMAP_ZENUP","WOMAP_ZENDOWN",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["Ao","=","0.0",";"]},{type:"condition",parts:[{type:"if",expression:["WO_SKYREAL"],group:{type:"group",parts:[{type:"textline",tokens:"if ( dot ( Ar , vec3 ( 0.0 , 1.0 , 0.0 ) ) >= 0.0 ) {".split(" ")},{type:"condition",parts:[{type:"if",expression:["WOMAP_ZENUP"],group:{type:"group",parts:[{type:"textline",tokens:"Ao = u_sky_tex_fac [ 2 ] ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:[";"]}]}}]},{type:"textline",tokens:["}"]},{type:"condition",parts:[{type:"if",expression:["WOMAP_ZENDOWN"],group:{type:"group",parts:[{type:"textline",tokens:"else Ao = u_sky_tex_fac [ 3 ] ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["WOMAP_ZENUP"],group:{type:"group",parts:[{type:"textline",tokens:"Ao = u_sky_tex_fac [ 2 ] ;".split(" ")}]}},{type:"elif",expression:["WOMAP_ZENDOWN"],
group:{type:"group",parts:[{type:"textline",tokens:"Ao = u_sky_tex_fac [ 3 ] ;".split(" ")}]}}]}]}}]},{type:"textline",tokens:"if ( Ao != 0.0 ) At = Ac ( Al . rgb , At , An , Ao ) ;".split(" ")}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["WOMAP_BLEND"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["MTEX_RGBTOINT",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:"An = dot ( Al . rgb , vec3 ( 0.2126 , 0.7152 , 0.0722 ) ) ;".split(" ")}]}}]},
{type:"textline",tokens:"Am = Ak ( u_sky_tex_dvar , Am , An , u_sky_tex_fac [ 0 ] ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["WO_SKYBLEND"],group:{type:"group",parts:[{type:"textline",tokens:"Ap = mix ( As , At , Am ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["Ap","=","As",";"]}]}}]},{type:"textline",tokens:["bu","(","Ap",")",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"bu ( As ) ; bu ( At ) ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["WO_SKYBLEND"],group:{type:"group",parts:[{type:"textline",tokens:"Ap = mix ( As , At , Am ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["Ap","=","As",";"]}]}}]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",places:1},"REFLECTION_PASS",{type:"logic_negative_expr",places:1},{type:"logical_and_expr",places:3}],group:{type:"group",parts:[{type:"textline",
tokens:"br ( Ap ) ; Am = u_camera_eye_frag . y - WATER_LEVEL ; Am = min ( - Am * 0.03 , 0.8 ) ; An = clamp ( length ( u_sun_intensity ) + u_environment_energy , 0.0 , 1.0 ) ; As = vec3 ( 0.0 ) ; Al = u_underwater_fog_color_density ; Al . rgb = mix ( Al . rgb , As , min ( - Aq . y + Am , 1.0 ) ) * An ; Am = clamp ( sign ( Aq . y - 0.05 * Am ) , 0.0 , 1.0 ) ; Ap = mix ( Al . rgb , Ap , Am ) ; bu ( Ap ) ;".split(" ")}]}}]},{type:"textline",tokens:"gl_FragColor = vec4 ( Ap , 1.0 ) ; }".split(" ")}]};
a["special_skydome.glslv"]={type:"group",parts:[{type:"textline",tokens:"attribute vec3 a_position ; uniform mat4 u_sky_vp_inverse ; varying vec3 xY ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["PROCEDURAL_SKYDOME",{type:"logic_negative_expr",places:1},"WO_SKYTEX","WO_SKYBLEND",{type:"logical_or_expr",places:2},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec2","bM",";"]}]}}]},{type:"textline",tokens:"void main ( ) { vec4 zY , zZ ; zY = vec4 ( a_position . xy , 0.9999999 , 1.0 ) ; zZ = u_sky_vp_inverse * zY ; xY = zZ . xyz ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["PROCEDURAL_SKYDOME",{type:"logic_negative_expr",places:1},"WO_SKYTEX","WO_SKYBLEND",{type:"logical_or_expr",places:2},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"bM = a_position . xy ;".split(" ")}]}}]},{type:"textline",tokens:["gl_Position","=","zY",";","}"]}]};a["special_water.glslf"]={type:"group",parts:[{type:"var",name:"ABSORB",tokens:["0.0"]},{type:"var",name:"WATER_LEVEL",tokens:["0.0"]},{type:"var",
name:"SSS_STRENGTH",tokens:["6.0"]},{type:"var",name:"SSS_WIDTH",tokens:["0.0"]},{type:"var",name:"PRECISION",tokens:["lowp"]},{type:"var",name:"NUM_LIGHTS",tokens:["0"]},{type:"var",name:"LAMP_IND",tokens:["0"]},{type:"var",name:"LAMP_SPOT_SIZE",tokens:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",tokens:["0"]},{type:"var",name:"LAMP_LIGHT_DIST",tokens:["0"]},{type:"var",name:"LAMP_LIGHT_FACT_IND",tokens:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",tokens:["rgb"]},{type:"var",name:"LAMP_SHADOW_MAP_IND",
tokens:["0"]},{type:"var",name:"NUM_LFACTORS",tokens:["0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"procedural.glslf"},{type:"include",file:"pack.glslf"},{type:"include",file:"color_util.glslf"},{type:"include",file:"math.glslv"},{type:"define",name:"REFL_BUMP",tokens:["0.001"]},{type:"define",name:"REFR_BUMP",tokens:["0.0005"]},{type:"textline",tokens:["uniform","float","u_time",";"]},{type:"condition",parts:[{type:"if",expression:["USE_ENVIRONMENT_LIGHT",
"SKY_TEXTURE",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","samplerCube","u_sky_texture",";"]}]}},{type:"elif",expression:["USE_ENVIRONMENT_LIGHT","SKY_COLOR",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},{type:"textline",tokens:["uniform","float","u_environment_energy",";"]},{type:"condition",parts:[{type:"if",expression:["NUM_LIGHTS",
0,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},{type:"textline",tokens:"uniform vec3 u_sun_intensity ; uniform vec3 u_sun_direction ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},
"SHORE_SMOOTHING","WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",places:1},{type:"logical_and_expr",places:2},{type:"logical_or_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","float","u_cam_water_depth",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["DISABLE_FOG",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS"],
group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec4","u_underwater_fog_color_density",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["PROCEDURAL_FOG"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat4","u_cube_fog",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_FOG"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec4","u_fog_params",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["NUM_NORMALMAPS",0,{type:"g_expr",
places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","sampler2D","u_normalmap0",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["REFRACTIVE"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","sampler2D","u_refractmap",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","sampler2D","u_plane_reflection",";"]}]}},{type:"elif",expression:["REFLECTION_TYPE",
"REFL_MIRRORMAP",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHORE_SMOOTHING"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","PRECISION","sampler2D","u_scene_depth",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["FOAM"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","sampler2D","u_foam",";"]}]}}]},{type:"textline",tokens:"uniform vec4 u_diffuse_color ; uniform vec2 u_diffuse_params ; uniform float u_diffuse_intensity ; uniform float u_ambient ; uniform vec4 u_fresnel_params ; uniform vec3 u_specular_color ; uniform vec3 u_specular_params ; uniform vec3 u_shallow_water_col ; uniform vec3 u_shore_water_col ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["NUM_NORMALMAPS",0,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform float u_water_norm_uv_velocity ; uniform vec2 u_normalmap0_scale ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["NUM_NORMALMAPS",1,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec2","u_normalmap1_scale",";"]},{type:"condition",parts:[{type:"if",expression:["NUM_NORMALMAPS",2,{type:"g_expr",
places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec2","u_normalmap2_scale",";"]},{type:"condition",parts:[{type:"if",expression:["NUM_NORMALMAPS",3,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec2","u_normalmap3_scale",";"]}]}}]}]}}]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","float","u_mirror_factor",
";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["uniform","float","u_reflect_factor",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHORE_SMOOTHING","DISABLE_FOG",{type:"logic_negative_expr",places:1},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","float","u_view_max_depth",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHORE_PARAMS"],group:{type:"group",parts:[{type:"textline",tokens:"uniform float u_water_shallow_col_fac ; uniform float u_water_shore_col_fac ;".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["FOAM"],group:{type:"group",parts:[{type:"textline",tokens:"uniform float u_foam_factor ; uniform vec2 u_foam_uv_freq ; uniform vec2 u_foam_mag ; uniform vec2 u_foam_scale ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["REFRACTIVE"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","float","u_refr_bump",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["DEBUG_WIREFRAME"],group:{type:"group",parts:[{type:"textline",
tokens:"const float zY = 1.0 ; uniform vec3 u_wireframe_edge_color ;".split(" ")}]}}]},{type:"textline",tokens:"varying vec3 vb ; varying vec3 bC ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["NUM_NORMALMAPS",0,{type:"g_expr",places:2},"FOAM",{type:"logical_or_expr",places:2},"GENERATED_MESH",{type:"logic_negative_expr",places:1},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec2","bM",";"]}]}}]},{type:"condition",parts:[{type:"if",
expression:["NUM_NORMALMAPS",0,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"varying vec3 bF ; varying vec3 zZ ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["DYNAMIC","NUM_NORMALMAPS",0,{type:"g_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","bE",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["NUM_NORMALMAPS",0,{type:"g_expr",places:2},"FOAM",{type:"logical_or_expr",
places:2},"GENERATED_MESH","DYNAMIC",{type:"logical_and_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","z_",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHORE_PARAMS"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","Aa",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},"REFRACTIVE",{type:"logical_or_expr",places:3}],group:{type:"group",
parts:[{type:"textline",tokens:["varying","vec3","bG",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},"REFRACTIVE","DISABLE_FOG",{type:"logic_negative_expr",places:1},{type:"logical_or_expr",places:4}],group:{type:"group",parts:[{type:"textline",tokens:["varying","float","bH",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["DEBUG_WIREFRAME"],group:{type:"group",parts:[{type:"textline",tokens:["varying",
"vec3","Ab",";"]}]}}]},{type:"include",file:"environment.glslf"},{type:"condition",parts:[{type:"if",expression:["REFRACTIVE","SHORE_SMOOTHING","USE_REFRACTION_CORRECTION",{type:"logical_and_expr",places:3}],group:{type:"group",parts:[{type:"include",file:"refraction.glslf"}]}}]},{type:"condition",parts:[{type:"if",expression:["DISABLE_FOG",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"include",file:"fog.glslf"}]}}]},{type:"textline",tokens:"vec3 An ( in vec2 Ac , in vec3 Ad , in vec3 Ae , in vec3 Af , out float Ag ) { float Ah , Ai , Aj ; vec2 Ak ; vec3 Al , Am ; Ag = 0.0 ; Al = reflect ( - Ae , Ad ) ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"Ak = Ac . xy + Ad . xz * REFL_BUMP / bH ; Ag = u_reflect_factor ; if ( u_cam_water_depth < 0.0 ) {".split(" ")},{type:"condition",parts:[{type:"if",expression:["DISABLE_FOG",{type:"logic_negative_expr",places:1},"WATER_EFFECTS",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"Am = u_underwater_fog_color_density . rgb ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"Am = u_diffuse_color . rgb ;".split(" ")}]}}]},{type:"textline",tokens:"} else { Am = texture2D ( u_plane_reflection , Ak ) . rgb ; br ( Am ) ; }".split(" ")}]}},{type:"elif",expression:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"Ag = u_mirror_factor ; Am = Af * textureCube ( u_mirrormap , Al ) . rgb ; br ( Am ) ;".split(" ")}]}},{type:"else",group:{type:"group",
parts:[{type:"textline",tokens:"Ag = u_reflect_factor ; Am = Af * vec3 ( 0.3 , 0.5 , 1.0 ) ; br ( Am ) ;".split(" ")}]}}]},{type:"textline",tokens:"Al = normalize ( Al + Ae ) ; Ah = 1.0 - dot ( Ae , Al ) ; Ai = u_fresnel_params [ 3 ] ; Aj = u_fresnel_params [ 2 ] ; Aj = Ai + ( 1.0 - Ai ) * pow ( Ah , Aj ) ; Ag = min ( Ag * Aj , 1.0 ) ; return Am ; }".split(" ")},{type:"include",file:"lighting_nodes.glslf"},{type:"textline",tokens:"void main ( ) { vec4 Ao ; vec2 Ap , Aq , Ar ; float As , At , Au , Av , Aw , Ax ; vec3 Ay , Az , AA , AB , AC , AD , AE , AF , AG ; mat3 AH ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["NUM_NORMALMAPS",0,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"AH = mat3 ( bF , zZ , bE ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["DYNAMIC"],group:{type:"group",parts:[{type:"textline",tokens:"Ay = normalize ( bE ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"Ay = vec3 ( 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["DYNAMIC",
"FOAM",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"As = bC . y - WATER_LEVEL ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["NUM_NORMALMAPS",0,{type:"g_expr",places:2},"FOAM",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["GENERATED_MESH"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["DYNAMIC"],group:{type:"group",parts:[{type:"textline",tokens:"Ap = vec2 ( z_ . x , - z_ . z ) + 0.5 ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"Ap = vec2 ( bC . x , - bC . z ) + 0.5 ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["Ap","=","bM",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["NUM_NORMALMAPS",0,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"Az = vec3 ( 0.0 ) ; AA = texture2D ( u_normalmap0 , Ap * u_normalmap0_scale + vec2 ( 0.3 , 0.5 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; Az += AA ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["FOAM"],group:{type:"group",parts:[{type:"textline",tokens:"AB = vec3 ( 0.0 ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["NORM_FOAM0"],group:{type:"group",parts:[{type:"textline",tokens:["AB","+=","AA",";"]}]}}]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["NUM_NORMALMAPS",1,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"AA = texture2D ( u_normalmap0 , Ap * u_normalmap1_scale + vec2 ( - 0.3 , 0.7 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; Az += AA ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["FOAM"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["NORM_FOAM1"],group:{type:"group",parts:[{type:"textline",tokens:["AB","+=","AA",";"]}]}}]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["NUM_NORMALMAPS",2,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"AA = texture2D ( u_normalmap0 , Ap * u_normalmap2_scale + vec2 ( 0.0 , 1.1 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; Az += AA ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["FOAM"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["NORM_FOAM2"],group:{type:"group",parts:[{type:"textline",tokens:["AB","+=","AA",";"]}]}}]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["NUM_NORMALMAPS",3,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"AA = texture2D ( u_normalmap0 , Ap * u_normalmap3_scale + vec2 ( - 0.66 , - 0.3 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; Az += AA ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["FOAM"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["NORM_FOAM3"],group:{type:"group",parts:[{type:"textline",tokens:["AB","+=","AA",";"]}]}}]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["NUM_NORMALMAPS",0,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["FOAM"],group:{type:"group",parts:[{type:"textline",tokens:"AB = AH * AB ; if ( ! f ( AB , vec3 ( 0.0 ) ) ) AB = normalize ( AB ) ; AB = mix ( Ay , AB , 0.2 ) ; AB = normalize ( AB ) ;".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["DYNAMIC"],group:{type:"group",parts:[{type:"textline",tokens:"Ay = mix ( Ay , normalize ( AH * Az ) , 0.3 ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"Ay = mix ( Ay , normalize ( AH * Az ) , 0.5 ) ;".split(" ")}]}}]},{type:"textline",tokens:"Ay = normalize ( Ay ) ;".split(" ")}]}}]},{type:"textline",tokens:"Az = normalize ( vb ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE",
"REFL_PLANE",{type:"equal_expr",places:2},"REFRACTIVE",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"Aq = bG . xy / bG . z ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["SHORE_SMOOTHING","DISABLE_FOG",{type:"logic_negative_expr",places:1},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"At = bH * u_view_max_depth ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["SHORE_SMOOTHING"],
group:{type:"group",parts:[{type:"textline",tokens:"Au = u_diffuse_color . a ; Ao = texture2DProj ( u_scene_depth , bG ) ; Av = Z ( Ao ) ; Aw = max ( Av - bH , 0.0 ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["REFRACTIVE"],group:{type:"group",parts:[{type:"textline",tokens:"Ar = Aq + Ay . xz * u_refr_bump / bH ; Av = dY ( Av , Ar , Aq ) ; Av = max ( Av - bH , 0.0 ) ; Av = u_view_max_depth / ABSORB * Av ; if ( u_cam_water_depth < 0.0 ) Ax = 0.0 ; else Ax = min ( Au * Av , 1.0 ) ; Av = u_view_max_depth / ABSORB * Aw ; Au = min ( 15.0 * Au * u_view_max_depth * Aw , 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"Av = u_view_max_depth / ABSORB * Aw ; if ( u_cam_water_depth > 0.0 ) Au = min ( Au * Av , 1.0 ) ;".split(" ")}]}}]},{type:"textline",tokens:"Au *= min ( 5.0 * At , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"Au = u_diffuse_color . a ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["REFRACTIVE"],group:{type:"group",parts:[{type:"textline",tokens:"Ax = 1.0 - Au ; Ar = Aq + Ay . xz * u_refr_bump / bH ;".split(" ")}]}}]}]}}]},
{type:"condition",parts:[{type:"if",expression:["REFRACTIVE"],group:{type:"group",parts:[{type:"textline",tokens:"AA = texture2D ( u_refractmap , Ar ) . rgb ; br ( AA ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["SHORE_PARAMS"],group:{type:"group",parts:[{type:"textline",tokens:"Av = pow ( min ( Aa . b / u_water_shallow_col_fac , 1.0 ) , 0.3 ) ; AC = mix ( u_shallow_water_col , u_diffuse_color . rgb , Av ) ; Av = pow ( min ( Aa . b / u_water_shore_col_fac , 1.0 ) , 0.3 ) ; AC = mix ( u_shore_water_col , AC , Av ) ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"AC = u_diffuse_color . rgb ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["FOAM"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["SHORE_SMOOTHING"],group:{type:"group",parts:[{type:"textline",tokens:"Aw = max ( 1.0 - u_view_max_depth * Aw , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"Aw = 1.0 - Au ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",
expression:["DYNAMIC"],group:{type:"group",parts:[{type:"textline",tokens:"As = max ( As / WAVES_HEIGHT + 0.1 , 0.0 ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SHORE_PARAMS"],group:{type:"group",parts:[{type:"textline",tokens:"AD = normalize ( vec3 ( Aa . r , 0.0 , Aa . g ) ) ; AD = normalize ( mix ( vec3 ( 0.0 , 1.0 , 0.0 ) , AD , 0.8 ) ) ; Av = 1.25 * max ( dot ( AB , AD ) - 0.2 , 0.0 ) ; Av += max ( dot ( AB , vec3 ( 0.0 , - 1.0 , 0.0 ) ) , 0.0 ) ; Aw += Av * ( 1.0 - Aa . b ) ; As *= ( 1.0 - 0.95 * pow ( Aa . b , 0.1 ) ) ;".split(" ")}]}}]},
{type:"textline",tokens:"Aw += As ; Aw = min ( u_foam_factor * Aw , 1.0 ) ;".split(" ")}]}}]},{type:"textline",tokens:"Ao = texture2D ( u_foam , u_foam_mag * sin ( u_foam_uv_freq * u_time ) + Ap * u_foam_scale ) ;".split(" ")}]}}]},{type:"textline",tokens:"As = u_specular_params [ 0 ] ; Ap = vec2 ( u_specular_params [ 1 ] , u_specular_params [ 2 ] ) ; AB = As * u_specular_color ; AD = u_environment_energy * dS ( Ay ) ; AD = u_ambient * AD ; AD = AD + u_sun_intensity ;".split(" ")},{type:"condition",
parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"AE = An ( Aq , Ay , Az , AD , As ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"AE = An ( vec2 ( 0.0 ) , Ay , Az , AD , As ) ;".split(" ")}]}}]},{type:"textline",tokens:"AC = u_diffuse_intensity * AC ; xh ( vec3 ( 0.0 ) , vec3 ( 0.0 ) , AC , AB , bC , Ay , Az , Ap , u_diffuse_params , vec4 ( 1.0 ) , 0.0 , vec4 ( 0.0 ) , AF , AG ) ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["DYNAMIC"],group:{type:"group",parts:[{type:"textline",tokens:"Av = max ( dot ( u_sun_direction , - bE ) + SSS_WIDTH , 0.0 ) * max ( dot ( - Az , u_sun_direction ) - 0.5 , 0.0 ) * max ( 0.0 , length ( u_sun_intensity ) - 0.1 ) ; Av = clamp ( SSS_STRENGTH * Av , 0.0 , 1.0 ) ; AF = mix ( AF , u_shallow_water_col , Av ) ; AF = mix ( AF , u_shore_water_col , Av ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["REFRACTIVE"],group:{type:"group",
parts:[{type:"textline",tokens:"AF = mix ( AA , AF , Ax ) ;".split(" ")}]}}]},{type:"textline",tokens:"AF = mix ( AF , AE , As ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["FOAM"],group:{type:"group",parts:[{type:"textline",tokens:"As = mix ( Ao . g , Ao . r , max ( 4.0 * ( Aw - 0.75 ) , 0.0 ) ) ; As = mix ( Ao . b , As , max ( 2.0 * Aw - 1.0 , 0.0 ) ) ; As = mix ( 0.0 , As , Aw ) ; AF = mix ( AF , AD , As ) ;".split(" ")}]}}]},{type:"textline",tokens:["AF","+=","AG",";"]},{type:"condition",
parts:[{type:"if",expression:["DISABLE_FOG",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS"],group:{type:"group",parts:[{type:"textline",tokens:"if ( u_cam_water_depth < 0.0 ) { uU ( AF , At , u_cam_water_depth ) ; } else { va ( AF , At , Az , 1.0 ) ; }".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"va ( AF , At , Az , 1.0 ) ;".split(" ")}]}}]}]}}]},{type:"textline",tokens:["bu","(",
"AF",")",";"]},{type:"condition",parts:[{type:"if",expression:["REFRACTIVE",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:"Au = max ( Au , AG . r ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["FOAM"],group:{type:"group",parts:[{type:"textline",tokens:["Au","+=","As",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["ALPHA"],group:{type:"group",parts:[{type:"textline",tokens:"bx ( AF , Au ) ;".split(" ")}]}}]},{type:"condition",
parts:[{type:"if",expression:["DEBUG_WIREFRAME"],group:{type:"group",parts:[{type:"extension",tokens:["GL_OES_standard_derivatives",":","enable"]},{type:"textline",tokens:"AG = fwidth ( Ab ) ; AG = smoothstep ( vec3 ( 0.0 ) , AG * zY , Ab ) ; As = min ( min ( AG . x , AG . y ) , AG . z ) ; As = clamp ( As , 0.0 , 1.0 ) ; AF = mix ( u_wireframe_edge_color , AF , As ) ; Au = mix ( 1.0 , Au , As ) ;".split(" ")}]}}]},{type:"textline",tokens:"gl_FragColor = vec4 ( AF , Au ) ; }".split(" ")}]};a["special_water.glslv"]=
{type:"group",parts:[{type:"var",name:"DIR_MIN_SHR_FAC",tokens:["0.0"]},{type:"var",name:"DIR_FREQ",tokens:["0.0"]},{type:"var",name:"DIR_NOISE_SCALE",tokens:["0.0"]},{type:"var",name:"DIR_NOISE_FREQ",tokens:["0.0"]},{type:"var",name:"DIR_MIN_NOISE_FAC",tokens:["0.0"]},{type:"var",name:"DST_NOISE_SCALE_0",tokens:["0.0"]},{type:"var",name:"DST_NOISE_FREQ_0",tokens:["0.0"]},{type:"var",name:"DST_NOISE_SCALE_1",tokens:["0.0"]},{type:"var",name:"DST_NOISE_FREQ_1",tokens:["0.0"]},{type:"var",name:"DST_MIN_FAC",
tokens:["0.0"]},{type:"var",name:"MAX_SHORE_DIST",tokens:["0.0"]},{type:"var",name:"PRECISION",tokens:["mediump"]},{type:"var",name:"SHORE_MAP_CENTER_X",tokens:["0.0"]},{type:"var",name:"SHORE_MAP_SIZE_X",tokens:["0.0"]},{type:"var",name:"SHORE_MAP_CENTER_Y",tokens:["0.0"]},{type:"var",name:"SHORE_MAP_SIZE_Y",tokens:["0.0"]},{type:"var",name:"WAVES_HOR_FAC",tokens:["0.0"]},{type:"var",name:"WATER_LEVEL",tokens:["0.0"]},{type:"var",name:"WAVES_HEIGHT",tokens:["0.0"]},{type:"var",name:"WAVES_LENGTH",
tokens:["0.0"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",file:"scale_texcoord.glslv"},{type:"include",file:"procedural.glslf"},{type:"textline",tokens:["attribute","vec3","a_position",";"]},{type:"condition",parts:[{type:"if",expression:["NUM_NORMALMAPS",0,{type:"g_expr",places:2},"DYNAMIC",{type:"logic_negative_expr",places:1},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"attribute vec3 a_normal ; attribute vec3 a_tangent ;".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["GENERATED_MESH",{type:"logic_negative_expr",places:1},"NUM_NORMALMAPS",0,{type:"g_expr",places:2},"FOAM",{type:"logical_or_expr",places:2},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["DEBUG_WIREFRAME"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","float","a_polyindex",";"]}]}}]},{type:"condition",
parts:[{type:"if",expression:["STATIC_BATCH"],group:{type:"group",parts:[{type:"textline",tokens:"const mat3 u_model_tsr = mat3 ( 0.0 , 0.0 , 0.0 , 1.0 , 0.0 , 0.0 , 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat3","u_model_tsr",";"]}]}}]},{type:"textline",tokens:"uniform mat3 u_view_tsr ; uniform mat4 u_proj_matrix ; uniform vec3 u_camera_eye ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["DYNAMIC"],group:{type:"group",
parts:[{type:"textline",tokens:"uniform PRECISION float u_time ; uniform vec3 u_wind ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},"REFRACTIVE","DISABLE_FOG",{type:"logic_negative_expr",places:1},{type:"logical_or_expr",places:4}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","PRECISION","float","u_view_max_depth",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHORE_PARAMS"],
group:{type:"group",parts:[{type:"textline",tokens:["uniform","sampler2D","u_shore_dist_map",";"]}]}}]},{type:"textline",tokens:"varying vec3 vb ; varying vec3 bC ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["NUM_NORMALMAPS",0,{type:"g_expr",places:2},"FOAM",{type:"logical_or_expr",places:2},"GENERATED_MESH",{type:"logic_negative_expr",places:1},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec2","bM",";"]}]}}]},{type:"condition",
parts:[{type:"if",expression:["NUM_NORMALMAPS",0,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"varying vec3 bF ; varying vec3 zZ ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["DYNAMIC","NUM_NORMALMAPS",0,{type:"g_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","bE",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["NUM_NORMALMAPS",0,{type:"g_expr",places:2},"FOAM",
{type:"logical_or_expr",places:2},"GENERATED_MESH","DYNAMIC",{type:"logical_and_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","z_",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHORE_PARAMS"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","Aa",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},"REFRACTIVE",{type:"logical_or_expr",places:3}],
group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","bG",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},"REFRACTIVE","DISABLE_FOG",{type:"logic_negative_expr",places:1},{type:"logical_or_expr",places:4}],group:{type:"group",parts:[{type:"textline",tokens:["varying","float","bH",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["DEBUG_WIREFRAME"],group:{type:"group",parts:[{type:"textline",
tokens:["varying","vec3","Ab",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHORE_PARAMS"],group:{type:"group",parts:[{type:"textline",tokens:"vec3 Ag ( in vec2 zY ) { float Ac ; vec4 Ad ; vec2 Ae ; Ae = 0.5 + vec2 ( ( zY . x - SHORE_MAP_CENTER_X ) / SHORE_MAP_SIZE_X , - ( zY . y + SHORE_MAP_CENTER_Y ) / SHORE_MAP_SIZE_Y ) ; Ad = texture2D ( u_shore_dist_map , Ae ) ; const vec2 Af = vec2 ( 1.0 / 255.0 , 1.0 ) ; Ac = dot ( Ad . ba , Af ) ; Ae = normalize ( Ad . rg * 2.0 - 1.0 ) ; return vec3 ( Ae , Ac ) ; }".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["DYNAMIC"],group:{type:"group",parts:[{type:"define",name:"M_PI",tokens:["3.14159265359"]},{type:"define",name:"SMALL_WAVES_FAC",tokens:["0.3"]},{type:"textline",tokens:"void As ( inout vec3 Ah , in float Ai , in vec3 Aj ) { vec2 Ak , Al , Am ; float An , Ao , Ap , Aq , Ar ; An = aU ( DST_NOISE_SCALE_0 * ( Ah . xz + DST_NOISE_FREQ_0 * Ai ) ) * aU ( DST_NOISE_SCALE_1 * ( Ah . zx - DST_NOISE_FREQ_1 * Ai ) ) ;".split(" ")},{type:"condition",parts:[{type:"if",
expression:["SHORE_PARAMS"],group:{type:"group",parts:[{type:"textline",tokens:"Ao = WAVES_LENGTH / MAX_SHORE_DIST / M_PI ; Ap = Aj . b ; Aq = sqrt ( Ap ) ; Ao = max ( Ap , DIR_MIN_SHR_FAC ) * sin ( Aq / Ao + DIR_FREQ * Ai ) ; Ar = max ( aU ( DIR_NOISE_SCALE * ( Ah . xz + DIR_NOISE_FREQ * Ai ) ) , DIR_MIN_NOISE_FAC ) ; Ao *= Ar ; Aq = WAVES_HEIGHT * mix ( Ao , An , max ( Aq , DST_MIN_FAC ) ) ; Ak = Aj . rg ; Ao = WAVES_HOR_FAC * Ao * max ( MAX_SHORE_DIST / 35.0 * ( 0.05 - Ap ) , 0.0 ) ; Ak = Ao * Ak ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"Aq = WAVES_HEIGHT * An ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["GENERATED_MESH"],group:{type:"group",parts:[{type:"textline",tokens:"Al = 2.0 * ( Ah . xz - 0.1 * Ai ) ; Am = 1.3 * ( Ah . zx + 0.03 * Ai ) ; An = ay ( 0.5 * Al ) . x + ay ( 0.5 * Am ) . x - 1.0 ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SHORE_PARAMS"],group:{type:"group",parts:[{type:"textline",tokens:"Ah . xz += Ak ; An *= Ap ;".split(" ")}]}}]},
{type:"textline",tokens:"Aq += SMALL_WAVES_FAC * An ;".split(" ")}]}}]},{type:"textline",tokens:"Ah . y += Aq ; }".split(" ")}]}}]},{type:"textline",tokens:"void main ( ) { vec4 At , Au ; vec2 Av ; float Aw , Ax , Ay ; vec3 Az , AA , AB , AC ; mat4 AD , AE ; AD = O ( u_view_tsr ) ; AE = O ( u_model_tsr ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["DEBUG_WIREFRAME"],group:{type:"group",parts:[{type:"textline",tokens:"if ( a_polyindex == 0.0 ) Ab = vec3 ( 1.0 , 0.0 , 0.0 ) ; else if ( a_polyindex == 1.0 ) Ab = vec3 ( 0.0 , 1.0 , 0.0 ) ; else if ( a_polyindex == 2.0 ) Ab = vec3 ( 0.0 , 0.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",tokens:["Az","=","a_position",";"]},{type:"condition",parts:[{type:"if",expression:["GENERATED_MESH"],group:{type:"group",parts:[{type:"textline",tokens:"Aw = abs ( Az . y ) ; Av = u_camera_eye . xz - mod ( u_camera_eye . xz , Aw ) ; Az . y = WATER_LEVEL ; Az . xz += Av ;".split(" ")}]}},{type:"elif",expression:["NUM_NORMALMAPS",0,{type:"g_expr",places:2},"FOAM",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["bM","=","a_texcoord",";"]}]}}]},
{type:"textline",tokens:"c AF = rB ( Az , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , AE ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SHORE_PARAMS"],group:{type:"group",parts:[{type:"textline",tokens:"Aa = Ag ( AF . a . xz ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["DYNAMIC"],group:{type:"group",parts:[{type:"textline",tokens:"Ax = length ( u_wind ) ; Ay = u_time ; Ay *= Ax ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["GENERATED_MESH"],
group:{type:"group",parts:[{type:"textline",tokens:"Aw = Aw ; Az = AF . a + vec3 ( Aw , 0.0 , 0.0 ) ; AA = AF . a + vec3 ( 0.0 , 0.0 , Aw ) ; if ( a_position . y < 0.0 ) { AF . a . y = WATER_LEVEL - 1.0 ; Az . y = AF . a . y ; AA . y = AF . a . y ; }".split(" ")},{type:"condition",parts:[{type:"if",expression:["NUM_NORMALMAPS",0,{type:"g_expr",places:2},"FOAM",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"z_ = AF . a ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",
parts:[{type:"textline",tokens:"Az = AF . a + vec3 ( 0.05 , 0.0 , 0.0 ) ; AA = AF . a + vec3 ( 0.0 , 0.0 , 0.05 ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["SHORE_PARAMS"],group:{type:"group",parts:[{type:"textline",tokens:"AB = Ag ( Az . xz ) ; AC = Ag ( AA . xz ) ; As ( Az , Ay , AB ) ; As ( AA , Ay , AC ) ; As ( AF . a , Ay , Aa ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"As ( Az , Ay , vec3 ( 0.0 ) ) ; As ( AA , Ay , vec3 ( 0.0 ) ) ; As ( AF . a , Ay , vec3 ( 0.0 ) ) ;".split(" ")}]}}]},
{type:"textline",tokens:"Az = normalize ( Az - AF . a ) ; AA = normalize ( AA - AF . a ) ; bE = normalize ( cross ( AA , Az ) ) ; Ay = dot ( bE , vec3 ( 0.0 , 1.0 , 0.0 ) ) ; Ay = clamp ( 0.8 - Ay , 0.0 , 1.0 ) ; bE = mix ( bE , vec3 ( 0.0 , 1.0 , 0.0 ) , Ay ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["NUM_NORMALMAPS",0,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["DYNAMIC",{type:"logic_negative_expr",places:1}],group:{type:"group",
parts:[{type:"textline",tokens:"AA = a_tangent ; bE = a_normal ;".split(" ")}]}}]},{type:"textline",tokens:"bF = AA ; zZ = cross ( bE , bF ) ;".split(" ")}]}}]},{type:"textline",tokens:"bC = AF . a ; vb = u_camera_eye - AF . a ; At = AD * vec4 ( AF . a , 1.0 ) ; Au = u_proj_matrix * At ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},"REFRACTIVE",{type:"logical_or_expr",places:3}],group:{type:"group",parts:[{type:"textline",
tokens:"Ay = Au . x ; Aw = Au . y ; Ax = Au . w ; bG . x = ( Ay + Ax ) / 2.0 ; bG . y = ( Aw + Ax ) / 2.0 ; bG . z = Ax ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},"REFRACTIVE","DISABLE_FOG",{type:"logic_negative_expr",places:1},{type:"logical_or_expr",places:4}],group:{type:"group",parts:[{type:"textline",tokens:"bH = - At . z / u_view_max_depth ;".split(" ")}]}}]},{type:"textline",tokens:["gl_Position",
"=","Au",";","}"]}]};a["wireframe.glslf"]={type:"group",parts:[{type:"define",name:"WM_NONE",tokens:["0"]},{type:"define",name:"WM_OPAQUE_WIREFRAME",tokens:["1"]},{type:"define",name:"WM_TRANSPARENT_WIREFRAME",tokens:["2"]},{type:"define",name:"WM_FRONT_BACK_VIEW",tokens:["3"]},{type:"define",name:"WM_DEBUG_SPHERES",tokens:["4"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"color_util.glslf"},{type:"condition",parts:[{type:"if",expression:["DEBUG_SPHERE",{type:"logic_negative_expr",
places:1}],group:{type:"group",parts:[{type:"textline",tokens:"uniform int u_wireframe_mode ; uniform vec3 u_wireframe_edge_color ;".split(" ")}]}}]},{type:"textline",tokens:"varying vec3 Ab ; const float zY = 1.0 ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["DEBUG_SPHERE"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["DEBUG_SPHERE_DYNAMIC"],group:{type:"group",parts:[{type:"textline",tokens:"const vec3 Ac = vec3 ( 1.0 , 0.05 , 0.05 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"const vec3 Ac = vec3 ( 0.05 , 0.05 , 1.0 ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"const vec3 Ad = vec3 ( 0.4 , 0.4 , 1.0 ) ; const vec3 Ae = vec3 ( 1.0 , 0.4 , 0.4 ) ; const vec3 Af = vec3 ( 1.0 , 1.0 , 1.0 ) ;".split(" ")}]}}]},{type:"textline",tokens:"void main ( ) { float Ag , Ah ; vec3 Ai , Aj ; Ai = vec3 ( 0.0 ) ; Ag = 0.0 ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["DEBUG_SPHERE"],
group:{type:"group",parts:[{type:"textline",tokens:"Aj = sign ( Ab - vec3 ( 0.02 * zY ) ) ; if ( Aj . x < 0.0 || Aj . y < 0.0 || Aj . z < 0.0 ) { Ai = Ac ; Ag = 1.0 ; } else discard ;".split(" ")}]}},{type:"elif",expression:["WIREFRAME_QUALITY",0,{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"Aj = sign ( Ab - vec3 ( 0.02 * zY ) ) ; if ( u_wireframe_mode == WM_OPAQUE_WIREFRAME ) { if ( Aj . x < 0.0 || Aj . y < 0.0 || Aj . z < 0.0 ) Ai = u_wireframe_edge_color ; else Ai = Af ; Ag = 1.0 ; } else if ( u_wireframe_mode == WM_TRANSPARENT_WIREFRAME ) { if ( Aj . x < 0.0 || Aj . y < 0.0 || Aj . z < 0.0 ) Ag = 1.0 ; else Ag = 0.0 ; Ai = u_wireframe_edge_color ; } else if ( u_wireframe_mode == WM_FRONT_BACK_VIEW ) { if ( Aj . x < 0.0 || Aj . y < 0.0 || Aj . z < 0.0 ) Ai = u_wireframe_edge_color ; else if ( gl_FrontFacing ) Ai = Ad ; else Ai = Ae ; Ag = 1.0 ; }".split(" ")}]}},
{type:"elif",expression:["WIREFRAME_QUALITY",1,{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"extension",tokens:["GL_OES_standard_derivatives",":","enable"]},{type:"textline",tokens:"Aj = fwidth ( Ab ) ; Aj = smoothstep ( vec3 ( 0.0 ) , Aj * zY , Ab ) ; Ah = min ( min ( Aj . x , Aj . y ) , Aj . z ) ; Ah = clamp ( Ah , 0.0 , 1.0 ) ; if ( u_wireframe_mode == WM_OPAQUE_WIREFRAME ) { Ai = vec3 ( mix ( u_wireframe_edge_color , Af , Ah ) ) ; Ag = 1.0 ; } else if ( u_wireframe_mode == WM_TRANSPARENT_WIREFRAME ) { Ai = u_wireframe_edge_color ; Ag = mix ( 1.0 , 0.0 , Ah ) ; } else if ( u_wireframe_mode == WM_FRONT_BACK_VIEW ) { if ( gl_FrontFacing ) Ai = mix ( u_wireframe_edge_color , Ad , Ah ) ; else Ai = mix ( u_wireframe_edge_color , Ae , Ah ) ; Ag = 1.0 ; }".split(" ")}]}}]},
{type:"textline",tokens:["bu","(","Ai",")",";"]},{type:"condition",parts:[{type:"if",expression:["ALPHA"],group:{type:"group",parts:[{type:"textline",tokens:"bx ( Ai , Ag ) ;".split(" ")}]}}]},{type:"textline",tokens:"gl_FragColor = vec4 ( Ai , Ag ) ; }".split(" ")}]};a["wireframe.glslv"]={type:"group",parts:[{type:"var",name:"AU_QUALIFIER",tokens:["uniform"]},{type:"var",name:"PRECISION",tokens:["lowp"]},{type:"var",name:"MAX_BONES",tokens:["0"]},{type:"include",file:"math.glslv"},{type:"include",
file:"to_world.glslv"},{type:"textline",tokens:"attribute vec3 a_position ; attribute vec3 a_normal ; attribute float a_polyindex ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["DEBUG_SPHERE",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["WIND_BEND"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["MAIN_BEND_COL"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","float","a_bending_col_main",
";"]},{type:"condition",parts:[{type:"if",expression:["DETAIL_BEND"],group:{type:"group",parts:[{type:"textline",tokens:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",tokens:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["BEND_CENTER_ONLY"],
group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["VERTEX_ANIM"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec3","a_position_next",";"]}]}}]},{type:"condition",
parts:[{type:"if",expression:["SKINNED"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec4","a_influence",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["STATIC_BATCH"],group:{type:"group",parts:[{type:"textline",tokens:"const mat3 u_model_tsr = mat3 ( 0.0 , 0.0 , 0.0 , 1.0 , 0.0 , 0.0 , 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat3","u_model_tsr",";"]}]}}]},{type:"textline",tokens:"uniform mat3 u_view_tsr ; uniform mat4 u_proj_matrix ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["DEBUG_SPHERE",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["WIND_BEND"],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec3 u_wind ; uniform PRECISION float u_time ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["BILLBOARD","BILLBOARD_JITTERED",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]}]}}]},
{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["VERTEX_ANIM"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SKINNED"],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ; uniform vec4 u_arm_rel_trans ; uniform vec4 u_arm_rel_quat ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["FRAMES_BLENDING"],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS"],group:{type:"group",parts:[{type:"textline",tokens:"uniform PRECISION sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]}]}}]},
{type:"textline",tokens:["varying","vec3","Ab",";"]},{type:"condition",parts:[{type:"if",expression:["DEBUG_SPHERE",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"include",file:"dynamic_grass.glslv"}]}}]},{type:"textline",tokens:"void main ( ) { vec3 zY , Ac , Ad , Ae , Af ; mat4 Ag , Ah , Ai ; Ag = O ( u_view_tsr ) ; Ah = O ( u_model_tsr ) ; if ( a_polyindex == 0.0 ) Ab = vec3 ( 1.0 , 0.0 , 0.0 ) ; else if ( a_polyindex == 1.0 ) Ab = vec3 ( 0.0 , 1.0 , 0.0 ) ; else if ( a_polyindex == 2.0 ) Ab = vec3 ( 0.0 , 0.0 , 1.0 ) ; zY = a_position ; Ac = a_normal ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["DEBUG_SPHERE"],group:{type:"group",parts:[{type:"textline",tokens:"c Aj = rB ( zY , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , Ah ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["VERTEX_ANIM"],group:{type:"group",parts:[{type:"textline",tokens:"zY = mix ( zY , a_position_next , u_va_frame_factor ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["SKINNED"],
group:{type:"group",parts:[{type:"textline",tokens:"Ad = vec3 ( 0.0 ) ; Ae = vec3 ( 0.0 ) ; sB ( zY , Ad , Ae , Ac ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:["Ae","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"Ae = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS"],
group:{type:"group",parts:[{type:"textline",tokens:"c Aj = t_ ( zY , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , Ae , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , Ag ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["BILLBOARD"],group:{type:"group",parts:[{type:"textline",tokens:"Ad = ( Ah * vec4 ( Ae , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["BILLBOARD_PRES_GLOB_ORIENTATION",
"STATIC_BATCH",{type:"logic_negative_expr",places:1},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"Ai = ru ( u_camera_eye , Ad , Ag , Ah ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"Ai = ro ( u_camera_eye , Ad , Ag ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["WIND_BEND","BILLBOARD_JITTERED",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"Af = ( Ah * vec4 ( Ae , 1.0 ) ) . xyz ; Ai = Ai * rg ( u_wind , u_time , u_jitter_amp , u_jitter_freq , Af ) ;".split(" ")}]}}]},
{type:"textline",tokens:"c Aj = rB ( zY - Ae , Ae , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , Ai ) ; Aj . b = Ad ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"c Aj = rB ( zY , Ae , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , Ah ) ;".split(" ")}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["WIND_BEND"],group:{type:"group",parts:[{type:"textline",tokens:"tp ( Aj . a , Aj . b , Ac ) ;".split(" ")}]}}]}]}}]},{type:"textline",tokens:"gl_Position = u_proj_matrix * Ag * vec4 ( Aj . a , 1.0 ) ; }".split(" ")}]};
a["postprocessing/antialiasing.glslf"]={type:"group",parts:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"color_util.glslf"},{type:"textline",tokens:"uniform sampler2D u_color ; uniform vec2 u_texel_size ; varying vec2 bM ;".split(" ")},{type:"define",name:"AA_METHOD_FXAA_LIGHT",tokens:["1"]},{type:"define",name:"AA_METHOD_FXAA_QUALITY",tokens:["2"]},{type:"define",name:"AA_QUALITY_LOW",tokens:["0"]},{type:"define",name:"AA_QUALITY_MEDIUM",tokens:["1"]},{type:"define",name:"AA_QUALITY_HIGH",
tokens:["2"]},{type:"condition",parts:[{type:"if",expression:["AA_METHOD","AA_METHOD_FXAA_LIGHT",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",name:"FXAA_REDUCE_MIN",tokens:["(","1.0","/","128.0",")"]},{type:"define",name:"FXAA_REDUCE_MUL",tokens:["(","1.0","/","8.0",")"]},{type:"define",name:"FXAA_SPAN_MAX",tokens:["8.0"]},{type:"textline",tokens:"vec4 Ae ( float zY , float Ac ) { vec2 Ad ; Ad = bM + vec2 ( zY , Ac ) * u_texel_size ; return texture2D ( u_color , Ad ) ; } vec4 Ar ( ) { vec2 Af ; float Ag , Ah , Ai , Aj , Ak , Al ; vec4 Am , An , Ao , Ap , Aq ; Am = Ae ( - 1.0 , - 1.0 ) ; An = Ae ( 1.0 , - 1.0 ) ; Ao = Ae ( - 1.0 , 1.0 ) ; Ap = Ae ( 1.0 , 1.0 ) ; Aq = Ae ( 0.0 , 0.0 ) ; Ag = bB ( Aq ) ; Ah = bB ( Am ) ; Ai = bB ( An ) ; Aj = bB ( Ao ) ; Ak = bB ( Ap ) ; Al = min ( Ag , min ( min ( Ah , Ai ) , min ( Aj , Ak ) ) ) ; Ag = max ( Ag , max ( max ( Ah , Ai ) , max ( Aj , Ak ) ) ) ; Af . x = - ( ( Ah + Ai ) - ( Aj + Ak ) ) ; Af . y = ( ( Ah + Aj ) - ( Ai + Ak ) ) ; Ak = max ( ( Ah + Ai + Aj + Ak ) * ( 0.25 * FXAA_REDUCE_MUL ) , FXAA_REDUCE_MIN ) ; Ak = 1.0 / ( min ( abs ( Af . x ) , abs ( Af . y ) ) + Ak ) ; Af = min ( vec2 ( FXAA_SPAN_MAX , FXAA_SPAN_MAX ) , max ( vec2 ( - FXAA_SPAN_MAX , - FXAA_SPAN_MAX ) , Af * Ak ) ) * u_texel_size ; Ap = 0.5 * ( texture2D ( u_color , bM + Af * ( 1.0 / 3.0 - 0.5 ) ) + texture2D ( u_color , bM + Af * ( 2.0 / 3.0 - 0.5 ) ) ) ; Ao = Ap * 0.5 + 0.25 * ( texture2D ( u_color , bM + Af * - 0.5 ) + texture2D ( u_color , bM + Af * 0.5 ) ) ; Ak = bB ( Ao ) ; if ( ( Ak < Al ) || ( Ak > Ag ) ) return Ap ; else return Ao ; }".split(" ")}]}},
{type:"elif",expression:["AA_METHOD","AA_METHOD_FXAA_QUALITY",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",name:"FXAA_GREEN_AS_LUMA",tokens:["1"]},{type:"define",name:"FXAA_BLEND4WEB",tokens:["1"]},{type:"include",file:"fxaa.glslf"},{type:"condition",parts:[{type:"if",expression:["AA_QUALITY","AA_QUALITY_HIGH",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",name:"FXAA_QUALITY_PRESET",tokens:["39"]},{type:"define",name:"FXAA_QUALITY_SUBPIX",tokens:["1.00"]},
{type:"define",name:"FXAA_QUALITY_EDGE_THRESHOLD",tokens:["0.063"]},{type:"define",name:"FXAA_QUALITY_EDGE_THRESHOLD_MIN",tokens:["0.0312"]}]}},{type:"elif",expression:["AA_QUALITY","AA_QUALITY_MEDIUM",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",name:"FXAA_QUALITY_PRESET",tokens:["20"]},{type:"define",name:"FXAA_QUALITY_SUBPIX",tokens:["0.65"]},{type:"define",name:"FXAA_QUALITY_EDGE_THRESHOLD",tokens:["0.166"]},{type:"define",name:"FXAA_QUALITY_EDGE_THRESHOLD_MIN",tokens:["0.0625"]}]}},
{type:"elif",expression:["AA_QUALITY","AA_QUALITY_LOW",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",name:"FXAA_QUALITY_PRESET",tokens:["12"]},{type:"define",name:"FXAA_QUALITY_SUBPIX",tokens:["0.50"]},{type:"define",name:"FXAA_QUALITY_EDGE_THRESHOLD",tokens:["0.166"]},{type:"define",name:"FXAA_QUALITY_EDGE_THRESHOLD_MIN",tokens:["0.0833"]}]}}]}]}}]},{type:"textline",tokens:"void main ( ) { vec2 Bi ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["AA_METHOD",
"AA_METHOD_FXAA_LIGHT",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"gl_FragColor = Ar ( ) ;".split(" ")}]}},{type:"elif",expression:["AA_METHOD","AA_METHOD_FXAA_QUALITY",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"Bi = u_texel_size ; gl_FragColor = Bh ( bM , u_color , Bi , FXAA_QUALITY_SUBPIX , FXAA_QUALITY_EDGE_THRESHOLD , FXAA_QUALITY_EDGE_THRESHOLD_MIN ) ;".split(" ")}]}}]},{type:"textline",tokens:["}"]}]};a["postprocessing/bloom_blur.glslf"]=
{type:"group",parts:[{type:"include",file:"precision_statement.glslf"},{type:"textline",tokens:"uniform vec2 u_texel_size ; uniform sampler2D u_color ; varying vec2 bM ; void main ( ) { vec4 zY ; vec2 Ac , Ad ; Ac = vec2 ( 0.0 , 0.0 ) ; Ad = u_texel_size ; zY = texture2D ( u_color , bM ) ; gl_FragColor = zY * 0.0875447373698 ; Ac += Ad ; gl_FragColor += texture2D ( u_color , bM + Ac ) * 0.0858112354248 ; gl_FragColor += texture2D ( u_color , bM - Ac ) * 0.0858112354248 ; Ac += Ad ; gl_FragColor += texture2D ( u_color , bM + Ac ) * 0.0808139781061 ; gl_FragColor += texture2D ( u_color , bM - Ac ) * 0.0808139781061 ; Ac += Ad ; gl_FragColor += texture2D ( u_color , bM + Ac ) * 0.0731235112908 ; gl_FragColor += texture2D ( u_color , bM - Ac ) * 0.0731235112908 ; Ac += Ad ; gl_FragColor += texture2D ( u_color , bM + Ac ) * 0.0635705267419 ; gl_FragColor += texture2D ( u_color , bM - Ac ) * 0.0635705267419 ; Ac += Ad ; gl_FragColor += texture2D ( u_color , bM + Ac ) * 0.0530985673112 ; gl_FragColor += texture2D ( u_color , bM - Ac ) * 0.0530985673112 ; Ac += Ad ; gl_FragColor += texture2D ( u_color , bM + Ac ) * 0.0426125984122 ; gl_FragColor += texture2D ( u_color , bM - Ac ) * 0.0426125984122 ; Ac += Ad ; gl_FragColor += texture2D ( u_color , bM + Ac ) * 0.0328565115809 ; gl_FragColor += texture2D ( u_color , bM - Ac ) * 0.0328565115809 ; Ac += Ad ; gl_FragColor += texture2D ( u_color , bM + Ac ) * 0.0243407024472 ; gl_FragColor += texture2D ( u_color , bM - Ac ) * 0.0243407024472 ; gl_FragColor = max ( 0.7 * zY , gl_FragColor ) ; }".split(" ")}]};
a["postprocessing/bloom_combine.glslf"]={type:"group",parts:[{type:"include",file:"precision_statement.glslf"},{type:"textline",tokens:"uniform sampler2D u_main ; uniform sampler2D u_bloom ; varying vec2 bM ; void main ( ) { vec4 zY , Ac ; zY = texture2D ( u_main , bM ) ; Ac = texture2D ( u_bloom , bM ) ; zY = zY ; zY += Ac ; gl_FragColor = vec4 ( zY . rgb , 1.0 ) ; }".split(" ")}]};a["postprocessing/compositing.glslf"]={type:"group",parts:[{type:"include",file:"precision_statement.glslf"},{type:"include",
file:"color_util.glslf"},{type:"define",name:"PI_4",tokens:["0.785398163"]},{type:"textline",tokens:"uniform sampler2D u_color ; uniform float u_brightness ; uniform float u_contrast ; uniform float u_exposure ; uniform float u_saturation ; varying vec2 bM ; void main ( ) { float zY ; vec3 Ac ; vec4 Ad ; Ad = texture2D ( u_color , bM ) ; Ac = Ad . rgb ; if ( u_brightness < 0.0 ) Ac = Ac * ( 1.0 + u_brightness ) ; else Ac = Ac + ( ( 1.0 - Ac ) * u_brightness ) ; Ac = ( Ac - 0.5 ) * ( tan ( ( u_contrast + 1.0 ) * PI_4 ) ) + 0.5 ; Ac *= u_exposure ; zY = bB ( vec4 ( Ac , 0.0 ) ) ; Ac = mix ( vec3 ( zY ) , Ac , u_saturation ) ; gl_FragColor = vec4 ( Ac , Ad . a ) ; }".split(" ")}]};
a["postprocessing/depth_pack.glslf"]={type:"group",parts:[{type:"var",name:"PRECISION",tokens:["lowp"]},{type:"textline",tokens:["precision","PRECISION","sampler2D",";"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"textline",tokens:"uniform sampler2D u_depth ; uniform vec2 u_camera_range ; varying vec2 bM ; void main ( ) { gl_FragColor = V ( clamp ( Bo ( u_depth , bM , u_camera_range ) , 0.0 , 0.999999 ) ) ; }".split(" ")}]};
a["postprocessing/dof.glslf"]={type:"group",parts:[{type:"var",name:"PRECISION",tokens:["lowp"]},{type:"textline",tokens:["precision","PRECISION","sampler2D",";"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"textline",tokens:"uniform sampler2D u_sharp ; uniform sampler2D u_blurred ; uniform sampler2D u_depth ; uniform float u_view_max_depth ; uniform float u_dof_dist ; uniform float u_dof_front ; uniform float u_dof_rear ; uniform vec2 u_camera_range ; varying vec2 bM ; void main ( ) { float zY , Ac ; vec4 Ad , Ae ; Ad = texture2D ( u_sharp , bM ) ; if ( u_dof_dist > 0.0 ) { zY = Bo ( u_depth , bM , u_camera_range ) ; zY *= u_view_max_depth ; if ( zY < u_dof_dist ) Ac = ( u_dof_dist - zY ) / u_dof_front ; else Ac = ( zY - u_dof_dist ) / u_dof_rear ; Ac = clamp ( Ac , 0.0 , 1.0 ) ; Ae = texture2D ( u_blurred , bM ) ; gl_FragColor = mix ( Ad , Ae , Ac ) ; } else gl_FragColor = Ad ; }".split(" ")}]};
a["postprocessing/glow.glslf"]={type:"group",parts:[{type:"include",file:"precision_statement.glslf"},{type:"textline",tokens:"uniform sampler2D u_src_color ; uniform sampler2D u_glow_mask_small ; uniform sampler2D u_glow_mask_large ; uniform float u_glow_mask_small_coeff ; uniform float u_glow_mask_large_coeff ; varying vec2 bM ; void main ( ) { float zY ; vec4 Ac , Ad , Ae ; Ac = texture2D ( u_src_color , bM ) ; Ad = texture2D ( u_glow_mask_small , bM ) ; Ae = texture2D ( u_glow_mask_large , bM ) ; gl_FragColor = Ac ; if ( Ae . a != 0.0 ) { zY = u_glow_mask_large_coeff * Ae . a ; zY = clamp ( zY , 0.0 , 1.0 ) ; gl_FragColor . rgb = mix ( gl_FragColor . rgb , Ae . rgb / Ae . a , zY ) ; gl_FragColor . a = mix ( gl_FragColor . a , 1.0 , zY ) ; } if ( Ad . a != 0.0 ) { zY = u_glow_mask_small_coeff * Ad . a ; zY = clamp ( zY , 0.0 , 1.0 ) ; gl_FragColor . rgb = mix ( gl_FragColor . rgb , Ad . rgb / Ad . a , zY ) ; gl_FragColor . a = mix ( gl_FragColor . a , 1.0 , zY ) ; } }".split(" ")}]};
a["postprocessing/god_rays.glslf"]={type:"group",parts:[{type:"var",name:"PRECISION",tokens:["lowp"]},{type:"textline",tokens:["precision","PRECISION","sampler2D",";"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"include",file:"procedural.glslf"},{type:"include",file:"pack.glslf"},{type:"var",name:"STEPS_PER_PASS",tokens:["0.0"]},{type:"textline",tokens:"uniform float u_time ; uniform float u_radial_blur_step ; uniform sampler2D u_input ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["DEPTH_RGBA"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec2","u_camera_range",";"]},{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS"],group:{type:"group",parts:[{type:"textline",tokens:"varying float Bp ; varying vec2 Bq ;".split(" ")}]}}]}]}}]},{type:"textline",tokens:"varying vec2 bM ; varying vec4 Br ; void main ( ) { vec4 Bs ; int Bt ; float Bu , Bv , Bw , Bx ; vec2 By , Bz , BA ; By = ( Br . xy - bM ) ; Bu = length ( By ) ; By = u_radial_blur_step * By / Bu ; Bv = Bu / u_radial_blur_step ; By *= min ( Bv , STEPS_PER_PASS ) / STEPS_PER_PASS ; Bv = max ( Bv , STEPS_PER_PASS ) ; Bz = bM ; Bw = 0.0 ; const int BB = int ( STEPS_PER_PASS ) ; Bt = int ( Bv + 0.5 ) ; for ( int BC = 0 ; BC < BB ; BC += 1 ) { if ( BC <= Bt ) {".split(" ")},
{type:"condition",parts:[{type:"if",expression:["DEPTH_RGBA"],group:{type:"group",parts:[{type:"textline",tokens:"Bv = Bo ( u_input , Bz , u_camera_range ) ; Bw += max ( ( 1.0 - pow ( Bu , 0.3 ) ) * step ( 0.9 , Bv ) , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"Bs = texture2D ( u_input , Bz ) ; Bw += Z ( Bs ) ;".split(" ")}]}}]},{type:"textline",tokens:"} Bz += By ; }".split(" ")},{type:"condition",parts:[{type:"if",expression:["DEPTH_RGBA","WATER_EFFECTS",
{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"BA = bM + Bq ; Bx = ay ( vec2 ( 2.5 * ( BA . x ) , 2.5 * ( BA . y ) + 1.0 * u_time ) ) . x + 0.75 * ay ( vec2 ( 5.0 * ( BA . x ) - 0.66 * u_time , 5.0 * ( BA . y ) + 0.66 * u_time ) ) . x + 0.5 * aU ( vec2 ( 7.5 * ( BA . x ) + 0.33 * u_time , 7.5 * ( BA . y ) - 0.33 * u_time ) ) ; Bx *= clamp ( 1.2 - sqrt ( 0.2 * Bu ) , 0.0 , 1.0 ) * Bp ; Bw = max ( Bx , Bw ) ;".split(" ")}]}}]},{type:"textline",tokens:"gl_FragColor = V ( Bw / STEPS_PER_PASS ) ; }".split(" ")}]};
a["postprocessing/god_rays.glslv"]={type:"group",parts:[{type:"include",file:"math.glslv"},{type:"textline",tokens:"attribute vec2 a_bb_vertex ; uniform mat4 u_view_proj_matrix ; uniform vec3 u_sun_direction ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["DEPTH_RGBA"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS"],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec4 u_camera_quat ; uniform float u_cam_water_depth ; varying float Bp ; varying vec2 Bq ;".split(" ")}]}}]}]}}]},
{type:"textline",tokens:"varying vec2 bM ; varying vec4 Br ; void main ( ) { float zY , Ac ; vec3 Ad ; bM = a_bb_vertex + 0.5 ; Ad = normalize ( u_sun_direction ) ; Br = u_view_proj_matrix * vec4 ( Ad , 0.0 ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["DEPTH_RGBA","WATER_EFFECTS",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"if ( u_cam_water_depth < 0.0 ) { Bp = 1.0 ; Ad = vec3 ( 0.0 , 1.0 , 0.0 ) ; Ad = i ( u_camera_quat , Ad ) ; Ad = normalize ( Ad ) ; zY = dot ( Ad , vec3 ( 0.0 , 1.0 , 0.0 ) ) ; Ac = atan ( Ad . x , Ad . z ) ; Bq = vec2 ( - Ac , acos ( zY ) ) ; } else { Bp = 0.0 ; }".split(" ")}]}}]},
{type:"textline",tokens:"Br . xy = 0.5 * ( Br . xy / Br . w + 1.0 ) ; Br += 99999.0 * step ( Br . z , 0.0 ) ; gl_Position = vec4 ( 2.0 * a_bb_vertex . xy , 0.0 , 1.0 ) ; }".split(" ")}]};a["postprocessing/god_rays_combine.glslf"]={type:"group",parts:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"color_util.glslf"},{type:"include",file:"pack.glslf"},{type:"textline",tokens:"uniform sampler2D u_main ; uniform sampler2D u_god_rays ; uniform float u_god_rays_intensity ; uniform vec3 u_sun_intensity ; varying vec2 bM ; void main ( ) { float zY ; vec3 Ac ; vec4 Ad ; Ad = texture2D ( u_main , bM ) ; Ac = clamp ( u_sun_intensity , 0.4 , 0.8 ) ; br ( Ad . rgb ) ; zY = Z ( texture2D ( u_god_rays , bM ) ) ; Ac = Ad . rgb + u_god_rays_intensity * vec3 ( zY ) * Ac ; bu ( Ac ) ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["SAFARI_CANVAS_ALPHA_HACK"],group:{type:"group",parts:[{type:"textline",tokens:"gl_FragColor = vec4 ( Ac , max ( 0.01 , Ad . a ) ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"gl_FragColor = vec4 ( Ac , Ad . a ) ;".split(" ")}]}}]},{type:"textline",tokens:["}"]}]};a["postprocessing/luminance.glslf"]={type:"group",parts:[{type:"include",file:"precision_statement.glslf"},{type:"textline",tokens:"uniform sampler2D u_input ; varying vec2 bM ; void main ( ) { float zY ; vec4 Ac ; Ac = texture2D ( u_input , bM ) ; zY = dot ( Ac . rgb , vec3 ( 0.2126 , 0.7152 , 0.0722 ) ) ; gl_FragColor = vec4 ( vec3 ( zY ) , 1.0 ) ; }".split(" ")}]};
a["postprocessing/luminance_av.glslf"]={type:"group",parts:[{type:"include",file:"precision_statement.glslf"},{type:"textline",tokens:"uniform sampler2D u_input ; void main ( ) { float zY , Ac , Ad , Ae ; Ac = 0.0 ; Ad = 0.025 ; Ae = 0.025 ; for ( int Af = 0 ; Af < 20 ; Af += 1 ) { Ae = 0.025 ; for ( int Ag = 0 ; Ag < 20 ; Ag += 1 ) { zY = max ( texture2D ( u_input , vec2 ( Ad , Ae ) ) . r , 0.01 ) ; Ac += log ( zY ) ; Ae += 0.05 ; } Ad += 0.05 ; } Ac = exp ( Ac / 400.0 ) ; gl_FragColor = vec4 ( vec3 ( Ac ) , 1.0 ) ; }".split(" ")}]};
a["postprocessing/luminance_trunced.glslf"]={type:"group",parts:[{type:"include",file:"precision_statement.glslf"},{type:"textline",tokens:"uniform sampler2D u_main ; uniform sampler2D u_luminance ; uniform sampler2D u_average_lum ; uniform float u_bloom_edge_lum ; varying vec2 bM ; varying float Bs ; void main ( ) { vec4 Bt ; float Bu , Bv ; Bu = texture2D ( u_average_lum , vec2 ( 0.5 ) ) . r ; Bv = texture2D ( u_luminance , bM ) . r ; Bt = texture2D ( u_main , bM ) ; Bu = Bv / Bu ; Bv = u_bloom_edge_lum ; gl_FragColor = Bt * max ( Bu - Bv , 0.0 ) * Bs ; }".split(" ")}]};
a["postprocessing/luminance_trunced.glslv"]={type:"group",parts:[{type:"textline",tokens:"attribute vec2 a_position ; uniform vec4 u_camera_quat ; uniform vec3 u_sun_direction ; uniform float u_bloom_key ; varying vec2 bM ; varying float Bs ; const vec3 zY = vec3 ( 0.0 , 1.0 , 0.0 ) ; void Aj ( in vec4 Ac , in vec3 Ad , out vec3 Ae ) { float Af , Ag , Ah , Ai ; Af = Ac . w * Ad . x + Ac . y * Ad . z - Ac . z * Ad . y ; Ag = Ac . w * Ad . y + Ac . z * Ad . x - Ac . x * Ad . z ; Ah = Ac . w * Ad . z + Ac . x * Ad . y - Ac . y * Ad . x ; Ai = - Ac . x * Ad . x - Ac . y * Ad . y - Ac . z * Ad . z ; Ae . x = Af * Ac . w - Ai * Ac . x - Ag * Ac . z + Ah * Ac . y ; Ae . y = Ag * Ac . w - Ai * Ac . y - Ah * Ac . x + Af * Ac . z ; Ae . z = Ah * Ac . w - Ai * Ac . z - Af * Ac . y + Ag * Ac . x ; } void main ( ) { vec3 Ak ; bM = 2.0 * a_position ; Aj ( u_camera_quat , zY , Ak ) ; Bs = dot ( - Ak , u_sun_direction ) * u_bloom_key ; Bs *= max ( sign ( u_sun_direction . y ) , 0.0 ) ; gl_Position = vec4 ( 4.0 * ( a_position . xy - 0.25 ) , 0.0 , 1.0 ) ; }".split(" ")}]};
a["postprocessing/motion_blur.glslf"]={type:"group",parts:[{type:"include",file:"precision_statement.glslf"},{type:"textline",tokens:"uniform sampler2D u_mb_tex_curr ; uniform sampler2D u_mb_tex_accum ; uniform float u_motion_blur_exp ; uniform float u_motion_blur_decay_threshold ; varying vec2 bM ; float zY = 0.0042 ; void main ( ) { vec4 Ac , Ad , Ae , Af ; Ac = texture2D ( u_mb_tex_curr , bM ) ; Ad = texture2D ( u_mb_tex_accum , bM ) ; if ( length ( Ac - Ad ) > u_motion_blur_decay_threshold ) { Ae = ( 1.0 - u_motion_blur_exp ) * Ac + u_motion_blur_exp * Ad ; Ae = Ae - Ad ; Af = Ac - Ad ; Ae = min ( max ( abs ( Ae ) , vec4 ( zY ) ) , abs ( Af ) ) * sign ( Ae ) ; gl_FragColor = Ad + Ae ; } else { gl_FragColor = Ac ; } }".split(" ")}]};
a["postprocessing/outline.glslf"]={type:"group",parts:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"color_util.glslf"},{type:"textline",tokens:"uniform sampler2D u_outline_src ; uniform sampler2D u_outline_mask ; uniform sampler2D u_outline_mask_blurred ; uniform vec3 u_outline_color ; uniform float u_draw_outline ; varying vec2 bM ; void main ( ) { vec3 zY ; float Ac ; vec4 Ad , Ae , Af ; Ad = texture2D ( u_outline_src , bM ) ; gl_FragColor = Ad ; if ( u_draw_outline != 0.0 ) { Ae = texture2D ( u_outline_mask , bM ) ; Af = texture2D ( u_outline_mask_blurred , bM ) ; Ac = Af . a - Ae . a ; if ( Ac != 0.0 ) { Ac = smoothstep ( 0.0 , 1.0 , Af . a ) ; if ( Ae . a == 0.0 ) { zY = u_outline_color ; bu ( zY ) ; Ae = vec4 ( clamp ( zY , 0.0 , 1.0 ) , 1.0 ) ; gl_FragColor = mix ( Ad , Ae , Ac ) ; } } } }".split(" ")}]};
a["postprocessing/performance.glslf"]={type:"group",parts:[{type:"include",file:"precision_statement.glslf"},{type:"textline",tokens:"uniform sampler2D u_color ; varying vec2 bM ; void main ( ) { vec4 zY ; zY = vec4 ( 0.0 ) ; for ( int Ac = 0 ; Ac < 100 ; Ac ++ ) zY += 0.001 * texture2D ( u_color , bM + vec2 ( 0.001 * vec2 ( Ac ) ) ) ; gl_FragColor = zY ; }".split(" ")}]};a["postprocessing/postprocessing.glslf"]={type:"group",parts:[{type:"include",file:"precision_statement.glslf"},{type:"define",
name:"POST_EFFECT_NONE",tokens:["1"]},{type:"define",name:"POST_EFFECT_GRAYSCALE",tokens:["2"]},{type:"define",name:"POST_EFFECT_X_BLUR",tokens:["3"]},{type:"define",name:"POST_EFFECT_Y_BLUR",tokens:["4"]},{type:"define",name:"POST_EFFECT_X_EXTEND",tokens:["5"]},{type:"define",name:"POST_EFFECT_Y_EXTEND",tokens:["6"]},{type:"define",name:"FLIP_CUBEMAP_COORDS",tokens:["7"]},{type:"textline",tokens:"uniform vec2 u_texel_size ; uniform sampler2D u_color ;".split(" ")},{type:"condition",parts:[{type:"if",
expression:["POST_EFFECT","FLIP_CUBEMAP_COORDS",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform int u_tex_number ; uniform vec2 u_delta ;".split(" ")}]}}]},{type:"textline",tokens:"varying vec2 bM ; void main ( ) { float zY , Ac , Ad , Ae ; vec2 Af , Ag ; vec4 Ah ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["POST_EFFECT","POST_EFFECT_NONE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"gl_FragColor = texture2D ( u_color , bM ) ;".split(" ")}]}},
{type:"elif",expression:["POST_EFFECT","POST_EFFECT_GRAYSCALE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"Ah = texture2D ( u_color , bM ) ; gl_FragColor . rgb = vec3 ( ( Ah . r + Ah . g + Ah . b ) / 3.0 ) ; gl_FragColor . a = 1.0 ;".split(" ")}]}},{type:"elif",expression:["POST_EFFECT","POST_EFFECT_X_BLUR",{type:"equal_expr",places:2},"POST_EFFECT","POST_EFFECT_Y_BLUR",{type:"equal_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",
tokens:"Af = vec2 ( 0.0 , 0.0 ) ; Ag = u_texel_size ; Ah = texture2D ( u_color , bM ) ; gl_FragColor = Ah * 0.2270270270 ; Af += Ag ; Ah = texture2D ( u_color , bM + Af ) ; gl_FragColor += Ah * 0.1945945946 ; Ah = texture2D ( u_color , bM - Af ) ; gl_FragColor += Ah * 0.1945945946 ; Af += Ag ; Ah = texture2D ( u_color , bM + Af ) ; gl_FragColor += Ah * 0.1216216216 ; Ah = texture2D ( u_color , bM - Af ) ; gl_FragColor += Ah * 0.1216216216 ; Af += Ag ; Ah = texture2D ( u_color , bM + Af ) ; gl_FragColor += Ah * 0.0540540541 ; Ah = texture2D ( u_color , bM - Af ) ; gl_FragColor += Ah * 0.0540540541 ; Af += Ag ; Ah = texture2D ( u_color , bM + Af ) ; gl_FragColor += Ah * 0.0162162162 ; Ah = texture2D ( u_color , bM - Af ) ; gl_FragColor += Ah * 0.0162162162 ;".split(" ")}]}},
{type:"elif",expression:["POST_EFFECT","POST_EFFECT_X_GLOW_BLUR",{type:"equal_expr",places:2},"POST_EFFECT","POST_EFFECT_Y_GLOW_BLUR",{type:"equal_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"Af = vec2 ( 0.0 , 0.0 ) ; Ag = u_texel_size ; Ah = texture2D ( u_color , bM ) ; gl_FragColor = Ah * ( 1.0 - step ( 0.0 , - Ah . a ) ) * 0.152507 ; Af += Ag ; Ah = texture2D ( u_color , bM + Af ) ; gl_FragColor += Ah * ( 1.0 - step ( 0.0 , - Ah . a ) ) * 0.141763 ; Ah = texture2D ( u_color , bM - Af ) ; gl_FragColor += Ah * ( 1.0 - step ( 0.0 , - Ah . a ) ) * 0.141763 ; Af += Ag ; Ah = texture2D ( u_color , bM + Af ) ; gl_FragColor += Ah * ( 1.0 - step ( 0.0 , - Ah . a ) ) * 0.113861 ; Ah = texture2D ( u_color , bM - Af ) ; gl_FragColor += Ah * ( 1.0 - step ( 0.0 , - Ah . a ) ) * 0.113861 ; Af += Ag ; Ah = texture2D ( u_color , bM + Af ) ; gl_FragColor += Ah * ( 1.0 - step ( 0.0 , - Ah . a ) ) * 0.079019 ; Ah = texture2D ( u_color , bM - Af ) ; gl_FragColor += Ah * ( 1.0 - step ( 0.0 , - Ah . a ) ) * 0.079019 ; Af += Ag ; Ah = texture2D ( u_color , bM + Af ) ; gl_FragColor += Ah * ( 1.0 - step ( 0.0 , - Ah . a ) ) * 0.047383 ; Ah = texture2D ( u_color , bM - Af ) ; gl_FragColor += Ah * ( 1.0 - step ( 0.0 , - Ah . a ) ) * 0.047383 ; Af += Ag ; Ah = texture2D ( u_color , bM + Af ) ; gl_FragColor += Ah * ( 1.0 - step ( 0.0 , - Ah . a ) ) * 0.024549 ; Ah = texture2D ( u_color , bM - Af ) ; gl_FragColor += Ah * ( 1.0 - step ( 0.0 , - Ah . a ) ) * 0.024549 ; Af += Ag ; Ah = texture2D ( u_color , bM + Af ) ; gl_FragColor += Ah * ( 1.0 - step ( 0.0 , - Ah . a ) ) * 0.01099 ; Ah = texture2D ( u_color , bM - Af ) ; gl_FragColor += Ah * ( 1.0 - step ( 0.0 , - Ah . a ) ) * 0.01099 ; Af += Ag ; Ah = texture2D ( u_color , bM + Af ) ; gl_FragColor += Ah * ( 1.0 - step ( 0.0 , - Ah . a ) ) * 0.00425 ; Ah = texture2D ( u_color , bM - Af ) ; gl_FragColor += Ah * ( 1.0 - step ( 0.0 , - Ah . a ) ) * 0.00425 ; Af += Ag ; Ah = texture2D ( u_color , bM + Af ) ; gl_FragColor += Ah * ( 1.0 - step ( 0.0 , - Ah . a ) ) * 0.00142 ; Ah = texture2D ( u_color , bM - Af ) ; gl_FragColor += Ah * ( 1.0 - step ( 0.0 , - Ah . a ) ) * 0.00142 ; gl_FragColor = clamp ( gl_FragColor , 0.0 , 1.0 ) ;".split(" ")}]}},
{type:"elif",expression:["POST_EFFECT","POST_EFFECT_X_EXTEND",{type:"equal_expr",places:2},"POST_EFFECT","POST_EFFECT_Y_EXTEND",{type:"equal_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"Ag = u_texel_size ; Ah = texture2D ( u_color , bM ) ; gl_FragColor = Ah ; if ( Ah . a == 0.0 ) { Ah = texture2D ( u_color , bM + Ag ) ; if ( Ah . a > 0.0 ) gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , Ah . a ) ; else { Ah = texture2D ( u_color , bM - Ag ) ; if ( Ah . a > 0.0 ) gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , Ah . a ) ; } }".split(" ")}]}},
{type:"elif",expression:["POST_EFFECT","FLIP_CUBEMAP_COORDS",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"zY = u_delta [ 0 ] ; Ac = u_delta [ 1 ] ; Ad = 1.0 / 3.0 ; Ae = 0.5 ; Ag = vec2 ( Ad , Ae ) ; if ( u_tex_number == 0 ) { Af = bM * Ag + vec2 ( 2.0 * Ad , 0.0 ) ; Af [ 0 ] = min ( Af [ 0 ] , 1.0 - zY ) ; Af [ 1 ] = min ( Af [ 1 ] , 0.5 - Ac ) ; gl_FragColor = texture2D ( u_color , vec2 ( 5.0 * Ad - Af [ 0 ] , Af [ 1 ] ) ) ; } else if ( u_tex_number == 1 ) { Af = bM * Ag ; Af [ 0 ] = max ( Af [ 0 ] , zY ) ; Af [ 1 ] = min ( Af [ 1 ] , 0.5 - Ac ) ; gl_FragColor = texture2D ( u_color , vec2 ( Ad - Af [ 0 ] , Af [ 1 ] ) ) ; } else if ( u_tex_number == 2 ) { Af = bM * Ag + vec2 ( Ad , Ae ) ; Af [ 0 ] = max ( Af [ 0 ] , Ad + zY ) ; Af [ 0 ] = min ( Af [ 0 ] , 2.0 * Ad - zY ) ; Af [ 1 ] = min ( Af [ 1 ] , 1.0 - Ac ) ; gl_FragColor = texture2D ( u_color , vec2 ( Af [ 0 ] , 3.0 * Ae - Af [ 1 ] ) ) ; } else if ( u_tex_number == 3 ) { Af = bM * Ag + vec2 ( 0.0 , Ae ) ; Af [ 0 ] = min ( Af [ 0 ] , Ad - zY ) ; Af [ 1 ] = min ( Af [ 1 ] , 1.0 - Ac ) ; gl_FragColor = texture2D ( u_color , vec2 ( Af [ 0 ] , 3.0 * Ae - Af [ 1 ] ) ) ; } else if ( u_tex_number == 4 ) { Af = bM * Ag + vec2 ( Ad , 0.0 ) ; Af [ 0 ] = max ( Af [ 0 ] , Ad + zY ) ; Af [ 0 ] = min ( Af [ 0 ] , 2.0 * Ad - zY ) ; Af [ 1 ] = min ( Af [ 1 ] , 0.5 - Ac ) ; gl_FragColor = texture2D ( u_color , vec2 ( 1.0 - Af [ 0 ] , Af [ 1 ] ) ) ; } else { Ag = bM * Ag + vec2 ( 2.0 * Ad , Ae ) ; Ag [ 0 ] = min ( Ag [ 0 ] , 1.0 - zY ) ; Ag [ 1 ] = max ( Ag [ 1 ] , 0.5 + Ac ) ; gl_FragColor = texture2D ( u_color , vec2 ( 5.0 * Ad - Ag [ 0 ] , Ag [ 1 ] ) ) ; }".split(" ")}]}}]},
{type:"textline",tokens:["}"]}]};a["postprocessing/postprocessing.glslv"]={type:"group",parts:[{type:"textline",tokens:"attribute vec2 a_position ; varying vec2 bM ; void main ( ) { bM = 2.0 * a_position ; gl_Position = vec4 ( 4.0 * ( a_position . xy - 0.25 ) , 0.0 , 1.0 ) ; }".split(" ")}]};a["postprocessing/smaa.glslf"]={type:"group",parts:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"color_util.glslf"},{type:"include",file:"pack.glslf"},{type:"define",name:"SMAA_RESOLVE",
tokens:["1"]},{type:"define",name:"SMAA_EDGE_DETECTION",tokens:["2"]},{type:"define",name:"SMAA_BLENDING_WEIGHT_CALCULATION",tokens:["3"]},{type:"define",name:"SMAA_NEIGHBORHOOD_BLENDING",tokens:["4"]},{type:"define",name:"AA_METHOD_SMAA_LOW",tokens:["1"]},{type:"define",name:"AA_METHOD_SMAA_MEDIUM",tokens:["2"]},{type:"define",name:"AA_METHOD_SMAA_HIGH",tokens:["3"]},{type:"define",name:"AA_METHOD_SMAA_ULTRA",tokens:["4"]},{type:"textline",tokens:["uniform","sampler2D","u_color",";"]},{type:"condition",
parts:[{type:"if",expression:["SMAA_PASS","SMAA_RESOLVE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","sampler2D","u_color_prev",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","sampler2D","u_blend",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SMAA_REPROJECTION"],group:{type:"group",parts:[{type:"textline",
tokens:["uniform","sampler2D","u_velocity_tex",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SMAA_PASS","SMAA_EDGE_DETECTION",{type:"equal_expr",places:2},"SMAA_PREDICATION",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","sampler2D","u_predication_tex",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SMAA_PASS","SMAA_BLENDING_WEIGHT_CALCULATION",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform sampler2D u_search_tex ; uniform sampler2D u_area_tex ; uniform vec4 u_subsample_indices ;".split(" ")}]}}]},
{type:"textline",tokens:"uniform vec2 u_texel_size ; varying vec2 bM ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","Bt",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"varying vec4 Bu ; varying vec4 Bv ; varying vec4 Bw ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["SMAA_PASS","SMAA_BLENDING_WEIGHT_CALCULATION",
{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec2","Bx",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["AA_METHOD","AA_METHOD_SMAA_LOW",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",name:"SMAA_THRESHOLD",tokens:["0.15"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",tokens:["1"]},{type:"define",name:"SMAA_DISABLE_CORNER_DETECTION",tokens:["1"]}]}},{type:"elif",expression:["AA_METHOD","AA_METHOD_SMAA_MEDIUM",
{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",name:"SMAA_THRESHOLD",tokens:["0.1"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",tokens:["1"]},{type:"define",name:"SMAA_DISABLE_CORNER_DETECTION",tokens:["1"]}]}},{type:"elif",expression:["AA_METHOD","AA_METHOD_SMAA_HIGH",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",name:"SMAA_THRESHOLD",tokens:["0.1"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",tokens:["0"]},{type:"define",name:"SMAA_MAX_SEARCH_STEPS_DIAG",
tokens:["8"]},{type:"define",name:"SMAA_CORNER_ROUNDING",tokens:["25"]}]}},{type:"elif",expression:["AA_METHOD","AA_METHOD_SMAA_ULTRA",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",name:"SMAA_THRESHOLD",tokens:["0.05"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",tokens:["0"]},{type:"define",name:"SMAA_MAX_SEARCH_STEPS_DIAG",tokens:["16"]},{type:"define",name:"SMAA_CORNER_ROUNDING",tokens:["25"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"SMAA_THRESHOLD",group:{type:"group",
parts:[{type:"define",name:"SMAA_THRESHOLD",tokens:["0.1"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"SMAA_DEPTH_THRESHOLD",group:{type:"group",parts:[{type:"define",name:"SMAA_DEPTH_THRESHOLD",tokens:["(","0.1","*","SMAA_THRESHOLD",")"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"SMAA_MAX_SEARCH_STEPS_DIAG",group:{type:"group",parts:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS_DIAG",tokens:["8"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"SMAA_CORNER_ROUNDING",group:{type:"group",
parts:[{type:"define",name:"SMAA_CORNER_ROUNDING",tokens:["25"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR",group:{type:"group",parts:[{type:"define",name:"SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR",tokens:["2.0"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"SMAA_PREDICATION",group:{type:"group",parts:[{type:"define",name:"SMAA_PREDICATION",tokens:["0"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"SMAA_PREDICATION_THRESHOLD",group:{type:"group",
parts:[{type:"define",name:"SMAA_PREDICATION_THRESHOLD",tokens:["0.01"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"SMAA_PREDICATION_SCALE",group:{type:"group",parts:[{type:"define",name:"SMAA_PREDICATION_SCALE",tokens:["2.0"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"SMAA_PREDICATION_STRENGTH",group:{type:"group",parts:[{type:"define",name:"SMAA_PREDICATION_STRENGTH",tokens:["0.4"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"SMAA_REPROJECTION",group:{type:"group",parts:[{type:"define",
name:"SMAA_REPROJECTION",tokens:["0"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"SMAA_REPROJECTION_WEIGHT_SCALE",group:{type:"group",parts:[{type:"define",name:"SMAA_REPROJECTION_WEIGHT_SCALE",tokens:["30.0"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"SMAA_MAX_SEARCH_STEPS",group:{type:"group",parts:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",tokens:["16"]}]}}]},{type:"define",name:"SMAA_AREATEX_MAX_DISTANCE",tokens:["16"]},{type:"define",name:"SMAA_AREATEX_MAX_DISTANCE_DIAG",tokens:["20"]},
{type:"define",name:"SMAA_AREATEX_PIXEL_SIZE",tokens:"( 1.0 / vec2 ( 160.0 , 560.0 ) )".split(" ")},{type:"define",name:"SMAA_AREATEX_SUBTEX_SIZE",tokens:["(","1.0","/","7.0",")"]},{type:"define",name:"SMAA_SEARCHTEX_SIZE",tokens:"vec2 ( 66.0 , 33.0 )".split(" ")},{type:"define",name:"SMAA_SEARCHTEX_PACKED_SIZE",tokens:"vec2 ( 64.0 , 16.0 )".split(" ")},{type:"define",name:"SMAA_CORNER_ROUNDING_NORM",tokens:"( float ( SMAA_CORNER_ROUNDING ) / 100.0 )".split(" ")},{type:"condition",parts:[{type:"if",
expression:["SMAA_PASS","SMAA_EDGE_DETECTION",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"vec3 BD ( vec2 By , sampler2D Bz ) { float BA , BB , BC ; BA = texture2D ( Bz , By ) . r ; BB = texture2D ( Bz , Bu . xy ) . r ; BC = texture2D ( Bz , Bu . zw ) . r ; return vec3 ( BA , BB , BC ) ; }".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["SMAA_PASS","SMAA_EDGE_DETECTION",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",
tokens:"vec2 BI ( vec2 BE , sampler2D BF ) { vec2 BG ; vec3 BH ; BH = BD ( BE , BF ) ; BG = abs ( BH . xx - BH . yz ) ; BG = step ( SMAA_PREDICATION_THRESHOLD , BG ) ; return SMAA_PREDICATION_SCALE * SMAA_THRESHOLD * ( 1.0 - SMAA_PREDICATION_STRENGTH * BG ) ; }".split(" ")}]}}]},{type:"textline",tokens:"void BM ( bvec2 BJ , inout vec2 BK , vec2 BL ) { if ( BJ . x ) BK . x = BL . x ; if ( BJ . y ) BK . y = BL . y ; } void BM ( bvec4 BN , inout vec4 BO , vec4 BP ) { BM ( BN . xy , BO . xy , BP . xy ) ; BM ( BN . zw , BO . zw , BP . zw ) ; } vec2 BR ( vec2 BQ ) { return sign ( BQ ) * floor ( abs ( BQ ) + .5 ) ; } vec4 BR ( vec4 BS ) { return sign ( BS ) * floor ( abs ( BS ) + .5 ) ; }".split(" ")},
{type:"condition",parts:[{type:"if",expression:["SMAA_PASS","SMAA_EDGE_DETECTION",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"vec2 Ce ( vec2 BT , sampler2D BU".split(" ")},{type:"condition",parts:[{type:"if",expression:["SMAA_PREDICATION"],group:{type:"group",parts:[{type:"textline",tokens:[",","sampler2D","BV"]}]}}]},{type:"textline",tokens:") { vec4 BW ; float BX , BY , BZ , B_ , Ca ; vec3 Cb ; vec2 Cc , Cd ;".split(" ")},{type:"condition",parts:[{type:"if",
expression:["SMAA_PREDICATION"],group:{type:"group",parts:[{type:"textline",tokens:"Cc = BI ( BT , BV ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"Cc = vec2 ( SMAA_THRESHOLD , SMAA_THRESHOLD ) ;".split(" ")}]}}]},{type:"textline",tokens:"Cb = vec3 ( 0.2126 , 0.7152 , 0.0722 ) ; BX = dot ( texture2D ( BU , BT ) . rgb , Cb ) ; BY = dot ( texture2D ( BU , Bu . xy ) . rgb , Cb ) ; BZ = dot ( texture2D ( BU , Bu . zw ) . rgb , Cb ) ; BW . xy = abs ( BX - vec2 ( BY , BZ ) ) ; Cc = step ( Cc , BW . xy ) ; if ( dot ( Cc , vec2 ( 1.0 , 1.0 ) ) == 0.0 ) discard ; B_ = dot ( texture2D ( BU , Bv . xy ) . rgb , Cb ) ; Ca = dot ( texture2D ( BU , Bv . zw ) . rgb , Cb ) ; BW . zw = abs ( BX - vec2 ( B_ , Ca ) ) ; Cd = max ( BW . xy , BW . zw ) ; Ca = dot ( texture2D ( BU , Bw . xy ) . rgb , Cb ) ; B_ = dot ( texture2D ( BU , Bw . zw ) . rgb , Cb ) ; BW . zw = abs ( vec2 ( BY , BZ ) - vec2 ( Ca , B_ ) ) ; Cd = max ( Cd . xy , BW . zw ) ; B_ = max ( Cd . x , Cd . y ) ; Cc . xy *= step ( B_ , SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR * BW . xy ) ; return Cc ; }".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["SMAA_DISABLE_DIAG_DETECTION",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:"vec2 Cg ( vec2 Cf ) { Cf . r = Cf . r * abs ( 5.0 * Cf . r - 5.0 * 0.75 ) ; return BR ( Cf ) ; } vec4 Cg ( vec4 Ch ) { Ch . rb = Ch . rb * abs ( 5.0 * Ch . rb - 5.0 * 0.75 ) ; return BR ( Ch ) ; } vec2 Cp ( sampler2D Ci , vec2 Cj , vec2 Ck , out vec2 Cl ) { vec3 Cm ; vec4 Cn ; Cn = vec4 ( Cj , - 1.0 , 1.0 ) ; Cm = vec3 ( u_texel_size , 1.0 ) ; for ( int Co = 0 ; Co < SMAA_MAX_SEARCH_STEPS_DIAG ; Co ++ ) { if ( Cn . z < float ( SMAA_MAX_SEARCH_STEPS_DIAG - 1 ) && Cn . w > 0.9 ) { Cn . xyz += Cm * vec3 ( Ck , 1.0 ) ; Cl = texture2D ( Ci , Cn . xy , 0.0 ) . rg ; Cn . w = dot ( Cl , vec2 ( 0.5 , 0.5 ) ) ; } } return Cn . zw ; } vec2 Cx ( sampler2D Cq , vec2 Cr , vec2 Cs , out vec2 Ct ) { vec3 Cu ; vec4 Cv ; Cv = vec4 ( Cr , - 1.0 , 1.0 ) ; Cv . x += 0.25 * u_texel_size . x ; Cu = vec3 ( u_texel_size , 1.0 ) ; for ( int Cw = 0 ; Cw < SMAA_MAX_SEARCH_STEPS_DIAG ; Cw ++ ) { if ( Cv . z < float ( SMAA_MAX_SEARCH_STEPS_DIAG - 1 ) && Cv . w > 0.9 ) { Cv . xyz = Cu * vec3 ( Cs , 1.0 ) + Cv . xyz ; Ct = texture2D ( Cq , Cv . xy , 0.0 ) . rg ; Ct = Cg ( Ct ) ; Cv . w = dot ( Ct , vec2 ( 0.5 , 0.5 ) ) ; } } return Cv . zw ; } vec2 CD ( sampler2D Cy , vec2 Cz , vec2 CA , float CB ) { vec2 CC ; CC = vec2 ( SMAA_AREATEX_MAX_DISTANCE_DIAG , SMAA_AREATEX_MAX_DISTANCE_DIAG ) * CA + Cz ; CC = SMAA_AREATEX_PIXEL_SIZE * CC + 0.5 * SMAA_AREATEX_PIXEL_SIZE ; CC . x += 0.5 ; CC . y += SMAA_AREATEX_SUBTEX_SIZE * CB ; return texture2D ( Cy , CC , 0.0 ) . rg ; } vec2 CP ( sampler2D CE , sampler2D CF , vec2 CG , vec2 CH , vec4 CI ) { vec4 CJ , CK , CL ; vec2 CM , CN , CO ; CM = vec2 ( 0.0 , 0.0 ) ; if ( CH . r > 0.0 ) { CJ . xz = Cp ( CE , CG , vec2 ( - 1.0 , 1.0 ) , CN ) ; CJ . x += float ( CN . y > 0.9 ) ; } else CJ . xz = vec2 ( 0.0 , 0.0 ) ; CJ . yw = Cp ( CE , CG , vec2 ( 1.0 , - 1.0 ) , CN ) ; if ( CJ . x + CJ . y > 2.0 ) { CK = vec4 ( - CJ . x + 0.25 , CJ . x , CJ . y , - CJ . y - 0.25 ) * u_texel_size . xyxy + CG . xyxy ; CL . xy = texture2D ( CE , CK . xy + u_texel_size * vec2 ( - 1 , 0 ) , 0.0 ) . rg ; CL . zw = texture2D ( CE , CK . zw + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . rg ; CL . yxwz = Cg ( CL . xyzw ) ; CO = vec2 ( 2.0 , 2.0 ) * CL . xz + CL . yw ; BM ( bvec2 ( step ( 0.9 , CJ . zw ) ) , CO , vec2 ( 0.0 , 0.0 ) ) ; CM += CD ( CF , CJ . xy , CO , CI . z ) ; } CJ . xz = Cx ( CE , CG , vec2 ( - 1 , - 1 ) , CN ) ; if ( texture2D ( CE , CG + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . r > 0.0 ) { CJ . yw = Cx ( CE , CG , vec2 ( 1 , 1 ) , CN ) ; CJ . y += float ( CN . y > 0.9 ) ; } else CJ . yw = vec2 ( 0.0 , 0.0 ) ; if ( CJ . x + CJ . y > 2.0 ) { CL = vec4 ( - CJ . x , - CJ . x , CJ . y , CJ . y ) * u_texel_size . xyxy + CG . xyxy ; CK . x = texture2D ( CE , CL . xy + u_texel_size * vec2 ( - 1 , 0 ) , 0.0 ) . g ; CK . y = texture2D ( CE , CL . xy + u_texel_size * vec2 ( 0 , - 1 ) , 0.0 ) . r ; CK . zw = texture2D ( CE , CL . zw + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . gr ; CN = vec2 ( 2.0 , 2.0 ) * CK . xz + CK . yw ; BM ( bvec2 ( step ( 0.9 , CJ . zw ) ) , CN , vec2 ( 0 , 0 ) ) ; CM += CD ( CF , CJ . xy , CN , CI . w ) . gr ; } return CM ; }".split(" ")}]}}]},
{type:"textline",tokens:"float CV ( sampler2D CQ , vec2 CR , float CS ) { vec2 CT , CU ; CT = SMAA_SEARCHTEX_SIZE * vec2 ( 0.5 , - 1.0 ) ; CU = SMAA_SEARCHTEX_SIZE * vec2 ( CS , 1.0 ) ; CT += vec2 ( - 1.0 , 1.0 ) ; CU += vec2 ( 0.5 , - 0.5 ) ; CT *= 1.0 / SMAA_SEARCHTEX_PACKED_SIZE ; CU *= 1.0 / SMAA_SEARCHTEX_PACKED_SIZE ; return texture2D ( CQ , CT * CR + CU , 0.0 ) . r ; } float Dc ( sampler2D CW , sampler2D CX , vec2 CY , float CZ ) { float C_ ; vec2 Da ; Da = vec2 ( 0.0 , 1.0 ) ; for ( int Db = 0 ; Db < SMAA_MAX_SEARCH_STEPS ; Db ++ ) { if ( CY . x > CZ && Da . g > 0.8281 && Da . r == 0.0 ) { Da = texture2D ( CW , CY , 0.0 ) . rg ; CY = - vec2 ( 2.0 , 0.0 ) * u_texel_size + CY ; } } C_ = - ( 255.0 / 127.0 ) * CV ( CX , Da , 0.0 ) + 3.25 ; return u_texel_size . x * C_ + CY . x ; } float Dk ( sampler2D Dd , sampler2D De , vec2 Df , float Dg ) { float Dh ; vec2 Di ; Di = vec2 ( 0.0 , 1.0 ) ; for ( int Dj = 0 ; Dj < SMAA_MAX_SEARCH_STEPS ; Dj ++ ) { if ( Df . x < Dg && Di . g > 0.8281 && Di . r == 0.0 ) { Di = texture2D ( Dd , Df , 0.0 ) . rg ; Df = vec2 ( 2.0 , 0.0 ) * u_texel_size + Df ; } } Dh = - ( 255.0 / 127.0 ) * CV ( De , Di , 0.5 ) + 3.25 ; return - u_texel_size . x * Dh + Df . x ; } float Ds ( sampler2D Dl , sampler2D Dm , vec2 Dn , float Do ) { float Dp ; vec2 Dq ; Dq = vec2 ( 1.0 , 0.0 ) ; for ( int Dr = 0 ; Dr < SMAA_MAX_SEARCH_STEPS ; Dr ++ ) { if ( Dn . y > Do && Dq . r > 0.8281 && Dq . g == 0.0 ) { Dq = texture2D ( Dl , Dn , 0.0 ) . rg ; Dn = - vec2 ( 0.0 , 2.0 ) * u_texel_size + Dn ; } } Dp = - ( 255.0 / 127.0 ) * CV ( Dm , Dq . gr , 0.0 ) + 3.25 ; return u_texel_size . y * Dp + Dn . y ; } float DA ( sampler2D Dt , sampler2D Du , vec2 Dv , float Dw ) { float Dx ; vec2 Dy ; Dy = vec2 ( 1.0 , 0.0 ) ; for ( int Dz = 0 ; Dz < SMAA_MAX_SEARCH_STEPS ; Dz ++ ) { if ( Dv . y < Dw && Dy . r > 0.8281 && Dy . g == 0.0 ) { Dy = texture2D ( Dt , Dv , 0.0 ) . rg ; Dv = vec2 ( 0.0 , 2.0 ) * u_texel_size + Dv ; } } Dx = - ( 255.0 / 127.0 ) * CV ( Du , Dy . gr , 0.5 ) + 3.25 ; return - u_texel_size . y * Dx + Dv . y ; } vec2 DH ( sampler2D DB , vec2 DC , float DD , float DE , float DF ) { vec2 DG ; DG = vec2 ( SMAA_AREATEX_MAX_DISTANCE , SMAA_AREATEX_MAX_DISTANCE ) * BR ( 4.0 * vec2 ( DD , DE ) ) + DC ; DG = SMAA_AREATEX_PIXEL_SIZE * DG + 0.5 * SMAA_AREATEX_PIXEL_SIZE ; DG . y = SMAA_AREATEX_SUBTEX_SIZE * DF + DG . y ; return texture2D ( DB , DG , 0.0 ) . rg ; } void DO ( sampler2D DI , inout vec2 DJ , vec4 DK , vec2 DL ) { vec2 DM , DN ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["SMAA_DISABLE_CORNER_DETECTION",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:"DM = step ( DL . xy , DL . yx ) ; DN = ( 1.0 - SMAA_CORNER_ROUNDING_NORM ) * DM ; DN /= DM . x + DM . y ; DM = vec2 ( 1.0 , 1.0 ) ; DM . x -= DN . x * texture2D ( DI , DK . xy + u_texel_size * vec2 ( 0 , 1 ) , 0.0 ) . r ; DM . x -= DN . y * texture2D ( DI , DK . zw + u_texel_size * vec2 ( 1 , 1 ) , 0.0 ) . r ; DM . y -= DN . x * texture2D ( DI , DK . xy + u_texel_size * vec2 ( 0 , - 2 ) , 0.0 ) . r ; DM . y -= DN . y * texture2D ( DI , DK . zw + u_texel_size * vec2 ( 1 , - 2 ) , 0.0 ) . r ; DJ *= clamp ( DM , 0.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",tokens:"} void DV ( sampler2D DP , inout vec2 DQ , vec4 DR , vec2 DS ) { vec2 DT , DU ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SMAA_DISABLE_CORNER_DETECTION",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:"DT = step ( DS . xy , DS . yx ) ; DU = ( 1.0 - SMAA_CORNER_ROUNDING_NORM ) * DT ; DU /= DT . x + DT . y ; DT = vec2 ( 1.0 , 1.0 ) ; DT . x -= DU . x * texture2D ( DP , DR . xy + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . g ; DT . x -= DU . y * texture2D ( DP , DR . zw + u_texel_size * vec2 ( 1 , 1 ) , 0.0 ) . g ; DT . y -= DU . x * texture2D ( DP , DR . xy + u_texel_size * vec2 ( - 2 , 0 ) , 0.0 ) . g ; DT . y -= DU . y * texture2D ( DP , DR . zw + u_texel_size * vec2 ( - 2 , 1 ) , 0.0 ) . g ; DQ *= clamp ( DT , 0.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",tokens:["}"]},{type:"condition",parts:[{type:"if",expression:["SMAA_PASS","SMAA_BLENDING_WEIGHT_CALCULATION",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"vec4 Ei ( vec2 DW , vec2 DX , sampler2D DY , sampler2D DZ , sampler2D D_ , vec4 Ea ) { float Eb , Ec ; vec3 Ed ; vec2 Ee , Ef , Eg ; vec4 Eh ; Eh = vec4 ( 0.0 , 0.0 , 0.0 , 0.0 ) ; Ee = texture2D ( DY , DW ) . rg ; if ( Ee . g > 0.0 ) {".split(" ")},{type:"condition",parts:[{type:"if",expression:["SMAA_DISABLE_DIAG_DETECTION",
{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:"Eh . rg = CP ( DY , DZ , DW , Ee , Ea ) ; if ( Eh . r == - Eh . g ) {".split(" ")}]}}]},{type:"textline",tokens:"; Ed . x = Dc ( DY , D_ , Bu . xy , Bw . x ) ; Ed . y = Bv . y ; Ef . x = Ed . x ; Eb = texture2D ( DY , Ed . xy , 0.0 ) . r ; Ed . z = Dk ( DY , D_ , Bu . zw , Bw . y ) ; Ef . y = Ed . z ; Ef = abs ( BR ( Ef / u_texel_size . xx - DX . xx ) ) ; Eg = sqrt ( Ef ) ; Ec = texture2D ( DY , Ed . zy + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . r ; Eh . rg = DH ( DZ , Eg , Eb , Ec , Ea . y ) ; Ed . y = DW . y ; DO ( DY , Eh . rg , Ed . xyzy , Ef ) ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["SMAA_DISABLE_DIAG_DETECTION",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:"} else Ee . r = 0.0 ;".split(" ")}]}}]},{type:"textline",tokens:"} if ( Ee . r > 0.0 ) { ; Ed . y = Ds ( DY , D_ , Bv . xy , Bw . z ) ; Ed . x = Bu . x ; Ee . x = Ed . y ; Ec = texture2D ( DY , Ed . xy , 0.0 ) . g ; Ed . z = DA ( DY , D_ , Bv . zw , Bw . w ) ; Ee . y = Ed . z ; Ee = abs ( BR ( Ee / u_texel_size . yy - DX . yy ) ) ; Ef = sqrt ( Ee ) ; Eb = texture2D ( DY , Ed . xz + u_texel_size * vec2 ( 0 , 1 ) , 0.0 ) . g ; Eh . ba = DH ( DZ , Ef , Ec , Eb , Ea . x ) ; Ed . x = DW . x ; DV ( DY , Eh . ba , Ed . xyxz , Ee ) ; } return Eh ; }".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"vec4 Eu ( vec2 Ej , sampler2D Ek , sampler2D El".split(" ")},{type:"condition",parts:[{type:"if",expression:["SMAA_REPROJECTION"],group:{type:"group",parts:[{type:"textline",tokens:[",","sampler2D","Em"]}]}}]},{type:"textline",tokens:") { bool En ; vec2 Eo , Ep , Eq ; vec4 Er , Es , Et ; Er . x = texture2D ( El , Bt . xy ) . a ; Er . y = texture2D ( El , Bt . zw ) . g ; Er . wz = texture2D ( El , Ej ) . xz ; if ( dot ( Er , vec4 ( 1.0 , 1.0 , 1.0 , 1.0 ) ) < 1e-5 ) { Es = texture2D ( Ek , Ej , 0.0 ) ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["SMAA_REPROJECTION"],group:{type:"group",parts:[{type:"textline",tokens:"Et = texture2D ( Em , bM ) ; Eo = 2.0 * ag ( Et ) - 1.0 ; Es . a = sqrt ( 2.0 * length ( Eo ) ) ;".split(" ")}]}}]},{type:"textline",tokens:"return Es ; } else { En = max ( Er . x , Er . z ) > max ( Er . y , Er . w ) ; Es = vec4 ( 0.0 , Er . y , 0.0 , Er . w ) ; Eo = Er . yw ; BM ( bvec4 ( En , En , En , En ) , Es , vec4 ( Er . x , 0.0 , Er . z , 0.0 ) ) ; BM ( bvec2 ( En , En ) , Eo , Er . xz ) ; Eo /= dot ( Eo , vec2 ( 1.0 , 1.0 ) ) ; Es = Es * vec4 ( u_texel_size , - u_texel_size ) + Ej . xyxy ; Er = Eo . x * texture2D ( Ek , Es . xy , 0.0 ) ; Er += Eo . y * texture2D ( Ek , Es . zw , 0.0 ) ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["SMAA_REPROJECTION"],group:{type:"group",parts:[{type:"textline",tokens:"Et = texture2D ( Em , Es . xy ) ; Ep = 2.0 * ag ( Et ) - 1.0 ; Eq = Eo . x * Ep ; Et = texture2D ( Em , Es . zw ) ; Ep = 2.0 * ag ( Et ) - 1.0 ; Eq += Eo . y * Ep ; Er . a = sqrt ( 2.0 * length ( Eq ) ) ;".split(" ")}]}}]},{type:"textline",tokens:["return","Er",";","}","}"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SMAA_PASS","SMAA_RESOLVE",{type:"equal_expr",places:2}],
group:{type:"group",parts:[{type:"textline",tokens:"vec4 EE ( vec2 Ev , sampler2D Ew , sampler2D Ex".split(" ")},{type:"condition",parts:[{type:"if",expression:["SMAA_REPROJECTION"],group:{type:"group",parts:[{type:"textline",tokens:[",","sampler2D","Ey"]}]}}]},{type:"textline",tokens:") { float Ez ; vec2 EA ; vec4 EB , EC , ED ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SMAA_REPROJECTION"],group:{type:"group",parts:[{type:"textline",tokens:"EB = texture2D ( Ey , bM ) ; EA = 2.0 * ag ( EB ) - 1.0 ; EB = texture2D ( Ew , Ev ) ; EC = texture2D ( Ex , Ev - EA ) ; Ez = abs ( EB . a * EB . a - EC . a * EC . a ) / 2.0 ; Ez = 0.5 * clamp ( 1.0 - sqrt ( Ez ) * SMAA_REPROJECTION_WEIGHT_SCALE , 0.0 , 1.0 ) ; ED = mix ( EB , EC , Ez ) ; ED . a = 1.0 ; return ED ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"EB = texture2D ( Ew , Ev ) ; EC = texture2D ( Ex , Ev ) ; return mix ( EB , EC , 0.5 ) ;".split(" ")}]}}]},{type:"textline",tokens:["}"]}]}}]},{type:"textline",tokens:"void main ( ) { vec4 EF ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SMAA_PASS","SMAA_EDGE_DETECTION",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"EF = vec4 ( Ce ( bM , u_color".split(" ")},{type:"condition",parts:[{type:"if",
expression:["SMAA_PREDICATION"],group:{type:"group",parts:[{type:"textline",tokens:[",","u_predication_tex"]}]}}]},{type:"textline",tokens:") , 0.0 , 0.0 ) ;".split(" ")}]}},{type:"elif",expression:["SMAA_PASS","SMAA_BLENDING_WEIGHT_CALCULATION",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"EF = Ei ( bM , Bx , u_color , u_area_tex , u_search_tex , u_subsample_indices ) ;".split(" ")}]}},{type:"elif",expression:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{type:"equal_expr",
places:2}],group:{type:"group",parts:[{type:"textline",tokens:"EF = Eu ( bM , u_color , u_blend".split(" ")},{type:"condition",parts:[{type:"if",expression:["SMAA_REPROJECTION"],group:{type:"group",parts:[{type:"textline",tokens:[",","u_velocity_tex"]}]}}]},{type:"textline",tokens:[")",";"]}]}},{type:"elif",expression:["SMAA_PASS","SMAA_RESOLVE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"EF = vec4 ( EE ( bM , u_color , u_color_prev".split(" ")},{type:"condition",
parts:[{type:"if",expression:["SMAA_REPROJECTION"],group:{type:"group",parts:[{type:"textline",tokens:[",","u_velocity_tex"]}]}}]},{type:"textline",tokens:[")",")",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"EF = texture2D ( u_color , bM ) ;".split(" ")}]}}]},{type:"textline",tokens:["gl_FragColor","=","EF",";","}"]}]};a["postprocessing/smaa.glslv"]={type:"group",parts:[{type:"define",name:"SMAA_EDGE_DETECTION",tokens:["1"]},{type:"define",name:"SMAA_BLENDING_WEIGHT_CALCULATION",
tokens:["2"]},{type:"define",name:"SMAA_NEIGHBORHOOD_BLENDING",tokens:["3"]},{type:"define",name:"AA_METHOD_SMAA_LOW",tokens:["1"]},{type:"define",name:"AA_METHOD_SMAA_MEDIUM",tokens:["2"]},{type:"define",name:"AA_METHOD_SMAA_HIGH",tokens:["3"]},{type:"define",name:"AA_METHOD_SMAA_ULTRA",tokens:["4"]},{type:"textline",tokens:"attribute vec2 a_position ; uniform vec2 u_texel_size ; varying vec2 bM ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",
{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","Bt",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"varying vec4 Bu ; varying vec4 Bv ; varying vec4 Bw ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["SMAA_PASS","SMAA_BLENDING_WEIGHT_CALCULATION",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec2","Bx",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["AA_METHOD",
"AA_METHOD_SMAA_LOW",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",tokens:["4"]}]}},{type:"elif",expression:["AA_METHOD","AA_METHOD_SMAA_MEDIUM",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",tokens:["8"]}]}},{type:"elif",expression:["AA_METHOD","AA_METHOD_SMAA_HIGH",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",tokens:["16"]}]}},{type:"elif",
expression:["AA_METHOD","AA_METHOD_SMAA_ULTRA",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",tokens:["32"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"SMAA_MAX_SEARCH_STEPS",group:{type:"group",parts:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",tokens:["16"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SMAA_PASS","SMAA_EDGE_DETECTION",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"void Ac ( vec2 zY ) { Bu = u_texel_size . xyxy * vec4 ( - 1.0 , 0.0 , 0.0 , - 1.0 ) + zY . xyxy ; Bv = u_texel_size . xyxy * vec4 ( 1.0 , 0.0 , 0.0 , 1.0 ) + zY . xyxy ; Bw = u_texel_size . xyxy * vec4 ( - 2.0 , 0.0 , 0.0 , - 2.0 ) + zY . xyxy ; }".split(" ")}]}},
{type:"elif",expression:["SMAA_PASS","SMAA_BLENDING_WEIGHT_CALCULATION",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"void Af ( vec2 Ad , out vec2 Ae ) { Ae = Ad / u_texel_size ; Bu = u_texel_size . xyxy * vec4 ( - 0.25 , - 0.125 , 1.25 , - 0.125 ) + Ad . xyxy ; Bv = u_texel_size . xyxy * vec4 ( - 0.125 , - 0.25 , - 0.125 , 1.25 ) + Ad . xyxy ; Bw = u_texel_size . xxyy * vec4 ( - 2.0 , 2.0 , - 2.0 , 2.0 ) * float ( SMAA_MAX_SEARCH_STEPS ) + vec4 ( Bu . xz , Bv . yw ) ; }".split(" ")}]}},
{type:"elif",expression:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"void Ah ( vec2 Ag ) { Bt = u_texel_size . xyxy * vec4 ( 1.0 , 0.0 , 0.0 , 1.0 ) + Ag . xyxy ; }".split(" ")}]}}]},{type:"textline",tokens:"void main ( ) { bM = 2.0 * a_position ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SMAA_PASS","SMAA_EDGE_DETECTION",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["Ac",
"(","bM",")",";"]}]}},{type:"elif",expression:["SMAA_PASS","SMAA_BLENDING_WEIGHT_CALCULATION",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"Af ( bM , Bx ) ;".split(" ")}]}},{type:"elif",expression:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["Ah","(","bM",")",";"]}]}}]},{type:"textline",tokens:"gl_Position = vec4 ( 4.0 * ( a_position . xy - 0.25 ) , 0.0 , 1.0 ) ; }".split(" ")}]};a["postprocessing/ssao.glslf"]=
{type:"group",parts:[{type:"var",name:"PRECISION",tokens:["lowp"]},{type:"textline",tokens:["precision","PRECISION","sampler2D",";"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"include",file:"procedural.glslf"},{type:"define",name:"SSAO_QUALITY_8",tokens:["1"]},{type:"define",name:"SSAO_QUALITY_16",tokens:["2"]},{type:"define",name:"SSAO_QUALITY_24",tokens:["3"]},{type:"define",name:"SSAO_QUALITY_32",tokens:["4"]},{type:"textline",tokens:"uniform sampler2D u_color ; uniform sampler2D u_depth ; uniform sampler2D u_ssao_special_tex ; uniform vec2 u_camera_range ; uniform vec2 u_texel_size ; varying vec2 bM ; uniform float u_ssao_radius_increase ; uniform float u_ssao_influence ; uniform float u_ssao_dist_factor ; float Ac ( in vec2 zY ) { return Bo ( u_depth , zY , u_camera_range ) ; } void main ( ) { float Ad , Ae , Af , Ag , Ah , Ai ; vec3 Aj , Ak , Al , Am ; Aj = texture2D ( u_color , bM ) . rgb ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["SSAO_WHITE"],group:{type:"group",parts:[{type:"textline",tokens:"gl_FragColor = vec4 ( Aj , 1.0 ) ; return ;".split(" ")}]}}]},{type:"textline",tokens:"Ak = normalize ( 2.0 * texture2D ( u_ssao_special_tex , bM * 0.25 / u_texel_size ) . rgb - 1.0 ) ; Ad = Ac ( bM ) ; Ae = Ad * ( u_camera_range . y - u_camera_range . x ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SSAO_QUALITY","SSAO_QUALITY_8",{type:"equal_expr",places:2}],group:{type:"group",
parts:[{type:"textline",tokens:"const float An = 8.0 ; const int Ao = 1 ;".split(" ")}]}},{type:"elif",expression:["SSAO_QUALITY","SSAO_QUALITY_16",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"const float An = 16.0 ; const int Ao = 2 ;".split(" ")}]}},{type:"elif",expression:["SSAO_QUALITY","SSAO_QUALITY_24",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"const float An = 24.0 ; const int Ao = 3 ;".split(" ")}]}},{type:"elif",
expression:["SSAO_QUALITY","SSAO_QUALITY_32",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"const float An = 32.0 ; const int Ao = 4 ;".split(" ")}]}}]},{type:"textline",tokens:"Af = u_ssao_radius_increase * 0.001 ; const float Ap = 1.0 + 2.4 / An ; Ag = 0.0 ; for ( int Aq = 0 ; Aq < Ao ; Aq ++ ) for ( int Ar = - 1 ; Ar <= 1 ; Ar += 2 ) for ( int By = - 1 ; By <= 1 ; By += 2 ) for ( int Bz = - 1 ; Bz <= 1 ; Bz += 2 ) { Al = reflect ( normalize ( vec3 ( Ar , By , Bz ) ) , Ak ) * ( Af *= Ap ) ; Am = vec3 ( bM , Ae ) ; Am += vec3 ( Al . xy , Al . z * Ae * 2.0 ) ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["SSAO_HEMISPHERE"],group:{type:"group",parts:[{type:"textline",tokens:"Am . z -= 1.4 * ( Am . z - Ae ) * step ( Ae , Am . z ) ;".split(" ")}]}}]},{type:"textline",tokens:"Ah = Ac ( Am . xy ) * ( u_camera_range . y - u_camera_range . x ) ; Ai = clamp ( ( Ae - Ah ) / Ah , 0.0 , 1.0 ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SSAO_HEMISPHERE"],group:{type:"group",parts:[{type:"textline",tokens:"Ag += mix ( 1.0 , Ai , step ( Ah , Am . z ) ) ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"Ag += mix ( step ( Am . z , Ah ) , 0.5 , Ai ) ;".split(" ")}]}}]},{type:"textline",tokens:"} Ag = Ag / An ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SSAO_HEMISPHERE"],group:{type:"group",parts:[{type:"textline",tokens:"Ag = clamp ( Ag * Ag + 0.6 * Ag , 0.0 , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"Ag = clamp ( Ag * Ag + Ag , 0.0 , 1.0 ) ;".split(" ")}]}}]},{type:"textline",
tokens:"Ad = u_ssao_influence * ( 1.0 - u_ssao_dist_factor * Ad ) ; Ag = mix ( 1.0 , Ag , Ad ) ; gl_FragColor = vec4 ( Aj , Ag ) ; }".split(" ")}]};a["postprocessing/ssao_blur.glslf"]={type:"group",parts:[{type:"var",name:"PRECISION",tokens:["lowp"]},{type:"textline",tokens:["precision","PRECISION","sampler2D",";"]},{type:"include",file:"precision_statement.glslf"},{type:"condition",parts:[{type:"if",expression:["SSAO_BLUR_DEPTH"],group:{type:"group",parts:[{type:"include",file:"depth_fetch.glslf"}]}}]},
{type:"textline",tokens:"uniform sampler2D u_ssao_mask ; uniform vec2 u_texel_size ; varying vec2 bM ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SSAO_BLUR_DEPTH"],group:{type:"group",parts:[{type:"textline",tokens:"uniform sampler2D u_depth ; uniform vec2 u_camera_range ; uniform float u_ssao_blur_discard_value ; float Ac ( in vec2 zY ) { return Bo ( u_depth , zY , u_camera_range ) ; }".split(" ")}]}}]},{type:"textline",tokens:"void main ( ) { vec2 Ad , Ae ; float Af , Ag , Ah , Ai , Aj , Ak , Al ; Af = 0.0 ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["SSAO_BLUR_DEPTH"],group:{type:"group",parts:[{type:"textline",tokens:"Ag = Ac ( bM ) ; Ah = 0.0 ; Ai = u_ssao_blur_discard_value * 100.0 ;".split(" ")}]}}]},{type:"textline",tokens:"Ad = vec2 ( - 2.0 ) ; for ( int Am = 0 ; Am < 4 ; ++ Am ) { for ( int An = 0 ; An < 4 ; ++ An ) { Ae = ( Ad + vec2 ( float ( Am ) , float ( An ) ) ) * u_texel_size ; Aj = texture2D ( u_ssao_mask , bM + Ae ) . a ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SSAO_BLUR_DEPTH"],
group:{type:"group",parts:[{type:"textline",tokens:"Ak = Ac ( bM + Ae ) ; Al = 1.0 - clamp ( abs ( Ak - Ag ) * Ai , 0.0 , 1.0 ) ; Af += Aj * Al ; Ah += Al ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["Af","+=","Aj",";"]}]}}]},{type:"textline",tokens:["}","}"]},{type:"condition",parts:[{type:"if",expression:["SSAO_BLUR_DEPTH"],group:{type:"group",parts:[{type:"textline",tokens:"gl_FragColor = vec4 ( texture2D ( u_ssao_mask , bM ) . rgb , Af / Ah ) ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"gl_FragColor = vec4 ( texture2D ( u_ssao_mask , bM ) . rgb , Af / 16.0 ) ;".split(" ")}]}}]},{type:"textline",tokens:["}"]}]};a["postprocessing/stereo.glslf"]={type:"group",parts:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"color_util.glslf"},{type:"textline",tokens:"uniform sampler2D u_sampler_left ; uniform sampler2D u_sampler_right ; varying vec2 bM ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["ANAGLYPH",
{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","int","u_enable_hmd_stereo",";"]},{type:"condition",parts:[{type:"if",expression:["DISABLE_DISTORTION_CORRECTION",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec4 u_distortion_params ; uniform vec4 u_chromatic_aberration_coefs ; void Ak ( vec2 zY , vec2 Ac , sampler2D Ad ) { vec4 Ae ; float Af ; vec2 Ag , Ah , Ai , Aj ; Ag = ( zY - Ac ) * 2.0 ; Af = Ag . x * Ag . x + Ag . y * Ag . y ; Ag = Ag * ( 1.0 + u_distortion_params [ 0 ] * Af + u_distortion_params [ 1 ] * Af * Af ) ; Ag = Ag * 0.5 * u_distortion_params [ 2 ] ; if ( length ( u_chromatic_aberration_coefs ) > 0.0 ) { Ah = Ag * ( 1.0 + u_chromatic_aberration_coefs [ 0 ] + Af * u_chromatic_aberration_coefs [ 1 ] ) + Ac ; Ai = Ag + Ac ; Aj = Ag * ( 1.0 + u_chromatic_aberration_coefs [ 2 ] + Af * u_chromatic_aberration_coefs [ 3 ] ) + Ac ; if ( clamp ( Aj , 0.0 , 1.0 ) != Aj ) { gl_FragColor = vec4 ( 0.0 ) ; } else { Ae = texture2D ( Ad , Ai ) ; gl_FragColor [ 0 ] = texture2D ( Ad , Ah ) . x ; gl_FragColor [ 1 ] = Ae . y ; gl_FragColor [ 2 ] = texture2D ( Ad , Aj ) . z ; gl_FragColor [ 3 ] = Ae . w ; } } else { Ag += Ac ; if ( clamp ( Ag , 0.0 , 1.0 ) != Ag ) { gl_FragColor = vec4 ( 0.0 ) ; } else { gl_FragColor = texture2D ( Ad , Ag ) ; } } }".split(" ")}]}}]}]}}]},
{type:"textline",tokens:"void main ( ) { vec2 Al , Am ; mat3 An , Ao ; vec3 Ap , Aq ; vec4 Ar , By ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["ANAGLYPH"],group:{type:"group",parts:[{type:"textline",tokens:"Ar = texture2D ( u_sampler_left , bM ) ; By = texture2D ( u_sampler_right , bM ) ; Ap = vec3 ( Ar [ 0 ] , Ar [ 1 ] , Ar [ 2 ] ) ; br ( Ap ) ; Aq = vec3 ( By [ 0 ] , By [ 1 ] , By [ 2 ] ) ; br ( Aq ) ; An = mat3 ( 0.437 , - 0.062 , - 0.048 , 0.449 , - 0.062 , - 0.050 , 0.164 , - 0.024 , - 0.017 ) ; Ao = mat3 ( - 0.011 , 0.377 , - 0.026 , - 0.032 , 0.761 , - 0.093 , - 0.007 , 0.009 , 1.234 ) ; Aq = clamp ( An * Ap , 0.0 , 1.0 ) + clamp ( Ao * Aq , 0.0 , 1.0 ) ; bu ( Aq ) ; gl_FragColor = vec4 ( Aq , Ar [ 3 ] + By [ 3 ] ) ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"if ( u_enable_hmd_stereo != 0 ) { if ( bM [ 0 ] < 0.5 ) { Al = vec2 ( 2.0 * bM [ 0 ] , bM [ 1 ] ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["DISABLE_DISTORTION_CORRECTION"],group:{type:"group",parts:[{type:"textline",tokens:"gl_FragColor = texture2D ( u_sampler_left , Al ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"Am = vec2 ( 0.5 + u_distortion_params [ 3 ] * 0.5 , 0.5 ) ; Ak ( Al , Am , u_sampler_left ) ;".split(" ")}]}}]},
{type:"textline",tokens:"} else { Am = vec2 ( 2.0 * ( bM [ 0 ] - 0.5 ) , bM [ 1 ] ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["DISABLE_DISTORTION_CORRECTION"],group:{type:"group",parts:[{type:"textline",tokens:"gl_FragColor = texture2D ( u_sampler_right , Am ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"Al = vec2 ( 0.5 - u_distortion_params [ 3 ] * 0.5 , 0.5 ) ; Ak ( Am , Al , u_sampler_right ) ;".split(" ")}]}}]},{type:"textline",tokens:"} } else { gl_FragColor = texture2D ( u_sampler_left , bM ) ; }".split(" ")}]}}]},
{type:"textline",tokens:["}"]}]};a["postprocessing/velocity.glslf"]={type:"group",parts:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"textline",tokens:"uniform sampler2D u_depth ; uniform mat4 u_view_proj_inverse ; uniform mat4 u_view_proj_prev ; varying vec2 bM ; void main ( ) { vec2 zY ; vec4 Ac , Ad ; float Ae ; Ae = texture2D ( u_depth , bM ) . x ; Ac = vec4 ( bM * 2.0 - 1.0 , 2.0 * Ae - 1.0 , 1.0 ) ; Ad = u_view_proj_inverse * Ac ; Ad = Ad / Ad . w ; Ad = u_view_proj_prev * Ad ; Ad /= Ad . w ; zY = ( Ac . xy - Ad . xy ) / 4.0 + 0.5 ; zY = clamp ( zY , 0.0 , 1.0 ) ; gl_FragColor = V ( zY ) ; }".split(" ")}]};
a["include/precision_statement.glslf"]={type:"group",parts:[{type:"var",name:"PRECISION",tokens:["lowp"]},{type:"textline",tokens:["precision","PRECISION","float",";"]}]};a["include/math.glslv"]={type:"group",parts:[{type:"var",name:"EPSILON",tokens:["0.0001"]},{type:"textline",tokens:"float a = 0.0 ; float b = 1.0 ; struct c { vec3 a ; vec3 b ; vec3 c ; vec3 d ; vec3 e ; vec3 f ; } ; bool f ( vec3 d , vec3 e ) { return any ( lessThan ( abs ( d - e ) , vec3 ( EPSILON ) ) ) ; } vec3 i ( in vec4 g , in vec3 h ) { return h + 2.0 * cross ( g . xyz , cross ( g . xyz , h ) + g . w * h ) ; } vec4 k ( in vec4 j ) { return vec4 ( - j . xyz , j . w ) / dot ( j , j ) ; } vec3 p ( vec4 l , vec4 m , vec4 n ) { vec3 o ; o = n . xyz * l . w ; o = i ( m , o ) ; o += l . xyz * n . w ; return o ; } vec3 v ( vec4 q , vec4 r , vec4 s ) { vec4 t ; vec3 u ; u = s . xyz - q . xyz * s . w ; t = k ( r ) ; u = i ( t , u ) ; u /= q . w ; return u ; } mat4 w ( ) { return mat4 ( b , a , a , a , a , b , a , a , a , a , b , a , a , a , a , b ) ; } mat4 y ( float x ) { return mat4 ( b , a , a , a , a , cos ( x ) , sin ( x ) , a , a , - sin ( x ) , cos ( x ) , a , a , a , a , b ) ; } mat4 A ( float z ) { return mat4 ( cos ( z ) , a , - sin ( z ) , a , a , b , a , a , sin ( z ) , a , cos ( z ) , a , a , a , a , b ) ; } mat4 C ( float B ) { return mat4 ( cos ( B ) , sin ( B ) , a , a , - sin ( B ) , cos ( B ) , a , a , a , a , b , a , a , a , a , b ) ; } c E ( in c D ) { return c ( D . a , D . b , normalize ( D . c ) , normalize ( D . d ) , normalize ( D . e ) , D . f ) ; }".split(" ")},
{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},"SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",places:2},"REFRACTIVE","USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",places:4}],group:{type:"group",parts:[{type:"textline",tokens:"vec3 L ( vec4 F ) { vec3 G ; float H , I , J ; H = F . x ; I = F . y ; J = F . w ; G . x = ( H + J ) / 2.0 ; G . y = ( I + J ) / 2.0 ; G . z = J ; return G ; }".split(" ")}]}}]},{type:"textline",tokens:"mat4 O ( mat3 M ) { mat4 N ; N [ 0 ] [ 0 ] = ( b - ( M [ 1 ] [ 2 ] * ( M [ 1 ] [ 2 ] + M [ 1 ] [ 2 ] ) + M [ 2 ] [ 0 ] * ( M [ 2 ] [ 0 ] + M [ 2 ] [ 0 ] ) ) ) * M [ 1 ] [ 0 ] ; N [ 0 ] [ 1 ] = ( M [ 1 ] [ 1 ] * ( M [ 1 ] [ 2 ] + M [ 1 ] [ 2 ] ) + M [ 2 ] [ 1 ] * ( M [ 2 ] [ 0 ] + M [ 2 ] [ 0 ] ) ) * M [ 1 ] [ 0 ] ; N [ 0 ] [ 2 ] = ( M [ 1 ] [ 1 ] * ( M [ 2 ] [ 0 ] + M [ 2 ] [ 0 ] ) - M [ 2 ] [ 1 ] * ( M [ 1 ] [ 2 ] + M [ 1 ] [ 2 ] ) ) * M [ 1 ] [ 0 ] ; N [ 0 ] [ 3 ] = a ; N [ 1 ] [ 0 ] = ( M [ 1 ] [ 1 ] * ( M [ 1 ] [ 2 ] + M [ 1 ] [ 2 ] ) - M [ 2 ] [ 1 ] * ( M [ 2 ] [ 0 ] + M [ 2 ] [ 0 ] ) ) * M [ 1 ] [ 0 ] ; N [ 1 ] [ 1 ] = ( b - ( M [ 1 ] [ 1 ] * ( M [ 1 ] [ 1 ] + M [ 1 ] [ 1 ] ) + M [ 2 ] [ 0 ] * ( M [ 2 ] [ 0 ] + M [ 2 ] [ 0 ] ) ) ) * M [ 1 ] [ 0 ] ; N [ 1 ] [ 2 ] = ( M [ 1 ] [ 2 ] * ( M [ 2 ] [ 0 ] + M [ 2 ] [ 0 ] ) + M [ 2 ] [ 1 ] * ( M [ 1 ] [ 1 ] + M [ 1 ] [ 1 ] ) ) * M [ 1 ] [ 0 ] ; N [ 1 ] [ 3 ] = a ; N [ 2 ] [ 0 ] = ( M [ 1 ] [ 1 ] * ( M [ 2 ] [ 0 ] + M [ 2 ] [ 0 ] ) + M [ 2 ] [ 1 ] * ( M [ 1 ] [ 2 ] + M [ 1 ] [ 2 ] ) ) * M [ 1 ] [ 0 ] ; N [ 2 ] [ 1 ] = ( M [ 1 ] [ 2 ] * ( M [ 2 ] [ 0 ] + M [ 2 ] [ 0 ] ) - M [ 2 ] [ 1 ] * ( M [ 1 ] [ 1 ] + M [ 1 ] [ 1 ] ) ) * M [ 1 ] [ 0 ] ; N [ 2 ] [ 2 ] = ( b - ( M [ 1 ] [ 1 ] * ( M [ 1 ] [ 1 ] + M [ 1 ] [ 1 ] ) + M [ 1 ] [ 2 ] * ( M [ 1 ] [ 2 ] + M [ 1 ] [ 2 ] ) ) ) * M [ 1 ] [ 0 ] ; N [ 2 ] [ 3 ] = a ; N [ 3 ] [ 0 ] = M [ 0 ] [ 0 ] ; N [ 3 ] [ 1 ] = M [ 0 ] [ 1 ] ; N [ 3 ] [ 2 ] = M [ 0 ] [ 2 ] ; N [ 3 ] [ 3 ] = 1.0 ; return N ; }".split(" ")}]};
a["include/std_enums.glsl"]={type:"group",parts:[{type:"define",name:"TEXTURE_COORDS_UV_ORCO",tokens:["1"]},{type:"define",name:"TEXTURE_COORDS_NORMAL",tokens:["2"]},{type:"define",name:"TEXTURE_BLEND_TYPE_MIX",tokens:["1"]},{type:"define",name:"TEXTURE_BLEND_TYPE_MULTIPLY",tokens:["2"]},{type:"define",name:"SHADOW_SRC_NONE",tokens:["1"]},{type:"define",name:"SHADOW_SRC_DEPTH",tokens:["2"]},{type:"define",name:"SHADOW_SRC_MASK",tokens:["3"]},{type:"define",name:"SHADOW_DST_NONE",tokens:["1"]},{type:"define",
name:"SHADOW_DST_DEPTH",tokens:["2"]},{type:"define",name:"SHADOW_DST_MASK",tokens:["3"]},{type:"define",name:"NO_SHADOWS",tokens:["1"]},{type:"define",name:"SHADOW_CASTING",tokens:["2"]},{type:"define",name:"SHADOW_MASK_GENERATION",tokens:["3"]},{type:"define",name:"SHADOW_MAPPING_OPAQUE",tokens:["4"]},{type:"define",name:"SHADOW_MAPPING_BLEND",tokens:["5"]},{type:"define",name:"SPECULAR_PHONG",tokens:["1"]},{type:"define",name:"SPECULAR_COOKTORR",tokens:["2"]},{type:"define",name:"SPECULAR_WARDISO",
tokens:["3"]},{type:"define",name:"SPECULAR_BLINN",tokens:["4"]},{type:"define",name:"SPECULAR_TOON",tokens:["5"]},{type:"define",name:"DIFFUSE_LAMBERT",tokens:["1"]},{type:"define",name:"DIFFUSE_OREN_NAYAR",tokens:["2"]},{type:"define",name:"DIFFUSE_FRESNEL",tokens:["3"]},{type:"define",name:"DIFFUSE_MINNAERT",tokens:["4"]},{type:"define",name:"DIFFUSE_TOON",tokens:["5"]},{type:"define",name:"MAPPING_TYPE_TEXTURE",tokens:["0.0"]},{type:"define",name:"MAPPING_TYPE_POINT",tokens:["1.0"]},{type:"define",
name:"MAPPING_TYPE_VECTOR",tokens:["2.0"]},{type:"define",name:"MAPPING_TYPE_NORMAL",tokens:["3.0"]},{type:"define",name:"MIX",tokens:["0"]},{type:"define",name:"ADD",tokens:["1"]},{type:"define",name:"SUBTRACT",tokens:["2"]},{type:"define",name:"MULTIPLY",tokens:["3"]},{type:"define",name:"SCREEN",tokens:["4"]},{type:"define",name:"OVERLAY",tokens:["5"]},{type:"define",name:"DIFFERENCE",tokens:["6"]},{type:"define",name:"DIVIDE",tokens:["7"]},{type:"define",name:"DARKEN",tokens:["8"]},{type:"define",
name:"LIGHTEN",tokens:["9"]},{type:"define",name:"HUE",tokens:["10"]},{type:"define",name:"SATURATION",tokens:["11"]},{type:"define",name:"VALUE",tokens:["12"]},{type:"define",name:"COLOR",tokens:["13"]},{type:"define",name:"SOFT_LIGHT",tokens:["14"]},{type:"define",name:"LINEAR_LIGHT",tokens:["15"]},{type:"define",name:"REFL_NONE",tokens:["0"]},{type:"define",name:"REFL_MIRRORMAP",tokens:["1"]},{type:"define",name:"REFL_PLANE",tokens:["2"]},{type:"define",name:"REFL_CUBE",tokens:["3"]},{type:"define",
name:"INVERSE_QUADRATIC",tokens:["0"]},{type:"define",name:"LINEAR",tokens:["1"]},{type:"define",name:"QUADRATIC",tokens:["2"]},{type:"define",name:"HEMI",tokens:["1"]},{type:"define",name:"SPOT",tokens:["2"]},{type:"define",name:"POINT",tokens:["3"]},{type:"define",name:"SUN",tokens:["4"]}]};a["include/pack.glslf"]={type:"group",parts:[{type:"textline",tokens:"float P = 255.0 ; float Q = 0.0 ; float R = 1.0 ; vec4 V ( const in float S ) { vec4 T , U ; T = vec4 ( P * P * P , P * P , P , R ) ; U = vec4 ( Q , R / P , R / P , R / P ) ; T = fract ( S * T ) ; T -= T . xxyz * U ; return T ; } float Z ( const in vec4 W ) { vec4 X ; float Y ; X = vec4 ( R / ( P * P * P ) , R / ( P * P ) , R / P , R ) ; Y = dot ( W , X ) ; return Y ; } vec4 V ( const in vec2 _ ) { vec4 aa ; vec2 ab , ac ; ab = vec2 ( P , R ) ; ac = vec2 ( Q , R / P ) ; aa = fract ( _ . xxyy * ab . xyxy ) ; aa -= aa . xxzz * ac . xyxy ; if ( _ . r == R ) aa . rg = vec2 ( Q , R ) ; if ( _ . g == R ) aa . ba = vec2 ( Q , R ) ; return aa ; } vec2 ag ( const in vec4 ad ) { vec2 ae , af ; af = vec2 ( R / P , R ) ; ae . r = dot ( ad . rg , af ) ; ae . g = dot ( ad . ba , af ) ; return ae ; }".split(" ")}]};
a["include/procedural.glslf"]={type:"group",parts:[{type:"textline",tokens:"float ah = 0.0 ; float ai = 1.0 ; vec4 ak ( vec4 aj ) { return aj - floor ( aj * ( ai / 289.0 ) ) * 289.0 ; } vec3 ak ( vec3 al ) { return al - floor ( al * ( ai / 289.0 ) ) * 289.0 ; } vec2 ak ( vec2 am ) { return am - floor ( am * ( ai / 289.0 ) ) * 289.0 ; } vec4 ao ( vec4 an ) { return an - floor ( an * ( ai / 7.0 ) ) * 7.0 ; } vec4 aq ( vec4 ap ) { return ak ( ( 34.0 * ap + 5.0 ) * ap ) ; }".split(" ")},{type:"define",
name:"K",tokens:["0.142857142857"]},{type:"define",name:"K2",tokens:["0.0714285714285"]},{type:"define",name:"JITTER",tokens:["0.7"]},{type:"textline",tokens:"vec2 ay ( vec2 ar ) { vec4 as , at , au , av ; vec2 aw , ax ; aw = ak ( floor ( ar ) ) ; ax = fract ( ar ) ; as = ax . x + vec4 ( - 0.5 , - 1.5 , - 0.5 , - 1.5 ) ; at = ax . y + vec4 ( - 0.5 , - 0.5 , - 1.5 , - 1.5 ) ; au = aq ( aw . x + vec4 ( ah , ai , ah , ai ) ) ; au = aq ( au + aw . y + vec4 ( ah , ah , ai , ai ) ) ; av = ao ( au ) * K + K2 ; au = ao ( floor ( au * K ) ) * K + K2 ; av = as + JITTER * av ; au = at + JITTER * au ; au = av * av + au * au ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:[1],group:{type:"group",parts:[{type:"textline",tokens:"au . xy = min ( au . xy , au . zw ) ; au . x = min ( au . x , au . y ) ; return au . xx ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"au . xy = ( au . x < au . y ) ? au . xy : au . yx ; au . xz = ( au . x < au . z ) ? au . xz : au . zx ; au . xw = ( au . x < au . w ) ? au . xw : au . wx ; au . y = min ( au . y , au . z ) ; au . y = min ( au . y , au . w ) ; return sqrt ( au . xy ) ;".split(" ")}]}}]},
{type:"textline",tokens:"} vec3 aH ( vec2 az , float aA ) { vec4 aB , aC , aD , aE ; vec2 aF , aG ; aF = ak ( floor ( az ) ) ; aG = fract ( az ) ; aB = aG . x + vec4 ( - 0.5 , - 1.5 , - 0.5 , - 1.5 ) ; aC = aG . y + vec4 ( - 0.5 , - 0.5 , - 1.5 , - 1.5 ) ; aD = aq ( aF . x + vec4 ( ah , ai , ah , ai ) ) ; aD = aq ( aD + aF . y + vec4 ( ah , ah , ai , ai ) ) ; aE = ao ( aD ) * K + K2 ; aD = ao ( floor ( aD * K ) ) * K + K2 ; aE = aB + JITTER * aE ; aD = aC + JITTER * aD ; aC = aE * aE + aD * aD ; aE += aA ; aD += aA ; aB = aE * aE + aD * aD ; aE += aA ; aD += aA ; aD = aE * aE + aD * aD ; aC . xy = min ( aC . xy , aC . zw ) ; aC . x = min ( aC . x , aC . y ) ; aB . xy = min ( aB . xy , aB . zw ) ; aB . x = min ( aB . x , aB . y ) ; aD . xy = min ( aD . xy , aD . zw ) ; aD . x = min ( aD . x , aD . y ) ; return vec3 ( aC . x , aB . x , aD . x ) ; } vec3 aJ ( vec3 aI ) { return ak ( ( ( aI * 34.0 ) + ai ) * aI ) ; } float aU ( vec2 aK ) { vec3 aL , aM , aN , aO ; vec4 aP ; vec2 aQ , aR , aS ; const vec4 aT = vec4 ( 0.211324865405187 , 0.366025403784439 , - 0.577350269189626 , 0.024390243902439 ) ; aQ = floor ( aK + dot ( aK , aT . yy ) ) ; aR = aK - aQ + dot ( aQ , aT . xx ) ; aS = ( aR . x > aR . y ) ? vec2 ( ai , ah ) : vec2 ( ah , ai ) ; aP = aR . xyxy + aT . xxzz ; aP . xy -= aS ; aQ = ak ( aQ ) ; aL = aJ ( aJ ( aQ . y + vec3 ( ah , aS . y , ai ) ) + aQ . x + vec3 ( ah , aS . x , ai ) ) ; aM = max ( 0.5 - vec3 ( dot ( aR , aR ) , dot ( aP . xy , aP . xy ) , dot ( aP . zw , aP . zw ) ) , ah ) ; aM = aM * aM ; aM = aM * aM ; aL = 2.0 * fract ( aL * aT . www ) - ai ; aN = abs ( aL ) - 0.5 ; aO = floor ( aL + 0.5 ) ; aO = aL - aO ; aM *= 1.79284291400159 - 0.85373472095314 * ( aO * aO + aN * aN ) ; aL . x = aO . x * aR . x + aN . x * aR . y ; aL . yz = aO . yz * aP . xz + aN . yz * aP . yw ; return 130.0 * dot ( aM , aL ) ; } vec2 aY ( vec2 aV ) { float aW , aX ; aW = dot ( aV , vec2 ( 12.9898 , 78.233 ) ) ; aX = dot ( aV , vec2 ( 12.9898 , 78.233 ) * 2.0 ) ; aW = fract ( sin ( aW ) * 43758.5453 ) * 2.0 - ai ; aX = fract ( sin ( aX ) * 43758.5453 ) * 2.0 - ai ; return vec2 ( aW , aX ) ; }".split(" ")}]};
a["include/caustics.glslf"]={type:"group",parts:[{type:"var",name:"CAUST_SPEED",tokens:["vec2","(","0.0",")"]},{type:"var",name:"CAUST_SCALE",tokens:["0.0"]},{type:"var",name:"CAUST_BRIGHT",tokens:["0.0"]},{type:"var",name:"SUN_NUM",tokens:["0"]},{type:"define",name:"CAUSTICS_VIEW_DISTANCE",tokens:["100.0"]},{type:"textline",tokens:"void bp ( inout vec3 aZ , float a_ , float ba , vec4 bb , vec3 bc , vec3 bd , vec3 be , vec4 bf , vec3 bg , float bh ) { float bi , bj , bk ; vec2 bl , bm ; vec3 bn ; vec4 bo ; if ( bh > CAUSTICS_VIEW_DISTANCE ) return ; bo = bf ; bn = bg + bc ; bn . xz = 10.0 * sin ( 0.1 * bn . xz ) ; bn = bn + 2.0 * cross ( - bo . xyz , cross ( - bo . xyz , bn ) + bo . w * bn ) ; bl = bn . xz ; bn = bd ; bi = max ( dot ( bc , bn ) , 0.0 ) ; bj = 0.025 ; bm = CAUST_SPEED * ba ; bl . s += 0.25 * sin ( dot ( bg + ba , vec3 ( 1.0 ) ) ) ; bl . t += 0.35 * ( - sin ( dot ( bg - ba , vec3 ( - 0.7 ) ) ) ) ; bl . st += 0.15 * cos ( 4.0 * a_ - bm . x ) + 1.5 * sin ( a_ - 0.3 * bm . y ) ; bk = CAUST_SCALE * ( 1.0 + max ( 0.1 * a_ , 0.0 ) ) ; bn = aH ( ( bl / bk ) , bj ) ; bn *= CAUST_BRIGHT ; bn *= bn ; bj = min ( 0.25 * a_ , - a_ ) + 1.0 ; bj = max ( bj , 0.0 ) ; bi = bb [ SUN_NUM ] * bi ; bk = max ( sign ( a_ ) , 0.0 ) ; bi = bi + max ( 0.5 * sign ( - bc . y ) * bk , 0.0 ) ; bi = min ( bi , 1.0 ) ; aZ += be * bn * bj * bi ; }".split(" ")}]};
a["include/color_util.glslf"]={type:"group",parts:[{type:"define",name:"GAMMA",tokens:["1"]},{type:"define",name:"PREMULTIPLY_ALPHA",tokens:["1"]},{type:"textline",tokens:"void br ( inout vec3 bq ) {".split(" ")},{type:"condition",parts:[{type:"if",expression:["GAMMA"],group:{type:"group",parts:[{type:"textline",tokens:"bq = max ( vec3 ( 0.0 ) , bq ) ; bq = pow ( bq , vec3 ( 2.2 ) ) ;".split(" ")}]}}]},{type:"textline",tokens:"} void br ( inout float bs ) {".split(" ")},{type:"condition",parts:[{type:"if",
expression:["GAMMA"],group:{type:"group",parts:[{type:"textline",tokens:"bs = pow ( max ( 0.0 , bs ) , 2.2 ) ;".split(" ")}]}}]},{type:"textline",tokens:"} void bu ( inout vec3 bt ) {".split(" ")},{type:"condition",parts:[{type:"if",expression:["GAMMA"],group:{type:"group",parts:[{type:"textline",tokens:"bt = max ( vec3 ( 0.0 ) , bt ) ; bt = pow ( bt , vec3 ( 1.0 / 2.2 ) ) ;".split(" ")}]}}]},{type:"textline",tokens:"} void bx ( inout vec3 bv , in float bw ) {".split(" ")},{type:"condition",parts:[{type:"if",
expression:["PREMULTIPLY_ALPHA"],group:{type:"group",parts:[{type:"textline",tokens:"bv = bv * bw ;".split(" ")}]}}]},{type:"textline",tokens:"} float bB ( vec4 by ) { float bz ; vec3 bA ; bA = vec3 ( 0.299 , 0.587 , 0.114 ) ; bz = dot ( by . rgb , bA ) ; return bz ; }".split(" ")}]};a["include/shadow.glslf"]={type:"group",parts:[{type:"var",name:"PRECISION",tokens:["lowp"]},{type:"var",name:"CSM_BLEND_BETWEEN_CASCADES",tokens:["1.0"]},{type:"var",name:"CSM_FADE_LAST_CASCADE",tokens:["1.0"]},{type:"var",
name:"SHADOW_TEX_RES",tokens:["0.0"]},{type:"define",name:"M_PI",tokens:["3.14159265359"]},{type:"condition",parts:[{type:"if",expression:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",places:2},"SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"const float bN = 0.1 ; const float bO = 0.1 ; const float bP = - 0.01 ; const float bQ = 0.05 ; vec4 bR = vec4 ( 0.14383161 , 0.34495938 , - 0.38277543 , - 0.26496911 ) ; vec4 bS = vec4 ( 0.53742981 , 0.19984126 , 0.79197514 , - 0.094184101 ) ; vec4 bT = vec4 ( - 0.94201624 , - 0.91588581 , - 0.2418884 , 0.44323325 ) ; vec4 bU = vec4 ( - 0.81544232 , 0.94558609 , - 0.81409955 , 0.97484398 ) ; vec4 bV = vec4 ( - 0.1410079 , 0.2938776 , 0.27676845 , - 0.41893023 ) ; vec4 bW = vec4 ( - 0.4737342 , 0.78641367 , 0.19090188 , - 0.9293887 ) ; vec4 bX = vec4 ( - 0.39906216 , 0.45771432 , 0.99706507 , - 0.97511554 ) ; vec4 bY = vec4 ( - 0.87912464 , - 0.76890725 , 0.9143759 , 0.7564837 ) ; bool ca ( vec2 bZ , float b_ ) { return all ( lessThanEqual ( bZ , vec2 ( 1.0 + b_ ) ) ) && all ( greaterThanEqual ( bZ , vec2 ( 0.0 - b_ ) ) ) ; } float cj ( float cb , float cc , mat2 cd , vec3 ce , float cf , PRECISION sampler2D cg ) { vec2 ch , ci ; ci . x = cb ; ci . y = cc ; ci = cd * ci ; ch = ce . xy + ci * cf / SHADOW_TEX_RES ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["CSM_SECTION1",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:"if ( ! ca ( ch , bP ) ) return 1.0 ; else".split(" ")}]}}]},{type:"textline",tokens:"return step ( ce . z , texture2D ( cg , ch ) . r ) ; } float cs ( vec3 ck , PRECISION sampler2D cl , float cm ) { mat2 cn ; float co , cp , cq ; co = 0.0 ; ck . z = clamp ( ck . z , 0.0 , 1.0 ) ; cp = aY ( ck . xy ) . x * M_PI ; cq = cos ( cp ) ; cp = sin ( cp ) ; cn = mat2 ( cq , cp , - cp , cq ) ; for ( int cr = 0 ; cr < 4 ; cr ++ ) { co += cj ( bR [ cr ] , bV [ cr ] , cn , ck , cm , cl ) ; co += cj ( bS [ cr ] , bW [ cr ] , cn , ck , cm , cl ) ; co += cj ( bT [ cr ] , bX [ cr ] , cn , ck , cm , cl ) ; co += cj ( bU [ cr ] , bY [ cr ] , cn , ck , cm , cl ) ; } return clamp ( co / 16.0 , 0.0 , 1.0 ) ; } float cH ( vec3 ct , PRECISION sampler2D cu , vec3 cv , PRECISION sampler2D cw , float cx , float cy , float cz ) { mat2 cA ; float cB , cC , cD , cE ; ct . z = clamp ( ct . z , 0.0 , 1.0 ) ; cv . z = clamp ( cv . z , 0.0 , 1.0 ) ; cB = 0.0 ; cC = 0.0 ; cD = aY ( ct . xy ) . x * M_PI ; cE = cos ( cD ) ; cD = sin ( cD ) ; cA = mat2 ( cE , cD , - cD , cE ) ; for ( int cF = 0 ; cF < 4 ; cF ++ ) { cB += cj ( bR [ cF ] , bV [ cF ] , cA , ct , cx , cu ) ; cB += cj ( bS [ cF ] , bW [ cF ] , cA , ct , cx , cu ) ; cB += cj ( bT [ cF ] , bX [ cF ] , cA , ct , cx , cu ) ; cB += cj ( bU [ cF ] , bY [ cF ] , cA , ct , cx , cu ) ; } for ( int cG = 0 ; cG < 4 ; cG ++ ) { cC += cj ( bR [ cG ] , bV [ cG ] , cA , cv , cy , cw ) ; cC += cj ( bS [ cG ] , bW [ cG ] , cA , cv , cy , cw ) ; cC += cj ( bT [ cG ] , bX [ cG ] , cA , cv , cy , cw ) ; cC += cj ( bU [ cG ] , bY [ cG ] , cA , cv , cy , cw ) ; } cB = mix ( cB , cC , cz ) ; cB /= 16.0 ; return clamp ( cB , 0.0 , 1.0 ) ; } float cL ( vec2 cI ) { float cJ , cK ; cJ = min ( cI . x , cI . y ) ; cK = min ( 1.0 - cI . x , 1.0 - cI . y ) ; return min ( cJ , cK ) ; } float cO ( float cM , float cN ) { if ( cN >= 0.0 && cN <= bO ) cM = ( cM - 1.0 ) / bO * cN + 1.0 ; return cM ; } float cZ ( vec3 cP , vec3 cQ , PRECISION sampler2D cR , PRECISION sampler2D cS , float cT , float cU , float cV , float cW ) { float cX , cY ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["CSM_BLEND_BETWEEN_CASCADES"],group:{type:"group",parts:[{type:"textline",tokens:"cY = cL ( cP . xy ) ; if ( - cW > cV && cY >= 0.0 && cY <= bN && ca ( cQ . xy , 0.0 ) ) { cY = 1.0 - cY / bN ; cX = cH ( cP , cR , cQ , cS , cT , cU , cY ) ; } else".split(" ")}]}}]},{type:"textline",tokens:"cX = cs ( cP , cR , cT ) ; return cX ; } float dg ( vec3 c_ , PRECISION sampler2D da , float db , float dc , float dd ) { float de , df ; de = cs ( c_ , da , db ) ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["CSM_FADE_LAST_CASCADE"],group:{type:"group",parts:[{type:"textline",tokens:"if ( - dd > dc ) { df = cL ( c_ . xy ) ; de = cO ( de , df ) ; }".split(" ")}]}}]},{type:"textline",tokens:"return de ; } vec4 dr ( float dh ) { vec3 di , dj , dk , dl ; float dm , dn , dp , dq ; dm = 1.0 ; di = bI . xyz / bI . w ; if ( bI . w < 0.0 ) di . z = 0.0 ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION1","NUM_CAST_LAMPS",1,{type:"g_expr",
places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"dj = bJ . xyz / bJ . w ; if ( bJ . w < 0.0 ) dj . z = 0.0 ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION2","NUM_CAST_LAMPS",2,{type:"g_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"dk = bK . xyz / bK . w ; if ( bK . w < 0.0 ) dk . z = 0.0 ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION3",
"NUM_CAST_LAMPS",3,{type:"g_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"dl = bL . xyz / bL . w ; if ( bL . w < 0.0 ) dl . z = 0.0 ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION1"],group:{type:"group",parts:[{type:"textline",tokens:"if ( ca ( di . xy , 0.0 ) ) { dm = cZ ( di , dj , u_shadow_map0 , u_shadow_map1 , u_pcf_blur_radii [ 0 ] , u_pcf_blur_radii [ 1 ] , u_csm_center_dists [ 0 ] , dh ) ; }".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"if ( ca ( di . xy , bQ ) ) { dm = dg ( di , u_shadow_map0 , u_pcf_blur_radii [ 0 ] , u_csm_center_dists [ 0 ] , dh ) ; }".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION1"],group:{type:"group",parts:[{type:"textline",tokens:"else { if ( ca ( dj . xy , 0.0 ) ) {".split(" ")},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION2"],group:{type:"group",parts:[{type:"textline",tokens:"dm = cZ ( dj , dk , u_shadow_map1 , u_shadow_map2 , u_pcf_blur_radii [ 1 ] , u_pcf_blur_radii [ 2 ] , u_csm_center_dists [ 1 ] , dh ) ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"dm = dg ( dj , u_shadow_map1 , u_pcf_blur_radii [ 1 ] , u_csm_center_dists [ 1 ] , dh ) ;".split(" ")}]}}]},{type:"textline",tokens:["}"]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION2"],group:{type:"group",parts:[{type:"textline",tokens:"else { if ( ca ( dk . xy , 0.0 ) ) {".split(" ")},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION3"],group:{type:"group",parts:[{type:"textline",tokens:"dm = cZ ( dk , dl , u_shadow_map2 , u_shadow_map3 , u_pcf_blur_radii [ 2 ] , u_pcf_blur_radii [ 3 ] , u_csm_center_dists [ 2 ] , dh ) ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"dm = dg ( dk , u_shadow_map2 , u_pcf_blur_radii [ 2 ] , u_csm_center_dists [ 2 ] , dh ) ;".split(" ")}]}}]},{type:"textline",tokens:["}"]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION3"],group:{type:"group",parts:[{type:"textline",tokens:"else { if ( ca ( dl . xy , 0.0 ) ) dm = dg ( dl , u_shadow_map3 , u_pcf_blur_radii [ 3 ] , u_csm_center_dists [ 3 ] , dh ) ; }".split(" ")}]}}]},{type:"textline",tokens:["}"]}]}}]},
{type:"textline",tokens:["}"]}]}}]},{type:"condition",parts:[{type:"if",expression:["NUM_CAST_LAMPS",1,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"dn = cs ( dj , u_shadow_map1 , u_pcf_blur_radii [ 0 ] ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["dn","=","0.0",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["NUM_CAST_LAMPS",2,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"dp = cs ( dk , u_shadow_map2 , u_pcf_blur_radii [ 0 ] ) ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["dp","=","0.0",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["NUM_CAST_LAMPS",3,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"dq = cs ( dl , u_shadow_map3 , u_pcf_blur_radii [ 0 ] ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["dq","=","1.0",";"]}]}}]},{type:"textline",tokens:"return vec4 ( dm , dn , dp , dq ) ; }".split(" ")}]}}]},{type:"textline",tokens:"vec4 du ( inout vec3 ds ) { vec4 dt ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"dt = texture2DProj ( u_shadow_mask , bG ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["NUM_CAST_LAMPS",3,{type:"l_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"ds *= dt . a ;".split(" ")}]}}]},{type:"textline",tokens:["return","dt",";"]}]}},{type:"elif",expression:["SHADOW_USAGE","SHADOW_MASK_GENERATION",
{type:"equal_expr",places:2},"SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"dt = dr ( bD . z ) ; return dt ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"return vec4 ( 1.0 ) ;".split(" ")}]}}]},{type:"textline",tokens:["}"]}]};a["include/mirror.glslf"]={type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",
places:2},"REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",places:2},"REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",places:2},{type:"logical_or_expr",places:3}],group:{type:"group",parts:[{type:"define",name:"REFL_BUMP",tokens:["0.1"]},{type:"textline",tokens:"float dB ( in vec3 dv , vec3 dw , float dx , float dy ) { float dz ; vec3 dA ; dA = normalize ( dw + dv ) ; dz = 1.0 - dot ( dv , dA ) ; dz = dy + ( 1.0 - dy ) * pow ( dz , dx ) ; return dz ; } void dP ( inout vec3 dC , vec3 dD , vec3 dE , float dF , mat4 dG ) { vec2 dH , dI ; float dJ , dK , dL ; vec3 dM , dN , dO ; dM = reflect ( - dD , dE ) ; dJ = u_fresnel_params [ 2 ] ; dK = u_fresnel_params [ 3 ] ; dL = 1.0 ; if ( dJ != 0.0 ) dL = dB ( dD , dM , dJ , dK ) ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"dN = textureCube ( u_cube_reflection , dM ) . xyz ;".split(" ")}]}},{type:"elif",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["REFLECTION_PASS",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:"dO = u_refl_plane . xyz * dot ( dE , u_refl_plane . xyz ) ; dO = dE - dO ; dH = ( dG * vec4 ( dO , 0.0 ) ) . xy ; dI = bG . xy / bG . z ; dI += dH * REFL_BUMP ; dN = texture2D ( u_plane_reflection , dI ) . rgb ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"dN = vec3 ( 1.0 ) ; dF = 0.0 ;".split(" ")}]}}]}]}},{type:"elif",expression:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"dN = textureCube ( u_mirrormap , dM ) . xyz ; dF = u_mirror_factor ;".split(" ")}]}}]},{type:"textline",tokens:"br ( dN . rgb ) ; dC = mix ( dC , dN , dF * dL ) ; }".split(" ")}]}}]}]};a["include/environment.glslf"]={type:"group",parts:[{type:"textline",
tokens:"vec3 dS ( vec3 dQ ) { float dR ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["USE_ENVIRONMENT_LIGHT"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["SKY_TEXTURE"],group:{type:"group",parts:[{type:"textline",tokens:"return textureCube ( u_sky_texture , dQ ) . rgb ;".split(" ")}]}},{type:"elif",expression:["SKY_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:"dR = 0.5 * dQ . y + 0.5 ; return mix ( u_horizon_color , u_zenith_color , dR ) ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"return vec3 ( 1.0 ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"return vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"textline",tokens:["}"]}]};a["include/refraction.glslf"]={type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["REFRACTIVE"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["USE_REFRACTION_CORRECTION"],group:{type:"group",parts:[{type:"textline",
tokens:"float dY ( in float dT , inout vec2 dU , in vec2 dV ) { float dW ; vec4 dX ; dX = texture2D ( u_scene_depth , dU ) ; dW = Z ( dX ) ; if ( dW < bH ) { dU = dV ; return dT ; } else { return dW ; } return dT ; }".split(" ")}]}}]},{type:"textline",tokens:"vec3 ef ( in vec3 dZ , in vec2 d_ ) { vec3 ea ; float eb ; vec4 ec ; vec2 ed , ee ; ed = dZ . xy / dZ . z ; ee = ed + d_ ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["USE_REFRACTION_CORRECTION"],group:{type:"group",parts:[{type:"textline",
tokens:"ec = texture2DProj ( u_scene_depth , dZ ) ; eb = Z ( ec ) ; dY ( eb , ee , ed ) ;".split(" ")}]}}]},{type:"textline",tokens:"ea = texture2D ( u_refractmap , ee ) . rgb ; br ( ea ) ; return ea ; }".split(" ")}]}}]}]};a["include/nodes.glslf"]={type:"group",parts:[{type:"var",name:"MAPPING_TRS_MATRIX",tokens:["mat4","(","0.0",")"]},{type:"var",name:"MAPPING_SCALE",tokens:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_TRANSLATION",tokens:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_MIN_CLIP",
tokens:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_MAX_CLIP",tokens:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_IS_NORMAL",tokens:["0.0"]},{type:"var",name:"RGB_IND",tokens:["0"]},{type:"var",name:"VALUE_IND",tokens:["0"]},{type:"var",name:"LAMP_INDEX",tokens:["0"]},{type:"var",name:"NUM_LIGHTS",tokens:["0"]},{type:"var",name:"LAMP_IND",tokens:["0"]},{type:"var",name:"LAMP_SPOT_SIZE",tokens:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",tokens:["0"]},{type:"var",name:"LAMP_LIGHT_DIST",tokens:["0"]},
{type:"var",name:"LAMP_LIGHT_FACT_IND",tokens:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",tokens:["rgb"]},{type:"var",name:"LAMP_SHADOW_MAP_IND",tokens:["0"]},{type:"define",name:"M_PI",tokens:["3.14159265359"]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_GEOMETRY_OR","USE_NODE_TEX_COORD_GE",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","eg",";"]}]}}]},{type:"textline",tokens:"float ZERO_VALUE_NODES = 0.0 ; float UNITY_VALUE_NODES = 1.0 ; float eh = 0.5 ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["USE_NODE_B4W_REFRACTION"],group:{type:"group",parts:[{type:"textline",tokens:"vec3 el ( in vec3 ei , in float ej ) { vec3 ek ; ek = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["USE_REFRACTION"],group:{type:"group",parts:[{type:"textline",tokens:"ek = ef ( bG , ei . xz * ej ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"ek = texture2D ( u_refractmap , bG . xy / bG . z ) . rgb ; br ( ek ) ;".split(" ")}]}}]},
{type:"textline",tokens:["return","ek",";","}"]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_HUE_SAT","USE_NODE_MIX_RGB_HUE","USE_NODE_MIX_RGB_SATURATION","USE_NODE_MIX_RGB_VALUE","USE_NODE_MIX_RGB_COLOR","USE_NODE_SEPHSV",{type:"logical_or_expr",places:6}],group:{type:"group",parts:[{type:"textline",tokens:"vec3 eq ( vec3 em ) { float en , eo ; vec4 ep ; ep = vec4 ( ZERO_VALUE_NODES , - UNITY_VALUE_NODES / 3.0 , 2.0 / 3.0 , - UNITY_VALUE_NODES ) ; ep = mix ( vec4 ( em . bg , ep . wz ) , vec4 ( em . gb , ep . xy ) , step ( em . b , em . g ) ) ; ep = mix ( vec4 ( ep . xyw , em . r ) , vec4 ( em . r , ep . yzx ) , step ( ep . x , em . r ) ) ; en = ep . x - min ( ep . w , ep . y ) ; eo = 1.0e-10 ; return vec3 ( abs ( ep . z + ( ep . w - ep . y ) / ( 6.0 * en + eo ) ) , en / ( ep . x + eo ) , ep . x ) ; }".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["USE_NODE_HUE_SAT","USE_NODE_MIX_RGB_HUE","USE_NODE_MIX_RGB_SATURATION","USE_NODE_MIX_RGB_VALUE","USE_NODE_MIX_RGB_COLOR","USE_NODE_COMBHSV",{type:"logical_or_expr",places:6}],group:{type:"group",parts:[{type:"textline",tokens:"vec3 eu ( vec3 er ) { vec3 es ; vec4 et ; et = vec4 ( UNITY_VALUE_NODES , 2.0 / 3.0 , UNITY_VALUE_NODES / 3.0 , 3.0 ) ; es = abs ( fract ( vec3 ( er . r , er . r , er . r ) + et . xyz ) * 6.0 - et . www ) ; return er . b * mix ( et . xxx , clamp ( es - et . xxx , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) , er . g ) ; }".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["USE_NODE_GEOMETRY_UV","USE_NODE_B4W_PARALLAX","USE_NODE_UV_MERGED",{type:"logical_or_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:"vec3 ew ( vec2 ev ) { return vec3 ( ev * 2.0 - vec2 ( UNITY_VALUE_NODES , UNITY_VALUE_NODES ) , ZERO_VALUE_NODES ) ; }".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_TEXTURE_COLOR","USE_NODE_TEXTURE_NORMAL","USE_NODE_B4W_PARALLAX",{type:"logical_or_expr",places:3}],group:{type:"group",
parts:[{type:"textline",tokens:"vec2 ey ( vec3 ex ) { return vec2 ( ex . xy * eh + vec2 ( eh , eh ) ) ; }".split(" ")}]}}]},{type:"node",name:"CAMERA",declarations:[{type:"node_out",name:"fm",qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"fn",qualifier:["float"],is_optional:!0},{type:"node_out",name:"fo",qualifier:["float"],is_optional:!0}],statements:[{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_fm"],statements:[{type:"textline",tokens:"fm = normalize ( fd . xyz ) ;".split(" ")}]}]},
{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_fn"],statements:[{type:"textline",tokens:"fn = abs ( fd . z ) ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_fo"],statements:[{type:"textline",tokens:"fo = length ( fd . xyz ) ;".split(" ")}]}]}]},{type:"node",name:"COMBRGB",declarations:[{type:"node_in",name:"fp",qualifier:["float"],is_optional:!1},{type:"node_in",name:"fq",qualifier:["float"],is_optional:!1},{type:"node_in",name:"fr",qualifier:["float"],
is_optional:!1},{type:"node_out",name:"fs",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"fs = vec3 ( fp , fq , fr ) ;".split(" ")}]},{type:"node",name:"COMBHSV",declarations:[{type:"node_in",name:"ft",qualifier:["float"],is_optional:!1},{type:"node_in",name:"fu",qualifier:["float"],is_optional:!1},{type:"node_in",name:"fv",qualifier:["float"],is_optional:!1},{type:"node_out",name:"fw",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"fw = eu ( vec3 ( ft , fu , fv ) ) ;".split(" ")}]},
{type:"node",name:"EMPTY_UV",declarations:[{type:"node_out",name:"fx",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"fx = vec3 ( - UNITY_VALUE_NODES , - UNITY_VALUE_NODES , ZERO_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"EMPTY_VC",declarations:[{type:"node_out",name:"fy",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"fy = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"GEOMETRY_UV",declarations:[{type:"node_out",name:"fz",qualifier:["vec3"],
is_optional:!1},{type:"node_param",name:"ez",qualifier:["varying","vec2"]}],statements:[{type:"textline",tokens:"fz = ew ( ez ) ;".split(" ")}]},{type:"node",name:"GEOMETRY_OR",declarations:[{type:"node_out",name:"fA",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"fA = 2.0 * eg - vec3 ( UNITY_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"GEOMETRY_VC",declarations:[{type:"node_out",name:"fB",qualifier:["vec3"],is_optional:!1},{type:"node_param",name:"eA",qualifier:["varying",
"vec3"]}],statements:[{type:"textline",tokens:"fB = eA ; br ( fB ) ;".split(" ")}]},{type:"node",name:"GEOMETRY_VC1",declarations:[{type:"node_out",name:"fC",qualifier:["float"],is_optional:!1},{type:"node_param",name:"eB",qualifier:["varying","float"]}],statements:[{type:"textline",tokens:"fC = eB ; br ( fC ) ;".split(" ")}]},{type:"node",name:"GEOMETRY_VC2",declarations:[{type:"node_out",name:"fD",qualifier:["float"],is_optional:!1},{type:"node_out",name:"fE",qualifier:["float"],is_optional:!1},
{type:"node_param",name:"eC",qualifier:["varying","vec2"]}],statements:[{type:"textline",tokens:"fD = eC [ 0 ] ; fE = eC [ 1 ] ; br ( fD ) ; br ( fE ) ;".split(" ")}]},{type:"node",name:"GEOMETRY_VC3",declarations:[{type:"node_out",name:"fF",qualifier:["float"],is_optional:!1},{type:"node_out",name:"fG",qualifier:["float"],is_optional:!1},{type:"node_out",name:"fH",qualifier:["float"],is_optional:!1},{type:"node_param",name:"eD",qualifier:["varying","vec3"]}],statements:[{type:"textline",tokens:"fF = eD [ 0 ] ; fG = eD [ 1 ] ; fH = eD [ 2 ] ; br ( fF ) ; br ( fG ) ; br ( fH ) ;".split(" ")}]},
{type:"node",name:"GEOMETRY_NO",declarations:[{type:"node_out",name:"fI",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:["fI","=","fg",";"]}]},{type:"node",name:"GEOMETRY_FB",declarations:[{type:"node_out",name:"fJ",qualifier:["float"],is_optional:!1}],statements:[{type:"node_condition",parts:[{type:"node_if",expression:["INVERT_FRONTFACING"],statements:[{type:"textline",tokens:"fJ = ( gl_FrontFacing ) ? ZERO_VALUE_NODES : UNITY_VALUE_NODES ;".split(" ")}]},{type:"node_else",
statements:[{type:"textline",tokens:"fJ = ( gl_FrontFacing ) ? UNITY_VALUE_NODES : ZERO_VALUE_NODES ;".split(" ")}]}]}]},{type:"node",name:"GEOMETRY_VW",declarations:[{type:"node_out",name:"fK",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:["fK","=","eM",";"]}]},{type:"node",name:"GEOMETRY_LO",declarations:[{type:"node_out",name:"fL",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"fL [ 0 ] = fd [ 0 ] ; fL [ 1 ] = fd [ 1 ] ; fL [ 2 ] = fd [ 2 ] ;".split(" ")}]},
{type:"node",name:"GEOMETRY_GL",declarations:[{type:"node_out",name:"fM",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"fM = vec3 ( fh . r , - fh . b , fh . g ) ;".split(" ")}]},{type:"node",name:"NEW_GEOMETRY",declarations:[{type:"node_out",name:"fN",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"fO",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"fP",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"fQ",qualifier:["vec3"],is_optional:!1},{type:"node_out",
name:"fR",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"fS",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"fT",qualifier:["float"],is_optional:!1},{type:"node_out",name:"fU",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"fN = vec3 ( ZERO_VALUE_NODES ) ; fO = vec3 ( ZERO_VALUE_NODES ) ; fP = vec3 ( ZERO_VALUE_NODES ) ; fQ = vec3 ( ZERO_VALUE_NODES ) ; fR = vec3 ( ZERO_VALUE_NODES ) ; fS = vec3 ( ZERO_VALUE_NODES ) ; fT = ZERO_VALUE_NODES ; fU = ZERO_VALUE_NODES ;".split(" ")}]},
{type:"node",name:"HUE_SAT",declarations:[{type:"node_in",name:"fV",qualifier:["float"],is_optional:!1},{type:"node_in",name:"fW",qualifier:["float"],is_optional:!1},{type:"node_in",name:"fX",qualifier:["float"],is_optional:!1},{type:"node_in",name:"fY",qualifier:["float"],is_optional:!1},{type:"node_in",name:"fZ",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"f_",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"fj = eq ( fZ ) ; fj [ 0 ] += ( fV - eh ) ; if ( fj [ 0 ] > UNITY_VALUE_NODES ) fj [ 0 ] -= UNITY_VALUE_NODES ; else if ( fj [ 0 ] < ZERO_VALUE_NODES ) fj [ 0 ] += UNITY_VALUE_NODES ; fj *= vec3 ( UNITY_VALUE_NODES , fW , fX ) ; fj = mix ( vec3 ( UNITY_VALUE_NODES ) , mix ( vec3 ( ZERO_VALUE_NODES ) , fj , step ( vec3 ( ZERO_VALUE_NODES ) , fj ) ) , step ( fj , vec3 ( UNITY_VALUE_NODES ) ) ) ; f_ = mix ( fZ , eu ( fj ) , fY ) ;".split(" ")}]},
{type:"node",name:"INVERT",declarations:[{type:"node_in",name:"ga",qualifier:["float"],is_optional:!1},{type:"node_in",name:"gb",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"gc",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"gc = mix ( gb , vec3 ( UNITY_VALUE_NODES ) - gb , ga ) ;".split(" ")}]},{type:"node",name:"LAMP",declarations:[{type:"node_out",name:"gd",qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"ge",qualifier:["vec3"],is_optional:!1},{type:"node_out",
name:"gf",qualifier:["float"],is_optional:!1},{type:"node_out",name:"gg",qualifier:["float"],is_optional:!0}],statements:[{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_gd"],statements:[{type:"textline",tokens:"gd = u_lamp_light_color_intensities [ LAMP_INDEX ] ;".split(" ")}]}]},{type:"textline",tokens:"fe = u_lamp_light_factors [ LAMP_INDEX ] ; fj = u_lamp_light_directions [ LAMP_INDEX ] ; fk = u_lamp_light_positions [ LAMP_INDEX ] ; eX = fe . z ; if ( eX != - UNITY_VALUE_NODES ) {".split(" ")},
{type:"textline",tokens:"ge = fk - bC ; gf = length ( ge ) ; ge = normalize ( ge ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_gg"],statements:[{type:"textline",tokens:"gg = eX / ( eX + gf * gf ) ; eX = fe . x ; eY = fe . y ; if ( eX > - UNITY_VALUE_NODES ) { eZ = dot ( ge , fj ) ; eZ *= smoothstep ( ZERO_VALUE_NODES , UNITY_VALUE_NODES , ( eZ - eX ) / eY ) ; gg *= eZ ; }".split(" ")}]}]},{type:"textline",tokens:["}","else","{"]},{type:"node_condition",parts:[{type:"node_if",
expression:["USE_OUT_ge"],statements:[{type:"textline",tokens:["ge","=","fj",";"]}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_gf"],statements:[{type:"textline",tokens:"gf = length ( fk - bC ) ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_gg"],statements:[{type:"textline",tokens:["gg","=","UNITY_VALUE_NODES",";"]}]}]},{type:"textline",tokens:["}"]}]},{type:"node",name:"NORMAL",declarations:[{type:"node_in",name:"gh",qualifier:["vec3"],
is_optional:!1},{type:"node_out",name:"gi",qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"gj",qualifier:["float"],is_optional:!0},{type:"node_param",name:"eE",qualifier:["vec3"]}],statements:[{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_gi"],statements:[{type:"textline",tokens:["gi","=","eE",";"]}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_gj"],statements:[{type:"textline",tokens:"gj = - dot ( gh , eE ) ;".split(" ")}]}]}]},{type:"node",
name:"B4W_VECTOR_VIEW",declarations:[{type:"node_in",name:"gk",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"gl",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"gl = - ( eN * vec4 ( gk , ZERO_VALUE_NODES ) ) . xyz ;".split(" ")}]},{type:"node",name:"BSDF_ANISOTROPIC",declarations:[{type:"node_in",name:"gm",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"gn",qualifier:["float"],is_optional:!1},{type:"node_in",name:"go",qualifier:["float"],is_optional:!1},
{type:"node_in",name:"gp",qualifier:["float"],is_optional:!1},{type:"node_in",name:"gq",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"gr",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"gs",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:["gs","=","gm",";"]},{type:"textline",tokens:"gn ; go ; gp ; gq ; gr ;".split(" ")}]},{type:"node",name:"BSDF_DIFFUSE",declarations:[{type:"node_in",name:"gt",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"gu",
qualifier:["float"],is_optional:!1},{type:"node_in",name:"gv",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"gw",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:["gw","=","gt",";"]},{type:"textline",tokens:["gu",";","gv",";"]}]},{type:"node",name:"BSDF_GLASS",declarations:[{type:"node_in",name:"gx",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"gy",qualifier:["float"],is_optional:!1},{type:"node_in",name:"gz",qualifier:["float"],is_optional:!1},{type:"node_in",
name:"gA",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"gB",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:["gB","=","gx",";"]},{type:"textline",tokens:"gy ; gz ; gA ;".split(" ")}]},{type:"node",name:"BSDF_GLOSSY",declarations:[{type:"node_in",name:"gC",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"gD",qualifier:["float"],is_optional:!1},{type:"node_in",name:"gE",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"gF",qualifier:["vec3"],is_optional:!1}],
statements:[{type:"textline",tokens:["gF","=","gC",";"]},{type:"textline",tokens:["gD",";","gE",";"]}]},{type:"node",name:"BSDF_HAIR",declarations:[{type:"node_in",name:"gG",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"gH",qualifier:["float"],is_optional:!1},{type:"node_in",name:"gI",qualifier:["float"],is_optional:!1},{type:"node_in",name:"gJ",qualifier:["float"],is_optional:!1},{type:"node_out",name:"gK",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:["gK","=",
"gG",";"]},{type:"textline",tokens:"gH ; gI ; gJ ;".split(" ")}]},{type:"node",name:"BSDF_TRANSPARENT",declarations:[{type:"node_in",name:"gL",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"gM",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:["gM","=","gL",";"]}]},{type:"node",name:"BSDF_TRANSLUCENT",declarations:[{type:"node_in",name:"gN",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"gO",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"gP",qualifier:["vec3"],
is_optional:!1}],statements:[{type:"textline",tokens:["gP","=","gN",";"]},{type:"textline",tokens:["gO",";"]}]},{type:"node",name:"BSDF_REFRACTION",declarations:[{type:"node_in",name:"gQ",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"gR",qualifier:["float"],is_optional:!1},{type:"node_in",name:"gS",qualifier:["float"],is_optional:!1},{type:"node_in",name:"gT",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"gU",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"gU [ 0 ] = gU [ 1 ] = gU [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},
{type:"textline",tokens:"gQ ; gR ; gS ; gT ;".split(" ")}]},{type:"node",name:"BSDF_TOON",declarations:[{type:"node_in",name:"gV",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"gW",qualifier:["float"],is_optional:!1},{type:"node_in",name:"gX",qualifier:["float"],is_optional:!1},{type:"node_in",name:"gY",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"gZ",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:["gZ","=","gV",";"]},{type:"textline",tokens:"gW ; gX ; gY ;".split(" ")}]},
{type:"node",name:"BSDF_VELVET",declarations:[{type:"node_in",name:"g_",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"ha",qualifier:["float"],is_optional:!1},{type:"node_in",name:"hb",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"hc",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:["hc","=","g_",";"]},{type:"textline",tokens:["ha",";","hb",";"]}]},{type:"node",name:"SUBSURFACE_SCATTERING",declarations:[{type:"node_in",name:"hd",qualifier:["vec3"],is_optional:!1},
{type:"node_in",name:"he",qualifier:["float"],is_optional:!1},{type:"node_in",name:"hf",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"hg",qualifier:["float"],is_optional:!1},{type:"node_in",name:"hh",qualifier:["float"],is_optional:!1},{type:"node_in",name:"hi",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"hj",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"hj [ 0 ] = hj [ 1 ] = hj [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",tokens:"hd ; hf ; hg ; hh ; hi ; he ;".split(" ")}]},
{type:"node",name:"EMISSION",declarations:[{type:"node_in",name:"hk",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"hl",qualifier:["float"],is_optional:!1},{type:"node_out",name:"hm",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:["hm","=","hk",";"]},{type:"textline",tokens:["hl",";"]}]},{type:"node",name:"AMBIENT_OCCLUSION",declarations:[{type:"node_in",name:"hn",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"ho",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",
tokens:"ho [ 0 ] = ho [ 1 ] = ho [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",tokens:["hn",";"]}]},{type:"node",name:"HOLDOUT",declarations:[{type:"node_out",name:"hp",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"hp [ 0 ] = hp [ 1 ] = hp [ 2 ] = ZERO_VALUE_NODES ;".split(" ")}]},{type:"node",name:"VOLUME_ABSORPTION",declarations:[{type:"node_in",name:"hq",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"hr",qualifier:["float"],is_optional:!1},{type:"node_out",
name:"hs",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"hs [ 0 ] = hs [ 1 ] = hs [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",tokens:["hq",";","hr",";"]}]},{type:"node",name:"VOLUME_SCATTER",declarations:[{type:"node_in",name:"ht",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"hu",qualifier:["float"],is_optional:!1},{type:"node_in",name:"hv",qualifier:["float"],is_optional:!1},{type:"node_out",name:"hw",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",
tokens:"hw [ 0 ] = hw [ 1 ] = hw [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",tokens:"ht ; hu ; hv ;".split(" ")}]},{type:"node",name:"BUMP",declarations:[{type:"node_in",name:"hx",qualifier:["float"],is_optional:!1},{type:"node_in",name:"hy",qualifier:["float"],is_optional:!1},{type:"node_in",name:"hz",qualifier:["float"],is_optional:!1},{type:"node_in",name:"hA",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"hB",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",
tokens:["hB","=","hA",";"]},{type:"textline",tokens:"hx ; hy ; hz ;".split(" ")}]},{type:"node",name:"NORMAL_MAP",declarations:[{type:"node_in",name:"hC",qualifier:["float"],is_optional:!1},{type:"node_in",name:"hD",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"hE",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:["hE","=","hD",";"]},{type:"textline",tokens:["hC",";"]}]},{type:"node",name:"VECT_TRANSFORM",declarations:[{type:"node_in",name:"hF",qualifier:["vec3"],
is_optional:!1},{type:"node_out",name:"hG",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"hG [ 0 ] = hG [ 1 ] = hG [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",tokens:["hF",";"]}]},{type:"node",name:"BLACKBODY",declarations:[{type:"node_in",name:"hH",qualifier:["float"],is_optional:!1},{type:"node_out",name:"hI",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"hI [ 0 ] = hI [ 1 ] = hI [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",
tokens:["hH",";"]}]},{type:"node",name:"WAVELENGTH",declarations:[{type:"node_in",name:"hJ",qualifier:["float"],is_optional:!1},{type:"node_out",name:"hK",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"hK [ 0 ] = hK [ 1 ] = hK [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",tokens:["hJ",";"]}]},{type:"node",name:"SEPXYZ",declarations:[{type:"node_in",name:"hL",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"hM",qualifier:["float"],is_optional:!1},{type:"node_out",
name:"hN",qualifier:["float"],is_optional:!1},{type:"node_out",name:"hO",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"hM = hL [ 0 ] ; hN = hL [ 1 ] ; hO = hL [ 2 ] ;".split(" ")}]},{type:"node",name:"COMBXYZ",declarations:[{type:"node_in",name:"hP",qualifier:["float"],is_optional:!1},{type:"node_in",name:"hQ",qualifier:["float"],is_optional:!1},{type:"node_in",name:"hR",qualifier:["float"],is_optional:!1},{type:"node_out",name:"hS",qualifier:["vec3"],is_optional:!1}],
statements:[{type:"textline",tokens:"hS [ 0 ] = hP ; hS [ 1 ] = hQ ; hS [ 2 ] = hR ;".split(" ")}]},{type:"node",name:"BRIGHTCONTRAST",declarations:[{type:"node_in",name:"hT",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"hU",qualifier:["float"],is_optional:!1},{type:"node_in",name:"hV",qualifier:["float"],is_optional:!1},{type:"node_out",name:"hW",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"eZ = hU - hV * eh ; hW = max ( ( UNITY_VALUE_NODES + hV ) * hT + eZ , vec3 ( ZERO_VALUE_NODES ) ) ;".split(" ")}]},
{type:"node",name:"LIGHT_FALLOFF",declarations:[{type:"node_in",name:"hX",qualifier:["float"],is_optional:!1},{type:"node_in",name:"hY",qualifier:["float"],is_optional:!1},{type:"node_out",name:"hZ",qualifier:["float"],is_optional:!1},{type:"node_out",name:"h_",qualifier:["float"],is_optional:!1},{type:"node_out",name:"ia",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"hZ = h_ = ia = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",tokens:["hX",";","hY",";"]}]},{type:"node",
name:"TEX_IMAGE",declarations:[{type:"node_in",name:"ib",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"ic",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"id",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"ic [ 0 ] = ic [ 1 ] = ic [ 2 ] = ZERO_VALUE_NODES ; id = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",tokens:["ib",";"]}]},{type:"node",name:"TEX_ENVIRONMENT",declarations:[{type:"node_in",name:"ie",qualifier:["vec3"],is_optional:!1},{type:"node_out",
name:"ig",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"ig [ 0 ] = ig [ 1 ] = ig [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",tokens:["ie",";"]}]},{type:"node",name:"TEX_SKY",declarations:[{type:"node_in",name:"ih",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"ii",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"ii [ 0 ] = ii [ 1 ] = ii [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",tokens:["ih",";"]}]},{type:"node",
name:"TEX_NOISE",declarations:[{type:"node_in",name:"ij",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"ik",qualifier:["float"],is_optional:!1},{type:"node_in",name:"il",qualifier:["float"],is_optional:!1},{type:"node_in",name:"im",qualifier:["float"],is_optional:!1},{type:"node_out",name:"io",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"ip",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"io [ 0 ] = io [ 1 ] = io [ 2 ] = ZERO_VALUE_NODES ; ip = UNITY_VALUE_NODES ;".split(" ")},
{type:"textline",tokens:"ij ; ik ; il ; im ;".split(" ")}]},{type:"node",name:"TEX_WAVE",declarations:[{type:"node_in",name:"iq",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"ir",qualifier:["float"],is_optional:!1},{type:"node_in",name:"is",qualifier:["float"],is_optional:!1},{type:"node_in",name:"it",qualifier:["float"],is_optional:!1},{type:"node_in",name:"iu",qualifier:["float"],is_optional:!1},{type:"node_out",name:"iv",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"iw",
qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"iv [ 0 ] = iv [ 1 ] = iv [ 2 ] = ZERO_VALUE_NODES ; iw = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",tokens:"iq ; ir ; is ; it ; iu ;".split(" ")}]},{type:"node",name:"TEX_VORONOI",declarations:[{type:"node_in",name:"ix",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"iy",qualifier:["float"],is_optional:!1},{type:"node_out",name:"iz",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"iA",qualifier:["float"],
is_optional:!1}],statements:[{type:"textline",tokens:"iz [ 0 ] = iz [ 1 ] = iz [ 2 ] = ZERO_VALUE_NODES ; iA = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",tokens:["ix",";","iy",";"]}]},{type:"node",name:"TEX_MUSGRAVE",declarations:[{type:"node_in",name:"iB",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"iC",qualifier:["float"],is_optional:!1},{type:"node_in",name:"iD",qualifier:["float"],is_optional:!1},{type:"node_in",name:"iE",qualifier:["float"],is_optional:!1},{type:"node_in",
name:"iF",qualifier:["float"],is_optional:!1},{type:"node_in",name:"iG",qualifier:["float"],is_optional:!1},{type:"node_in",name:"iH",qualifier:["float"],is_optional:!1},{type:"node_out",name:"iI",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"iJ",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"iI [ 0 ] = iI [ 1 ] = iI [ 2 ] = ZERO_VALUE_NODES ; iJ = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",tokens:"iB ; iC ; iD ; iE ; iF ; iG ; iH ;".split(" ")}]},{type:"node",
name:"TEX_GRADIENT",declarations:[{type:"node_in",name:"iK",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"iL",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"iM",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"iL [ 0 ] = iL [ 1 ] = iL [ 2 ] = ZERO_VALUE_NODES ; iM = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",tokens:["iK",";"]}]},{type:"node",name:"TEX_MAGIC",declarations:[{type:"node_in",name:"iN",qualifier:["vec3"],is_optional:!1},{type:"node_in",
name:"iO",qualifier:["float"],is_optional:!1},{type:"node_in",name:"iP",qualifier:["float"],is_optional:!1},{type:"node_out",name:"iQ",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"iR",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"iQ [ 0 ] = iQ [ 1 ] = iQ [ 2 ] = ZERO_VALUE_NODES ; iR = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",tokens:"iN ; iO ; iP ;".split(" ")}]},{type:"node",name:"TEX_CHECKER",declarations:[{type:"node_in",name:"iS",qualifier:["vec3"],
is_optional:!1},{type:"node_in",name:"iT",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"iU",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"iV",qualifier:["float"],is_optional:!1},{type:"node_out",name:"iW",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"iX",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"iW [ 0 ] = iW [ 1 ] = iW [ 2 ] = ZERO_VALUE_NODES ; iX = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",tokens:"iS ; iT ; iU ; iV ;".split(" ")}]},
{type:"node",name:"TEX_BRICK",declarations:[{type:"node_in",name:"iY",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"iZ",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"i_",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"ja",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"jb",qualifier:["float"],is_optional:!1},{type:"node_in",name:"jc",qualifier:["float"],is_optional:!1},{type:"node_in",name:"jd",qualifier:["float"],is_optional:!1},{type:"node_in",name:"je",qualifier:["float"],
is_optional:!1},{type:"node_in",name:"jf",qualifier:["float"],is_optional:!1},{type:"node_out",name:"jg",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"jh",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"jg [ 0 ] = jg [ 1 ] = jg [ 2 ] = ZERO_VALUE_NODES ; jh = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",tokens:"iY ; iZ ; i_ ; ja ; jb ; jc ; jd ; je ; jf ;".split(" ")}]},{type:"node",name:"ADD_SHADER",declarations:[{type:"node_in",name:"ji",qualifier:["vec3"],
is_optional:!1},{type:"node_in",name:"jj",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"jk",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"jk = clamp ( ji + jj , vec3 ( ZERO_VALUE_NODES ) , vec3 ( UNITY_VALUE_NODES ) ) ;".split(" ")}]},{type:"node",name:"MIX_SHADER",declarations:[{type:"node_in",name:"jl",qualifier:["float"],is_optional:!1},{type:"node_in",name:"jm",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"jn",qualifier:["vec3"],is_optional:!1},
{type:"node_out",name:"jo",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"eZ = clamp ( jl , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; jo = eZ * jm + ( UNITY_VALUE_NODES - eZ ) * jn ;".split(" ")}]},{type:"node",name:"UV_MERGED",declarations:[{type:"node_out",name:"jp",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"jq",qualifier:["vec3"],is_optional:!1},{type:"node_param",name:"eF",qualifier:["varying","vec2"]}],statements:[{type:"node_condition",parts:[{type:"node_if",
expression:["USE_OUT_jp"],statements:[{type:"textline",tokens:"jp = ew ( eF ) ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_jq"],statements:[{type:"textline",tokens:"jq = vec3 ( eF , ZERO_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"TEX_COORD_UV",declarations:[{type:"node_out",name:"jr",qualifier:["vec3"],is_optional:!1},{type:"node_param",name:"eG",qualifier:["varying","vec2"]}],statements:[{type:"textline",tokens:"jr = vec3 ( eG , ZERO_VALUE_NODES ) ;".split(" ")}]},
{type:"node",name:"TEX_COORD_NO",declarations:[{type:"node_out",name:"js",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:["js","=","fi",";"]}]},{type:"node",name:"TEX_COORD_GE",declarations:[{type:"node_out",name:"jt",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:["jt","=","eg",";"]}]},{type:"node",name:"TEX_COORD_OB",declarations:[{type:"node_out",name:"ju",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"ju [ 0 ] = ju [ 1 ] = ju [ 2 ] = UNITY_VALUE_NODES ;".split(" ")}]},
{type:"node",name:"TEX_COORD_CA",declarations:[{type:"node_out",name:"jv",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"jv [ 0 ] = fd [ 0 ] ; jv [ 1 ] = fd [ 1 ] ; jv [ 2 ] = UNITY_VALUE_NODES ;".split(" ")}]},{type:"node",name:"TEX_COORD_WI",declarations:[{type:"node_out",name:"jw",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"jw [ 0 ] = jw [ 1 ] = jw [ 2 ] = UNITY_VALUE_NODES ;".split(" ")}]},{type:"node",name:"TEX_COORD_RE",declarations:[{type:"node_out",
name:"jx",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"jx [ 0 ] = jx [ 1 ] = jx [ 2 ] = UNITY_VALUE_NODES ;".split(" ")}]},{type:"node",name:"UVMAP",declarations:[{type:"node_out",name:"jy",qualifier:["vec3"],is_optional:!1},{type:"node_param",name:"eH",qualifier:["varying","vec2"]}],statements:[{type:"textline",tokens:"jy = vec3 ( eH , ZERO_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"PARTICLE_INFO",declarations:[{type:"node_out",name:"jz",qualifier:["float"],is_optional:!1},
{type:"node_out",name:"jA",qualifier:["float"],is_optional:!1},{type:"node_out",name:"jB",qualifier:["float"],is_optional:!1},{type:"node_out",name:"jC",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"jD",qualifier:["float"],is_optional:!1},{type:"node_out",name:"jE",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"jF",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"jz = ZERO_VALUE_NODES ; jA = ZERO_VALUE_NODES ; jB = ZERO_VALUE_NODES ; jC = vec3 ( ZERO_VALUE_NODES ) ; jD = ZERO_VALUE_NODES ; jE = jC ; jF = jC ;".split(" ")}]},
{type:"node",name:"HAIR_INFO",declarations:[{type:"node_out",name:"jG",qualifier:["float"],is_optional:!1},{type:"node_out",name:"jH",qualifier:["float"],is_optional:!1},{type:"node_out",name:"jI",qualifier:["float"],is_optional:!1},{type:"node_out",name:"jJ",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"jG = ZERO_VALUE_NODES ; jH = ZERO_VALUE_NODES ; jI = ZERO_VALUE_NODES ; jJ = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"OBJECT_INFO",declarations:[{type:"node_out",
name:"jK",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"jL",qualifier:["float"],is_optional:!1},{type:"node_out",name:"jM",qualifier:["float"],is_optional:!1},{type:"node_out",name:"jN",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"jL = ZERO_VALUE_NODES ; jM = ZERO_VALUE_NODES ; jN = ZERO_VALUE_NODES ; jK = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"WIREFRAME",declarations:[{type:"node_in",name:"jO",qualifier:["float"],is_optional:!1},{type:"node_out",
name:"jP",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:["jP","=","jO",";"]}]},{type:"node",name:"TANGENT",declarations:[{type:"node_out",name:"jQ",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"jQ = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"LAYER_WEIGHT",declarations:[{type:"node_in",name:"jR",qualifier:["float"],is_optional:!1},{type:"node_in",name:"jS",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"jT",qualifier:["float"],
is_optional:!1},{type:"node_out",name:"jU",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"jT = jU = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",tokens:["jS",";","jR",";"]}]},{type:"node",name:"LIGHT_PATH",declarations:[{type:"node_out",name:"jV",qualifier:["float"],is_optional:!1},{type:"node_out",name:"jW",qualifier:["float"],is_optional:!1},{type:"node_out",name:"jX",qualifier:["float"],is_optional:!1},{type:"node_out",name:"jY",qualifier:["float"],is_optional:!1},
{type:"node_out",name:"jZ",qualifier:["float"],is_optional:!1},{type:"node_out",name:"j_",qualifier:["float"],is_optional:!1},{type:"node_out",name:"ka",qualifier:["float"],is_optional:!1},{type:"node_out",name:"kb",qualifier:["float"],is_optional:!1},{type:"node_out",name:"kc",qualifier:["float"],is_optional:!1},{type:"node_out",name:"kd",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"jV = jW = jX = ZERO_VALUE_NODES ; jY = jZ = j_ = ZERO_VALUE_NODES ; ka = ka = kc = kd = ZERO_VALUE_NODES ; kb = ZERO_VALUE_NODES ;".split(" ")}]},
{type:"node",name:"ATTRIBUTE",declarations:[{type:"node_out",name:"ke",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"kf",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"kg",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"ke = kf = vec3 ( ZERO_VALUE_NODES ) ; kg = ZERO_VALUE_NODES ;".split(" ")}]},{type:"node",name:"SCRIPT",declarations:[],statements:[]},{type:"node",name:"CURVE_VEC",declarations:[{type:"node_in",name:"kh",qualifier:["float"],is_optional:!1},
{type:"node_in",name:"ki",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"kj",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:["kj","=","ki",";"]},{type:"textline",tokens:["kh",";"]}]},{type:"node",name:"CURVE_RGB",declarations:[{type:"node_in",name:"kk",qualifier:["float"],is_optional:!1},{type:"node_in",name:"kl",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"km",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:["km","=","kl",";"]},
{type:"textline",tokens:["kk",";"]}]},{type:"node",name:"VALTORGB",declarations:[{type:"node_in",name:"kn",qualifier:["float"],is_optional:!1},{type:"node_out",name:"ko",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"kp",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"ko [ 0 ] = ko [ 1 ] = ko [ 2 ] = clamp ( kn , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; kp = ko [ 0 ] ;".split(" ")}]},{type:"node",name:"MAPPING",declarations:[{type:"node_in",name:"kq",qualifier:["vec3"],
is_optional:!1},{type:"node_out",name:"kr",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:["kr","=","kq",";"]},{type:"node_condition",parts:[{type:"node_ifdef",name:"MAPPING_TRS_MATRIX",statements:[{type:"textline",tokens:"kr = ( MAPPING_TRS_MATRIX * vec4 ( kr , UNITY_VALUE_NODES ) ) . xyz ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_ifdef",name:"MAPPING_SCALE",statements:[{type:"textline",tokens:"kr = kr * MAPPING_SCALE ;".split(" ")}]}]},{type:"node_condition",
parts:[{type:"node_ifdef",name:"MAPPING_TRANSLATION",statements:[{type:"textline",tokens:"kr = kr + MAPPING_TRANSLATION ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_ifdef",name:"MAPPING_MIN_CLIP",statements:[{type:"textline",tokens:"kr = max ( kr , MAPPING_MIN_CLIP ) ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_ifdef",name:"MAPPING_MAX_CLIP",statements:[{type:"textline",tokens:"kr = min ( kr , MAPPING_MAX_CLIP ) ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",
expression:["MAPPING_IS_NORMAL"],statements:[{type:"textline",tokens:"kr = normalize ( kr ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_ADD",declarations:[{type:"node_in",name:"ks",qualifier:["float"],is_optional:!1},{type:"node_in",name:"kt",qualifier:["float"],is_optional:!1},{type:"node_out",name:"ku",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"ku = ks + kt ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",
tokens:"ku = clamp ( ku , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_SUBTRACT",declarations:[{type:"node_in",name:"kv",qualifier:["float"],is_optional:!1},{type:"node_in",name:"kw",qualifier:["float"],is_optional:!1},{type:"node_out",name:"kx",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"kx = kv - kw ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",tokens:"kx = clamp ( kx , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MATH_MULTIPLY",declarations:[{type:"node_in",name:"ky",qualifier:["float"],is_optional:!1},{type:"node_in",name:"kz",qualifier:["float"],is_optional:!1},{type:"node_out",name:"kA",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"kA = ky * kz ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",tokens:"kA = clamp ( kA , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",
name:"MATH_DIVIDE",declarations:[{type:"node_in",name:"kB",qualifier:["float"],is_optional:!1},{type:"node_in",name:"kC",qualifier:["float"],is_optional:!1},{type:"node_out",name:"kD",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"kD = ( kC != ZERO_VALUE_NODES ) ? kB / kC : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",tokens:"kD = clamp ( kD , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MATH_SINE",declarations:[{type:"node_in",name:"kE",qualifier:["float"],is_optional:!1},{type:"node_in",name:"kF",qualifier:["float"],is_optional:!1},{type:"node_out",name:"kG",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"kG = sin ( kE ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",tokens:"kG = clamp ( kG , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",
tokens:["kF",";"]}]},{type:"node",name:"MATH_COSINE",declarations:[{type:"node_in",name:"kH",qualifier:["float"],is_optional:!1},{type:"node_in",name:"kI",qualifier:["float"],is_optional:!1},{type:"node_out",name:"kJ",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"kJ = cos ( kH ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",tokens:"kJ = clamp ( kJ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},
{type:"textline",tokens:["kI",";"]}]},{type:"node",name:"MATH_TANGENT",declarations:[{type:"node_in",name:"kK",qualifier:["float"],is_optional:!1},{type:"node_in",name:"kL",qualifier:["float"],is_optional:!1},{type:"node_out",name:"kM",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"kM = tan ( kK ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",tokens:"kM = clamp ( kM , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},
{type:"textline",tokens:["kL",";"]}]},{type:"node",name:"MATH_ARCSINE",declarations:[{type:"node_in",name:"kN",qualifier:["float"],is_optional:!1},{type:"node_in",name:"kO",qualifier:["float"],is_optional:!1},{type:"node_out",name:"kP",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"kP = ( kN <= UNITY_VALUE_NODES && kN >= - UNITY_VALUE_NODES ) ? asin ( kN ) : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",
tokens:"kP = clamp ( kP , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",tokens:["kO",";"]}]},{type:"node",name:"MATH_ARCCOSINE",declarations:[{type:"node_in",name:"kQ",qualifier:["float"],is_optional:!1},{type:"node_in",name:"kR",qualifier:["float"],is_optional:!1},{type:"node_out",name:"kS",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"kS = ( kQ <= UNITY_VALUE_NODES && kQ >= - UNITY_VALUE_NODES ) ? acos ( kQ ) : ZERO_VALUE_NODES ;".split(" ")},
{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",tokens:"kS = clamp ( kS , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",tokens:["kR",";"]}]},{type:"node",name:"MATH_ARCTANGENT",declarations:[{type:"node_in",name:"kT",qualifier:["float"],is_optional:!1},{type:"node_in",name:"kU",qualifier:["float"],is_optional:!1},{type:"node_out",name:"kV",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"kV = atan ( kT ) ;".split(" ")},
{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",tokens:"kV = clamp ( kV , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",tokens:["kU",";"]}]},{type:"node",name:"MATH_POWER",declarations:[{type:"node_in",name:"kW",qualifier:["float"],is_optional:!1},{type:"node_in",name:"kX",qualifier:["float"],is_optional:!1},{type:"node_out",name:"kY",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"if ( kW < ZERO_VALUE_NODES && kX != floor ( kX ) ) kY = ZERO_VALUE_NODES ; else if ( kX == ZERO_VALUE_NODES )".split(" ")},
{type:"textline",tokens:"kY = UNITY_VALUE_NODES ; else if ( kW < ZERO_VALUE_NODES ) kY = mix ( UNITY_VALUE_NODES , - UNITY_VALUE_NODES , sign ( mod ( - kX , 2.0 ) ) ) * pow ( - kW , kX ) ; else if ( kW == ZERO_VALUE_NODES ) kY = ZERO_VALUE_NODES ; else kY = pow ( kW , kX ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",tokens:"kY = clamp ( kY , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_LOGARITHM",
declarations:[{type:"node_in",name:"kZ",qualifier:["float"],is_optional:!1},{type:"node_in",name:"k_",qualifier:["float"],is_optional:!1},{type:"node_out",name:"la",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"la = ( kZ > ZERO_VALUE_NODES && k_ > ZERO_VALUE_NODES ) ? log2 ( kZ ) / log2 ( k_ ) : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",tokens:"la = clamp ( la , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MATH_MINIMUM",declarations:[{type:"node_in",name:"lb",qualifier:["float"],is_optional:!1},{type:"node_in",name:"lc",qualifier:["float"],is_optional:!1},{type:"node_out",name:"ld",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"ld = min ( lb , lc ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",tokens:"ld = clamp ( ld , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",
name:"MATH_MAXIMUM",declarations:[{type:"node_in",name:"le",qualifier:["float"],is_optional:!1},{type:"node_in",name:"lf",qualifier:["float"],is_optional:!1},{type:"node_out",name:"lg",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"lg = max ( le , lf ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",tokens:"lg = clamp ( lg , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_ROUND",
declarations:[{type:"node_in",name:"lh",qualifier:["float"],is_optional:!1},{type:"node_in",name:"li",qualifier:["float"],is_optional:!1},{type:"node_out",name:"lj",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"lj = floor ( lh + eh ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",tokens:"lj = clamp ( lj , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",tokens:["li",";"]}]},
{type:"node",name:"MATH_LESS_THAN",declarations:[{type:"node_in",name:"lk",qualifier:["float"],is_optional:!1},{type:"node_in",name:"ll",qualifier:["float"],is_optional:!1},{type:"node_out",name:"lm",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"lm = ( lk < ll ) ? UNITY_VALUE_NODES : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",tokens:"lm = clamp ( lm , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MATH_GREATER_THAN",declarations:[{type:"node_in",name:"ln",qualifier:["float"],is_optional:!1},{type:"node_in",name:"lo",qualifier:["float"],is_optional:!1},{type:"node_out",name:"lp",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"lp = ( ln > lo ) ? UNITY_VALUE_NODES : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",tokens:"lp = clamp ( lp , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MATH_MODULO",declarations:[{type:"node_in",name:"lq",qualifier:["float"],is_optional:!1},{type:"node_in",name:"lr",qualifier:["float"],is_optional:!1},{type:"node_out",name:"ls",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"ls = abs ( lr ) > 0.000001 ? mod ( lq , lr ) : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",tokens:"ls = clamp ( ls , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MATH_ABSOLUTE",declarations:[{type:"node_in",name:"lt",qualifier:["float"],is_optional:!1},{type:"node_in",name:"lu",qualifier:["float"],is_optional:!1},{type:"node_out",name:"lv",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"lv = abs ( lt ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",tokens:"lv = clamp ( lv , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",
tokens:["lu",";"]}]},{type:"node",name:"MIX_RGB_MIX",declarations:[{type:"node_in",name:"lw",qualifier:["float"],is_optional:!1},{type:"node_in",name:"lx",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"ly",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"lz",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"eZ = clamp ( lw , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; lz = mix ( lx , ly , eZ ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MIX_RGB_USE_CLAMP"],
statements:[{type:"textline",tokens:"lz = clamp ( lz , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_ADD",declarations:[{type:"node_in",name:"lA",qualifier:["float"],is_optional:!1},{type:"node_in",name:"lB",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"lC",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"lD",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"eZ = clamp ( lA , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; lD = mix ( lB , lB + lC , eZ ) ;".split(" ")},
{type:"node_condition",parts:[{type:"node_if",expression:["MIX_RGB_USE_CLAMP"],statements:[{type:"textline",tokens:"lD = clamp ( lD , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_MULTIPLY",declarations:[{type:"node_in",name:"lE",qualifier:["float"],is_optional:!1},{type:"node_in",name:"lF",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"lG",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"lH",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",
tokens:"eZ = clamp ( lE , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; lH = mix ( lF , lF * lG , eZ ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MIX_RGB_USE_CLAMP"],statements:[{type:"textline",tokens:"lH = clamp ( lH , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_SUBTRACT",declarations:[{type:"node_in",name:"lI",qualifier:["float"],is_optional:!1},{type:"node_in",name:"lJ",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"lK",
qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"lL",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"eZ = clamp ( lI , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; lL = mix ( lJ , lJ - lK , eZ ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MIX_RGB_USE_CLAMP"],statements:[{type:"textline",tokens:"lL = clamp ( lL , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_SCREEN",declarations:[{type:"node_in",name:"lM",
qualifier:["float"],is_optional:!1},{type:"node_in",name:"lN",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"lO",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"lP",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"eZ = clamp ( lM , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; eY = UNITY_VALUE_NODES - eZ ; lP = vec3 ( UNITY_VALUE_NODES ) - ( vec3 ( eY ) + eZ * ( vec3 ( UNITY_VALUE_NODES ) - lO ) ) * ( vec3 ( UNITY_VALUE_NODES ) - lN ) ;".split(" ")},{type:"node_condition",
parts:[{type:"node_if",expression:["MIX_RGB_USE_CLAMP"],statements:[{type:"textline",tokens:"lP = clamp ( lP , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_DIVIDE",declarations:[{type:"node_in",name:"lQ",qualifier:["float"],is_optional:!1},{type:"node_in",name:"lR",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"lS",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"lT",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"eZ = clamp ( lQ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; eY = UNITY_VALUE_NODES - eZ ; lS += step ( lS , vec3 ( ZERO_VALUE_NODES ) ) ; lT = eY * lR + eZ * lR / lS ;".split(" ")},
{type:"node_condition",parts:[{type:"node_if",expression:["MIX_RGB_USE_CLAMP"],statements:[{type:"textline",tokens:"lT = clamp ( lT , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_DIFFERENCE",declarations:[{type:"node_in",name:"lU",qualifier:["float"],is_optional:!1},{type:"node_in",name:"lV",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"lW",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"lX",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",
tokens:"eZ = clamp ( lU , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; lX = mix ( lV , abs ( lV - lW ) , eZ ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MIX_RGB_USE_CLAMP"],statements:[{type:"textline",tokens:"lX = clamp ( lX , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_DARKEN",declarations:[{type:"node_in",name:"lY",qualifier:["float"],is_optional:!1},{type:"node_in",name:"lZ",qualifier:["vec3"],is_optional:!1},{type:"node_in",
name:"l_",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"ma",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"eZ = clamp ( lY , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; ma = min ( lZ . rgb , l_ . rgb * eZ ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MIX_RGB_USE_CLAMP"],statements:[{type:"textline",tokens:"ma = clamp ( ma , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_LIGHTEN",declarations:[{type:"node_in",
name:"mb",qualifier:["float"],is_optional:!1},{type:"node_in",name:"mc",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"md",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"me",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"eZ = clamp ( mb , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; me = max ( mc . rgb , md . rgb * eZ ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MIX_RGB_USE_CLAMP"],statements:[{type:"textline",tokens:"me = clamp ( me , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MIX_RGB_OVERLAY",declarations:[{type:"node_in",name:"mf",qualifier:["float"],is_optional:!1},{type:"node_in",name:"mg",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"mh",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"mi",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"eZ = clamp ( mf , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; fk = vec3 ( UNITY_VALUE_NODES - eZ ) ; mi = mix ( mg * ( fk + 2.0 * eZ * mh ) , vec3 ( UNITY_VALUE_NODES ) - ( fk + 2.0 * eZ * ( vec3 ( UNITY_VALUE_NODES ) - mh ) ) * ( vec3 ( UNITY_VALUE_NODES ) - mg ) , step ( eh , mg ) ) ;".split(" ")},
{type:"node_condition",parts:[{type:"node_if",expression:["MIX_RGB_USE_CLAMP"],statements:[{type:"textline",tokens:"mi = clamp ( mi , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_DODGE",declarations:[{type:"node_in",name:"mj",qualifier:["float"],is_optional:!1},{type:"node_in",name:"mk",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"ml",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"mm",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",
tokens:"eZ = clamp ( mj , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; fk = vec3 ( UNITY_VALUE_NODES ) - eZ * ml ; fj = clamp ( mk / fk , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; mm = mix ( mix ( fj , vec3 ( UNITY_VALUE_NODES ) , step ( fk , vec3 ( ZERO_VALUE_NODES ) ) ) , mk , step ( mk , vec3 ( ZERO_VALUE_NODES ) ) ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MIX_RGB_USE_CLAMP"],statements:[{type:"textline",tokens:"mm = clamp ( mm , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MIX_RGB_BURN",declarations:[{type:"node_in",name:"mn",qualifier:["float"],is_optional:!1},{type:"node_in",name:"mo",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"mp",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"mq",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"eZ = clamp ( mn , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; fk = vec3 ( UNITY_VALUE_NODES - eZ ) ; fk = fk + eZ * mp ; fj = clamp ( vec3 ( UNITY_VALUE_NODES ) - ( vec3 ( UNITY_VALUE_NODES ) - mo ) / fk , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; mq = mix ( fj , vec3 ( ZERO_VALUE_NODES ) , step ( fk , vec3 ( ZERO_VALUE_NODES ) ) ) ;".split(" ")},
{type:"node_condition",parts:[{type:"node_if",expression:["MIX_RGB_USE_CLAMP"],statements:[{type:"textline",tokens:"mq = clamp ( mq , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_HUE",declarations:[{type:"node_in",name:"mr",qualifier:["float"],is_optional:!1},{type:"node_in",name:"ms",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"mt",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"mu",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",
tokens:"eZ = clamp ( mr , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; mu = ms ; fj = eq ( mt ) ; if ( fj . y != ZERO_VALUE_NODES ) { fk = eq ( mu ) ; fk . x = fj . x ; fl = eu ( fk ) ; mu = mix ( mu , fl , eZ ) ; }".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MIX_RGB_USE_CLAMP"],statements:[{type:"textline",tokens:"mu = clamp ( mu , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_SATURATION",declarations:[{type:"node_in",name:"mv",qualifier:["float"],
is_optional:!1},{type:"node_in",name:"mw",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"mx",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"my",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"eZ = clamp ( mv , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; eY = UNITY_VALUE_NODES - eZ ; my = mw ; fl = eq ( my ) ; if ( fl . y != ZERO_VALUE_NODES ) { fk = eq ( mx ) ; fl . y = eY * fl . y + eZ * fk . y ; my = eu ( fl ) ; }".split(" ")},{type:"node_condition",parts:[{type:"node_if",
expression:["MIX_RGB_USE_CLAMP"],statements:[{type:"textline",tokens:"my = clamp ( my , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_VALUE",declarations:[{type:"node_in",name:"mz",qualifier:["float"],is_optional:!1},{type:"node_in",name:"mA",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"mB",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"mC",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"eZ = clamp ( mz , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; eY = UNITY_VALUE_NODES - eZ ; fl = eq ( mA ) ; fk = eq ( mB ) ; fl . z = eY * fl . z + eZ * fk . z ; mC = eu ( fl ) ;".split(" ")},
{type:"node_condition",parts:[{type:"node_if",expression:["MIX_RGB_USE_CLAMP"],statements:[{type:"textline",tokens:"mC = clamp ( mC , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_COLOR",declarations:[{type:"node_in",name:"mD",qualifier:["float"],is_optional:!1},{type:"node_in",name:"mE",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"mF",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"mG",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",
tokens:"eZ = clamp ( mD , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; mG = mE ; fk = eq ( mF ) ; if ( fk . y != ZERO_VALUE_NODES ) { fl = eq ( mG ) ; fl . x = fk . x ; fl . y = fk . y ; fj = eu ( fl ) ; mG = mix ( mG , fj , eZ ) ; }".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MIX_RGB_USE_CLAMP"],statements:[{type:"textline",tokens:"mG = clamp ( mG , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_SOFT_LIGHT",declarations:[{type:"node_in",
name:"mH",qualifier:["float"],is_optional:!1},{type:"node_in",name:"mI",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"mJ",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"mK",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"eZ = clamp ( mH , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; eY = UNITY_VALUE_NODES - eZ ; fj = mJ + mI - mJ * mI ; mK = mI * ( vec3 ( eY ) + vec3 ( eZ ) * ( ( vec3 ( UNITY_VALUE_NODES ) - mI ) * mJ + fj ) ) ;".split(" ")},{type:"node_condition",
parts:[{type:"node_if",expression:["MIX_RGB_USE_CLAMP"],statements:[{type:"textline",tokens:"mK = clamp ( mK , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_LINEAR_LIGHT",declarations:[{type:"node_in",name:"mL",qualifier:["float"],is_optional:!1},{type:"node_in",name:"mM",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"mN",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"mO",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",
tokens:"eZ = clamp ( mL , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; mO = mM + eZ * ( 2.0 * mN - vec3 ( UNITY_VALUE_NODES ) ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MIX_RGB_USE_CLAMP"],statements:[{type:"textline",tokens:"mO = clamp ( mO , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"OUTPUT",declarations:[{type:"node_in",name:"mP",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"mQ",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",
tokens:"eO = mP ; eS = mQ ;".split(" ")}]},{type:"node",name:"MATERIAL_BEGIN",declarations:[{type:"node_in",name:"mR",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"mS",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"mT",qualifier:["float"],is_optional:!1},{type:"node_in",name:"mU",qualifier:["vec3"],is_optional:!0},{type:"node_in",name:"mV",qualifier:["float"],is_optional:!0},{type:"node_out",name:"mW",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"mX",qualifier:["vec3"],
is_optional:!1},{type:"node_out",name:"mY",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"mZ",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"m_",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"na",qualifier:["vec2"],is_optional:!1},{type:"node_out",name:"nb",qualifier:["vec2"],is_optional:!1},{type:"node_out",name:"nc",qualifier:["vec4"],is_optional:!1},{type:"node_param",name:"eI",qualifier:["const","vec2"]},{type:"node_param",name:"eJ",qualifier:["const","vec3"]}],
statements:[{type:"textline",tokens:"mY = clamp ( mR , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},{type:"textline",tokens:"mZ = eJ [ 0 ] * clamp ( mS , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["USE_MATERIAL_NORMAL"],statements:[{type:"textline",tokens:"m_ = normalize ( mU ) ;".split(" ")}]},{type:"node_else",statements:[{type:"textline",tokens:["m_","=","fi",";"]}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["SHADELESS_MAT",
{type:"logic_negative_expr",places:1}],statements:[{type:"node_condition",parts:[{type:"node_if",expression:["MATERIAL_EXT"],statements:[{type:"textline",tokens:"mW = mV * mY ;".split(" ")}]},{type:"node_else",statements:[{type:"textline",tokens:"mW = eV * mY ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_MATERIAL_DIFFUSE"],statements:[{type:"textline",tokens:["mY","*=","mT",";"]}]}]},{type:"textline",tokens:"mX = eW * u_environment_energy * dS ( m_ ) ; nc = du ( mY ) ;".split(" ")},
{type:"node_condition",parts:[{type:"node_if",expression:["NUM_LIGHTS",0,{type:"g_expr",places:2}],statements:[{type:"textline",tokens:"na = vec2 ( eI [ 0 ] , eI [ 1 ] ) ;".split(" ")},{type:"textline",tokens:"nb = vec2 ( eJ [ 1 ] , eJ [ 2 ] ) ;".split(" ")}]}]},{type:"textline",tokens:["eR","=","nc",";"]}]},{type:"node_else",statements:[{type:"textline",tokens:"mW = vec3 ( ZERO_VALUE_NODES ) ; mX = vec3 ( UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATERIAL_END",declarations:[{type:"node_in",
name:"nd",qualifier:["vec4"],is_optional:!1},{type:"node_in",name:"ne",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"nf",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"ng",qualifier:["float"],is_optional:!0},{type:"node_in",name:"nh",qualifier:["float"],is_optional:!0},{type:"node_in",name:"ni",qualifier:["float"],is_optional:!0},{type:"node_out",name:"nj",qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"nk",qualifier:["float"],is_optional:!0},{type:"node_out",name:"nl",
qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"nm",qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"nn",qualifier:["vec3"],is_optional:!0},{type:"node_param",name:"eK",qualifier:["float"]},{type:"node_param",name:"eL",qualifier:["float"]}],statements:[{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_nj"],statements:[{type:"node_condition",parts:[{type:"node_if",expression:["USE_MATERIAL_DIFFUSE"],statements:[{type:"textline",tokens:"nj = nd . rgb ;".split(" ")}]},
{type:"node_else",statements:[{type:"textline",tokens:"nj = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["MATERIAL_EXT","REFLECTION_TYPE","REFL_NONE",{type:"non_equal_expr",places:2},{type:"logical_and_expr",places:2}],statements:[{type:"node_condition",parts:[{type:"node_if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2}],statements:[{type:"textline",tokens:"dP ( nj , eM , nf , ng , eN ) ;".split(" ")}]},{type:"node_else",
statements:[{type:"textline",tokens:"dP ( nj , eM , nf , ng , mat4 ( ZERO_VALUE_NODES ) ) ;".split(" ")}]}]}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_MATERIAL_SPECULAR"],statements:[{type:"textline",tokens:["nj","+=","ne",";"]}]}]}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_nl"],statements:[{type:"textline",tokens:["nl","=","nf",";"]}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["MATERIAL_EXT"],statements:[{type:"node_condition",
parts:[{type:"node_if",expression:["USE_OUT_nm"],statements:[{type:"textline",tokens:"nm = nd . rgb ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_nn"],statements:[{type:"textline",tokens:["nn","=","ne",";"]}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_nk"],statements:[{type:"textline",tokens:"nk = clamp ( ni , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["USE_MATERIAL_SPECULAR"],
statements:[{type:"textline",tokens:"eZ = max ( max ( ne . r , ne . g ) , ne . b ) * nh ; nk = clamp ( ni * ( UNITY_VALUE_NODES - eZ ) + eZ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]}]}]},{type:"node_else",statements:[{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_nk"],statements:[{type:"textline",tokens:"nk = clamp ( eK , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["USE_MATERIAL_SPECULAR"],statements:[{type:"textline",
tokens:"eZ = max ( max ( ne . r , ne . g ) , ne . b ) * eL ; nk = eK * ( UNITY_VALUE_NODES - eZ ) + eZ ;".split(" ")}]}]}]}]}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_MATERIAL_SPECULAR"],statements:[{type:"textline",tokens:["eP","=","ne",";"]}]},{type:"node_else",statements:[{type:"textline",tokens:"eP = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",tokens:["eQ","=","nf",";"]}]},{type:"node",name:"LIGHTING_AMBIENT",declarations:[{type:"node_in",name:"no",
qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"np",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"nq",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"nr",qualifier:["vec4"],is_optional:!1},{type:"node_out",name:"ns",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"nr = vec4 ( no + nq * np , ZERO_VALUE_NODES ) ; ns = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"LIGHTING_LAMP",declarations:[{type:"node_in",name:"nt",qualifier:["vec4"],
is_optional:!1},{type:"node_out",name:"nu",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"nv",qualifier:["vec2"],is_optional:!1},{type:"node_out",name:"nw",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"nx",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"nv = u_light_factors [ LAMP_LIGHT_FACT_IND ] . LAMP_FAC_CHANNELS ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["LAMP_TYPE","HEMI",{type:"equal_expr",places:2}],statements:[{type:"textline",
tokens:["nx","=","eh",";"]}]},{type:"node_else",statements:[{type:"textline",tokens:["nx","=","ZERO_VALUE_NODES",";"]}]}]},{type:"textline",tokens:"nw = u_light_color_intensities [ LAMP_IND ] ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["LAMP_SHADOW_MAP_IND",1,{type:"negative_expr",places:1},{type:"non_equal_expr",places:2}],statements:[{type:"textline",tokens:"nw *= nt [ LAMP_SHADOW_MAP_IND ] ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["LAMP_TYPE",
"SPOT",{type:"equal_expr",places:2},"LAMP_TYPE","POINT",{type:"equal_expr",places:2},{type:"logical_or_expr",places:2}],statements:[{type:"textline",tokens:"fj = u_light_positions [ LAMP_IND ] ; nu = fj - fh ;".split(" ")},{type:"textline",tokens:"eZ = length ( nu ) ; nw *= LAMP_LIGHT_DIST / ( LAMP_LIGHT_DIST + eZ * eZ ) ; nu = normalize ( nu ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["LAMP_TYPE","SPOT",{type:"equal_expr",places:2}],statements:[{type:"textline",tokens:"fj = u_light_directions [ LAMP_IND ] ; eZ = dot ( nu , fj ) ; eZ *= smoothstep ( ZERO_VALUE_NODES , UNITY_VALUE_NODES , ( eZ - LAMP_SPOT_SIZE ) / LAMP_SPOT_BLEND ) ; nw *= eZ ;".split(" ")}]}]}]},
{type:"node_else",statements:[{type:"textline",tokens:"nu = u_light_directions [ LAMP_IND ] ;".split(" ")}]}]}]},{type:"node",name:"DIFFUSE_FRESNEL",declarations:[{type:"node_in",name:"ny",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"nz",qualifier:["vec2"],is_optional:!1},{type:"node_in",name:"nA",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"nB",qualifier:["float"],is_optional:!1},{type:"node_in",name:"nC",qualifier:["vec2"],is_optional:!1},{type:"node_out",name:"nD",qualifier:["float"],
is_optional:!1}],statements:[{type:"textline",tokens:"nD = ZERO_VALUE_NODES ; if ( nz . r != ZERO_VALUE_NODES ) { eZ = ( UNITY_VALUE_NODES - nB ) * dot ( nA , ny ) + nB ; if ( nC [ 0 ] == ZERO_VALUE_NODES ) { nD = UNITY_VALUE_NODES ; } else { eZ = UNITY_VALUE_NODES + abs ( eZ ) ; eZ = nC [ 1 ] + ( UNITY_VALUE_NODES - nC [ 1 ] ) * pow ( eZ , nC [ 0 ] ) ; nD = clamp ( eZ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; } nD = max ( nD , ZERO_VALUE_NODES ) ; }".split(" ")}]},{type:"node",name:"DIFFUSE_LAMBERT",
declarations:[{type:"node_in",name:"nE",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"nF",qualifier:["vec2"],is_optional:!1},{type:"node_in",name:"nG",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"nH",qualifier:["float"],is_optional:!1},{type:"node_out",name:"nI",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"nI = ZERO_VALUE_NODES ; if ( nF . r != ZERO_VALUE_NODES ) { eZ = ( UNITY_VALUE_NODES - nH ) * dot ( nG , nE ) + nH ; nI = max ( eZ , ZERO_VALUE_NODES ) ; }".split(" ")}]},
{type:"node",name:"DIFFUSE_OREN_NAYAR",declarations:[{type:"node_in",name:"nJ",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"nK",qualifier:["vec2"],is_optional:!1},{type:"node_in",name:"nL",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"nM",qualifier:["float"],is_optional:!1},{type:"node_in",name:"nN",qualifier:["vec2"],is_optional:!1},{type:"node_out",name:"nO",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"nO = ZERO_VALUE_NODES ; if ( nK . r != ZERO_VALUE_NODES ) { eZ = ( UNITY_VALUE_NODES - nM ) * dot ( nL , nJ ) + nM ; if ( nN [ 0 ] > ZERO_VALUE_NODES ) { eY = max ( dot ( nL , eM ) , ZERO_VALUE_NODES ) ; eX = nN [ 0 ] * nN [ 0 ] ; e_ = UNITY_VALUE_NODES - eh * ( eX / ( eX + 0.33 ) ) ; fj = nJ - eZ * nL ; fl = eM - eY * nL ;".split(" ")},
{type:"textline",tokens:"if ( length ( fj ) == ZERO_VALUE_NODES || length ( fl ) == ZERO_VALUE_NODES || abs ( eZ ) > UNITY_VALUE_NODES || abs ( eY ) > UNITY_VALUE_NODES )".split(" ")},{type:"textline",tokens:"nO = eZ * e_ ; else { fa = acos ( eZ ) ; eY = acos ( eY ) ; fj = normalize ( fj ) ; fl = normalize ( fl ) ; fb = max ( fa , eY ) ; fc = min ( fa , eY ) ; fc *= 0.95 ; eY = max ( dot ( fj , fl ) , ZERO_VALUE_NODES ) ; eX = 0.45 * ( eX / ( eX + 0.09 ) ) ; nO = eZ * ( e_ + ( eX * eY * sin ( fb ) * tan ( fc ) ) ) ; } } else nO = eZ ; nO = max ( nO , ZERO_VALUE_NODES ) ; }".split(" ")}]},
{type:"node",name:"DIFFUSE_MINNAERT",declarations:[{type:"node_in",name:"nP",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"nQ",qualifier:["vec2"],is_optional:!1},{type:"node_in",name:"nR",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"nS",qualifier:["float"],is_optional:!1},{type:"node_in",name:"nT",qualifier:["vec2"],is_optional:!1},{type:"node_out",name:"nU",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"nU = ZERO_VALUE_NODES ; if ( nQ . r != ZERO_VALUE_NODES ) { eZ = ( UNITY_VALUE_NODES - nS ) * dot ( nR , nP ) + nS ; fc = max ( dot ( nR , eM ) , ZERO_VALUE_NODES ) ; if ( nT [ 0 ] <= UNITY_VALUE_NODES ) nU = eZ * pow ( max ( fc * eZ , 0.1 ) , nT [ 0 ] - UNITY_VALUE_NODES ) ; else nU = eZ * pow ( 1.0001 - fc , nT [ 0 ] - UNITY_VALUE_NODES ) ; nU = max ( nU , ZERO_VALUE_NODES ) ; }".split(" ")}]},
{type:"node",name:"DIFFUSE_TOON",declarations:[{type:"node_in",name:"nV",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"nW",qualifier:["vec2"],is_optional:!1},{type:"node_in",name:"nX",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"nY",qualifier:["float"],is_optional:!1},{type:"node_in",name:"nZ",qualifier:["vec2"],is_optional:!1},{type:"node_out",name:"n_",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"n_ = ZERO_VALUE_NODES ; if ( nW . r != ZERO_VALUE_NODES ) { fc = ( UNITY_VALUE_NODES - nY ) * dot ( nX , nV ) + nY ; fc = acos ( fc ) ; if ( fc < nZ [ 0 ] ) n_ = UNITY_VALUE_NODES ; else if ( fc > ( nZ [ 0 ] + nZ [ 1 ] ) || nZ [ 1 ] == ZERO_VALUE_NODES ) n_ = ZERO_VALUE_NODES ; else n_ = UNITY_VALUE_NODES - ( ( fc - nZ [ 0 ] ) / nZ [ 1 ] ) ; n_ = max ( n_ , ZERO_VALUE_NODES ) ; }".split(" ")}]},
{type:"node",name:"SPECULAR_PHONG",declarations:[{type:"node_in",name:"oa",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"ob",qualifier:["vec2"],is_optional:!1},{type:"node_in",name:"oc",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"od",qualifier:["float"],is_optional:!1},{type:"node_in",name:"oe",qualifier:["vec2"],is_optional:!1},{type:"node_out",name:"of",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"of = ZERO_VALUE_NODES ; if ( ob . g == UNITY_VALUE_NODES ) { fl = normalize ( oa + eM ) ; of = ( UNITY_VALUE_NODES - od ) * max ( dot ( oc , fl ) , ZERO_VALUE_NODES ) + od ; of = pow ( of , oe [ 0 ] ) ; }".split(" ")}]},
{type:"node",name:"SPECULAR_WARDISO",declarations:[{type:"node_in",name:"og",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"oh",qualifier:["vec2"],is_optional:!1},{type:"node_in",name:"oi",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"oj",qualifier:["vec2"],is_optional:!1},{type:"node_out",name:"ok",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"ok = ZERO_VALUE_NODES ; if ( oh . g == UNITY_VALUE_NODES ) { fl = normalize ( og + eM ) ; fc = max ( dot ( oi , fl ) , 0.001 ) ;".split(" ")},
{type:"textline",tokens:"eZ = max ( dot ( oi , eM ) , 0.01 ) ; fb = max ( dot ( oi , og ) , 0.01 ) ; fc = tan ( acos ( fc ) ) ; eY = max ( oj [ 0 ] , 0.001 ) ; ok = fb * ( UNITY_VALUE_NODES / ( 4.0 * M_PI * eY * eY ) ) * ( exp ( - ( fc * fc ) / ( eY * eY ) ) / ( sqrt ( eZ * fb ) ) ) ; }".split(" ")}]},{type:"node",name:"SPECULAR_TOON",declarations:[{type:"node_in",name:"ol",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"om",qualifier:["vec2"],is_optional:!1},{type:"node_in",name:"on",qualifier:["vec3"],
is_optional:!1},{type:"node_in",name:"oo",qualifier:["vec2"],is_optional:!1},{type:"node_out",name:"op",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"op = ZERO_VALUE_NODES ; if ( om . g == UNITY_VALUE_NODES ) { fl = normalize ( ol + eM ) ; fb = acos ( dot ( fl , on ) ) ; if ( fb < oo [ 0 ] ) op = UNITY_VALUE_NODES ; else if ( fb >= oo [ 0 ] + oo [ 1 ] || oo [ 1 ] == ZERO_VALUE_NODES ) op = ZERO_VALUE_NODES ; else op = UNITY_VALUE_NODES - ( fb - oo [ 0 ] ) / oo [ 1 ] ; }".split(" ")}]},
{type:"node",name:"SPECULAR_BLINN",declarations:[{type:"node_in",name:"oq",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"or",qualifier:["vec2"],is_optional:!1},{type:"node_in",name:"os",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"ot",qualifier:["float"],is_optional:!1},{type:"node_in",name:"ou",qualifier:["vec2"],is_optional:!1},{type:"node_out",name:"ov",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"ov = ZERO_VALUE_NODES ; if ( or . g == UNITY_VALUE_NODES ) { if ( ou [ 0 ] < UNITY_VALUE_NODES || ou [ 1 ] == ZERO_VALUE_NODES ) ov = ZERO_VALUE_NODES ; else { if ( ou [ 1 ] < 100.0 ) ou [ 1 ] = sqrt ( UNITY_VALUE_NODES / ou [ 1 ] ) ; else ou [ 1 ] = 10.0 / ou [ 1 ] ; fl = normalize ( eM + oq ) ; fb = ( UNITY_VALUE_NODES - ot ) * max ( dot ( os , fl ) , ZERO_VALUE_NODES ) + ot ; if ( fb < ZERO_VALUE_NODES ) ov = ZERO_VALUE_NODES ; else { eZ = max ( dot ( os , eM ) , 0.01 ) ; eY = dot ( os , oq ) ; if ( eY <= 0.01 ) ov = ZERO_VALUE_NODES ; else { fc = max ( dot ( eM , fl ) , 0.01 ) ; eX = UNITY_VALUE_NODES ; eZ = ( 2.0 * fb * eZ ) / fc ; eY = ( 2.0 * fb * eY ) / fc ; eY = min ( min ( eX , eZ ) , eY ) ; eZ = sqrt ( pow ( ou [ 0 ] , 2.0 ) + pow ( fc , 2.0 ) - UNITY_VALUE_NODES ) ; fc = pow ( eZ - fc , 2.0 ) / pow ( eZ + fc , 2.0 ) * ( UNITY_VALUE_NODES + pow ( fc * ( eZ + fc ) - UNITY_VALUE_NODES , 2.0 ) / pow ( fc * ( eZ - fc ) + UNITY_VALUE_NODES , 2.0 ) ) ; fb = acos ( fb ) ; ov = max ( fc * eY * exp ( - pow ( fb , 2.0 ) / ( 2.0 * pow ( ou [ 1 ] , 2.0 ) ) ) , ZERO_VALUE_NODES ) ; } } } }".split(" ")}]},
{type:"node",name:"LIGHTING_APPLY",declarations:[{type:"node_in",name:"ow",qualifier:["vec4"],is_optional:!1},{type:"node_in",name:"ox",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"oy",qualifier:["float"],is_optional:!1},{type:"node_in",name:"oz",qualifier:["float"],is_optional:!1},{type:"node_in",name:"oA",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"oB",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"oC",qualifier:["vec4"],is_optional:!1},{type:"node_in",name:"oD",
qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"oE",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"oF",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"oG",qualifier:["float"],is_optional:!1},{type:"node_out",name:"oH",qualifier:["vec4"],is_optional:!1},{type:"node_out",name:"oI",qualifier:["vec3"],is_optional:!1}],statements:[{type:"node_condition",parts:[{type:"node_if",expression:["USE_NODE_B4W_TRANSLUCENCY"],statements:[{type:"textline",tokens:"if ( dot ( oA , oB ) * dot ( eM , oB ) < ZERO_VALUE_NODES ) { fb = oC . x ; eY = oC . y ; fc = oC . z ; eZ = oC . w ;".split(" ")},
{type:"textline",tokens:"eX = clamp ( abs ( dot ( oA , oB ) ) , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; e_ = clamp ( dot ( eM , - oA ) , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; eY = pow ( e_ , eY ) ;".split(" ")},{type:"textline",tokens:"oH = ow + oG * vec4 ( oF * eX * pow ( oD , vec3 ( fb ) ) , UNITY_VALUE_NODES ) ;".split(" ")},{type:"textline",tokens:"oH += fc * mix ( vec4 ( oD , UNITY_VALUE_NODES ) , vec4 ( UNITY_VALUE_NODES ) , eZ ) * oG * vec4 ( oF * eX * vec3 ( eY ) , UNITY_VALUE_NODES ) ; oI = ox ; } else {".split(" ")},
{type:"textline",tokens:"oI = ox + oF * oE * oz ; oH = ow + vec4 ( oF * oD * oy , oz ) ; }".split(" ")}]},{type:"node_else",statements:[{type:"textline",tokens:"oI = ox + oF * oE * oz ; oH = ow + vec4 ( oF * oD * oy , oz ) ;".split(" ")}]}]}]},{type:"node",name:"RGB",declarations:[{type:"node_out",name:"oJ",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"oJ = u_node_rgbs [ RGB_IND ] ;".split(" ")}]},{type:"node",name:"RGBTOBW",declarations:[{type:"node_in",name:"oK",qualifier:["vec3"],
is_optional:!1},{type:"node_out",name:"oL",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"oL = dot ( oK , vec3 ( 0.35 , 0.45 , 0.2 ) ) ;".split(" ")}]},{type:"node",name:"SEPRGB",declarations:[{type:"node_in",name:"oM",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"oN",qualifier:["float"],is_optional:!0},{type:"node_out",name:"oO",qualifier:["float"],is_optional:!0},{type:"node_out",name:"oP",qualifier:["float"],is_optional:!0}],statements:[{type:"node_condition",
parts:[{type:"node_if",expression:["USE_OUT_oN"],statements:[{type:"textline",tokens:"oN = oM . r ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_oO"],statements:[{type:"textline",tokens:"oO = oM . g ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_oP"],statements:[{type:"textline",tokens:"oP = oM . b ;".split(" ")}]}]}]},{type:"node",name:"SEPHSV",declarations:[{type:"node_in",name:"oQ",qualifier:["vec3"],is_optional:!1},
{type:"node_out",name:"oR",qualifier:["float"],is_optional:!0},{type:"node_out",name:"oS",qualifier:["float"],is_optional:!0},{type:"node_out",name:"oT",qualifier:["float"],is_optional:!0}],statements:[{type:"textline",tokens:"fl = eq ( oQ ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_oR"],statements:[{type:"textline",tokens:"oR = fl . r ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_oS"],statements:[{type:"textline",tokens:"oS = fl . g ;".split(" ")}]}]},
{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_oT"],statements:[{type:"textline",tokens:"oT = fl . b ;".split(" ")}]}]}]},{type:"node",name:"SQUEEZE",declarations:[{type:"node_in",name:"oU",qualifier:["float"],is_optional:!1},{type:"node_in",name:"oV",qualifier:["float"],is_optional:!1},{type:"node_in",name:"oW",qualifier:["float"],is_optional:!1},{type:"node_out",name:"oX",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"oX = UNITY_VALUE_NODES / ( UNITY_VALUE_NODES + pow ( 2.71828183 , - ( oU - oW ) * oV ) ) ;".split(" ")}]},
{type:"node",name:"GAMMA",declarations:[{type:"node_in",name:"oY",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"oZ",qualifier:["float"],is_optional:!1},{type:"node_out",name:"o_",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"o_ = oY ; if ( o_ . x > ZERO_VALUE_NODES ) o_ . x = pow ( oY . x , oZ ) ; if ( o_ . y > ZERO_VALUE_NODES ) o_ . y = pow ( oY . y , oZ ) ; if ( o_ . z > ZERO_VALUE_NODES ) o_ . z = pow ( oY . z , oZ ) ;".split(" ")}]},{type:"node",name:"B4W_SRGB_TO_LINEAR",
declarations:[{type:"node_in",name:"pa",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"pb",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"pb = max ( vec3 ( ZERO_VALUE_NODES ) , pa ) ; pb = pow ( pb , vec3 ( 2.2 ) ) ;".split(" ")}]},{type:"node",name:"B4W_LINEAR_TO_SRGB",declarations:[{type:"node_in",name:"pc",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"pd",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"pd = max ( vec3 ( ZERO_VALUE_NODES ) , pc ) ; pd = pow ( pd , vec3 ( UNITY_VALUE_NODES / 2.2 ) ) ;".split(" ")}]},
{type:"node",name:"TEXTURE_EMPTY",declarations:[{type:"node_out",name:"pe",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"pf",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"pg",qualifier:["float"],is_optional:!1}],statements:[{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_pg"],statements:[{type:"textline",tokens:"pe [ 2 ] = pe [ 1 ] = pe [ 0 ] = ZERO_VALUE_NODES ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_pg"],statements:[{type:"textline",
tokens:"pf [ 2 ] = pf [ 1 ] = pf [ 0 ] = ZERO_VALUE_NODES ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_pg"],statements:[{type:"textline",tokens:["pg","=","ZERO_VALUE_NODES",";"]}]}]}]},{type:"node",name:"TEXTURE_ENVIRONMENT",declarations:[{type:"node_in",name:"ph",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"pi",qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"pj",qualifier:["float"],is_optional:!0},{type:"node_param",name:"node_TEXTURE_ENVIRONMENT_var_texture",
qualifier:["uniform","samplerCube"]}],statements:[{type:"textline",tokens:"fe = textureCube ( node_TEXTURE_ENVIRONMENT_var_texture , ph ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_pi"],statements:[{type:"textline",tokens:"pi = fe . xyz ; br ( pi ) ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_pj"],statements:[{type:"textline",tokens:"pj = fe . w ;".split(" ")}]}]}]},{type:"node",name:"TEXTURE_COLOR",declarations:[{type:"node_in",
name:"pk",qualifier:["vec3"],is_optional:!0},{type:"node_in",name:"pl",qualifier:["vec3"],is_optional:!0},{type:"node_in",name:"pm",qualifier:["vec3"],is_optional:!0},{type:"node_in",name:"pn",qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"po",qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"pp",qualifier:["float"],is_optional:!0},{type:"node_out",name:"pq",qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"pr",qualifier:["float"],is_optional:!0},{type:"node_out",name:"ps",
qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"pt",qualifier:["float"],is_optional:!0},{type:"node_out",name:"pu",qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"pv",qualifier:["float"],is_optional:!0},{type:"node_param",name:"node_TEXTURE_COLOR_var_texture",qualifier:["uniform","sampler2D"]}],statements:[{type:"textline",tokens:"fe = texture2D ( node_TEXTURE_COLOR_var_texture , ey ( pk ) ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_po"],
statements:[{type:"textline",tokens:"po = fe . xyz ; br ( po ) ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_pp"],statements:[{type:"textline",tokens:"pp = fe . w ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_uv2"],statements:[{type:"textline",tokens:"fe = texture2D ( node_TEXTURE_COLOR_var_texture , ey ( pl ) ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_pq"],statements:[{type:"textline",
tokens:"pq = fe . xyz ; br ( pq ) ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_pr"],statements:[{type:"textline",tokens:"pr = fe . w ;".split(" ")}]}]}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_uv3"],statements:[{type:"textline",tokens:"fe = texture2D ( node_TEXTURE_COLOR_var_texture , ey ( pm ) ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_ps"],statements:[{type:"textline",tokens:"ps = fe . xyz ; br ( ps ) ;".split(" ")}]}]},
{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_pt"],statements:[{type:"textline",tokens:"pt = fe . w ;".split(" ")}]}]}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_uv4"],statements:[{type:"textline",tokens:"fe = texture2D ( node_TEXTURE_COLOR_var_texture , ey ( pn ) ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_pu"],statements:[{type:"textline",tokens:"pu = fe . xyz ; br ( pu ) ;".split(" ")}]}]},{type:"node_condition",
parts:[{type:"node_if",expression:["USE_OUT_pv"],statements:[{type:"textline",tokens:"pv = fe . w ;".split(" ")}]}]}]}]}]},{type:"node",name:"TEXTURE_NORMAL",declarations:[{type:"node_in",name:"pw",qualifier:["vec3"],is_optional:!0},{type:"node_in",name:"px",qualifier:["vec3"],is_optional:!0},{type:"node_in",name:"py",qualifier:["vec3"],is_optional:!0},{type:"node_in",name:"pz",qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"pA",qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"pB",
qualifier:["float"],is_optional:!0},{type:"node_out",name:"pC",qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"pD",qualifier:["float"],is_optional:!0},{type:"node_out",name:"pE",qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"pF",qualifier:["float"],is_optional:!0},{type:"node_out",name:"pG",qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"pH",qualifier:["float"],is_optional:!0},{type:"node_param",name:"node_TEXTURE_NORMAL_var_texture",qualifier:["uniform","sampler2D"]}],
statements:[{type:"textline",tokens:"fe = texture2D ( node_TEXTURE_NORMAL_var_texture , ey ( pw ) ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_pA"],statements:[{type:"textline",tokens:"pA = normalize ( ff * ( fe . xyz - eh ) ) ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_pB"],statements:[{type:"textline",tokens:"pB = fe . w ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_uv2"],statements:[{type:"textline",
tokens:"fe = texture2D ( node_TEXTURE_NORMAL_var_texture , ey ( px ) ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_pC"],statements:[{type:"textline",tokens:"pC = normalize ( ff * ( fe . xyz - eh ) ) ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_pD"],statements:[{type:"textline",tokens:"pD = fe . w ;".split(" ")}]}]}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_uv3"],statements:[{type:"textline",tokens:"fe = texture2D ( node_TEXTURE_NORMAL_var_texture , ey ( py ) ) ;".split(" ")},
{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_pE"],statements:[{type:"textline",tokens:"pE = normalize ( ff * ( fe . xyz - eh ) ) ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_pF"],statements:[{type:"textline",tokens:"pF = fe . w ;".split(" ")}]}]}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_uv4"],statements:[{type:"textline",tokens:"fe = texture2D ( node_TEXTURE_NORMAL_var_texture , ey ( pz ) ) ;".split(" ")},{type:"node_condition",
parts:[{type:"node_if",expression:["USE_OUT_pG"],statements:[{type:"textline",tokens:"pG = normalize ( ff * ( fe . xyz - eh ) ) ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_pH"],statements:[{type:"textline",tokens:"pH = fe . w ;".split(" ")}]}]}]}]}]},{type:"node",name:"VALUE",declarations:[{type:"node_out",name:"pI",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"pI = u_node_values [ VALUE_IND ] ;".split(" ")}]},{type:"node",name:"VECT_MATH_ADD",
declarations:[{type:"node_in",name:"pJ",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"pK",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"pL",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"pM",qualifier:["float"],is_optional:!0}],statements:[{type:"textline",tokens:"pL = pJ + pK ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_pM"],statements:[{type:"textline",tokens:"pM = ( abs ( pL [ 0 ] ) + abs ( pL [ 1 ] ) + abs ( pL [ 2 ] ) ) / 3.0 ;".split(" ")}]}]}]},
{type:"node",name:"VECT_MATH_SUBTRACT",declarations:[{type:"node_in",name:"pN",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"pO",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"pP",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"pQ",qualifier:["float"],is_optional:!0}],statements:[{type:"textline",tokens:"pP = pN - pO ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_pQ"],statements:[{type:"textline",tokens:"pQ = ( abs ( pP [ 0 ] ) + abs ( pP [ 1 ] ) + abs ( pP [ 2 ] ) ) / 3.0 ;".split(" ")}]}]}]},
{type:"node",name:"VECT_MATH_AVERAGE",declarations:[{type:"node_in",name:"pR",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"pS",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"pT",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"pU",qualifier:["float"],is_optional:!0}],statements:[{type:"textline",tokens:"pT = pR + pS ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_pU"],statements:[{type:"textline",tokens:"pU = length ( pT ) ;".split(" ")}]}]},
{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_pT"],statements:[{type:"textline",tokens:"pT = normalize ( pT ) ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_DOT_PRODUCT",declarations:[{type:"node_in",name:"pV",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"pW",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"pX",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"pY",qualifier:["float"],is_optional:!0}],statements:[{type:"textline",tokens:"pX = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")},
{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_pY"],statements:[{type:"textline",tokens:"pY = dot ( pV , pW ) ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_CROSS_PRODUCT",declarations:[{type:"node_in",name:"pZ",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"p_",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"qa",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"qb",qualifier:["float"],is_optional:!0}],statements:[{type:"textline",tokens:"qa = cross ( pZ , p_ ) ;".split(" ")},
{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_qb"],statements:[{type:"textline",tokens:"qb = length ( qa ) ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_NORMALIZE",declarations:[{type:"node_in",name:"qc",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"qd",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"qe",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"qf",qualifier:["float"],is_optional:!0}],statements:[{type:"textline",tokens:"qe = normalize ( qc ) ;".split(" ")},
{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_qf"],statements:[{type:"textline",tokens:"qf = length ( qc ) ;".split(" ")}]}]},{type:"textline",tokens:["qd",";"]}]},{type:"node",name:"B4W_REFLECT",declarations:[{type:"node_in",name:"qg",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"qh",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"qi",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"qi = reflect ( - qg , qh ) ;".split(" ")}]},{type:"node",
name:"B4W_PARALLAX",declarations:[{type:"node_in",name:"qj",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"qk",qualifier:["float"],is_optional:!1},{type:"node_in",name:"ql",qualifier:["const","float"],is_optional:!1},{type:"node_in",name:"qm",qualifier:["const","float"],is_optional:!1},{type:"node_out",name:"qn",qualifier:["vec3"],is_optional:!1},{type:"node_param",name:"node_B4W_PARALLAX_var_texture",qualifier:["uniform","sampler2D"]}],statements:[{type:"textline",tokens:"eY = length ( fd ) ; if ( eY < qm ) { eT = ey ( qj ) ; eY = clamp ( eh * ( qm - eY ) , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; eY = qk * eY ;".split(" ")},
{type:"textline",tokens:"fl = normalize ( eM * ff ) ;".split(" ")},{type:"textline",tokens:"eX = UNITY_VALUE_NODES / ql ;".split(" ")},{type:"textline",tokens:"eU = fl . xy * eY / ( ql * fl . z ) ; eY = UNITY_VALUE_NODES ; eZ = texture2D ( node_B4W_PARALLAX_var_texture , eT ) . a ;".split(" ")},{type:"textline",tokens:"for ( float qo = 1.0 ; qo <= ql ; qo ++ ) { if ( eZ < eY ) { eY -= eX ; eT -= eU ; eZ = texture2D ( node_B4W_PARALLAX_var_texture , eT ) . a ; } }".split(" ")},{type:"textline",tokens:"eU = eT + eU ; eX = texture2D ( node_B4W_PARALLAX_var_texture , eU ) . a - ( eY + eX ) ; eY = eZ - eY ; eX = eY / ( eY - eX ) ;".split(" ")},
{type:"textline",tokens:"eT = eX * eU + ( UNITY_VALUE_NODES - eX ) * eT ; qn = ew ( eT ) ; } else qn = qj ;".split(" ")}]},{type:"node",name:"B4W_CLAMP",declarations:[{type:"node_in",name:"qp",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"qq",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"qq = clamp ( qp , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"B4W_REFRACTION",declarations:[{type:"node_in",name:"qr",qualifier:["vec3"],is_optional:!1},
{type:"node_in",name:"qs",qualifier:["float"],is_optional:!1},{type:"node_out",name:"qt",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"qt = el ( qr , qs ) ;".split(" ")}]},{type:"node",name:"B4W_TRANSLUCENCY",declarations:[{type:"node_in",name:"qu",qualifier:["float"],is_optional:!1},{type:"node_in",name:"qv",qualifier:["float"],is_optional:!1},{type:"node_in",name:"qw",qualifier:["float"],is_optional:!1},{type:"node_in",name:"qx",qualifier:["float"],is_optional:!1},{type:"node_in",
name:"qy",qualifier:["float"],is_optional:!1},{type:"node_out",name:"qz",qualifier:["float"],is_optional:!0},{type:"node_out",name:"qA",qualifier:["vec4"],is_optional:!0}],statements:[{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_qz"],statements:[{type:"textline",tokens:["qz","=","qu",";"]}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_qA"],statements:[{type:"textline",tokens:"qA = vec4 ( qv , qw , qx , qy ) ;".split(" ")}]}]}]},{type:"node",name:"B4W_TIME",
declarations:[{type:"node_out",name:"qB",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:["qB","=","u_time",";"]}]},{type:"node",name:"B4W_SMOOTHSTEP",declarations:[{type:"node_in",name:"qC",qualifier:["float"],is_optional:!1},{type:"node_in",name:"qD",qualifier:["float"],is_optional:!1},{type:"node_in",name:"qE",qualifier:["float"],is_optional:!1},{type:"node_out",name:"qF",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"qF = smoothstep ( qD , qE , qC ) ;".split(" ")}]},
{type:"node",name:"B4W_GLOW_OUTPUT",declarations:[{type:"node_in",name:"qG",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"qH",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"eO = qG ; eS = qH ;".split(" ")}]},{type:"node",name:"B4W_VECTOSCAL",declarations:[{type:"node_in",name:"qI",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"qJ",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"qJ = ( qI . r + qI . g + qI . b ) / 3.0 ;".split(" ")}]},
{type:"node",name:"B4W_SCALTOVEC",declarations:[{type:"node_in",name:"qK",qualifier:["float"],is_optional:!1},{type:"node_out",name:"qL",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"qL [ 0 ] = qK ; qL [ 1 ] = qK ; qL [ 2 ] = qK ;".split(" ")}]},{type:"nodes_global"},{type:"textline",tokens:"void qM ( in vec3 eM , in mat4 eN , out vec3 eO , out vec3 eP , out vec3 eQ , out vec4 eR , out float eS ) { vec2 eT , eU ; float eV , eW , eX , eY , eZ , e_ , fa , fb , fc ; vec4 fd , fe ; mat3 ff ; vec3 fg , fh , fi , fj , fk , fl ; eO = vec3 ( ZERO_VALUE_NODES ) ; eP = vec3 ( ZERO_VALUE_NODES ) ; eQ = vec3 ( ZERO_VALUE_NODES ) ; eR = vec4 ( ZERO_VALUE_NODES ) ; eS = ZERO_VALUE_NODES ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","USE_NODE_TEX_COORD_NO",{type:"logical_or_expr",places:5}],group:{type:"group",parts:[{type:"textline",tokens:"fg = normalize ( bE ) ; fh = fg ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["DOUBLE_SIDED_LIGHTING","USE_NODE_GEOMETRY_NO",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["INVERT_FRONTFACING"],
group:{type:"group",parts:[{type:"textline",tokens:["if","(","!","gl_FrontFacing",")"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["if","(","gl_FrontFacing",")"]}]}}]},{type:"textline",tokens:"fh = fh ; else fh = - fh ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["DOUBLE_SIDED_LIGHTING"],group:{type:"group",parts:[{type:"textline",tokens:["fi","=","fh",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["fi","=","fg",";"]}]}}]},
{type:"condition",parts:[{type:"if",expression:["USE_NODE_GEOMETRY_NO"],group:{type:"group",parts:[{type:"textline",tokens:["fg","=","fh",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["CALC_TBN_SPACE"],group:{type:"group",parts:[{type:"textline",tokens:"fj = cross ( fh , bF . xyz ) * bF . w ; ff = mat3 ( bF . xyz , fj , fh ) ; ff = ff ;".split(" ")}]}}]},{type:"textline",tokens:"fh = bC ; fd = bD ; eV = u_emit ; eW = u_ambient ;".split(" ")},{type:"nodes_main"},{type:"textline",
tokens:["}"]}]};a["include/to_world.glslv"]={type:"group",parts:[{type:"define",name:"M_PI",tokens:["3.14159265359"]},{type:"define",name:"MAX_BILLBOARD_ANGLE",tokens:["(","M_PI","/","4.0",")"]},{type:"textline",tokens:"const vec3 qN = vec3 ( 0.0 , 1.0 , 0.0 ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["BILLBOARD_SPHERICAL","BILLBOARD",{type:"logic_negative_expr",places:1},"BILLBOARD_ALIGN","BILLBOARD_ALIGN_VIEW",{type:"equal_expr",places:2},{type:"logical_and_expr",places:2},
{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"mat4 qT ( vec3 qO , mat4 qP ) { vec3 qQ , qR , qS ; qQ = vec3 ( qP [ 0 ] [ 0 ] , qP [ 1 ] [ 0 ] , qP [ 2 ] [ 0 ] ) ; qR = vec3 ( qP [ 0 ] [ 1 ] , qP [ 1 ] [ 1 ] , qP [ 2 ] [ 1 ] ) ; qS = vec3 ( qP [ 0 ] [ 2 ] , qP [ 1 ] [ 2 ] , qP [ 2 ] [ 2 ] ) ; qR = cross ( qS , qQ ) ; qQ = normalize ( qQ ) ; qR = normalize ( qR ) ; qS = normalize ( qS ) ; return mat4 ( vec4 ( qQ , 0.0 ) , vec4 ( qR , 0.0 ) , vec4 ( qS , 0.0 ) , vec4 ( qO , 1.0 ) ) ; }".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"mat4 qZ ( vec3 qU , vec3 qV ) { vec3 qW , qX , qY ; qW = qU - qV ; qW . y = 0.0 ; qX = cross ( qN , qW ) ; qY = cross ( qW , qX ) ; qX = normalize ( qX ) ; qY = normalize ( qY ) ; qW = normalize ( qW ) ; return mat4 ( vec4 ( qX , 0.0 ) , vec4 ( qY , 0.0 ) , vec4 ( qW , 0.0 ) , vec4 ( qV , 1.0 ) ) ; }".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["BILLBOARD_JITTERED"],group:{type:"group",parts:[{type:"textline",tokens:"mat4 rg ( in vec3 q_ , float ra , float rb , float rc , vec3 rd ) { float re , rf ; re = fract ( length ( rd ) / 0.17 ) ; rf = rc + re / 10.0 ; re = re ; if ( rc != 0.0 ) re /= rc ; q_ *= 1.0 + 0.5 * sin ( ra ) ; re = length ( q_ ) * rb * sin ( 2.0 * 3.14 * ra * rf + re ) ; return C ( re ) ; }".split(" ")}]}}]},
{type:"textline",tokens:"mat4 ro ( in vec3 rh , in vec3 ri , in mat4 rj ) { vec3 rk ; float rl , rm ; mat4 rn ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["BILLBOARD_SPHERICAL","BILLBOARD",{type:"logic_negative_expr",places:1},"BILLBOARD_ALIGN","BILLBOARD_ALIGN_VIEW",{type:"equal_expr",places:2},{type:"logical_and_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"rn = qT ( ri , rj ) ;".split(" ")}]}},{type:"elif",expression:["BILLBOARD_RANDOM"],
group:{type:"group",parts:[{type:"textline",tokens:"rl = fract ( ( ri . x * 1.43 + ri . y * 0.123 + ri . z * 6.1 ) ) ; rl = 2.0 * M_PI * rl ; rk = normalize ( vec3 ( rj [ 0 ] [ 2 ] , 0.0 , rj [ 2 ] [ 2 ] ) ) ; rm = acos ( rk [ 2 ] ) ; if ( rk [ 0 ] < 0.0 ) rm = 2.0 * M_PI - rm ; rm = rm - rl ; if ( rm < 0.0 ) rm = 2.0 * M_PI + rm ; rl = rl ; if ( rm <= MAX_BILLBOARD_ANGLE ) rl += rm ; else if ( rm <= M_PI - MAX_BILLBOARD_ANGLE ) rl += MAX_BILLBOARD_ANGLE * ( 2.0 * rm - M_PI ) / ( 2.0 * MAX_BILLBOARD_ANGLE - M_PI ) ; else if ( rm <= M_PI + MAX_BILLBOARD_ANGLE ) rl += rm - M_PI ; else if ( rm <= 2.0 * M_PI - MAX_BILLBOARD_ANGLE ) rl += MAX_BILLBOARD_ANGLE * ( 2.0 * rm - M_PI ) / ( 2.0 * MAX_BILLBOARD_ANGLE - M_PI ) + M_PI ; else rl += rm - 2.0 * M_PI ; rn = A ( rl ) ; rn [ 3 ] = vec4 ( ri , 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"rn = qZ ( rh , ri ) ;".split(" ")}]}}]},{type:"textline",tokens:["return","rn",";","}"]},{type:"condition",parts:[{type:"if",expression:["BILLBOARD_PRES_GLOB_ORIENTATION","STATIC_BATCH",{type:"logic_negative_expr",places:1},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"mat4 ru ( in vec3 rp , in vec3 rq , in mat4 rr , mat4 rs ) { mat4 rt ; rt = ro ( rp , rq , rr ) ; rs [ 3 ] = vec4 ( 0.0 , 0.0 , 0.0 , 1.0 ) ; rt = rt * rs ; return rt ; }".split(" ")}]}}]},
{type:"textline",tokens:"c rB ( in vec3 rv , in vec3 rw , in vec3 rx , in vec3 ry , in vec3 rz , in mat4 rA ) { rv = ( rA * vec4 ( rv , 1.0 ) ) . xyz ; rw = ( rA * vec4 ( rw , 1.0 ) ) . xyz ; rx = ( rA * vec4 ( rx , 0.0 ) ) . xyz ; ry = ( rA * vec4 ( ry , 0.0 ) ) . xyz ; rz = ( rA * vec4 ( rz , 0.0 ) ) . xyz ; return E ( c ( rv , rw , rx , ry , rz , vec3 ( 0.0 ) ) ) ; }".split(" ")}]};a["include/scale_texcoord.glslv"]={type:"group",parts:[{type:"textline",tokens:"vec2 rE ( vec2 rC , vec3 rD ) { return ( rC + 0.5 ) * rD . xy - 0.5 ; }".split(" ")}]};
a["include/skin.glslv"]={type:"group",parts:[{type:"define",name:"SKIN_SLERP",tokens:["0"]},{type:"condition",parts:[{type:"if",expression:["SKINNED"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["SKIN_SLERP"],group:{type:"group",parts:[{type:"textline",tokens:"vec4 rL ( in vec4 rF , in vec4 rG , in float rH ) { float rI , rJ , rK ; rI = rF [ 0 ] * rG [ 0 ] + rF [ 1 ] * rG [ 1 ] + rF [ 2 ] * rG [ 2 ] + rF [ 3 ] * rG [ 3 ] ; if ( rI < 0.0 ) { rG *= - 1.0 ; rI = - rI ; } if ( abs ( rI ) >= 1.0 ) return rF ; rJ = acos ( rI ) ; rI = sqrt ( 1.0 - rI * rI ) ; if ( abs ( rI ) < 0.001 ) return vec4 ( rF * 0.5 + rG * 0.5 ) ; rK = sin ( ( 1.0 - rH ) * rJ ) / rI ; rI = sin ( rH * rJ ) / rI ; return rF * rK + rG * rI ; }".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["FRAMES_BLENDING"],group:{type:"group",parts:[{type:"textline",tokens:"vec3 rX ( in vec3 rM , in vec4 rN , in vec4 rO , in vec4 rP , in vec4 rQ , in float rR ) { vec4 rS , rT ; vec3 rU , rV , rW ; rU = p ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( rM , 1.0 ) ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SKIN_SLERP"],group:{type:"group",parts:[{type:"textline",tokens:"rS = rL ( rN , rO , rR ) ; rT = mix ( rP , rQ , rR ) ; rV = i ( rS , rU ) ; rV = rV * rT . w + rT . xyz ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"rW = i ( rN , rU ) ; rU = i ( rO , rU ) ; rW = rW * rP . w + rP . xyz ; rU = rU * rQ . w + rQ . xyz ; rV = mix ( rW , rU , rR ) ;".split(" ")}]}}]},{type:"textline",tokens:"return v ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( rV , 1.0 ) ) ; } vec3 sf ( in vec3 rY , in vec4 rZ , in vec4 r_ , in float sa ) { vec4 sb ; vec3 sc , sd , se ; sc = p ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( rY , 0.0 ) ) ;".split(" ")},{type:"condition",parts:[{type:"if",
expression:["SKIN_SLERP"],group:{type:"group",parts:[{type:"textline",tokens:"sb = rL ( rZ , r_ , sa ) ; sd = i ( sb , sc ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"se = i ( rZ , sc ) ; sc = i ( r_ , sc ) ; sd = mix ( se , sc , sa ) ;".split(" ")}]}}]},{type:"textline",tokens:"return v ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( sd , 0.0 ) ) ; }".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"vec3 rX ( in vec3 sg , in vec4 sh , in vec4 si ) { vec3 sj ; sj = p ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( sg , 1.0 ) ) ; sj = i ( sh , sj ) ; sj = sj * si . w + si . xyz ; return v ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( sj , 1.0 ) ) ; } vec3 sf ( in vec3 sk , in vec4 sl ) { vec3 sm ; sm = p ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( sk , 0.0 ) ) ; sm = i ( sl , sm ) ; return v ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( sm , 0.0 ) ) ; }".split(" ")}]}}]},
{type:"textline",tokens:"void sB ( inout vec3 sn , inout vec3 so , inout vec3 sp , inout vec3 sq ) { int sr , ss ; vec4 st ; vec3 su , sv , sw , sx ; float sy , sz ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["FRAMES_BLENDING"],group:{type:"group",parts:[{type:"textline",tokens:["sy","=","u_frame_factor",";"]}]}}]},{type:"textline",tokens:"if ( a_influence . y > 0.0 ) { su = vec3 ( 0.0 , 0.0 , 0.0 ) ; sv = vec3 ( 0.0 , 0.0 , 0.0 ) ; sw = vec3 ( 0.0 , 0.0 , 0.0 ) ; sx = vec3 ( 0.0 , 0.0 , 0.0 ) ; st = a_influence ; for ( int sA = 0 ; sA < 4 ; sA ++ ) { sr = int ( st [ sA ] ) ; sz = fract ( st [ sA ] ) ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["FRAMES_BLENDING"],group:{type:"group",parts:[{type:"textline",tokens:"su += sz * rX ( sn , u_quatsb [ sr ] , u_quatsa [ sr ] , u_transb [ sr ] , u_transa [ sr ] , sy ) ; sv += sz * sf ( so , u_quatsb [ sr ] , u_quatsa [ sr ] , sy ) ; sw += sz * sf ( sp , u_quatsb [ sr ] , u_quatsa [ sr ] , sy ) ; sx += sz * sf ( sq , u_quatsb [ sr ] , u_quatsa [ sr ] , sy ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"su += sz * rX ( sn , u_quatsb [ sr ] , u_transb [ sr ] ) ; sx += sz * sf ( sq , u_quatsb [ sr ] ) ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["DISABLE_TANGENT_SKINNING",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:"sv += sz * sf ( so , u_quatsb [ sr ] ) ; sw += sz * sf ( sp , u_quatsb [ sr ] ) ;".split(" ")}]}}]}]}}]},{type:"textline",tokens:"} sn = su ; sq = sx ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["DISABLE_TANGENT_SKINNING",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:"so = sv ; sp = sw ;".split(" ")}]}}]},
{type:"textline",tokens:"} if ( ! ( a_influence . y > 0.0 ) ) { ss = int ( a_influence [ 0 ] - 1.0 ) ; if ( ss > - 1 ) {".split(" ")},{type:"condition",parts:[{type:"if",expression:["FRAMES_BLENDING"],group:{type:"group",parts:[{type:"textline",tokens:"sn = rX ( sn , u_quatsb [ ss ] , u_quatsa [ ss ] , u_transb [ ss ] , u_transa [ ss ] , sy ) ; so = sf ( so , u_quatsb [ ss ] , u_quatsa [ ss ] , sy ) ; sp = sf ( sp , u_quatsb [ ss ] , u_quatsa [ ss ] , sy ) ; sq = sf ( sq , u_quatsb [ ss ] , u_quatsa [ ss ] , sy ) ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"sn = rX ( sn , u_quatsb [ ss ] , u_transb [ ss ] ) ; sq = sf ( sq , u_quatsb [ ss ] ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["DISABLE_TANGENT_SKINNING",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:"so = sf ( so , u_quatsb [ ss ] ) ; sp = sf ( sp , u_quatsb [ ss ] ) ;".split(" ")}]}}]}]}}]},{type:"textline",tokens:["}","}","}"]}]}}]}]};a["include/wind_bending.glslv"]=
{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["WIND_BEND"],group:{type:"group",parts:[{type:"textline",tokens:"void sM ( inout vec3 sC , in vec3 sD , in float sE , in float sF , in float sG , in vec3 sH , in float sI ) { vec3 sJ ; float sK , sL ; sK = length ( sD ) ; sL = sF * ( 1.0 + 0.1 * fract ( sK ) ) ; sK = sE * sI * ( 1.0 + sin ( 2.0 * 3.14 * sG * sL + sK ) ) ; sL = ( sC . y - sD . y ) * abs ( sK ) ; sL += 1.0 ; sL *= sL ; sL = sL * sL - sL ; sJ = sC ; sJ . xz += sH . xz * sL * sign ( sK ) ; sJ = sJ - sD ; if ( all ( equal ( sJ , vec3 ( 0.0 ) ) ) ) sC = sD ; else { sK = length ( sC - sD ) ; sC = sD + normalize ( sJ ) * sK ; } }".split(" ")},
{type:"condition",parts:[{type:"if",expression:["DETAIL_BEND"],group:{type:"group",parts:[{type:"textline",tokens:"vec4 sO ( vec4 sN ) { return sN * sN * ( 3.0 - 2.0 * sN ) ; } vec4 sQ ( vec4 sP ) { return abs ( fract ( sP + 0.5 ) * 2.0 - 1.0 ) ; } vec4 sS ( vec4 sR ) { return sO ( sQ ( sR ) ) ; } void ti ( inout vec3 sT , in float sU , in vec3 sV , in vec3 sW , in vec3 sX , in float sY , in float sZ , in float s_ , in vec3 ta ) { vec3 tb ; vec4 tc ; vec2 td , te ; float tf , tg , th ; tf = dot ( sX , vec3 ( 1.0 ) ) ; tg = tf + ta . g ; th = dot ( sT , vec3 ( ta . g ) ) ; td = ( sU + vec2 ( th , tg ) ) ; tc = ( ( fract ( ( td . xxyy * vec4 ( 1.975 , 0.793 , 0.375 , 0.193 ) ) ) * 2.0 ) - 1.0 ) * length ( sW ) * sY ; tc = sS ( tc ) ; te = tc . xz + tc . yw ; te . y = 0.5 - te . y ; tb = te . xyx * ta . rbr * vec3 ( sZ * sV . x , s_ , sZ * sV . z ) ; sT += tb ; }".split(" ")}]}}]},
{type:"textline",tokens:"void tp ( inout vec3 tj , inout vec3 tk , in vec3 tl ) { vec3 tm , tn , to ; tm = u_wind * 1.0 + 0.7 * sin ( u_time ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["BEND_CENTER_ONLY"],group:{type:"group",parts:[{type:"textline",tokens:"tn = tk ; to = a_emitter_center ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"tn = tj ; to = tk ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["MAIN_BEND_COL"],group:{type:"group",
parts:[{type:"condition",parts:[{type:"if",expression:["DETAIL_BEND"],group:{type:"group",parts:[{type:"textline",tokens:"ti ( tn , u_time , tl , tm , to , au_detail_bending_freq , au_detail_bending_amp , au_branch_bending_amp , a_bending_col_detail ) ;".split(" ")}]}}]},{type:"textline",tokens:"sM ( tn , to , au_wind_bending_amp , au_wind_bending_freq , u_time , tm , a_bending_col_main ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"sM ( tn , to , au_wind_bending_amp , au_wind_bending_freq , u_time , tm , 1.0 ) ;".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["BEND_CENTER_ONLY"],group:{type:"group",parts:[{type:"textline",tokens:"tj += tn - tk ; tk = tn ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"tj = tn ; tk = to ;".split(" ")}]}}]},{type:"textline",tokens:["}"]}]}}]}]};a["include/nodes.glslv"]={type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["USE_NODE_GEOMETRY_OR","USE_NODE_TEX_COORD_GE",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",
tokens:"attribute vec3 a_orco_tex_coord ; varying vec3 eg ;".split(" ")}]}}]},{type:"node",name:"TEX_COORD_UV",declarations:[{type:"node_param",name:"node_TEX_COORD_UV_var_a_uv",qualifier:["attribute","vec2"]},{type:"node_param",name:"eG",qualifier:["varying","vec2"]}],statements:[{type:"textline",tokens:["eG","=","node_TEX_COORD_UV_var_a_uv",";"]}]},{type:"node",name:"UV_MERGED",declarations:[{type:"node_param",name:"node_UV_MERGED_var_a_uv",qualifier:["attribute","vec2"]},{type:"node_param",name:"eF",
qualifier:["varying","vec2"]}],statements:[{type:"textline",tokens:["eF","=","node_UV_MERGED_var_a_uv",";"]}]},{type:"node",name:"UVMAP",declarations:[{type:"node_param",name:"node_UVMAP_var_a_uv",qualifier:["attribute","vec2"]},{type:"node_param",name:"eH",qualifier:["varying","vec2"]}],statements:[{type:"textline",tokens:["eH","=","node_UVMAP_var_a_uv",";"]}]},{type:"node",name:"GEOMETRY_UV",declarations:[{type:"node_param",name:"node_GEOMETRY_UV_var_a_uv",qualifier:["attribute","vec2"]},{type:"node_param",
name:"ez",qualifier:["varying","vec2"]}],statements:[{type:"textline",tokens:["ez","=","node_GEOMETRY_UV_var_a_uv",";"]}]},{type:"node",name:"GEOMETRY_VC",declarations:[{type:"node_param",name:"node_GEOMETRY_VC_var_a_vertex_color",qualifier:["attribute","vec3"]},{type:"node_param",name:"tq",qualifier:["varying","vec3"]}],statements:[{type:"textline",tokens:["tq","=","node_GEOMETRY_VC_var_a_vertex_color",";"]}]},{type:"node",name:"GEOMETRY_VC1",declarations:[{type:"node_param",name:"node_GEOMETRY_VC1_var_a_vertex_color",
qualifier:["attribute","float"]},{type:"node_param",name:"tr",qualifier:["varying","float"]}],statements:[{type:"textline",tokens:["tr","=","node_GEOMETRY_VC1_var_a_vertex_color",";"]}]},{type:"node",name:"GEOMETRY_VC2",declarations:[{type:"node_param",name:"node_GEOMETRY_VC2_var_a_vertex_color",qualifier:["attribute","vec2"]},{type:"node_param",name:"ts",qualifier:["varying","vec2"]}],statements:[{type:"textline",tokens:["ts","=","node_GEOMETRY_VC2_var_a_vertex_color",";"]}]},{type:"node",name:"GEOMETRY_VC3",
declarations:[{type:"node_param",name:"node_GEOMETRY_VC3_var_a_vertex_color",qualifier:["attribute","vec3"]},{type:"node_param",name:"tt",qualifier:["varying","vec3"]}],statements:[{type:"textline",tokens:["tt","=","node_GEOMETRY_VC3_var_a_vertex_color",";"]}]},{type:"nodes_global"},{type:"textline",tokens:["void","tu","(",")","{"]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_GEOMETRY_OR","USE_NODE_TEX_COORD_GE",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",
tokens:["eg","=","a_orco_tex_coord",";"]}]}}]},{type:"nodes_main"},{type:"textline",tokens:["}"]}]};a["include/dynamic_grass.glslv"]={type:"group",parts:[{type:"var",name:"PRECISION",tokens:["lowp"]},{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS"],group:{type:"group",parts:[{type:"textline",tokens:"vec2 tz ( vec3 tv , float tw , vec2 tx ) { vec2 ty ; ty = vec2 ( ( tv . x - tx . x ) / tw , - ( tv . z - tx . y ) / tw ) ; return fract ( ty ) ; } vec2 tD ( vec2 tA , float tB , vec2 tC ) { return vec2 ( tA . x * tB , - tA . y * tB ) + tC ; } c tE ( ) { return c ( vec3 ( - 10000.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) ) ; } c t_ ( vec3 tF , vec3 tG , vec3 tH , vec3 tI , vec3 tJ , PRECISION sampler2D tK , sampler2D tL , vec3 tM , float tN , vec3 tO , vec4 tP , mat4 tQ ) { mat4 tR ; vec4 tS ; vec2 tT , tU , tV ; float tW , tX ; vec3 tY ; tY = i ( tP , vec3 ( 0.0 , - 1.0 , 0.0 ) ) ; tW = - tY . x ; tX = - tY . z ; tT = vec2 ( tO . x + tN * ( - 1.0 - tW ) / 2.0 , tO . z + tN * ( 1.0 - tX ) / 2.0 ) ; tU = tz ( tJ , tN , tT ) ; tX = tN / 2.0 ; tV = abs ( tD ( tU - vec2 ( 0.5 ) , tN , vec2 ( 0.0 ) ) ) ; tX = tX * ( 1.0 + sqrt ( 2.0 ) ) / 2.0 ; if ( length ( tV ) > tX ) return tE ( ) ; tX = tN / tM . z ; tV = ( tU - vec2 ( 0.5 ) ) * tX + vec2 ( 0.5 ) ; tY = tY * ( tN / tM . z - 1.0 ) / 2.0 ; tV . x += tY . x ; tV . y -= tY . z ; tS = texture2D ( tL , tV ) ; tX = tS . r ; if ( tX < u_scale_threshold ) return tE ( ) ; tW = tM . y - tM . x ; tW = tM . y - texture2D ( tK , tV ) . r * tW ; tV = tF . xz - tJ . xz ; tJ . xz = tD ( tU , tN , tT ) ; tJ . y = tW ; tF . xz = tJ . xz + tV ; tF . y *= tX ; tF . y += tW ; tY = tS . gba ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["BILLBOARD"],group:{type:"group",parts:[{type:"textline",tokens:"tF -= tJ ; tR = ro ( tO , tJ , tQ ) ; c tZ = rB ( tF , tJ , tG , tH , tI , tR ) ; tZ . b = tJ ; tZ . f = tY ; return E ( tZ ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"return E ( c ( tF , tJ , tG , tH , tI , tY ) ) ;".split(" ")}]}}]},{type:"textline",tokens:["}"]}]}}]}]};a["include/shadow.glslv"]={type:"group",parts:[{type:"var",name:"SHADOW_TEX_RES",
tokens:["0.0"]},{type:"condition",parts:[{type:"if",expression:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",places:2},"SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"vec4 ug ( mat4 ua , vec4 ub , mat4 uc ) { vec4 ud ; float ue ; vec2 uf ; uf = ( ua * uc [ 3 ] ) . xy ; ue = SHADOW_TEX_RES / 2.0 ; uf = floor ( uf * ue + 0.5 ) / ue - uf ; ud = ua * ub ; ud . xy += uf ; ud . xyz = 0.5 * ( ud . xyz + ud . w ) ; return ud ; } void ul ( vec3 uh , vec3 ui ) { vec4 uj ; mat4 uk ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["MAC_OS_SHADOW_HACK"],group:{type:"group",parts:[{type:"textline",tokens:"uk = O ( u_v_light_tsr [ 0 ] ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"uk = O ( mat3 ( u_v_light_ts [ 0 ] , u_v_light_r [ 0 ] , 0.0 ) ) ;".split(" ")}]}}]},{type:"textline",tokens:"uj = uk * vec4 ( uh + u_normal_offset * ui , 1.0 ) ; bI = ug ( u_p_light_matrix0 , uj , uk ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["NUM_CAST_LAMPS",
1,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["MAC_OS_SHADOW_HACK"],group:{type:"group",parts:[{type:"textline",tokens:"uk = O ( u_v_light_tsr [ 1 ] ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"uk = O ( mat3 ( u_v_light_ts [ 1 ] , u_v_light_r [ 1 ] , 0.0 ) ) ;".split(" ")}]}}]},{type:"textline",tokens:"uj = uk * vec4 ( uh + u_normal_offset * ui , 1.0 ) ; bJ = ug ( u_p_light_matrix1 , uj , uk ) ;".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["NUM_CAST_LAMPS",2,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["MAC_OS_SHADOW_HACK"],group:{type:"group",parts:[{type:"textline",tokens:"uk = O ( u_v_light_tsr [ 2 ] ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"uk = O ( mat3 ( u_v_light_ts [ 2 ] , u_v_light_r [ 2 ] , 0.0 ) ) ;".split(" ")}]}}]},{type:"textline",tokens:"uj = uk * vec4 ( uh + u_normal_offset * ui , 1.0 ) ; bK = ug ( u_p_light_matrix2 , uj , uk ) ;".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["NUM_CAST_LAMPS",3,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["MAC_OS_SHADOW_HACK"],group:{type:"group",parts:[{type:"textline",tokens:"uk = O ( u_v_light_tsr [ 3 ] ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"uk = O ( mat3 ( u_v_light_ts [ 3 ] , u_v_light_r [ 3 ] , 0.0 ) ) ;".split(" ")}]}}]},{type:"textline",tokens:"uj = uk * vec4 ( uh + u_normal_offset * ui , 1.0 ) ; bL = ug ( u_p_light_matrix3 , uj , uk ) ;".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["CSM_SECTION1"],group:{type:"group",parts:[{type:"textline",tokens:"bJ = ug ( u_p_light_matrix1 , uj , uk ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION2"],group:{type:"group",parts:[{type:"textline",tokens:"bK = ug ( u_p_light_matrix2 , uj , uk ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION3"],group:{type:"group",parts:[{type:"textline",tokens:"bL = ug ( u_p_light_matrix3 , uj , uk ) ;".split(" ")}]}}]},
{type:"textline",tokens:["}"]}]}}]}]};a["include/fog.glslf"]={type:"group",parts:[{type:"var",name:"WAVES_HEIGHT",tokens:["0.0"]},{type:"condition",parts:[{type:"if",expression:["USE_FOG"],group:{type:"group",parts:[{type:"textline",tokens:"void uv ( inout vec3 up , in float uq , in float ur , in vec4 us ) { float ut , uu ; ut = clamp ( ( uq - u_fog_params . z ) / u_fog_params . y , 0.0 , 1.0 ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["FOG_TYPE","QUADRATIC",{type:"equal_expr",
places:2}],group:{type:"group",parts:[{type:"textline",tokens:["ut","*=","ut",";"]}]}},{type:"elif",expression:["FOG_TYPE","LINEAR",{type:"equal_expr",places:2}],group:{type:"group",parts:[]}},{type:"elif",expression:["FOG_TYPE","INVERSE_QUADRATIC",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"ut = sqrt ( ut ) ;".split(" ")}]}}]},{type:"textline",tokens:"if ( u_fog_params . w > 0.0 ) { if ( ur > u_fog_params . w ) ut = 0.0 ; else if ( ur > 0.0 ) { uu = ( u_fog_params . w - ur ) / u_fog_params . w ; ut *= uu * uu ; } } us . a = 1.0 - ( 1.0 - ut ) * ( 1.0 - u_fog_params . x ) ; up = mix ( up , us . rgb , us . a ) ; }".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["PROCEDURAL_FOG"],group:{type:"group",parts:[{type:"textline",tokens:"vec3 uB ( in mat4 uw , in vec3 ux ) { vec3 uy , uz , uA ; uy = mix ( uw [ 0 ] . rgb , uw [ 1 ] . rgb , max ( sign ( ux . x ) , 0.0 ) ) ; uz = mix ( uw [ 2 ] . rgb , uw [ 3 ] . rgb , max ( sign ( ux . z ) , 0.0 ) ) ; uA = vec3 ( uw [ 0 ] . a , uw [ 1 ] . a , uw [ 2 ] . a ) ; uz = mix ( uy , uz , abs ( ux . z ) ) ; uz = mix ( uz , uA , abs ( ux . y ) ) ; br ( uz ) ; return uz ; }".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS"],group:{type:"group",parts:[{type:"textline",tokens:"void uD ( inout float uC ) { uC -= 0.5 ; uC = 4.0 * ( uC * uC * uC ) + 0.5 ; }".split(" ")},{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS"],group:{type:"group",parts:[{type:"textline",tokens:"void uO ( inout vec3 uE , in float uF , in vec3 uG , in float uH , in vec4 uI , in float uJ ) { vec3 uK , uL ; float uM , uN ; uM = max ( uG . y , 0.0 ) ; uN = max ( uF - max ( uH / uM , 0.0 ) , 0.0 ) ; uN = uI . w * uN ; uK = vec3 ( 0.0 , 0.02 , 0.05 ) ; uL = uI . rgb ; uN = min ( uN , 1.0 ) ; uD ( uN ) ; uN *= clamp ( 2.0 - uJ , 0.0 , 1.0 ) ; uK = mix ( uL , uK , min ( uM , 1.0 ) ) ; uH = clamp ( - uH * 0.03 , 0.0 , 0.8 ) ; uK *= 1.0 - uH ; uE = mix ( uE , uK , uN ) ; }".split(" ")}]}}]},
{type:"textline",tokens:"void uU ( inout vec3 uP , in float uQ , in float uR ) { vec3 uS ; float uT ; uT = u_underwater_fog_color_density . w * uQ ; uT = clamp ( uT , 0.0 , 1.0 ) ; uD ( uT ) ; uR = clamp ( - uR * 0.03 , 0.0 , 0.8 ) ; uS = mix ( u_underwater_fog_color_density . rgb , vec3 ( 0.0 ) , uR ) ; uP = mix ( uP , uS , uT ) ; }".split(" ")}]}}]},{type:"textline",tokens:"void va ( inout vec3 uV , float uW , vec3 uX , float uY ) { vec4 uZ ; vec3 u_ ;".split(" ")},{type:"condition",parts:[{type:"if",
expression:["USE_FOG"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["PROCEDURAL_FOG"],group:{type:"group",parts:[{type:"textline",tokens:"u_ = uB ( u_cube_fog , uX ) ; uZ = vec4 ( u_ , u_fog_color_density . a ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["uZ","=","u_fog_color_density",";"]}]}}]},{type:"textline",tokens:"uv ( uV , uW , bC . y , uZ ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS"],
group:{type:"group",parts:[{type:"textline",tokens:"uO ( uV , uW , uX , u_cam_water_depth , u_underwater_fog_color_density , uY ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[]}}]},{type:"textline",tokens:["}"]}]};a["include/lighting_nodes.glslf"]={type:"group",parts:[{type:"var",name:"LAMP_IND",tokens:["0"]},{type:"var",name:"LAMP_SPOT_SIZE",tokens:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",tokens:["0"]},{type:"var",name:"LAMP_LIGHT_DIST",tokens:["0"]},{type:"var",name:"LAMP_LIGHT_FACT_IND",
tokens:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",tokens:["rgb"]},{type:"var",name:"LAMP_SHADOW_MAP_IND",tokens:["0"]},{type:"define",name:"M_PI",tokens:["3.14159265359"]},{type:"textline",tokens:"float ZERO_VALUE_NODES = 0.0 ; float UNITY_VALUE_NODES = 1.0 ; float vd = 0.5 ;".split(" ")},{type:"node",name:"LIGHTING_BEGIN",declarations:[{type:"node_out",name:"vB",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"vC",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"vD",qualifier:["vec3"],
is_optional:!1},{type:"node_out",name:"vE",qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"vF",qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"vG",qualifier:["vec2"],is_optional:!0},{type:"node_out",name:"vH",qualifier:["vec2"],is_optional:!0},{type:"node_out",name:"vI",qualifier:["vec4"],is_optional:!0},{type:"node_out",name:"vJ",qualifier:["float"],is_optional:!0},{type:"node_out",name:"vK",qualifier:["vec4"],is_optional:!0}],statements:[{type:"textline",tokens:"vB = ve ; vC = vf ; vD = vg ;".split(" ")},
{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_vE"],statements:[{type:"textline",tokens:["vE","=","vh",";"]}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_vF"],statements:[{type:"textline",tokens:["vF","=","vj",";"]}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_vH"],statements:[{type:"textline",tokens:["vH","=","vl",";"]}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_vG"],statements:[{type:"textline",tokens:["vG",
"=","vm",";"]}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_vI"],statements:[{type:"textline",tokens:["vI","=","vn",";"]}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_vJ"],statements:[{type:"textline",tokens:["vJ","=","vo",";"]}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_vK"],statements:[{type:"textline",tokens:["vK","=","vp",";"]}]}]}]},{type:"node",name:"LIGHTING_AMBIENT",declarations:[{type:"node_in",name:"vL",qualifier:["vec3"],
is_optional:!1},{type:"node_in",name:"vM",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"vN",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"vO",qualifier:["vec4"],is_optional:!1},{type:"node_out",name:"vP",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"vO = vec4 ( vL + vN * vM , ZERO_VALUE_NODES ) ; vP = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"LIGHTING_LAMP",declarations:[{type:"node_in",name:"vQ",qualifier:["vec4"],is_optional:!1},
{type:"node_out",name:"vR",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"vS",qualifier:["vec2"],is_optional:!1},{type:"node_out",name:"vT",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"vU",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"vS = u_light_factors [ LAMP_LIGHT_FACT_IND ] . LAMP_FAC_CHANNELS ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["LAMP_TYPE","HEMI",{type:"equal_expr",places:2}],statements:[{type:"textline",
tokens:["vU","=","vd",";"]}]},{type:"node_else",statements:[{type:"textline",tokens:["vU","=","ZERO_VALUE_NODES",";"]}]}]},{type:"textline",tokens:"vT = u_light_color_intensities [ LAMP_IND ] ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["LAMP_SHADOW_MAP_IND",1,{type:"negative_expr",places:1},{type:"non_equal_expr",places:2}],statements:[{type:"textline",tokens:"vT *= vQ [ LAMP_SHADOW_MAP_IND ] ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["LAMP_TYPE",
"SPOT",{type:"equal_expr",places:2},"LAMP_TYPE","POINT",{type:"equal_expr",places:2},{type:"logical_or_expr",places:2}],statements:[{type:"textline",tokens:"vz = u_light_positions [ LAMP_IND ] ; vR = vz - vi ;".split(" ")},{type:"textline",tokens:"vs = length ( vR ) ; vT *= LAMP_LIGHT_DIST / ( LAMP_LIGHT_DIST + vs * vs ) ; vR = normalize ( vR ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["LAMP_TYPE","SPOT",{type:"equal_expr",places:2}],statements:[{type:"textline",tokens:"vz = u_light_directions [ LAMP_IND ] ; vs = dot ( vR , vz ) ; vs *= smoothstep ( ZERO_VALUE_NODES , UNITY_VALUE_NODES , ( vs - LAMP_SPOT_SIZE ) / LAMP_SPOT_BLEND ) ; vT *= vs ;".split(" ")}]}]}]},
{type:"node_else",statements:[{type:"textline",tokens:"vR = u_light_directions [ LAMP_IND ] ;".split(" ")}]}]}]},{type:"node",name:"DIFFUSE_FRESNEL",declarations:[{type:"node_in",name:"vV",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"vW",qualifier:["vec2"],is_optional:!1},{type:"node_in",name:"vX",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"vY",qualifier:["float"],is_optional:!1},{type:"node_in",name:"vZ",qualifier:["vec2"],is_optional:!1},{type:"node_out",name:"v_",qualifier:["float"],
is_optional:!1}],statements:[{type:"textline",tokens:"v_ = ZERO_VALUE_NODES ; if ( vW . r != ZERO_VALUE_NODES ) { vs = ( UNITY_VALUE_NODES - vY ) * dot ( vX , vV ) + vY ; if ( vZ [ 0 ] == ZERO_VALUE_NODES ) { v_ = UNITY_VALUE_NODES ; } else { vs = UNITY_VALUE_NODES + abs ( vs ) ; vs = vZ [ 1 ] + ( UNITY_VALUE_NODES - vZ [ 1 ] ) * pow ( vs , vZ [ 0 ] ) ; v_ = clamp ( vs , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; } v_ = max ( v_ , ZERO_VALUE_NODES ) ; }".split(" ")}]},{type:"node",name:"DIFFUSE_LAMBERT",
declarations:[{type:"node_in",name:"wa",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"wb",qualifier:["vec2"],is_optional:!1},{type:"node_in",name:"wc",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"wd",qualifier:["float"],is_optional:!1},{type:"node_out",name:"we",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"we = ZERO_VALUE_NODES ; if ( wb . r != ZERO_VALUE_NODES ) { vs = ( UNITY_VALUE_NODES - wd ) * dot ( wc , wa ) + wd ; we = max ( vs , ZERO_VALUE_NODES ) ; }".split(" ")}]},
{type:"node",name:"DIFFUSE_OREN_NAYAR",declarations:[{type:"node_in",name:"wf",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"wg",qualifier:["vec2"],is_optional:!1},{type:"node_in",name:"wh",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"wi",qualifier:["float"],is_optional:!1},{type:"node_in",name:"wj",qualifier:["vec2"],is_optional:!1},{type:"node_out",name:"wk",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"wk = ZERO_VALUE_NODES ; if ( wg . r != ZERO_VALUE_NODES ) { vs = ( UNITY_VALUE_NODES - wi ) * dot ( wh , wf ) + wi ; if ( wj [ 0 ] > ZERO_VALUE_NODES ) { vt = max ( dot ( wh , vk ) , ZERO_VALUE_NODES ) ; vu = wj [ 0 ] * wj [ 0 ] ; vv = UNITY_VALUE_NODES - vd * ( vu / ( vu + 0.33 ) ) ; vz = wf - vs * wh ; vA = vk - vt * wh ;".split(" ")},
{type:"textline",tokens:"if ( length ( vz ) == ZERO_VALUE_NODES || length ( vA ) == ZERO_VALUE_NODES || abs ( vs ) > UNITY_VALUE_NODES || abs ( vt ) > UNITY_VALUE_NODES )".split(" ")},{type:"textline",tokens:"wk = vs * vv ; else { vw = acos ( vs ) ; vt = acos ( vt ) ; vz = normalize ( vz ) ; vA = normalize ( vA ) ; vx = max ( vw , vt ) ; vy = min ( vw , vt ) ; vy *= 0.95 ; vt = max ( dot ( vz , vA ) , ZERO_VALUE_NODES ) ; vu = 0.45 * ( vu / ( vu + 0.09 ) ) ; wk = vs * ( vv + ( vu * vt * sin ( vx ) * tan ( vy ) ) ) ; } } else wk = vs ; wk = max ( wk , ZERO_VALUE_NODES ) ; }".split(" ")}]},
{type:"node",name:"DIFFUSE_MINNAERT",declarations:[{type:"node_in",name:"wl",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"wm",qualifier:["vec2"],is_optional:!1},{type:"node_in",name:"wn",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"wo",qualifier:["float"],is_optional:!1},{type:"node_in",name:"wp",qualifier:["vec2"],is_optional:!1},{type:"node_out",name:"wq",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"wq = ZERO_VALUE_NODES ; if ( wm . r != ZERO_VALUE_NODES ) { vs = ( UNITY_VALUE_NODES - wo ) * dot ( wn , wl ) + wo ; vy = max ( dot ( wn , vk ) , ZERO_VALUE_NODES ) ; if ( wp [ 0 ] <= UNITY_VALUE_NODES ) wq = vs * pow ( max ( vy * vs , 0.1 ) , wp [ 0 ] - UNITY_VALUE_NODES ) ; else wq = vs * pow ( 1.0001 - vy , wp [ 0 ] - UNITY_VALUE_NODES ) ; wq = max ( wq , ZERO_VALUE_NODES ) ; }".split(" ")}]},
{type:"node",name:"DIFFUSE_TOON",declarations:[{type:"node_in",name:"wr",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"ws",qualifier:["vec2"],is_optional:!1},{type:"node_in",name:"wt",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"wu",qualifier:["float"],is_optional:!1},{type:"node_in",name:"wv",qualifier:["vec2"],is_optional:!1},{type:"node_out",name:"ww",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"ww = ZERO_VALUE_NODES ; if ( ws . r != ZERO_VALUE_NODES ) { vy = ( UNITY_VALUE_NODES - wu ) * dot ( wt , wr ) + wu ; vy = acos ( vy ) ; if ( vy < wv [ 0 ] ) ww = UNITY_VALUE_NODES ; else if ( vy > ( wv [ 0 ] + wv [ 1 ] ) || wv [ 1 ] == ZERO_VALUE_NODES ) ww = ZERO_VALUE_NODES ; else ww = UNITY_VALUE_NODES - ( ( vy - wv [ 0 ] ) / wv [ 1 ] ) ; ww = max ( ww , ZERO_VALUE_NODES ) ; }".split(" ")}]},
{type:"node",name:"SPECULAR_PHONG",declarations:[{type:"node_in",name:"wx",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"wy",qualifier:["vec2"],is_optional:!1},{type:"node_in",name:"wz",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"wA",qualifier:["float"],is_optional:!1},{type:"node_in",name:"wB",qualifier:["vec2"],is_optional:!1},{type:"node_out",name:"wC",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"wC = ZERO_VALUE_NODES ; if ( wy . g != ZERO_VALUE_NODES ) { vA = normalize ( wx + vk ) ; wC = ( UNITY_VALUE_NODES - wA ) * max ( dot ( wz , vA ) , ZERO_VALUE_NODES ) + wA ; wC = pow ( wC , wB [ 0 ] ) ; }".split(" ")}]},
{type:"node",name:"SPECULAR_WARDISO",declarations:[{type:"node_in",name:"wD",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"wE",qualifier:["vec2"],is_optional:!1},{type:"node_in",name:"wF",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"wG",qualifier:["vec2"],is_optional:!1},{type:"node_out",name:"wH",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"wH = ZERO_VALUE_NODES ; if ( wE . g != ZERO_VALUE_NODES ) { vA = normalize ( wD + vk ) ; vy = max ( dot ( wF , vA ) , 0.001 ) ;".split(" ")},
{type:"textline",tokens:"vs = max ( dot ( wF , vk ) , 0.01 ) ; vx = max ( dot ( wF , wD ) , 0.01 ) ; vy = tan ( acos ( vy ) ) ; vt = max ( wG [ 0 ] , 0.001 ) ; wH = vx * ( UNITY_VALUE_NODES / ( 4.0 * M_PI * vt * vt ) ) * ( exp ( - ( vy * vy ) / ( vt * vt ) ) / ( sqrt ( vs * vx ) ) ) ; }".split(" ")}]},{type:"node",name:"SPECULAR_TOON",declarations:[{type:"node_in",name:"wI",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"wJ",qualifier:["vec2"],is_optional:!1},{type:"node_in",name:"wK",qualifier:["vec3"],
is_optional:!1},{type:"node_in",name:"wL",qualifier:["vec2"],is_optional:!1},{type:"node_out",name:"wM",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"wM = ZERO_VALUE_NODES ; if ( wJ . g != ZERO_VALUE_NODES ) { vA = normalize ( wI + vk ) ; vx = acos ( dot ( vA , wK ) ) ; if ( vx < wL [ 0 ] ) wM = UNITY_VALUE_NODES ; else if ( vx >= wL [ 0 ] + wL [ 1 ] || wL [ 1 ] == ZERO_VALUE_NODES ) wM = ZERO_VALUE_NODES ; else wM = UNITY_VALUE_NODES - ( vx - wL [ 0 ] ) / wL [ 1 ] ; }".split(" ")}]},
{type:"node",name:"SPECULAR_BLINN",declarations:[{type:"node_in",name:"wN",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"wO",qualifier:["vec2"],is_optional:!1},{type:"node_in",name:"wP",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"wQ",qualifier:["float"],is_optional:!1},{type:"node_in",name:"wR",qualifier:["vec2"],is_optional:!1},{type:"node_out",name:"wS",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"wS = ZERO_VALUE_NODES ; if ( wO . g != ZERO_VALUE_NODES ) { if ( wR [ 0 ] < 1.0 || wR [ 1 ] == ZERO_VALUE_NODES ) wS = ZERO_VALUE_NODES ; else { if ( wR [ 1 ] < 100.0 ) wR [ 1 ] = sqrt ( 1.0 / wR [ 1 ] ) ; else wR [ 1 ] = 10.0 / wR [ 1 ] ; vA = normalize ( vk + wN ) ; vx = ( UNITY_VALUE_NODES - wQ ) * max ( dot ( wP , vA ) , ZERO_VALUE_NODES ) + wQ ; if ( vx < ZERO_VALUE_NODES ) wS = ZERO_VALUE_NODES ; else { vs = max ( dot ( wP , vk ) , 0.01 ) ; vt = dot ( wP , wN ) ; if ( vt <= 0.01 ) wS = ZERO_VALUE_NODES ; else { vy = max ( dot ( vk , vA ) , 0.01 ) ; vu = UNITY_VALUE_NODES ; vs = ( 2.0 * vx * vs ) / vy ; vt = ( 2.0 * vx * vt ) / vy ; vt = min ( min ( vu , vs ) , vt ) ; vs = sqrt ( pow ( wR [ 0 ] , 2.0 ) + pow ( vy , 2.0 ) - UNITY_VALUE_NODES ) ; vy = pow ( vs - vy , 2.0 ) / pow ( vs + vy , 2.0 ) * ( UNITY_VALUE_NODES + pow ( vy * ( vs + vy ) - UNITY_VALUE_NODES , 2.0 ) / pow ( vy * ( vs - vy ) + UNITY_VALUE_NODES , 2.0 ) ) ; vx = acos ( vx ) ; wS = max ( vy * vt * exp ( - pow ( vx , 2.0 ) / ( 2.0 * pow ( wR [ 1 ] , 2.0 ) ) ) , ZERO_VALUE_NODES ) ; } } } }".split(" ")}]},
{type:"node",name:"LIGHTING_APPLY",declarations:[{type:"node_in",name:"wT",qualifier:["vec4"],is_optional:!1},{type:"node_in",name:"wU",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"wV",qualifier:["float"],is_optional:!1},{type:"node_in",name:"wW",qualifier:["float"],is_optional:!1},{type:"node_in",name:"wX",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"wY",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"wZ",qualifier:["vec4"],is_optional:!1},{type:"node_in",name:"w_",
qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"xa",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"xb",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"xc",qualifier:["float"],is_optional:!1},{type:"node_out",name:"xd",qualifier:["vec4"],is_optional:!1},{type:"node_out",name:"xe",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"xe = wU + xb * xa * wW ; xd = wT + vec4 ( xb * w_ * wV , wW ) ;".split(" ")}]},{type:"node",name:"LIGHTING_END",declarations:[{type:"node_in",
name:"xf",qualifier:["vec4"],is_optional:!1},{type:"node_in",name:"xg",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"vq = xf . rgb ; vr = xg ;".split(" ")}]},{type:"nodes_global"},{type:"textline",tokens:"void xh ( vec3 ve , vec3 vf , vec3 vg , vec3 vh , vec3 vi , vec3 vj , vec3 vk , vec2 vl , vec2 vm , vec4 vn , float vo , vec4 vp , out vec3 vq , out vec3 vr ) { float vs , vt , vu , vv , vw , vx , vy ; vec3 vz , vA ;".split(" ")},{type:"nodes_main"},{type:"textline",tokens:["}"]}]};
a["include/particles.glslv"]={type:"group",parts:[{type:"var",name:"EPSILON",tokens:["0.0001"]},{type:"textline",tokens:"struct xk { float a ; vec3 b ; float c ; vec3 d ; float e ; } ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SIZE_RAMP_LENGTH",0,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"void xq ( inout float xl , float xm , vec2 xn , vec2 xo ) { float xp ; xp = xo . x - xn . x ; xp = ( xm - xn . x ) / xp ; xl = mix ( xl , xo . y , clamp ( xp , 0.0 , 1.0 ) ) ; }".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["COLOR_RAMP_LENGTH",0,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"void xw ( inout vec3 xr , float xs , vec4 xt , vec4 xu ) { float xv ; xv = xu . x - xt . x ; xv = ( xs - xt . x ) / xv ; xr = mix ( xr , xu . yzw , clamp ( xv , 0.0 , 1.0 ) ) ; }".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["SIZE_RAMP_LENGTH",0,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"float xC ( float xx , float xy , vec2 xz [ SIZE_RAMP_LENGTH ] ) { float xA , xB ; xA = xx / xy ; xB = xz [ 0 ] . y ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["SIZE_RAMP_LENGTH",1,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"xq ( xB , xA , xz [ 0 ] , xz [ 1 ] ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["SIZE_RAMP_LENGTH",2,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"xq ( xB , xA , xz [ 1 ] , xz [ 2 ] ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["SIZE_RAMP_LENGTH",3,{type:"g_expr",places:2}],
group:{type:"group",parts:[{type:"textline",tokens:"xq ( xB , xA , xz [ 2 ] , xz [ 3 ] ) ;".split(" ")}]}}]},{type:"textline",tokens:["return","xB",";","}"]}]}}]},{type:"condition",parts:[{type:"if",expression:["COLOR_RAMP_LENGTH",0,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"vec3 xI ( float xD , float xE , vec4 xF [ COLOR_RAMP_LENGTH ] ) { vec3 xG ; float xH ; xH = xD / xE ; xG = xF [ 0 ] . yzw ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["COLOR_RAMP_LENGTH",
1,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"xw ( xG , xH , xF [ 0 ] , xF [ 1 ] ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["COLOR_RAMP_LENGTH",2,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"xw ( xG , xH , xF [ 1 ] , xF [ 2 ] ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["COLOR_RAMP_LENGTH",3,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"xw ( xG , xH , xF [ 2 ] , xF [ 3 ] ) ;".split(" ")}]}}]},
{type:"textline",tokens:["return","xG",";","}"]}]}}]},{type:"textline",tokens:"float xQ ( float xJ , float xK , float xL , float xM ) { float xN , xO , xP ; xN = max ( 0.01 , min ( xK , xL ) ) ; xO = max ( 0.01 , min ( xK , xM ) ) ; xP = xK - xO ; xO = clamp ( xJ / xN , 0.0 , 1.0 ) - step ( xP , xJ ) * ( xJ - xP ) / xO ; return xO ; } xk xX ( ) { mat4 xR ; vec3 xS , xT ; float xU , xV ; xk xW ; if ( u_p_cyclic == 1 ) { xU = mod ( u_p_time , u_p_length ) - a_p_delay ; if ( xU < 0.0 ) xU += u_p_length ; } if ( u_p_cyclic != 1 ) { xU = u_p_time - a_p_delay ; } if ( xU < 0.0 || xU >= a_p_lifetime ) { xW . a = 0.0001 ; xW . b = vec3 ( 99999.0 , 0.0 , 0.0 ) ; } if ( ! ( xU < 0.0 || xU >= a_p_lifetime ) ) {".split(" ")},
{type:"condition",parts:[{type:"if",expression:["WORLD_SPACE"],group:{type:"group",parts:[{type:"textline",tokens:"xS = a_position ; xT = a_normal ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"xR = O ( u_model_tsr ) ; xS = ( xR * vec4 ( a_position , 1.0 ) ) . xyz ; xT = ( xR * vec4 ( a_normal , 0.0 ) ) . xyz ;".split(" ")}]}}]},{type:"textline",tokens:"xS += u_p_nfactor * xU * xT ; xS += a_p_vels . xyz * xU ; xS . y -= u_p_gravity * xU * xU / 2.0 ; xV = max ( u_p_mass , EPSILON ) ; xS += ( u_p_wind_fac * u_wind / xV ) * xU * xU / 2.0 ; xW . b = xS ; xW . e = a_p_vels . w * xU ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["SIZE_RAMP_LENGTH",0,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"xW . a = xC ( xU , u_p_max_lifetime , u_p_size_ramp ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"xW . a = 1.0 ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["COLOR_RAMP_LENGTH",0,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"xW . d = xI ( xU , u_p_max_lifetime , u_p_color_ramp ) ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"xW . d = vec3 ( 1.0 ) ;".split(" ")}]}}]},{type:"textline",tokens:"xW . c = xQ ( xU , a_p_lifetime , u_p_fade_in , u_p_fade_out ) ; } return xW ; }".split(" ")}]};a["include/blending.glslf"]={type:"group",parts:[{type:"textline",tokens:"float xZ = 0.0 ; float x_ = 1.0 ; vec3 ye ( vec3 ya ) { float yb , yc ; vec4 yd ; yd = vec4 ( xZ , - x_ / 3.0 , 2.0 / 3.0 , - x_ ) ; yd = mix ( vec4 ( ya . bg , yd . wz ) , vec4 ( ya . gb , yd . xy ) , step ( ya . b , ya . g ) ) ; yd = mix ( vec4 ( yd . xyw , ya . r ) , vec4 ( ya . r , yd . yzx ) , step ( yd . x , ya . r ) ) ; yb = yd . x - min ( yd . w , yd . y ) ; yc = 1.0e-10 ; return vec3 ( abs ( yd . z + ( yd . w - yd . y ) / ( 6.0 * yb + yc ) ) , yb / ( yd . x + yc ) , yd . x ) ; } vec3 yi ( vec3 yf ) { vec3 yg ; vec4 yh ; yh = vec4 ( x_ , 2.0 / 3.0 , x_ / 3.0 , 3.0 ) ; yg = abs ( fract ( vec3 ( yf . r , yf . r , yf . r ) + yh . xyz ) * 6.0 - yh . www ) ; return yf . b * mix ( yh . xxx , clamp ( yg - yh . xxx , xZ , x_ ) , yf . g ) ; } vec3 ym ( vec3 yj , vec3 yk , float yl ) { return mix ( yj , yk , yl ) ; } vec3 yq ( vec3 yn , vec3 yo , float yp ) { return yp * yn + yo ; } vec3 yu ( vec3 yr , vec3 ys , float yt ) { return ys - yt * yr ; } vec3 yz ( vec3 yv , vec3 yw , float yx ) { float yy ; yy = x_ - yx ; return ( vec3 ( yy ) + yx * yv ) * yw ; } vec3 yE ( vec3 yA , vec3 yB , float yC ) { vec3 yD ; yD = vec3 ( x_ - yC ) ; return vec3 ( x_ ) - ( yD + yC * ( vec3 ( x_ ) - yA ) ) * ( vec3 ( x_ ) - yB ) ; } vec3 yJ ( vec3 yF , vec3 yG , float yH ) { vec3 yI ; yI = vec3 ( x_ - yH ) ; return mix ( yG * ( yI + 2.0 * yH * yF ) , vec3 ( x_ ) - ( yI + 2.0 * yH * ( vec3 ( x_ ) - yF ) ) * ( vec3 ( x_ ) - yG ) , step ( 0.5 , yG ) ) ; } vec3 yN ( vec3 yK , vec3 yL , float yM ) { return mix ( yL , abs ( yK - yL ) , yM ) ; } vec3 yR ( vec3 yO , vec3 yP , float yQ ) { return mix ( yP , yP / ( yO + step ( yO , vec3 ( xZ ) ) ) , yQ ) ; } vec3 yV ( vec3 yS , vec3 yT , float yU ) { return mix ( yT , min ( yS , yT ) , yU ) ; } vec3 yZ ( vec3 yW , vec3 yX , float yY ) { return max ( yY * yW , yX ) ; } vec3 ze ( vec3 y_ , vec3 za , float zb ) { vec3 zc , zd ; zc = ye ( za ) ; if ( zc . y != xZ ) { zd = ye ( y_ ) ; zd = yi ( vec3 ( zc . x , zd . yz ) ) ; return mix ( y_ , zd , zb ) ; } return y_ ; } vec3 zk ( vec3 zf , vec3 zg , float zh ) { vec3 zi , zj ; zi = ye ( zf ) ; if ( zi . y != xZ ) { zj = ye ( zg ) ; return yi ( vec3 ( zi . x , mix ( zi . y , zj . y , zh ) , zi . z ) ) ; } return zf ; } vec3 zq ( vec3 zl , vec3 zm , float zn ) { vec3 zo , zp ; zo = ye ( zl ) ; zp = ye ( zm ) ; return yi ( vec3 ( zo . xy , mix ( zo . z , zp . z , zn ) ) ) ; } vec3 zw ( vec3 zr , vec3 zs , float zt ) { vec3 zu , zv ; zu = ye ( zs ) ; if ( zu . y != xZ ) { zv = ye ( zr ) ; zv = yi ( vec3 ( zu . xy , zv . z ) ) ; return mix ( zr , zv , zt ) ; } return zr ; } vec3 zB ( vec3 zx , vec3 zy , float zz ) { vec3 zA ; zA = vec3 ( x_ ) - ( vec3 ( x_ ) - zy ) * ( vec3 ( x_ ) - zx ) ; return mix ( zx , ( ( vec3 ( x_ ) - zx ) * zy * zx ) + zx * zA , zz ) ; } vec3 zF ( vec3 zC , vec3 zD , float zE ) { return zC + zE * ( 2.0 * zD - x_ ) ; } float zL ( float zG , float zH , float zI , float zJ ) { float zK ; zK = x_ - zJ ; return ( zK + zI * zG ) * zH ; } float zR ( float zM , float zN , float zO , float zP ) { float zQ ; zQ = x_ - zP ; return x_ - ( zQ + zO * ( x_ - zM ) ) * ( x_ - zN ) ; } float zX ( float zS , float zT , float zU , float zV ) { float zW ; zW = x_ - zV ; return mix ( zT * ( zW + 2.0 * zU * zS ) , x_ - ( zW + 2.0 * zU * ( x_ - zS ) ) * ( x_ - zT ) , step ( 0.5 , zT ) ) ; }".split(" ")}]};
a["include/fxaa.glslf"]={type:"group",parts:[{type:"condition",parts:[{type:"ifndef",name:"FXAA_PS3",group:{type:"group",parts:[{type:"define",name:"FXAA_PS3",tokens:["0"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"FXAA_360",group:{type:"group",parts:[{type:"define",name:"FXAA_360",tokens:["0"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"FXAA_360_OPT",group:{type:"group",parts:[{type:"define",name:"FXAA_360_OPT",tokens:["0"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"FXAA_PC",
group:{type:"group",parts:[{type:"define",name:"FXAA_PC",tokens:["0"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"FXAA_PC_CONSOLE",group:{type:"group",parts:[{type:"define",name:"FXAA_PC_CONSOLE",tokens:["0"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"FXAA_GLSL_120",group:{type:"group",parts:[{type:"define",name:"FXAA_GLSL_120",tokens:["0"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"FXAA_GLSL_130",group:{type:"group",parts:[{type:"define",name:"FXAA_GLSL_130",tokens:["0"]}]}}]},
{type:"condition",parts:[{type:"ifndef",name:"FXAA_HLSL_3",group:{type:"group",parts:[{type:"define",name:"FXAA_HLSL_3",tokens:["0"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"FXAA_HLSL_4",group:{type:"group",parts:[{type:"define",name:"FXAA_HLSL_4",tokens:["0"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"FXAA_HLSL_5",group:{type:"group",parts:[{type:"define",name:"FXAA_HLSL_5",tokens:["0"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"FXAA_GREEN_AS_LUMA",group:{type:"group",
parts:[{type:"define",name:"FXAA_GREEN_AS_LUMA",tokens:["0"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"FXAA_EARLY_EXIT",group:{type:"group",parts:[{type:"define",name:"FXAA_EARLY_EXIT",tokens:["1"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"FXAA_DISCARD",group:{type:"group",parts:[{type:"define",name:"FXAA_DISCARD",tokens:["0"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"FXAA_FAST_PIXEL_OFFSET",group:{type:"group",parts:[{type:"condition",parts:[{type:"ifdef",name:"GL_EXT_gpu_shader4",
group:{type:"group",parts:[{type:"define",name:"FXAA_FAST_PIXEL_OFFSET",tokens:["1"]}]}}]},{type:"condition",parts:[{type:"ifdef",name:"GL_NV_gpu_shader5",group:{type:"group",parts:[{type:"define",name:"FXAA_FAST_PIXEL_OFFSET",tokens:["1"]}]}}]},{type:"condition",parts:[{type:"ifdef",name:"GL_ARB_gpu_shader5",group:{type:"group",parts:[{type:"define",name:"FXAA_FAST_PIXEL_OFFSET",tokens:["1"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"FXAA_FAST_PIXEL_OFFSET",group:{type:"group",parts:[{type:"define",
name:"FXAA_FAST_PIXEL_OFFSET",tokens:["0"]}]}}]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"FXAA_GATHER4_ALPHA",group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["FXAA_HLSL_5",1,{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",name:"FXAA_GATHER4_ALPHA",tokens:["1"]}]}}]},{type:"condition",parts:[{type:"ifdef",name:"GL_ARB_gpu_shader5",group:{type:"group",parts:[{type:"define",name:"FXAA_GATHER4_ALPHA",tokens:["1"]}]}}]},{type:"condition",parts:[{type:"ifdef",
name:"GL_NV_gpu_shader5",group:{type:"group",parts:[{type:"define",name:"FXAA_GATHER4_ALPHA",tokens:["1"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"FXAA_GATHER4_ALPHA",group:{type:"group",parts:[{type:"define",name:"FXAA_GATHER4_ALPHA",tokens:["0"]}]}}]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"FXAA_CONSOLE_PS3_EDGE_SHARPNESS",group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:[1],group:{type:"group",parts:[{type:"define",name:"FXAA_CONSOLE_PS3_EDGE_SHARPNESS",
tokens:["8.0"]}]}}]},{type:"condition",parts:[{type:"if",expression:[0],group:{type:"group",parts:[{type:"define",name:"FXAA_CONSOLE_PS3_EDGE_SHARPNESS",tokens:["4.0"]}]}}]},{type:"condition",parts:[{type:"if",expression:[0],group:{type:"group",parts:[{type:"define",name:"FXAA_CONSOLE_PS3_EDGE_SHARPNESS",tokens:["2.0"]}]}}]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"FXAA_CONSOLE_PS3_EDGE_THRESHOLD",group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:[1],group:{type:"group",
parts:[{type:"define",name:"FXAA_CONSOLE_PS3_EDGE_THRESHOLD",tokens:["0.125"]}]}},{type:"else",group:{type:"group",parts:[{type:"define",name:"FXAA_CONSOLE_PS3_EDGE_THRESHOLD",tokens:["0.25"]}]}}]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"FXAA_QUALITY_PRESET",group:{type:"group",parts:[{type:"define",name:"FXAA_QUALITY_PRESET",tokens:["12"]}]}}]},{type:"condition",parts:[{type:"if",expression:["FXAA_QUALITY_PRESET",10,{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",
name:"FXAA_QUALITY_PS",tokens:["3"]},{type:"define",name:"FXAA_QUALITY_P0",tokens:["1.5"]},{type:"define",name:"FXAA_QUALITY_P1",tokens:["3.0"]},{type:"define",name:"FXAA_QUALITY_P2",tokens:["12.0"]}]}}]},{type:"condition",parts:[{type:"if",expression:["FXAA_QUALITY_PRESET",11,{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",name:"FXAA_QUALITY_PS",tokens:["4"]},{type:"define",name:"FXAA_QUALITY_P0",tokens:["1.0"]},{type:"define",name:"FXAA_QUALITY_P1",tokens:["1.5"]},{type:"define",
name:"FXAA_QUALITY_P2",tokens:["3.0"]},{type:"define",name:"FXAA_QUALITY_P3",tokens:["12.0"]}]}}]},{type:"condition",parts:[{type:"if",expression:["FXAA_QUALITY_PRESET",12,{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",name:"FXAA_QUALITY_PS",tokens:["5"]},{type:"define",name:"FXAA_QUALITY_P0",tokens:["1.0"]},{type:"define",name:"FXAA_QUALITY_P1",tokens:["1.5"]},{type:"define",name:"FXAA_QUALITY_P2",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P3",tokens:["4.0"]},{type:"define",
name:"FXAA_QUALITY_P4",tokens:["12.0"]}]}}]},{type:"condition",parts:[{type:"if",expression:["FXAA_QUALITY_PRESET",13,{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",name:"FXAA_QUALITY_PS",tokens:["6"]},{type:"define",name:"FXAA_QUALITY_P0",tokens:["1.0"]},{type:"define",name:"FXAA_QUALITY_P1",tokens:["1.5"]},{type:"define",name:"FXAA_QUALITY_P2",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P3",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P4",tokens:["4.0"]},{type:"define",
name:"FXAA_QUALITY_P5",tokens:["12.0"]}]}}]},{type:"condition",parts:[{type:"if",expression:["FXAA_QUALITY_PRESET",14,{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",name:"FXAA_QUALITY_PS",tokens:["7"]},{type:"define",name:"FXAA_QUALITY_P0",tokens:["1.0"]},{type:"define",name:"FXAA_QUALITY_P1",tokens:["1.5"]},{type:"define",name:"FXAA_QUALITY_P2",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P3",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P4",tokens:["2.0"]},{type:"define",
name:"FXAA_QUALITY_P5",tokens:["4.0"]},{type:"define",name:"FXAA_QUALITY_P6",tokens:["12.0"]}]}}]},{type:"condition",parts:[{type:"if",expression:["FXAA_QUALITY_PRESET",15,{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",name:"FXAA_QUALITY_PS",tokens:["8"]},{type:"define",name:"FXAA_QUALITY_P0",tokens:["1.0"]},{type:"define",name:"FXAA_QUALITY_P1",tokens:["1.5"]},{type:"define",name:"FXAA_QUALITY_P2",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P3",tokens:["2.0"]},{type:"define",
name:"FXAA_QUALITY_P4",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P5",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P6",tokens:["4.0"]},{type:"define",name:"FXAA_QUALITY_P7",tokens:["12.0"]}]}}]},{type:"condition",parts:[{type:"if",expression:["FXAA_QUALITY_PRESET",20,{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",name:"FXAA_QUALITY_PS",tokens:["3"]},{type:"define",name:"FXAA_QUALITY_P0",tokens:["1.5"]},{type:"define",name:"FXAA_QUALITY_P1",tokens:["2.0"]},{type:"define",
name:"FXAA_QUALITY_P2",tokens:["8.0"]}]}}]},{type:"condition",parts:[{type:"if",expression:["FXAA_QUALITY_PRESET",21,{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",name:"FXAA_QUALITY_PS",tokens:["4"]},{type:"define",name:"FXAA_QUALITY_P0",tokens:["1.0"]},{type:"define",name:"FXAA_QUALITY_P1",tokens:["1.5"]},{type:"define",name:"FXAA_QUALITY_P2",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P3",tokens:["8.0"]}]}}]},{type:"condition",parts:[{type:"if",expression:["FXAA_QUALITY_PRESET",
22,{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",name:"FXAA_QUALITY_PS",tokens:["5"]},{type:"define",name:"FXAA_QUALITY_P0",tokens:["1.0"]},{type:"define",name:"FXAA_QUALITY_P1",tokens:["1.5"]},{type:"define",name:"FXAA_QUALITY_P2",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P3",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P4",tokens:["8.0"]}]}}]},{type:"condition",parts:[{type:"if",expression:["FXAA_QUALITY_PRESET",23,{type:"equal_expr",places:2}],group:{type:"group",
parts:[{type:"define",name:"FXAA_QUALITY_PS",tokens:["6"]},{type:"define",name:"FXAA_QUALITY_P0",tokens:["1.0"]},{type:"define",name:"FXAA_QUALITY_P1",tokens:["1.5"]},{type:"define",name:"FXAA_QUALITY_P2",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P3",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P4",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P5",tokens:["8.0"]}]}}]},{type:"condition",parts:[{type:"if",expression:["FXAA_QUALITY_PRESET",24,{type:"equal_expr",places:2}],group:{type:"group",
parts:[{type:"define",name:"FXAA_QUALITY_PS",tokens:["7"]},{type:"define",name:"FXAA_QUALITY_P0",tokens:["1.0"]},{type:"define",name:"FXAA_QUALITY_P1",tokens:["1.5"]},{type:"define",name:"FXAA_QUALITY_P2",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P3",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P4",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P5",tokens:["3.0"]},{type:"define",name:"FXAA_QUALITY_P6",tokens:["8.0"]}]}}]},{type:"condition",parts:[{type:"if",expression:["FXAA_QUALITY_PRESET",
25,{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",name:"FXAA_QUALITY_PS",tokens:["8"]},{type:"define",name:"FXAA_QUALITY_P0",tokens:["1.0"]},{type:"define",name:"FXAA_QUALITY_P1",tokens:["1.5"]},{type:"define",name:"FXAA_QUALITY_P2",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P3",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P4",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P5",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P6",tokens:["4.0"]},{type:"define",
name:"FXAA_QUALITY_P7",tokens:["8.0"]}]}}]},{type:"condition",parts:[{type:"if",expression:["FXAA_QUALITY_PRESET",26,{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",name:"FXAA_QUALITY_PS",tokens:["9"]},{type:"define",name:"FXAA_QUALITY_P0",tokens:["1.0"]},{type:"define",name:"FXAA_QUALITY_P1",tokens:["1.5"]},{type:"define",name:"FXAA_QUALITY_P2",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P3",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P4",tokens:["2.0"]},{type:"define",
name:"FXAA_QUALITY_P5",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P6",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P7",tokens:["4.0"]},{type:"define",name:"FXAA_QUALITY_P8",tokens:["8.0"]}]}}]},{type:"condition",parts:[{type:"if",expression:["FXAA_QUALITY_PRESET",27,{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",name:"FXAA_QUALITY_PS",tokens:["10"]},{type:"define",name:"FXAA_QUALITY_P0",tokens:["1.0"]},{type:"define",name:"FXAA_QUALITY_P1",tokens:["1.5"]},{type:"define",
name:"FXAA_QUALITY_P2",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P3",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P4",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P5",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P6",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P7",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P8",tokens:["4.0"]},{type:"define",name:"FXAA_QUALITY_P9",tokens:["8.0"]}]}}]},{type:"condition",parts:[{type:"if",expression:["FXAA_QUALITY_PRESET",28,{type:"equal_expr",
places:2}],group:{type:"group",parts:[{type:"define",name:"FXAA_QUALITY_PS",tokens:["11"]},{type:"define",name:"FXAA_QUALITY_P0",tokens:["1.0"]},{type:"define",name:"FXAA_QUALITY_P1",tokens:["1.5"]},{type:"define",name:"FXAA_QUALITY_P2",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P3",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P4",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P5",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P6",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P7",
tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P8",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P9",tokens:["4.0"]},{type:"define",name:"FXAA_QUALITY_P10",tokens:["8.0"]}]}}]},{type:"condition",parts:[{type:"if",expression:["FXAA_QUALITY_PRESET",29,{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",name:"FXAA_QUALITY_PS",tokens:["12"]},{type:"define",name:"FXAA_QUALITY_P0",tokens:["1.0"]},{type:"define",name:"FXAA_QUALITY_P1",tokens:["1.5"]},{type:"define",name:"FXAA_QUALITY_P2",
tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P3",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P4",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P5",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P6",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P7",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P8",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P9",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P10",tokens:["4.0"]},{type:"define",name:"FXAA_QUALITY_P11",tokens:["8.0"]}]}}]},
{type:"condition",parts:[{type:"if",expression:["FXAA_QUALITY_PRESET",39,{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",name:"FXAA_QUALITY_PS",tokens:["12"]},{type:"define",name:"FXAA_QUALITY_P0",tokens:["1.0"]},{type:"define",name:"FXAA_QUALITY_P1",tokens:["1.0"]},{type:"define",name:"FXAA_QUALITY_P2",tokens:["1.0"]},{type:"define",name:"FXAA_QUALITY_P3",tokens:["1.0"]},{type:"define",name:"FXAA_QUALITY_P4",tokens:["1.0"]},{type:"define",name:"FXAA_QUALITY_P5",tokens:["1.5"]},
{type:"define",name:"FXAA_QUALITY_P6",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P7",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P8",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P9",tokens:["2.0"]},{type:"define",name:"FXAA_QUALITY_P10",tokens:["4.0"]},{type:"define",name:"FXAA_QUALITY_P11",tokens:["8.0"]}]}}]},{type:"var",name:"FXAA_QUALITY_P12",tokens:["0.0"]},{type:"textline",tokens:"float At ( float As ) { return clamp ( As , 0.0 , 1.0 ) ; }".split(" ")},{type:"condition",parts:[{type:"if",
expression:["FXAA_BLEND4WEB",1,{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"vec4 Aw ( sampler2D Au , vec2 Av ) { return texture2D ( Au , Av ) ; } vec4 AB ( sampler2D Ax , vec2 Ay , vec2 Az , vec2 AA ) { return texture2D ( Ax , Ay + ( Az * AA ) ) ; }".split(" ")}]}}]},{type:"textline",tokens:"vec4 Bh ( vec2 AC , sampler2D AD , vec2 AE , float AF , float AG , float AH ) { bool AI , AJ , AK , AL , AM ; float AN , AO , AP , AQ , AR , AS , AT , AU , AV , AW , AX , AY , AZ , A_ , Ba ; vec4 Bb ; vec2 Bc , Bd , Be , Bf , Bg ; Bc . x = AC . x ; Bc . y = AC . y ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["FXAA_GATHER4_ALPHA",1,{type:"equal_expr",places:2}],group:{type:"group",parts:[]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"Bb = Aw ( AD , Bc ) ; AN = bB ( Bb ) ; AO = bB ( AB ( AD , Bc , vec2 ( 0 , 1 ) , AE . xy ) ) ; AP = bB ( AB ( AD , Bc , vec2 ( 1 , 0 ) , AE . xy ) ) ; AQ = bB ( AB ( AD , Bc , vec2 ( 0 , - 1 ) , AE . xy ) ) ; AR = bB ( AB ( AD , Bc , vec2 ( - 1 , 0 ) , AE . xy ) ) ;".split(" ")}]}}]},{type:"textline",tokens:"AS = max ( AO , AN ) ; AT = min ( AO , AN ) ; AS = max ( AP , AS ) ; AT = min ( AP , AT ) ; AU = max ( AQ , AR ) ; AV = min ( AQ , AR ) ; AS = max ( AU , AS ) ; AT = min ( AV , AT ) ; AV = AS * AG ; AT = AS - AT ; AV = max ( AH , AV ) ; AI = AT < AV ; if ( AI ) return Bb ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["FXAA_GATHER4_ALPHA",0,{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"AV = bB ( AB ( AD , Bc , vec2 ( - 1 , - 1 ) , AE . xy ) ) ; AS = bB ( AB ( AD , Bc , vec2 ( 1 , 1 ) , AE . xy ) ) ; AU = bB ( AB ( AD , Bc , vec2 ( 1 , - 1 ) , AE . xy ) ) ; AW = bB ( AB ( AD , Bc , vec2 ( - 1 , 1 ) , AE . xy ) ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[]}}]},{type:"textline",tokens:"AX = AQ + AO ; AY = AR + AP ; AT = 1.0 / AT ; AZ = AX + AY ; AX = ( - 2.0 * AN ) + AX ; AY = ( - 2.0 * AN ) + AY ; A_ = AU + AS ; AU = AV + AU ; Ba = ( - 2.0 * AP ) + A_ ; AU = ( - 2.0 * AQ ) + AU ; AV = AV + AW ; AS = AW + AS ; Ba = ( abs ( AX ) * 2.0 ) + abs ( Ba ) ; AU = ( abs ( AY ) * 2.0 ) + abs ( AU ) ; AY = ( - 2.0 * AR ) + AV ; AS = ( - 2.0 * AO ) + AS ; Ba = abs ( AY ) + Ba ; AU = abs ( AS ) + AU ; A_ = AV + A_ ; AV = AE . x ; AI = Ba >= AU ; A_ = AZ * 2.0 + A_ ; if ( ! AI ) AQ = AR ; if ( ! AI ) AO = AP ; if ( AI ) AV = AE . y ; A_ = ( A_ * ( 1.0 / 12.0 ) ) - AN ; AP = AQ - AN ; AR = AO - AN ; AQ = AQ + AN ; AO = AO + AN ; AJ = abs ( AP ) >= abs ( AR ) ; AR = max ( abs ( AP ) , abs ( AR ) ) ; if ( AJ ) AV = - AV ; AT = At ( abs ( A_ ) * AT ) ; Bd . x = Bc . x ; Bd . y = Bc . y ; Be . x = ( ! AI ) ? 0.0 : AE . x ; Be . y = ( AI ) ? 0.0 : AE . y ; if ( ! AI ) Bd . x += AV * 0.5 ; if ( AI ) Bd . y += AV * 0.5 ; Bf . x = Bd . x - Be . x * FXAA_QUALITY_P0 ; Bf . y = Bd . y - Be . y * FXAA_QUALITY_P0 ; Bg . x = Bd . x + Be . x * FXAA_QUALITY_P0 ; Bg . y = Bd . y + Be . y * FXAA_QUALITY_P0 ; A_ = ( ( - 2.0 ) * AT ) + 3.0 ; AP = bB ( Aw ( AD , Bf ) ) ; AT = AT * AT ; AZ = bB ( Aw ( AD , Bg ) ) ; if ( ! AJ ) AQ = AO ; AR = AR * 1.0 / 4.0 ; AO = AN - AQ * 0.5 ; AT = A_ * AT ; AJ = AO < 0.0 ; AP -= AQ * 0.5 ; AZ -= AQ * 0.5 ; AK = abs ( AP ) >= AR ; AL = abs ( AZ ) >= AR ; if ( ! AK ) Bf . x -= Be . x * FXAA_QUALITY_P1 ; if ( ! AK ) Bf . y -= Be . y * FXAA_QUALITY_P1 ; AM = ( ! AK ) || ( ! AL ) ; if ( ! AL ) Bg . x += Be . x * FXAA_QUALITY_P1 ; if ( ! AL ) Bg . y += Be . y * FXAA_QUALITY_P1 ; if ( AM ) { if ( ! AK ) AP = bB ( Aw ( AD , Bf . xy ) ) ; if ( ! AL ) AZ = bB ( Aw ( AD , Bg . xy ) ) ; if ( ! AK ) AP = AP - AQ * 0.5 ; if ( ! AL ) AZ = AZ - AQ * 0.5 ; AK = abs ( AP ) >= AR ; AL = abs ( AZ ) >= AR ; if ( ! AK ) Bf . x -= Be . x * FXAA_QUALITY_P2 ; if ( ! AK ) Bf . y -= Be . y * FXAA_QUALITY_P2 ; AM = ( ! AK ) || ( ! AL ) ; if ( ! AL ) Bg . x += Be . x * FXAA_QUALITY_P2 ; if ( ! AL ) Bg . y += Be . y * FXAA_QUALITY_P2 ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["FXAA_QUALITY_PS",3,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"if ( AM ) { if ( ! AK ) AP = bB ( Aw ( AD , Bf . xy ) ) ; if ( ! AL ) AZ = bB ( Aw ( AD , Bg . xy ) ) ; if ( ! AK ) AP = AP - AQ * 0.5 ; if ( ! AL ) AZ = AZ - AQ * 0.5 ; AK = abs ( AP ) >= AR ; AL = abs ( AZ ) >= AR ; if ( ! AK ) Bf . x -= Be . x * FXAA_QUALITY_P3 ; if ( ! AK ) Bf . y -= Be . y * FXAA_QUALITY_P3 ; AM = ( ! AK ) || ( ! AL ) ; if ( ! AL ) Bg . x += Be . x * FXAA_QUALITY_P3 ; if ( ! AL ) Bg . y += Be . y * FXAA_QUALITY_P3 ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["FXAA_QUALITY_PS",4,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"if ( AM ) { if ( ! AK ) AP = bB ( Aw ( AD , Bf . xy ) ) ; if ( ! AL ) AZ = bB ( Aw ( AD , Bg . xy ) ) ; if ( ! AK ) AP = AP - AQ * 0.5 ; if ( ! AL ) AZ = AZ - AQ * 0.5 ; AK = abs ( AP ) >= AR ; AL = abs ( AZ ) >= AR ; if ( ! AK ) Bf . x -= Be . x * FXAA_QUALITY_P4 ; if ( ! AK ) Bf . y -= Be . y * FXAA_QUALITY_P4 ; AM = ( ! AK ) || ( ! AL ) ; if ( ! AL ) Bg . x += Be . x * FXAA_QUALITY_P4 ; if ( ! AL ) Bg . y += Be . y * FXAA_QUALITY_P4 ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["FXAA_QUALITY_PS",5,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"if ( AM ) { if ( ! AK ) AP = bB ( Aw ( AD , Bf . xy ) ) ; if ( ! AL ) AZ = bB ( Aw ( AD , Bg . xy ) ) ; if ( ! AK ) AP = AP - AQ * 0.5 ; if ( ! AL ) AZ = AZ - AQ * 0.5 ; AK = abs ( AP ) >= AR ; AL = abs ( AZ ) >= AR ; if ( ! AK ) Bf . x -= Be . x * FXAA_QUALITY_P5 ; if ( ! AK ) Bf . y -= Be . y * FXAA_QUALITY_P5 ; AM = ( ! AK ) || ( ! AL ) ; if ( ! AL ) Bg . x += Be . x * FXAA_QUALITY_P5 ; if ( ! AL ) Bg . y += Be . y * FXAA_QUALITY_P5 ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["FXAA_QUALITY_PS",6,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"if ( AM ) { if ( ! AK ) AP = bB ( Aw ( AD , Bf . xy ) ) ; if ( ! AL ) AZ = bB ( Aw ( AD , Bg . xy ) ) ; if ( ! AK ) AP = AP - AQ * 0.5 ; if ( ! AL ) AZ = AZ - AQ * 0.5 ; AK = abs ( AP ) >= AR ; AL = abs ( AZ ) >= AR ; if ( ! AK ) Bf . x -= Be . x * FXAA_QUALITY_P6 ; if ( ! AK ) Bf . y -= Be . y * FXAA_QUALITY_P6 ; AM = ( ! AK ) || ( ! AL ) ; if ( ! AL ) Bg . x += Be . x * FXAA_QUALITY_P6 ; if ( ! AL ) Bg . y += Be . y * FXAA_QUALITY_P6 ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["FXAA_QUALITY_PS",7,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"if ( AM ) { if ( ! AK ) AP = bB ( Aw ( AD , Bf . xy ) ) ; if ( ! AL ) AZ = bB ( Aw ( AD , Bg . xy ) ) ; if ( ! AK ) AP = AP - AQ * 0.5 ; if ( ! AL ) AZ = AZ - AQ * 0.5 ; AK = abs ( AP ) >= AR ; AL = abs ( AZ ) >= AR ; if ( ! AK ) Bf . x -= Be . x * FXAA_QUALITY_P7 ; if ( ! AK ) Bf . y -= Be . y * FXAA_QUALITY_P7 ; AM = ( ! AK ) || ( ! AL ) ; if ( ! AL ) Bg . x += Be . x * FXAA_QUALITY_P7 ; if ( ! AL ) Bg . y += Be . y * FXAA_QUALITY_P7 ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["FXAA_QUALITY_PS",8,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"if ( AM ) { if ( ! AK ) AP = bB ( Aw ( AD , Bf . xy ) ) ; if ( ! AL ) AZ = bB ( Aw ( AD , Bg . xy ) ) ; if ( ! AK ) AP = AP - AQ * 0.5 ; if ( ! AL ) AZ = AZ - AQ * 0.5 ; AK = abs ( AP ) >= AR ; AL = abs ( AZ ) >= AR ; if ( ! AK ) Bf . x -= Be . x * FXAA_QUALITY_P8 ; if ( ! AK ) Bf . y -= Be . y * FXAA_QUALITY_P8 ; AM = ( ! AK ) || ( ! AL ) ; if ( ! AL ) Bg . x += Be . x * FXAA_QUALITY_P8 ; if ( ! AL ) Bg . y += Be . y * FXAA_QUALITY_P8 ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["FXAA_QUALITY_PS",9,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"if ( AM ) { if ( ! AK ) AP = bB ( Aw ( AD , Bf . xy ) ) ; if ( ! AL ) AZ = bB ( Aw ( AD , Bg . xy ) ) ; if ( ! AK ) AP = AP - AQ * 0.5 ; if ( ! AL ) AZ = AZ - AQ * 0.5 ; AK = abs ( AP ) >= AR ; AL = abs ( AZ ) >= AR ; if ( ! AK ) Bf . x -= Be . x * FXAA_QUALITY_P9 ; if ( ! AK ) Bf . y -= Be . y * FXAA_QUALITY_P9 ; AM = ( ! AK ) || ( ! AL ) ; if ( ! AL ) Bg . x += Be . x * FXAA_QUALITY_P9 ; if ( ! AL ) Bg . y += Be . y * FXAA_QUALITY_P9 ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["FXAA_QUALITY_PS",10,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"if ( AM ) { if ( ! AK ) AP = bB ( Aw ( AD , Bf . xy ) ) ; if ( ! AL ) AZ = bB ( Aw ( AD , Bg . xy ) ) ; if ( ! AK ) AP = AP - AQ * 0.5 ; if ( ! AL ) AZ = AZ - AQ * 0.5 ; AK = abs ( AP ) >= AR ; AL = abs ( AZ ) >= AR ; if ( ! AK ) Bf . x -= Be . x * FXAA_QUALITY_P10 ; if ( ! AK ) Bf . y -= Be . y * FXAA_QUALITY_P10 ; AM = ( ! AK ) || ( ! AL ) ; if ( ! AL ) Bg . x += Be . x * FXAA_QUALITY_P10 ; if ( ! AL ) Bg . y += Be . y * FXAA_QUALITY_P10 ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["FXAA_QUALITY_PS",11,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"if ( AM ) { if ( ! AK ) AP = bB ( Aw ( AD , Bf . xy ) ) ; if ( ! AL ) AZ = bB ( Aw ( AD , Bg . xy ) ) ; if ( ! AK ) AP = AP - AQ * 0.5 ; if ( ! AL ) AZ = AZ - AQ * 0.5 ; AK = abs ( AP ) >= AR ; AL = abs ( AZ ) >= AR ; if ( ! AK ) Bf . x -= Be . x * FXAA_QUALITY_P11 ; if ( ! AK ) Bf . y -= Be . y * FXAA_QUALITY_P11 ; AM = ( ! AK ) || ( ! AL ) ; if ( ! AL ) Bg . x += Be . x * FXAA_QUALITY_P11 ; if ( ! AL ) Bg . y += Be . y * FXAA_QUALITY_P11 ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["FXAA_QUALITY_PS",12,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"if ( AM ) { if ( ! AK ) AP = bB ( Aw ( AD , Bf . xy ) ) ; if ( ! AL ) AZ = bB ( Aw ( AD , Bg . xy ) ) ; if ( ! AK ) AP = AP - AQ * 0.5 ; if ( ! AL ) AZ = AZ - AQ * 0.5 ; AK = abs ( AP ) >= AR ; AL = abs ( AZ ) >= AR ; if ( ! AK ) Bf . x -= Be . x * FXAA_QUALITY_P12 ; if ( ! AK ) Bf . y -= Be . y * FXAA_QUALITY_P12 ; AM = ( ! AK ) || ( ! AL ) ; if ( ! AL ) Bg . x += Be . x * FXAA_QUALITY_P12 ; if ( ! AL ) Bg . y += Be . y * FXAA_QUALITY_P12 ; }".split(" ")}]}}]},
{type:"textline",tokens:["}"]}]}}]},{type:"textline",tokens:["}"]}]}}]},{type:"textline",tokens:["}"]}]}}]},{type:"textline",tokens:["}"]}]}}]},{type:"textline",tokens:["}"]}]}}]},{type:"textline",tokens:["}"]}]}}]},{type:"textline",tokens:["}"]}]}}]},{type:"textline",tokens:["}"]}]}}]},{type:"textline",tokens:["}"]}]}}]},{type:"textline",tokens:"} AR = Bc . x - Bf . x ; AQ = Bg . x - Bc . x ; if ( ! AI ) AR = Bc . y - Bf . y ; if ( ! AI ) AQ = Bg . y - Bc . y ; AL = ( AP < 0.0 ) != AJ ; AP = ( AQ + AR ) ; AJ = ( AZ < 0.0 ) != AJ ; AP = 1.0 / AP ; AK = AR < AQ ; AQ = min ( AR , AQ ) ; AJ = AK ? AL : AJ ; AT = AT * AT ; AP = ( AQ * ( - AP ) ) + 0.5 ; AT = AT * AF ; AP = AJ ? AP : 0.0 ; AT = max ( AP , AT ) ; if ( ! AI ) Bc . x += AT * AV ; if ( AI ) Bc . y += AT * AV ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["FXAA_DISCARD",1,{type:"equal_expr",places:2},"FXAA_BLEND4WEB",1,{type:"equal_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return Aw ( AD , Bc ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"return vec4 ( Aw ( AD , Bc ) . xyz , AN ) ;".split(" ")}]}}]},{type:"textline",tokens:["}"]}]};a["include/depth_fetch.glslf"]={type:"group",parts:[{type:"textline",tokens:"float Bo ( in sampler2D Bi , in vec2 Bj , in vec2 Bk ) { float Bl , Bm , Bn ; Bl = texture2D ( Bi , Bj ) . r ; Bm = Bk . x ; Bn = Bk . y ; Bm = 2.0 * Bm / ( Bm + Bn - ( 2.0 * Bl - 1.0 ) * ( Bn - Bm ) ) ; return Bm ; }".split(" ")}]}};b4w.module.animation=function(a,p){var t=p("__animation"),c=p("__armature"),b=p("__obj_util"),k=p("__print"),d=p("__tsr");a.SLOT_0=t.SLOT_0;a.SLOT_1=t.SLOT_1;a.SLOT_2=t.SLOT_2;a.SLOT_3=t.SLOT_3;a.SLOT_4=t.SLOT_4;a.SLOT_5=t.SLOT_5;a.SLOT_6=t.SLOT_6;a.SLOT_7=t.SLOT_7;a.SLOT_ALL=t.SLOT_ALL;a.OBJ_ANIM_TYPE_NONE=t.OBJ_ANIM_TYPE_NONE;a.OBJ_ANIM_TYPE_ARMATURE=t.OBJ_ANIM_TYPE_ARMATURE;a.OBJ_ANIM_TYPE_OBJECT=t.OBJ_ANIM_TYPE_OBJECT;a.OBJ_ANIM_TYPE_VERTEX=t.OBJ_ANIM_TYPE_VERTEX;a.OBJ_ANIM_TYPE_SOUND=t.OBJ_ANIM_TYPE_SOUND;
a.OBJ_ANIM_TYPE_PARTICLES=t.OBJ_ANIM_TYPE_PARTICLES;a.OBJ_ANIM_TYPE_MATERIAL=t.OBJ_ANIM_TYPE_MATERIAL;a.AB_CYCLIC=t.AB_CYCLIC;a.AB_FINISH_RESET=t.AB_FINISH_RESET;a.AB_FINISH_STOP=t.AB_FINISH_STOP;var l=d.create();a.is_animated=function(a){return t.is_animated(a)};a.get_anim_names=function(a){return t.obj_is_animatable(a)?t.get_anim_names(a):[]};a.get_current_anim_name=function(a,b){if(!t.is_animated(a))return null;b=b||t.SLOT_0;return t.get_anim_by_slot_num(a,b)};a.apply=function(a,b,c){if(c>t.SLOT_7)k.error("Can't apply animation to slot "+
c+' for object "'+a.name+'". Object can have maximum of 8 animation slots');else{c=c||t.SLOT_0;if(t.is_animated(a)){var d=t.get_slot_num_by_anim(a,b);if(-1!=d&&d!=c){k.error('Animation "'+b+'" is already applied to object "'+a.name+'" (slot "'+d+'").');return}}t.validate_action_by_name(a,b)?t.apply(a,b,c):k.error('No fcurves in action "'+b+'"')}};a.remove=function(a){t.remove(a)};a.remove_slot_animation=function(a,b){t.is_animated(a)&&(b=b||t.SLOT_0,t.remove_slot_animation(a,b))};a.apply_def=function(a){t.apply_def(a)};
a.play=function(a,b,c){t.is_animated(a)?(c=c||t.SLOT_0,t.play(a,b,c),t.update_object_animation(a,0,c,!0)):k.error('Object "'+a.name+'" has no applied animation')};a.stop=function(a,b){t.is_animated(a)&&(b=b||t.SLOT_0,t.stop(a,b))};a.is_play=function(a,b){if(!t.is_animated(a))return!1;b=b||t.SLOT_0;return t.is_play(a,b)};a.set_frame=function(a,b,c){t.is_animated(a)&&(c=c||t.SLOT_0,t.set_frame(a,b,c))};a.set_first_frame=function(a,b){t.is_animated(a)&&t.set_first_frame(a,b)};a.set_last_frame=function(a,
b){if(t.is_animated(a)){b=b||t.SLOT_0;var c=t.get_anim_start_frame(a,b),d=t.get_anim_length(a,b);t.set_frame(a,c+d-t.LAST_FRAME_EPSILON,b)}};a.get_frame=function(a,b){if(!t.is_animated(a))return 0;b=b||t.SLOT_0;return t.get_current_frame_float(a,b)};a.set_speed=function(a,b,c){t.is_animated(a)&&(c=c||t.SLOT_0,t.set_speed(a,b||1,c))};a.get_speed=function(a,b){if(!t.is_animated(a))return 0;b=b||t.SLOT_0;return a.anim_slots[b]?t.get_speed(a,b):0};a.get_anim_start_frame=function(a,b){return t.is_animated(a)&&
(b=b||t.SLOT_0,a.anim_slots[b])?t.get_anim_start_frame(a,b):-1};a.get_anim_length=function(a,b){return t.is_animated(a)&&(b=b||t.SLOT_0,a.anim_slots[b])?t.get_anim_length(a,b):-1};a.set_behavior=function(a,b,c){t.is_animated(a)&&(c=c||t.SLOT_0,t.set_behavior(a,b,c))};a.get_behavior=function(a,b){if(!t.is_animated(a))return null;b=b||t.SLOT_0;return t.get_behavior(a,b)};a.apply_smoothing=function(a,b,c,d){d=d||t.SLOT_0;t.is_animated(a)&&t.apply_smoothing(a,b,c,d)};a.frame_to_sec=function(a){return t.frame_to_sec(a)};
a.get_bone_translation=function(a,d,g){k.error_deprecated("get_bone_translation","armature.get_bone_tsr");if(!b.is_armature(a))return null;if(!c.check_bone(a,d))return k.error('There is no bone: "',d,'" in "',a.name,'".'),null;g||(g=new Float32Array(3));c.get_bone_tsr(a,d,!1,!1,l);g[0]=l[0];g[1]=l[1];g[2]=l[2];return g};a.get_first_armature_object=function(a){k.error_once("get_first_armature_object() deprecated");return null};a.get_slot_num_by_anim=function(a,b){return t.is_animated(a)&&b?t.get_slot_num_by_anim(a,
b):null};a.get_anim_type=function(a,b){return t.is_animated(a)?t.get_anim_type(a,b):null};a.apply_to_first_empty_slot=function(a,b){return t.apply_to_first_empty_slot(a,b)};a.get_skel_mix_factor=function(a){return a.render.anim_mix_factor};a.set_skel_mix_factor=function(a,c,d){b.is_armature(a)?(c=Math.min(Math.max(c,0),1),a.render.anim_mix_factor!=c&&t.set_skel_mix_factor(a,c,d||0)):k.error("Can't blend animation. Object \""+a.name+'" is not armature')}};b4w.module.anchors=function(a,p){var t=p("__anchors");p("__print");a.attach_move_cb=t.attach_move_cb;a.detach_move_cb=t.detach_move_cb;a.is_anchor=t.is_anchor;a.get_element_id=t.get_element_id};b4w.module.armature=function(a,p){var t=p("__armature"),c=p("__obj_util"),b=p("__transform"),k=p("__print");a.get_bone_tsr=function(a,b,q){if(!c.is_armature(a))return null;if(!t.check_bone(a,b))return k.error('There is no bone: "',b,'" in "',a.name,'".'),null;q||(q=new Float32Array(8));t.get_bone_tsr(a,b,!1,!1,q);return q};a.get_bone_tsr_rel=function(a,b,q){if(!c.is_armature(a))return null;if(!t.check_bone(a,b))return k.error('There is no bone: "',b,'" in "',a.name,'".'),null;q||(q=new Float32Array(8));
t.get_bone_tsr(a,b,!1,!0,q);return q};a.set_bone_tsr=function(a,l,q){c.is_armature(a)&&(t.check_bone(a,l)?(t.set_bone_tsr(a,l,q,!1),b.update_transform(a)):k.error('There is no bone: "',l,'" in "',a.name,'".'))};a.set_bone_tsr_rel=function(a,l,q){c.is_armature(a)&&(t.check_bone(a,l)?(t.set_bone_tsr(a,l,q,!0),b.update_transform(a)):k.error('There is no bone: "',l,'" in "',a.name,'".'))}};b4w.module.assets=function(a,p){var t=p("__assets");a.AT_ARRAYBUFFER=t.AT_ARRAYBUFFER;a.AT_JSON=t.AT_JSON;a.AT_TEXT=t.AT_TEXT;a.AT_AUDIOBUFFER=t.AT_AUDIOBUFFER;a.AT_IMAGE_ELEMENT=t.AT_IMAGE_ELEMENT;a.AT_AUDIO_ELEMENT=t.AT_AUDIO_ELEMENT;a.enqueue=function(a,b,k,d){if(a.length)if(a.id)t.enqueue(a,b,k,d);else{for(var l=[],q=0;q<a.length;q++){var p=a[q];l.push({id:p[0],type:p[1],url:p[2],request:p.request?p.request:"GET",post_type:null,post_data:null,param:p[3]})}t.enqueue(l,b,k,d)}}};b4w.module.camera=function(a,p){function t(a,b){r.error_deprecated("camera.set_pivot","camera.target_set_trans_pivot");c.is_target_camera(a)?(h.copy(b,a.render.pivot),g.update_transform(a),q.sync_transform(a)):r.error("set_pivot(): Wrong object or camera move style")}var c=p("__camera");p("__config");var b=p("__constraints"),k=p("__container");p("__mat3");var d=p("__mat4"),l=p("__obj_util"),q=p("__physics"),r=p("__print"),g=p("__transform"),C=p("__tsr"),f=p("__util"),h=p("__vec3"),n=p("__vec4"),A=
new Float32Array(2),B=new Float32Array(3),F=new Float32Array(3);new Float32Array(4);new Float32Array(9);var D={};a.MS_STATIC=c.MS_STATIC;a.MS_TARGET_CONTROLS=c.MS_TARGET_CONTROLS;a.MS_EYE_CONTROLS=c.MS_EYE_CONTROLS;a.MS_HOVER_CONTROLS=c.MS_HOVER_CONTROLS;a.static_set_look_at=function(a,b,d){c.is_static_camera(a)?(b=b||C.get_trans_view(a.render.world_tsr),c.set_look_at(a,b,d),g.update_transform(a),q.sync_transform(a)):r.error("static_set_look_at(): Wrong camera object or camera move style")};a.static_set_rotation=
function(a,b){c.is_static_camera(a)?(g.set_rotation(a,b),g.update_transform(a),q.sync_transform(a)):r.error("static_set_rotation(): Wrong camera object or camera move style")};a.static_get_rotation=function(a,b){if(!c.is_static_camera(a))return r.error("static_get_rotation(): Wrong camera object or camera move style"),null;b=b||new Float32Array(4);return g.get_rotation(a,b)};a.eye_set_look_at=function(a,d,f){c.is_eye_camera(a)?(d=d||C.get_trans_view(a.render.world_tsr),c.set_look_at(a,d,f),b.correct_up(a,
a.render.vertical_axis,!0),g.update_transform(a),q.sync_transform(a)):r.error("eye_set_look_at(): Wrong camera object or camera move style")};a.eye_rotate=function(a,b,d,f,h){c.is_eye_camera(a)?(c.rotate_eye_camera(a,b,d,f||!1,h||!1),g.update_transform(a),q.sync_transform(a)):r.error("eye_rotate(): Wrong camera object or camera move style")};a.eye_set_vertical_limits=function(a,b){if(c.is_eye_camera(a)){var d=a.render;b?"number"!=typeof b.down||"number"!=typeof b.up?r.error("eye_set_vertical_limits(): Incorrect limits object."):
(d.vertical_limits=d.vertical_limits||{},d.vertical_limits.down=b.down,d.vertical_limits.up=b.up,d.vertical_limits.down_local=b.down,d.vertical_limits.up_local=b.up,d.vertical_limits.camera_space=Boolean(b.camera_space),c.prepare_vertical_limits(a),g.update_transform(a),q.sync_transform(a)):d.vertical_limits=null}else r.error("eye_set_vertical_limits(): Wrong camera object or camera move style")};a.eye_get_vertical_limits=function(a,b,d){if(!c.is_eye_camera(a))return r.error("eye_get_vertical_limits(): Wrong camera object or camera move style"),
null;a=a.render;return a.vertical_limits?(b=b||{},d?(b.down=a.vertical_limits.down_local,b.up=a.vertical_limits.up_local):(b.down=a.vertical_limits.down,b.up=a.vertical_limits.up),b.camera_space=d||!1,b):null};a.eye_set_horizontal_limits=function(a,b){if(c.is_eye_camera(a)){var d=a.render;b?"number"!=typeof b.left||"number"!=typeof b.right?r.error("eye_set_horizontal_limits(): Incorrect limits object."):(d.horizontal_limits=d.horizontal_limits||{},d.horizontal_limits.left=b.left,d.horizontal_limits.right=
b.right,d.horizontal_limits.left_local=b.left,d.horizontal_limits.right_local=b.right,d.horizontal_limits.camera_space=Boolean(b.camera_space),c.prepare_horizontal_limits(a),g.update_transform(a),q.sync_transform(a)):d.horizontal_limits=null}else r.error("eye_set_horizontal_limits(): Wrong camera object or camera move style")};a.eye_get_horizontal_limits=function(a,b,d){if(!c.is_eye_camera(a))return r.error("eye_get_horizontal_limits(): Wrong camera object or camera move style"),null;a=a.render;return a.horizontal_limits?
(b=b||{},d?(b.left=a.horizontal_limits.left_local,b.right=a.horizontal_limits.right_local):(b.left=a.horizontal_limits.left,b.right=a.horizontal_limits.right),b.camera_space=d||!1,b):null};a.target_rotate=function(a,b,d,f,h){c.is_target_camera(a)?(c.rotate_target_camera(a,b,d,f||!1,h||!1),g.update_transform(a),q.sync_transform(a)):r.error("target_rotate(): Wrong camera object or camera move style")};a.target_set_trans_pivot=function(a,b,d){c.is_target_camera(a)?(b=b||C.get_trans_view(a.render.world_tsr),
d=d||a.render.pivot,c.set_trans_pivot(a,b,d),g.update_transform(a),q.sync_transform(a)):r.error("target_set_trans_pivot(): Wrong camera object or camera move style")};a.target_set_distance=function(a,b){if(c.is_target_camera(a)){var d=g.obj_point_distance(a,a.render.pivot),f=Math.max(0,b);g.move_local(a,0,f-d,0);g.update_transform(a);q.sync_transform(a)}else r.error("target_set_distance(): Wrong camera object or camera move style")};a.target_get_distance=function(a){return c.is_target_camera(a)?g.obj_point_distance(a,
a.render.pivot):(r.error("target_get_distance(): Wrong camera object or camera move style"),0)};a.target_zoom_object=function(a,b){if(c.is_target_camera(a)){var d=g.get_object_center(b,!1,B),f=g.get_object_size(b),h=c.get_angular_diameter(a)/2,f=f/Math.sin(h),h=g.obj_point_distance(a,d);c.set_trans_pivot(a,C.get_trans_view(a.render.world_tsr),d);g.update_transform(a);g.move_local(a,0,f-h,0);g.update_transform(a);q.sync_transform(a)}else r.error("target_zoom_object(): Wrong camera object or camera move style")};
a.target_get_pivot=function(a,b){if(!c.is_target_camera(a))return r.error("target_get_pivot(): Wrong camera object or camera move style"),null;b=b||new Float32Array(3);h.copy(a.render.pivot,b);return b};a.target_set_distance_limits=function(a,b){c.is_target_camera(a)?b&&("number"!=typeof b.min||"number"!=typeof b.max||b.min>b.max)?r.error("target_set_distance_limits(): Wrong limits object"):(c.apply_distance_limits(a,b),g.update_transform(a),q.sync_transform(a)):r.error("target_set_distance_limits(): Wrong camera object or camera move style")};
a.target_get_distance_limits=function(a,b){if(!c.is_target_camera(a))return r.error("target_get_distance_limits(): Wrong camera object or camera move style"),null;var d=a.render;return d.distance_limits?(b=b||{},b.min=d.distance_limits.min,b.max=d.distance_limits.max,b):null};a.target_set_vertical_limits=function(a,b){if(c.is_target_camera(a)){var d=a.render;b?"number"!=typeof b.down||"number"!=typeof b.up?r.error("target_set_vertical_limits(): Wrong limits object"):(d.vertical_limits=d.vertical_limits||
{},d.vertical_limits.down=b.down,d.vertical_limits.up=b.up,d.vertical_limits.down_local=b.down,d.vertical_limits.up_local=b.up,d.vertical_limits.camera_space=Boolean(b.camera_space),c.prepare_vertical_limits(a),g.update_transform(a),q.sync_transform(a)):d.vertical_limits=null}else r.error("target_set_vertical_limits(): Wrong camera object or camera move style")};a.target_get_vertical_limits=function(a,b,d){if(!c.is_target_camera(a))return r.error("target_get_vertical_limits(): Wrong camera object or camera move style"),
null;a=a.render;return a.vertical_limits?(b=b||{},d?(b.down=a.vertical_limits.down_local,b.up=a.vertical_limits.up_local):(b.down=a.vertical_limits.down,b.up=a.vertical_limits.up),b.camera_space=d||!1,b):null};a.target_set_horizontal_limits=function(a,b){if(c.is_target_camera(a)){var d=a.render;b?"number"!=typeof b.left||"number"!=typeof b.right?r.error("target_set_horizontal_limits(): Wrong limits object"):(d.horizontal_limits=d.horizontal_limits||{},d.horizontal_limits.left=b.left,d.horizontal_limits.right=
b.right,d.horizontal_limits.left_local=b.left,d.horizontal_limits.right_local=b.right,d.horizontal_limits.camera_space=Boolean(b.camera_space),c.prepare_horizontal_limits(a),g.update_transform(a),q.sync_transform(a)):d.horizontal_limits=null}else r.error("target_set_horizontal_limits(): Wrong camera object or camera move style")};a.target_get_horizontal_limits=function(a,b,d){if(!c.is_target_camera(a))return r.error("target_get_horizontal_limits(): Wrong camera object or camera move style"),null;
a=a.render;return a.horizontal_limits?(b=b||{},d?(b.left=a.horizontal_limits.left_local,b.right=a.horizontal_limits.right_local):(b.left=a.horizontal_limits.left,b.right=a.horizontal_limits.right),b.camera_space=d||!1,b):null};a.hover_rotate=function(a,b,d,f,h){c.is_hover_camera(a)?(c.rotate_hover_camera(a,b,d,f||!1,h||!1),g.update_transform(a),q.sync_transform(a)):r.error("hover_rotate(): Wrong camera object or camera move style")};a.hover_set_pivot_translation=function(a,b){c.is_hover_camera(a)?
(c.set_hover_pivot(a,b),g.update_transform(a),q.sync_transform(a)):r.error("hover_set_pivot_translation(): Wrong camera object or camera move style")};a.hover_get_pivot=function(a,b){if(!c.is_hover_camera(a))return r.error("hover_get_pivot(): Wrong camera object or camera move style"),null;b=b||new Float32Array(3);h.copy(a.render.hover_pivot,b);return b};a.hover_get_distance=function(a){return c.is_hover_camera(a)?g.obj_point_distance(a,a.render.hover_pivot):(r.error("hover_get_distance(): Wrong camera object or camera move style"),
0)};a.hover_set_vertical_limits=function(a,b){c.is_hover_camera(a)?"number"!=typeof b.down||"number"!=typeof b.up||b.down<b.up?r.error("hover_set_vertical_limits(): Wrong limits object"):(c.hover_set_vertical_limits(a,b),g.update_transform(a),q.sync_transform(a)):r.error("hover_set_vertical_limits(): Wrong camera object or camera move style")};a.hover_get_vertical_limits=function(a,b){if(!c.is_hover_camera(a))return r.error("hover_get_vertical_limits(): Wrong camera object or camera move style"),
null;var d=a.render;b=b||{};b.down=d.vertical_limits.down;b.up=d.vertical_limits.up;return b};a.hover_set_distance_limits=function(a,b){c.is_hover_camera(a)?"number"!=typeof b.min||"number"!=typeof b.max||b.min>b.max?r.error("hover_set_distance_limits(): Wrong limits object"):(c.apply_distance_limits(a,b),g.update_transform(a),q.sync_transform(a)):r.error("hover_set_distance_limits(): Wrong camera object or camera move style")};a.hover_get_distance_limits=function(a,b){if(!c.is_hover_camera(a))return r.error("hover_get_distance_limits(): Wrong camera object or camera move style"),
null;var d=a.render;b=b||{};b.min=d.distance_limits.min;b.max=d.distance_limits.max;return b};a.hover_set_vert_trans_limits=function(a,b){if(c.is_hover_camera(a)){var d=a.render;b?"number"!=typeof b.min||"number"!=typeof b.max||b.min>b.max?r.error("hover_set_vert_trans_limits(): Wrong limits object"):(d.hover_vert_trans_limits=d.hover_vert_trans_limits||{},d.hover_vert_trans_limits.min=b.min,d.hover_vert_trans_limits.max=b.max,g.update_transform(a),q.sync_transform(a)):d.hover_vert_trans_limits=null}else r.error("hover_set_vert_trans_limits(): Wrong camera object or camera move style")};
a.hover_get_vert_trans_limits=function(a,b){if(!c.is_hover_camera(a))return r.error("hover_get_vert_trans_limits(): Wrong camera object or camera move style"),null;var d=a.render;return d.hover_vert_trans_limits?(b=b||{},b.min=d.hover_vert_trans_limits.min,b.max=d.hover_vert_trans_limits.max,b):null};a.hover_set_horiz_trans_limits=function(a,b){if(c.is_hover_camera(a)){var d=a.render;b?"number"!=typeof b.min||"number"!=typeof b.max||b.min>b.max?r.error("hover_set_horiz_trans_limits(): Wrong limits object"):
(d.hover_horiz_trans_limits=d.hover_horiz_trans_limits||{},d.hover_horiz_trans_limits.min=b.min,d.hover_horiz_trans_limits.max=b.max,g.update_transform(a),q.sync_transform(a)):d.hover_horiz_trans_limits=null}else r.error("hover_set_horiz_trans_limits(): Wrong camera object or camera move style")};a.hover_get_horiz_trans_limits=function(a,b){if(!c.is_hover_camera(a))return r.error("hover_get_horiz_trans_limits(): Wrong camera object or camera move style"),null;var d=a.render;return d.hover_horiz_trans_limits?
(b=b||{},b.min=d.hover_horiz_trans_limits.min,b.max=d.hover_horiz_trans_limits.max,b):null};a.hover_switch_horiz_rotation=function(a,b){if(!c.is_hover_camera(a))return r.error("hover_switch_horiz_rotation(): Wrong camera object or camera move style"),null;a.render.enable_hover_hor_rotation=b};a.is_static_camera=c.is_static_camera;a.is_target_camera=c.is_target_camera;a.is_eye_camera=c.is_eye_camera;a.is_hover_camera=c.is_hover_camera;a.set_move_style=function(a,b){if(!l.is_camera(a))return r.error("set_move_style(): Wrong camera object"),
!1;if(b!=c.MS_STATIC&&b!=c.MS_EYE_CONTROLS&&b!=c.MS_TARGET_CONTROLS&&b!=c.MS_HOVER_CONTROLS)return r.error("set_move_style(): Wrong move style"),!1;c.set_move_style(a,b);g.update_transform(a);q.sync_transform(a);return!0};a.get_move_style=function(a){return l.is_camera(a)?c.get_move_style(a):(r.error("get_move_style(): Wrong camera object"),null)};a.set_translation=function(a,b){if(l.is_camera(a)){var d=a.render;if(c.is_target_camera(a)){var f=C.get_trans_view(d.world_tsr),f=h.subtract(b,f,B);h.add(f,
d.pivot,d.pivot)}else c.is_hover_camera(a)&&(f=C.get_trans_view(d.world_tsr),f=h.subtract(b,f,B),h.add(f,d.hover_pivot,d.hover_pivot));g.set_translation(a,b);g.update_transform(a);q.sync_transform(a)}else r.error("set_translation(): Wrong camera object")};a.target_set_pivot_translation=function(a,b){c.is_target_camera(a)?(c.set_target_pivot(a,b),g.update_transform(a),q.sync_transform(a)):r.error("target_set_pivot_translation(): Wrong camera object or camera move style")};a.get_translation=function(a,
b){if(!l.is_camera(a))return r.error("get_translation(): Wrong camera object"),null;b=b||new Float32Array(3);return g.get_translation(a,b)};a.rotate_camera=function(a,b,d,f,h){l.is_camera(a)?(f=f||!1,h=h||!1,c.is_target_camera(a)?c.rotate_target_camera(a,b,d,f,h):c.is_eye_camera(a)?c.rotate_eye_camera(a,b,d,f,h):c.is_hover_camera(a)?c.rotate_hover_camera(a,b,d,f,h):c.is_static_camera(a)||r.error("rotate_camera(): Wrong camera move style"),g.update_transform(a),q.sync_transform(a)):r.error("rotate_camera(): Wrong camera object")};
a.set_velocities=function(a,b){if(l.is_camera(a)){var c=a.render;"number"==typeof b.trans&&(c.velocity_trans=f.clamp(b.trans,0,Infinity));"number"==typeof b.rot&&(c.velocity_rot=f.clamp(b.rot,0,Infinity));"number"==typeof b.zoom&&(c.velocity_zoom=f.clamp(b.zoom,0,.99))}else r.error("set_velocities(): Wrong camera object")};a.get_velocities=function(a,b){if(!l.is_camera(a))return r.error("get_velocities(): Wrong camera object"),null;var c=a.render;b=b||{};b.trans=c.velocity_trans;b.rot=c.velocity_rot;
b.zoom=c.velocity_zoom;return b};a.is_look_up=function(a){if(!l.is_camera(a))return r.error("is_look_up(): Wrong camera object"),!1;a=C.get_quat_view(a.render.world_tsr);return 0<=f.quat_to_dir(a,f.AXIS_MY,B)[1]};a.get_camera_angles=function(a,b){if(!l.is_camera(a))return r.error("get_camera_angles(): Wrong camera object"),null;b=b||new Float32Array(2);c.get_camera_angles(a,b);return b};a.get_camera_angles_char=function(a,b){if(!l.is_camera(a))return r.error("get_camera_angles_char(): Wrong camera object"),
null;b=b||new Float32Array(2);c.get_camera_angles_char(a,b);return b};a.set_stereo_distance=function(a,b){if(l.is_camera(a))for(var d=a.render.cameras,f=0;f<d.length;f++){var h=d[f];h.type!=c.TYPE_STEREO_LEFT&&h.type!=c.TYPE_STEREO_RIGHT||c.set_stereo_params(h,b,h.stereo_eye_dist)}else r.error("set_stereo_distance(): Wrong camera object")};a.get_stereo_distance=function(a){if(!l.is_camera(a))return r.error("get_stereo_distance(): Wrong camera object"),0;a=a.render.cameras;for(var b=0;b<a.length;b++){var d=
a[b];if(d.type==c.TYPE_STEREO_LEFT||d.type==c.TYPE_STEREO_RIGHT)return d.stereo_conv_dist}return 0};a.set_eye_distance=function(a,b){if(l.is_camera(a))for(var d=a.render.cameras,f=0;f<d.length;f++){var h=d[f];h.type!=c.TYPE_STEREO_LEFT&&h.type!=c.TYPE_STEREO_RIGHT&&h.type!=c.TYPE_HMD_LEFT&&h.type!=c.TYPE_HMD_RIGHT||c.set_stereo_params(h,h.stereo_conv_dist,b)}else r.error("set_eye_distance(): Wrong camera object")};a.get_eye_distance=function(a){if(!l.is_camera(a))return r.error("get_eye_distance(): Wrong camera object"),
0;a=a.render.cameras;for(var b=0;b<a.length;b++){var d=a[b];if(d.type==c.TYPE_STEREO_LEFT||d.type==c.TYPE_STEREO_RIGHT||d.type==c.TYPE_HMD_LEFT||d.type==c.TYPE_HMD_RIGHT)return d.stereo_eye_dist}return 0};a.set_vertical_axis=function(a,b){l.is_camera(a)?(h.copy(b,a.render.vertical_axis),g.update_transform(a),q.sync_transform(a)):r.error("set_vertical_axis(): Wrong camera object")};a.get_vertical_axis=function(a,b){if(l.is_camera(a))return b||(b=h.create()),h.copy(a.render.vertical_axis,b),b;r.error("get_vertical_axis(): Wrong camera object")};
a.translate_view=function(a,b,f,h){if(l.is_camera(a)){a=a.render.cameras;for(var g=0;g<a.length;g++){var k=a[g];k.reflection_plane||c.set_projection(k,k.aspect);var n=B;n[0]=-b;n[1]=-f;n[2]=0;d.translate(k.proj_matrix,n,k.proj_matrix);d.rotateZ(k.proj_matrix,h,k.proj_matrix);c.calc_view_proj_inverse(k);c.calc_sky_vp_inverse(k)}}else r.error("translate_view(): Wrong camera object")};a.get_fov=function(a){return l.is_camera(a)?f.rad(a.render.cameras[0].fov):(r.error("get_fov(): Wrong camera object"),
0)};a.set_fov=function(a,b){if(l.is_camera(a))for(var d=a.render.cameras,h=0;h<d.length;h++){var g=d[h];g.fov=f.deg(b);g.reflection_plane||c.set_projection(g,g.aspect);c.calc_view_proj_inverse(g);c.calc_sky_vp_inverse(g)}else r.error("set_fov(): Wrong camera object")};a.set_hmd_fov=function(a,b,d){var f;if(f=!l.is_camera(a)){a:{if(l.is_camera(a)){f=a.render.cameras;for(var h=0;h<f.length;h++){var g=f[h];if(g.type==c.TYPE_HMD_LEFT||g.type==c.TYPE_HMD_RIGHT){f=!0;break a}}}else r.error("is_hmd_camera(): Wrong camera object");
f=!1}f=!f}if(f)r.error("set_hmd_fov(): Wrong camera object");else if(b&&d)for(a=a.render.cameras,f=0;f<a.length;f++)if(h=a[f],h.type==c.TYPE_HMD_LEFT||h.type==c.TYPE_HMD_RIGHT)h.type==c.TYPE_HMD_LEFT&&n.copy(b,h.hmd_fov),h.type==c.TYPE_HMD_RIGHT&&n.copy(d,h.hmd_fov),h.reflection_plane||c.set_projection(h),c.calc_view_proj_inverse(h),c.calc_sky_vp_inverse(h)};a.correct_up=function(a,c,d){l.is_camera(a)?(c=c||a.render.vertical_axis,b.correct_up(a,c,d||!1),g.update_transform(a),q.sync_transform(a)):
r.error("correct_up(): Wrong camera object")};a.set_ortho_scale=function(a,b){if(l.is_camera(a)&&c.is_ortho_camera(a)){var d=a.render;if(c.is_target_camera(a)){var f=C.get_trans_view(d.world_tsr),f=h.dist(f,d.pivot);d.init_top=b/2*d.init_dist/f}else c.is_hover_camera(a)?(f=C.get_trans_view(d.world_tsr),f=h.distance(f,d.hover_pivot),d.init_top=b/2*d.init_dist/f):a.render.cameras[0].top=b/2;c.update_ortho_scale(a)}else r.error("set_ortho_scale(): Wrong camera object")};a.get_ortho_scale=function(a){return l.is_camera(a)&&
c.is_ortho_camera(a)?2*a.render.cameras[0].top:(r.error("get_ortho_scale(): Wrong camera object"),0)};a.is_ortho_camera=function(a){return l.is_camera(a)?c.is_ortho_camera(a):(r.error("is_ortho_camera(): Wrong camera object"),!1)};a.calc_ray=function(a,b,d,f){if(!l.is_camera(a))return r.error("calc_ray(): Wrong camera object"),null;f=f||new Float32Array(3);var g=a.render.cameras[0];switch(g.type){case c.TYPE_PERSP:case c.TYPE_PERSP_ASPECT:case c.TYPE_STEREO_LEFT:case c.TYPE_STEREO_RIGHT:var n=Math.tan(g.fov*
Math.PI/360),q=n*g.aspect;b=k.canvas_to_viewport_coords(b,d,A,g);B[0]=(2*b[0]/g.width-1)*q;B[1]=-1;B[2]=(2*b[1]/g.height-1)*n;C.transform_dir_vec3(B,a.render.world_tsr,B);f[0]=B[0];f[1]=B[1];f[2]=B[2];h.normalize(f,f);return f;default:return r.error("calc_ray(): Non-compatible camera"),f}};a.project_point=function(a,b,d){if(!l.is_camera(a))return r.error("project_point(): Wrong camera object"),null;d=d||new Float32Array(2);return c.project_point(a,b,d)};a.has_distance_limits=function(a){return c.is_target_camera(a)?
null!==a.render.distance_limits:(r.error("has_distance_limits(): Wrong camera object or camera move style"),!1)};a.has_vertical_rot_limits=function(a){return c.is_target_camera(a)||c.is_eye_camera(a)?null!==a.render.vertical_limits:(r.error("has_vertical_rot_limits(): Wrong camera object or camera move style"),!1)};a.has_vertical_limits=function(a){r.error_deprecated("has_vertical_limits","has_vertical_rot_limits");return c.is_target_camera(a)||c.is_eye_camera(a)?null!==a.render.vertical_limits:(r.error("has_vertical_limits(): Wrong camera object"),
!1)};a.has_horizontal_rot_limits=function(a){return c.is_target_camera(a)||c.is_eye_camera(a)?null!==a.render.horizontal_limits:(r.error("has_horizontal_rot_limits(): Wrong camera object or camera move style"),!1)};a.has_horizontal_limits=function(a){r.error_deprecated("has_horizontal_limits","has_horizontal_rot_limits");return c.is_target_camera(a)||c.is_eye_camera(a)?null!==a.render.horizontal_limits:(r.error("has_horizontal_limits(): Wrong camera object"),!1)};a.has_vertical_trans_limits=function(a){return c.is_hover_camera(a)?
null!==a.render.hover_vert_trans_limits:(r.error("has_vertical_trans_limits(): Wrong camera object or camera move style"),!1)};a.has_horizontal_trans_limits=function(a){return c.is_hover_camera(a)?null!==a.render.hover_horiz_trans_limits:(r.error("has_horizontal_trans_limits(): Wrong camera object or camera move style"),!1)};a.move_pivot=function(a,b,d){r.error_deprecated("move_pivot","target_pan_pivot");if(c.is_target_camera(a)){var f=a.render;if(f.use_panning){var k=C.get_trans_view(f.world_tsr),
l=h.subtract(k,f.pivot,F);B[0]=b;B[1]=0;B[2]=d;h.scale(B,h.len(l),B);C.transform_dir_vec3(B,f.world_tsr,B);h.add(f.pivot,B,f.pivot);h.add(k,B,k);g.update_transform(a);q.sync_transform(a)}}else r.error("move_pivot(): wrong object")};a.target_pan_pivot=function(a,b,d){if(c.is_target_camera(a)){var f=a.render;f.use_panning&&(B[0]=b,B[1]=0,B[2]=d,C.transform_dir_vec3(B,f.world_tsr,B),h.add(f.pivot,B,f.pivot),b=C.get_trans_view(f.world_tsr),h.add(b,B,b),g.update_transform(a),q.sync_transform(a))}else r.error("target_pan_pivot(): wrong object")};
a.set_velocity_params=function(a,b){r.error_deprecated("set_velocity_params","set_velocities");if(l.is_camera(a)){var c=a.render;c.velocity_trans=f.clamp(b[0],0,Infinity);c.velocity_rot=f.clamp(b[1],0,Infinity);c.velocity_zoom=f.clamp(b[2],0,.99)}else r.error("set_velocity_params(): Wrong camera object")};a.get_velocity_params=function(a,b){r.error_deprecated("get_velocity_params","get_velocities");if(!l.is_camera(a))return r.error("get_velocity_params(): Wrong camera object"),null;b=b||new Float32Array(3);
var c=a.render;b[0]=c.velocity_trans;b[1]=c.velocity_rot;b[2]=c.velocity_zoom;return b};a.clear_horizontal_limits=function(a){r.error_once('camera.clear_horizontal_limits() deprecated, use camera.target_set_horizontal_limits(), camera.eye_set_horizontal_limits() or camera.hover_set_horiz_trans_limits() with passing NULL as the "limits" argument.');l.is_camera(a)?c.is_target_camera(a)||c.is_eye_camera(a)?a.render.horizontal_limits=null:c.is_hover_camera(a)&&(a.render.hover_horiz_trans_limits=null):
r.error("clear_horizontal_limits(): Wrong camera object")};a.clear_vertical_limits=function(a){r.error_once('camera.clear_vertical_limits() deprecated, use camera.target_set_vertical_limits(), camera.eye_set_vertical_limits() or camera.hover_set_vert_trans_limits() with passing NULL as the "limits" argument.');l.is_camera(a)?c.is_target_camera(a)||c.is_eye_camera(a)?a.render.vertical_limits=null:c.is_hover_camera(a)&&(a.render.hover_vert_trans_limits=null):r.error("clear_vertical_limits(): Wrong camera object")};
a.clear_hover_angle_limits=function(a){r.error_once("camera.clear_hover_angle_limits() deprecated, HOVER camera always has hover angle limits")};a.set_look_at=function(a,d,f,h){r.error_deprecated_arr("camera.set_look_at",["camera.static_set_look_at","camera.eye_set_look_at"]);h=h||a.render.vertical_axis;c.set_look_at(a,d,f);b.correct_up(a,h,!0);g.update_transform(a);q.sync_transform(a)};a.rotate_eye_camera=function(a,b,d,f,h){r.error_deprecated_arr("camera.rotate_eye_camera",["camera.eye_rotate",
"camera.rotate_camera"]);c.is_eye_camera(a)?(c.rotate_eye_camera(a,b,d,f,h),g.update_transform(a),q.sync_transform(a)):r.error("rotate_eye_camera(): wrong object")};a.rotate_target_camera=function(a,b,d,f,h){r.error_deprecated_arr("camera.rotate_target_camera",["camera.target_rotate","camera.rotate_camera"]);c.is_target_camera(a)?(c.rotate_target_camera(a,b,d,f,h),g.update_transform(a),q.sync_transform(a)):r.error("rotate_target_camera(): wrong object")};a.set_trans_pivot=function(a,b,d){r.error_deprecated("camera.set_trans_pivot",
"camera.target_set_trans_pivot");c.is_target_camera(a)?(c.set_trans_pivot(a,b,d),g.update_transform(a),q.sync_transform(a)):r.error("set_trans_pivot(): Wrong object or camera move style")};a.zoom_object=function(a,b){r.error_deprecated("camera.zoom_object","camera.target_zoom_object");if(c.is_target_camera(a)){g.get_object_center(b,!1,B);t(a,B);g.update_transform(a);var d=g.get_object_size(b),f=c.get_angular_diameter(a)/2,d=d/Math.sin(f),f=g.obj_point_distance(a,B);g.move_local(a,0,d-f,0);g.update_transform(a);
q.sync_transform(a)}else r.error("zoom_object(): wrong object")};a.set_pivot=t;a.rotate_hover_camera=function(a,b,d,f,h){r.error_deprecated("camera.rotate_hover_camera","camera.hover_rotate");c.is_hover_camera(a)?(c.rotate_hover_camera(a,b,d,f,h),g.update_transform(a),q.sync_transform(a)):r.error("rotate_hover_camera(): wrong object")};a.get_hover_cam_pivot=function(a,b){r.error_deprecated("camera.get_hover_cam_pivot","camera.hover_get_pivot");if(!c.is_hover_camera(a))return r.error("get_hover_cam_pivot(): wrong object"),
null;b||(b=new Float32Array(3));h.copy(a.render.hover_pivot,b);return b};a.get_eye=function(a,b){r.error_deprecated("camera.get_eye","camera.get_translation");return l.is_camera(a)?c.get_eye(a,b):(r.error("get_eye(): Wrong object"),null)};a.get_pivot=function(a,b){r.error_deprecated("camera.get_pivot","camera.target_get_pivot");if(!c.is_target_camera(a))return r.error("get_pivot(): Wrong object or camera move style"),null;b||(b=new Float32Array(3));h.copy(a.render.pivot,b);return b};a.hover_cam_set_translation=
function(a,b){r.error_deprecated("camera.hover_cam_set_translation","camera.set_translation");if(c.is_hover_camera(a)){var d=a.render,f=C.get_trans_view(d.world_tsr),f=h.subtract(b,f,B);h.add(f,d.hover_pivot,d.hover_pivot);g.set_translation(a,b);g.update_transform(a);q.sync_transform(a)}else r.error("hover_cam_set_translation(): wrong object")};a.set_hover_pivot=function(a,b){r.error_deprecated("camera.set_hover_pivot","camera.hover_set_pivot_translation");c.is_hover_camera(a)?(c.set_hover_pivot(a,
b),g.update_transform(a),q.sync_transform(a)):r.error("set_hover_pivot(): Wrong object or camera move style")};a.get_hover_angle_limits=function(a,b){r.error_deprecated("camera.get_hover_angle_limits","camera.hover_get_vertical_limits");if(!c.is_hover_camera(a))return r.error("get_hover_angle_limits(): wrong object"),null;b=b||new Float32Array(2);b[0]=a.render.vertical_limits.down;b[1]=a.render.vertical_limits.up;return b};a.get_cam_dist_limits=function(a,b){r.error_deprecated_arr("camera.get_cam_dist_limits",
["camera.hover_get_distance_limits","camera.target_get_distance_limits"]);if(!c.is_hover_camera(a)&&!c.is_target_camera(a))return r.error("get_cam_dist_limits(): wrong object"),null;if(a.render.distance_limits)b=b||new Float32Array(2),b[0]=a.render.distance_limits.max,b[1]=a.render.distance_limits.min;else return null;return b};a.apply_vertical_limits=function(b,d,f,h){r.error_deprecated_arr("camera.apply_vertical_limits",["camera.eye_set_vertical_limits","camera.target_set_vertical_limits","camera.hover_set_vert_trans_limits"]);
if(c.is_target_camera(b)){var k=D;k.down=d;k.up=f;k.camera_space=h==g.SPACE_LOCAL;a.target_set_vertical_limits(b,k)}else c.is_eye_camera(b)?(k=D,k.down=d,k.up=f,k.camera_space=h==g.SPACE_LOCAL,a.eye_set_vertical_limits(b,k)):c.is_hover_camera(b)?(k=D,k.min=d,k.max=f,a.hover_set_vert_trans_limits(b,k)):r.error("apply_vertical_limits(): wrong object")};a.apply_hover_angle_limits=function(b,c,d){r.error_deprecated("camera.apply_hover_angle_limits","camera.hover_set_vertical_limits");D.down=c;D.up=d;
a.hover_set_vertical_limits(b,D)};a.apply_distance_limits=function(b,d,f){r.error_deprecated_arr("camera.apply_distance_limits",["camera.target_set_distance_limits","camera.hover_set_distance_limits"]);if(c.is_target_camera(b)){var h=D;h.min=d;h.max=f;a.target_set_distance_limits(b,h)}else c.is_hover_camera(b)?(h=D,h.min=d,h.max=f,a.hover_set_distance_limits(b,h)):r.error("apply_distance_limits(): wrong object")};a.clear_distance_limits=function(b){r.error_deprecated("camera.clear_distance_limits",
"camera.target_set_distance_limits");a.target_set_distance_limits(b,null)};a.get_vertical_limits=function(a,b){r.error_deprecated_arr("camera.get_vertical_limits",["camera.eye_get_vertical_limits","camera.target_get_vertical_limits","camera.hover_get_vert_trans_limits"]);if(!c.is_target_camera(a)&&!c.is_eye_camera(a)&&!c.is_hover_camera(a))return r.error("get_vertical_limits(): wrong object"),null;var d=a.render;b=b||new Float32Array(2);if(c.is_eye_camera(a)||c.is_target_camera(a)){if(d.vertical_limits)return b[0]=
d.vertical_limits.down,b[1]=d.vertical_limits.up,b}else if(c.is_hover_camera(a)&&d.hover_vert_trans_limits)return b[0]=d.hover_vert_trans_limits.min,b[1]=d.hover_vert_trans_limits.max,b;return null};a.apply_horizontal_limits=function(b,d,f,h){r.error_deprecated_arr("camera.apply_horizontal_limits",["camera.eye_set_horizontal_limits","camera.target_set_horizontal_limits","camera.hover_set_horiz_trans_limits"]);if(c.is_target_camera(b)){var k=D;k.left=d;k.right=f;k.camera_space=h==g.SPACE_LOCAL;a.target_set_horizontal_limits(b,
k)}else c.is_eye_camera(b)?(k=D,k.left=d,k.right=f,k.camera_space=h==g.SPACE_LOCAL,a.eye_set_horizontal_limits(b,k)):c.is_hover_camera(b)?(k=D,k.min=d,k.max=f,a.hover_set_horiz_trans_limits(b,k)):r.error("apply_horizontal_limits(): wrong object")};a.get_horizontal_limits=function(a,b){r.error_deprecated_arr("camera.get_horizontal_limits",["camera.eye_get_horizontal_limits","camera.target_get_horizontal_limits","camera.hover_get_horiz_trans_limits"]);if(!c.is_target_camera(a)&&!c.is_eye_camera(a)&&
!c.is_hover_camera(a))return r.error("get_horizontal_limits(): wrong object"),null;var d=a.render;b=b||new Float32Array(2);if(c.is_eye_camera(a)||c.is_target_camera(a)){if(d.horizontal_limits)return b[0]=d.horizontal_limits.left,b[1]=d.horizontal_limits.right,b}else if(c.is_hover_camera(a)&&d.hover_horiz_trans_limits)return b[0]=d.hover_horiz_trans_limits.min,b[1]=d.hover_horiz_trans_limits.max,b;return null}};b4w.module.config=function(a,p){var t=p("__config");a.P_LOW=t.P_LOW;a.P_HIGH=t.P_HIGH;a.P_ULTRA=t.P_ULTRA;a.P_CUSTOM=t.P_CUSTOM;a.set=t.set;a.get=t.get;a.reset=t.reset;a.get_std_assets_path=t.get_std_assets_path};b4w.module.controls=function(a,p){var t=p("__controls");p("__print");a.CT_POSITIVE=t.CT_POSITIVE;a.CT_CONTINUOUS=t.CT_CONTINUOUS;a.CT_TRIGGER=t.CT_TRIGGER;a.CT_SHOT=t.CT_SHOT;a.CT_LEVEL=t.CT_LEVEL;a.CT_CHANGE=t.CT_CHANGE;a.KEY_BACKSPACE=8;a.KEY_TAB=9;a.KEY_ENTER=13;a.KEY_SHIFT=16;a.KEY_CTRL=17;a.KEY_ALT=18;a.KEY_PAUSE=19;a.KEY_CAPSLOCK=20;a.KEY_ESC=27;a.KEY_SPACE=32;a.KEY_LEFT=37;a.KEY_UP=38;a.KEY_RIGHT=39;a.KEY_DOWN=40;a.KEY_1=49;a.KEY_2=50;a.KEY_3=51;a.KEY_4=52;a.KEY_5=53;a.KEY_6=54;a.KEY_7=55;
a.KEY_8=56;a.KEY_9=57;a.KEY_A=65;a.KEY_B=66;a.KEY_C=67;a.KEY_D=68;a.KEY_E=69;a.KEY_F=70;a.KEY_G=71;a.KEY_H=72;a.KEY_I=73;a.KEY_J=74;a.KEY_K=75;a.KEY_L=76;a.KEY_M=77;a.KEY_N=78;a.KEY_O=79;a.KEY_P=80;a.KEY_Q=81;a.KEY_R=82;a.KEY_S=83;a.KEY_T=84;a.KEY_U=85;a.KEY_V=86;a.KEY_W=87;a.KEY_X=88;a.KEY_Y=89;a.KEY_Z=90;a.KEY_NUM0=96;a.KEY_NUM1=97;a.KEY_NUM2=98;a.KEY_NUM3=99;a.KEY_NUM4=100;a.KEY_NUM5=101;a.KEY_NUM6=102;a.KEY_NUM7=103;a.KEY_NUM8=104;a.KEY_NUM9=105;a.KEY_DEC_POINT=110;a.KEY_SEMI_COLON=186;a.KEY_EQUAL_SIGN=
187;a.KEY_COMMA=188;a.KEY_DASH=189;a.KEY_PERIOD=190;a.KEY_FORWARD_SLASH=191;a.KEY_GRAVE_ACCENT=192;a.KEY_LEFT_SQ_BRACKET=219;a.KEY_BACK_SLASH=220;a.KEY_RIGHT_SQ_BRACKET=221;a.KEY_SINGLE_QUOTE=222;a.PL_SINGLE_TOUCH_MOVE=t.PL_SINGLE_TOUCH_MOVE;a.PL_MULTITOUCH_MOVE_ZOOM=t.PL_MULTITOUCH_MOVE_ZOOM;a.PL_MULTITOUCH_MOVE_PAN=t.PL_MULTITOUCH_MOVE_PAN;a.PL_MULTITOUCH_MOVE_ROTATE=t.PL_MULTITOUCH_MOVE_ROTATE;a.create_custom_sensor=t.create_custom_sensor;a.create_keyboard_sensor=t.create_keyboard_sensor;a.create_collision_sensor=
function(a,b,k){return t.create_collision_sensor(a,b||"ANY",k||!1)};a.create_collision_impulse_sensor=t.create_collision_impulse_sensor;a.create_ray_sensor=function(a,b,k,d,l,q,p){return t.create_ray_sensor(a,b,k,d||"ANY",l||!1,q||!1,p||!1)};a.create_mouse_click_sensor=t.create_mouse_click_sensor;a.create_mouse_wheel_sensor=t.create_mouse_wheel_sensor;a.create_mouse_move_sensor=t.create_mouse_move_sensor;a.create_touch_move_sensor=t.create_touch_move_sensor;a.create_touch_zoom_sensor=t.create_touch_zoom_sensor;
a.create_touch_rotate_sensor=t.create_touch_rotate_sensor;a.create_motion_sensor=t.create_motion_sensor;a.create_vertical_velocity_sensor=t.create_vertical_velocity_sensor;a.create_gyro_angles_sensor=t.create_gyro_angles_sensor;a.create_gyro_delta_sensor=t.create_gyro_delta_sensor;a.create_timer_sensor=function(a,b){return t.create_timer_sensor(a,b||!1)};a.reset_timer_sensor=t.reset_timer_sensor;a.create_elapsed_sensor=t.create_elapsed_sensor;a.create_timeline_sensor=t.create_timeline_sensor;a.create_selection_sensor=
function(a,b){return t.create_selection_sensor(a,b||!1)};a.create_callback_sensor=function(a,b){return t.create_callback_sensor(a,b||0)};a.set_custom_sensor=function(a,b){t.sensor_set_value(a,b)};a.get_custom_sensor=function(a){return a.value};a.get_sensor_value=t.get_sensor_value;a.get_sensor_payload=t.get_sensor_payload;a.create_sensor_manifold=function(a,b,k,d,l,q,p){l=l||t.default_AND_logic_fun;t.create_sensor_manifold(a,b,k,d,l,q,void 0===p?null:p)};a.create_kb_sensor_manifold=function(a,b,k,
d,l,q){d=t.create_keyboard_sensor(d);t.create_sensor_manifold(a,b,k,[d],t.default_AND_logic_fun,l,void 0===q?null:q)};a.check_sensor_manifolds=function(a){return t.check_sensor_manifold(a,null)};a.check_sensor_manifold=t.check_sensor_manifold;a.remove_sensor_manifold=t.remove_sensor_manifold;a.reset=t.reset;a.register_keyboard_events=t.register_keyboard_events;a.register_mouse_events=function(a,b,k){t.register_mouse_events(a,b,!!k)};a.register_wheel_events=t.register_wheel_events;a.register_touch_events=
t.register_touch_events;a.register_device_orientation=t.register_device_orientation;a.unregister_keyboard_events=t.unregister_keyboard_events;a.unregister_mouse_events=t.unregister_mouse_events;a.unregister_wheel_events=t.unregister_wheel_events;a.unregister_touch_events=t.unregister_touch_events;a.unregister_device_orientation=t.unregister_device_orientation};b4w.module.constraints=function(a,p){var t=p("__camera"),c=p("__constraints"),b=p("__obj_util"),k=p("__physics"),d=p("__print"),l=p("__transform");a.append_stiff=function(a,b,d,p,f){f=f||1;b instanceof Array&&2==b.length?c.append_stiff_bone(a,b[0],b[1],d,p,f):c.append_stiff_obj(a,b,d,p,f);l.update_transform(a);k.sync_transform(a)};a.append_semi_stiff=function(a,b,d,p){c.append_semi_stiff_obj(a,b,d,p);l.update_transform(a);k.sync_transform(a)};a.append_semi_stiff_cam=function(a,b,g,p,f,h,n,A){t.is_eye_camera(a)?
(c.append_semi_stiff_cam_obj(a,b,g,p,f,h,n,A),l.update_transform(a),k.sync_transform(a)):d.error("append_semi_stiff_cam(): wrong object type, only EYE camera objects can be parented.")};a.append_semi_soft_cam=function(a,b,g,p){if(t.is_eye_camera(a)){if(!p||0>p)p=.25;c.append_semi_soft_cam_obj(a,b,g,p);l.update_transform(a);k.sync_transform(a)}else d.error("append_semi_soft_cam(): wrong object type, only EYE camera objects can be parented.")};a.append_stiff_trans=function(a,b,d){c.append_stiff_trans_obj(a,
b,d);l.update_transform(a);k.sync_transform(a)};a.append_copy_trans=function(a,b,d){c.append_copy_trans_obj(a,b,d);l.update_transform(a);k.sync_transform(a)};a.append_stiff_trans_rot=function(a,b,d,p){c.append_stiff_trans_rot_obj(a,b,d,p,1);l.update_transform(a);k.sync_transform(a)};a.append_track=function(a,b){3==b.length?c.append_track_point(a,b):c.append_track_obj(a,b);l.update_transform(a);k.sync_transform(a)};a.append_follow=function(a,b,d,p){3==b.length?c.append_follow_point(a,b,d,p):c.append_follow_obj(a,
b,d,p);l.update_transform(a);k.sync_transform(a)};a.append_stiff_viewport=function(a,b,d){c.append_stiff_viewport(a,b,d);l.update_transform(a);k.sync_transform(a)};a.remove=function(a){a.constraint&&c.remove(a)};a.get_parent=function(a){d.error_deprecated("constraints.get_parent","objects.get_parent");return b.get_parent(a)}};b4w.module.container=function(a,p){var t=p("__container"),c=p("__print");a.get_canvas=t.get_canvas;a.get_canvas_hud=t.get_canvas_hud;a.get_container=t.get_container;a.insert_to_container=function(a,k){2!=arguments.length?c.error("insert_to_container(): two arguments required"):a&&k&&t.insert_to_container(a,k)};a.set_canvas_offsets=t.set_canvas_offsets;a.update_canvas_offsets=t.update_canvas_offsets;a.client_to_canvas_coords=t.client_to_canvas_coords;a.force_offsets_updating=t.force_offsets_updating;
a.resize=function(a,k,d){a&&k||c.warn("Wrong canvas container dimensions: "+a+"x"+k+". Zero dimensions aren't allowed. Resized to: "+t.DEFAULT_CANVAS_W+"x"+t.DEFAULT_CANVAS_H+".");t.resize(a,k,d)}};b4w.module.data=function(a,p){var t=p("__data"),c=p("__loader");p("__print");p("__util");a.load=t.load;a.unload=function(a){t.unload(a|0)};a.set_debug_resources_root=t.set_debug_resources_root;a.is_primary_loaded=t.is_primary_loaded;a.is_idle=c.is_finished;a.load_and_add_new=t.load;a.cleanup=a.unload;a.activate_media=t.activate_media};b4w.module.debug=function(a,p){function t(a){var b={};if(!a)return b;a=a.split("\n");for(var c=0;c<a.length;c++){var d=a[c];if(-1!=d.search(new RegExp(/^[A-Z.]+ /))){var e=d.split(" ")[0];e in b||(b[e]=0);b[e]++}}c=a=0;for(e in b)switch(e){case "KIL":case "TEX":case "TXB":case "TXP":case "KIL.F":case "TEX.F":case "TXB.F":case "TXD.F":case "TXL.F":case "TXQ.F":case "TXP.F":c+=b[e];break;default:a+=b[e]}b.ALU_OPS=a;b.TEX_OPS=c;return b}function c(a,b){var c=new XMLHttpRequest;c.open("POST",a,!1);c.send(b);
if(200==c.status)return c.responseText;throw"Error POST XHR: "+c.status;}function b(a){a.sort(function(a,b){return b.fstats.ALU_OPS-a.fstats.ALU_OPS});for(var b=0;b<a.length;b++){var c=a[b],d=c.fstats,e=c.vstats,f=k(c.cshader),f=f?"\t\t("+f.join(", ")+")":"\t\t(NA)";h.groupCollapsed("FRAG --\x3e","ALU",d.ALU_OPS,"TEX",d.TEX_OPS,"\t\tVERT --\x3e","ALU",e.ALU_OPS,"TEX",e.TEX_OPS,f);h.groupCollapsed("directives");for(var f=c.shaders_info.directives,g=0;g<f.length;g++){var l=f[g];h.log(l[0],l[1])}h.groupEnd();
h.groupCollapsed("vert src");h.log(c.vsrc);h.groupEnd();h.groupCollapsed("vert stats");for(var n in e)"ALU_OPS"!=n&&"TEX_OPS"!=n&&h.log(n,e[n]);h.groupEnd();h.groupCollapsed("frag src");h.log(c.fsrc);h.groupEnd();h.groupCollapsed("frag stats");for(n in d)"ALU_OPS"!=n&&"TEX_OPS"!=n&&h.log(n,d[n]);h.groupEnd();h.groupEnd()}}function k(a){for(var b=A.get_all_scenes(),c=0;c<b.length;c++)for(var d=b[c],e=g.get_scene_objs(d,"MESH",g.DATA_ID_ALL),f=0;f<e.length;f++){var h=C.get_scene_data(e[f],d);if(h&&
h.batches.length)for(var h=h.batches,k=0;k<h.length;k++){var l=h[k];if(l.shader==a&&l.material_names.length)return l.material_names}}return null}p("__batch");p("__config");var d=p("__controls"),l=p("__debug"),q=p("__extensions"),r=p("__loader"),g=p("__objects"),C=p("__obj_util"),f=p("__physics"),h=p("__print"),n=p("__renderer"),A=p("__scenes"),B=p("__scenegraph"),F=p("__sfx"),D=p("__shaders"),e=p("__textures"),z=p("__util"),y=p("vec3");a.WM_NONE=l.WM_NONE;a.WM_OPAQUE_WIREFRAME=l.WM_OPAQUE_WIREFRAME;
a.WM_TRANSPARENT_WIREFRAME=l.WM_TRANSPARENT_WIREFRAME;a.WM_FRONT_BACK_VIEW=l.WM_FRONT_BACK_VIEW;a.WM_DEBUG_SPHERES=l.WM_DEBUG_SPHERES;a.physics_stats=function(){f.debug_workers()};a.physics_id=function(a){h.log("O",f.find_obj_by_body_id(a));for(var b=f.get_active_scene()._physics.bundles,c=0;c<b.length;c++){var d=b[c];d.physics.body_id==a&&h.log("B",d)}};a.visible_objects=function(){for(var a=A.get_active(),b=g.get_scene_objs(a,"MESH",g.DATA_ID_ALL),a=[A.get_subs(a,"MAIN_OPAQUE"),A.get_subs(a,"MAIN_BLEND"),
A.get_subs(a,"MAIN_GLOW")],c=0;c<a.length;c++){var d=a[c],e=d.bundles;if(e.length){h.group(d.type,"DYNAMIC");for(var f=0;f<b.length;f++){var k=b[f],l=k.render;if("DYNAMIC"==l.type)for(var n=0;n<e.length;n++){var q=e[n];if(q.do_render&&q.obj_render==l){h.log_raw(k.name,k);break}}}h.groupEnd();h.groupCollapsed(d.type,"STATIC");for(f=0;f<b.length;f++)if(k=b[f],l=k.render,"DYNAMIC"!=l.type)for(n=0;n<e.length;n++)if(q=e[n],q.do_render&&q.obj_render==l){h.log_raw(k.name,k);break}h.groupEnd()}}};a.object_info=
function(a){for(var b=A.get_active(),c=g.get_scene_objs(b,"MESH",g.DATA_ID_ALL),d=0;d<c.length;d++){var e=c[d];if(e.name==a){h.log("Object",e);for(var f=A.get_all_subscenes(b),k=0;k<f.length;k++){for(var l=f[k],n=l.bundles,q=[],p=0;p<n.length;p++)n[p].obj_render==e.render&&q.push(n[p]);h.log("Subscene "+l.type,q)}}}};a.objects_stat=function(){var a=A.get_active();console.log("Armatures: "+g.get_scene_objs(a,"ARMATURE",g.DATA_ID_ALL).length);console.log("Cameras: "+g.get_scene_objs(a,"CAMERA",g.DATA_ID_ALL).length);
console.log("Curves: "+g.get_scene_objs(a,"CURVE",g.DATA_ID_ALL).length);console.log("Empties: "+g.get_scene_objs(a,"EMPTY",g.DATA_ID_ALL).length);console.log("Lamps: "+g.get_scene_objs(a,"LAMP",g.DATA_ID_ALL).length);console.log("Meshes: "+g.get_scene_objs(a,"MESH",g.DATA_ID_ALL).length);console.log("Speakers: "+g.get_scene_objs(a,"SPEAKER",g.DATA_ID_ALL).length)};a.num_vertices=function(){for(var a=0,b=A.get_active(),b=[A.get_subs(b,"MAIN_OPAQUE"),A.get_subs(b,"MAIN_BLEND"),A.get_subs(b,"MAIN_GLOW")],
c=0;c<b.length;c++){var d=b[c];if(d)for(var d=d.bundles,e=0;e<d.length;e++){var f=d[e].batch;f&&(a+=f.num_vertices)}}return a};a.num_triangles=function(){for(var a=0,b=A.get_active(),b=[A.get_subs(b,"MAIN_OPAQUE"),A.get_subs(b,"MAIN_BLEND"),A.get_subs(b,"MAIN_GLOW")],c=0;c<b.length;c++){var d=b[c];if(d)for(var d=d.bundles,e=0;e<d.length;e++){var f=d[e].batch;f&&(a+=f.num_triangles)}}return a};a.num_draw_calls=function(){for(var a=A.get_active(),b=[A.get_subs(a,"MAIN_OPAQUE"),A.get_subs(a,"MAIN_BLEND"),
A.get_subs(a,"MAIN_GLOW")],c=0,d=0;d<b.length;d++){var e=b[d];e&&(c+=e.bundles.length)}a=A.subs_array(a,["MAIN_PLANE_REFLECT","MAIN_CUBE_REFLECT"]);for(d=0;d<a.length;d++)e=a[d],c="MAIN_PLANE_REFLECT"==e.type?c+e.bundles.length:c+6*e.bundles.length;return c};a.num_shaders=function(){var a=D.get_compiled_shaders();return z.get_dict_length(a)};a.geometry_stats=function(){for(var a=A.get_active(),b=A.get_all_subscenes(a),a={},c=0;c<b.length;c++){var d=b[c];if("SINK"!=d.type&&"WIREFRAME"!=d.type)for(var e=
d.bundles,f=0;f<e.length;f++){var h=e[f].batch,g=e[f].obj_render;h&&("COLOR_PICKING"!=d.type&&"OUTLINE_MASK"!=d.type||g.origin_selectable||g.origin_outlining)&&(a[h.id]=h)}}var e=d=c=b=0,k;for(k in a)h=a[k],h=h.bufs_data,h.debug_ibo_bytes&&(d++,e+=h.debug_ibo_bytes/1048576),b++,c+=h.debug_vbo_bytes/1048576;return{vbo_number:b,vbo_memory:c,ibo_number:d,ibo_memory:e}};a.num_textures=function(){for(var a=[],b=0,c=A.get_active(),c=[A.get_subs(c,"MAIN_OPAQUE"),A.get_subs(c,"MAIN_BLEND"),A.get_subs(c,"MAIN_GLOW")],
d=0;d<c.length;d++){var e=c[d];if(e)for(var e=e.bundles,f=0;f<e.length;f++){var h=e[f].batch;if(h)for(var h=h.textures,g=0;g<h.length;g++){var k=h[g];if("IMAGE"===k.source||"ENVIRONMENT_MAP"===k.source){var l=k.w_texture;-1===a.indexOf(l)&&(a.push(l),k=k.width*k.height*4/1048576/k.compress_ratio,k*=1.3333,b+=k)}}}}return{number:a.length,memory:b}};a.num_render_targets=function(){for(var a=[],b=0,c=A.get_active(),c=A.get_all_subscenes(c),d=0;d<c.length;d++){var f=c[d];if("SINK"!=f.type){var h=f.camera,
g=[h.color_attachment,h.depth_attachment];g.push.apply(g,f.textures_internal);for(f=0;f<g.length;f++){var k=g[f];e.is_texture(k)&&-1==a.indexOf(k)&&(a.push(k),b+=h.width*h.height*e.get_texture_texel_size(k))}}}return{number:a.length,memory:b/1024/1024}};a.make_camera_frustum_shot=function(){var a=A.get_active();(a=A.get_subs(a,"MAIN_OPAQUE"))&&A.make_frustum_shot(a.camera,a,[1,1,0])};a.make_light_frustum_shot=function(){var a=A.get_active(),b=A.get_subs(a,"MAIN_OPAQUE"),a=A.subs_array(a,["SHADOW_CAST"]);
if(b)for(var c=0;c<a.length;c++){var d=a[c],e;switch(c){case 0:e=[1,0,0];break;case 1:e=[0,1,0];break;case 2:e=[0,0,1];break;default:e=[1,0,1]}A.make_frustum_shot(d.camera,b,e)}};a.scenegraph_to_dot=function(){for(var a=A.get_all_scenes(),b=0;b<a.length;b++){var c=A.get_graph(a[b]);h.log("\n"+B.debug_convert_to_dot(c))}};a.scenes_to_dot=function(){};a.loading_graph_to_dot=function(a){h.log("\n"+r.graph_to_dot(a|0))};a.controls_info=d.debug;a.object_distance=function(a,b){var c=m_tsr.get_trans_view(a.render.world_tsr),
d=m_tsr.get_trans_view(b.render.world_tsr);return y.dist(c,d)};a.msg=l.msg;a.fbmsg=l.fbmsg;a.print_telemetry=l.print_telemetry;a.plot_telemetry=l.plot_telemetry;a.fbres=function(a,b){b||(b=16);var c=function(){l.fbmsg("FBRES",a());setTimeout(c,b)};c()};a.assert_constants=function(){var a=new Float32Array(3),b=new Float32Array([0,0,0,1]),c=new Float32Array([1,0,0]),d=new Float32Array([0,1,0]),e=new Float32Array([0,0,1]),f=new Float32Array([-1,0,0]),h=new Float32Array([0,-1,0]),g=new Float32Array([0,
0,-1]);if(!z.cmp_arr(a,z.VEC3_IDENT))throw"Wrong VEC3_IDENT";if(!z.cmp_arr(b,z.QUAT4_IDENT))throw"Wrong QUAT4_IDENT";if(!z.cmp_arr(c,z.AXIS_X))throw"Wrong AXIS_X";if(!z.cmp_arr(d,z.AXIS_Y))throw"Wrong AXIS_Y";if(!z.cmp_arr(e,z.AXIS_Z))throw"Wrong AXIS_Z";if(!z.cmp_arr(f,z.AXIS_MX))throw"Wrong AXIS_MX";if(!z.cmp_arr(h,z.AXIS_MY))throw"Wrong AXIS_MY";if(!z.cmp_arr(g,z.AXIS_MZ))throw"Wrong AXIS_MZ";};a.mute_music=function(){for(var a=F.get_speaker_objects(),b=0;b<a.length;b++){var c=a[b];"BACKGROUND_MUSIC"==
F.get_spk_behavior(c)&&F.mute(c,!0)}};a.check_finite=function(a){l.check_finite(a)};a.set_debug_params=function(a){var b=A.get_active();if(b=A.get_subs(b,"WIREFRAME")){if("number"==typeof a.wireframe_mode)switch(a.wireframe_mode){case l.WM_NONE:case l.WM_OPAQUE_WIREFRAME:case l.WM_TRANSPARENT_WIREFRAME:case l.WM_FRONT_BACK_VIEW:case l.WM_DEBUG_SPHERES:A.set_wireframe_mode(b,a.wireframe_mode);break;default:h.error("set_debug_params(): Wrong wireframe mode")}"object"==typeof a.wireframe_edge_color&&
A.set_wireframe_edge_color(b,a.wireframe_edge_color)}else throw"Wireframe subscene not found.";};a.get_error_quantity=function(){return h.get_error_count()};a.get_warning_quantity=function(){return h.get_warning_count()};a.clear_errors_warnings=function(){return h.clear_errors_warnings()};a.analyze_shaders=function(a){var d=D.get_compiled_shaders(),e=0,f;for(f in d)a&&-1===f.indexOf(a)||e++;var e="of "+e+" analyzing...",g={};for(f in d)if(!a||-1!==f.indexOf(a)){var k=d[f],l;var n=k.vshader;l=k.fshader;
var p=q.get_debug_shaders();if(p){n=p.getTranslatedShaderSource(n);l=p.getTranslatedShaderSource(l);n=n.replace("#version","#version 400 //");l=l.replace("#version","#version 400 //");var p=c("/nvidia_vert",n),r=t(p),y=c("/nvidia_frag",l),A=t(y);l={vsrc:n,vout:p,vstats:r,fsrc:l,fout:y,fstats:A}}else h.error("WEBGL_debug_shaders not found (run Chrome with --enable-privileged-webgl-extensions)"),l=void 0;p=k.shaders_info;n=p.vert+" + "+p.frag;l.cshader=k;l.shaders_info=p;k=g[n]=g[n]||[];k.push(l);h.log(e)}for(n in g)h.group("%c"+
n,"color: #800"),k=g[n],b(k),h.groupEnd()};a.fake_load=l.fake_load;a.test_performance=function(a){if(q.get_disjoint_timer_query()){var b=B.create_performance_graph();A.generate_auxiliary_batches(b);for(var c=B.find_subs(b,"PERFORMANCE"),b=0;10>b;b++)n.draw(c);window.setTimeout(function(){l.process_timer_queries(c);a(c.debug_render_time)},100)}else a(-1)}};b4w.module.geometry=function(a,p){var t=p("__batch"),c=p("__geometry"),b=p("__print"),k=p("__renderer");a.extract_vertex_array=function(a,k,p){if(!c.has_dyn_geom(a))return b.error("Wrong object:",a.name),null;if(a=t.find_batch_material(a,k,"MAIN")){if((k=a.bufs_data)&&k.pointers&&k.pointers[p])return c.extract_array(k,p);b.error("Attribute not found:"+p);return null}b.error("Wrong material:",k);return null};a.extract_index_array=function(a,k){if(!c.has_dyn_geom(a))return b.error("Wrong object:",a.name),
null;var p=t.find_batch_material(a,k,"MAIN");if(p){if((p=p.bufs_data)&&p.pointers)return p.ibo_array;b.error("Buffer data not found");return null}b.error("Wrong material:",k);return null};a.update_vertex_array=function(a,k,p,r){var g=["MAIN","DEPTH","COLOR_ID"];if(c.has_dyn_geom(a))for(var C=0;C<g.length;C++){var f=t.find_batch_material(a,k,g[C]);f&&(f=f.bufs_data)&&f.pointers&&f.pointers[p]&&c.update_bufs_data_array(f,p,0,r)}else b.error("Wrong object:",a.name)};a.override_geometry=function(a,l,
p,r,g){var C=["MAIN","DEPTH","COLOR_ID"];if(c.has_dyn_geom(a))if(p instanceof Uint16Array||p instanceof Uint32Array)if(r instanceof Float32Array)for(var f=0;f<C.length;f++){var h=t.find_batch_material(a,l,C[f]);if(h){var n=h.bufs_data;if(n){c.update_bufs_data_index_array(n,h.draw_mode,p);var A=0,B;for(B in n.pointers)var F=n.pointers[B],A=A+r.length/3*F.num_comp;n.vbo_array=new Float32Array(A);var A=n.vbo_array,D=0;for(B in n.pointers)switch(F=n.pointers[B],B){case "a_position":A.set(r,D);F.offset=
D;F.length=r.length;D+=F.length;break;case "a_normal":var e;g&&(e=c.calc_shared_indices(p,r,r));var z=c.calc_normals(p,r,e);A.set(z,D);F.offset=D;F.length=r.length;D+=F.length;break;case "a_tangent":F.offset=D;F.length=r.length/3*F.num_comp;for(var z=new Float32Array(F.length),y=0;y<z.length;y+=4)z[y]=1,z[y+3]=1;A.set(z,D);D+=F.length;break;default:F.offset=D,F.length=r.length/3*F.num_comp,z=new Float32Array(F.length),A.set(z,D),D+=F.length}c.update_gl_buffers(n);k.assign_attribute_setters(h);(h=
t.find_batch_material_forked(a,h))&&h.bufs_data&&(h.bufs_data=n)}}}else b.error("Wrong positions_array type");else b.error("Wrong ibo_array type");else b.error("Wrong object:",a.name)};a.set_shape_key_value=function(a,k,p){c.check_shape_keys(a)?c.has_shape_key(a,k)?(p=parseFloat(p),c.apply_shape_key(a,k,p)):b.error("Wrong key name:",k):b.error("Wrong object:",a.name)};a.check_shape_keys=function(a){return c.check_shape_keys(a)};a.get_shape_keys_names=function(a){return c.check_shape_keys(a)?c.get_shape_keys_names(a):
(b.error("Wrong object:",a.name),null)};a.get_shape_key_value=function(a,k){return c.check_shape_keys(a)?c.has_shape_key(a,k)?c.get_shape_key_value(a,k):(b.error("Wrong key name:",k),null):(b.error("Wrong object:",a.name),null)};a.draw_line=function(a,l,p){p=p||!1;if(l instanceof Float32Array){if(a=t.get_first_batch(a))c.draw_line(a,l,p),k.assign_attribute_setters(a)}else b.error("Wrong positions type")}};b4w.module.hud=function(a,p){var t=p("__hud");p("__print");a.draw_mixer_strip=t.draw_mixer_strip;a.plot_array=t.plot_array};b4w.module.lights=function(a,p){function t(a){for(var c=q.get_active(),d=k.get_scene_objs(c,"LAMP",k.DATA_ID_ALL),n=0;n<d.length;n++){var p=d[n];if("SUN"==p.light.type){var m=p;break}}m?"number"==typeof a.hor_position&&"number"==typeof a.vert_position&&(d=(90-a.vert_position)/180*Math.PI,n=m.render,r.set_rotation_euler(m,[d,(180-a.hor_position)/180*Math.PI,0]),a=new Float32Array(3),p=g.get_quat_view(n.world_tsr),C.quat_to_dir(p,C.AXIS_Y,a),n=g.get_trans_view(n.world_tsr),n=f.length(n),f.copy(a,h),
f.scale(h,n,h),r.set_translation(m,h),r.update_transform(m),a=m.light,a.dynamic_intensity&&(n=c.world.light_settings.environment_energy,p=Math.cos(Math.abs(d)),d=Math.max(Math.min(3*p,1),0)*a.default_energy,n*=Math.max(p,.1),b.set_light_energy(a,d),q.set_environment_colors(c,n,null,null)),q.update_lamp_scene(m,c)):l.error("There is no sun on the scene")}function c(a){if(d.is_lamp(a))return a.light.type;l.error("get_light_type(): Wrong object");return!1}var b=p("__lights"),k=p("__objects"),d=p("__obj_util"),
l=p("__print"),q=p("__scenes"),r=p("__transform"),g=p("__tsr"),C=p("__util"),f=p("__vec3"),h=new Float32Array(3),n,A,B,F=60;a.get_lamps=function(a){var b=q.get_active(),b=k.get_scene_objs(b,"LAMP",k.DATA_ID_ALL);if(!a)return b;for(var c=[],d=0;d<b.length;d++){var f=b[d];f.light.type===a&&c.push(f)}return c};a.get_sun_params=function(){for(var a=q.get_active(),a=k.get_scene_objs(a,"LAMP",k.DATA_ID_ALL),b=null,c=0;c<a.length;c++){var d=a[c];if("SUN"==d.light.type){b=d;break}}return b?(b=b.light.direction,
a=180*Math.atan2(b[2],b[0])/Math.PI+90,180<a&&(a-=360),b=180*Math.atan2(b[1],Math.sqrt(b[0]*b[0]+b[2]*b[2]))/Math.PI,c={},c.hor_position=a,c.vert_position=b,c):null};a.set_sun_params=t;a.set_day_time=function(a){for(var b=q.get_active(),b=k.get_scene_objs(b,"LAMP",k.DATA_ID_ALL),c=0;c<b.length;c++){var d=b[c];if("SUN"==d.light.type){var f=d;break}}f?(f=12>a?15*a:15*(a-24),a=-Math.cos(a/12*Math.PI)*F,b={},b.hor_position=f,b.vert_position=a,t(b)):l.error("There is no sun on the scene")};a.set_date=
function(a){n=a.getDate();A=a.getMonth();B=a.getFullYear();if(n)if(1582==n&&10==a.m&&4<a.d&&15>a.d)l.error("The dates 5 through 14 October, 1582, do not exist in the Gregorian system!");else{a=n;var b=A,c=B,d,f;2<b?(d=a,f=b+1):(d=a-1,f=b+13);f=Math.floor(Math.floor(365.25*d)+Math.floor(30.6001*f)+c+1720995);588829<=c+31*(b+12*a)&&(a=Math.floor(.01*d),f+=2-a+Math.floor(.25*a));a=1E5*f;b=Math.floor(a);.5<a-b&&++b}else l.error("There is no year 0 in the Julian system!")};a.set_max_sun_angle=function(a){F=
Math.min(Math.max(a,0),90)};a.get_light_params=function(a){if(d.is_lamp(a))var b=a.light;else return l.error("get_light_params(): Wrong object"),null;if(a=c(a))switch(a){case "SPOT":var f={light_type:a,light_color:b.color,light_energy:b.energy,light_spot_blend:b.spot_blend,light_spot_size:b.spot_size,light_distance:b.distance};break;case "POINT":f={light_type:a,light_color:b.color,light_energy:b.energy,light_distance:b.distance};break;default:f={light_type:a,light_color:b.color,light_energy:b.energy}}return f?
f:null};a.get_light_type=c;a.set_light_params=function(a,c){if(d.is_lamp(a)){var f=a.light,h=q.get_active();"number"==typeof c.light_energy&&b.set_light_energy(f,c.light_energy);"object"==typeof c.light_color&&b.set_light_color(f,c.light_color);"number"==typeof c.light_spot_blend&&b.set_light_spot_blend(f,c.light_spot_blend);"number"==typeof c.light_spot_size&&b.set_light_spot_size(f,c.light_spot_size);"number"==typeof c.light_distance&&b.set_light_distance(f,c.light_distance);q.update_lamp_scene(a,
h);k.update_all_mesh_shaders(h)}else l.error("set_light_params(): Wrong object")}};b4w.module.material=function(a,p){function t(a,b){for(var c=a.scenes_data[0].batches,d=0;d<c.length;d++){var g=c[d];if(-1<g.material_names.indexOf(b))return"MAIN"==g.type}return!1}function c(a,b){var c=k.find_batch_material(a,b,"MAIN");return Boolean(c&&c.specular_params[0])}function b(a,b){var c=k.find_batch_material(a,b,"MAIN");return Boolean(c&&c.specular_params[1])}var k=p("__batch"),d=p("__config"),l=p("__obj_util"),q=p("__print"),r=p("__shaders"),g=p("__util"),C=d.defaults;a.inherit_material=
function(a,b,c,d){l.is_dynamic_mesh(c)&&l.is_dynamic_mesh(a)?k.inherit_material(a,b,c,d):q.error("Wrong or batched object(s)")};a.get_materials_names=function(a){var b=[];a=a.scenes_data;for(var c=0;c<a.length;c++)for(var d=a[c].batches,g=0;g<d.length;g++)for(var k=0;k<d[g].material_names.length;k++)-1==b.indexOf(d[g].material_names[k])&&b.push(d[g].material_names[k]);return b};a.set_diffuse_color=function(a,b,c){var d=k.find_batch_material(a,b,"MAIN");d?(d.diffuse_color.set(c),(a=k.find_batch_material_forked(a,
b,"MAIN"))&&a.diffuse_color.set(c)):q.error('Couldn\'t set property "diffuse_color"!')};a.get_diffuse_color=function(a,b){var c=k.find_batch_material(a,b,"MAIN");if(c){var d=new Float32Array(4);d.set(c.diffuse_color);return d}q.error('Couldn\'t get property "diffuse_color"!')};a.set_diffuse_intensity=function(a,b,c){var d=k.find_batch_material(a,b,"MAIN");if(d){if(d.diffuse_intensity=c,a=k.find_batch_material_forked(a,b,"MAIN"))a.diffuse_intensity=c}else q.error('Couldn\'t set property "diffuse_color"!')};
a.get_diffuse_intensity=function(a,b){var c=k.find_batch_material(a,b,"MAIN");if(c)return c.diffuse_intensity;q.error('Couldn\'t get property "diffuse_intensity"!')};a.set_specular_color=function(a,b,c){var d=k.find_batch_material(a,b,"MAIN");d?(d.specular_color.set(c),(a=k.find_batch_material_forked(a,b,"MAIN"))&&a.specular_color.set(c)):q.error('Couldn\'t set property "specular_color"!')};a.get_specular_color=function(a,b){var c=k.find_batch_material(a,b,"MAIN");if(c){var d=Array(3);d[0]=c.specular_color[0];
d[1]=c.specular_color[1];d[2]=c.specular_color[2];return d}q.error('Couldn\'t get property "specular_color"!')};a.set_specular_color_factor=function(a,b,c){var d=k.find_batch_material(a,b,"MAIN");if(d){if(d.specular_color_factor=c,a=k.find_batch_material_forked(a,b,"MAIN"))a.specular_color_factor=c}else q.error('Couldn\'t set property "specular_color_factor"!')};a.get_specular_color_factor=function(a,b){var c=k.find_batch_material(a,b,"MAIN");if(c)return c.specular_color_factor;q.error('Couldn\'t get property "specular_color_factor"!')};
a.set_specular_intensity=function(a,b,d){c(a,b)||q.error('Property "specular_intensity" is missing!');k.find_batch_material(a,b,"MAIN").specular_params[0]=d;(a=k.find_batch_material_forked(a,b,"MAIN"))&&(a.specular_params[0]=d)};a.get_specular_intensity=function(a,b){c(a,b)||q.error('Property "specular_intensity" is missing!');return k.find_batch_material(a,b,"MAIN").specular_params[0]};a.check_specular_intensity=c;a.set_specular_hardness=function(a,c,d){b(a,c)||q.error('Property "specular_hardness" is missing!');
k.find_batch_material(a,c,"MAIN").specular_params[1]=d;(a=k.find_batch_material_forked(a,c,"MAIN"))&&(a.specular_params[1]=d)};a.get_specular_hardness=function(a,c){b(a,c)||q.error('Property "specular_hardness" is missing!');return k.find_batch_material(a,c,"MAIN").specular_params[1]};a.check_specular_hardness=b;a.set_emit_factor=function(a,b,c){var d=k.find_batch_material(a,b,"MAIN");if(d){if(d.emit=c,a=k.find_batch_material_forked(a,b,"MAIN"))a.emit=c}else q.error('Couldn\'t set property "emit_factor"!')};
a.get_emit_factor=function(a,b){var c=k.find_batch_material(a,b,"MAIN");if(c)return c.emit;q.error('Couldn\'t get property "emit_factor"!')};a.set_ambient_factor=function(a,b,c){var d=k.find_batch_material(a,b,"MAIN");if(d){if(d.ambient=c,a=k.find_batch_material_forked(a,b,"MAIN"))a.ambient=c}else q.error('Couldn\'t set property "ambient_factor"!')};a.get_ambient_factor=function(a,b){var c=k.find_batch_material(a,b,"MAIN");if(c)return c.ambient;q.error('Couldn\'t get property "ambient_factor"!')};
a.set_diffuse_color_factor=function(a,b,c){var d=k.find_batch_material(a,b,"MAIN");if(d){if(d.diffuse_color_factor=c,a=k.find_batch_material_forked(a,b,"MAIN"))a.diffuse_color_factor=c}else q.error('Couldn\'t set property "diffuse_color_factor"!')};a.get_diffuse_color_factor=function(a,b){var c=k.find_batch_material(a,b,"MAIN");if(c)return c.diffuse_color_factor;q.error('Couldn\'t get property "diffuse_color_factor"!')};a.set_alpha_factor=function(a,b,c){var d=k.find_batch_material(a,b,"MAIN");if(d){if(d.alpha_factor=
c,a=k.find_batch_material_forked(a,b,"MAIN"))a.alpha_factor=c}else q.error('Couldn\'t set property "alpha_factor"!')};a.get_alpha_factor=function(a,b){var c=k.find_batch_material(a,b,"MAIN");if(c)return c.alpha_factor;q.error('Couldn\'t get property "alpha_factor"!')};a.get_material_extended_params=function(a,b){if(!a||!b)return q.error("missing arguments in get_material_params"),null;if(!t(a,b))return null;var c=k.find_batch_material(a,b,"MAIN");if(!c)return null;var d={};"MAIN"==c.type&&(d.reflect_factor=
c.reflect_factor,d.fresnel=c.fresnel_params[2],d.fresnel_factor=5*(1-c.fresnel_params[3]),d.parallax_scale=c.parallax_scale,d.parallax_steps=k.get_batch_directive(c,"PARALLAX_STEPS")[1]);return d};a.get_water_material_params=function(a,b){if(!a||!b)return q.error("missing arguments in get_water_material_params"),null;if(!t(a,b))return null;var c=k.find_batch_material(a,b,"MAIN");if(!c||!c.water)return null;if(!c)return q.error("material not found"),null;var d={};if("MAIN"==c.type){if(C.shore_distance){var g=
d.shallow_water_col=Array(3);g[0]=c.shallow_water_col[0];g[1]=c.shallow_water_col[1];g[2]=c.shallow_water_col[2];g=d.shore_water_col=Array(3);g[0]=c.shore_water_col[0];g[1]=c.shore_water_col[1];g[2]=c.shore_water_col[2];d.shallow_water_col_fac=c.shallow_water_col_fac;d.shore_water_col_fac=c.shore_water_col_fac}d.foam_factor=c.foam_factor;d.norm_uv_velocity=c.water_norm_uv_velocity;d.absorb_factor=k.get_batch_directive(c,"ABSORB")[1];d.sss_strength=k.get_batch_directive(c,"SSS_STRENGTH")[1];d.sss_width=
k.get_batch_directive(c,"SSS_WIDTH")[1];d.dst_noise_scale0=k.get_batch_directive(c,"DST_NOISE_SCALE_0")[1];d.dst_noise_scale1=k.get_batch_directive(c,"DST_NOISE_SCALE_1")[1];d.dst_noise_freq0=k.get_batch_directive(c,"DST_NOISE_FREQ_0")[1];d.dst_noise_freq1=k.get_batch_directive(c,"DST_NOISE_FREQ_1")[1];d.dir_min_shore_fac=k.get_batch_directive(c,"DIR_MIN_SHR_FAC")[1];d.dir_freq=k.get_batch_directive(c,"DIR_FREQ")[1];d.dir_noise_scale=k.get_batch_directive(c,"DIR_NOISE_SCALE")[1];d.dir_noise_freq=
k.get_batch_directive(c,"DIR_NOISE_FREQ")[1];d.dir_min_noise_fac=k.get_batch_directive(c,"DIR_MIN_NOISE_FAC")[1];d.dst_min_fac=k.get_batch_directive(c,"DST_MIN_FAC")[1];d.waves_hor_fac=k.get_batch_directive(c,"WAVES_HOR_FAC")[1]}return d};a.set_material_extended_params=function(a,b,c){if(a&&b&&c)if(t(a,b)){var d=k.find_batch_material(a,b,"MAIN");if(d){var g=[d];(d=k.find_batch_material_forked(a,b,"MAIN"))&&g.push(d);for(a=0;a<g.length;a++)d=g[a],"number"==typeof c.material_reflectivity&&(d.reflect_factor=
c.material_reflectivity),"number"==typeof c.material_fresnel&&(d.fresnel_params[2]=c.material_fresnel),"number"==typeof c.material_fresnel_factor&&(d.fresnel_params[3]=1-c.material_fresnel_factor/5),"number"==typeof c.material_parallax_scale&&(d.parallax_scale=c.material_parallax_scale),"number"==typeof c.material_parallax_steps&&(b=r.glsl_value(parseFloat(c.material_parallax_steps)),k.set_batch_directive(d,"PARALLAX_STEPS",b),k.update_shader(d,!0))}else q.error("material not found")}else q.error("setting material params is not possible");
else q.error("missing arguments in set_material_params")};a.set_water_material_params=function(a,b,c){if(a&&b&&c)if(t(a,b)){var d=k.find_batch_material(a,b,"MAIN");if(d){var g=[d];(d=k.find_batch_material_forked(a,b,"MAIN"))&&g.push(d);for(a=0;a<g.length;a++)d=g[a],C.shore_distance&&("object"==typeof c.shallow_water_col&&d.shallow_water_col.set(c.shallow_water_col),"number"==typeof c.shallow_water_col_fac&&(d.shallow_water_col_fac=c.shallow_water_col_fac),"object"==typeof c.shore_water_col&&d.shore_water_col.set(c.shore_water_col),
"number"==typeof c.shore_water_col_fac&&(d.shore_water_col_fac=c.shore_water_col_fac)),C.shore_smoothing&&d.water_shore_smoothing&&("boolean"==typeof c.shore_smoothing&&(c.shore_smoothing?k.set_batch_directive(d,"SHORE_SMOOTHING",1):k.set_batch_directive(d,"SHORE_SMOOTHING",0)),"number"==typeof c.absorb_factor&&(b=r.glsl_value(parseFloat(c.absorb_factor)),k.set_batch_directive(d,"ABSORB",b))),"number"==typeof c.foam_factor&&C.foam&&(d.foam_factor=c.foam_factor),"number"==typeof c.norm_uv_velocity&&
(d.water_norm_uv_velocity=c.norm_uv_velocity),C.water_dynamic&&d.water_dynamic&&("boolean"==typeof c.water_dynamic&&(c.water_dynamic?k.set_batch_directive(d,"DYNAMIC",1):k.set_batch_directive(d,"DYNAMIC",0)),"number"==typeof c.waves_height&&(b=r.glsl_value(parseFloat(c.waves_height)),k.set_batch_directive(d,"WAVES_HEIGHT",b)),"number"==typeof c.waves_length&&(b=r.glsl_value(parseFloat(c.waves_length)),k.set_batch_directive(d,"WAVES_LENGTH",b)),"number"==typeof c.sss_strength&&(b=r.glsl_value(parseFloat(c.sss_strength)),
k.set_batch_directive(d,"SSS_STRENGTH",b)),"number"==typeof c.sss_width&&(b=r.glsl_value(parseFloat(c.sss_width)),k.set_batch_directive(d,"SSS_WIDTH",b)),"number"==typeof c.dst_noise_scale0&&(b=r.glsl_value(parseFloat(c.dst_noise_scale0)),k.set_batch_directive(d,"DST_NOISE_SCALE_0",b)),"number"==typeof c.dst_noise_scale1&&(b=r.glsl_value(parseFloat(c.dst_noise_scale1)),k.set_batch_directive(d,"DST_NOISE_SCALE_1",b)),"number"==typeof c.dst_noise_freq0&&(b=r.glsl_value(parseFloat(c.dst_noise_freq0)),
k.set_batch_directive(d,"DST_NOISE_FREQ_0",b)),"number"==typeof c.dst_noise_freq1&&(b=r.glsl_value(parseFloat(c.dst_noise_freq1)),k.set_batch_directive(d,"DST_NOISE_FREQ_1",b)),"number"==typeof c.dir_min_shore_fac&&(b=r.glsl_value(parseFloat(c.dir_min_shore_fac)),k.set_batch_directive(d,"DIR_MIN_SHR_FAC",b)),"number"==typeof c.dir_freq&&(b=r.glsl_value(parseFloat(c.dir_freq)),k.set_batch_directive(d,"DIR_FREQ",b)),"number"==typeof c.dir_noise_scale&&(b=r.glsl_value(parseFloat(c.dir_noise_scale)),
k.set_batch_directive(d,"DIR_NOISE_SCALE",b)),"number"==typeof c.dir_noise_freq&&(b=r.glsl_value(parseFloat(c.dir_noise_freq)),k.set_batch_directive(d,"DIR_NOISE_FREQ",b)),"number"==typeof c.dir_min_noise_fac&&(b=r.glsl_value(parseFloat(c.dir_min_noise_fac)),k.set_batch_directive(d,"DIR_MIN_NOISE_FAC",b)),"number"==typeof c.dst_min_fac&&(b=r.glsl_value(parseFloat(c.dst_min_fac)),k.set_batch_directive(d,"DST_MIN_FAC",b)),"number"==typeof c.waves_hor_fac&&(b=r.glsl_value(parseFloat(c.waves_hor_fac)),
k.set_batch_directive(d,"WAVES_HOR_FAC",b))),k.update_shader(d,!0)}else q.error("material not found")}else q.error("setting water material params is not possible");else q.error("missing arguments in set_water_material_params")};a.set_line_params=function(a,b){var c=k.get_first_batch(a);c?(g.isdef(b.color)&&c.diffuse_color.set(b.color),g.isdef(b.width)&&(c.line_width=b.width)):q.error("Couldn't set line params!")};a.get_line_params=function(a){if(a=k.get_first_batch(a))return{color:new Float32Array(a.diffuse_color),
width:a.line_width};q.error("Couldn't get line params");return null}};b4w.module.particles=function(a,p){var t=p("__particles"),c=p("__print");a.set_size=function(a,k,d){t.obj_has_particles(a)?t.set_size(a,k,d):c.error('"',a.name,'" has no particle systems')};a.set_normal_factor=function(a,k,d){t.obj_has_particles(a)?t.set_normal_factor(a,k,d):c.error('"',a.name,'" has no particle systems')};a.set_factor=function(a,k,d){t.obj_has_particles(a)?(d=Math.min(d,1),d=Math.max(d,0),t.set_factor(a,k,d)):c.error('"',a.name,'" has no particle systems')}};b4w.module.physics=function(a,p){p("__config");var t=p("__ipc"),c=p("__physics"),b=p("__print"),k=p("__util");a.CM_WALK=0;a.CM_RUN=1;a.CM_CLIMB=2;a.CM_FLY=3;a.enable_simulation=function(a){c.obj_has_physics(a)?c.enable_simulation(a):b.error("No physics for object "+a.name)};a.disable_simulation=function(a){c.obj_has_physics(a)?c.disable_simulation(a):b.error("No physics for object "+a.name)};a.has_physics=function(a){return c.obj_has_physics(a)};a.has_simulated_physics=function(a){return c.has_simulated_physics(a)};
a.has_dynamic_physics=function(a){return c.has_dynamic_physics(a)};a.set_gravity=function(a,k){c.obj_has_physics(a)?c.set_gravity(a,k):b.error("No physics for object "+a.name)};a.set_damping=function(a,k,p){c.obj_has_physics(a)?c.post_msg("set_damping",a.physics.body_id,k,p):b.error("No physics for object "+a.name)};a.reset_damping=function(a){if(c.obj_has_physics(a)){var k=a.physics_settings;c.post_msg("set_damping",a.physics.body_id,k.damping,k.rotation_damping)}else b.error("No physics for object "+
a.name)};a.set_transform=function(a,k,p){c.obj_has_physics(a)?c.set_transform.apply(this,arguments):b.error("No physics for object "+a.name)};a.sync_transform=function(a){c.obj_has_physics(a)?c.sync_transform(a):b.error("No physics for object "+a.name)};a.apply_velocity=function(a){c.obj_has_physics(a)?c.apply_velocity.apply(this,arguments):b.error("No physics for object "+a.name)};a.apply_velocity_world=function(a){c.obj_has_physics(a)?c.apply_velocity_world.apply(this,arguments):b.error("No physics for object "+
a.name)};a.apply_force=function(a,k,p,r){c.obj_has_physics(a)?c.apply_force.apply(this,arguments):b.error("No physics for object "+a.name)};a.apply_torque=function(a,k,p,r){c.obj_has_physics(a)?c.apply_torque.apply(this,arguments):b.error("No physics for object "+a.name)};a.vehicle_throttle=function(a,l){c.obj_has_physics(a)?(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a)||b.error("Wrong object"),c.vehicle_throttle(a,k.clamp(l,-1,1))):b.error("No physics for object "+a.name)};a.vehicle_throttle_inc=
function(a,l,p){if(c.obj_has_physics(a)){c.is_vehicle_chassis(a)||c.is_vehicle_hull(a)||b.error("Wrong object");l=k.clamp(l,0,1);var r=a.vehicle.engine_force;-1==p||1==p?r=Math.max(-1,Math.min(r+p*l,1)):0==p&&0<=r?(r-=l,r=Math.max(0,r)):0==p&&0>r?(r+=l,r=Math.min(0,r)):b.error("Wrong steering direction");c.vehicle_throttle(a,k.clamp(r,-1,1))}else b.error("No physics for object "+a.name)};a.vehicle_steer=function(a,l){c.obj_has_physics(a)?(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a)||b.error("Wrong object"),
c.vehicle_steer(a,k.clamp(l,-1,1))):b.error("No physics for object "+a.name)};a.vehicle_steer_inc=function(a,l,p){if(c.obj_has_physics(a)){c.is_vehicle_chassis(a)||c.is_vehicle_hull(a)||b.error("Wrong object");l=k.clamp(l,0,1);var r=a.vehicle.steering;-1==p||1==p?r=Math.max(-1,Math.min(r+p*l,1)):0==p&&0<=r?(r-=l,r=Math.max(0,r)):0==p&&0>r?(r+=l,r=Math.min(0,r)):b.error("Wrong steering direction");c.vehicle_steer(a,k.clamp(r,-1,1))}else b.error("No physics for object "+a.name)};a.vehicle_brake=function(a,
l){c.obj_has_physics(a)?(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a)||b.error("Wrong object"),c.vehicle_brake(a,k.clamp(l,0,1))):b.error("No physics for object "+a.name)};a.vehicle_brake_inc=function(a,l){if(c.obj_has_physics(a)){c.is_vehicle_chassis(a)||c.is_vehicle_hull(a)||b.error("Wrong object");l=k.clamp(l,-1,1);var p=a.vehicle.brake_force;c.vehicle_brake(a,k.clamp(p+p*l,0,1))}else b.error("No physics for object "+a.name)};a.is_vehicle_chassis=function(a){return c.is_vehicle_chassis(a)};a.is_vehicle_hull=
function(a){return c.is_vehicle_hull(a)};a.get_vehicle_name=function(a){if(!c.obj_has_physics(a))return b.error("No physics for object "+a.name),null;if(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a))return a.vehicle_settings.name;b.error("Wrong object");return null};a.get_vehicle_throttle=function(a){if(!c.obj_has_physics(a))return b.error("No physics for object "+a.name),null;if(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a))return a.vehicle.engine_force;b.error("Wrong object");return null};a.get_vehicle_steering=
function(a){if(!c.obj_has_physics(a))return b.error("No physics for object "+a.name),null;if(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a))return a.vehicle.steering;b.error("Wrong object")};a.get_vehicle_brake=function(a){if(!c.obj_has_physics(a))return b.error("No physics for object "+a.name),null;if(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a))return a.vehicle.brake_force;b.error("Wrong object")};a.get_vehicle_speed=function(a){if(!c.obj_has_physics(a))return b.error("No physics for object "+a.name),
null;if(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a))return c.get_vehicle_speed(a);b.error("Wrong object")};a.is_character=function(a){return c.is_character(a)};a.set_character_move_dir=function(a,k,p){c.obj_has_physics(a)?c.set_character_move_dir(a,k,p):b.error("No physics for object "+a.name)};a.set_character_move_type=function(a,k){c.obj_has_physics(a)?c.set_character_move_type(a,k):b.error("No physics for object "+a.name)};a.set_character_walk_velocity=function(a,k){c.obj_has_physics(a)?c.set_character_walk_velocity(a,
k):b.error("No physics for object "+a.name)};a.set_character_run_velocity=function(a,k){c.obj_has_physics(a)?c.set_character_run_velocity(a,k):b.error("No physics for object "+a.name)};a.set_character_fly_velocity=function(a,k){c.obj_has_physics(a)?c.set_character_fly_velocity(a,k):b.error("No physics for object "+a.name)};a.character_jump=function(a){c.obj_has_physics(a)?c.character_jump(a):b.error("No physics for object "+a.name)};a.character_rotation_inc=function(a,k,p){c.obj_has_physics(a)?c.character_rotation_inc(a,
k,p):b.error("No physics for object "+a.name)};a.set_character_rotation=function(a,k,p){c.obj_has_physics(a)?c.set_character_rotation(a,k,p):b.error("No physics for object "+a.name)};a.set_character_rotation_v=function(a,k){c.obj_has_physics(a)?c.set_character_rotation_v(a,k):b.error("No physics for object "+a.name)};a.set_character_rotation_h=function(a,k){c.obj_has_physics(a)?c.set_character_rotation_h(a,k):b.error("No physics for object "+a.name)};a.append_collision_test=function(a,k,p,r){c.obj_has_physics(a)?
c.append_collision_test(a,k,p,r||!1):b.error("No physics for object "+a.name)};a.remove_collision_test=function(a,k,p){c.obj_has_physics(a)?c.remove_collision_test(a,k||"ANY",p):b.error("No physics for object "+a.name)};a.apply_collision_impulse_test=function(a,k){c.obj_has_physics(a)?c.apply_collision_impulse_test(a,k):b.error("No physics for object "+a.name)};a.clear_collision_impulse_test=function(a){c.obj_has_physics(a)?c.clear_collision_impulse_test(a):b.error("No physics for object "+a.name)};
a.append_ray_test=function(a,k,p,r,g,t){if(c.obj_has_physics(a))return c.append_ray_test(a,k,p,r,g,t||!1,!1,!1,!1);b.error("No physics for object "+a.name)};a.append_ray_test_ext=function(a,k,p,r,g,t,f,h,n){if(c.obj_has_physics(a))return c.append_ray_test(a,k,p,r,g,t||!1,f||!1,h||!1,n||!1);b.error("No physics for object "+a.name)};a.remove_ray_test=function(a){c.is_ray_test(a)?c.remove_ray_test(a):b.error("Wrong ray test ID")};a.change_ray_test_from_to=function(a,k,p){c.is_ray_test(a)?c.change_ray_test_from_to(a,
k,p):b.error("Wrong ray test ID")};a.apply_constraint=function(a,k,p,r,g,t,f,h,n,A){c.obj_has_physics(k)&&c.obj_has_physics(g)?c.apply_constraint(a,k,p,r,g,t,f,h,n,A):b.error("Wrong objects")};a.clear_constraint=function(a){c.obj_has_physics(a)&&c.has_constraint(a)?c.clear_constraint(a):b.error("Wrong object")};a.pull_to_constraint_pivot=function(a,k,p,r,g,t){c.obj_has_physics(a)&&c.obj_has_physics(r)?c.pull_to_constraint_pivot(a,k,p,r,g,t):b.error("Wrong objects")};a.get_worker_listeners=t.get_worker_listeners};b4w.module.rgb=function(a,p){p("__print");var t=p("__util"),c=new Float32Array(3);a.create=function(){return new Float32Array(3)};a.from_values=function(a,c,d){var l=new Float32Array(3);l[0]=a;l[1]=c;l[2]=d;return l};a.set=function(a,c,d,l){l[0]=a;l[1]=c;l[2]=d;return l};a.css_to_rgb=function(a,c,d,l){l=l||new Float32Array(3);l[0]=a/255;l[1]=c/255;l[2]=d/255;t.srgb_to_lin(l,l);return l};a.rgb_to_css=function(a){a=t.lin_to_srgb(a,c);return[Math.round(255*a[0]),Math.round(255*a[1]),Math.round(255*a[2])]};
a.rgb_to_css_hex=function(a){var k=function(a){a=Math.round(255*a).toString(16);return 1==a.length?"0"+a:a};a=t.lin_to_srgb(a,c);return"#"+k(a[0])+k(a[1])+k(a[2])}};
b4w.module.rgba=function(a,p){p("__print");var t=p("__util"),c=new Float32Array(3);a.create=function(){var a=new Float32Array(4);a[3]=1;return a};a.from_values=function(a,c,d,l){var p=new Float32Array(4);p[0]=a;p[1]=c;p[2]=d;p[3]=l;return p};a.set=function(a,c,d,l,p){p[0]=a;p[1]=c;p[2]=d;p[3]=l;return p};a.css_to_rgba=function(a,c,d,l,p){p=p||new Float32Array(4);p[0]=a/255;p[1]=c/255;p[2]=d/255;p[3]=l;t.srgb_to_lin(p,p);return p};a.rgba_to_css=function(a){var k=t.lin_to_srgb(a,c);return[Math.round(255*
k[0]),Math.round(255*k[1]),Math.round(255*k[2]),a[3]]}};b4w.module.scenes=function(a,p){var t=p("__batch"),c=p("__camera"),b=p("__data"),k=p("__graph"),d=p("__objects"),l=p("__obj_util"),q=p("__physics"),r=p("__print"),g=p("__scenes"),C=p("__util");p("__vec4");a.DATA_ID_ALL=d.DATA_ID_ALL;a.set_active=function(a){var b=g.get_all_scenes();g.set_active(C.keysearch("name",a,b))};a.get_active=function(){return g.check_active()?g.get_active().name:""};a.get_scenes=function(){for(var a=g.get_all_scenes(),b=[],c=0;c<a.length;c++)b.push(a[c].name);return b};a.get_active_camera=
function(){if(g.check_active())return g.get_camera(g.get_active());r.error("No active scene");return!1};a.get_object_by_name=function(a,b){var c=d.get_object(d.GET_OBJECT_BY_NAME,a,b|0);if(c)return c;r.error("get object "+a+": not found")};a.get_object_by_dupli_name=function(a,b,c){if(a=d.get_object(d.GET_OBJECT_BY_DUPLI_NAME,a,b,c|0))return a;r.error("get object "+b+": not found")};a.get_object_by_dupli_name_list=function(a,b){var c=d.get_object(d.GET_OBJECT_BY_DUPLI_NAME_LIST,a,b|0);if(c)return c;
r.error("get object "+a+": not found")};a.get_object_data_id=function(a){return g.get_object_data_id(a)};a.pick_object=d.pick_object;a.outlining_is_enabled=function(a){return a&&a.render&&a.render.outlining};a.set_outline_intensity=function(a,b){a&&a.render&&a.render.outlining?a.render.outline_intensity=b:r.error("set_outline_intensity(): wrong object")};a.get_outline_intensity=function(a){if(a&&a.render&&a.render.outlining)return a.render.outline_intensity;r.error("get_outline_intensity(): wrong object")};
a.apply_outline_anim=function(a,b,c,g){a&&a.render&&a.render.outlining?d.apply_outline_anim(a,b,c,g):r.error("apply_outline_anim(): wrong object")};a.apply_outline_anim_def=function(a){if(a&&a.render&&a.render.outlining){var b=a.render.outline_anim_settings_default;d.apply_outline_anim(a,b.outline_duration,b.outline_period,b.outline_relapses)}else r.error("apply_outline_anim_def(): wrong object")};a.clear_outline_anim=function(a){a&&a.render&&a.render.outlining?d.clear_outline_anim(a):r.error("clear_outline_anim(): wrong object")};
a.set_outline_color=g.set_outline_color;a.get_outline_color=function(a){var b=g.get_active();if(b=g.get_subs(b,"OUTLINE"))return a=a||new Float32Array(3),a.set(b.outline_color),a};a.set_hmd_params=function(a){if(!g.check_active())r.error("No active scene");else if(a){var b=g.get_active();if(b=g.get_subs(b,"STEREO"))a.distortion_coefs&&a.distortion_coefs instanceof Array&&(b.distortion_params[0]=a.distortion_coefs[0],b.distortion_params[1]=a.distortion_coefs[1],b.need_perm_uniforms_update=!0),a.chromatic_aberration_coefs&&
a.chromatic_aberration_coefs instanceof Array&&(b.chromatic_aberration_coefs[0]=a.chromatic_aberration_coefs[0],b.chromatic_aberration_coefs[1]=a.chromatic_aberration_coefs[1],b.chromatic_aberration_coefs[2]=a.chromatic_aberration_coefs[2],b.chromatic_aberration_coefs[3]=a.chromatic_aberration_coefs[3],b.need_perm_uniforms_update=!0),a.distortion_scale&&"number"==typeof a.distortion_scale&&(b.distortion_params[2]=a.distortion_scale,b.need_perm_uniforms_update=!0),a.distortion_offset&&"number"==typeof a.distortion_offset&&
(b.distortion_params[3]=a.distortion_offset,b.need_perm_uniforms_update=!0),a.enable_hmd_stereo&&"boolean"==typeof a.enable_hmd_stereo&&(b.enable_hmd_stereo=a.enable_hmd_stereo,b.need_perm_uniforms_update=!0)}};a.get_shadow_params=function(){if(!g.check_active())return r.error("No active scene"),!1;var a=g.get_active(),b=g.get_subs(a,"SHADOW_CAST");if(!b)return null;var c=a._render.shadow_params,d=g.get_subs(a,"MAIN_OPAQUE"),k=g.get_subs(a,"DEPTH"),l={};l.csm_resolution=c.csm_resolution;l.self_shadow_polygon_offset=
b.self_shadow_polygon_offset;k&&(l.self_shadow_normal_offset=k.self_shadow_normal_offset);l.enable_csm=c.enable_csm;l.csm_num=c.csm_num;l.csm_first_cascade_border=c.csm_first_cascade_border;l.first_cascade_blur_radius=c.first_cascade_blur_radius;l.csm_last_cascade_border=c.csm_last_cascade_border;l.last_cascade_blur_radius=c.last_cascade_blur_radius;l.fade_last_cascade=c.fade_last_cascade;l.blend_between_cascades=c.blend_between_cascades;c.enable_csm?(l.csm_borders=g.get_csm_borders(a,d.camera),l.blur_radii=
new Float32Array(c.csm_num),l.blur_radii.set(d.camera.pcf_blur_radii.subarray(0,c.csm_num))):(l.csm_borders=null,l.blur_radii=null);return l};a.set_shadow_params=function(a){if(g.check_active()){var b=g.get_active();"number"==typeof a.self_shadow_polygon_offset&&k.traverse(b._render.graph,function(b,c){"SHADOW_CAST"===c.type&&(c.self_shadow_polygon_offset=a.self_shadow_polygon_offset)});var d=g.get_subs(b,"DEPTH");d&&("number"==typeof a.self_shadow_normal_offset&&(d.self_shadow_normal_offset=a.self_shadow_normal_offset),
"number"==typeof a.pcf_blur_radius&&(d.pcf_blur_radius=a.pcf_blur_radius));var l=g.get_subs(b,"MAIN_BLEND");l&&("number"==typeof a.self_shadow_normal_offset&&(l.self_shadow_normal_offset=a.self_shadow_normal_offset),"number"==typeof a.pcf_blur_radius&&(l.pcf_blur_radius=a.pcf_blur_radius),l.need_perm_uniforms_update=!0);l=b._render.shadow_params;"number"==typeof a.csm_first_cascade_border&&(l.csm_first_cascade_border=a.csm_first_cascade_border);"number"==typeof a.first_cascade_blur_radius&&(l.first_cascade_blur_radius=
a.first_cascade_blur_radius);"number"==typeof a.csm_last_cascade_border&&(l.csm_last_cascade_border=a.csm_last_cascade_border);"number"==typeof a.last_cascade_blur_radius&&(l.last_cascade_blur_radius=a.last_cascade_blur_radius);if(d){for(var p=d.bundles,q=0;q<p.length;q++){var C=p[q];C.obj_render.shadow_receive&&(C=C.batch,t.assign_shadow_receive_dirs(C,l),t.update_shader(C))}d.need_perm_uniforms_update=!0}d=b._camera.render.cameras;for(q=0;q<d.length;q++)c.update_camera_shadows(d[q],l);g.schedule_shadow_update(b)}else r.error("No active scene")};
a.get_environment_colors=function(){if(!g.check_active())return r.error("No active scene"),!1;var a=g.get_active();return g.get_environment_colors(a)};a.set_environment_colors=function(a,b,c){if(g.check_active()){var d=g.get_active();g.set_environment_colors(d,parseFloat(a),b,c)}else r.error("No active scene")};a.get_fog_color_density=function(a){if(!g.check_active())return r.error("No active scene"),!1;var b=g.get_active();return g.get_fog_color_density(b,a)};a.set_fog_color_density=function(a){if(g.check_active()){var b=
g.get_active();g.set_fog_color_density(b,a)}else r.error("No active scene")};a.get_ssao_params=function(){if(!g.check_active())return r.error("No active scene"),!1;var a=g.get_active();return g.get_ssao_params(a)};a.set_ssao_params=function(a){if(g.check_active()){var b=g.get_active();g.set_ssao_params(b,a)}else r.error("No active scene")};a.get_color_correction_params=function(){if(!g.check_active())return r.error("No active scene"),null;var a=g.get_active(),a=g.get_subs(a,"COMPOSITING");if(!a)return null;
var b={};b.brightness=a.brightness;b.contrast=a.contrast;b.exposure=a.exposure;b.saturation=a.saturation;return b};a.set_color_correction_params=function(a){if(g.check_active()){var b=g.get_active();if(b=g.get_subs(b,"COMPOSITING"))"number"==typeof a.brightness&&(b.brightness=a.brightness),"number"==typeof a.contrast&&(b.contrast=a.contrast),"number"==typeof a.exposure&&(b.exposure=a.exposure),"number"==typeof a.saturation&&(b.saturation=a.saturation),b.need_perm_uniforms_update=!0}else r.error("No active scene")};
a.get_sky_params=function(){if(!g.check_active())return r.error("No active scene"),!1;var a=g.get_active();return g.get_sky_params(a)};a.set_sky_params=function(a){if(g.check_active()){var b=g.get_active();g.set_sky_params(b,a)}else r.error("No active scene")};a.get_dof_params=function(){if(!g.check_active())return r.error("No active scene"),!1;var a=g.get_active();return g.get_subs(a,"DOF")?g.get_dof_params(a):null};a.set_dof_params=function(a){if(g.check_active()){var b=g.get_active();g.set_dof_params(b,
a)}else r.error("No active scene")};a.get_god_rays_params=function(){if(!g.check_active())return r.error("No active scene"),!1;var a=g.get_active();return g.get_subs(a,"GOD_RAYS")?g.get_god_rays_params(a):null};a.set_god_rays_params=function(a){if(g.check_active()){var b=g.get_active();g.set_god_rays_params(b,a)}else r.error("No active scene")};a.get_bloom_params=function(){if(!g.check_active())return r.error("No active scene"),!1;var a=g.get_active();return g.get_subs(a,"BLOOM")?g.get_bloom_params(a):
null};a.set_bloom_params=function(a){if(g.check_active()){var b=g.get_active();g.set_bloom_params(b,a)}else r.error("No active scene")};a.get_glow_material_params=function(){if(!g.check_active())return r.error("No active scene"),!1;var a=g.get_active();return g.get_subs(a,"GLOW_COMBINE")?g.get_glow_material_params(a):null};a.set_glow_material_params=function(a){if(g.check_active()){var b=g.get_active();g.set_glow_material_params(b,a)}else r.error("No active scene")};a.get_wind_params=function(){if(!g.check_active())return r.error("No active scene"),
!1;var a=g.get_active();return g.get_wind_params(a)};a.set_wind_params=function(a){if(g.check_active()){var b=g.get_active();d.set_wind_params(b,a)}else r.error("No active scene")};a.get_water_surface_level=g.get_water_surface_level;a.set_water_params=function(a){if(g.check_active()){var b=g.get_active();g.set_water_params(b,a)}else r.error("No active scene")};a.get_water_mat_params=function(a){if(g.check_active()){var b=g.get_active();g.get_water_mat_params(b,a)}else r.error("No active scene")};
a.update_scene_materials_params=function(){if(g.check_active()){var a=g.get_active();g.update_scene_permanent_uniforms(a)}else r.error("No active scene")};a.hide_object=function(a,b){b=b||!1;!l.is_mesh(a)&&!l.is_empty(a)||l.is_dynamic(a)?b?g.change_visibility(a,!0):g.change_visibility_rec(a,!0):r.error("show/hide is only supported for dynamic objects.")};a.show_object=function(a,b){b=b||!1;!l.is_mesh(a)&&!l.is_empty(a)||l.is_dynamic(a)?b?g.change_visibility(a,!1):g.change_visibility_rec(a,!1):r.error("show/hide is only supported for dynamic objects.")};
a.is_hidden=function(a){if(l.is_dynamic_mesh(a)||l.is_empty(a)||l.is_lamp(a))return g.is_hidden(a);r.error("show/hide is only supported for dynamic meshes/empties and lamps");return!1};a.is_visible=function(a){return a.render.is_visible};a.check_object=function(a){r.error_deprecated("scenes.check_object","scenes.check_object_by_name");return g.check_active()?d.objects_storage_check(a,g.get_active()):(r.error("No active scene"),!1)};a.check_object_by_name=function(a,b){return d.get_object(d.GET_OBJECT_BY_NAME,
a,b|0)?!0:!1};a.check_object_by_dupli_name=function(a,b,c){return d.get_object(d.GET_OBJECT_BY_DUPLI_NAME,a,b,c|0)?!0:!1};a.check_object_by_dupli_name_list=function(a,b){return d.get_object(d.GET_OBJECT_BY_DUPLI_NAME_LIST,a,b|0)?!0:!1};a.get_all_objects=function(a,b){var c=g.get_active();a||(a="ALL");b||0===b||(b=d.DATA_ID_ALL);return d.get_scene_objs(c,a,b)};a.get_object_name=function(a){return a?a.origin_name:(r.error("Wrong object name"),"")};a.get_object_name_hierarchy=function(a){if(!a)return r.error("Wrong object name"),
null;for(var b=[];a;)b.push(a.origin_name),a=l.get_dg_parent(a);return b.reverse()};a.get_object_type=function(a){return a&&a.type?a.type:(r.error("Wrong object"),"UNDEFINED")};a.get_object_dg_parent=function(a){r.error_deprecated("scenes.get_object_dg_parent","objects.get_dg_parent");return l.get_dg_parent(a)};a.get_object_children=function(a){return a.cons_descends.slice(0)};a.get_first_character=function(){for(var a=d.get_scene_objs(g.get_active(),"MESH",d.DATA_ID_ALL),b=0;b<a.length;b++){var c=
a[b];if(q.is_character(c))return c}return null};a.get_shore_dist=function(a,b){b||0===b||(b=1);return g.get_shore_dist(a,b)};a.get_cam_water_depth=function(){return g.get_cam_water_depth()};a.get_type_mesh_object=function(a){return l.is_mesh(a)?a.render.type:null};a.get_meta_tags=function(){if(!g.check_active())return r.error("No active scene"),!1;var a=g.get_active();return g.get_meta_tags(a)};a.append_object=function(a,b){if(a.render.is_copied){if(b)var c=g.get_all_scenes(),c=C.keysearch("name",
b,c);else c=g.get_active();g.append_object(c,a,!0)}else r.error('object "'+a.name+'" has been created not by coping.')};a.remove_object=function(a){if((l.is_mesh(a)||l.is_empty(a))&&l.is_dynamic(a)){for(var c=a.scenes_data,g=0;g<c.length;g++)b.prepare_object_unloading(c[g].scene,a,!1);d.remove_object(a)}else r.error("Can't remove object \""+a.name+'". It must be dynamic and type of MESH or EMPTY.')};a.marker_frame=function(a){var b=g.get_active();if(b.timeline_markers&&a in b.timeline_markers)return g.marker_frame(b,
a);r.error('"'+a+'" marker not found.');return 0};a.get_mb_params=function(){var a=g.get_active();return(a=g.get_subs(a,"MOTION_BLUR"))?{mb_factor:a.mb_factor,mb_decay_threshold:a.mb_decay_threshold}:null};a.set_mb_params=function(a){var b=g.get_active();(b=g.get_subs(b,"MOTION_BLUR"))?("number"==typeof a.mb_decay_threshold&&(b.mb_decay_threshold=a.mb_decay_threshold),"number"==typeof a.mb_factor&&(b.mb_factor=a.mb_factor)):r.error("The motion blur subscene doesn't exist.")};a.can_select_objects=
function(){var a=g.get_active();return Boolean(g.get_subs(a,"COLOR_PICKING"))}};b4w.module.sfx=function(a,p){var t=p("__obj_util"),c=p("__scenes"),b=p("__sfx"),k=p("__print");a.play=function(a,c,k){b.play(a,c||0,k||0)};a.play_def=function(a){b.play_def(a)};a.is_play=function(a){return b.is_playing(a)};a.is_playing=function(a){return b.is_playing(a)};a.stop=function(a){b.stop(a)};a.pause=function(a){b.speaker_pause(a)};a.resume=function(a){b.speaker_resume(a)};a.playrate=function(a,c){b.playrate(a,c)};a.get_playrate=function(a){return b.get_playrate(a)};a.cyclic=function(a,c){b.cyclic(a,
c)};a.is_cyclic=function(a){return b.is_cyclic(a)};a.listener_reset_speed=function(a,c){b.listener_reset_speed(a,c)};a.speaker_reset_speed=function(a,c,k){b.speaker_reset_speed(a,c,k)};a.get_volume=function(a){return a&&"object"===typeof a?b.get_volume(a):b.get_master_volume()};a.set_volume=function(a,c){a&&"object"===typeof a?b.set_volume(a,c):b.set_master_volume(c)};a.mute=function(a,c){a&&"object"===typeof a?b.mute(a,c):b.mute_master(c)};a.is_muted=function(a){return a&&"object"===typeof a?b.is_muted(a):
b.is_master_muted()};a.get_speaker_objects=function(){return b.get_speaker_objects().slice(0)};a.check_active_speakers=b.check_active_speakers;a.set_compressor_params=function(a){b.set_compressor_params(c.get_active(),a)};a.get_compressor_params=function(){return b.get_compressor_params(c.get_active())};a.duck=function(a,c,k){a&&"object"===typeof a?b.duck(a,c,k):b.duck_master(c,k)};a.unduck=function(a){a&&"object"===typeof a?b.unduck(a):b.unduck_master()};a.apply_playlist=b.apply_playlist;a.clear_playlist=
b.clear_playlist;a.detect_audio_container=b.detect_audio_container;a.detect_video_container=b.detect_video_container;a.set_positional_params=b.set_positional_params;a.get_positional_params=b.get_positional_params;a.set_filter_params=b.set_filter_params;a.get_filter_params=b.get_filter_params;a.get_filter_freq_response=b.get_filter_freq_response;a.get_duration=function(a){if(a&&t.is_speaker(a))return b.get_duration(a);k.error('Object "'+(a?a.name:void 0)+'" is not a valid speaker')}};b4w.module.textures=function(a,p){var t=p("__print"),c=p("__scenes"),b=p("__textures"),k=p("__obj_util");a.get_canvas_texture_context=function(a,c){t.error_deprecated("get_canvas_texture_context","get_canvas_ctx");c||(c=0);var k=b.get_canvas_context(a,c);if(k)return k;t.error('Canvas texture with ID "'+a+'" not found!')};a.update_canvas_texture_context=function(a,c){t.error_deprecated("update_canvas_texture_context","update_canvas_ctx");c||(c=0);b.update_canvas_context(a,c)||t.error('Canvas texture with ID "'+
a+'" not found!')};a.play_video=function(a,k){k||(k=0);c.get_active().b4w_use_nla&&b.video_allow_nla(a,k)?t.error("NLA texture can't be controlled directly through API."):b.play_video(a,k)||t.error('Texture with name "'+a+'" not found!')};a.pause_video=function(a,k){k||(k=0);c.get_active().b4w_use_nla&&b.video_allow_nla(a,k)?t.error("NLA texture can't be controlled directly through API."):b.pause_video(a,k)||t.error('Texture with name "'+a+'" not found!')};a.reset_video=function(a,k){k||(k=0);c.get_active().b4w_use_nla&&
b.video_allow_nla(a,k)?t.error("NLA texture can't be controlled directly through API."):b.reset_video(a,k)||t.error('Texture with name "'+a+'" not found!')};a.get_canvas_ctx=function(a,c){if(k.is_mesh(a)){var p=b.get_canvas_context_by_object(a,c);if(p)return p;t.error("Couldn't find canvas texture with this name: "+c)}else t.error("Object must be type of mesh.");return null};a.update_canvas_ctx=function(a,c){if(k.is_mesh(a)){if(b.update_canvas_context_by_object(a,c))return!0;t.error("Couldn't find canvas texture with this name: "+
c)}else t.error("Object must be type of mesh.");return!1}};b4w.module.time=function(a,p){var t=p("__time");a.set_timeout=t.set_timeout;a.clear_timeout=t.clear_timeout;a.get_timeline=t.get_timeline;a.animate=t.animate;a.clear_animation=t.clear_animation};b4w.module.transform=function(a,p){var t=p("__obj_util"),c=p("__physics"),b=p("__print"),k=p("__quat"),d=p("__transform"),l=p("__tsr"),q=p("__util"),r=new Float32Array(4),g=new Float32Array(3),C=new Float32Array(4);a.SPACE_LOCAL=d.SPACE_LOCAL;a.SPACE_WORLD=d.SPACE_WORLD;a.set_translation=function(a,h,k,l){t.is_dynamic(a)?(g[0]=h,g[1]=k,g[2]=l,d.set_translation(a,g),d.update_transform(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_translation_rel=function(a,h,
k,l){t.is_dynamic(a)?(g[0]=h,g[1]=k,g[2]=l,d.set_translation_rel(a,g),d.update_transform(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_translation_v=function(a,h){t.is_dynamic(a)?(d.set_translation(a,h),d.update_transform(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_translation_rel_v=function(a,h){t.is_dynamic(a)?(d.set_translation_rel(a,h),d.update_transform(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};
a.set_translation_obj_rel=function(a,h,k,p,r){t.is_dynamic(a)?(g[0]=h,g[1]=k,g[2]=p,h=l.get_trans_view(r.render.world_tsr),r=l.get_quat_view(r.render.world_tsr),q.transform_vec3(g,1,r,h,g),d.set_translation(a,g),d.update_transform(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.get_translation=function(a,b){b||(b=new Float32Array(3));d.get_translation(a,b);return b};a.get_translation_rel=function(a,b){b||(b=new Float32Array(3));d.get_translation_rel(a,b);return b};
a.set_rotation=function(a,h,g,k,l){t.is_dynamic(a)?(C[0]=h,C[1]=g,C[2]=k,C[3]=l,d.set_rotation(a,C),d.update_transform(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_rotation_rel=function(a,h,g,k,l){t.is_dynamic(a)?(C[0]=h,C[1]=g,C[2]=k,C[3]=l,d.set_rotation_rel(a,C),d.update_transform(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_rotation_v=function(a,h){t.is_dynamic(a)?(d.set_rotation(a,h),d.update_transform(a),c.sync_transform(a)):
b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_rotation_rel_v=function(a,h){t.is_dynamic(a)?(d.set_rotation_rel(a,h),d.update_transform(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.get_rotation=function(a,b){b||(b=new Float32Array(4));d.get_rotation(a,b);return b};a.get_rotation_rel=function(a,b){b||(b=new Float32Array(4));d.get_rotation_rel(a,b);return b};a.set_rotation_euler=function(a,h,k,l){t.is_dynamic(a)?(g[0]=h,g[1]=k,g[2]=l,d.set_rotation_euler(a,
g),d.update_transform(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_rotation_euler_rel=function(a,h,k,l){t.is_dynamic(a)?(g[0]=h,g[1]=k,g[2]=l,d.set_rotation_euler_rel(a,g),d.update_transform(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_rotation_euler_v=function(a,h){t.is_dynamic(a)?(d.set_rotation_euler(a,h),d.update_transform(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_rotation_euler_rel_v=
function(a,h){t.is_dynamic(a)?(d.set_rotation_euler_rel(a,h),d.update_transform(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_scale=function(a,c){t.is_dynamic(a)?(d.set_scale(a,c),d.update_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_scale_rel=function(a,c){t.is_dynamic(a)?(d.set_scale_rel(a,c),d.update_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.get_scale=function(a){return d.get_scale(a)};a.get_scale_rel=
function(a){return d.get_scale_rel(a)};a.empty_reset_transform=function(a){if("EMPTY"!=a.type)b.error("Wrong object: "+a.name);else{for(var h=0;h<a.cons_descends.length;h++)if(!t.is_dynamic(a.cons_descends[h])){b.error('Wrong object: "'+a.cons_descends[h].name+'" is not dynamic.');return}d.set_translation(a,[0,0,0]);d.set_rotation(a,[0,0,0,1]);d.set_scale(a,1);d.update_transform(a);c.sync_transform(a)}};a.get_object_size=function(a){return t.is_mesh(a)?d.get_object_size(a):(b.error("Wrong object: "+
a.name),0)};a.get_object_center=function(a,c,g){return t.is_mesh(a)?d.get_object_center(a,c,g):(b.error("Wrong object: "+a.name),null)};a.move_local=function(a,h,g,k){t.is_dynamic(a)?(d.move_local(a,h,g,k),d.update_transform(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.rotate_x_local=function(a,h){if(t.is_dynamic(a)){var g=k.setAxisAngle(q.AXIS_X,h,C);d.rotate_local(a,g);d.update_transform(a);c.sync_transform(a)}else b.error('Wrong object: "'+a.name+'" is not dynamic.')};
a.rotate_y_local=function(a,h){if(t.is_dynamic(a)){var g=k.setAxisAngle(q.AXIS_Y,h,C);d.rotate_local(a,g);d.update_transform(a);c.sync_transform(a)}else b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.rotate_z_local=function(a,h){if(t.is_dynamic(a)){var g=k.setAxisAngle(q.AXIS_Z,h,C);d.rotate_local(a,g);d.update_transform(a);c.sync_transform(a)}else b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.get_object_bounding_box=function(a){return d.get_object_bounding_box(a)};a.set_tsr=
function(a,h){t.is_dynamic(a)?(d.set_tsr(a,h),d.update_transform(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_tsr_rel=function(a,h){t.is_dynamic(a)?(d.set_tsr_rel(a,h),d.update_transform(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.get_tsr=function(a,b){b||(b=new Float32Array(8));d.get_tsr(a,b);return b};a.get_tsr_rel=function(a,b){b||(b=new Float32Array(8));d.get_tsr_rel(a,b);return b};a.distance=function(a,b){return d.distance(a,
b)};a.set_matrix=function(a,g){t.is_dynamic(a)?(l.from_mat4(g,r),d.set_tsr(a,r),d.update_transform(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_matrix_rel=function(a,g){t.is_dynamic(a)?(l.from_mat4(g,r),d.set_tsr_rel(a,r),d.update_transform(a),c.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.get_matrix=function(a,b){b||(b=new Float32Array(16));d.get_tsr(a,r);l.to_mat4(r,b);return b};a.get_matrix_rel=function(a,b){b||(b=new Float32Array(16));
d.get_tsr_rel(a,r);l.to_mat4(r,b);return b}};b4w.module.tsr=function(a,p){function t(a,b,c,p){p||(p=k.create());t(a,b,c,p);return p}p("__mat3");var c=p("__mat4"),b=p("__print"),k=p("__tsr");a.create=k.create;a.from_values=k.from_values;a.copy=k.copy;a.identity=k.identity;a.create_sep=function(a,c,k,p){b.error_deprecated("create_sep","set_sep");return t(a,c,k,p)};a.set_sep=k.set_sep;a.set_trans=k.set_trans;a.set_scale=k.set_scale;a.set_transcale=k.set_transcale;a.set_quat=k.set_quat;a.get_trans_view=k.get_trans_view;a.get_scale=k.get_scale;a.get_quat_view=
k.get_quat_view;a.invert=k.invert;a.to_mat4=function(a,b){b||(b=c.create());k.to_mat4(a,b);return b};a.from_mat4=k.from_mat4;a.multiply=k.multiply;a.transform_vec3=k.transform_vec3;a.transform_vec3_inv=k.transform_vec3_inv;a.transform_vectors=k.transform_vectors;a.transform_dir_vectors=k.transform_dir_vectors;a.transform_dir_vec3=k.transform_dir_vec3;a.transform_tangents=k.transform_tangents;a.translate=k.translate;a.interpolate=function(a,b,c,p){p||(p=k.create());k.interpolate(a,b,c,p);return p}};b4w.module.util=function(a,p){var t=p("__obj_util"),c=p("__print"),b=p("__util"),k=p("__vec3");a.AXIS_X=new Float32Array([1,0,0]);a.AXIS_Y=new Float32Array([0,1,0]);a.AXIS_Z=new Float32Array([0,0,1]);a.AXIS_MX=new Float32Array([-1,0,0]);a.AXIS_MY=new Float32Array([0,-1,0]);a.AXIS_MZ=new Float32Array([0,0,-1]);a.f32=function(a){return new Float32Array(a||0)};a.assert=b.assert;a.keyfind=b.keyfind;a.keysearch=b.keysearch;a.matrix_to_quat=function(a){return b.matrix_to_quat(a)};a.euler_to_quat=function(a,
c){c||(c=new Float32Array(4));return b.euler_to_quat(a,c)};a.quat_to_euler=function(a,c){c||(c=new Float32Array(3));return b.quat_to_euler(a,c)};a.sign=b.sign;a.clamp=b.clamp;a.quat_to_dir=b.quat_to_dir;a.ground_project_quat=function(a,c){return b.quat_project(a,b.AXIS_MY,b.AXIS_Y,b.AXIS_MZ,c)};a.cam_quat_to_mesh_quat=function(a,c){return b.cam_quat_to_mesh_quat(a,c)};a.quat_project=function(a,l,p,r,g){return 0!=k.dot(p,r)?(c.error("Wrong in-plane direction"),null):b.quat_project(a,l,p,r,g)};a.hash_code=
b.hash_code;a.smooth=b.smooth;a.smooth_v=b.smooth_v;a.is_vector=b.is_vector;a.correct_cam_quat_up=b.correct_cam_quat_up;a.quat_to_angle_axis=b.quat_to_angle_axis;a.random_from_array=b.random_from_array;a.xz_direction=b.xz_direction;a.line_plane_intersect=b.line_plane_intersect;a.is_mesh=function(a){c.error_deprecated("util.is_mesh","objects.is_mesh");return t.is_mesh(a)};a.is_armature=function(a){c.error_deprecated("util.is_armature","objects.is_armature");return t.is_armature(a)};a.angle_wrap_0_2pi=
b.angle_wrap_0_2pi;a.angle_wrap_periodic=b.angle_wrap_periodic;a.smooth_step=b.smooth_step;a.lerp=b.lerp};"object"==typeof module&&module.exports&&(GLOBAL.b4w={module:{}});b4w.module.version=function(a,p){p("__print");var t=p("__version");a.version=t.version;a.version_str=t.version_str;a.type=t.type;a.date=t.date;a.date_str=t.date_str};"object"==typeof module&&module.exports&&b4w.module.version(exports);b4w.module.objects=function(a,p){var t=p("__geometry"),c=p("__objects"),b=p("__obj_util"),k=p("__print"),d=p("__scenes");p("__util");a.get_meta_tags=function(a){if(a)return c.get_meta_tags(a)};a.copy=function(a,p,r){return b.is_mesh(a)?b.is_dynamic(a)?t.has_dyn_geom(a)||t.check_shape_keys(a)||!r?-1==c.get_scene_objs(d.get_active(),"MESH",c.DATA_ID_ALL).indexOf(a)?(k.error('object "'+a.name+'" does not belong to the active scene.'),!1):c.copy(a,p||"",r):(k.error('object "'+a.name+'" has not dynamic geometry for deep copying.'),
!1):(k.error('object "'+a.name+'" is not dynamic.'),!1):(k.error('object "'+a.name+'" is not of type "MESH".'),!1)};a.set_nodemat_value=function(a,d,p){b.is_mesh(a)?c.set_nodemat_value(a,d,p):k.error('The type of the object "'+a.name+'" is not "MESH".')};a.set_nodemat_rgb=function(a,d,p,g,t){b.is_mesh(a)?c.set_nodemat_rgb(a,d,p,g,t):k.error('The type of the object "'+a.name+'" is not "MESH".')};a.update_boundings=function(a){b.is_mesh(a)?t.has_dyn_geom(a)||t.check_shape_keys(a)?c.update_boundings(a):
k.error('object "'+a.name+'" has not dynamic geometry.'):k.error('The type of the object "'+a.name+'" is not "MESH".')};a.get_parent=b.get_parent;a.get_dg_parent=b.get_dg_parent;a.is_mesh=b.is_mesh;a.is_armature=b.is_armature;a.is_speaker=b.is_speaker;a.is_camera=b.is_camera;a.is_lamp=b.is_lamp;a.is_empty=b.is_empty;a.is_line=b.is_line;a.get_selectable_objects=function(){return c.get_selectable_objects()};a.get_outlining_objects=function(){return c.get_outlining_objects()}};b4w.module.main=function(a,p){function t(){window.performance||(E.log("Apply performance workaround"),window.performance={});var a=Date.now();window.performance.now||(E.log("Apply performance.now() workaround"),window.performance.now=function(){return Date.now()-a});H.set_timeline(0)}function c(a,b){for(var c=null,d=b?N:na,e=0;e<d.length;e++){var g=d[e];try{c=a.getContext(g,U)}catch(f){}if(c)break}c&&n.detect_tegra_invalid_enum_issue(c);return c}function b(a,b,c){a.addEventListener("webglcontextlost",
function(a){a.preventDefault();E.error("WebGL context lost");d()},!1);e.setup_context(c);var g=e.get_renderer_info();g&&E.log("%cRENDERER INFO:","color: #00a",c.getParameter(g.UNMASKED_VENDOR_WEBGL)+", "+c.getParameter(g.UNMASKED_RENDERER_WEBGL));M.setup_context(c);z.setup_context(c);x.setup_context(c);G.setup_context(c);D.setup_context(c);A.setup_context(c);F.setup_canvas(a);A.init(a,b);J.setup_dim(a.width,a.height,1);O.init();la=r();q()}function k(){ga=function(){}}function d(){l()||(ea=performance.now()/
1E3,O.pause(),K.pause(),x.pause(),g.pause())}function l(){return V<ea}function q(){Z(q);var a=performance.now()/1E3;da||(da=a);var b=a-da;if(!(b<1/T.max_fps)){for(var c=H.get_timeline(),d=0;d<S.length;d++)S[d](c,b);l()||(V>da&&(b-=V-Math.max(ea,da)),c+=b,H.set_timeline(c),D.update(),f.update(),F.update(),d=b,F.is_primary_loaded()&&(y.reset(),P.update(d),m.update(c,d),v.update(c,d),O.update(c,d),d&&C.update(d),F.is_primary_loaded()&&(K.update(c,d),F.is_primary_loaded()&&(B.update(c,d),F.is_primary_loaded()&&
(g.update(),u.update(c,d),ga(d,c),F.is_primary_loaded()&&(J.update(c,d),g.update_visibility(),oa&&(oa(w.toDataURL()),oa=null)))))),la(b));da=a}}function r(){var a=60,b=0,c=T.fps_measurement_interval,d=T.fps_callback_interval;return function(e){e<1/T.max_fps||(a=I.smooth(1/e,a,e,c),e=K.get_fps(),b=(b+1)%d,0==b&&X(Math.round(a),e))}}var g=p("__anchors"),C=p("__animation"),f=p("__assets"),h=p("__config"),n=p("__compat"),A=p("__container"),B=p("__controls"),F=p("__data"),D=p("__debug"),e=p("__extensions"),
z=p("__geometry"),y=p("__hud"),v=p("__nla"),m=p("__logic_nodes"),u=p("__objects"),K=p("__physics"),E=p("__print"),M=p("__renderer"),J=p("__scenes"),O=p("__sfx"),G=p("__shaders"),x=p("__textures"),H=p("__time"),P=p("__transform");p("__armature");var I=p("__util"),aa=p("__version"),U=h.context,T=h.defaults,w=null,fa=null,da=0,ea=0,V=0,S=[],X=function(){},la=function(){},ga=function(){},oa=null,na=["webgl","experimental-webgl"],N=["webgl2","experimental-webgl2"],Z=function(){return window.requestAnimationFrame||
window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){return window.setTimeout(a,1E3/T.max_fps)}}();a.init=function(a,d){h.set_paths();E.set_verbose(T.console_verbose);var e=aa.version_str()+" "+aa.type()+" ("+aa.date_str()+")";E.log("%cINIT ENGINE","color: #00a",e);if(!window.WebGLRenderingContext)return null;t();w=a;d?(y.init(d),fa=d):(h.defaults.show_hud_debug_info=!1,h.sfx.mix_mode=!1);n.apply_context_alpha_hack();
n.check_user_agent("Chrome")||(T.webgl2=!1);e=c(a,T.webgl2);!e&&T.webgl2&&(T.webgl2=!1,e=c(a,!1));if(!e)return null;E.log("%cINIT WEBGL "+(T.webgl2?"2":"1"),"color: #00a");window.gl=e;b(w,fa,e);h.apply_quality();n.set_hardware_defaults(e);G.load_shaders();T.ie11_edge_touchscreen_hack&&(a.style["touch-action"]="none");E.log("%cSET PRECISION:","color: #00a",T.precision);return e};a.set_check_gl_errors=function(a){D.set_check_gl_errors(a)};a.resize=function(a,b,c){E.error_deprecated("main.resize","container.resize");
A.resize(a,b,c)};a.set_fps_callback=function(a){X=a};a.clear_fps_callback=function(){X=function(){}};a.set_render_callback=function(a){ga=a};a.clear_render_callback=function(){k()};a.global_timeline=function(){E.error_deprecated("main.global_timeline","time.get_timeline");return H.get_timeline()};a.pause=d;a.resume=function(){l()&&(V=performance.now()/1E3,O.resume(),K.resume(),x.play(!0),g.resume())};a.is_paused=l;a.reset=function(){F.unload(0);fa=w=null;V=ea=da=0;X=function(){};la=function(){};ga=
function(){};S.length=0;H.reset()};a.canvas_data_url=function(a){oa=a};a.get_canvas_elem=function(){E.error_deprecated("main.get_canvas_elem","container.get_canvas");return w};a.detect_mobile=function(){return n.detect_mobile()};a.append_loop_cb=function(a){for(var b=0;b<S.length;b++)if(S[b]==a)return;S.push(a)};a.remove_loop_cb=function(a){for(var b=0;b<S.length;b++)if(S[b]==a){S.splice(b,1);break}}};b4w.module.nla=function(a,p){var t=p("__nla"),c=p("__time"),b=p("__print"),k=p("__util");a.set_frame=function(a){a=k.clamp(a,t.get_frame_start(),t.get_frame_end());t.check_logic_nodes()?b.error("The active scene is using NLA script."):t.set_frame(a,c.get_timeline())};a.get_frame=function(){return t.get_frame(c.get_timeline())};a.stop=function(){t.check_logic_nodes()?b.error("The active scene is using NLA script."):t.stop_nla()};a.play=function(a){t.check_logic_nodes()?b.error("The active scene is using NLA script."):
t.play_nla(a)};a.is_play=function(){return t.is_play()};a.get_frame_start=function(){return t.get_frame_start()};a.get_frame_end=function(){return t.get_frame_end()};a.check_nla=function(){return t.check_nla()};a.check_nla_scripts=function(){return t.check_logic_nodes()};a.check_logic_nodes=function(){return t.check_logic_nodes()};a.set_range=function(a,c){t.check_logic_nodes()?b.error("The active scene is using NLA script."):(c=parseFloat(c)||t.get_frame_end(),a=parseFloat(a)||t.get_frame_end(),
c=k.clamp(c,t.get_frame_start(),t.get_frame_end()),a=k.clamp(a,t.get_frame_start(),c),t.set_range(a,c))};a.reset_range=function(){t.check_logic_nodes()?b.error("The active scene is using NLA script."):t.reset_range()};a.set_cyclic=function(a){t.check_logic_nodes()?b.error("The active scene is using NLA script."):t.set_cyclic(a)};a.clear_callback=function(){t.check_logic_nodes()?b.error("The active scene is using NLA script."):t.clear_callback()}};b4w.module.app=function(a,p){function t(){var a=E.is_paused();document.addEventListener("visibilitychange",function(){document.hidden?(a=E.is_paused(),E.pause()):a||E.resume()},!1)}function c(a,b,c,d){var e=document.createElement("canvas"),g=document.getElementById(a);e.style.position="absolute";e.style.left=0;e.style.top=0;e.style.width=g.offsetWidth+"px";e.style.height=g.offsetHeight+"px";e.width=g.offsetWidth*window.devicePixelRatio;e.height=g.offsetHeight*window.devicePixelRatio;b?(b=document.createElement("canvas"),
b.style.position="absolute",e.style.left=0,e.style.top=0,b.style.pointerEvents="none"):b=null;g||(J.error('Warning: canvas container "'+a+'" not found, appending to body'),g=document.body);g.appendChild(e);if(!E.init(e,b))return c&&F("Browser could not initialize WebGL","For more info visit","https://www.blend4web.com/troubleshooting",d),!1;b&&v.insert_to_container(b,"LAST");return!0}function b(a,b){a?(b&&(document.getElementById(b).style.display="block"),I=document.getElementById(a)):(I=document.createElement("div"),
I.innerHTML=0,I.style.cssText="position:absolute;top: 23px;right: 20px;font-size: 45px;line-height: 50px;font-weight: bold;color: #000;",v.insert_to_container(I,"JUST_AFTER_CANVAS"))}function k(a,b){var c=String(a);b&&(c+="/"+String(b));I.innerHTML=c}function d(a){a=document.getElementById(a);var b=a.cloneNode(!0);a.parentNode.replaceChild(b,a);return b}function l(){var a=v.get_container();v.resize(a.clientWidth,a.clientHeight,!0)}function q(a,b,c){var d=Math.max(e.hover_get_distance(a),1),g=G.get_rotation(a,
V);b=x.quat_to_dir(g,b,da);b[1]=0;H.normalize(b,b);H.scale(b,d*c,b);c=G.get_translation(a,ea);H.add(c,b,c);e.set_translation(a,c)}function r(a,b){var c=e.hover_get_vertical_limits(a,X);if(0>c.up-c.down){var d=e.get_camera_angles(a,fa)[1],c=(c.down-d)/(c.down-c.up),d=e.hover_get_distance_limits(a,X),c=Math.max(c,2/d.max);e.hover_rotate(a,0,c*b)}}function g(a,b,c,d){G.move_local(a,5*b,5*c,5*d)}function C(a,b,c){var d=e.target_get_distance(a),g=Math.abs(b);c=Math.pow(g*c,1-Math.pow(g*c,.15));G.move_local(a,
0,0>b?.001<d?-d*c:0:c/(1-c)*d,0)}function f(a,b,c,d,e){for(a=d*c;0<b;--b)d+=a,e+=a,a=d*c;return e}function h(a,b,c,d,g,h){h?(g=e.target_get_pivot(a,da),h=e.get_translation(a),g=H.dist(g,h)+d,d=0<b?f(a,b,-c,g,d):f(a,-b,c/(1-c),g,d)):d-=b*g*c;return d}function n(a,b,c){aa=a;U=b;T=c;var d=O.get_active_camera();A(d);var f=!1,k=null,l=!1;switch(e.get_move_style(d)){case e.MS_TARGET_CONTROLS:f=!a;break;case e.MS_EYE_CONTROLS:k=O.get_first_character();break;case e.MS_STATIC:return;case e.MS_HOVER_CONTROLS:l=
!0}var n=e.get_velocities(d,S);a=m.create_elapsed_sensor();if(M.has_simulated_physics(d)){var p=m.create_collision_sensor(d,null,!0);m.create_sensor_manifold(d,"CAMERA_COLLISION",m.CT_POSITIVE,[p],null,function(a,b,c){c=m.get_sensor_payload(a,b,0).coll_dist;if(0>c){var d=m.get_sensor_payload(a,b,0).coll_norm;b=da;H.scale(d,-.25*c,b);c=G.get_translation(a,ea);H.add(c,b,c);G.set_translation_v(a,c)}})}if(k){var p=G.get_translation(d),t=G.get_rotation(d),t=x.cam_quat_to_mesh_quat(t);p[1]-=.5;M.set_transform(k,
p,t);y.append_stiff_trans(d,k,[0,.5,0]);var v=new Float32Array(2),u=!0;M.set_character_move_type(k,M.CM_FLY);m.create_kb_sensor_manifold(d,"TOGGLE_CHAR_MOVE_TYPE",m.CT_SHOT,m.KEY_C,function(){u=!u;M.set_character_move_type(k,u?M.CM_FLY:M.CM_WALK)})}p=function(a,b,c){if(1==c)switch(c=m.get_sensor_value(a,b,0),e.get_velocities(a,n),b){case "FORWARD":k?v[0]=1:l?(b=e.get_camera_angles(a,fa)[1],b=Math.abs(b)>=Math.PI/4?x.AXIS_MZ:x.AXIS_MY,q(a,b,.5*n.trans*c)):f?C(a,-n.zoom,c):g(a,0,-n.trans*c,0);break;
case "BACKWARD":k?v[0]=-1:l?(b=e.get_camera_angles(a,fa)[1],b=Math.abs(b)>=Math.PI/4?x.AXIS_Z:x.AXIS_Y,q(a,b,.5*n.trans*c)):f?C(a,n.zoom,c):g(a,0,n.trans*c,0);break;case "UP":l?r(a,30*-n.zoom*c):k||g(a,0,0,-n.trans*c);break;case "DOWN":l?r(a,30*n.zoom*c):k||g(a,0,0,n.trans*c);break;case "LEFT":k?v[1]=1:l?q(a,x.AXIS_MX,.5*n.trans*c):g(a,-n.trans*c,0,0);break;case "RIGHT":k?v[1]=-1:l?q(a,x.AXIS_X,.5*n.trans*c):g(a,n.trans*c,0,0);break;case "ROT_LEFT":f?e.target_rotate(a,2*-n.rot*c,0):e.eye_rotate(a,
2*n.rot*c,0);break;case "ROT_RIGHT":f?e.target_rotate(a,2*n.rot*c,0):e.eye_rotate(a,2*-n.rot*c,0);break;case "ROT_UP":f?e.target_rotate(a,0,2*-n.rot*c):e.eye_rotate(a,0,2*n.rot*c);break;case "ROT_DOWN":f?e.target_rotate(a,0,2*n.rot*c):e.eye_rotate(a,0,2*-n.rot*c)}else switch(b){case "FORWARD":case "BACKWARD":k&&(v[0]=0);break;case "LEFT":case "RIGHT":k&&(v[1]=0)}k&&(M.set_character_move_dir(k,v[0],v[1]),a=e.get_camera_angles_char(a,w),M.set_character_rotation(k,a[0],a[1]))};if(b)b=t=z=J=B=E=m.create_custom_sensor(0);
else{b=m.create_keyboard_sensor(m.KEY_W);var t=m.create_keyboard_sensor(m.KEY_S),z=m.create_keyboard_sensor(m.KEY_A),J=m.create_keyboard_sensor(m.KEY_D),B=m.create_keyboard_sensor(m.KEY_R),E=m.create_keyboard_sensor(m.KEY_F)}var D=m.create_keyboard_sensor(m.KEY_UP),I=m.create_keyboard_sensor(m.KEY_DOWN),F=m.create_keyboard_sensor(m.KEY_LEFT),K=m.create_keyboard_sensor(m.KEY_RIGHT),V=function(a){return a[0]&&(a[1]||a[2])};l||(m.create_sensor_manifold(d,"FORWARD",m.CT_CONTINUOUS,[a,b],null,p),m.create_sensor_manifold(d,
"BACKWARD",m.CT_CONTINUOUS,[a,t],null,p));f?(m.create_sensor_manifold(d,"ROT_UP",m.CT_CONTINUOUS,[a,D,B],V,p),m.create_sensor_manifold(d,"ROT_DOWN",m.CT_CONTINUOUS,[a,I,E],V,p),m.create_sensor_manifold(d,"ROT_LEFT",m.CT_CONTINUOUS,[a,F,z],V,p),m.create_sensor_manifold(d,"ROT_RIGHT",m.CT_CONTINUOUS,[a,K,J],V,p)):l?(m.create_sensor_manifold(d,"LEFT",m.CT_CONTINUOUS,[a,F,z],V,p),m.create_sensor_manifold(d,"RIGHT",m.CT_CONTINUOUS,[a,K,J],V,p),m.create_sensor_manifold(d,"FORWARD",m.CT_CONTINUOUS,[a,D,
b],V,p),m.create_sensor_manifold(d,"BACKWARD",m.CT_CONTINUOUS,[a,I,t],V,p),m.create_sensor_manifold(d,"UP",m.CT_CONTINUOUS,[a,E],V,p),m.create_sensor_manifold(d,"DOWN",m.CT_CONTINUOUS,[a,B],V,p)):(m.create_sensor_manifold(d,"UP",m.CT_CONTINUOUS,[a,B],V,p),m.create_sensor_manifold(d,"DOWN",m.CT_CONTINUOUS,[a,E],V,p),m.create_sensor_manifold(d,"LEFT",m.CT_CONTINUOUS,[a,z],V,p),m.create_sensor_manifold(d,"RIGHT",m.CT_CONTINUOUS,[a,J],V,p),m.create_sensor_manifold(d,"ROT_UP",m.CT_CONTINUOUS,[a,D],V,p),
m.create_sensor_manifold(d,"ROT_DOWN",m.CT_CONTINUOUS,[a,I],V,p),m.create_sensor_manifold(d,"ROT_LEFT",m.CT_CONTINUOUS,[a,F],V,p),m.create_sensor_manifold(d,"ROT_RIGHT",m.CT_CONTINUOUS,[a,K],V,p));if(!c){var X=0;c=m.create_mouse_wheel_sensor();var W=0,p=m.create_touch_zoom_sensor();m.create_sensor_manifold(d,"MOUSE_WHEEL",m.CT_LEVEL,[c],null,function(a,b,c){1==c&&(b=m.get_sensor_value(a,b,0),e.get_velocities(a,n),f||l?X=h(a,b,n.zoom,X,2,f):(n.trans*=1+b*n.zoom,e.set_velocities(a,n)))});m.create_sensor_manifold(d,
"TOUCH_ZOOM",m.CT_LEVEL,[p],null,function(a,b,c,d){1==c&&(c=m.get_sensor_value(a,b,0),e.get_velocities(a,n),m.get_sensor_payload(a,b,0)===m.PL_MULTITOUCH_MOVE_ZOOM&&(W=h(a,c,.03*n.zoom,W,2,f)))});m.create_sensor_manifold(d,"ZOOM_INTERPOL",m.CT_POSITIVE,[a],null,function(a,b,c){if(f||l)1E-5<Math.abs(X)||1E-5<Math.abs(W)?(c=m.get_sensor_value(a,b,0),b=x.smooth(X,0,c,.1*P),X-=b,c=x.smooth(W,0,c,.15*P),W-=c,l?r(a,-(b+c)):(b=e.target_get_distance(a)+b+c,b=Math.max(b,.001),e.target_set_distance(a,b))):
W=X=0})}var La=0,ua=0,Cb=0,pa=0;c=m.create_mouse_move_sensor("X");p=m.create_mouse_move_sensor("Y");b=m.create_mouse_click_sensor();t=function(a,b,c,d){if(1==c){c=m.get_sensor_value(a,b,1);e.get_velocities(a,n);if(l)g=.003*n.trans,f=7.5E-4*n.rot;else var g=.003*n.rot,f=7.5E-4*n.trans;if(1===m.get_sensor_payload(a,b,0))La+="X"==d?-c*g:0,ua+="Y"==d?-c*g:0;else if(2===m.get_sensor_payload(a,b,0)||3===m.get_sensor_payload(a,b,0))Cb+="X"==d?-c*f:0,pa+="Y"==d?-c*f:0}};m.create_sensor_manifold(d,"MOUSE_X",
m.CT_LEVEL,[b,c],null,t,"X");m.create_sensor_manifold(d,"MOUSE_Y",m.CT_LEVEL,[b,p],null,t,"Y");var Ca=0,sb=0,Ba=0,Vb=0;c=m.create_touch_move_sensor("X");p=m.create_touch_move_sensor("Y");b=function(a,b,c,d){if(1==c){var e=l?.003*n.trans:.003*n.rot;c=m.get_sensor_value(a,b,0);m.get_sensor_payload(a,b,0)===m.PL_SINGLE_TOUCH_MOVE?(Ca+="X"==d?-c*e:0,sb+="Y"==d?-c*e:0):m.get_sensor_payload(a,b,0)===m.PL_MULTITOUCH_MOVE_PAN&&(a=l?.003*n.rot:7.5E-4*n.trans,Ba+="X"==d?-c*a:0,Vb+="Y"==d?-c*a:0)}};m.create_sensor_manifold(d,
"TOUCH_X",m.CT_LEVEL,[c],null,b,"X");m.create_sensor_manifold(d,"TOUCH_Y",m.CT_LEVEL,[p],null,b,"Y");m.create_sensor_manifold(d,"ROT_TRANS_INTERPOL",m.CT_POSITIVE,[a],null,function(a,b,c){if(1E-5<Math.abs(La)||1E-5<Math.abs(ua)||1E-5<Math.abs(Ca)||1E-5<Math.abs(sb)||1E-5<Math.abs(Cb)||1E-5<Math.abs(pa)||1E-5<Math.abs(Ba)||1E-5<Math.abs(Vb)){var d=m.get_sensor_value(a,b,0),g=x.smooth(La,0,d,.08*P),h=x.smooth(ua,0,d,.08*P);La-=g;ua-=h;var n=x.smooth(Ca,0,d,.12*P),p=x.smooth(sb,0,d,.12*P);Ca-=n;sb-=
p;b=x.smooth(Cb,0,d,.08*P);var r=x.smooth(pa,0,d,.08*P);Cb-=b;pa-=r;c=x.smooth(Ba,0,d,.12*P);d=x.smooth(Vb,0,d,.12*P);Ba-=c;Vb-=d;f?(e.target_rotate(a,g+n,h+p),h=e.target_get_distance(a),e.target_pan_pivot(a,h*(b+c),h*(r+d))):l?(g+n&&q(a,x.AXIS_X,.2*(g+n)),h+p&&(r=e.get_camera_angles(a,fa)[1],r=Math.abs(r)>Math.PI/4?x.AXIS_Z:x.AXIS_Y,q(a,r,.2*(h+p))),e.hover_rotate(a,b+c,0)):(e.eye_rotate(a,.5*(g+n),.5*(h+p)),k&&(a=e.get_camera_angles_char(a,w),M.set_character_rotation(k,a[0],a[1])))}});m.create_kb_sensor_manifold(d,
"DEC_STEREO_DIST",m.CT_SHOT,m.KEY_LEFT_SQ_BRACKET,function(a,b,c){b=e.get_stereo_distance(a);e.set_stereo_distance(a,.9*b)});m.create_kb_sensor_manifold(d,"INC_STEREO_DIST",m.CT_SHOT,m.KEY_RIGHT_SQ_BRACKET,function(a,b,c){b=e.get_stereo_distance(a);e.set_stereo_distance(a,1.1*b)})}function A(a){var b=e.get_move_style(a),c=m.create_callback_sensor(function(){var c=e.get_move_style(a),d=c!=b;b=c;return d});m.create_sensor_manifold(a,"CHANGE_MOVE_STYLE",m.CT_POSITIVE,[c],null,function(a,b,c){B();n(aa,
U,T)})}function B(){for(var a=O.get_active_camera(),b="FORWARD BACKWARD ROT_UP ROT_DOWN ROT_LEFT ROT_RIGHT UP DOWN LEFT RIGHT MOUSE_WHEEL TOUCH_ZOOM ZOOM_INTERPOL MOUSE_X MOUSE_Y TOUCH_X TOUCH_Y ROT_TRANS_INTERPOL CHANGE_MOVE_STYLE".split(" "),c=0;c<b.length;c++)m.remove_sensor_manifold(a,b[c]);e.get_move_style(a)==e.MS_EYE_CONTROLS&&O.get_first_character()&&y.remove(a)}function F(a,b,c,d){var e=document.createElement("div"),g=document.createElement("div"),f=document.createElement("div");if(d)for(var h=
0;h<d.length;h++){var k=document.getElementById(d[h]);k&&k.parentNode.removeChild(k)}e.style.cssText="z-index:10;width:100%;height:auto;position:absolute;top:50%;margin-top:150px;text-align:center;";g.style.cssText="color:#fff;font-size:24px;";f.style.cssText="color:#fff;font-size:20px;";g.innerHTML=a;f.innerHTML=b+'   <a style="color:#fff;font-size:20px;width:100%;" href="'+c+'">'+c.replace("https://www.","")+"</a>";e.appendChild(g);e.appendChild(f);document.body.appendChild(e)}function D(a,b,c,
d,e){function g(){var h=performance.now()-f;e(b+h*(c-b)/d);(h>=d||!a.parentNode)&&E.remove_loop_cb(g)}var f=performance.now();E.append_loop_cb(g)}p("animation");var e=p("camera"),z=p("config"),y=p("constraints"),v=p("container"),m=p("controls"),u=p("data"),K=p("debug"),E=p("main"),M=p("physics"),J=p("print"),O=p("scenes"),G=p("transform"),x=p("util"),H=p("vec3"),P=1,I=null,aa=!1,U=!1,T=!1,w=new Float32Array(2),fa=new Float32Array(2),da=new Float32Array(3),ea=new Float32Array(3);new Float32Array(3);
var V=new Float32Array(4),S={},X={};a.init=function(a){a=a||{};var d=!1,e=null,g=function(){},f=null,h=null,n=0,p=null,q=!1,r=!0,x=!0,y=!0,w=!1,A=!1,G=!1,J=!1,B;for(B in a)switch(B){case "canvas_container_id":e=a.canvas_container_id;break;case "callback":g=a.callback;break;case "autoresize":d=a.autoresize;break;case "do_not_use_onload":break;case "gl_debug":q=a.gl_debug;break;case "show_hud_debug_info":G=a.show_hud_debug_info;break;case "sfx_mix_mode":w=a.sfx_mix_mode;break;case "show_fps":A=a.show_fps;
break;case "track_container_position":J=a.track_container_position;break;case "fps_wrapper_id":p=a.fps_wrapper_id;break;case "fps_elem_id":h=a.fps_elem_id;break;case "error_purge_elements":f=a.error_purge_elements;break;case "report_init_failure":y=a.report_init_failure;break;case "pause_invisible":x=a.pause_invisible;break;case "key_pause_enabled":r=a.key_pause_enabled;break;case "force_container_ratio":n=a.force_container_ratio;break;default:z.set(B,a[B])}a=function(a){a.keyCode==m.KEY_P&&(E.is_paused()?
E.resume():E.pause())};r&&document.addEventListener("keydown",a,!1);z.set("show_hud_debug_info",G);z.set("sfx_mix_mode",w);var C=G||w||null,r=function(){var a=c(e,C,y,f),m=v.get_canvas();if(a){var r=v.get_container();l();E.set_check_gl_errors(q);A&&(b(h,p),E.set_fps_callback(k));x&&t();n&&E.append_loop_cb(function(){r.style.height=r.clientWidth/n+"px"});d&&E.append_loop_cb(function(){var a=r.clientWidth,b=r.clientHeight;a==m.clientWidth&&b==m.clientHeight||v.resize(a,b,!0)});J&&E.append_loop_cb(function(){v.force_offsets_updating()});
g(m,!0)}else g(m,!1)};"complete"==document.readyState?window.setTimeout(r,0):window.addEventListener("load",r,!1);window.addEventListener("unload",function(){u.cleanup()},!1)};a.resize_to_container=l;a.set_onclick=function(a,b){var c=d(a);c.addEventListener("mouseup",function(a){b(c.value)},!1)};a.set_onchange=function(a,b){var c=d(a);c.addEventListener("change",function(a){a=c.checked;b(void 0!=a?a:c.value)},!1)};a.set_onkeypress=function(a,b){var c=d(a);c.addEventListener("keypress",function(a){b(a.keyCode,
c.value)},!1)};a.enable_camera_controls=n;a.disable_camera_controls=B;a.set_camera_move_style=function(a){J.error_deprecated("app.set_camera_move_style","camera.set_move_style");var b=O.get_active_camera();e.set_move_style(b,a)};a.enable_object_controls=function(a){var b=M.is_vehicle_chassis(a)||M.is_vehicle_hull(a),c=function(a,c,d){if(1==d)switch(d=m.get_sensor_value(a,c,0),c){case "FORWARD":b?M.vehicle_throttle(a,1):G.move_local(a,0,0,1*d);break;case "BACKWARD":b?M.vehicle_throttle(a,-1):G.move_local(a,
0,0,-1*d);break;case "LEFT":b?M.vehicle_steer(a,-1):G.move_local(a,1*d,0,0);break;case "RIGHT":b?M.vehicle_steer(a,1):G.move_local(a,-1*d,0,0)}else switch(c){case "FORWARD":case "BACKWARD":b&&M.vehicle_throttle(a,0);break;case "LEFT":case "RIGHT":b&&M.vehicle_steer(a,0)}},d=m.create_elapsed_sensor(),e=m.create_keyboard_sensor(m.KEY_W),g=m.create_keyboard_sensor(m.KEY_S),f=m.create_keyboard_sensor(m.KEY_A),h=m.create_keyboard_sensor(m.KEY_D),k=m.create_keyboard_sensor(m.KEY_UP),l=m.create_keyboard_sensor(m.KEY_DOWN),
n=m.create_keyboard_sensor(m.KEY_LEFT),p=m.create_keyboard_sensor(m.KEY_RIGHT),q=function(a){return a[0]&&(a[1]||a[2])};m.create_sensor_manifold(a,"FORWARD",m.CT_CONTINUOUS,[d,e,k],q,c);m.create_sensor_manifold(a,"BACKWARD",m.CT_CONTINUOUS,[d,g,l],q,c);m.create_sensor_manifold(a,"LEFT",m.CT_CONTINUOUS,[d,f,n],q,c);m.create_sensor_manifold(a,"RIGHT",m.CT_CONTINUOUS,[d,h,p],q,c)};a.disable_object_controls=function(a){for(var b=["FORWARD","BACKWARD","LEFT","RIGHT"],c=0;c<b.length;c++)m.remove_sensor_manifold(a,
b[c])};a.enable_controls=function(a){var b=v.get_container();a=a||!1;m.register_keyboard_events(document,!1);m.register_mouse_events(b,!0,a);m.register_wheel_events(b,!0);m.register_touch_events(b,!0);m.register_device_orientation()};a.disable_controls=function(){var a=v.get_container();m.unregister_keyboard_events(document);m.unregister_mouse_events(a);m.unregister_wheel_events(a);m.unregister_touch_events(a);m.unregister_device_orientation()};a.enable_debug_controls=function(){m.create_kb_sensor_manifold(null,
"CAMERA_SHOT",m.CT_SHOT,m.KEY_K,function(){K.make_camera_frustum_shot()});m.create_kb_sensor_manifold(null,"LIGHT_SHOT",m.CT_SHOT,m.KEY_L,function(){K.make_light_frustum_shot()});m.create_kb_sensor_manifold(null,"TELEMETRY",m.CT_SHOT,m.KEY_T,function(){K.plot_telemetry()})};a.request_fullscreen=function(a,b,c,d){function e(){document.fullscreenElement===a||document.webkitFullScreenElement===a||document.mozFullScreenElement===a||document.webkitIsFullScreen||document.msFullscreenElement===a?b():(document.removeEventListener("fullscreenchange",
e,!1),document.removeEventListener("webkitfullscreenchange",e,!1),document.removeEventListener("mozfullscreenchange",e,!1),document.removeEventListener("MSFullscreenChange",e,!1),c())}b=b||function(){};c=c||function(){};document.addEventListener("fullscreenchange",e,!1);document.addEventListener("webkitfullscreenchange",e,!1);document.addEventListener("mozfullscreenchange",e,!1);document.addEventListener("MSFullscreenChange",e,!1);a.requestFullScreen=a.requestFullScreen||a.webkitRequestFullScreen||
a.mozRequestFullScreen||a.msRequestFullscreen;var g=null;a.requestFullScreen==a.webkitRequestFullScreen&&(g=Element.ALLOW_KEYBOARD_INPUT);d&&a.requestFullScreen!=a.mozRequestFullScreen&&(g=g||{vrDisplay:d,vrDistortion:z.get("use_browser_distortion_cor")});a.requestFullScreen(g)};a.exit_fullscreen=function(){var a=document.exitFullscreen||document.webkitExitFullscreen||document.mozCancelFullScreen||document.msExitFullscreen;if("function"!=typeof a)throw"B4W App: exit fullscreen method is not supported";
a.apply(document)};a.check_fullscreen=function(){return window.document.fullscreenEnabled||window.document.mozFullScreenEnabled||window.document.msFullscreenEnabled||window.document.webkitFullscreenEnabled?!0:!1};a.report_app_error=F;a.get_url_params=function(a){a=!!a;var b=decodeURIComponent(location.href.toString());if(-1==b.indexOf("?"))return null;for(var b=b.split("?")[1].split("&"),c={},d=0;d<b.length;d++){var e=b[d].split("="),g=e[0];1<e.length?(e=e[1],a?g in c?c[g].push(e):c[g]=[e]:c[g]=e):
a?g in c||(c[g]=[]):c[g]=""}return c};a.css_animate=function(a,b,c,d,e,g,f,h){function k(e){a&&(l[b]=g+e+f,c>d&&e<=d||c<d&&e>=d)&&(l[b]=g+d+f,h())}if(a&&b&&isFinite(c)&&isFinite(d)&&isFinite(e)){g=g||"";f=f||"";h=h||function(){};var l=a.style,m=b.charAt(0).toUpperCase()+b.slice(1);if(void 0==l[b])if(void 0!=l["webkit"+m])b="webkit"+m;else if(void 0!=l["ms"+m])b="ms"+m;else if(void 0!=l["moz"+m])b="moz"+m;else return;D(a,c,d,e,k)}};a.attr_animate=function(a,b,c,d,e,g){function f(e){a&&(0<=e&&a.setAttribute(b,
e),c>d&&e<=d||c<d&&e>=d)&&(a.setAttribute(b,d),g())}a&&b&&isFinite(c)&&isFinite(d)&&isFinite(e)&&(g=g||function(){},D(a,c,d,e,f))};a.queue_animate=function(b){if(b.length){var c=b.shift(),d=c.elem,e=c.prop,g=c.from,f=c.to,h=c.duration,k=c.opt_prefix,l=c.opt_suffix,m=function(){c.cb&&c.cb();a.queue_animate(b)};"css"==c.type?a.css_animate(d,e,g,f,h,k,l,m):"attr"==c.type&&a.attr_animate(d,e,g,f,h,m)}};a.set_camera_smooth_factor=function(a){P=a};a.get_camera_smooth_factor=function(){return P}};b4w.module.camera_anim=function(a,p){function t(a,b,c,d){b=g.angle_wrap_0_2pi(a-b);a=g.angle_wrap_0_2pi(c-a);if(1E-6>Math.abs(b)||1E-6>2*Math.PI-Math.abs(b))b=0;if(1E-6>Math.abs(a)||1E-6>2*Math.PI-Math.abs(a))a=0;d[0]=b;d[1]=a;return d}var c=p("camera"),b=p("controls"),k=p("print"),d=p("scenes"),l=p("time"),q=p("transform"),r=p("tsr"),g=p("util"),C=p("vec3"),f=p("quat"),h=new Float32Array(2),n=new Float32Array(2),A=new Float32Array(3),B=new Float32Array(3),F=new Float32Array(3),D=new Float32Array(4),
e=r.create(),z=r.create(),y=r.create(),v={},m=!1,u=!1,K=!1,E=!1;a.track_to_target=function(a,d,e,l,m,n,p,r){if(!c.is_eye_camera(a))k.error("track_to_target(): wrong object");else if(a&&d){if(g.is_vector(d))var t=d;else t=F,q.get_object_center(d,!1,t);d=e||1;e=l||2;var v=m||1;m=n||1;B[0]=0;B[1]=-1;B[2]=0;var u=q.get_rotation(a);n=g.quat_to_dir(u,B);l=c.get_camera_angles(a,h);var y=q.get_translation(a);C.subtract(t,y,A);C.normalize(A,A);var z=f.rotationTo(n,A,f.create());f.multiply(z,u,D);g.correct_cam_quat_up(D,
!1);C.subtract(t,y,B);var E=C.length(B)*(1-1/e),t=Math.asin(A[1]);e=Math.acos(-A[2]/Math.abs(Math.cos(t)));0<A[0]&&(e=2*Math.PI-e);var K=e-l[0],V=t-l[1];F[0]=0;F[1]=0;F[2]=-1;e=q.get_rotation(a);0>g.quat_to_dir(e,F)[1]?(V=0<n[1]?t-Math.PI+l[1]:t+Math.PI+l[1],K=0<K?-Math.PI+K:Math.PI+K):Math.abs(K)>Math.PI&&(K=0<K?K-2*Math.PI:K+2*Math.PI);var S=0,t=b.create_elapsed_sensor();n=Math.abs(K/d);d=Math.abs(V/d);var X=n>d?n:d,la=X+v,ga=la+m,oa=ga+v,na=K,N=V,Z=E,ba=function(){b.remove_sensor_manifold(a,"TRACK_TO_TARGET");
p&&p()};b.create_sensor_manifold(a,"TRACK_TO_TARGET",b.CT_CONTINUOUS,[t],null,function(a,d,e){if(e)if(c.is_eye_camera(a))if(e=b.get_sensor_value(a,d,0),S+=e,S<X){var g=K/X*e;e*=V/X;d=S/X;d=6*d*(1-d);g*=d;e*=d;na-=g;N-=e;c.eye_rotate(a,g,e)}else S<la?(na&&(c.eye_rotate(a,na,N),na=0,r&&r()),d=(S-X)/v,e=-E*e/v,Z-=g,q.move_local(a,0,6*e*d*(1-d),0)):S<ga?Z&&(q.move_local(a,0,Z,0),Z=0):S<oa?(d=(S-ga)/v,e=E*e/v,e=6*e*d*(1-d),q.move_local(a,0,e,0)):(q.set_translation_v(a,y),ba());else ba()})}};a.auto_rotate=
function(a,e,f){function l(d,e,f){if(1==f)if(f=c.get_move_style(d),f==c.MS_STATIC)m();else if(f!=c.MS_TARGET_CONTROLS&&f!=c.MS_EYE_CONTROLS||!c.has_horizontal_rot_limits(d))q=null,e=b.get_sensor_value(d,e,0),c.rotate_camera(d,e*a,0);else{f=f==c.MS_EYE_CONTROLS?c.eye_get_horizontal_limits(d,v):c.target_get_horizontal_limits(d,v);if(null===q||f.left!=q.left||f.right!=q.right){q=q||{};q.left=f.left;q.right=f.right;r=Math.min(.2,g.angle_wrap_0_2pi(q.right-q.left)/2);f=q;var k=c.get_camera_angles(p,h)[0];
f=t(k,f.left,f.right,n);u=a*Math.min(1,f[0]/.2,f[1]/.2)}e=b.get_sensor_value(d,e,0);f=c.get_camera_angles(d,h)[0];f=t(f,q.left,q.right,n);f[1]>r&&f[0]>r?u=g.sign(u)*a:f[1]<r?u-=Math.pow(a,2)/.4*e:f[0]<r&&(u+=Math.pow(a,2)/.4*e);c.rotate_camera(d,e*u,0)}}function m(){b.remove_sensor_manifold(p,"AUTO_ROTATE");b.remove_sensor_manifold(p,"DISABLE_AUTO_ROTATE");e()}e=e||function(){};var p=d.get_active_camera();if(c.is_static_camera(p))k.error("auto_rotate(): Wrong camera move style");else{var q={},r=0,
u=0;if(b.check_sensor_manifold(p,"AUTO_ROTATE"))m();else{var y=b.create_mouse_move_sensor("X"),z=b.create_mouse_move_sensor("Y"),w=b.create_mouse_click_sensor(),A=b.create_touch_move_sensor(),B=b.create_touch_zoom_sensor(),C=b.create_elapsed_sensor();f=f?b.create_mouse_wheel_sensor():b.create_custom_sensor(0);b.create_sensor_manifold(p,"DISABLE_AUTO_ROTATE",b.CT_LEVEL,[y,z,w,A,B,f],function(a){return a[0]&&a[2]||a[1]&&a[2]||a[3]||a[4]||a[5]},m);b.create_sensor_manifold(p,"AUTO_ROTATE",b.CT_CONTINUOUS,
[C],function(a){return a[0]},l)}}};a.is_auto_rotate=function(){var a=d.get_active_camera();return b.check_sensor_manifold(a,"AUTO_ROTATE")};a.check_auto_rotate=function(){var a=d.get_active_camera();return c.get_move_style(a)==c.MS_STATIC?!1:!0};a.move_camera_to_point=function(a,b,d,f,h){if(c.get_move_style(a)!=c.MS_STATIC)k.error("move_camera_to_point(): wrong camera type");else if(!m)if(a)if(b){d=d||1;f=f||.01;var n=g.is_vector(a)?a:q.get_tsr(a,e),p=g.is_vector(b)?b:q.get_tsr(b,z);b=C.distance(r.get_trans_view(n),
r.get_trans_view(p))/d;d=g.quat_to_dir(r.get_quat_view(n),g.AXIS_MY,A);var t=g.quat_to_dir(r.get_quat_view(p),g.AXIS_MY,B);d=Math.min(Math.abs(C.dot(d,t)),1);f=Math.acos(d)/f;f=1E3*Math.max(b,f);m=!0;var v=l.animate(0,1,f,function(b){var c=r.interpolate(n,p,g.smooth_step(b),y);K?(l.clear_animation(v),m=K=!1):(q.set_tsr(a,c),1==b&&(m=!1,h&&h()))})}else k.error("move_camera_to_point(): you must specify the point object");else k.error("move_camera_to_point(): you must specify the camera object")};a.rotate_camera=
function(a,b,d,e,g){if(!u)if(a)if(b||d){u=!0;var f=0,h=0,m=0!=b?b:d,n=l.animate(0,m,e||1E3,function(e){E?(l.clear_animation(n),u=E=!1):(f-=e,h-=e,d&&b?c.rotate_camera(a,f,h):d?c.rotate_camera(a,0,h):b&&c.rotate_camera(a,f,0),h=f=e,e==m&&(u=!1,g&&g()))})}else k.error("rotate_camera(): you must specify the rotation angle");else k.error("rotate_camera(): you must specify the camera object")};a.stop_cam_moving=function(){K=!0};a.stop_cam_rotating=function(){E=!0};a.is_moving=function(){return m};a.is_rotating=
function(){return u}};b4w.module.gyroscope=function(a,p){function t(a){var b=c.create_gyro_angles_sensor(),n=!0;c.create_sensor_manifold(a,"CAMERA_ROTATE_GYRO",c.CT_CONTINUOUS,[b],null,function(a,b,f){if(0<f){l=c.get_sensor_payload(a,b,0);n&&(d[0]=l[0],d[1]=l[1],d[2]=l[2],n=!1);f=b=0;0==window.orientation&&(b=l[1]-d[1],f=l[0]-d[0],l[1]>r&&l[1]<q&&(f=0));if(180==window.orientation){b=l[1]-d[1];0>l[1]&&(b=-b);f=d[0]-l[0];if(b>Math.PI/2||b<-Math.PI/2)b=0;l[1]>-q&&l[1]<-r&&(f=0)}if(-90==window.orientation){b=l[0]-d[0];if(b>
Math.PI/2||b<-Math.PI/2)b=0;f=d[1]-l[1];if(l[0]>g||l[0]<C)f=0}if(90==window.orientation){b=d[0]-l[0];if(b>Math.PI/2||b<-Math.PI/2)b=0;f=l[1]-d[1];if(l[0]>g||l[0]<C)f=0}k.rotate_camera(a,f,b);d[0]=l[0];d[1]=l[1];d[2]=l[2]}})}var c=p("controls"),b=p("scenes"),k=p("camera"),d=new Float32Array(3),l=new Float32Array(3),q=110*Math.PI/180,r=70*Math.PI/180,g=70*Math.PI/180,C=70*-Math.PI/180;a.enable_camera_rotation=function(){var a=b.get_active_camera();t(a)}};b4w.module.hmd=function(a,p){function t(a,b){var c=a.filter(function(a){return a instanceof HMDVRDevice});c.length&&(F=c[0]);F&&(D=a.filter(function(a){return-1!==a.deviceName.toLowerCase().indexOf("oculus")&&a.hardwareUnitId==F.hardwareUnitId&&a instanceof PositionSensorVRDevice}))}function c(a){if(D)for(var b=0;b<D.length;b++){var c=D[b].getState();if(c.orientation)return a||(a=g.create()),a[0]=c.orientation.x,a[1]=c.orientation.y,a[2]=c.orientation.z,a[3]=c.orientation.w,a}}function b(a,b){if(F){var c=
F.getEyeParameters(a);if(c&&c.currentFieldOfView)return b||(b=B.create()),b[0]=c.currentFieldOfView.upDegrees,b[1]=c.currentFieldOfView.rightDegrees,b[2]=c.currentFieldOfView.downDegrees,b[3]=c.currentFieldOfView.leftDegrees,b}}function k(){if(D)for(var a=0;a<D.length;a++)D[a].resetSensor()}function d(a){if(F){var d=q.create_elapsed_sensor(),p=!1;q.create_sensor_manifold(null,"HMD_ROTATE_CAMERA",q.CT_CONTINUOUS,[d],null,function(d,q,t){if((d=f.get_active_camera())&&0<t&&(p||(t=b("left",u),q=b("right",
K),t&&t&&l.set_hmd_fov(d,t,q),F?(t=F.getEyeParameters("left"),t=F.getEyeParameters("right").eyeTranslation.x-t.eyeTranslation.x):t=void 0,t&&l.set_eye_distance(d,t),t={},q=-1!==F.deviceName.toLowerCase().indexOf("oculus")?"oculus":"default",t.distortion_coefs=[O[q].distortion_coefs[0],O[q].distortion_coefs[1]],t.chromatic_aberration_coefs=[O[q].chromatic_aberration_coefs[0],O[q].chromatic_aberration_coefs[1],O[q].chromatic_aberration_coefs[2],O[q].chromatic_aberration_coefs[3]],t.distortion_scale=
O[q].distortion_scale,t.distortion_offset=0,t.enable_hmd_stereo=!0,f.set_hmd_params(t),t=r.get_container(),r.resize(t.clientWidth,t.clientHeight,!0),p=!0,e=h.get_rotation(d,e),k()),l.is_eye_camera(d)))if(1==a){if(t=c(E)){q=g.setAxisAngle(n.AXIS_X,Math.PI/2,M);g.normalize(q,q);t=g.multiply(t,q,E);var x=A.transformQuat(n.AXIS_Z,t,y);l.set_vertical_axis(d,x);h.set_rotation_v(d,t)}}else if(2==a||3==a)if(t=c(E)){q=g.setAxisAngle(n.AXIS_X,Math.PI/2,M);g.normalize(q,q);t=g.multiply(t,q,E);q=h.get_rotation(d,
M);q=g.invert(q,M);var B=g.multiply(e,q,M);q=l.get_vertical_axis(d,y);Math.abs(q[2])<Math.PI/4?x=A.cross(q,n.AXIS_Z,v):Math.abs(q[1])<Math.PI/4&&(x=A.cross(q,n.AXIS_Y,v));A.normalize(x,x);var B=A.transformQuat(x,B,m),w=A.dot(q,B),B=A.scaleAndAdd(B,q,-w,m);A.normalize(B,B);q=A.cross(q,x,y);x=Math.acos(n.clamp(A.dot(x,B),0,1));q=n.sign(A.dot(B,q));z+=x*q;x=g.setAxisAngle(n.AXIS_Y,-z,M);3!=a&&(q=n.quat_project(t,n.AXIS_MY,n.AXIS_Y,n.AXIS_MZ,J),q=g.invert(q,J),t=g.multiply(q,t,J));t=g.multiply(x,t,E);
x=A.transformQuat(n.AXIS_Z,t,y);l.set_vertical_axis(d,x);h.set_rotation_v(d,t);g.copy(t,e)}})}else C.warn("Head-mounted display is not found.")}var l=p("camera"),q=p("controls"),r=p("container"),g=p("quat"),C=p("print"),f=p("scenes"),h=p("transform"),n=p("util"),A=p("vec3"),B=p("vec4"),F=null,D=null,e=g.create(),z=0,y=A.create(),v=A.create(),m=A.create(),u=B.create(),K=B.create(),E=g.create(),M=g.create(),J=g.create(),O={oculus:{distortion_coefs:[.22,.28],distortion_scale:.66,chromatic_aberration_coefs:[-.015,
.02,.025,.02]},"default":{distortion_coefs:[0,0],distortion_scale:1,chromatic_aberration_coefs:[0,0,0,0]}};a.HMD_NONE_MOUSE_ALL_AXES=0;a.HMD_ALL_AXES_MOUSE_NONE=1;a.HMD_ROLL_PITCH_MOUSE_YAW=2;a.HMD_ALL_AXES_MOUSE_YAW=3;a.enable_hmd=function(a){navigator.getVRDevices&&navigator.getVRDevices().then(function(b){t(b);F&&d(a)})};a.check_browser_support=function(){return Boolean(navigator.getVRDevices)};a.get_hmd_device=function(a){return F};a.reset=k;a.disable_hmd=function(){q.remove_sensor_manifold(null,
"HMD_ROTATE_CAMERA");f.set_hmd_params({enable_hmd_stereo:!1});var a=r.get_container();r.resize(a.clientWidth,a.clientHeight,!0);a=f.get_active_camera();l.set_vertical_axis(a,n.AXIS_Y);var b=h.get_rotation(a,E);h.set_rotation_v(a,b)}};b4w.module.mixer=function(a,p){function t(){F=B.length=0;D=c(100);e=new Float32Array(D.length);z=new Float32Array(D.length);var a=n.get_speaker_objects();if(a.length){B.push(b());for(var g=0;g<a.length;g++)B.push(d(a[g]));B.sort(function(a,b){return"MASTER"==a.id?-1:"MASTER"==b.id?1:"COMPRESSOR"==a.id?-1:"COMPRESSOR"==b.id?1:a.id.toUpperCase()<b.id.toUpperCase()?-1:a.id.toUpperCase()>b.id.toUpperCase()?1:0})}}function c(a){for(var b=new Float32Array(a),c=0,d=0;d<a;d++)b[d]=20*Math.pow(1E3,c),c+=1/
(a-1);return b}function b(){var a=k("MASTER");a.params.push(["VOLUME",n.get_volume(null),0,1,50,!1]);var b=n.get_compressor_params();b&&(a.params.push(["THRESHOLD",b.threshold,-100,0,100,!1]),a.params.push(["KNEE",b.knee,0,40,40,!1]),a.params.push(["RATIO",b.ratio,1,20,20,!1]),a.params.push(["ATTACK",b.attack,0,1,1E3,!1]),a.params.push(["RELEASE",b.release,0,1,1E3,!1]));a.mute=n.is_muted(null)?1:0;a.solo=-1;return a}function k(a){return{id:a,params:[],active_param:0,mute:-1,solo:-1,speaker:null}}
function d(a){var b=k(h.get_object_name(a));b.mute=n.is_muted(a)?1:0;b.solo=0;b.speaker=a;return b}function l(a){if(a.speaker){a.params.length=0;a.params.push(["VOLUME",n.get_volume(a.speaker),0,1,50,!1]);var b=n.get_positional_params(a.speaker);b&&(a.params.push(["DIST_REF",b.dist_ref,0,1E3,1E4,!1]),a.params.push(["ATTENUATION",b.attenuation,0,50,1E3,!1]),a.params.push(["DIST_MAX",b.dist_max,0,1E4,1E4,!1]));if(b=n.get_filter_params(a.speaker))a.params.push(["EQ_FREQ",b.freq,20,2E4,100,!0]),a.params.push(["EQ_Q",
b.Q,0,10,100,!1]),a.params.push(["EQ_GAIN",b.gain,-70,30,100,!1]);A.clamp(a.active_param,0,a.params.length-1)}}function q(a){for(var b=0;b<B.length;b++){var c=B[b];if(c!=a&&1==c.solo)return!0}return!1}function r(a){for(var b=0;b<B.length;b++){var c=B[b];c!=a&&0==c.mute&&0==c.solo&&n.mute(c.speaker,!1)}}function g(){if(0==B.length)return[0,-1];var a=8*Math.floor(F/8),b=a+7,a=A.clamp(a,0,B.length-1),b=A.clamp(b,0,B.length-1);return[a,b]}var C=p("controls");p("debug");var f=p("hud"),h=p("scenes"),n=
p("sfx"),A=p("util"),B=[],F=0,D=null,e=null,z=null;a.enable_mixer_controls=function(){t();var a=C.create_keyboard_sensor(C.KEY_LEFT_SQ_BRACKET),b=C.create_keyboard_sensor(C.KEY_RIGHT_SQ_BRACKET),c=C.create_keyboard_sensor(C.KEY_SEMI_COLON),d=C.create_keyboard_sensor(C.KEY_SINGLE_QUOTE),h=C.create_keyboard_sensor(C.KEY_SHIFT),k=C.create_timer_sensor(.15,!0),p=C.create_timer_sensor(.05,!0),a=[a,b,c,d,h,k,p],b=function(a,b,c){if(1==c){c=Boolean(C.get_sensor_value(a,b,0))?-1:1;if(B.length){1==c&&F<B.length-
1?F++:-1==c&&0<F&&F--;c=g();for(var d=c[0];d<=c[1];d++)l(B[d])}"SWITCH_STRIP"==b?C.reset_timer_sensor(a,b,5,.15+.3):C.reset_timer_sensor(a,b,5,.15)}else C.reset_timer_sensor(a,b,5,10)};C.create_sensor_manifold(null,"SWITCH_STRIP",C.CT_TRIGGER,a,function(a){return(a[0]||a[1])&&!a[4]},b);C.create_sensor_manifold(null,"SWITCH_STRIP_HOLD",C.CT_SHOT,a,function(a){return(a[0]||a[1])&&!a[4]&&a[5]},b);C.create_sensor_manifold(null,"SWITCH_PARAM",C.CT_SHOT,a,function(a){return(a[0]||a[1])&&a[4]},function(a,
b,c){a=Boolean(C.get_sensor_value(a,b,0))?-1:1;(b=B[F])&&(1==a&&b.active_param<b.params.length-1?b.active_param++:-1==a&&0<b.active_param&&b.active_param--)});b=function(a,b,c){if(1==c){var d=Boolean(C.get_sensor_value(a,b,2))?-1:1,e=B[F];if(e)switch(c=e.params[e.active_param],c[1]=c[5]?c[1]*Math.pow(c[3]/c[2],d/c[4]):c[1]+(c[3]-c[2])/c[4]*d,c[1]=A.clamp(c[1],c[2],c[3]),c[0]){case "VOLUME":"MASTER"!=e.id?n.set_volume(e.speaker,c[1]):n.set_volume(null,c[1]);break;case "DIST_REF":d=n.get_positional_params(e.speaker);
d.dist_ref=c[1];n.set_positional_params(e.speaker,d);break;case "ATTENUATION":d=n.get_positional_params(e.speaker);d.attenuation=c[1];n.set_positional_params(e.speaker,d);break;case "DIST_MAX":d=n.get_positional_params(e.speaker);d.dist_max=c[1];n.set_positional_params(e.speaker,d);break;case "EQ_FREQ":d=n.get_filter_params(e.speaker);d.freq=c[1];n.set_filter_params(e.speaker,d);break;case "EQ_Q":d=n.get_filter_params(e.speaker);d.Q=c[1];n.set_filter_params(e.speaker,d);break;case "EQ_GAIN":d=n.get_filter_params(e.speaker);
d.gain=c[1];n.set_filter_params(e.speaker,d);break;case "THRESHOLD":e=n.get_compressor_params();e.threshold=c[1];n.set_compressor_params(e);break;case "KNEE":e=n.get_compressor_params();e.knee=c[1];n.set_compressor_params(e);break;case "RATIO":e=n.get_compressor_params();e.ratio=c[1];n.set_compressor_params(e);break;case "ATTACK":e=n.get_compressor_params();e.attack=c[1];n.set_compressor_params(e);break;case "RELEASE":e=n.get_compressor_params();e.release=c[1];n.set_compressor_params(e);break;default:throw"Unknown strip param";
}"INC_DEC"==b?C.reset_timer_sensor(a,b,6,.35):C.reset_timer_sensor(a,b,6,.05)}else C.reset_timer_sensor(a,b,6,10)};C.create_sensor_manifold(null,"INC_DEC",C.CT_TRIGGER,a,function(a){return(a[2]||a[3])&&!a[4]},b);C.create_sensor_manifold(null,"INC_DEC_HOLD",C.CT_SHOT,a,function(a){return(a[2]||a[3])&&!a[4]&&a[6]},b);C.create_sensor_manifold(null,"MUTE_SOLO",C.CT_SHOT,a,function(a){return(a[2]||a[3])&&a[4]},function(a,b,c){if(Boolean(C.get_sensor_value(a,b,2)))(a=B[F])&&0<=a.mute&&("MASTER"!=a.id?0==
a.mute?(a.mute=1,n.mute(a.speaker,!0),1==a.solo&&(a.solo=0,q(a)||r(a))):(a.mute=0,q(a)||n.mute(a.speaker,!1)):0==a.mute?(a.mute=1,n.mute(null,!0)):(a.mute=0,n.mute(null,!1)));else if((a=B[F])&&0<=a.solo)if(0==a.solo)for(a.solo=1,n.mute(a.speaker,!1),1==a.mute&&(a.mute=0),b=0;b<B.length;b++)c=B[b],c!=a&&0==c.mute&&0==c.solo&&n.mute(c.speaker,!0);else a.solo=0,q(a)?n.mute(a.speaker,!0):r(a)});a=C.create_elapsed_sensor();C.create_sensor_manifold(null,"MIXER_DRAW",C.CT_CONTINUOUS,[a],null,function(){if(B[F])for(var a=
g(),b=a[0];b<=a[1];b++){var c=B[b];f.draw_mixer_strip(c.id,b==F,b%8,c.params,c.active_param,c.mute,c.solo);if(c.speaker&&n.get_filter_params(c.speaker)){n.get_filter_freq_response(c.speaker,D,e,z);for(c=0;c<e.length;c++)e[c]=20*Math.log(e[c])/Math.LN10;f.plot_array("EQ",b%8,e,20,2E4,-10,10)}}});a=C.create_timer_sensor(1,!0);C.create_sensor_manifold(null,"MIXER_UPDATE",C.CT_TRIGGER,[a],null,function(){for(var a=g(),b=a[0];b<=a[1];b++)l(B[b])})}};b4w.module.npc_ai=function(a,p){function t(a,b){var c=b.destination,d=F;h.get_translation(b.empty,d);var f=D;h.get_translation(b.collider,f);var k=0;b.y_cor_water?k=b.y_cor_water:b.y_correction&&(k=b.y_correction,b.type==u&&(k*=.5),b.type==E&&(k*=a));switch(b.type){case u:if(b.random&&b.reached){c[0]=(12*Math.random()-6)*b.speed+d[0];c[2]=(12*Math.random()-6)*b.speed+d[2];var p=v,d=e,r=b.speed,t=b.rot_speed;h.get_rotation(b.collider,p);A.transformQuat(n.AXIS_Z,p,d);d[1]=0;A.normalize(d,d);p=Math.sin(t/
2);r=.5*r/p;p=A.dist(c,f);p<2*r&&A.scaleAndAdd(c,d,2*r-p,c);b.reached=!1}c[1]=f[1];k&&(c[1]+=k);break;case K:case E:b.random&&b.reached&&(b.type==E?(b.speed=Math.random()+.1,r=b.max_depth-b.min_depth):r=b.max_height-b.min_height,c[0]=10*Math.random()-5+d[0],c[1]=f[1]+(Math.random()*r-.5*r),c[2]=10*Math.random()-5+d[2],b.reached=!1);k&&(c[1]=f[1]+k);break}var c=F,r=D,p=e,f=m,B=b.rig,d=b.collider,k=b.destination,C=b.speed,w=b.actions,fa=q.get_current_anim_name(B);if(!q.is_play(B)||!w.idle||-1==w.idle.indexOf(fa)){h.get_translation(d,
c);var t=k[0]-c[0],da=k[2]-c[2],t=Math.sqrt(t*t+da*da);if(t>2*C*a)b.state=20,n.xz_direction(k,c,p),w=b.rig,q.is_animated(w)&&(B=b.speed,C=q.get_frame(w),w=q.get_anim_length(w),B*=w/24*(1-C/w),.9>t/B&&A.scaleAndAdd(k,p,B-t,k)),t=v,B=z,h.get_rotation(b.collider,t),A.transformQuat(n.AXIS_Z,t,r),B[0]=r[0],B[1]=0,B[2]=r[2],A.normalize(B,B),C=A.dot(B,p),w=Math.acos(C),w=Math.abs(w)/Math.PI,w=a/w*b.rot_speed*b.rotation_mult,g.rotationTo(B,p,f),g.rotationTo(n.AXIS_Z,B,t),1<=Math.abs(C)?g.copy(t,f):(g.multiply(f,
t,f),g.slerp(t,f,Math.min(w,1),f)),p=a,b.type!=K&&(p=Math.max(p,1/60),t=y,B=v,r=Math.asin(r[1]),g.setAxisAngle(n.AXIS_X,-r,B),r=Math.atan(b.y_correction/(b.speed*p)),g.setAxisAngle(n.AXIS_X,-r,t),g.slerp(B,t,p,t),g.multiply(f,t,f)),h.set_rotation_v(d,f),d=e,r=z,n.quat_to_dir(f,n.AXIS_Z,d),A.scale(d,b.speed*a,r),A.add(r,c,r),r[1]=b.type!=u?(k[1]-c[1])*a*.1+c[1]:k[1],h.set_translation_v(b.collider,r);else if(b.type==u)w.move?fa&&-1!=w.move.indexOf(fa)&&q.is_play(B)?b.state=20:(b.state=10,b.reached=
!0):(b.state=10,b.reached=!0);else if(b.type==E||b.type==K)b.reached=!0;if(l(b)&&(c=b.rig,!q.is_play(c))){f=null;switch(b.state){case 10:f=b.actions;f=f.idle?n.random_from_array(f.idle):null;break;case 20:f=q.get_current_anim_name(b.rig),d=k=b.actions,d.move_blends&&-1==d.move_blends.indexOf(f)&&d.move&&-1!=d.move.indexOf(f)&&.33<Math.random()?(k=b.actions,f=k.move.indexOf(f),f=k.move_blends[f]):(d=b.actions,d.move&&(-1!=d.move.indexOf(f)||!d.move_blends&&!d.move_start||!d.move_start&&!f||d.move_blends&&
-1!=d.move_blends.indexOf(f)||d.move_start&&-1!=d.move_start.indexOf(f))?(k=b.actions,k.move_blends?(d=k.move_blends.indexOf(f),-1!=d?(f=d+1,f=f<k.move.length?f:0,f=k.move[f]):f=-1!=k.move.indexOf(f)?f:n.random_from_array(k.move)):f=n.random_from_array(k.move)):(d=b.actions,f=d.move_start&&-1==d.move_start.indexOf(f)&&d.move&&-1==d.move.indexOf(f)?n.random_from_array(k.move_start):null))}f&&(q.apply(c,f),q.set_behavior(c,q.AB_FINISH_RESET),q.set_frame(c,0),q.play(c))}}}function c(a,b,c,d){if(d)if(1==
c)switch(d.type){case K:a:{for(c=0;3>c;c++){var e=r.get_sensor_payload(a,b,c).hit_fract;if(e){b=e;break a}}b=void 0}a=100*b;d.y_correction=a<d.min_height?10:a>d.max_height?-10:0;break;case u:a=r.get_sensor_payload(a,b,0).hit_fract;d.y_correction=d.prev_hit_pos==a?0:1-100*a;d.prev_hit_pos=a;break;case E:a=r.get_sensor_payload(a,b,0).hit_fract,"CLOSE_GROUND"==b?(d.y_correction=100*a-1,d.y_correction=.1>d.y_correction?.05:0):"CLOSE_WATER"==b&&(d.y_cor_water=100*a,d.y_cor_water=d.y_cor_water<d.min_depth?
-.02:d.y_cor_water>d.max_depth?.02:0)}else d.y_correction=0}function b(){for(var a=0;a<B.length;a++){var b=B[a];k(b);d(b);b.rig&&q.get_current_anim_name(b.rig)&&q.play(b.rig)}}function k(a){var b=A.create(),d=a.collider;switch(a.type){case K:var e=r.create_ray_sensor(d,b,[0,-100,0],"TERRAIN",!0),f=r.create_ray_sensor(d,b,[0,-100,0],"STONE",!0),b=r.create_ray_sensor(d,b,[0,-100,0],"WATER",!0),e=[e,f,b];r.create_sensor_manifold(d,"CLOSE_GROUND",r.CT_CONTINUOUS,e,function(a){return a[0]||a[1]||a[2]},
c,a);break;case u:e=r.create_ray_sensor(d,[0,1,0],[0,-99,0],"TERRAIN",!0);e=[e];r.create_sensor_manifold(d,"CLOSE_GROUND",r.CT_CONTINUOUS,e,null,c,a);break;case E:e=r.create_ray_sensor(d,[0,1,0],[0,-99,0],"TERRAIN",!0),b=r.create_ray_sensor(d,b,[0,100,0],"WATER",!0),e=[e],r.create_sensor_manifold(d,"CLOSE_WATER",r.CT_CONTINUOUS,[b],null,c,a),r.create_sensor_manifold(d,"CLOSE_GROUND",r.CT_CONTINUOUS,e,null,c,a)}}function d(a){function b(c,d,e){1==e?(h.get_translation(a.empty,a.destination),a.rotation_mult=
4):a.rotation_mult=1}var c=a.collider;if(a.type==u){var d=r.create_collision_sensor(c,"CONSTRUCTION",!1);r.create_sensor_manifold(c,"CONSTRUCTION_COLL",r.CT_CONTINUOUS,[d],null,b)}}function l(a){var b=a.rig;if(!q.is_play(b))return!0;b=q.get_current_anim_name(b);if(!b)return!0;var c=a.actions;switch(a.state){case 10:if(!c.idle)return!1;if(-1==c.idle.indexOf(b))break;break;case 20:if(!c.move||-1!=c.move.indexOf(b)||c.move_start&&-1!=c.move_start.indexOf(b)||c.move_blends&&-1!=c.move_blends.indexOf(b))return!1;
break;default:return!1}return!0}var q=p("animation"),r=p("controls"),g=p("quat"),C=p("scenes"),f=p("time"),h=p("transform"),n=p("util"),A=p("vec3"),B=[];new Float32Array(9);var F=new Float32Array(3),D=new Float32Array(3),e=new Float32Array(3),z=new Float32Array(3),y=new Float32Array(4),v=new Float32Array(4),m=new Float32Array(4),u=a.NT_WALKING=10,K=a.NT_FLYING=20,E=a.NT_SWIMMING=30;a.new_event_track=function(a){a.destination=new Float32Array(3);a.start=[];a.ended=[];a.fired=[];a.y_correction=null;
a.prev_hit_pos=null;a.y_cor_water=null;a.reached=!0;a.rotation_mult=1;if(!a.random)for(var b=0;b<a.path.length;b++)a.start[b]=-1,a.ended[b]=!1,a.fired[b]=!1;B.push(a)};a.enable_animation=function(){if(B.length){b();var a=r.create_elapsed_sensor();r.create_sensor_manifold(B[0].collider,"ELAPSED",r.CT_CONTINUOUS,[a],function(a){return a[0]},function(a,b,c){if(1==c)for(a=r.get_sensor_value(a,b,0),b=0;b<B.length;b++){c=B[b];var d=a;if(C.is_visible(c.obj))if(c.random)t(d,c);else{for(var e=f.get_timeline(),
g=0;g<c.path.length;g++)if(!c.ended[g]){c.fired[g]||(c.fired[g]=!0,c.destination[0]=c.path[g][0],c.destination[1]=c.path[g][1],c.destination[2]=c.path[g][2],c.start[g]=e+c.delay[g]);if(e<c.start[g])break;t(d,c);c.ended[g]=c.reached;break}d=void 0;a:{for(d=0;d<c.path.length;d++)if(0==c.ended[d]){d=!1;break a}d=!0}if(d)for(d=0;d<c.path.length;d++)c.fired[d]=!1,c.ended[d]=!1}}})}};a.disable_animation=function(){if(!(0>=B.length))for(var a=0;a<B.length;a++){var b=B[a];r.check_sensor_manifolds(b.collider)&&
r.remove_sensor_manifold(b.collider);q.is_play(b.rig)&&q.stop(b.rig)}}};b4w.module.mouse=function(a,p){function t(){1==K&&(K=0);var a=document.exitPointerLock||document.webkitExitPointerLock||document.mozExitPointerLock;"function"===typeof a&&a.apply(document);f.remove_sensor_manifold(A.get_active_camera(),"SMOOTH_PL")}function c(a){2==K&&(K=0);a.removeEventListener("mousedown",k,!1);a.removeEventListener("mouseup",d,!1);a.removeEventListener("mousemove",b,!1);f.remove_sensor_manifold(A.get_active_camera(),"SMOOTH_DRAG")}function b(a){m()&&(y[0]+=2*(a.clientX-e),y[1]+=
2*(a.clientY-z),e=a.clientX,z=a.clientY);a.preventDefault()}function k(a){e=a.clientX;z=a.clientY;a.currentTarget.addEventListener("mousemove",b,!1);a.preventDefault()}function d(a){a.currentTarget.removeEventListener("mousemove",b,!1);a.preventDefault()}function l(a,b,c,d){if(.01<Math.abs(y[0])||.01<Math.abs(y[1]))b=f.get_sensor_value(a,b,0),a=B.smooth(y[0],0,b,.1*D),b=B.smooth(y[1],0,b,.1*D),y[0]-=a,y[1]-=b,d(4E-4*-a,4E-4*-b)}function q(a,b){var c=A.get_first_character(),d=A.get_active_camera();
g.eye_rotate(d,a,b);c&&(d=g.get_camera_angles_char(d,v),h.set_character_rotation(c,d[0],d[1]))}function r(a){a=C.client_to_canvas_coords(a.clientX,a.clientY,v);(a=A.pick_object(a[0],a[1]))?(A.outlining_is_enabled(a)&&A.set_outline_intensity(a,1),A.outlining_is_enabled(u)&&a!=u&&A.set_outline_intensity(u,0)):A.outlining_is_enabled(u)&&A.set_outline_intensity(u,0);u=a}var g=p("camera"),C=p("container"),f=p("controls"),h=p("physics"),n=p("print"),A=p("scenes"),B=p("util"),F=p("main"),D=1,e=0,z=0,y=new Float32Array(2),
v=new Float32Array(2),m=null,u=null,K=0;a.request_pointerlock=function(a,b,d,e,g,h){function k(){if(document.pointerLockElement===a||document.webkitPointerLockElement===a||document.mozPointerLockElement===a){c(a);a.addEventListener("mousemove",e,!1);var g=A.get_active_camera();if(!f.check_sensor_manifold(g,"SMOOTH_PL")){var m=f.create_elapsed_sensor();f.create_sensor_manifold(g,"SMOOTH_PL",f.CT_CONTINUOUS,[m],null,l,h)}b()}else a.removeEventListener("mousemove",e,!1),K=0,document.removeEventListener("pointerlockchange",
k,!1),document.removeEventListener("webkitpointerlockchange",k,!1),document.removeEventListener("mozpointerlockchange",k,!1),d()}if(1!=K){K=1;b=b||function(){};d=d||function(){};h=h||q;g=g||function(){return!0};e=e||function(a){if(g()){if("number"==typeof a.movementX){var b=a.movementX;a=a.movementY}else"number"==typeof a.webkitMovementX?(b=a.webkitMovementX,a=a.webkitMovementY):"number"==typeof a.mozMovementX?(b=a.mozMovementX,a=a.mozMovementY):a=b=0;y[0]+=b;y[1]+=a}};document.addEventListener("pointerlockchange",
k,!1);document.addEventListener("webkitpointerlockchange",k,!1);document.addEventListener("mozpointerlockchange",k,!1);var m=a.requestPointerLock||a.webkitRequestPointerLock||a.mozRequestPointerLock;"function"===typeof m?m.apply(a):n.error("Pointer lock is not available")}};a.exit_pointerlock=t;a.check_pointerlock=function(a){return"function"===typeof(a.requestPointerLock||a.webkitRequestPointerLock||a.mozRequestPointerLock)?!0:!1};a.request_mouse_drag=function(a,b,c){2!=K&&(K=2,t(),m=b||function(){return!0},
c=c||q,a.addEventListener("mousedown",k,!1),a.addEventListener("mouseup",d,!1),a=A.get_active_camera(),f.check_sensor_manifold(a,"SMOOTH_DRAG")||(b=f.create_elapsed_sensor(),f.create_sensor_manifold(a,"SMOOTH_DRAG",f.CT_CONTINUOUS,[b],null,l,c)))};a.exit_mouse_drag=c;a.enable_mouse_hover_outline=function(){F.detect_mobile()||C.get_canvas().addEventListener("mousemove",r)};a.disable_mouse_hover_outline=function(){F.detect_mobile()||(C.get_canvas().removeEventListener("mousemove",r),u&&A.set_outline_intensity(u,
0))};a.get_coords_x=function(a){return"clientX"in a?a.clientX:a.touches&&"clientX"in a.touches[0]?a.touches[0].clientX:-1};a.get_coords_y=function(a){return"clientY"in a?a.clientY:a.touches&&"clientY"in a.touches[0]?a.touches[0].clientY:-1};a.set_plock_smooth_factor=function(a){D=a};a.get_plock_smooth_factor=function(){return D}};b4w.module.preloader=function(a,p){var t=p("app"),c,b,k,d,l,q,r,g,C,f=null;a.create_simple_preloader=function(a){var g=null,p=null,r="#bf9221",t="#000",C;for(C in a)switch(C){case "canvas_container_id":g=a.canvas_container_id;break;case "background_container_id":p=a.background_container_id;break;case "bg_color":t=a.bg_color;break;case "bar_color":r=a.bar_color;break;case "preloader_fadeout":c=a.preloader_fadeout}a=document.createElement("div");C=document.createElement("div");a.id="simple_preloader_container";
var e=document.createElement("div"),z=document.createElement("div"),p=document.getElementById(p);f=document.getElementById(g);a.style.cssText="z-index: 4;background-color: "+t+";width: 100%;height: 100%;position: absolute;margin: 0;padding: 0;top: 0;left: 0;";C.style.cssText="position: absolute;left: 50%;top: 82%;width: 300px;height: 20px;margin-left: -150px;margin-top: -10px;border-style:solid;border-width:4px;border-color: #000;border-radius: 0px;";e.style.cssText="position: absolute;left: 0px;top: 1px;width: 0px;height: 18px;background-color: "+
r+";border-radius: 0px;";z.style.cssText="position: absolute;left: 50%;top: 50%;width: 100%;height: 100%;margin-left: -150px;margin-top: -10px;text-align: center;font-size: 17px;font-weight: bold;color: #000;font-family: Verdana;"+C.appendChild(e);C.appendChild(z);a.appendChild(C);document.body.appendChild(a);b="SIMPLE";k=a;d=e;l=z;q=p};a.create_rotation_preloader=function(a){var c=null,d=null,g="rgba(0,0,0,0)",p="",t="",e="rgba(0,0,0,0)",z;for(z in a)switch(z){case "canvas_container_id":c=a.canvas_container_id;
break;case "background_container_id":d=a.background_container_id;break;case "frame_bg_color":g=a.frame_bg_color;break;case "bg_color":e=a.bg_color;break;case "frame_class":p=a.frame_class;break;case "anim_elem_class":t=a.anim_elem_class}a=document.createElement("div");z=document.createElement("div");var y=document.createElement("div"),v=document.createElement("div"),d=document.getElementById(d);f=document.getElementById(c);a.style.cssText="z-index: 4;background-color: "+e+";width: 100%;height: 100%;position: absolute;margin: 0;padding: 0;top: 0;left: 0;";
z.style.cssText="position: absolute;left: 50%;top: 50%;width: 117px;height: 117px;margin-left: -58px;margin-top: -58px;background-color: "+g+";";y.style.cssText="position: absolute;left: 0px;top: 0px;width: 100%;height: 100%;background-position: center;background-repeat: no-repeat;";v.style.cssText="position: absolute;width: 100%;height: 100%;text-align: center;margin-top: 38px;font-size: 36px;color: #ffffff;font-family: Arial;font-weight: bold;";y.className=t;z.appendChild(y);z.className=p;z.appendChild(v);
a.appendChild(z);f.appendChild(a);b="ROTATION";k=a;r=y;l=v;q=d};a.create_advanced_preloader=function(a){var c=a.preloader_width,p=a.canvas_container_id,c=c/(c-a.img_width),r=document.getElementById(a.preloader_bar_id),t=document.getElementById(a.fill_band_id),D=document.getElementById(a.preloader_caption_id),e=document.getElementById(a.preloader_container_id);a=document.getElementById(a.background_container_id);f=document.getElementById(p);b="ADVANCED";d=r;g=t;C=c;l=D;k=e;q=a};a.update_preloader=
function(a){l.innerHTML=a+"%";"SIMPLE"==b&&(d.style.width=a+"%");"ADVANCED"==b&&(d.style.width=a/C+"%",g.style.width=100-a+"%");"ROTATION"==b&&(r.style.transform="rotate("+a+"deg)");100==a&&(c?(t.css_animate(q,"opacity",1,0,1500,null,null,function(){q.parentNode.removeChild(q)}),t.css_animate(k,"opacity",1,0,1E3,null,null,function(){k.parentNode.removeChild(k)})):(k.parentNode.removeChild(k),q&&q.parentNode.removeChild(q)))}};b4w.module.storage=function(a,p){function t(a){k=a;if(!d){try{d=window.localStorage;try{d.tmp=null,delete d.tmp}catch(c){b.warn("localStorage quota is limited. Disabling localStorage"),d=null}}catch(p){b.warn("Applying chrome localStorage bug workaround"),d=null}d||(b.warn("localStorage is not available, initializing temporary storage"),d={})}}function c(){return d[k]?JSON.parse(d[k]):{}}var b=p("__print"),k="",d=null;a.init=t;a.set=function(a,b){var p=c();p[a]=String(b);d[k]=JSON.stringify(p)};a.cleanup=
function(){delete d[k]};a.get=function(a){var b=c();return b[a]?b[a]:""};a.debug=function(){b.log(c())};t("b4w")};b4w.module.screenshooter=function(a,p){var t=p("main");a.shot=function(){t.canvas_data_url(function(a){var b=window.document.createElement("a");document.body.appendChild(b);b.style.display="none";b.href=a;b.download="screenshot.png";b.click();document.body.removeChild(b)})}};
